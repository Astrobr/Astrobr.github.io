{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/icarus/source/css/cyberpunk.styl","path":"css/cyberpunk.styl","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/default.styl","path":"css/default.styl","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/night.styl","path":"css/night.styl","modified":1,"renderable":1},{"_id":"themes/icarus/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/icarus/source/img/alipay.JPG","path":"img/alipay.JPG","modified":1,"renderable":1},{"_id":"themes/icarus/source/img/avatar.jpeg","path":"img/avatar.jpeg","modified":1,"renderable":1},{"_id":"themes/icarus/source/img/favicon.png","path":"img/favicon.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/img/logo.png","path":"img/logo.png","modified":1,"renderable":1},{"_id":"themes/icarus/source/img/razor-bottom-black.svg","path":"img/razor-bottom-black.svg","modified":1,"renderable":1},{"_id":"themes/icarus/source/img/razor-top-black.svg","path":"img/razor-top-black.svg","modified":1,"renderable":1},{"_id":"themes/icarus/source/img/wechatpay.JPG","path":"img/wechatpay.JPG","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/animation.js","path":"js/animation.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/back_to_top.js","path":"js/back_to_top.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/column.js","path":"js/column.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/mathjax-config.js","path":"js/mathjax-config.js","modified":1,"renderable":1},{"_id":"themes/icarus/source/js/night.js","path":"js/night.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"c8fc07a50b2affefd9bd69e572633713ec67cb62","modified":1661834902000},{"_id":"source/_drafts/.DS_Store","hash":"090feb3c86cfe00ec59c67c50c2ddc02cd2251c5","modified":1647347840000},{"_id":"source/_posts/.DS_Store","hash":"8f1372ebcaecee00f5b75f27517f3f840d45c453","modified":1646919694000},{"_id":"source/_posts/AirSimMultirotorAPIs.md","hash":"500eacfc2e53be0402acc76449935dafbe7eeb6e","modified":1637642470000},{"_id":"source/_posts/Gallery.md","hash":"b9774bbacfb8ac48b7235a6322e4baa435991a6d","modified":1661835674000},{"_id":"source/_posts/About.md","hash":"853f1a09819c7092493bfe693d0da33b2093f1ee","modified":1661739240000},{"_id":"source/_posts/HP_Envy-13_ad024TU_Hackintosh.md","hash":"00fbe1094d3e3a21f9af621ce5360ca6f2efb901","modified":1637642470000},{"_id":"source/_posts/Hexo的安装和自动部署.md","hash":"a17ab6b268722f1d31df4ad08b8f88573c93011e","modified":1637642470000},{"_id":"source/_posts/Hexo主题Icarus的自定义.md","hash":"b2920d90047db3f3a55b532b4a575aef5b274be9","modified":1647509288000},{"_id":"source/_posts/Icarus消息框模板.md","hash":"a22ea59bcd97a0fb5fb0bb37937817fe0819fbdd","modified":1637642470000},{"_id":"source/_posts/Python学习笔记.md","hash":"2402ae2066b3900fc1300b7e2611628e583ecf64","modified":1637642470000},{"_id":"source/_posts/Introduction_to_hackintosh.md","hash":"868db90e6d909cfe42c6b80a07df429ed689f136","modified":1637642470000},{"_id":"source/_posts/RLSummary1.md","hash":"26743e041175ab3c0a8798dc9e9f816b7ebcbd42","modified":1637642470000},{"_id":"source/_posts/RLSummary2.md","hash":"1eb1a16a91813a0f2fd28ef5bf12c21ed1c8fa4a","modified":1637642470000},{"_id":"source/_posts/RLSummary3.md","hash":"a250a5818609d1fab4d157e1469b5dafcb542f2d","modified":1637642470000},{"_id":"source/_posts/RLSummary4.md","hash":"2d611cdae2860278bcc50f70ea1d6bba915d69c8","modified":1637642470000},{"_id":"source/_posts/RLSummary5.md","hash":"d4c8c1676b6db66bb903a8cbba201accdc5f27a5","modified":1637642470000},{"_id":"source/_posts/RLSummary6.md","hash":"5068d68fd665d1c54e1531544d0c7ffcc885d302","modified":1637642470000},{"_id":"source/_posts/dsa-1.md","hash":"3b937d7e545528e6a49ee5f38fbb5ad5eb61cb06","modified":1646920770000},{"_id":"source/_posts/acc_cpp笔记.md","hash":"07ad7a3ac6bd961cd9df5fbeb667e215da8806df","modified":1646911322000},{"_id":"source/_posts/dsa-3.md","hash":"9302a5c32c0a6f51128b2dcdfb4f73496fe1b2e3","modified":1647685438000},{"_id":"source/_posts/dsa-2.md","hash":"96e8d1ece5d7e3d17eaa8197cffd62cee4c4afb1","modified":1647363020000},{"_id":"source/_posts/dsa-4.md","hash":"425ece28ec0ae486414805e60dcfb5b31a1a81cc","modified":1648043776000},{"_id":"source/_posts/dsa-5.md","hash":"2c115c4fe897c707e62d121fa2370213962d6126","modified":1648301808000},{"_id":"source/_posts/dsa-6.md","hash":"b8b7f9a94304118cf7136655a774787cfe3e51a5","modified":1649599818000},{"_id":"source/_posts/dsa-7.md","hash":"82754d84701d2d342761b28fe97eb09c6b1e1ecc","modified":1650037672000},{"_id":"source/_posts/华为云+nginx服务器搭建总结.md","hash":"be0070f3823905d805471a3eb5a68727181a7d1b","modified":1637642470000},{"_id":"source/_posts/dsa-8.md","hash":"de61ba877b4df49439bb0b6dc4d51ed9f8fc30b8","modified":1651986912000},{"_id":"source/_posts/瘦子增重教程.md","hash":"1518b412647e14d4243f373bba2141cbdcedc262","modified":1638189076000},{"_id":"source/_drafts/template.md","hash":"78d032ad97512cc7e07b6b08294876296eb2294b","modified":1637642470000},{"_id":"source/_posts/解决幻16睡眠自动唤醒问题与电源管理配置.md","hash":"04ead2f43fb12664f98736a4fa211944cf88fd2c","modified":1637642470000},{"_id":"themes/icarus/layout/comment/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/layout/search/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/layout/share/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/include/schema/comment/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/include/schema/donate/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/include/schema/misc/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/include/schema/search/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/include/schema/share/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/layout/donate/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/layout/misc/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637642470000},{"_id":"themes/icarus/.eslintignore","hash":"5410a1bef9807f666cd92a0d2020f700e67e4096","modified":1637642470000},{"_id":"themes/icarus/.npmignore","hash":"42242c8da7a020a3295e7dd3d18bf022cb08b661","modified":1637642470000},{"_id":"themes/icarus/CONTRIBUTING.md","hash":"70254c6778c1e41bb2ff222bbf3a70b2239b9bc1","modified":1637642470000},{"_id":"themes/icarus/LICENSE","hash":"86037e5335a49321fa73b7815cab542057fac944","modified":1637642470000},{"_id":"themes/icarus/package.json","hash":"653d306a010f669192883483414da500d48cf592","modified":1637642470000},{"_id":"themes/icarus/include/config.js","hash":"1ff0f174e9670074ad2bee890d5b6da486800c9a","modified":1637642470000},{"_id":"themes/icarus/include/dependency.js","hash":"d30dbcefd58619f6705d6369b644bc7ba44d2421","modified":1637642470000},{"_id":"themes/icarus/include/register.js","hash":"a974b56a1fbb254f1ae048cc2221363faaccec25","modified":1637642470000},{"_id":"themes/icarus/languages/de.yml","hash":"78421f09961ca0b24756a0688fb2cb2e2696e25f","modified":1637642470000},{"_id":"themes/icarus/languages/en.yml","hash":"3d674204d9f723c829226da745afddd180c1131d","modified":1637642470000},{"_id":"themes/icarus/languages/es.yml","hash":"38579b8fad4b6997362acc770615bcd85ff20f68","modified":1637642470000},{"_id":"themes/icarus/languages/fr.yml","hash":"06d5c819d6108a42b28cff7b52e5410d0bed55d1","modified":1637642470000},{"_id":"themes/icarus/languages/id.yml","hash":"5e48b1d62378cadeb64b88349477726a5c1bae47","modified":1637642470000},{"_id":"themes/icarus/languages/ja.yml","hash":"801d9930fef48d6a3f80470d5bed4f3eb78147e6","modified":1637642470000},{"_id":"themes/icarus/languages/ko.yml","hash":"e3374265377809c1518114cf352b595840c0b416","modified":1637642470000},{"_id":"themes/icarus/languages/pl.yml","hash":"2e7debb44cd91096f30efc87bf8d6b1d0d0214c9","modified":1637642470000},{"_id":"themes/icarus/languages/pt-BR.yml","hash":"ee8f73350e4c6e2f63b7fc72b34472a6b1e21244","modified":1637642470000},{"_id":"themes/icarus/languages/ru.yml","hash":"9d91358c2acbe7a0f2a25daf7f65b999ff32d068","modified":1637642470000},{"_id":"themes/icarus/languages/tk.yml","hash":"ca583168bd2025124a1cd0e977da475d7a7496fd","modified":1637642470000},{"_id":"themes/icarus/languages/tr.yml","hash":"74e438bb42619666050192d6f3dc39023777eee2","modified":1637642470000},{"_id":"themes/icarus/languages/vn.yml","hash":"5f2fffa642110c81d8f529949711c9d19ad6bbbe","modified":1637642470000},{"_id":"themes/icarus/languages/zh-CN.yml","hash":"02475ba14afc70dfeaf5678467cee307835e4efa","modified":1637642470000},{"_id":"themes/icarus/languages/zh-TW.yml","hash":"a6826e0c8cdb9ad286324b682b466a9e2ad78e6f","modified":1637642470000},{"_id":"themes/icarus/layout/archive.jsx","hash":"05677e93d4a43f417dbbf0d63ca37a99e6349e3b","modified":1637642470000},{"_id":"themes/icarus/layout/categories.jsx","hash":"b8ad43e28a4990d222bfbb95b032f88555492347","modified":1637642470000},{"_id":"themes/icarus/.eslintrc.json","hash":"43c7740158c8690242720b4ff7fa11426fc20c79","modified":1637642470000},{"_id":"themes/icarus/layout/category.jsx","hash":"fd15e4eac32de9ac8687aeb3dbe179ab61375700","modified":1637642470000},{"_id":"themes/icarus/layout/layout.jsx","hash":"3560755571d6fb670bcd706889f618f4879a15be","modified":1637642470000},{"_id":"themes/icarus/layout/index.jsx","hash":"0a84a2348394fa9fc5080dd396bd28d357594f47","modified":1637642470000},{"_id":"themes/icarus/layout/page.jsx","hash":"d26c2db57e5a88d6483a03aeb51cda9d191d8cea","modified":1637642470000},{"_id":"themes/icarus/layout/tags.jsx","hash":"2c42cb64778235dd220c563a27a92108ddc50cc4","modified":1637642470000},{"_id":"themes/icarus/layout/post.jsx","hash":"d26c2db57e5a88d6483a03aeb51cda9d191d8cea","modified":1637642470000},{"_id":"themes/icarus/scripts/index.js","hash":"0c666db6fcb4ffc4d300f4e108c00ee42b1cbbe6","modified":1637642470000},{"_id":"themes/icarus/include/migration/head.js","hash":"269ba172013cbd2f10b9bc51af0496628081329b","modified":1637642470000},{"_id":"themes/icarus/layout/tag.jsx","hash":"d2f18cac32ca2725d34ccff3f2051c623be6c892","modified":1637642470000},{"_id":"themes/icarus/include/migration/v3_v4.js","hash":"9faf2184d7fe87debfbe007f3fc9079dcbcafcfe","modified":1637642470000},{"_id":"themes/icarus/include/migration/v2_v3.js","hash":"3ccb2d2ce11018bebd7172da66faecc3983bff00","modified":1637642470000},{"_id":"themes/icarus/include/schema/config.json","hash":"ac633f9d349bca4f089d59d2c3738b57376f1b31","modified":1637642470000},{"_id":"themes/icarus/include/style/article.styl","hash":"f080d0858b26d732815c54ef484b25e36562db1d","modified":1637642470000},{"_id":"themes/icarus/include/style/base.styl","hash":"25f387d373a718d8cb7ec0e4ae5d6d12aef53c95","modified":1637642470000},{"_id":"themes/icarus/include/style/button.styl","hash":"0fb35b4786be1b387c751fa2849bc71523fcedd4","modified":1637642470000},{"_id":"themes/icarus/include/style/codeblock.styl","hash":"30bee4cf6792e9665eb648cc20b352d9eaff1207","modified":1637642470000},{"_id":"themes/icarus/include/style/donate.styl","hash":"8d0af00628c13134b5f30a558608e7bebf18c2ec","modified":1637642470000},{"_id":"themes/icarus/include/style/card.styl","hash":"e1fb16b1c98f97791e1aba177d77e309d4503e40","modified":1637642470000},{"_id":"themes/icarus/include/style/helper.styl","hash":"9f3393e6122cc9f351091bfab960674e962da343","modified":1637642470000},{"_id":"themes/icarus/include/style/navbar.styl","hash":"ecc73c8ad504c0fa4bb910eb51500c14e0a8d662","modified":1637642470000},{"_id":"themes/icarus/include/style/pagination.styl","hash":"b81bcd7ff915b4e9299533addc01bc4575ec35e3","modified":1637642470000},{"_id":"themes/icarus/include/style/footer.styl","hash":"a4ad715dee38b249538ac6cce94efc9b355a904b","modified":1637642470000},{"_id":"themes/icarus/include/style/plugin.styl","hash":"679b61b5fc5b3281735a21c37aeb64229d9c51ea","modified":1637642470000},{"_id":"themes/icarus/include/style/search.styl","hash":"416737e1da4e7e907bd03609b0fee9e2aacfe56c","modified":1637642470000},{"_id":"themes/icarus/include/style/timeline.styl","hash":"ea61798a09bffdda07efb93c2ff800b63bddc4c4","modified":1637642470000},{"_id":"themes/icarus/include/style/widget.styl","hash":"2fc5e9db1c32ec6fec2af7d68805b600167cfd23","modified":1637642470000},{"_id":"themes/icarus/include/util/console.js","hash":"59cf9d277d3ac85a496689bd811b1c316001641d","modified":1637642470000},{"_id":"themes/icarus/layout/common/article.jsx","hash":"451bd5f0c21206ba88e9c4ed537f813899c66f5f","modified":1637642470000},{"_id":"themes/icarus/layout/common/comment.jsx","hash":"427089c33002707b76e2f38709459a6824fd0f9b","modified":1637642470000},{"_id":"themes/icarus/layout/common/donates.jsx","hash":"889fb0a7ccc502f0a43b4a18eb330e351e50493c","modified":1637642470000},{"_id":"themes/icarus/layout/common/footer.jsx","hash":"d18765e8e51bdb2ce9739d0fb7afd58126c09b65","modified":1637642470000},{"_id":"themes/icarus/layout/common/head.jsx","hash":"5625c4040a885aaf150f35fe9d07d844d7f94a27","modified":1637642470000},{"_id":"themes/icarus/layout/common/navbar.jsx","hash":"8a6e3668ff4e2781b9bd8fd188a725baec911832","modified":1637642470000},{"_id":"themes/icarus/layout/common/plugins.jsx","hash":"f6826c1a5f5f59f4a0aa00c63bdb0ad4ff4eab69","modified":1637642470000},{"_id":"themes/icarus/layout/common/scripts.jsx","hash":"a4effccf5d6c2d1666d5b34a246df4371771068e","modified":1637642470000},{"_id":"themes/icarus/layout/common/search.jsx","hash":"6f244a37293031670a2964fe424ecd062e591d7b","modified":1637642470000},{"_id":"themes/icarus/include/style/responsive.styl","hash":"8aa466b17165e6a61ce840d18bda295e950b7bb2","modified":1637642470000},{"_id":"themes/icarus/layout/common/share.jsx","hash":"c9fb0319ad5e5a10ad3636b26a6c2afed14c590f","modified":1637642470000},{"_id":"themes/icarus/layout/common/widgets.jsx","hash":"dafa2b72281e98b33916bdff248841cdaa886711","modified":1637642470000},{"_id":"themes/icarus/layout/plugin/animejs.jsx","hash":"e2aa27c3501a58ef1e91e511557b77395c2c02aa","modified":1637642470000},{"_id":"themes/icarus/layout/plugin/back_to_top.jsx","hash":"7fc0c5aaabd7d0eaff04cb68ec139442dc3414e8","modified":1637642470000},{"_id":"themes/icarus/layout/widget/profile.jsx","hash":"0d3e635c646c56daf85ac3bbd6466d83d6eb08ca","modified":1637642470000},{"_id":"themes/icarus/source/css/cyberpunk.styl","hash":"ae17d3528df0c3f089df14a06b7bd82f1bc5fed9","modified":1637642470000},{"_id":"themes/icarus/source/css/default.styl","hash":"cbd8d6b0a81746c834c118d403d1aa73860a9ae6","modified":1637642470000},{"_id":"themes/icarus/source/css/night.styl","hash":"89a714ae844e70ed4ffe95af656ec32f337c2436","modified":1637642470000},{"_id":"themes/icarus/source/css/style.styl","hash":"5b9815586e993a6ccbe8cdcfc0c65ea38fc315ac","modified":1637642470000},{"_id":"themes/icarus/source/img/favicon.png","hash":"2304ae3ecae3c12fa5f6e9d6cc1b6e6978b86337","modified":1637642470000},{"_id":"themes/icarus/source/img/logo.png","hash":"b38c11c6fd8eb6c2404892a9245f177f27b5df00","modified":1637642470000},{"_id":"themes/icarus/source/img/razor-bottom-black.svg","hash":"52bff9d6530d07cb72ea9701f63269b56248f319","modified":1637642470000},{"_id":"themes/icarus/source/img/razor-top-black.svg","hash":"660a839e19e7abb49c7650455096fb7d53536ce5","modified":1637642470000},{"_id":"themes/icarus/source/js/.eslintrc.json","hash":"6bf0641cb69dffac97f69baea192d7fa3ab612cb","modified":1637642470000},{"_id":"themes/icarus/source/js/animation.js","hash":"7196b0815db2acec2aa870b1cd9de9e45d899ac6","modified":1637642470000},{"_id":"themes/icarus/source/js/back_to_top.js","hash":"d91f10c08c726135a13dfa1f422c49d8764ef03f","modified":1637642470000},{"_id":"themes/icarus/source/js/column.js","hash":"0baee024ab67474c073a4c41b495f3e7f0df4505","modified":1637642470000},{"_id":"themes/icarus/source/js/main.js","hash":"37f6b66202b3abf2c2a89b8323117c438218f039","modified":1637642470000},{"_id":"themes/icarus/source/js/mathjax-config.js","hash":"3ec03191aee3031b16f097a90f9282740b78c620","modified":1637642470000},{"_id":"themes/icarus/source/js/night.js","hash":"8f9a4dd8ccf0657151d283772bb09a0b530c7b3b","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/comment.json","hash":"7d744391a8abee9a2c450b6fdd36a3866a488025","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/donates.json","hash":"ae86e6f177bedf4afbe638502c12635027539305","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/footer.json","hash":"6edd86c06bc936c90a7f98cf722153eceb8ca6c8","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/head.json","hash":"98889f059c635e6bdbd51effd04cf1cf44968a66","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/navbar.json","hash":"6691e587284c4cf450e0288680d5ff0f3565f090","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/plugins.json","hash":"6036a805749816416850d944f7d64aaae62e5e75","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/providers.json","hash":"97ec953d497fb53594227ae98acaef8a8baa91da","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/search.json","hash":"985fbcbf47054af714ead1a124869d54f2a8b607","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/share.json","hash":"cf4f9ff4fb27c3541b35f57db355c228fa6873e4","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/sidebar.json","hash":"eb241beaec4c73e3085dfb3139ce72e827e20549","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/widgets.json","hash":"cadd9dc942740ecd5037d3943e72f8b6a8399bbe","modified":1637642470000},{"_id":"themes/icarus/include/schema/misc/poly_links_ext.json","hash":"2d87ea66da7ce70b62962907cf4edd1b5a7b5608","modified":1637642470000},{"_id":"themes/icarus/include/schema/plugin/animejs.json","hash":"e62ab6e20bd8862efa1ed32e7c0db0f8acbcfdec","modified":1637642470000},{"_id":"themes/icarus/include/schema/plugin/back_to_top.json","hash":"dc0febab7e7b67075d0ad3f80f5ec8b798b68dea","modified":1637642470000},{"_id":"themes/icarus/include/schema/widget/profile.json","hash":"690ee1b0791cab47ea03cf42b5b4932ed2aa5675","modified":1637642470000},{"_id":"themes/icarus/include/schema/common/article.json","hash":"8d78149f44629d0848921c6fb9c008b03cef3116","modified":1637642470000},{"_id":"themes/icarus/source/img/alipay.JPG","hash":"dbc4a7854afd6c2a7e42869b9b0ddb5b1a43866c","modified":1637642470000},{"_id":"themes/icarus/source/img/avatar.jpeg","hash":"2e0292c1c732603f100636e5ffb7a41d8b772f68","modified":1637642470000},{"_id":"themes/icarus/source/img/wechatpay.JPG","hash":"1d840127f10a0a6dc0b0d6b10e1d6eeb30ad2321","modified":1637642470000},{"_id":"public/js/algolia.js","hash":"a8df0c0abeeb4ee1d2d720161f3aea7339380704","modified":1667028955722},{"_id":"public/js/google_cse.js","hash":"1a9881669dfdeb2b3214074eee0d3e01e52db2c4","modified":1667028955722},{"_id":"public/js/insight.js","hash":"86bbdb7305d9bf19ad62d2ca2cf169fc8d9f9d31","modified":1667028955722},{"_id":"public/js/toc.js","hash":"da6fb757a1b083b8ed138bf29aad3a7bf8ec4f11","modified":1667028955722},{"_id":"public/content.json","hash":"7b5bd8be9e66b6a18a6465009abee2ebc6ee1587","modified":1667028955722},{"_id":"public/manifest.json","hash":"d3f4f67328e2b74df875caa937f66c52d57c4e9b","modified":1667028955722},{"_id":"public/2022/05/08/dsa-8/index.html","hash":"63c434c2ec8bb40e8c2c5880bfd7def6c434b513","modified":1667028955722},{"_id":"public/2022/04/12/dsa-7/index.html","hash":"ef8cd252cd9e8a2e3f6127964303873a4bab6b44","modified":1667028955722},{"_id":"public/2022/04/09/dsa-6/index.html","hash":"1b790f5ec70c1c128920182c8b44f8ee60e6c856","modified":1667028955722},{"_id":"public/2022/03/25/dsa-5/index.html","hash":"4d5e0c0fe31971a1642448c4ee9595202f7124e4","modified":1667028955722},{"_id":"public/2022/03/22/dsa-4/index.html","hash":"e85a31edeff4fb7968460a7bb004ceea8571b17f","modified":1667028955722},{"_id":"public/2022/03/17/dsa-3/index.html","hash":"4f9c6cebaaf30194c5d09cd8387f014d398be88d","modified":1667028955722},{"_id":"public/2022/03/13/dsa-2/index.html","hash":"28117362698e7bb3d03e69b6c7e7f1d29c33be98","modified":1667028955722},{"_id":"public/2022/03/10/dsa-1/index.html","hash":"6b713cfc64c276c52d43807674321d20b627ac8c","modified":1667028955722},{"_id":"public/2021/09/16/acc_cpp笔记/index.html","hash":"fce17124a26032eb2ccd22b45c43e379f0480521","modified":1667028955722},{"_id":"public/2021/08/27/瘦子增重教程/index.html","hash":"0f5835cad1d26871897557d4fc02fdb1b92586b4","modified":1667028955722},{"_id":"public/2021/08/23/Hexo主题Icarus的自定义/index.html","hash":"3c2a58379ee72617f5c07ce9ef95849d9640a902","modified":1667028955722},{"_id":"public/2021/08/22/Icarus消息框模板/index.html","hash":"809e24c3e8e0a157eb6226a15f36bec205c4f940","modified":1667028955722},{"_id":"public/2021/08/19/解决幻16睡眠自动唤醒问题与电源管理配置/index.html","hash":"bbf1fffbb56eb052653a439b787517c9269d4451","modified":1667028955722},{"_id":"public/2021/08/16/Hexo的安装和自动部署/index.html","hash":"44bdd75bc788e853f3f979b9d49712c44248c07d","modified":1667028955722},{"_id":"public/2020/02/23/RLSummary6/index.html","hash":"b260e959afb2f484a97910c431f7f1c0b0b8e24f","modified":1667028955722},{"_id":"public/2020/02/19/RLSummary5/index.html","hash":"2261c5b6e5cfbf391d16abed0d6e4282d0d3d8a6","modified":1667028955722},{"_id":"public/2020/02/16/RLSummary4/index.html","hash":"d34bac078d2205bcc85ac9bea02497e37a981a21","modified":1667028955722},{"_id":"public/2020/02/14/HP_Envy-13_ad024TU_Hackintosh/index.html","hash":"0325552ee4b870021c8bfbc06d30b2f9f5671378","modified":1667028955722},{"_id":"public/2020/02/14/Introduction_to_hackintosh/index.html","hash":"c1050b86eaa5daf45b01fab4a36e090e985747a2","modified":1667028955722},{"_id":"public/2020/02/01/RLSummary3/index.html","hash":"4273b363310873a32c0cad8bd9c903761cfa5aef","modified":1667028955722},{"_id":"public/2020/01/18/RLSummary2/index.html","hash":"975af3bc7766692a09a659702c89ece92d7b5cd1","modified":1667028955722},{"_id":"public/2020/01/17/RLSummary1/index.html","hash":"1367fe93dd229adf5403c9931cb69a8d648ca535","modified":1667028955722},{"_id":"public/2020/01/15/AirSimMultirotorAPIs/index.html","hash":"1feef3238dddd3c1853479ac834251a98c2a53a0","modified":1667028955722},{"_id":"public/2020/01/08/华为云+nginx服务器搭建总结/index.html","hash":"5c6d1c0b619813e06c46f3b4c94a33c9aca6eb0c","modified":1667028955722},{"_id":"public/2020/01/06/Python学习笔记/index.html","hash":"f3e43f02c2466b94b2bd15504ff6958fddc7fcbf","modified":1667028955722},{"_id":"public/2020/01/03/About/index.html","hash":"744de39b5f5b9e6963ca4b35cc58295924bc13fa","modified":1667028955722},{"_id":"public/categories/CS/index.html","hash":"588d48b62c3ec71059d0af0dc4fc5957992d78a3","modified":1667028955722},{"_id":"public/2020/01/03/Gallery/index.html","hash":"cee17043f9c3191df0a231988796fa25a27066a7","modified":1667028955722},{"_id":"public/categories/CS/page/2/index.html","hash":"f389624ae6bd7682171b5a99a47a7fec0f11ead5","modified":1667028955722},{"_id":"public/categories/Others/index.html","hash":"c08f1535e9a0a4c890a3e35b2ee6c4c72926f814","modified":1667028955722},{"_id":"public/categories/Hackintosh/index.html","hash":"2196d20fc3252f667e407f690528d195d660ed93","modified":1667028955722},{"_id":"public/archives/index.html","hash":"bd565e790f07f028d8bf32f6cdd358d9f108e889","modified":1667028955722},{"_id":"public/archives/page/2/index.html","hash":"e243377525c6b8e2acf3cb29b21e085624253c5e","modified":1667028955722},{"_id":"public/archives/page/3/index.html","hash":"84a37933eb254d48a216b81948b958b790a6011c","modified":1667028955722},{"_id":"public/archives/2020/index.html","hash":"31075f418f5519a52f6bd8e876ae8b7d5fe562b4","modified":1667028955722},{"_id":"public/archives/2020/page/2/index.html","hash":"3d762e5e55d329287653d8d67be560e42058b234","modified":1667028955722},{"_id":"public/archives/2020/01/index.html","hash":"3d4febb6a1f0315a92f2a85b6c96dbb457118e07","modified":1667028955722},{"_id":"public/archives/2020/02/index.html","hash":"c7fe42c77ada4bcbd444c9860f2682403ea77ab8","modified":1667028955722},{"_id":"public/archives/2021/index.html","hash":"c25da551a0b81255566aca8ff1e36cf08604e0ba","modified":1667028955722},{"_id":"public/archives/2021/08/index.html","hash":"144472b962958f3b0e9b032b7274058ca9bbb747","modified":1667028955722},{"_id":"public/archives/2021/09/index.html","hash":"2973901de104026e58a70eac7f72431b4af74568","modified":1667028955722},{"_id":"public/archives/2022/index.html","hash":"9162c29811fe04f202000ba953c0e9c851413275","modified":1667028955722},{"_id":"public/archives/2022/03/index.html","hash":"58a90ff59f9e3fb35c190638b4a5193ffd688634","modified":1667028955722},{"_id":"public/archives/2022/04/index.html","hash":"3ce528741e682a3ffe11808e594745cb257f4aae","modified":1667028955722},{"_id":"public/archives/2022/05/index.html","hash":"eeded7613e931acd2b1414c41bdc1c48d807be72","modified":1667028955722},{"_id":"public/index.html","hash":"d492d7bcc788b834c29bf789bccb524408989f5b","modified":1667028955722},{"_id":"public/page/3/index.html","hash":"342096810d1db0b56dd3a072ef58a11356985d67","modified":1667028955722},{"_id":"public/page/2/index.html","hash":"7b34137719409b5f3644a158ff3f078d31a2c4eb","modified":1667028955722},{"_id":"public/tags/AirSim/index.html","hash":"732e77987426a3dd711e5ddadeec79edd3457734","modified":1667028955722},{"_id":"public/tags/Research/index.html","hash":"63d9e8fedf7079a093c8a4fea16d4cf209c4a09e","modified":1667028955722},{"_id":"public/tags/Python/index.html","hash":"362fac33a8085d5c8dea8f61bd7f9c3ef4bba964","modified":1667028955722},{"_id":"public/tags/Photos/index.html","hash":"516392d4ab8e3a2c0a9e8116581c38c6210e3201","modified":1667028955722},{"_id":"public/tags/Astrophotography/index.html","hash":"e5084409f39c68d4b31b8cc28beca6d749665ca3","modified":1667028955722},{"_id":"public/tags/Life/index.html","hash":"dd03aa7caf77d2e1fb74f863e8da9e1e1900c5e4","modified":1667028955722},{"_id":"public/tags/Others/index.html","hash":"7011b3d0e1a56a8aec2f1ad1ab5b7ee29a56ee7d","modified":1667028955722},{"_id":"public/tags/Astrobear/index.html","hash":"6cd8d62008f34864660cdc129d5db8ea4ba6f820","modified":1667028955722},{"_id":"public/tags/macOS/index.html","hash":"947a7335eb153d99970f3bf5614ac7cbdf24739d","modified":1667028955722},{"_id":"public/tags/Hackintosh/index.html","hash":"b615669f42a8e2916bf392e4afa420f126f97ca9","modified":1667028955722},{"_id":"public/tags/HP/index.html","hash":"309bbddb32183cc2b73312a544b770c7ffdcdc38","modified":1667028955722},{"_id":"public/tags/Hexo/index.html","hash":"e20a30a2d0468985474914974c2f9a817eb09d5b","modified":1667028955722},{"_id":"public/tags/Travis-CI/index.html","hash":"e2b727eff54db1be57148321c1b2f6a44b605e15","modified":1667028955722},{"_id":"public/tags/Blog/index.html","hash":"e9bdd92de8023c0889866d0b03af04589d6a7a4a","modified":1667028955722},{"_id":"public/tags/Icarus/index.html","hash":"3d88a7662293eca83b98eebfbc3f8e4adaa65770","modified":1667028955722},{"_id":"public/tags/Template/index.html","hash":"012ba4ed6860a0d6cd59de267d828d822d6a23a7","modified":1667028955722},{"_id":"public/tags/Programming-Language/index.html","hash":"693c785704cfdf6b67876f097ba5594628908d0b","modified":1667028955722},{"_id":"public/tags/RL/index.html","hash":"4d63b09d6b6a79d536208bea323fd372d4d75c5e","modified":1667028955722},{"_id":"public/tags/C/index.html","hash":"9c3b098a45454208b0790902885dbee49e7d9871","modified":1667028955722},{"_id":"public/tags/Data-Structure/index.html","hash":"3033719e829549f005f068b0d4277889d8458791","modified":1667028955722},{"_id":"public/tags/Algorithm/index.html","hash":"0d55bd0d32f380a94740e9444a5f75dbc89cefcf","modified":1667028955722},{"_id":"public/tags/Nginx/index.html","hash":"9a31c00fa45c55aca388dea910109089489e0927","modified":1667028955722},{"_id":"public/tags/Server/index.html","hash":"e7db4b660854ad95c5a13b35eece9208a5d6a0d2","modified":1667028955722},{"_id":"public/tags/Exercise/index.html","hash":"b31280d5b6c9e7a17402117e93a4edd3735fefc1","modified":1667028955722},{"_id":"public/tags/Windows-10/index.html","hash":"05ea294ef557fcbd7586784ac48905d73972205b","modified":1667028955722},{"_id":"public/tags/ROG/index.html","hash":"b0acc8ef850651ec15d3ec2be06be89179a2d22a","modified":1667028955722},{"_id":"public/categories/index.html","hash":"64cfca79f0792d596d5f4e2748c5060c68aef6cd","modified":1667028955722},{"_id":"public/tags/index.html","hash":"d1f38e5422840e32f5f40d3667c967ae5899cf14","modified":1667028955722},{"_id":"public/img/logo.png","hash":"b38c11c6fd8eb6c2404892a9245f177f27b5df00","modified":1667028955722},{"_id":"public/img/favicon.png","hash":"2304ae3ecae3c12fa5f6e9d6cc1b6e6978b86337","modified":1667028955722},{"_id":"public/img/razor-top-black.svg","hash":"660a839e19e7abb49c7650455096fb7d53536ce5","modified":1667028955722},{"_id":"public/img/razor-bottom-black.svg","hash":"52bff9d6530d07cb72ea9701f63269b56248f319","modified":1667028955722},{"_id":"public/img/alipay.JPG","hash":"dbc4a7854afd6c2a7e42869b9b0ddb5b1a43866c","modified":1667028955722},{"_id":"public/css/night.css","hash":"1116fce61cf67cd829b062dc38aef8aba0955149","modified":1667028955722},{"_id":"public/js/animation.js","hash":"7196b0815db2acec2aa870b1cd9de9e45d899ac6","modified":1667028955722},{"_id":"public/js/back_to_top.js","hash":"d91f10c08c726135a13dfa1f422c49d8764ef03f","modified":1667028955722},{"_id":"public/js/mathjax-config.js","hash":"3ec03191aee3031b16f097a90f9282740b78c620","modified":1667028955722},{"_id":"public/js/main.js","hash":"37f6b66202b3abf2c2a89b8323117c438218f039","modified":1667028955722},{"_id":"public/js/column.js","hash":"0baee024ab67474c073a4c41b495f3e7f0df4505","modified":1667028955722},{"_id":"public/js/night.js","hash":"8f9a4dd8ccf0657151d283772bb09a0b530c7b3b","modified":1667028955722},{"_id":"public/css/cyberpunk.css","hash":"8ed0b9b8d931ba7ec61c99071ee8f6ad4724d0fb","modified":1667028955722},{"_id":"public/css/default.css","hash":"c409df9969976b8729740beeddefd451609ead24","modified":1667028955722},{"_id":"public/css/style.css","hash":"bf929e22d103406fb592fa78b598ebddb0faf6c0","modified":1667028955722},{"_id":"public/img/avatar.jpeg","hash":"2e0292c1c732603f100636e5ffb7a41d8b772f68","modified":1667028955722},{"_id":"public/img/wechatpay.JPG","hash":"1d840127f10a0a6dc0b0d6b10e1d6eeb30ad2321","modified":1667028955722}],"Category":[{"name":"CS","_id":"cl9tlzyzp00041q3966ug23zb"},{"name":"Others","_id":"cl9tlzyzs00081q39fe8oawdg"},{"name":"Hackintosh","_id":"cl9tlzyzu000c1q394c486gzi"}],"Data":[],"Page":[],"Post":[{"title":"APIs of Multirotor in Airsim","date":"2020-01-15T15:40:00.000Z","cover":"https://cn.bing.com/th?id=OIP.o6vbAWXSs3ffmE8NXNaZ4QHaEM&pid=Api&rs=1","thumbnail":"https://cn.bing.com/th?id=OIP.o6vbAWXSs3ffmE8NXNaZ4QHaEM&pid=Api&rs=1","_content":"\n### APIs of Multirotor in Airsim\n\nby Astrobear\n\n<!-- more -->\n\n#### Preface\n\n- All APIs listed below need to add the suffix `.join()`. Actually, `.join()` is a call on Python's main process to wait for the thread to complete.\n- All APIs listed below has a hidden parameter, which is `vehicle_name`. If you have more than one vehicle in the environment, please indicate the name of the vehicle that need to be operated clearly.\n- This documention is still not very completed. If you have any advice or if you find any mistake, just comment at the end of the article.\n\n#### Control APIs\n\n**`takeoffAsync(timeout_sec)`**: the multirotor will take off when this command is being executed. \n\n- `timeout_sec`: take off time, second. Better to greater than 3s but less than 10s.\n\n`hoverAsync()`: the multirotor will maintain its attitude when executed.\n\n**`landAsync(timeout_sec)`**: the multirotor will land when executed.\n\n- `timeout_sec`: landing time, second. The default setting is 60s. If the altitude of the multirotor is too high, it may lose control and crash after the landing process lasting for more than 60s. It is recommended that you should make the multirotor descend to a reasonable altitude before starting the landing process.\n\n**`goHomeAsync(timeout_sec)`**: the multirotor will fly back to its starting point automatically.\n\n- `timeout_sec`: travel time, seconds. This process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.\n\n**`moveByAngleZAsync(pitch, roll, z, yaw, duration)`**: change the attitude of the multirotor and than change its movement.\n\n- `pitch`: angle of pitch, radian.\n- `roll`: angle of roll, radian.\n- `z`: flight altitude, meter. Due to the NED coordinate system used in AirSim, the negative number means the positive altitude above the ground in reality. Similarity hereinafter.\n- `yaw`: angle of yaw, radian.\n- `duration`: the time for the multirotor to keep the given attitude, second. If there are no commands after duration time, the multirotor will maintain its previous given attitude and keep moving. You can use this API once again to set the multirotor to a horizontal attitude. However, it will still move due to the inertia.\n\n**`moveByAngleThrottleAsync(pitch, roll, throttle, yaw_rate, duration)`**: change the attitude of the multirotor and than change its movement.\n\n- `pitch`: angle of pitch, radian.\n- `roll`: angle of roll, radian.\n- `throttle`: throttle, ranges between 0 and 1. When the throttle is set to 0, the multirotor will lose its power and crash. Value 1 is its maximum power.\n- `yaw_rate`: angular velocity at yaw axis, radian per second.\n- `duration`: the time for the multirotor to keep the given attitude, second. The multirotor will automatically stop moving after duration time.\n\n**`moveByVelocityAsync(vx, vy, vz, duration, drivetrain, yaw_mode)`**: change the velocity of the multirotor.\n\n- `vx`: velocity projected at x axis, meter per second.\n- `vy`: velocity projected at y axis, meter per second.\n- `vz`: velocity projected at z axis, meter per second.\n- `duration`: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.\n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n\n**`moveByVelocityZAsync(vx, vy, z, duration, drivetrain, yaw_mode)`**: change the velocity at horizontal plane and the altitude of multirotor.\n\n- `vx`: velocity projected at x axis, meter per second.\n- `vy`: velocity projected at y axis, meter per second.\n- `z`: flight altitude, meter.\n- `duration`: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.\n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n\n**`moveOnPathAsync(path, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)`**: the multirotor will fly according to several given coordinates.\n\n- `path`: a `Vector3r` array, which provides the route coordinates, meter. The form of it is `[airsim.Vector3r(x, y, z), ...]`.\n- `velocity`: flight velocity when traveling, meter per second.\n- `timeout_sec`: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty. \n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n- `lookahead`: the default value is `-1`.\n- `adaptive_lookahead`: the default value is `1`.\n\n**`moveToPositionAsync(x, y, z, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)`**: the multirotor will fly to given location when executed. After it reach the destination, it will automatically stop.\n\n- `x`: distance projected at x axis, meter.\n- `y`: distance projected at y axis, meter.\n- `z`: flight altitude, meter.\n- `velocity`: flight velocity when flying to the destination, meter per second.\n- `timeout_sec`: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.\n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n- `lookahead`: the default value is `-1`.\n- `adaptive_lookahead`: the default value is `1`.\n\n**`moveToZAsync(z, velocity, timeout_sec, yaw_mode, lookahead, adaptive_lookahead)`**: the multirotor will vertically climb to the given altitude and automatically stop and maintain the altitude when reached.\n\n- `z`: flight altitude, meter.\n- `velocity`: flight velocity when flying to the destination, meter per second.\n- `timeout_sec`: climbing time, second. The process will end when the climbing time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we scan let this parameter empty.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n- `lookahead`: the default value is `-1`.\n- `adaptive_lookahead`: the default value is `1`.\n\n**`rotateByYawRateAsync(yaw_rate, duration)`**: the multirotor will yaw at the given yaw rate.\n\n- `yaw_rate`: yawing angular velocity, degree per second. \n- `duration`: the time for the multirotor to keep the given yawing angular velocity, second. If there are no command after duration time, the multirotor will maintain its previous given yawing angular velocity and keep moving. If you want to stop it, you can use this API once again to set the yawing angular velocity to zero.\n","source":"_posts/AirSimMultirotorAPIs.md","raw":"---\ntitle: APIs of Multirotor in Airsim\ndate: 2020-1-15 23:40:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- AirSim\n\t- Research\n\t- Python\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://cn.bing.com/th?id=OIP.o6vbAWXSs3ffmE8NXNaZ4QHaEM&pid=Api&rs=1\n\nthumbnail: https://cn.bing.com/th?id=OIP.o6vbAWXSs3ffmE8NXNaZ4QHaEM&pid=Api&rs=1\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\n#excerpt: \n\n#You can begin to input your article below now.\n\n---\n\n### APIs of Multirotor in Airsim\n\nby Astrobear\n\n<!-- more -->\n\n#### Preface\n\n- All APIs listed below need to add the suffix `.join()`. Actually, `.join()` is a call on Python's main process to wait for the thread to complete.\n- All APIs listed below has a hidden parameter, which is `vehicle_name`. If you have more than one vehicle in the environment, please indicate the name of the vehicle that need to be operated clearly.\n- This documention is still not very completed. If you have any advice or if you find any mistake, just comment at the end of the article.\n\n#### Control APIs\n\n**`takeoffAsync(timeout_sec)`**: the multirotor will take off when this command is being executed. \n\n- `timeout_sec`: take off time, second. Better to greater than 3s but less than 10s.\n\n`hoverAsync()`: the multirotor will maintain its attitude when executed.\n\n**`landAsync(timeout_sec)`**: the multirotor will land when executed.\n\n- `timeout_sec`: landing time, second. The default setting is 60s. If the altitude of the multirotor is too high, it may lose control and crash after the landing process lasting for more than 60s. It is recommended that you should make the multirotor descend to a reasonable altitude before starting the landing process.\n\n**`goHomeAsync(timeout_sec)`**: the multirotor will fly back to its starting point automatically.\n\n- `timeout_sec`: travel time, seconds. This process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.\n\n**`moveByAngleZAsync(pitch, roll, z, yaw, duration)`**: change the attitude of the multirotor and than change its movement.\n\n- `pitch`: angle of pitch, radian.\n- `roll`: angle of roll, radian.\n- `z`: flight altitude, meter. Due to the NED coordinate system used in AirSim, the negative number means the positive altitude above the ground in reality. Similarity hereinafter.\n- `yaw`: angle of yaw, radian.\n- `duration`: the time for the multirotor to keep the given attitude, second. If there are no commands after duration time, the multirotor will maintain its previous given attitude and keep moving. You can use this API once again to set the multirotor to a horizontal attitude. However, it will still move due to the inertia.\n\n**`moveByAngleThrottleAsync(pitch, roll, throttle, yaw_rate, duration)`**: change the attitude of the multirotor and than change its movement.\n\n- `pitch`: angle of pitch, radian.\n- `roll`: angle of roll, radian.\n- `throttle`: throttle, ranges between 0 and 1. When the throttle is set to 0, the multirotor will lose its power and crash. Value 1 is its maximum power.\n- `yaw_rate`: angular velocity at yaw axis, radian per second.\n- `duration`: the time for the multirotor to keep the given attitude, second. The multirotor will automatically stop moving after duration time.\n\n**`moveByVelocityAsync(vx, vy, vz, duration, drivetrain, yaw_mode)`**: change the velocity of the multirotor.\n\n- `vx`: velocity projected at x axis, meter per second.\n- `vy`: velocity projected at y axis, meter per second.\n- `vz`: velocity projected at z axis, meter per second.\n- `duration`: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.\n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n\n**`moveByVelocityZAsync(vx, vy, z, duration, drivetrain, yaw_mode)`**: change the velocity at horizontal plane and the altitude of multirotor.\n\n- `vx`: velocity projected at x axis, meter per second.\n- `vy`: velocity projected at y axis, meter per second.\n- `z`: flight altitude, meter.\n- `duration`: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.\n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n\n**`moveOnPathAsync(path, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)`**: the multirotor will fly according to several given coordinates.\n\n- `path`: a `Vector3r` array, which provides the route coordinates, meter. The form of it is `[airsim.Vector3r(x, y, z), ...]`.\n- `velocity`: flight velocity when traveling, meter per second.\n- `timeout_sec`: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty. \n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n- `lookahead`: the default value is `-1`.\n- `adaptive_lookahead`: the default value is `1`.\n\n**`moveToPositionAsync(x, y, z, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)`**: the multirotor will fly to given location when executed. After it reach the destination, it will automatically stop.\n\n- `x`: distance projected at x axis, meter.\n- `y`: distance projected at y axis, meter.\n- `z`: flight altitude, meter.\n- `velocity`: flight velocity when flying to the destination, meter per second.\n- `timeout_sec`: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.\n- `drivetrain`: the default value is `airsim.DrivetrainType.MaxDegreeOfFreedom`, it can also be set as `airsim.DrivetrainType.ForwardOnly`.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n- `lookahead`: the default value is `-1`.\n- `adaptive_lookahead`: the default value is `1`.\n\n**`moveToZAsync(z, velocity, timeout_sec, yaw_mode, lookahead, adaptive_lookahead)`**: the multirotor will vertically climb to the given altitude and automatically stop and maintain the altitude when reached.\n\n- `z`: flight altitude, meter.\n- `velocity`: flight velocity when flying to the destination, meter per second.\n- `timeout_sec`: climbing time, second. The process will end when the climbing time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we scan let this parameter empty.\n- `yaw_mode`: the default value is `airsim.YawMode(is_rate=True, yaw_or_rate=0.0)`, it can also be set as `airsim.YawMode(is_rate=False, yaw_or_rate=0.0)`. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.\n- `lookahead`: the default value is `-1`.\n- `adaptive_lookahead`: the default value is `1`.\n\n**`rotateByYawRateAsync(yaw_rate, duration)`**: the multirotor will yaw at the given yaw rate.\n\n- `yaw_rate`: yawing angular velocity, degree per second. \n- `duration`: the time for the multirotor to keep the given yawing angular velocity, second. If there are no command after duration time, the multirotor will maintain its previous given yawing angular velocity and keep moving. If you want to stop it, you can use this API once again to set the yawing angular velocity to zero.\n","slug":"AirSimMultirotorAPIs","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzf00001q39cp3mcdm8","content":"<h3 id=\"APIs-of-Multirotor-in-Airsim\"><a href=\"#APIs-of-Multirotor-in-Airsim\" class=\"headerlink\" title=\"APIs of Multirotor in Airsim\"></a>APIs of Multirotor in Airsim</h3><p>by Astrobear</p>\n<a id=\"more\"></a>\n\n<h4 id=\"Preface\"><a href=\"#Preface\" class=\"headerlink\" title=\"Preface\"></a>Preface</h4><ul>\n<li>All APIs listed below need to add the suffix <code>.join()</code>. Actually, <code>.join()</code> is a call on Python’s main process to wait for the thread to complete.</li>\n<li>All APIs listed below has a hidden parameter, which is <code>vehicle_name</code>. If you have more than one vehicle in the environment, please indicate the name of the vehicle that need to be operated clearly.</li>\n<li>This documention is still not very completed. If you have any advice or if you find any mistake, just comment at the end of the article.</li>\n</ul>\n<h4 id=\"Control-APIs\"><a href=\"#Control-APIs\" class=\"headerlink\" title=\"Control APIs\"></a>Control APIs</h4><p><strong><code>takeoffAsync(timeout_sec)</code></strong>: the multirotor will take off when this command is being executed. </p>\n<ul>\n<li><code>timeout_sec</code>: take off time, second. Better to greater than 3s but less than 10s.</li>\n</ul>\n<p><code>hoverAsync()</code>: the multirotor will maintain its attitude when executed.</p>\n<p><strong><code>landAsync(timeout_sec)</code></strong>: the multirotor will land when executed.</p>\n<ul>\n<li><code>timeout_sec</code>: landing time, second. The default setting is 60s. If the altitude of the multirotor is too high, it may lose control and crash after the landing process lasting for more than 60s. It is recommended that you should make the multirotor descend to a reasonable altitude before starting the landing process.</li>\n</ul>\n<p><strong><code>goHomeAsync(timeout_sec)</code></strong>: the multirotor will fly back to its starting point automatically.</p>\n<ul>\n<li><code>timeout_sec</code>: travel time, seconds. This process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.</li>\n</ul>\n<p><strong><code>moveByAngleZAsync(pitch, roll, z, yaw, duration)</code></strong>: change the attitude of the multirotor and than change its movement.</p>\n<ul>\n<li><code>pitch</code>: angle of pitch, radian.</li>\n<li><code>roll</code>: angle of roll, radian.</li>\n<li><code>z</code>: flight altitude, meter. Due to the NED coordinate system used in AirSim, the negative number means the positive altitude above the ground in reality. Similarity hereinafter.</li>\n<li><code>yaw</code>: angle of yaw, radian.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given attitude, second. If there are no commands after duration time, the multirotor will maintain its previous given attitude and keep moving. You can use this API once again to set the multirotor to a horizontal attitude. However, it will still move due to the inertia.</li>\n</ul>\n<p><strong><code>moveByAngleThrottleAsync(pitch, roll, throttle, yaw_rate, duration)</code></strong>: change the attitude of the multirotor and than change its movement.</p>\n<ul>\n<li><code>pitch</code>: angle of pitch, radian.</li>\n<li><code>roll</code>: angle of roll, radian.</li>\n<li><code>throttle</code>: throttle, ranges between 0 and 1. When the throttle is set to 0, the multirotor will lose its power and crash. Value 1 is its maximum power.</li>\n<li><code>yaw_rate</code>: angular velocity at yaw axis, radian per second.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given attitude, second. The multirotor will automatically stop moving after duration time.</li>\n</ul>\n<p><strong><code>moveByVelocityAsync(vx, vy, vz, duration, drivetrain, yaw_mode)</code></strong>: change the velocity of the multirotor.</p>\n<ul>\n<li><code>vx</code>: velocity projected at x axis, meter per second.</li>\n<li><code>vy</code>: velocity projected at y axis, meter per second.</li>\n<li><code>vz</code>: velocity projected at z axis, meter per second.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.</li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n</ul>\n<p><strong><code>moveByVelocityZAsync(vx, vy, z, duration, drivetrain, yaw_mode)</code></strong>: change the velocity at horizontal plane and the altitude of multirotor.</p>\n<ul>\n<li><code>vx</code>: velocity projected at x axis, meter per second.</li>\n<li><code>vy</code>: velocity projected at y axis, meter per second.</li>\n<li><code>z</code>: flight altitude, meter.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.</li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n</ul>\n<p><strong><code>moveOnPathAsync(path, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)</code></strong>: the multirotor will fly according to several given coordinates.</p>\n<ul>\n<li><code>path</code>: a <code>Vector3r</code> array, which provides the route coordinates, meter. The form of it is <code>[airsim.Vector3r(x, y, z), ...]</code>.</li>\n<li><code>velocity</code>: flight velocity when traveling, meter per second.</li>\n<li><code>timeout_sec</code>: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty. </li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n<li><code>lookahead</code>: the default value is <code>-1</code>.</li>\n<li><code>adaptive_lookahead</code>: the default value is <code>1</code>.</li>\n</ul>\n<p><strong><code>moveToPositionAsync(x, y, z, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)</code></strong>: the multirotor will fly to given location when executed. After it reach the destination, it will automatically stop.</p>\n<ul>\n<li><code>x</code>: distance projected at x axis, meter.</li>\n<li><code>y</code>: distance projected at y axis, meter.</li>\n<li><code>z</code>: flight altitude, meter.</li>\n<li><code>velocity</code>: flight velocity when flying to the destination, meter per second.</li>\n<li><code>timeout_sec</code>: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.</li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n<li><code>lookahead</code>: the default value is <code>-1</code>.</li>\n<li><code>adaptive_lookahead</code>: the default value is <code>1</code>.</li>\n</ul>\n<p><strong><code>moveToZAsync(z, velocity, timeout_sec, yaw_mode, lookahead, adaptive_lookahead)</code></strong>: the multirotor will vertically climb to the given altitude and automatically stop and maintain the altitude when reached.</p>\n<ul>\n<li><code>z</code>: flight altitude, meter.</li>\n<li><code>velocity</code>: flight velocity when flying to the destination, meter per second.</li>\n<li><code>timeout_sec</code>: climbing time, second. The process will end when the climbing time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we scan let this parameter empty.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n<li><code>lookahead</code>: the default value is <code>-1</code>.</li>\n<li><code>adaptive_lookahead</code>: the default value is <code>1</code>.</li>\n</ul>\n<p><strong><code>rotateByYawRateAsync(yaw_rate, duration)</code></strong>: the multirotor will yaw at the given yaw rate.</p>\n<ul>\n<li><code>yaw_rate</code>: yawing angular velocity, degree per second. </li>\n<li><code>duration</code>: the time for the multirotor to keep the given yawing angular velocity, second. If there are no command after duration time, the multirotor will maintain its previous given yawing angular velocity and keep moving. If you want to stop it, you can use this API once again to set the yawing angular velocity to zero.</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h3 id=\"APIs-of-Multirotor-in-Airsim\"><a href=\"#APIs-of-Multirotor-in-Airsim\" class=\"headerlink\" title=\"APIs of Multirotor in Airsim\"></a>APIs of Multirotor in Airsim</h3><p>by Astrobear</p>","more":"<h4 id=\"Preface\"><a href=\"#Preface\" class=\"headerlink\" title=\"Preface\"></a>Preface</h4><ul>\n<li>All APIs listed below need to add the suffix <code>.join()</code>. Actually, <code>.join()</code> is a call on Python’s main process to wait for the thread to complete.</li>\n<li>All APIs listed below has a hidden parameter, which is <code>vehicle_name</code>. If you have more than one vehicle in the environment, please indicate the name of the vehicle that need to be operated clearly.</li>\n<li>This documention is still not very completed. If you have any advice or if you find any mistake, just comment at the end of the article.</li>\n</ul>\n<h4 id=\"Control-APIs\"><a href=\"#Control-APIs\" class=\"headerlink\" title=\"Control APIs\"></a>Control APIs</h4><p><strong><code>takeoffAsync(timeout_sec)</code></strong>: the multirotor will take off when this command is being executed. </p>\n<ul>\n<li><code>timeout_sec</code>: take off time, second. Better to greater than 3s but less than 10s.</li>\n</ul>\n<p><code>hoverAsync()</code>: the multirotor will maintain its attitude when executed.</p>\n<p><strong><code>landAsync(timeout_sec)</code></strong>: the multirotor will land when executed.</p>\n<ul>\n<li><code>timeout_sec</code>: landing time, second. The default setting is 60s. If the altitude of the multirotor is too high, it may lose control and crash after the landing process lasting for more than 60s. It is recommended that you should make the multirotor descend to a reasonable altitude before starting the landing process.</li>\n</ul>\n<p><strong><code>goHomeAsync(timeout_sec)</code></strong>: the multirotor will fly back to its starting point automatically.</p>\n<ul>\n<li><code>timeout_sec</code>: travel time, seconds. This process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.</li>\n</ul>\n<p><strong><code>moveByAngleZAsync(pitch, roll, z, yaw, duration)</code></strong>: change the attitude of the multirotor and than change its movement.</p>\n<ul>\n<li><code>pitch</code>: angle of pitch, radian.</li>\n<li><code>roll</code>: angle of roll, radian.</li>\n<li><code>z</code>: flight altitude, meter. Due to the NED coordinate system used in AirSim, the negative number means the positive altitude above the ground in reality. Similarity hereinafter.</li>\n<li><code>yaw</code>: angle of yaw, radian.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given attitude, second. If there are no commands after duration time, the multirotor will maintain its previous given attitude and keep moving. You can use this API once again to set the multirotor to a horizontal attitude. However, it will still move due to the inertia.</li>\n</ul>\n<p><strong><code>moveByAngleThrottleAsync(pitch, roll, throttle, yaw_rate, duration)</code></strong>: change the attitude of the multirotor and than change its movement.</p>\n<ul>\n<li><code>pitch</code>: angle of pitch, radian.</li>\n<li><code>roll</code>: angle of roll, radian.</li>\n<li><code>throttle</code>: throttle, ranges between 0 and 1. When the throttle is set to 0, the multirotor will lose its power and crash. Value 1 is its maximum power.</li>\n<li><code>yaw_rate</code>: angular velocity at yaw axis, radian per second.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given attitude, second. The multirotor will automatically stop moving after duration time.</li>\n</ul>\n<p><strong><code>moveByVelocityAsync(vx, vy, vz, duration, drivetrain, yaw_mode)</code></strong>: change the velocity of the multirotor.</p>\n<ul>\n<li><code>vx</code>: velocity projected at x axis, meter per second.</li>\n<li><code>vy</code>: velocity projected at y axis, meter per second.</li>\n<li><code>vz</code>: velocity projected at z axis, meter per second.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.</li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n</ul>\n<p><strong><code>moveByVelocityZAsync(vx, vy, z, duration, drivetrain, yaw_mode)</code></strong>: change the velocity at horizontal plane and the altitude of multirotor.</p>\n<ul>\n<li><code>vx</code>: velocity projected at x axis, meter per second.</li>\n<li><code>vy</code>: velocity projected at y axis, meter per second.</li>\n<li><code>z</code>: flight altitude, meter.</li>\n<li><code>duration</code>: the time for the multirotor to keep the given velocity, second. If there are no command after duration time, the multirotor will maintain its previous given velocity and keep moving. If you want to stop it, you can use this API once again to set the velocity to zero.</li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n</ul>\n<p><strong><code>moveOnPathAsync(path, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)</code></strong>: the multirotor will fly according to several given coordinates.</p>\n<ul>\n<li><code>path</code>: a <code>Vector3r</code> array, which provides the route coordinates, meter. The form of it is <code>[airsim.Vector3r(x, y, z), ...]</code>.</li>\n<li><code>velocity</code>: flight velocity when traveling, meter per second.</li>\n<li><code>timeout_sec</code>: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty. </li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n<li><code>lookahead</code>: the default value is <code>-1</code>.</li>\n<li><code>adaptive_lookahead</code>: the default value is <code>1</code>.</li>\n</ul>\n<p><strong><code>moveToPositionAsync(x, y, z, velocity, timeout_sec, drivetrain, yaw_mode, lookahead, adaptive_lookahead)</code></strong>: the multirotor will fly to given location when executed. After it reach the destination, it will automatically stop.</p>\n<ul>\n<li><code>x</code>: distance projected at x axis, meter.</li>\n<li><code>y</code>: distance projected at y axis, meter.</li>\n<li><code>z</code>: flight altitude, meter.</li>\n<li><code>velocity</code>: flight velocity when flying to the destination, meter per second.</li>\n<li><code>timeout_sec</code>: travel time, second. The process will end when the travel time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we can let this parameter empty.</li>\n<li><code>drivetrain</code>: the default value is <code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>, it can also be set as <code>airsim.DrivetrainType.ForwardOnly</code>.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n<li><code>lookahead</code>: the default value is <code>-1</code>.</li>\n<li><code>adaptive_lookahead</code>: the default value is <code>1</code>.</li>\n</ul>\n<p><strong><code>moveToZAsync(z, velocity, timeout_sec, yaw_mode, lookahead, adaptive_lookahead)</code></strong>: the multirotor will vertically climb to the given altitude and automatically stop and maintain the altitude when reached.</p>\n<ul>\n<li><code>z</code>: flight altitude, meter.</li>\n<li><code>velocity</code>: flight velocity when flying to the destination, meter per second.</li>\n<li><code>timeout_sec</code>: climbing time, second. The process will end when the climbing time is beyond the value whether the multirotor has reached the destination or not. The value of default setting is extremely big, thus we scan let this parameter empty.</li>\n<li><code>yaw_mode</code>: the default value is <code>airsim.YawMode(is_rate=True, yaw_or_rate=0.0)</code>, it can also be set as <code>airsim.YawMode(is_rate=False, yaw_or_rate=0.0)</code>. Please notice that, under the default setting, the multirotor is not able to yaw when executing this command.</li>\n<li><code>lookahead</code>: the default value is <code>-1</code>.</li>\n<li><code>adaptive_lookahead</code>: the default value is <code>1</code>.</li>\n</ul>\n<p><strong><code>rotateByYawRateAsync(yaw_rate, duration)</code></strong>: the multirotor will yaw at the given yaw rate.</p>\n<ul>\n<li><code>yaw_rate</code>: yawing angular velocity, degree per second. </li>\n<li><code>duration</code>: the time for the multirotor to keep the given yawing angular velocity, second. If there are no command after duration time, the multirotor will maintain its previous given yawing angular velocity and keep moving. If you want to stop it, you can use this API once again to set the yawing angular velocity to zero.</li>\n</ul>"},{"title":"Gallery","date":"2020-01-03T15:25:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/t1.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/t1.jpg","excerpt":"Welcome to my gallery!","widgets":[],"_content":"\n> Updating...\n\n<div class=\"justified-gallery\">\n\n\n\n\n![](https://astrobear.top/resource/astroblog/gallery/g1.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g2.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g3.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g4.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g5.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g6.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g7.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g8.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g9.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g10.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g11.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g12.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g13.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g14.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g15.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g16.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g17.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g18.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g19.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g20.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g21.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g22.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g23.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g24.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g25.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g26.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g27.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g28.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g29.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g30.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g31.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g32.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g33.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g34.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g35.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g36.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g37.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g38.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g39.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g41.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g42.jpeg)\n\n</div>","source":"_posts/Gallery.md","raw":"---\ntitle: Gallery\ndate: 2020-1-3 23:25:00\ncategories: \n\t- [Others]\n\t#- [cate2]\n\t#...\ntags: \n\t- Photos\n\t- Astrophotography\n\t- Life\n\t- Others\n\t- Astrobear\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/t1.jpg\n\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/t1.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: Welcome to my gallery!\n\nwidgets: []\n\n#You can begin to input your article below now.\n---\n\n> Updating...\n\n<div class=\"justified-gallery\">\n\n\n\n\n![](https://astrobear.top/resource/astroblog/gallery/g1.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g2.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g3.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g4.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g5.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g6.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g7.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g8.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g9.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g10.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g11.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g12.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g13.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g14.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g15.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g16.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g17.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g18.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g19.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g20.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g21.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g22.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g23.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g24.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g25.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g26.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g27.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g28.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g29.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g30.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g31.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g32.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g33.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g34.jpg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g35.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g36.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g37.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g38.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g39.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g41.jpeg)\n\n![](https://astrobear.top/resource/astroblog/gallery/g42.jpeg)\n\n</div>","slug":"Gallery","published":1,"updated":"2022-08-30T05:01:14.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzk00011q39cmft76d3","content":"<blockquote>\n<p>Updating…</p>\n</blockquote>\n<div class=\"justified-gallery\">\n\n\n\n\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g1.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g2.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g3.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g4.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g5.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g6.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g7.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g8.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g9.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g10.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g11.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g12.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g13.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g14.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g15.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g16.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g17.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g18.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g19.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g20.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g21.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g22.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g23.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g24.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g25.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g26.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g27.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g28.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g29.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g30.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g31.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g32.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g33.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g34.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g35.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g36.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g37.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g38.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g39.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g41.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g42.jpeg\" alt=\"\"></p>\n</div>","site":{"data":{}},"more":"<blockquote>\n<p>Updating…</p>\n</blockquote>\n<div class=\"justified-gallery\">\n\n\n\n\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g1.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g2.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g3.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g4.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g5.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g6.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g7.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g8.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g9.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g10.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g11.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g12.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g13.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g14.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g15.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g16.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g17.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g18.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g19.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g20.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g21.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g22.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g23.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g24.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g25.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g26.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g27.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g28.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g29.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g30.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g31.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g32.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g33.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g34.jpg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g35.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g36.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g37.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g38.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g39.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g41.jpeg\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/gallery/g42.jpeg\" alt=\"\"></p>\n</div>"},{"title":"HP Envy-13 ad024TU黑苹果安装总结","date":"2020-02-14T14:20:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg","excerpt":"黑苹果安装的踩坑记录。","_content":"\n### 请先了解以下内容\n\n本文主要介绍在完成黑苹果的基本安装以后的完善过程。对于黑苹果完全没有概念的朋友，请看[这篇文章]()。而本文是在很早的时候开始写的，并在原基础上不断增添了内容。那时候作者还未对EFI做足够的优化，因此本文在现在看来有一些过时。假如你遇到了文章中出现的类似情况，希望可以给你提供一些解决思路。但是一般来说，如果你的**机型和硬件**与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。\n\n- 作者电脑的EFI存放于这个Github仓库中：[HackintoshForEnvy13-ad0xx](https://github.com/Astrobr/HackintoshForEnvy13-ad0xx)。\n\n- 作者电脑型号为`HP Envy-13 ad024TU`，其中部分文件不建议大家直接用于其他型号的电脑。若使用本仓库中文件导致系统故障或崩溃，作者本人概不负责。\n\n- 作者电脑的网卡和硬盘均作了更换。故即使机型相同，直接套用此EFI依旧可能会产生问题，请知照！\n- 此EFI一开始是来自于交流群中来源不明的Envy-13通用EFI，里面的内容杂乱无章而且有很多不必要的驱动和补丁，但还是可以将机器驱动起来。经过大半年的维护，我对其中的内容作了一些精简，但是其中的方法依旧相对落后和杂乱。现在的这个EFI基本上是基于[SlientSliver](https://github.com/SilentSliver)的[HP-ENVY13-ad1XX-Hackintosh](https://github.com/SilentSliver/HP-ENVY-13-ad1XX-Hackintosh)修改而来，保留了其中的hotpatch部分，更改了一些驱动和补丁。特此鸣谢！\n- 关于本机的功能：\n  - CPU：可以正常变频\n  - 电源：节能五项似乎没有完全加载，但是电池电量显示正常，使用上没有障碍\n  - 显卡：仿冒的`Intel HD Graphics 520`，`ig-platform-id`为`0x19160000`，驱动原生显卡`Intel HD Graphics 620`会产生非常诡异的色阶断层，严重影响观感\n  - 睡眠：正常，以前曾有过睡眠唤醒掉蓝牙的问题，现在已经解决\n  - 声音：使用的`LayoutID`为`03`，只能驱动底面的扬声器，对于这款笔记本电脑来说，两个扬声器和四个扬声器听起来并无什么差别，对音质有追求的请直接外接蓝牙音响或者使用耳机，插入耳机后音量可以自动调节为之前的设置值\n  - 网卡和蓝牙：原配网卡无法使用，我更换为`DW1560`，没有故障出现，Airdrop，HandOff，Sidecar都可以正常使用，可以连接AirPods听音乐并且功能完整\n  - 触控板：加载了白苹果手势，但除了四指手势和力度感应之外其他手势都可以用\n  - 亮度调节：可调，但是档位间隔不大，最低档位的时候屏幕还是较亮\n  - USB接口：四个接口均可正常使用\n  - 摄像头：可用\n  - 读卡器：无法驱动，有需要的建议使用读卡器\n- **声明：仓库中所有文件均可供个人用途和技术交流使用，在转载时请务必标明出处。不得将此仓库中的任何文件用于任何商业活动！**\n\n### 基本安装过程中的一些问题\n\n这部分不是主要内容，但还是讲两句吧。\n\n- 进入不了安装界面：\n\n  首先请确认你安装镜像中的EFI是适用于你的电脑型号的。如果还是不行，请在`Clover`中的`Option`选项中选择`-v`以啰嗦模式启动，这样启动的时候会显示出详细的信息。将最后出现的报错信息拍下来或者整个启动过程录制下来以后，找网友求助吧。\n\n- 安装macOS 10.15的过程中，在啰嗦模式中出现如下图所示报错：![报错内容请注意最后一部分](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_1.JPG)\n\n  ​\t\t请在`Clover`中打上如图所示的这个补丁。![补丁图示](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_2.png)\n\n- 进入安装界面且开始安装一段时间后，无法继续安装：\n\n  请重新下载镜像，在下载完成以后检查镜像的`md5`值是否正确。如正确，再制作你的镜像U盘。\n\n- 对于10.14.x的镜像进入安装界面后提示应用已经损坏，无法安装：\n\n  请将你的bios时间往前调整至2019年10月25日以前，但是不要调整得太久远。这是因为旧的镜像中的证书会在上述时间以后过期导致无法安装。\n\n### 后续完善中的一些问题\n\n在安装完成以后，便可以进入系统了。但是这个时候的系统还是非常不完善的，需要做很多调整。进入系统后，先在 `关于本机-系统报告`中检查各个硬件项目是否被成功驱动，然后再根据没有成功驱动的项目，安装相对应的驱动或者打必要的补丁。但是前文说过：如果你的**机型和硬件**与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。\n\n如果使用的是与作者相同型号的电脑（型号完全一致，且未更换过任何硬件），以下项目是有故障的\n\n- 网卡未被驱动，无法上网\n- 蓝牙未驱动，无法使用蓝牙\n- Siri, iMessage, FaceTime, HandOff无法使用\n\n以下项目有可能出现故障：\n\n- 声卡未驱动，没有声音，也无法录音\n- 无法调节显示器亮度，在`系统偏好设置`中也没有调节亮度的拖动条\n- 触控板未被驱动，无法使用触控板\n\n因此，仅仅完成了系统的安装是远远不够的。此时我们的电脑还无法被称为生产力工具。下面就介绍一些解决故障的办法以及系统优化的办法。\n\n- 首先应当获取软件安装权限，只有在此以后你才可以安装非App Store下载的，或者由非受信任的开发者开发的软件：\n\n  在终端中输入：`sudo spctl --master-disable`\n\n- 建议安装的软件：\n\n  - `Clover Configurator`：用于修改`Clover`的配置文件`config.plist`\n  - `Hackintool`：功能强大的黑苹果配置工具\n  - `Kext Utility`：用于重建缓存\n  - `CPU-S`：用于测试CPU变频档位\n  - `MaciASL`：用于修改SSDT\n\n  这些软件可以通过这个[百度云链接](https://pan.baidu.com/s/12Kp9dv8HkVgm1VoVeXmC8w)下载。密码：57qf。\n\n- 机型选择：\n\n  使用`Clover Configurator`打开`config.plist`，确保在`机型设置`中选择`MacBook Pro 14,1`。关于机型的选择，原则上是需要将你的电脑的集成显卡的型号与所选机型的集成显卡型号对应起来的，否则无法驱动你的显卡。具体的选择参见：[黑苹果必备：Intel核显platform ID整理及smbios速查表](https://blog.daliansky.net/Intel-core-display-platformID-finishing.html)。\n\n- 驱动的正确安装方法：\n\n  如果驱动没有正确安装，有极大的可能性会导致重启之后无法进入系统。作者本人就在这个问题上吃了很大的亏。关于驱动的安装，分为两种情况。\n\n  - 操作的是`/EFI/CLOVER/kexts/Other`中的驱动文件。对于这种情况，不需要重建缓存。\n\n  - 操作的是`/Library/Extensions`或者`/System/Library/Extensions`中的驱动文件。如果操作的是这个两个文件夹中的驱动文件，则需要重建缓存。可以通过`Kext Utility`软件或者使用终端命令行来重建缓存。\n\n  重建缓存的命令：`sudo kextcache -i /`。\n\n- 关于网络：\n\n  对于使用安装了Intel（或者其他某些品牌）的网卡的电脑的朋友们，进入黑苹果系统以后网卡是没有驱动的，也就是说这个时候电脑是没有办法上网的。若是电脑安装了某些型号的免驱网卡，在macOS系统下电脑就可以直接连接网络。一般来说，如果不想拆机，可以使用USB网卡。但是使用USB网卡无法使用Siri, iMessage, FaceTime, HandOff等功能。\n\n  **对于Intel的网卡，目前在macOS下是没有很好的办法驱动的。**但是情况也在发生着一些改变。最近远景论坛已经有大佬写出了Intel网卡的驱动，但是还是存在一些问题。有兴趣的可以看看他的GitHub项目里面有没有支持你的网卡的型号：[IntelBluetoothFirmware](https://github.com/zxystd/IntelBluetoothFirmware)。\n\n  对于网络的问题，可以使用USB网卡。或者直接将电脑的网卡拆下并更换为可以使用的免驱网卡。关于免驱网卡型号的选择，可以参考这个网站：[黑苹果建议的无线网卡 Hackintosh Compatible WiFi(20190505增加无线路由器推荐)](https://www.itpwd.com/330.html#)。\n\n  当安装了合适的网卡以后，电脑便可以上网了。这个时候，这台电脑才基本可以投入使用。\n\n- 关于`BCM94352Z(DW1560)`：\n\n  作者使用的就是这种无线网卡。这个网卡是Wi-Fi和蓝牙二合一无线网卡。该网卡的无线局域网功能在macOS和Windows系统下都是免驱的。但是这个网卡在macOS下要驱动蓝牙需要三个驱动文件，分别为：`AirportBrcmFixup.kext`，`BrcmFirmwareData.kext`，`BrcmPatchRAM3.kext`。将这些驱动文件放入`/EFI/CLOVER/kexts/Other`下。注意，该目录下还应当存在`Lilu.kext`，否则驱动文件无法正常工作（仓库中提供的EFI文件夹中都已包含这些驱动文件了）。\n\n  作者的电脑一度出现了电脑睡眠唤醒后蓝牙失效的情况，并被这个问题困扰了很久。一开始是参考了[Broadcom BCM94352z/DW1560驱动新姿势[新方法]](https://blog.daliansky.net/Broadcom-BCM94352z-DW1560-drive-new-posture.html)中的方法，但是问题并没有得到根本解决。之后在`/EFI/CLOVER/kexts/Other`中加入了`ACPIDebug.kext`，将电脑`hibernatemode`的值调整为`0`，并在`蓝牙偏好设置-高级选项`中取消勾选`允许蓝牙设备唤醒这台电脑`后，也没有解决该问题。然后作者尝试重新订制USB驱动来解决这个问题，但是还是没有能够解决这个问题。\n\n  最后，作者更换了最新的蓝牙驱动，才最终完美解决了这个问题。需要注意的是，有时在睡眠唤醒之后，蓝牙图标会短暂的显示为失效状态，然后回复正常。\n\n  在Windows系统下，可以自行安装`驱动人生`软件来安装蓝牙的驱动。\n\n  目前市面上`DW1560`的价格在300元左右。实话说，这个价格完全是因为黑苹果这边的需求炒起来的。而同时社区中也有其他网卡的解决方案，除了上文所提到过的驱动还开发中的部分Intel网卡之外，`DW1820`是另一个价格相对低廉的选择。但是根据社区中的反馈，`DW1820`的表现并不是特别稳定，有可能会出现各种奇怪的问题。因此，作者建议还是直接购买`DW1560`比较好，一步到位，省了各种折腾和闹心。另外，你也可以购买Mac上的拆机网卡或者`DW1830`，后者的价格在500元左右，速度比`DW1560`更快。\n\n- 关于睡眠：\n\n  请打开`Hackintool`软件，并切换到`电源`一栏。再点击红框中的按钮，使得电源信息中红色的两行变为绿色。此操作可能可以解决一些睡眠问题。\n\n  ![睡眠修复](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_3.png)\n\n- 定制USB驱动：\n\n  定制USB驱动有可能可以帮助解决一些睡眠上的问题，其操作步骤也十分简单，所以博主强烈推荐大家还是定制一下。在此处附上订制USB驱动的教程：[Hackintool(Intel FB Patcher) USB定制视频](https://blog.daliansky.net/Intel-FB-Patcher-USB-Custom-Video.html)。需要注意的是，你有可能发现在使用了`USBInjectALL.kext`以后仍有端口无法加载/检测不到。你可以尝试在`Clover`的`config.plist`中添加下列`解除USB端口数量限制补丁`来解决这个问题。\n\n  ![解除USB端口数量限制补丁](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_5.png)\n\n  ```\n  Comment: USB port limit patch #1 10.15.x modify by DalianSky(credit ydeng)\n  Name: com.apple.iokit.IOUSBHostFamily\n  Find: 83FB0F0F\n  Replace: 83FB3F0F\n  \n  Comment: USB Port limit patch #2 10.15.x modify by DalianSky\n  Name: com.apple.driver.usb.AppleUSBXHCI\n  Find: 83F90F0F\n  Replace: 83F93F0F\n  ```\n\n- 开启`HiDPI`使屏幕看起来清晰：\n\n  在终端中输入：`sh -c \"$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi-zh.sh)\"`，再按提示操作即可。\n\n  详情请见：[HiDPI是什么？以及黑苹果如何开启HiDPI](https://www.sqlsec.com/2018/09/hidpi.html)。\n\n- 打开`SSD Trim`：\n\n  在终端中输入：`sudo trimforce enable`，然后输入`y`再回车，重复一次，电脑将自动重启。需要注意的是，使用原装SSD的朋友请**不要**打开这个功能，这会导致你的电脑在macOS下非常卡顿，几乎无法操作。\n\n- 电脑卡顿的解决办法：\n\n  在刚安装完黑苹果后，系统大概率会出现极为卡顿的情况。这种卡顿主要表现在：鼠标移动卡顿、动画严重掉帧、开机速度以及应用打开速度很慢、系统资源大量占用、电脑发热严重、无法正常关机。这些问题有的时候不太明显，有的时候则令电脑根本无法使用。上述问题有时在让电脑睡眠一段时间之后重新唤醒即可得到改善，但是无法根本解决。\n\n  出现上述问题的根本原因就在于本型号电脑所使用的SSD——Intel SSDPEKKF360G7H对macOS的兼容并不好。若要正常使用该SSD的话必须在`/EFI/CLOVER/kexts/Other`中添加`HackrNVMeFamily.kext`。你可以在GitHub仓库文件主目录下的`kext`文件夹中找到这个驱动。在添加了这个驱动之后，系统的卡顿现象可以得到非常明显的改善，基本上做到了流畅运行，但是偶尔还是会有些许卡顿。\n\n  解决这个问题最根本的方法还是更换SSD。作者的SSD已经更换为西部数据的SN500，故在EFI文件夹中删除了这个驱动文件。\n\n- 电脑无法调节屏幕亮度的解决办法：\n\n  一般情况下不会出现这样的情况，但是如果发生了，使用`Kext Utility`重建缓存后重启即可。\n\n- 关于本机的`VoodooPS2Controller.kext`：\n\n  在更换了EFI的hotpatch方法以后，最新版本的`VoodooPS2Controller.kext`已经可以正常使用。注意，新版本的`VoodooPS2Controller.kext`需要配合`VoodooInput.kext`使用。下面所说的定制`VoodooPS2Controller.kext`的内容已经过时，但此处仍加以保留，你可以根据自己的喜好按需使用。\n\n  旧版本的`VoodooPS2Controller.kext`存放于GitHub仓库文件主目录下的`kext`文件夹中，它双指手势只支持上下左右滑动，三指手势在修改后实现了下表所述功能。它与新版驱动相比，优点在于：十分稳定，三指手势的识别成功率几乎达到100%，并且双指轻触十分灵敏。\n\n  为迎合macOS调度中心默认的键位，我将该驱动的三只滑动手势的键盘映射作了些许调整，其对应关系如下表：\n\n| 手势     | 原本对应的快捷键 | 修改后的快捷键 | 功能                 |\n| -------- | ---------------- | -------------- | -------------------- |\n| 三指上滑 | ⌘+ˆ+↑            | ˆ+↑            | 调度中心             |\n| 三指下滑 | ⌘+ˆ+↓            | ˆ+↓            | App Exposé           |\n| 三指左滑 | ⌘+ˆ+←            | ˆ+→            | 向右切换一个全屏页面 |\n| 三指右滑 | ⌘+ˆ+→            | ˆ+←            | 向左切换一个全屏页面 |\n\n- 触控板没有反应的情况：\n\n  一开始我以为是相关驱动没有成功加载的缘故，但是后来发现这是因为触控板被误锁定了。按下电脑键盘右上角的`prt sc`键可以锁定/解锁触控板。\n\n- 关于`CPUFriend.kext`：\n\n  该驱动文件用于实现CPU的变频功能。由于该驱动程序只能根据用户个人的电脑定制，所以请不要直接使用仓库EFi文件夹中所提供的驱动文件。具体安装方法参见：[利用CPUFriend.kext实现变频](https://change-y.github.io/2018/04/30/利用CPUFriend-kext实现变频/)。\n\n  安装完成后，可以使用CPU-S来检测自己电脑的变频档位。\n\n- 打开原生的NTFS读写功能：\n\n  **该操作有一定风险，是否需要开启请自行判断。**\n\n  在macOS的默认状态下，NTFS格式的磁盘是只能读不能写的。但是我们可以将隐藏的功能打开，从而可以对该格式的磁盘进行写操作，详情参考这个链接：[macOS打开原生的NTFS读写功能](http://bbs.pcbeta.com/viewthread-1742688-1-8.html)。\n\n  如果你对NTFS格式的磁盘读写功能有刚需，也有很多相关的软件可供选择。此处略去不表。\n\n- 修复Windows和macOS下时钟不同步的问题：\n\n  对于安装了双系统的电脑，在从macOS切换回Windows之后会发现Windows的系统时间与当前时间不符。解决这个问题的办法是：在Windows下，打开CMD输入下面的命令后回车。\n\n  `Reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1`。\n\n- 关于显卡`platform-id`的选择：\n\n  本机的显卡就是`Intel HD Graphics 620`，是属于7代Kaby Lake平台的，其`platform-id`为`0x5916000`，对应机型为`MacbookPro 14,2`。但是经过本人实践发现，如果注入的是HD 620的id，系统显示器输出的`帧缓冲深度(Framebuffer depth)`为诡异的30位，这对应的是10位的显示器。由于电脑显示器本身为8位的，因此10位的颜色输出会导致高斯模糊和半透明的画面出现严重的色阶断层（色带）。一开始我以为是显示器EDID不匹配的问题，但是经过搜索发现，在Kaby Lake平台上，这个问题是因为显卡`platform-id`选择得不对，应该是需要仿冒6代Sky Lake平台的`Intel HD Graphics 520`才可以得到正确的24位的帧缓冲深度输出，如下图所示。\n\n  关于这个问题的具体内容和解决方法可以参看这个[网页](https://www.tonymacx86.com/threads/help-weird-ring-like-blur-and-images-in-mojave.262566/#post-1834064)。\n\n  ![正确的帧缓冲深度](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_4.png)\n\n\n\n至此，黑苹果的安装和完善就差不多结束了。现在可以登陆iCloud以及其他苹果服务，并安装自己需要的软件了。\n\n\n\n附：博主电脑配置\n\n| 型号 | HP Envy-13 ad024TU                                 |\n| ---- | -------------------------------------------------- |\n| CPU  | Intel Core i7-7500U(2.7GHz)                        |\n| RAM  | 8GB DDR4                                           |\n| 显卡 | Intel HD Graphics 620                              |\n| 硬盘 | ~~Intel SSDPEKKF360G7H 360G~~ （已更换为WD SN500） |\n| 网卡 | ~~Intel 7265NGW~~（已更换为DW1560）                |\n| 声卡 | ALC295                                             |\n\n\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n目前，Open Core已经成为黑苹果社区使用的主流引导，博主同样将黑苹果迁移到了OC上面，有需要的话可以下载<a href=\"https://github.com/Astrobr/OCForEnvy13-ad0xx\">这个仓库</a>中提供的EFI文件。此外，更换电脑之后我不打算再折腾黑苹果了，于Github上存放EFI的仓库将不再更新。\n</div>\n</article>\n\n\n\n","source":"_posts/HP_Envy-13_ad024TU_Hackintosh.md","raw":"---\ntitle: HP Envy-13 ad024TU黑苹果安装总结\ndate: 2020-2-14 22:20:00\ncategories: \n\t- [Hackintosh]\n\t#- [cate2]\n\t#...\ntags: \n\t- macOS\n\t- Hackintosh\n\t- HP\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg\n\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 黑苹果安装的踩坑记录。\n\n#You can begin to input your article below now.\n\n---\n\n### 请先了解以下内容\n\n本文主要介绍在完成黑苹果的基本安装以后的完善过程。对于黑苹果完全没有概念的朋友，请看[这篇文章]()。而本文是在很早的时候开始写的，并在原基础上不断增添了内容。那时候作者还未对EFI做足够的优化，因此本文在现在看来有一些过时。假如你遇到了文章中出现的类似情况，希望可以给你提供一些解决思路。但是一般来说，如果你的**机型和硬件**与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。\n\n- 作者电脑的EFI存放于这个Github仓库中：[HackintoshForEnvy13-ad0xx](https://github.com/Astrobr/HackintoshForEnvy13-ad0xx)。\n\n- 作者电脑型号为`HP Envy-13 ad024TU`，其中部分文件不建议大家直接用于其他型号的电脑。若使用本仓库中文件导致系统故障或崩溃，作者本人概不负责。\n\n- 作者电脑的网卡和硬盘均作了更换。故即使机型相同，直接套用此EFI依旧可能会产生问题，请知照！\n- 此EFI一开始是来自于交流群中来源不明的Envy-13通用EFI，里面的内容杂乱无章而且有很多不必要的驱动和补丁，但还是可以将机器驱动起来。经过大半年的维护，我对其中的内容作了一些精简，但是其中的方法依旧相对落后和杂乱。现在的这个EFI基本上是基于[SlientSliver](https://github.com/SilentSliver)的[HP-ENVY13-ad1XX-Hackintosh](https://github.com/SilentSliver/HP-ENVY-13-ad1XX-Hackintosh)修改而来，保留了其中的hotpatch部分，更改了一些驱动和补丁。特此鸣谢！\n- 关于本机的功能：\n  - CPU：可以正常变频\n  - 电源：节能五项似乎没有完全加载，但是电池电量显示正常，使用上没有障碍\n  - 显卡：仿冒的`Intel HD Graphics 520`，`ig-platform-id`为`0x19160000`，驱动原生显卡`Intel HD Graphics 620`会产生非常诡异的色阶断层，严重影响观感\n  - 睡眠：正常，以前曾有过睡眠唤醒掉蓝牙的问题，现在已经解决\n  - 声音：使用的`LayoutID`为`03`，只能驱动底面的扬声器，对于这款笔记本电脑来说，两个扬声器和四个扬声器听起来并无什么差别，对音质有追求的请直接外接蓝牙音响或者使用耳机，插入耳机后音量可以自动调节为之前的设置值\n  - 网卡和蓝牙：原配网卡无法使用，我更换为`DW1560`，没有故障出现，Airdrop，HandOff，Sidecar都可以正常使用，可以连接AirPods听音乐并且功能完整\n  - 触控板：加载了白苹果手势，但除了四指手势和力度感应之外其他手势都可以用\n  - 亮度调节：可调，但是档位间隔不大，最低档位的时候屏幕还是较亮\n  - USB接口：四个接口均可正常使用\n  - 摄像头：可用\n  - 读卡器：无法驱动，有需要的建议使用读卡器\n- **声明：仓库中所有文件均可供个人用途和技术交流使用，在转载时请务必标明出处。不得将此仓库中的任何文件用于任何商业活动！**\n\n### 基本安装过程中的一些问题\n\n这部分不是主要内容，但还是讲两句吧。\n\n- 进入不了安装界面：\n\n  首先请确认你安装镜像中的EFI是适用于你的电脑型号的。如果还是不行，请在`Clover`中的`Option`选项中选择`-v`以啰嗦模式启动，这样启动的时候会显示出详细的信息。将最后出现的报错信息拍下来或者整个启动过程录制下来以后，找网友求助吧。\n\n- 安装macOS 10.15的过程中，在啰嗦模式中出现如下图所示报错：![报错内容请注意最后一部分](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_1.JPG)\n\n  ​\t\t请在`Clover`中打上如图所示的这个补丁。![补丁图示](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_2.png)\n\n- 进入安装界面且开始安装一段时间后，无法继续安装：\n\n  请重新下载镜像，在下载完成以后检查镜像的`md5`值是否正确。如正确，再制作你的镜像U盘。\n\n- 对于10.14.x的镜像进入安装界面后提示应用已经损坏，无法安装：\n\n  请将你的bios时间往前调整至2019年10月25日以前，但是不要调整得太久远。这是因为旧的镜像中的证书会在上述时间以后过期导致无法安装。\n\n### 后续完善中的一些问题\n\n在安装完成以后，便可以进入系统了。但是这个时候的系统还是非常不完善的，需要做很多调整。进入系统后，先在 `关于本机-系统报告`中检查各个硬件项目是否被成功驱动，然后再根据没有成功驱动的项目，安装相对应的驱动或者打必要的补丁。但是前文说过：如果你的**机型和硬件**与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。\n\n如果使用的是与作者相同型号的电脑（型号完全一致，且未更换过任何硬件），以下项目是有故障的\n\n- 网卡未被驱动，无法上网\n- 蓝牙未驱动，无法使用蓝牙\n- Siri, iMessage, FaceTime, HandOff无法使用\n\n以下项目有可能出现故障：\n\n- 声卡未驱动，没有声音，也无法录音\n- 无法调节显示器亮度，在`系统偏好设置`中也没有调节亮度的拖动条\n- 触控板未被驱动，无法使用触控板\n\n因此，仅仅完成了系统的安装是远远不够的。此时我们的电脑还无法被称为生产力工具。下面就介绍一些解决故障的办法以及系统优化的办法。\n\n- 首先应当获取软件安装权限，只有在此以后你才可以安装非App Store下载的，或者由非受信任的开发者开发的软件：\n\n  在终端中输入：`sudo spctl --master-disable`\n\n- 建议安装的软件：\n\n  - `Clover Configurator`：用于修改`Clover`的配置文件`config.plist`\n  - `Hackintool`：功能强大的黑苹果配置工具\n  - `Kext Utility`：用于重建缓存\n  - `CPU-S`：用于测试CPU变频档位\n  - `MaciASL`：用于修改SSDT\n\n  这些软件可以通过这个[百度云链接](https://pan.baidu.com/s/12Kp9dv8HkVgm1VoVeXmC8w)下载。密码：57qf。\n\n- 机型选择：\n\n  使用`Clover Configurator`打开`config.plist`，确保在`机型设置`中选择`MacBook Pro 14,1`。关于机型的选择，原则上是需要将你的电脑的集成显卡的型号与所选机型的集成显卡型号对应起来的，否则无法驱动你的显卡。具体的选择参见：[黑苹果必备：Intel核显platform ID整理及smbios速查表](https://blog.daliansky.net/Intel-core-display-platformID-finishing.html)。\n\n- 驱动的正确安装方法：\n\n  如果驱动没有正确安装，有极大的可能性会导致重启之后无法进入系统。作者本人就在这个问题上吃了很大的亏。关于驱动的安装，分为两种情况。\n\n  - 操作的是`/EFI/CLOVER/kexts/Other`中的驱动文件。对于这种情况，不需要重建缓存。\n\n  - 操作的是`/Library/Extensions`或者`/System/Library/Extensions`中的驱动文件。如果操作的是这个两个文件夹中的驱动文件，则需要重建缓存。可以通过`Kext Utility`软件或者使用终端命令行来重建缓存。\n\n  重建缓存的命令：`sudo kextcache -i /`。\n\n- 关于网络：\n\n  对于使用安装了Intel（或者其他某些品牌）的网卡的电脑的朋友们，进入黑苹果系统以后网卡是没有驱动的，也就是说这个时候电脑是没有办法上网的。若是电脑安装了某些型号的免驱网卡，在macOS系统下电脑就可以直接连接网络。一般来说，如果不想拆机，可以使用USB网卡。但是使用USB网卡无法使用Siri, iMessage, FaceTime, HandOff等功能。\n\n  **对于Intel的网卡，目前在macOS下是没有很好的办法驱动的。**但是情况也在发生着一些改变。最近远景论坛已经有大佬写出了Intel网卡的驱动，但是还是存在一些问题。有兴趣的可以看看他的GitHub项目里面有没有支持你的网卡的型号：[IntelBluetoothFirmware](https://github.com/zxystd/IntelBluetoothFirmware)。\n\n  对于网络的问题，可以使用USB网卡。或者直接将电脑的网卡拆下并更换为可以使用的免驱网卡。关于免驱网卡型号的选择，可以参考这个网站：[黑苹果建议的无线网卡 Hackintosh Compatible WiFi(20190505增加无线路由器推荐)](https://www.itpwd.com/330.html#)。\n\n  当安装了合适的网卡以后，电脑便可以上网了。这个时候，这台电脑才基本可以投入使用。\n\n- 关于`BCM94352Z(DW1560)`：\n\n  作者使用的就是这种无线网卡。这个网卡是Wi-Fi和蓝牙二合一无线网卡。该网卡的无线局域网功能在macOS和Windows系统下都是免驱的。但是这个网卡在macOS下要驱动蓝牙需要三个驱动文件，分别为：`AirportBrcmFixup.kext`，`BrcmFirmwareData.kext`，`BrcmPatchRAM3.kext`。将这些驱动文件放入`/EFI/CLOVER/kexts/Other`下。注意，该目录下还应当存在`Lilu.kext`，否则驱动文件无法正常工作（仓库中提供的EFI文件夹中都已包含这些驱动文件了）。\n\n  作者的电脑一度出现了电脑睡眠唤醒后蓝牙失效的情况，并被这个问题困扰了很久。一开始是参考了[Broadcom BCM94352z/DW1560驱动新姿势[新方法]](https://blog.daliansky.net/Broadcom-BCM94352z-DW1560-drive-new-posture.html)中的方法，但是问题并没有得到根本解决。之后在`/EFI/CLOVER/kexts/Other`中加入了`ACPIDebug.kext`，将电脑`hibernatemode`的值调整为`0`，并在`蓝牙偏好设置-高级选项`中取消勾选`允许蓝牙设备唤醒这台电脑`后，也没有解决该问题。然后作者尝试重新订制USB驱动来解决这个问题，但是还是没有能够解决这个问题。\n\n  最后，作者更换了最新的蓝牙驱动，才最终完美解决了这个问题。需要注意的是，有时在睡眠唤醒之后，蓝牙图标会短暂的显示为失效状态，然后回复正常。\n\n  在Windows系统下，可以自行安装`驱动人生`软件来安装蓝牙的驱动。\n\n  目前市面上`DW1560`的价格在300元左右。实话说，这个价格完全是因为黑苹果这边的需求炒起来的。而同时社区中也有其他网卡的解决方案，除了上文所提到过的驱动还开发中的部分Intel网卡之外，`DW1820`是另一个价格相对低廉的选择。但是根据社区中的反馈，`DW1820`的表现并不是特别稳定，有可能会出现各种奇怪的问题。因此，作者建议还是直接购买`DW1560`比较好，一步到位，省了各种折腾和闹心。另外，你也可以购买Mac上的拆机网卡或者`DW1830`，后者的价格在500元左右，速度比`DW1560`更快。\n\n- 关于睡眠：\n\n  请打开`Hackintool`软件，并切换到`电源`一栏。再点击红框中的按钮，使得电源信息中红色的两行变为绿色。此操作可能可以解决一些睡眠问题。\n\n  ![睡眠修复](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_3.png)\n\n- 定制USB驱动：\n\n  定制USB驱动有可能可以帮助解决一些睡眠上的问题，其操作步骤也十分简单，所以博主强烈推荐大家还是定制一下。在此处附上订制USB驱动的教程：[Hackintool(Intel FB Patcher) USB定制视频](https://blog.daliansky.net/Intel-FB-Patcher-USB-Custom-Video.html)。需要注意的是，你有可能发现在使用了`USBInjectALL.kext`以后仍有端口无法加载/检测不到。你可以尝试在`Clover`的`config.plist`中添加下列`解除USB端口数量限制补丁`来解决这个问题。\n\n  ![解除USB端口数量限制补丁](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_5.png)\n\n  ```\n  Comment: USB port limit patch #1 10.15.x modify by DalianSky(credit ydeng)\n  Name: com.apple.iokit.IOUSBHostFamily\n  Find: 83FB0F0F\n  Replace: 83FB3F0F\n  \n  Comment: USB Port limit patch #2 10.15.x modify by DalianSky\n  Name: com.apple.driver.usb.AppleUSBXHCI\n  Find: 83F90F0F\n  Replace: 83F93F0F\n  ```\n\n- 开启`HiDPI`使屏幕看起来清晰：\n\n  在终端中输入：`sh -c \"$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi-zh.sh)\"`，再按提示操作即可。\n\n  详情请见：[HiDPI是什么？以及黑苹果如何开启HiDPI](https://www.sqlsec.com/2018/09/hidpi.html)。\n\n- 打开`SSD Trim`：\n\n  在终端中输入：`sudo trimforce enable`，然后输入`y`再回车，重复一次，电脑将自动重启。需要注意的是，使用原装SSD的朋友请**不要**打开这个功能，这会导致你的电脑在macOS下非常卡顿，几乎无法操作。\n\n- 电脑卡顿的解决办法：\n\n  在刚安装完黑苹果后，系统大概率会出现极为卡顿的情况。这种卡顿主要表现在：鼠标移动卡顿、动画严重掉帧、开机速度以及应用打开速度很慢、系统资源大量占用、电脑发热严重、无法正常关机。这些问题有的时候不太明显，有的时候则令电脑根本无法使用。上述问题有时在让电脑睡眠一段时间之后重新唤醒即可得到改善，但是无法根本解决。\n\n  出现上述问题的根本原因就在于本型号电脑所使用的SSD——Intel SSDPEKKF360G7H对macOS的兼容并不好。若要正常使用该SSD的话必须在`/EFI/CLOVER/kexts/Other`中添加`HackrNVMeFamily.kext`。你可以在GitHub仓库文件主目录下的`kext`文件夹中找到这个驱动。在添加了这个驱动之后，系统的卡顿现象可以得到非常明显的改善，基本上做到了流畅运行，但是偶尔还是会有些许卡顿。\n\n  解决这个问题最根本的方法还是更换SSD。作者的SSD已经更换为西部数据的SN500，故在EFI文件夹中删除了这个驱动文件。\n\n- 电脑无法调节屏幕亮度的解决办法：\n\n  一般情况下不会出现这样的情况，但是如果发生了，使用`Kext Utility`重建缓存后重启即可。\n\n- 关于本机的`VoodooPS2Controller.kext`：\n\n  在更换了EFI的hotpatch方法以后，最新版本的`VoodooPS2Controller.kext`已经可以正常使用。注意，新版本的`VoodooPS2Controller.kext`需要配合`VoodooInput.kext`使用。下面所说的定制`VoodooPS2Controller.kext`的内容已经过时，但此处仍加以保留，你可以根据自己的喜好按需使用。\n\n  旧版本的`VoodooPS2Controller.kext`存放于GitHub仓库文件主目录下的`kext`文件夹中，它双指手势只支持上下左右滑动，三指手势在修改后实现了下表所述功能。它与新版驱动相比，优点在于：十分稳定，三指手势的识别成功率几乎达到100%，并且双指轻触十分灵敏。\n\n  为迎合macOS调度中心默认的键位，我将该驱动的三只滑动手势的键盘映射作了些许调整，其对应关系如下表：\n\n| 手势     | 原本对应的快捷键 | 修改后的快捷键 | 功能                 |\n| -------- | ---------------- | -------------- | -------------------- |\n| 三指上滑 | ⌘+ˆ+↑            | ˆ+↑            | 调度中心             |\n| 三指下滑 | ⌘+ˆ+↓            | ˆ+↓            | App Exposé           |\n| 三指左滑 | ⌘+ˆ+←            | ˆ+→            | 向右切换一个全屏页面 |\n| 三指右滑 | ⌘+ˆ+→            | ˆ+←            | 向左切换一个全屏页面 |\n\n- 触控板没有反应的情况：\n\n  一开始我以为是相关驱动没有成功加载的缘故，但是后来发现这是因为触控板被误锁定了。按下电脑键盘右上角的`prt sc`键可以锁定/解锁触控板。\n\n- 关于`CPUFriend.kext`：\n\n  该驱动文件用于实现CPU的变频功能。由于该驱动程序只能根据用户个人的电脑定制，所以请不要直接使用仓库EFi文件夹中所提供的驱动文件。具体安装方法参见：[利用CPUFriend.kext实现变频](https://change-y.github.io/2018/04/30/利用CPUFriend-kext实现变频/)。\n\n  安装完成后，可以使用CPU-S来检测自己电脑的变频档位。\n\n- 打开原生的NTFS读写功能：\n\n  **该操作有一定风险，是否需要开启请自行判断。**\n\n  在macOS的默认状态下，NTFS格式的磁盘是只能读不能写的。但是我们可以将隐藏的功能打开，从而可以对该格式的磁盘进行写操作，详情参考这个链接：[macOS打开原生的NTFS读写功能](http://bbs.pcbeta.com/viewthread-1742688-1-8.html)。\n\n  如果你对NTFS格式的磁盘读写功能有刚需，也有很多相关的软件可供选择。此处略去不表。\n\n- 修复Windows和macOS下时钟不同步的问题：\n\n  对于安装了双系统的电脑，在从macOS切换回Windows之后会发现Windows的系统时间与当前时间不符。解决这个问题的办法是：在Windows下，打开CMD输入下面的命令后回车。\n\n  `Reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1`。\n\n- 关于显卡`platform-id`的选择：\n\n  本机的显卡就是`Intel HD Graphics 620`，是属于7代Kaby Lake平台的，其`platform-id`为`0x5916000`，对应机型为`MacbookPro 14,2`。但是经过本人实践发现，如果注入的是HD 620的id，系统显示器输出的`帧缓冲深度(Framebuffer depth)`为诡异的30位，这对应的是10位的显示器。由于电脑显示器本身为8位的，因此10位的颜色输出会导致高斯模糊和半透明的画面出现严重的色阶断层（色带）。一开始我以为是显示器EDID不匹配的问题，但是经过搜索发现，在Kaby Lake平台上，这个问题是因为显卡`platform-id`选择得不对，应该是需要仿冒6代Sky Lake平台的`Intel HD Graphics 520`才可以得到正确的24位的帧缓冲深度输出，如下图所示。\n\n  关于这个问题的具体内容和解决方法可以参看这个[网页](https://www.tonymacx86.com/threads/help-weird-ring-like-blur-and-images-in-mojave.262566/#post-1834064)。\n\n  ![正确的帧缓冲深度](https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_4.png)\n\n\n\n至此，黑苹果的安装和完善就差不多结束了。现在可以登陆iCloud以及其他苹果服务，并安装自己需要的软件了。\n\n\n\n附：博主电脑配置\n\n| 型号 | HP Envy-13 ad024TU                                 |\n| ---- | -------------------------------------------------- |\n| CPU  | Intel Core i7-7500U(2.7GHz)                        |\n| RAM  | 8GB DDR4                                           |\n| 显卡 | Intel HD Graphics 620                              |\n| 硬盘 | ~~Intel SSDPEKKF360G7H 360G~~ （已更换为WD SN500） |\n| 网卡 | ~~Intel 7265NGW~~（已更换为DW1560）                |\n| 声卡 | ALC295                                             |\n\n\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n目前，Open Core已经成为黑苹果社区使用的主流引导，博主同样将黑苹果迁移到了OC上面，有需要的话可以下载<a href=\"https://github.com/Astrobr/OCForEnvy13-ad0xx\">这个仓库</a>中提供的EFI文件。此外，更换电脑之后我不打算再折腾黑苹果了，于Github上存放EFI的仓库将不再更新。\n</div>\n</article>\n\n\n\n","slug":"HP_Envy-13_ad024TU_Hackintosh","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzo00031q3941r63aj4","content":"<h3 id=\"请先了解以下内容\"><a href=\"#请先了解以下内容\" class=\"headerlink\" title=\"请先了解以下内容\"></a>请先了解以下内容</h3><p>本文主要介绍在完成黑苹果的基本安装以后的完善过程。对于黑苹果完全没有概念的朋友，请看<a href=\"\">这篇文章</a>。而本文是在很早的时候开始写的，并在原基础上不断增添了内容。那时候作者还未对EFI做足够的优化，因此本文在现在看来有一些过时。假如你遇到了文章中出现的类似情况，希望可以给你提供一些解决思路。但是一般来说，如果你的<strong>机型和硬件</strong>与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。</p>\n<ul>\n<li><p>作者电脑的EFI存放于这个Github仓库中：<a href=\"https://github.com/Astrobr/HackintoshForEnvy13-ad0xx\">HackintoshForEnvy13-ad0xx</a>。</p>\n</li>\n<li><p>作者电脑型号为<code>HP Envy-13 ad024TU</code>，其中部分文件不建议大家直接用于其他型号的电脑。若使用本仓库中文件导致系统故障或崩溃，作者本人概不负责。</p>\n</li>\n<li><p>作者电脑的网卡和硬盘均作了更换。故即使机型相同，直接套用此EFI依旧可能会产生问题，请知照！</p>\n</li>\n<li><p>此EFI一开始是来自于交流群中来源不明的Envy-13通用EFI，里面的内容杂乱无章而且有很多不必要的驱动和补丁，但还是可以将机器驱动起来。经过大半年的维护，我对其中的内容作了一些精简，但是其中的方法依旧相对落后和杂乱。现在的这个EFI基本上是基于<a href=\"https://github.com/SilentSliver\">SlientSliver</a>的<a href=\"https://github.com/SilentSliver/HP-ENVY-13-ad1XX-Hackintosh\">HP-ENVY13-ad1XX-Hackintosh</a>修改而来，保留了其中的hotpatch部分，更改了一些驱动和补丁。特此鸣谢！</p>\n</li>\n<li><p>关于本机的功能：</p>\n<ul>\n<li>CPU：可以正常变频</li>\n<li>电源：节能五项似乎没有完全加载，但是电池电量显示正常，使用上没有障碍</li>\n<li>显卡：仿冒的<code>Intel HD Graphics 520</code>，<code>ig-platform-id</code>为<code>0x19160000</code>，驱动原生显卡<code>Intel HD Graphics 620</code>会产生非常诡异的色阶断层，严重影响观感</li>\n<li>睡眠：正常，以前曾有过睡眠唤醒掉蓝牙的问题，现在已经解决</li>\n<li>声音：使用的<code>LayoutID</code>为<code>03</code>，只能驱动底面的扬声器，对于这款笔记本电脑来说，两个扬声器和四个扬声器听起来并无什么差别，对音质有追求的请直接外接蓝牙音响或者使用耳机，插入耳机后音量可以自动调节为之前的设置值</li>\n<li>网卡和蓝牙：原配网卡无法使用，我更换为<code>DW1560</code>，没有故障出现，Airdrop，HandOff，Sidecar都可以正常使用，可以连接AirPods听音乐并且功能完整</li>\n<li>触控板：加载了白苹果手势，但除了四指手势和力度感应之外其他手势都可以用</li>\n<li>亮度调节：可调，但是档位间隔不大，最低档位的时候屏幕还是较亮</li>\n<li>USB接口：四个接口均可正常使用</li>\n<li>摄像头：可用</li>\n<li>读卡器：无法驱动，有需要的建议使用读卡器</li>\n</ul>\n</li>\n<li><p><strong>声明：仓库中所有文件均可供个人用途和技术交流使用，在转载时请务必标明出处。不得将此仓库中的任何文件用于任何商业活动！</strong></p>\n</li>\n</ul>\n<h3 id=\"基本安装过程中的一些问题\"><a href=\"#基本安装过程中的一些问题\" class=\"headerlink\" title=\"基本安装过程中的一些问题\"></a>基本安装过程中的一些问题</h3><p>这部分不是主要内容，但还是讲两句吧。</p>\n<ul>\n<li><p>进入不了安装界面：</p>\n<p>首先请确认你安装镜像中的EFI是适用于你的电脑型号的。如果还是不行，请在<code>Clover</code>中的<code>Option</code>选项中选择<code>-v</code>以啰嗦模式启动，这样启动的时候会显示出详细的信息。将最后出现的报错信息拍下来或者整个启动过程录制下来以后，找网友求助吧。</p>\n</li>\n<li><p>安装macOS 10.15的过程中，在啰嗦模式中出现如下图所示报错：<img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_1.JPG\" alt=\"报错内容请注意最后一部分\"></p>\n<p>​        请在<code>Clover</code>中打上如图所示的这个补丁。<img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_2.png\" alt=\"补丁图示\"></p>\n</li>\n<li><p>进入安装界面且开始安装一段时间后，无法继续安装：</p>\n<p>请重新下载镜像，在下载完成以后检查镜像的<code>md5</code>值是否正确。如正确，再制作你的镜像U盘。</p>\n</li>\n<li><p>对于10.14.x的镜像进入安装界面后提示应用已经损坏，无法安装：</p>\n<p>请将你的bios时间往前调整至2019年10月25日以前，但是不要调整得太久远。这是因为旧的镜像中的证书会在上述时间以后过期导致无法安装。</p>\n</li>\n</ul>\n<h3 id=\"后续完善中的一些问题\"><a href=\"#后续完善中的一些问题\" class=\"headerlink\" title=\"后续完善中的一些问题\"></a>后续完善中的一些问题</h3><p>在安装完成以后，便可以进入系统了。但是这个时候的系统还是非常不完善的，需要做很多调整。进入系统后，先在 <code>关于本机-系统报告</code>中检查各个硬件项目是否被成功驱动，然后再根据没有成功驱动的项目，安装相对应的驱动或者打必要的补丁。但是前文说过：如果你的<strong>机型和硬件</strong>与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。</p>\n<p>如果使用的是与作者相同型号的电脑（型号完全一致，且未更换过任何硬件），以下项目是有故障的</p>\n<ul>\n<li>网卡未被驱动，无法上网</li>\n<li>蓝牙未驱动，无法使用蓝牙</li>\n<li>Siri, iMessage, FaceTime, HandOff无法使用</li>\n</ul>\n<p>以下项目有可能出现故障：</p>\n<ul>\n<li>声卡未驱动，没有声音，也无法录音</li>\n<li>无法调节显示器亮度，在<code>系统偏好设置</code>中也没有调节亮度的拖动条</li>\n<li>触控板未被驱动，无法使用触控板</li>\n</ul>\n<p>因此，仅仅完成了系统的安装是远远不够的。此时我们的电脑还无法被称为生产力工具。下面就介绍一些解决故障的办法以及系统优化的办法。</p>\n<ul>\n<li><p>首先应当获取软件安装权限，只有在此以后你才可以安装非App Store下载的，或者由非受信任的开发者开发的软件：</p>\n<p>在终端中输入：<code>sudo spctl --master-disable</code></p>\n</li>\n<li><p>建议安装的软件：</p>\n<ul>\n<li><code>Clover Configurator</code>：用于修改<code>Clover</code>的配置文件<code>config.plist</code></li>\n<li><code>Hackintool</code>：功能强大的黑苹果配置工具</li>\n<li><code>Kext Utility</code>：用于重建缓存</li>\n<li><code>CPU-S</code>：用于测试CPU变频档位</li>\n<li><code>MaciASL</code>：用于修改SSDT</li>\n</ul>\n<p>这些软件可以通过这个<a href=\"https://pan.baidu.com/s/12Kp9dv8HkVgm1VoVeXmC8w\">百度云链接</a>下载。密码：57qf。</p>\n</li>\n<li><p>机型选择：</p>\n<p>使用<code>Clover Configurator</code>打开<code>config.plist</code>，确保在<code>机型设置</code>中选择<code>MacBook Pro 14,1</code>。关于机型的选择，原则上是需要将你的电脑的集成显卡的型号与所选机型的集成显卡型号对应起来的，否则无法驱动你的显卡。具体的选择参见：<a href=\"https://blog.daliansky.net/Intel-core-display-platformID-finishing.html\">黑苹果必备：Intel核显platform ID整理及smbios速查表</a>。</p>\n</li>\n<li><p>驱动的正确安装方法：</p>\n<p>如果驱动没有正确安装，有极大的可能性会导致重启之后无法进入系统。作者本人就在这个问题上吃了很大的亏。关于驱动的安装，分为两种情况。</p>\n<ul>\n<li><p>操作的是<code>/EFI/CLOVER/kexts/Other</code>中的驱动文件。对于这种情况，不需要重建缓存。</p>\n</li>\n<li><p>操作的是<code>/Library/Extensions</code>或者<code>/System/Library/Extensions</code>中的驱动文件。如果操作的是这个两个文件夹中的驱动文件，则需要重建缓存。可以通过<code>Kext Utility</code>软件或者使用终端命令行来重建缓存。</p>\n</li>\n</ul>\n<p>重建缓存的命令：<code>sudo kextcache -i /</code>。</p>\n</li>\n<li><p>关于网络：</p>\n<p>对于使用安装了Intel（或者其他某些品牌）的网卡的电脑的朋友们，进入黑苹果系统以后网卡是没有驱动的，也就是说这个时候电脑是没有办法上网的。若是电脑安装了某些型号的免驱网卡，在macOS系统下电脑就可以直接连接网络。一般来说，如果不想拆机，可以使用USB网卡。但是使用USB网卡无法使用Siri, iMessage, FaceTime, HandOff等功能。</p>\n<p><strong>对于Intel的网卡，目前在macOS下是没有很好的办法驱动的。</strong>但是情况也在发生着一些改变。最近远景论坛已经有大佬写出了Intel网卡的驱动，但是还是存在一些问题。有兴趣的可以看看他的GitHub项目里面有没有支持你的网卡的型号：<a href=\"https://github.com/zxystd/IntelBluetoothFirmware\">IntelBluetoothFirmware</a>。</p>\n<p>对于网络的问题，可以使用USB网卡。或者直接将电脑的网卡拆下并更换为可以使用的免驱网卡。关于免驱网卡型号的选择，可以参考这个网站：<a href=\"https://www.itpwd.com/330.html#\">黑苹果建议的无线网卡 Hackintosh Compatible WiFi(20190505增加无线路由器推荐)</a>。</p>\n<p>当安装了合适的网卡以后，电脑便可以上网了。这个时候，这台电脑才基本可以投入使用。</p>\n</li>\n<li><p>关于<code>BCM94352Z(DW1560)</code>：</p>\n<p>作者使用的就是这种无线网卡。这个网卡是Wi-Fi和蓝牙二合一无线网卡。该网卡的无线局域网功能在macOS和Windows系统下都是免驱的。但是这个网卡在macOS下要驱动蓝牙需要三个驱动文件，分别为：<code>AirportBrcmFixup.kext</code>，<code>BrcmFirmwareData.kext</code>，<code>BrcmPatchRAM3.kext</code>。将这些驱动文件放入<code>/EFI/CLOVER/kexts/Other</code>下。注意，该目录下还应当存在<code>Lilu.kext</code>，否则驱动文件无法正常工作（仓库中提供的EFI文件夹中都已包含这些驱动文件了）。</p>\n<p>作者的电脑一度出现了电脑睡眠唤醒后蓝牙失效的情况，并被这个问题困扰了很久。一开始是参考了<a href=\"https://blog.daliansky.net/Broadcom-BCM94352z-DW1560-drive-new-posture.html\">Broadcom BCM94352z/DW1560驱动新姿势[新方法]</a>中的方法，但是问题并没有得到根本解决。之后在<code>/EFI/CLOVER/kexts/Other</code>中加入了<code>ACPIDebug.kext</code>，将电脑<code>hibernatemode</code>的值调整为<code>0</code>，并在<code>蓝牙偏好设置-高级选项</code>中取消勾选<code>允许蓝牙设备唤醒这台电脑</code>后，也没有解决该问题。然后作者尝试重新订制USB驱动来解决这个问题，但是还是没有能够解决这个问题。</p>\n<p>最后，作者更换了最新的蓝牙驱动，才最终完美解决了这个问题。需要注意的是，有时在睡眠唤醒之后，蓝牙图标会短暂的显示为失效状态，然后回复正常。</p>\n<p>在Windows系统下，可以自行安装<code>驱动人生</code>软件来安装蓝牙的驱动。</p>\n<p>目前市面上<code>DW1560</code>的价格在300元左右。实话说，这个价格完全是因为黑苹果这边的需求炒起来的。而同时社区中也有其他网卡的解决方案，除了上文所提到过的驱动还开发中的部分Intel网卡之外，<code>DW1820</code>是另一个价格相对低廉的选择。但是根据社区中的反馈，<code>DW1820</code>的表现并不是特别稳定，有可能会出现各种奇怪的问题。因此，作者建议还是直接购买<code>DW1560</code>比较好，一步到位，省了各种折腾和闹心。另外，你也可以购买Mac上的拆机网卡或者<code>DW1830</code>，后者的价格在500元左右，速度比<code>DW1560</code>更快。</p>\n</li>\n<li><p>关于睡眠：</p>\n<p>请打开<code>Hackintool</code>软件，并切换到<code>电源</code>一栏。再点击红框中的按钮，使得电源信息中红色的两行变为绿色。此操作可能可以解决一些睡眠问题。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_3.png\" alt=\"睡眠修复\"></p>\n</li>\n<li><p>定制USB驱动：</p>\n<p>定制USB驱动有可能可以帮助解决一些睡眠上的问题，其操作步骤也十分简单，所以博主强烈推荐大家还是定制一下。在此处附上订制USB驱动的教程：<a href=\"https://blog.daliansky.net/Intel-FB-Patcher-USB-Custom-Video.html\">Hackintool(Intel FB Patcher) USB定制视频</a>。需要注意的是，你有可能发现在使用了<code>USBInjectALL.kext</code>以后仍有端口无法加载/检测不到。你可以尝试在<code>Clover</code>的<code>config.plist</code>中添加下列<code>解除USB端口数量限制补丁</code>来解决这个问题。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_5.png\" alt=\"解除USB端口数量限制补丁\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Comment: USB port limit patch #1 10.15.x modify by DalianSky(credit ydeng)</span><br><span class=\"line\">Name: com.apple.iokit.IOUSBHostFamily</span><br><span class=\"line\">Find: 83FB0F0F</span><br><span class=\"line\">Replace: 83FB3F0F</span><br><span class=\"line\"></span><br><span class=\"line\">Comment: USB Port limit patch #2 10.15.x modify by DalianSky</span><br><span class=\"line\">Name: com.apple.driver.usb.AppleUSBXHCI</span><br><span class=\"line\">Find: 83F90F0F</span><br><span class=\"line\">Replace: 83F93F0F</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>开启<code>HiDPI</code>使屏幕看起来清晰：</p>\n<p>在终端中输入：<code>sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi-zh.sh)&quot;</code>，再按提示操作即可。</p>\n<p>详情请见：<a href=\"https://www.sqlsec.com/2018/09/hidpi.html\">HiDPI是什么？以及黑苹果如何开启HiDPI</a>。</p>\n</li>\n<li><p>打开<code>SSD Trim</code>：</p>\n<p>在终端中输入：<code>sudo trimforce enable</code>，然后输入<code>y</code>再回车，重复一次，电脑将自动重启。需要注意的是，使用原装SSD的朋友请<strong>不要</strong>打开这个功能，这会导致你的电脑在macOS下非常卡顿，几乎无法操作。</p>\n</li>\n<li><p>电脑卡顿的解决办法：</p>\n<p>在刚安装完黑苹果后，系统大概率会出现极为卡顿的情况。这种卡顿主要表现在：鼠标移动卡顿、动画严重掉帧、开机速度以及应用打开速度很慢、系统资源大量占用、电脑发热严重、无法正常关机。这些问题有的时候不太明显，有的时候则令电脑根本无法使用。上述问题有时在让电脑睡眠一段时间之后重新唤醒即可得到改善，但是无法根本解决。</p>\n<p>出现上述问题的根本原因就在于本型号电脑所使用的SSD——Intel SSDPEKKF360G7H对macOS的兼容并不好。若要正常使用该SSD的话必须在<code>/EFI/CLOVER/kexts/Other</code>中添加<code>HackrNVMeFamily.kext</code>。你可以在GitHub仓库文件主目录下的<code>kext</code>文件夹中找到这个驱动。在添加了这个驱动之后，系统的卡顿现象可以得到非常明显的改善，基本上做到了流畅运行，但是偶尔还是会有些许卡顿。</p>\n<p>解决这个问题最根本的方法还是更换SSD。作者的SSD已经更换为西部数据的SN500，故在EFI文件夹中删除了这个驱动文件。</p>\n</li>\n<li><p>电脑无法调节屏幕亮度的解决办法：</p>\n<p>一般情况下不会出现这样的情况，但是如果发生了，使用<code>Kext Utility</code>重建缓存后重启即可。</p>\n</li>\n<li><p>关于本机的<code>VoodooPS2Controller.kext</code>：</p>\n<p>在更换了EFI的hotpatch方法以后，最新版本的<code>VoodooPS2Controller.kext</code>已经可以正常使用。注意，新版本的<code>VoodooPS2Controller.kext</code>需要配合<code>VoodooInput.kext</code>使用。下面所说的定制<code>VoodooPS2Controller.kext</code>的内容已经过时，但此处仍加以保留，你可以根据自己的喜好按需使用。</p>\n<p>旧版本的<code>VoodooPS2Controller.kext</code>存放于GitHub仓库文件主目录下的<code>kext</code>文件夹中，它双指手势只支持上下左右滑动，三指手势在修改后实现了下表所述功能。它与新版驱动相比，优点在于：十分稳定，三指手势的识别成功率几乎达到100%，并且双指轻触十分灵敏。</p>\n<p>为迎合macOS调度中心默认的键位，我将该驱动的三只滑动手势的键盘映射作了些许调整，其对应关系如下表：</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>手势</th>\n<th>原本对应的快捷键</th>\n<th>修改后的快捷键</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>三指上滑</td>\n<td>⌘+ˆ+↑</td>\n<td>ˆ+↑</td>\n<td>调度中心</td>\n</tr>\n<tr>\n<td>三指下滑</td>\n<td>⌘+ˆ+↓</td>\n<td>ˆ+↓</td>\n<td>App Exposé</td>\n</tr>\n<tr>\n<td>三指左滑</td>\n<td>⌘+ˆ+←</td>\n<td>ˆ+→</td>\n<td>向右切换一个全屏页面</td>\n</tr>\n<tr>\n<td>三指右滑</td>\n<td>⌘+ˆ+→</td>\n<td>ˆ+←</td>\n<td>向左切换一个全屏页面</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>触控板没有反应的情况：</p>\n<p>一开始我以为是相关驱动没有成功加载的缘故，但是后来发现这是因为触控板被误锁定了。按下电脑键盘右上角的<code>prt sc</code>键可以锁定/解锁触控板。</p>\n</li>\n<li><p>关于<code>CPUFriend.kext</code>：</p>\n<p>该驱动文件用于实现CPU的变频功能。由于该驱动程序只能根据用户个人的电脑定制，所以请不要直接使用仓库EFi文件夹中所提供的驱动文件。具体安装方法参见：<a href=\"https://change-y.github.io/2018/04/30/利用CPUFriend-kext实现变频/\">利用CPUFriend.kext实现变频</a>。</p>\n<p>安装完成后，可以使用CPU-S来检测自己电脑的变频档位。</p>\n</li>\n<li><p>打开原生的NTFS读写功能：</p>\n<p><strong>该操作有一定风险，是否需要开启请自行判断。</strong></p>\n<p>在macOS的默认状态下，NTFS格式的磁盘是只能读不能写的。但是我们可以将隐藏的功能打开，从而可以对该格式的磁盘进行写操作，详情参考这个链接：<a href=\"http://bbs.pcbeta.com/viewthread-1742688-1-8.html\">macOS打开原生的NTFS读写功能</a>。</p>\n<p>如果你对NTFS格式的磁盘读写功能有刚需，也有很多相关的软件可供选择。此处略去不表。</p>\n</li>\n<li><p>修复Windows和macOS下时钟不同步的问题：</p>\n<p>对于安装了双系统的电脑，在从macOS切换回Windows之后会发现Windows的系统时间与当前时间不符。解决这个问题的办法是：在Windows下，打开CMD输入下面的命令后回车。</p>\n<p><code>Reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1</code>。</p>\n</li>\n<li><p>关于显卡<code>platform-id</code>的选择：</p>\n<p>本机的显卡就是<code>Intel HD Graphics 620</code>，是属于7代Kaby Lake平台的，其<code>platform-id</code>为<code>0x5916000</code>，对应机型为<code>MacbookPro 14,2</code>。但是经过本人实践发现，如果注入的是HD 620的id，系统显示器输出的<code>帧缓冲深度(Framebuffer depth)</code>为诡异的30位，这对应的是10位的显示器。由于电脑显示器本身为8位的，因此10位的颜色输出会导致高斯模糊和半透明的画面出现严重的色阶断层（色带）。一开始我以为是显示器EDID不匹配的问题，但是经过搜索发现，在Kaby Lake平台上，这个问题是因为显卡<code>platform-id</code>选择得不对，应该是需要仿冒6代Sky Lake平台的<code>Intel HD Graphics 520</code>才可以得到正确的24位的帧缓冲深度输出，如下图所示。</p>\n<p>关于这个问题的具体内容和解决方法可以参看这个<a href=\"https://www.tonymacx86.com/threads/help-weird-ring-like-blur-and-images-in-mojave.262566/#post-1834064\">网页</a>。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_4.png\" alt=\"正确的帧缓冲深度\"></p>\n</li>\n</ul>\n<p>至此，黑苹果的安装和完善就差不多结束了。现在可以登陆iCloud以及其他苹果服务，并安装自己需要的软件了。</p>\n<p>附：博主电脑配置</p>\n<table>\n<thead>\n<tr>\n<th>型号</th>\n<th>HP Envy-13 ad024TU</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CPU</td>\n<td>Intel Core i7-7500U(2.7GHz)</td>\n</tr>\n<tr>\n<td>RAM</td>\n<td>8GB DDR4</td>\n</tr>\n<tr>\n<td>显卡</td>\n<td>Intel HD Graphics 620</td>\n</tr>\n<tr>\n<td>硬盘</td>\n<td><del>Intel SSDPEKKF360G7H 360G</del> （已更换为WD SN500）</td>\n</tr>\n<tr>\n<td>网卡</td>\n<td><del>Intel 7265NGW</del>（已更换为DW1560）</td>\n</tr>\n<tr>\n<td>声卡</td>\n<td>ALC295</td>\n</tr>\n</tbody></table>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n目前，Open Core已经成为黑苹果社区使用的主流引导，博主同样将黑苹果迁移到了OC上面，有需要的话可以下载<a href=\"https://github.com/Astrobr/OCForEnvy13-ad0xx\">这个仓库</a>中提供的EFI文件。此外，更换电脑之后我不打算再折腾黑苹果了，于Github上存放EFI的仓库将不再更新。\n</div>\n</article>\n\n\n\n","site":{"data":{}},"more":"<h3 id=\"请先了解以下内容\"><a href=\"#请先了解以下内容\" class=\"headerlink\" title=\"请先了解以下内容\"></a>请先了解以下内容</h3><p>本文主要介绍在完成黑苹果的基本安装以后的完善过程。对于黑苹果完全没有概念的朋友，请看<a href=\"\">这篇文章</a>。而本文是在很早的时候开始写的，并在原基础上不断增添了内容。那时候作者还未对EFI做足够的优化，因此本文在现在看来有一些过时。假如你遇到了文章中出现的类似情况，希望可以给你提供一些解决思路。但是一般来说，如果你的<strong>机型和硬件</strong>与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。</p>\n<ul>\n<li><p>作者电脑的EFI存放于这个Github仓库中：<a href=\"https://github.com/Astrobr/HackintoshForEnvy13-ad0xx\">HackintoshForEnvy13-ad0xx</a>。</p>\n</li>\n<li><p>作者电脑型号为<code>HP Envy-13 ad024TU</code>，其中部分文件不建议大家直接用于其他型号的电脑。若使用本仓库中文件导致系统故障或崩溃，作者本人概不负责。</p>\n</li>\n<li><p>作者电脑的网卡和硬盘均作了更换。故即使机型相同，直接套用此EFI依旧可能会产生问题，请知照！</p>\n</li>\n<li><p>此EFI一开始是来自于交流群中来源不明的Envy-13通用EFI，里面的内容杂乱无章而且有很多不必要的驱动和补丁，但还是可以将机器驱动起来。经过大半年的维护，我对其中的内容作了一些精简，但是其中的方法依旧相对落后和杂乱。现在的这个EFI基本上是基于<a href=\"https://github.com/SilentSliver\">SlientSliver</a>的<a href=\"https://github.com/SilentSliver/HP-ENVY-13-ad1XX-Hackintosh\">HP-ENVY13-ad1XX-Hackintosh</a>修改而来，保留了其中的hotpatch部分，更改了一些驱动和补丁。特此鸣谢！</p>\n</li>\n<li><p>关于本机的功能：</p>\n<ul>\n<li>CPU：可以正常变频</li>\n<li>电源：节能五项似乎没有完全加载，但是电池电量显示正常，使用上没有障碍</li>\n<li>显卡：仿冒的<code>Intel HD Graphics 520</code>，<code>ig-platform-id</code>为<code>0x19160000</code>，驱动原生显卡<code>Intel HD Graphics 620</code>会产生非常诡异的色阶断层，严重影响观感</li>\n<li>睡眠：正常，以前曾有过睡眠唤醒掉蓝牙的问题，现在已经解决</li>\n<li>声音：使用的<code>LayoutID</code>为<code>03</code>，只能驱动底面的扬声器，对于这款笔记本电脑来说，两个扬声器和四个扬声器听起来并无什么差别，对音质有追求的请直接外接蓝牙音响或者使用耳机，插入耳机后音量可以自动调节为之前的设置值</li>\n<li>网卡和蓝牙：原配网卡无法使用，我更换为<code>DW1560</code>，没有故障出现，Airdrop，HandOff，Sidecar都可以正常使用，可以连接AirPods听音乐并且功能完整</li>\n<li>触控板：加载了白苹果手势，但除了四指手势和力度感应之外其他手势都可以用</li>\n<li>亮度调节：可调，但是档位间隔不大，最低档位的时候屏幕还是较亮</li>\n<li>USB接口：四个接口均可正常使用</li>\n<li>摄像头：可用</li>\n<li>读卡器：无法驱动，有需要的建议使用读卡器</li>\n</ul>\n</li>\n<li><p><strong>声明：仓库中所有文件均可供个人用途和技术交流使用，在转载时请务必标明出处。不得将此仓库中的任何文件用于任何商业活动！</strong></p>\n</li>\n</ul>\n<h3 id=\"基本安装过程中的一些问题\"><a href=\"#基本安装过程中的一些问题\" class=\"headerlink\" title=\"基本安装过程中的一些问题\"></a>基本安装过程中的一些问题</h3><p>这部分不是主要内容，但还是讲两句吧。</p>\n<ul>\n<li><p>进入不了安装界面：</p>\n<p>首先请确认你安装镜像中的EFI是适用于你的电脑型号的。如果还是不行，请在<code>Clover</code>中的<code>Option</code>选项中选择<code>-v</code>以啰嗦模式启动，这样启动的时候会显示出详细的信息。将最后出现的报错信息拍下来或者整个启动过程录制下来以后，找网友求助吧。</p>\n</li>\n<li><p>安装macOS 10.15的过程中，在啰嗦模式中出现如下图所示报错：<img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_1.JPG\" alt=\"报错内容请注意最后一部分\"></p>\n<p>​        请在<code>Clover</code>中打上如图所示的这个补丁。<img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_2.png\" alt=\"补丁图示\"></p>\n</li>\n<li><p>进入安装界面且开始安装一段时间后，无法继续安装：</p>\n<p>请重新下载镜像，在下载完成以后检查镜像的<code>md5</code>值是否正确。如正确，再制作你的镜像U盘。</p>\n</li>\n<li><p>对于10.14.x的镜像进入安装界面后提示应用已经损坏，无法安装：</p>\n<p>请将你的bios时间往前调整至2019年10月25日以前，但是不要调整得太久远。这是因为旧的镜像中的证书会在上述时间以后过期导致无法安装。</p>\n</li>\n</ul>\n<h3 id=\"后续完善中的一些问题\"><a href=\"#后续完善中的一些问题\" class=\"headerlink\" title=\"后续完善中的一些问题\"></a>后续完善中的一些问题</h3><p>在安装完成以后，便可以进入系统了。但是这个时候的系统还是非常不完善的，需要做很多调整。进入系统后，先在 <code>关于本机-系统报告</code>中检查各个硬件项目是否被成功驱动，然后再根据没有成功驱动的项目，安装相对应的驱动或者打必要的补丁。但是前文说过：如果你的<strong>机型和硬件</strong>与我的相同且使用了我提供的EFI的话，基本安装完成以后机器就已经是几乎完美的一个状态了，只需要做很少的优化即可。</p>\n<p>如果使用的是与作者相同型号的电脑（型号完全一致，且未更换过任何硬件），以下项目是有故障的</p>\n<ul>\n<li>网卡未被驱动，无法上网</li>\n<li>蓝牙未驱动，无法使用蓝牙</li>\n<li>Siri, iMessage, FaceTime, HandOff无法使用</li>\n</ul>\n<p>以下项目有可能出现故障：</p>\n<ul>\n<li>声卡未驱动，没有声音，也无法录音</li>\n<li>无法调节显示器亮度，在<code>系统偏好设置</code>中也没有调节亮度的拖动条</li>\n<li>触控板未被驱动，无法使用触控板</li>\n</ul>\n<p>因此，仅仅完成了系统的安装是远远不够的。此时我们的电脑还无法被称为生产力工具。下面就介绍一些解决故障的办法以及系统优化的办法。</p>\n<ul>\n<li><p>首先应当获取软件安装权限，只有在此以后你才可以安装非App Store下载的，或者由非受信任的开发者开发的软件：</p>\n<p>在终端中输入：<code>sudo spctl --master-disable</code></p>\n</li>\n<li><p>建议安装的软件：</p>\n<ul>\n<li><code>Clover Configurator</code>：用于修改<code>Clover</code>的配置文件<code>config.plist</code></li>\n<li><code>Hackintool</code>：功能强大的黑苹果配置工具</li>\n<li><code>Kext Utility</code>：用于重建缓存</li>\n<li><code>CPU-S</code>：用于测试CPU变频档位</li>\n<li><code>MaciASL</code>：用于修改SSDT</li>\n</ul>\n<p>这些软件可以通过这个<a href=\"https://pan.baidu.com/s/12Kp9dv8HkVgm1VoVeXmC8w\">百度云链接</a>下载。密码：57qf。</p>\n</li>\n<li><p>机型选择：</p>\n<p>使用<code>Clover Configurator</code>打开<code>config.plist</code>，确保在<code>机型设置</code>中选择<code>MacBook Pro 14,1</code>。关于机型的选择，原则上是需要将你的电脑的集成显卡的型号与所选机型的集成显卡型号对应起来的，否则无法驱动你的显卡。具体的选择参见：<a href=\"https://blog.daliansky.net/Intel-core-display-platformID-finishing.html\">黑苹果必备：Intel核显platform ID整理及smbios速查表</a>。</p>\n</li>\n<li><p>驱动的正确安装方法：</p>\n<p>如果驱动没有正确安装，有极大的可能性会导致重启之后无法进入系统。作者本人就在这个问题上吃了很大的亏。关于驱动的安装，分为两种情况。</p>\n<ul>\n<li><p>操作的是<code>/EFI/CLOVER/kexts/Other</code>中的驱动文件。对于这种情况，不需要重建缓存。</p>\n</li>\n<li><p>操作的是<code>/Library/Extensions</code>或者<code>/System/Library/Extensions</code>中的驱动文件。如果操作的是这个两个文件夹中的驱动文件，则需要重建缓存。可以通过<code>Kext Utility</code>软件或者使用终端命令行来重建缓存。</p>\n</li>\n</ul>\n<p>重建缓存的命令：<code>sudo kextcache -i /</code>。</p>\n</li>\n<li><p>关于网络：</p>\n<p>对于使用安装了Intel（或者其他某些品牌）的网卡的电脑的朋友们，进入黑苹果系统以后网卡是没有驱动的，也就是说这个时候电脑是没有办法上网的。若是电脑安装了某些型号的免驱网卡，在macOS系统下电脑就可以直接连接网络。一般来说，如果不想拆机，可以使用USB网卡。但是使用USB网卡无法使用Siri, iMessage, FaceTime, HandOff等功能。</p>\n<p><strong>对于Intel的网卡，目前在macOS下是没有很好的办法驱动的。</strong>但是情况也在发生着一些改变。最近远景论坛已经有大佬写出了Intel网卡的驱动，但是还是存在一些问题。有兴趣的可以看看他的GitHub项目里面有没有支持你的网卡的型号：<a href=\"https://github.com/zxystd/IntelBluetoothFirmware\">IntelBluetoothFirmware</a>。</p>\n<p>对于网络的问题，可以使用USB网卡。或者直接将电脑的网卡拆下并更换为可以使用的免驱网卡。关于免驱网卡型号的选择，可以参考这个网站：<a href=\"https://www.itpwd.com/330.html#\">黑苹果建议的无线网卡 Hackintosh Compatible WiFi(20190505增加无线路由器推荐)</a>。</p>\n<p>当安装了合适的网卡以后，电脑便可以上网了。这个时候，这台电脑才基本可以投入使用。</p>\n</li>\n<li><p>关于<code>BCM94352Z(DW1560)</code>：</p>\n<p>作者使用的就是这种无线网卡。这个网卡是Wi-Fi和蓝牙二合一无线网卡。该网卡的无线局域网功能在macOS和Windows系统下都是免驱的。但是这个网卡在macOS下要驱动蓝牙需要三个驱动文件，分别为：<code>AirportBrcmFixup.kext</code>，<code>BrcmFirmwareData.kext</code>，<code>BrcmPatchRAM3.kext</code>。将这些驱动文件放入<code>/EFI/CLOVER/kexts/Other</code>下。注意，该目录下还应当存在<code>Lilu.kext</code>，否则驱动文件无法正常工作（仓库中提供的EFI文件夹中都已包含这些驱动文件了）。</p>\n<p>作者的电脑一度出现了电脑睡眠唤醒后蓝牙失效的情况，并被这个问题困扰了很久。一开始是参考了<a href=\"https://blog.daliansky.net/Broadcom-BCM94352z-DW1560-drive-new-posture.html\">Broadcom BCM94352z/DW1560驱动新姿势[新方法]</a>中的方法，但是问题并没有得到根本解决。之后在<code>/EFI/CLOVER/kexts/Other</code>中加入了<code>ACPIDebug.kext</code>，将电脑<code>hibernatemode</code>的值调整为<code>0</code>，并在<code>蓝牙偏好设置-高级选项</code>中取消勾选<code>允许蓝牙设备唤醒这台电脑</code>后，也没有解决该问题。然后作者尝试重新订制USB驱动来解决这个问题，但是还是没有能够解决这个问题。</p>\n<p>最后，作者更换了最新的蓝牙驱动，才最终完美解决了这个问题。需要注意的是，有时在睡眠唤醒之后，蓝牙图标会短暂的显示为失效状态，然后回复正常。</p>\n<p>在Windows系统下，可以自行安装<code>驱动人生</code>软件来安装蓝牙的驱动。</p>\n<p>目前市面上<code>DW1560</code>的价格在300元左右。实话说，这个价格完全是因为黑苹果这边的需求炒起来的。而同时社区中也有其他网卡的解决方案，除了上文所提到过的驱动还开发中的部分Intel网卡之外，<code>DW1820</code>是另一个价格相对低廉的选择。但是根据社区中的反馈，<code>DW1820</code>的表现并不是特别稳定，有可能会出现各种奇怪的问题。因此，作者建议还是直接购买<code>DW1560</code>比较好，一步到位，省了各种折腾和闹心。另外，你也可以购买Mac上的拆机网卡或者<code>DW1830</code>，后者的价格在500元左右，速度比<code>DW1560</code>更快。</p>\n</li>\n<li><p>关于睡眠：</p>\n<p>请打开<code>Hackintool</code>软件，并切换到<code>电源</code>一栏。再点击红框中的按钮，使得电源信息中红色的两行变为绿色。此操作可能可以解决一些睡眠问题。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_3.png\" alt=\"睡眠修复\"></p>\n</li>\n<li><p>定制USB驱动：</p>\n<p>定制USB驱动有可能可以帮助解决一些睡眠上的问题，其操作步骤也十分简单，所以博主强烈推荐大家还是定制一下。在此处附上订制USB驱动的教程：<a href=\"https://blog.daliansky.net/Intel-FB-Patcher-USB-Custom-Video.html\">Hackintool(Intel FB Patcher) USB定制视频</a>。需要注意的是，你有可能发现在使用了<code>USBInjectALL.kext</code>以后仍有端口无法加载/检测不到。你可以尝试在<code>Clover</code>的<code>config.plist</code>中添加下列<code>解除USB端口数量限制补丁</code>来解决这个问题。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_5.png\" alt=\"解除USB端口数量限制补丁\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Comment: USB port limit patch #1 10.15.x modify by DalianSky(credit ydeng)</span><br><span class=\"line\">Name: com.apple.iokit.IOUSBHostFamily</span><br><span class=\"line\">Find: 83FB0F0F</span><br><span class=\"line\">Replace: 83FB3F0F</span><br><span class=\"line\"></span><br><span class=\"line\">Comment: USB Port limit patch #2 10.15.x modify by DalianSky</span><br><span class=\"line\">Name: com.apple.driver.usb.AppleUSBXHCI</span><br><span class=\"line\">Find: 83F90F0F</span><br><span class=\"line\">Replace: 83F93F0F</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>开启<code>HiDPI</code>使屏幕看起来清晰：</p>\n<p>在终端中输入：<code>sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi-zh.sh)&quot;</code>，再按提示操作即可。</p>\n<p>详情请见：<a href=\"https://www.sqlsec.com/2018/09/hidpi.html\">HiDPI是什么？以及黑苹果如何开启HiDPI</a>。</p>\n</li>\n<li><p>打开<code>SSD Trim</code>：</p>\n<p>在终端中输入：<code>sudo trimforce enable</code>，然后输入<code>y</code>再回车，重复一次，电脑将自动重启。需要注意的是，使用原装SSD的朋友请<strong>不要</strong>打开这个功能，这会导致你的电脑在macOS下非常卡顿，几乎无法操作。</p>\n</li>\n<li><p>电脑卡顿的解决办法：</p>\n<p>在刚安装完黑苹果后，系统大概率会出现极为卡顿的情况。这种卡顿主要表现在：鼠标移动卡顿、动画严重掉帧、开机速度以及应用打开速度很慢、系统资源大量占用、电脑发热严重、无法正常关机。这些问题有的时候不太明显，有的时候则令电脑根本无法使用。上述问题有时在让电脑睡眠一段时间之后重新唤醒即可得到改善，但是无法根本解决。</p>\n<p>出现上述问题的根本原因就在于本型号电脑所使用的SSD——Intel SSDPEKKF360G7H对macOS的兼容并不好。若要正常使用该SSD的话必须在<code>/EFI/CLOVER/kexts/Other</code>中添加<code>HackrNVMeFamily.kext</code>。你可以在GitHub仓库文件主目录下的<code>kext</code>文件夹中找到这个驱动。在添加了这个驱动之后，系统的卡顿现象可以得到非常明显的改善，基本上做到了流畅运行，但是偶尔还是会有些许卡顿。</p>\n<p>解决这个问题最根本的方法还是更换SSD。作者的SSD已经更换为西部数据的SN500，故在EFI文件夹中删除了这个驱动文件。</p>\n</li>\n<li><p>电脑无法调节屏幕亮度的解决办法：</p>\n<p>一般情况下不会出现这样的情况，但是如果发生了，使用<code>Kext Utility</code>重建缓存后重启即可。</p>\n</li>\n<li><p>关于本机的<code>VoodooPS2Controller.kext</code>：</p>\n<p>在更换了EFI的hotpatch方法以后，最新版本的<code>VoodooPS2Controller.kext</code>已经可以正常使用。注意，新版本的<code>VoodooPS2Controller.kext</code>需要配合<code>VoodooInput.kext</code>使用。下面所说的定制<code>VoodooPS2Controller.kext</code>的内容已经过时，但此处仍加以保留，你可以根据自己的喜好按需使用。</p>\n<p>旧版本的<code>VoodooPS2Controller.kext</code>存放于GitHub仓库文件主目录下的<code>kext</code>文件夹中，它双指手势只支持上下左右滑动，三指手势在修改后实现了下表所述功能。它与新版驱动相比，优点在于：十分稳定，三指手势的识别成功率几乎达到100%，并且双指轻触十分灵敏。</p>\n<p>为迎合macOS调度中心默认的键位，我将该驱动的三只滑动手势的键盘映射作了些许调整，其对应关系如下表：</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>手势</th>\n<th>原本对应的快捷键</th>\n<th>修改后的快捷键</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>三指上滑</td>\n<td>⌘+ˆ+↑</td>\n<td>ˆ+↑</td>\n<td>调度中心</td>\n</tr>\n<tr>\n<td>三指下滑</td>\n<td>⌘+ˆ+↓</td>\n<td>ˆ+↓</td>\n<td>App Exposé</td>\n</tr>\n<tr>\n<td>三指左滑</td>\n<td>⌘+ˆ+←</td>\n<td>ˆ+→</td>\n<td>向右切换一个全屏页面</td>\n</tr>\n<tr>\n<td>三指右滑</td>\n<td>⌘+ˆ+→</td>\n<td>ˆ+←</td>\n<td>向左切换一个全屏页面</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>触控板没有反应的情况：</p>\n<p>一开始我以为是相关驱动没有成功加载的缘故，但是后来发现这是因为触控板被误锁定了。按下电脑键盘右上角的<code>prt sc</code>键可以锁定/解锁触控板。</p>\n</li>\n<li><p>关于<code>CPUFriend.kext</code>：</p>\n<p>该驱动文件用于实现CPU的变频功能。由于该驱动程序只能根据用户个人的电脑定制，所以请不要直接使用仓库EFi文件夹中所提供的驱动文件。具体安装方法参见：<a href=\"https://change-y.github.io/2018/04/30/利用CPUFriend-kext实现变频/\">利用CPUFriend.kext实现变频</a>。</p>\n<p>安装完成后，可以使用CPU-S来检测自己电脑的变频档位。</p>\n</li>\n<li><p>打开原生的NTFS读写功能：</p>\n<p><strong>该操作有一定风险，是否需要开启请自行判断。</strong></p>\n<p>在macOS的默认状态下，NTFS格式的磁盘是只能读不能写的。但是我们可以将隐藏的功能打开，从而可以对该格式的磁盘进行写操作，详情参考这个链接：<a href=\"http://bbs.pcbeta.com/viewthread-1742688-1-8.html\">macOS打开原生的NTFS读写功能</a>。</p>\n<p>如果你对NTFS格式的磁盘读写功能有刚需，也有很多相关的软件可供选择。此处略去不表。</p>\n</li>\n<li><p>修复Windows和macOS下时钟不同步的问题：</p>\n<p>对于安装了双系统的电脑，在从macOS切换回Windows之后会发现Windows的系统时间与当前时间不符。解决这个问题的办法是：在Windows下，打开CMD输入下面的命令后回车。</p>\n<p><code>Reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1</code>。</p>\n</li>\n<li><p>关于显卡<code>platform-id</code>的选择：</p>\n<p>本机的显卡就是<code>Intel HD Graphics 620</code>，是属于7代Kaby Lake平台的，其<code>platform-id</code>为<code>0x5916000</code>，对应机型为<code>MacbookPro 14,2</code>。但是经过本人实践发现，如果注入的是HD 620的id，系统显示器输出的<code>帧缓冲深度(Framebuffer depth)</code>为诡异的30位，这对应的是10位的显示器。由于电脑显示器本身为8位的，因此10位的颜色输出会导致高斯模糊和半透明的画面出现严重的色阶断层（色带）。一开始我以为是显示器EDID不匹配的问题，但是经过搜索发现，在Kaby Lake平台上，这个问题是因为显卡<code>platform-id</code>选择得不对，应该是需要仿冒6代Sky Lake平台的<code>Intel HD Graphics 520</code>才可以得到正确的24位的帧缓冲深度输出，如下图所示。</p>\n<p>关于这个问题的具体内容和解决方法可以参看这个<a href=\"https://www.tonymacx86.com/threads/help-weird-ring-like-blur-and-images-in-mojave.262566/#post-1834064\">网页</a>。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hpenvy13hackintosh_4.png\" alt=\"正确的帧缓冲深度\"></p>\n</li>\n</ul>\n<p>至此，黑苹果的安装和完善就差不多结束了。现在可以登陆iCloud以及其他苹果服务，并安装自己需要的软件了。</p>\n<p>附：博主电脑配置</p>\n<table>\n<thead>\n<tr>\n<th>型号</th>\n<th>HP Envy-13 ad024TU</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CPU</td>\n<td>Intel Core i7-7500U(2.7GHz)</td>\n</tr>\n<tr>\n<td>RAM</td>\n<td>8GB DDR4</td>\n</tr>\n<tr>\n<td>显卡</td>\n<td>Intel HD Graphics 620</td>\n</tr>\n<tr>\n<td>硬盘</td>\n<td><del>Intel SSDPEKKF360G7H 360G</del> （已更换为WD SN500）</td>\n</tr>\n<tr>\n<td>网卡</td>\n<td><del>Intel 7265NGW</del>（已更换为DW1560）</td>\n</tr>\n<tr>\n<td>声卡</td>\n<td>ALC295</td>\n</tr>\n</tbody></table>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n目前，Open Core已经成为黑苹果社区使用的主流引导，博主同样将黑苹果迁移到了OC上面，有需要的话可以下载<a href=\"https://github.com/Astrobr/OCForEnvy13-ad0xx\">这个仓库</a>中提供的EFI文件。此外，更换电脑之后我不打算再折腾黑苹果了，于Github上存放EFI的仓库将不再更新。\n</div>\n</article>\n\n\n\n"},{"title":"Hexo博客的安装和自动部署","date":"2021-08-16T10:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/TravisCI.png","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/TravisCI.png","excerpt":"填坑。","_content":"\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第二篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n- “建站搭博客”系列之一：[华为云+nginx服务器搭建总结](https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/)\n- “建站搭博客”系列之三：[Hexo主题Icarus的自定义](https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/)\n\n> 在2020年年初Astroblog搭建完成的时候，我就打算记录下当时整个服务器搭建和博客的部署过程。这个过程我打算分为三篇文章来水，分别是服务器搭建、Hexo安装与自动部署、博客主题Icarus的自定义。后来由于种种原因，只写完了三篇文章中的第一篇，剩下两篇拖更到现在。前段时间刚好换了电脑，由于当时部署博客的很多细节都不记得了，迁移的过程尤其痛苦，踩了各种坑之后才终于搞定。于是趁热打铁，赶紧把这两个坑填了，权当备忘。\n\n# 关于Hexo\n\nHexo是一个高效、简洁的博客框架。它基于Node.js，通过几条命令就可以由Markdown文件快速生成静态的HTML网页。静态网站具有轻量、速度快等特点。它的部署非常方便灵活，不但可以部署在服务器上，还可以部署在静态托管网站上，比如Github Pages。本文主要讨论如何将Hexo部署在服务器上。\n\n首先来认识一下Hexo项目中有什么文件：\n\n```yaml\n.\n├── _config.yml #Hexo的配置文件\n├── db.json #Hexo自动生成的文件\n├── package.json #插件配置文件，下同\n├── package-lock.json \n├── node_modules #生成网站需要用到的Node.js模块\n├── scaffolds #存放模板的文件夹\n├── source #博客Markdown源文件夹\n├── public #存放生成的静态HTML文件\n└── themes #主题文件夹\n```\n\n一般来说，Hexo部署的过程是这样的：\n\n1. 在本地编辑Markdown文件并通过Hexo生成静态网页，存放于`./public`文件夹中\n2. 将`./public`文件夹中的文件复制到远程服务器上\n3. 设置服务器访问的网址为博客首页\n\n你同样可以在服务器上配置Hexo环境，将Markdown源文件上传到服务器上编译。不过一般还是推荐在本地编译，这样比较方便，并且还可以预览生成的博客。\n\n下面开始介绍Hexo博客安装和部署的具体操作。\n\n# Windows系统下Hexo的安装与部署\n\n## 安装相关依赖\n\nHexo是基于Node.js来生成网页的，那么首先就要安装Node.js。Windows用户清前往[Node.js官方下载地址](http://nodejs.cn/download/)下载最新版本的`.msi`格式的安装包，下载之后打开安装包直接安装即可。安装程序可能会询问你是否自动安装必要的工具，这里没有必要勾选这个选项。\n\n![](https://astrobear.top/resource/astroblog/content/install_node.png)\n\n一般来说安装最新版本的Node.js就可以了。但是作者在迁移博客的过程中发现，由于没有更新Hexo至最新版本，使用最新版本的Node.js会导致编译生成的网页全是空白的，所以作者最后还是使用了`v12.22.5`版本的Node.js。有需要的朋友可以在[这里](https://npm.taobao.org/mirrors/node/)下载到历史版本。\n\n## 安装Hexo并撰写博客\n\n根据Hexo官方提供的安装方法，安装过程需要使用npm包管理工具。新版本的Node.js已经集成了npm，所以打开Powershell终端直接按顺序输入下面的命令行进行安装即可：\n\n```shell\nnpm install hexo-cli -g #安装hexo\ncd <dir> #进入选定的博客存放目录\nhexo init #在当前目录初始化博客\nhexo g #生成博客文件\nhexo s #在本地浏览器预览你的博客\n```\n\n如果你看到终端输出了类似下面的信息，恭喜你，你的博客已经构建成功了！你可以在浏览器中访问`http://localhost:4000`来预览你的博客。\n\n![](https://astrobear.top/resource/astroblog/content/hexo_init.png)\n\n你可以使用`./scafflods/post.md`作为模板创建你的第一篇博客。使用编辑器打开这个文件，可以模仿下面的内容来编写你的文章。模板中三根横线之间的内容是`yaml`文件头，并不使用Markdown语法，需要注意。\n\n```yaml\n---\ntitle: Hello World! #标题\ndate: 2021-8-17 18:30:00 #按格式填写博文创建的日期\ntags: #按照下面的格式添加博文的标签\n    - demo\n    - hello\n    \n#在横线下面开始编辑你的博客正文\n---\nHello World!\n你好，世界！\n```\n\n写完以后，将这个文件放入`./source/_posts`文件夹中，该文件夹中的Markdown文件会被编译生成网页。而存放在`./source/_drafts`文件夹中的文件则只是草稿，并不会在网页中出现。\n\n最后，在你的博客目录下，再次执行`hexo g`和`hexo s`两条命令，你编辑的第一篇博客便可以以网页的形式在浏览器中预览了。另外，你还可以通过`hexo clean`命令来清除之前生成的HTML网页。\n\n## 在服务器上部署Hexo\n\n在本地生成了博客网页以后还不够，只有我们将`./public`中的HTML文件上传到服务器之后，其他人才能通过互联网浏览我们的博客。\n\n你可以使用命令行或者FTP客户端来将你的博客上传到服务器上的指定文件夹。由于作者不擅长使用命令行，所以还是使用了`FileZilla`这个有图形化界面的FTP软件来完成这个工作。\n\n最后，你需要将你的服务器的IP地址或者域名定向到你博客的首页。这里以nginx为例简单说说配置方法。\n\n在nginx的配置文件中的`server-location`项中，将`index`的值修改为博客首页的HTML文件，也即`<dir>/public/intex.html`，其中`<dir>`为你在服务器上存放博客`pubic`文件夹的目录。\n\n保存文件并重启nginx服务后，你应该便可以通过你的服务器的IP地址或者域名来访问你的博客了！\n\n# 配置博客自动部署功能\n\n通过上面的方法，可以完成博客的编辑和部署工作。但是每次编辑完成以后，部署工作显得复杂繁琐。有没有一种办法，能够在完成博客的编辑以后，通过简单的操作就可以将博客部署到服务器上呢？答案是有的。我想实现的效果大概是这样：\n\n1. 完成Markdown的编辑以后，直接上传`./source/_posts`文件夹中的源文件\n2. 通过某种方式自动生成HTML文件并将其拷贝到服务器上\n\n这样我们就不需要每次都进行复杂的部署，并且可以专注于写作本身。\n\n下面具体来讲一下怎么实现这个目标。\n\n## 什么是持续集成？\n\n想要实现博客的自动化部署，就必须引入持续集成这个概念。\n\n> 持续集成（Continuous Integration, CI）指的是，频繁地（一天多次）将代码集成到主干。持续集成可以使产品快速迭代，同时保证质量。——[持续集成是什么？ - 阮一峰的网络日志](https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html)\n\n一般来说，持续集成可以让人们快速发现错误。在持续集成之后，随之而来的是持续交付和持续部署。持续交付指的是频繁地将软件提交给质量团队或者用户进行评审，如果评审通过，那么久将软件自动部署到生产环境中。我们通常说的持续集成，同时包括了上面三个过程。\n\n对于个人博客而言，持续集成和持续交付通常是一体的，也就是我们编辑博客内容的过程。而现在我们需要实现的就是持续部署的功能，即将自己的博客源文件自动生成网页并部署到服务器上。\n\n实现持续集成，就必须使用相应的工具。目前市面上的主流持续集成工具有：Jenkins、Travis CI、Gitlab CI等。在这里我们使用Github + Travis CI的组合来实现持续集成的功能。\n\nTravis CI是一个依赖于Github的持续集成工具，它从Github的代码仓库中拉取代码。它在检测到仓库文件有更改之后，会在远程自动创建一个虚拟机，然后根据你的Travis CI配置文件编译你仓库中的代码并执行其他一些操作。\n\n需要注意的是，Travis CI的[官方网址](https://travis-ci.com)现在变为**travis-ci.com**而非travis-ci.org。后者现在是只读模式，请务必注意。\n\n## Github授权并生成Token\n\n使用Travis CI首先就要对其授权使其可以访问自己的Github仓库。\n\n进入Travis CI的官网后直接用Github账号登录，根据提示开通Travis CI对仓库的访问授权。你可以选择允许访问所有仓库，也可以指定部分仓库以供访问。\n\n在自动部署的过程中，Travis CI需要通过命令对Github的仓库进行修改操作，这就需要我们登录Github服务。但是在登录的过程中，将自己的密码直接暴露出去是很危险的。所以，这里使用Token（令牌）来代替密码，以增强安全性。\n\n关于生成Github Token的方法，请看[创建个人访问令牌 - GitHub Docs](https://docs.github.com/cn/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token)。\n\n请妥善保存生成的Token。\n\n## 使用Travis CI进行持续集成\n\n### 配置ssh免密登录服务器\n\n自动部署必然会对服务器端的文件进行操作，因此必须远程登录服务器。但是部署过程是由Travis CI自动完成的，我们也无法在Travis CI的控制台中输入服务器的登录密码。因此我们还要能够免密登录服务器。\n\n免密登录是基于密钥对来实现的。密钥对分为私钥和公钥，私钥以明文形式存储，由我们自己保存，千万不可泄露。而公钥由私钥加密而来，在进行ssh免密登录时，在网络中由本地传送到服务器的就是公钥。本地电脑和服务器经过一系列操作后比对生成的校验值，如果校验通过便可以登录到服务器。\n\nssh免密登录的具体原理可以参考下图（来源：[图解SSH原理 - 简书 (jianshu.com)](https://www.jianshu.com/p/33461b619d53)）。\n\n![](https://astrobear.top/resource/astroblog/content/ssh.jpeg)\n\n接下来讲讲实现方法。\n\n在Powershell中输入：`ssh-keygen -t rsa`。\n\n之后会提示你输入秘钥的名字，如果直接按回车跳过则会使用默认的文件名`id_rsa`。\n\n接着会让你输入并确定需要加密的密码，这里我们直接跳过。\n\n然后我们就可以在`C:/Users/<你的用户名>/.ssh`中看到新创建的两个文件，其中`id_rsa`为私钥，`id_rsa.pub`为公钥。\n\n在刚才的那个文件夹中创建文件`config`，不需要后缀名。其内容如下：\n\n```\n# 远程主机名称\nHost <你的服务器域名或ip地址>\n# 远程主机域名或者 ip 地址\nHostName <你的服务器域名或ip地址>\n# 认证方式\nPreferredAuthentications publickey\n# 私钥位置\nIdentityFile C:/Users/<你的用户名>/.ssh/id_rsa\n# 用户名\nUser root\n```\n\n将公钥复制一份，重命名为`authorized_keys`。然后将`id_rsa.pub`和`authorized_keys`上传到服务器的`~/.ssh`文件夹中。\n\n在终端里输入：`ssh root@<你的服务器域名或ip地址>`。如果不需要密码就可以登录的话，那就说明ssh免密登录设置成功了。\n\n如果在完成了上面的步骤之后在登录服务器时仍然需要输入密码，或者出现了类似下面的报错：\n\n`Permission denied (publickey,gssapi-keyex,gssapi-with-mic).`\n\n那么请尝试执行下面三条命令，更改服务器上`~/.ssh`文件夹的权限。\n\n```\nchmod 700 ~/.ssh/\nchmod 700 /home/userName\nchmod 600 ~/.ssh/authorized_keys\n```\n\n### 配置Travis Ci\n\n在博客的的根目录下面创建Travis CI的配置文件`.travis.yml`，并且将下面模板的内容添加到文件中。\n\n```yaml\n#设置构建环境为Node.js\nlanguage: node_js \n#选择Node.js版本，我这里由于没有更新Hexo，所以使用了较老的版本，该项值一般为\"stable\"\nnode_js: 12.22.5 \n\n#设置需要编译的代码分支，Travis CI只检测当前分支的变动，请根据自己的实际情况修改\nbranches:\n  only:\n  - hexo\n\n#在每次构建之前需要先配好环境\nbefore_install:\n#配置Travis CI免密登录服务器\n- openssl aes-256-cbc -K $encrypted_<key>_key -iv $encrypted_<iv>_iv\n  -in <id_rsa.enc> -out ~/.ssh/id_rsa -d\n- chmod 600 ~/.ssh/id_rsa\n- eval $(ssh-agent)\n- ssh-add ~/.ssh/id_rsa\n- cp ./ssh_config ~/.ssh/config\n#配置Github信息以使Travis CI可以更改仓库\n- git config --global user.name \"$GIT_NAME\"\n- git config --global user.email \"$GIT_EMAIL\"\n#安装Hexo\n- npm install -g hexo-cli\n\n#安装package.json中的插件\ninstall:\n- npm install\n\n#生成网页\nscript:\n- hexo clean\n- hexo generate\n\n#生成成功之后需要执行的操作（部署）\nafter_success:\n#将./public文件夹中的网页复制到服务器上的指定位置\n- scp -o stricthostkeychecking=no -r ./public/* root@<你的域名或IP>:<博客网页存放的路径>\n#在Travis CI上切换到你的博客的./public文件夹，在该路径下初始化git，以\"Travis CI Auto Builder\"的名称提交代码并推送到\"master\"分支上\n- cd ./public\n- git init\n- git add --all .\n- git commit -m \"Travis CI Auto Builder\"\n- git push --quiet --force https://$GIT_TOKEN@<你博客的Github仓库网址>\n  master\n  \n#配置已知的主机，以保证可以成功登陆\naddons:\n  ssh_known_hosts:\n  - <你的域名或IP>\n```\n\n观察上面的文件可以发现，其中以`$`开头的变量一共出现了五次。在Travis CI的配置文件中，这些变量为环境变量，它们的值不以明文的形式出现在配置文件中，需要你自己在Travis CI的网页上设置值。\n\n在Travis CI的网页中找到你的博客的仓库。点击右上角的`More options`按钮后再点击`Settings`进入设置页面。\n\n在设置页面中，必须要打开`General`栏中的`Build pushed branches`。否则即使你推送了代码，Travis CI不会自动构建项目。\n\n然后在`Environment Variables`一栏中的空白文本框处，分别填写你的环境变量的名称`NAME`和值`VALUE`，然后点击`Add`按钮以添加。在这一小节，我们需要添加三个环境变量：\n\n|   Name    |                Value                 |\n| :-------: | :----------------------------------: |\n| GIT_EMAIL |       <填写你Github绑定的邮箱>       |\n| GIT_NAME  |        <填写你Github的账户名>        |\n| GIT_TOKEN | <填写你在上一节中生成的Github Token> |\n\n### 文件加密\n\n接下来讲讲Travis CI免密登录服务器的配置以及最后剩下的两个环境变量。\n\n类比之前设置本地ssh免密登录服务器的方法，要想让Travis CI生成的虚拟机可以免密登录服务器，其必须要有公钥`id_rsa.pub`、私钥`id_rsa`、以及配置文件`config`。但是直接将私钥以明文形式上传太危险了。Travis CI提供了加密服务，可以将私钥加密以后上传到它的服务器，再在其虚拟机上解密生成私钥。这样一来，Travis CI就可以安全地进行ssh免密登录了。\n\n接下来的加密操作建议在Linux或者macOS下进行，在Windows 10上操作有可能会产生`bad decrypt`的错误。（参见：[File decryption fails (wrong final block length) on Windows · Issue #4746 · travis-ci/travis-ci (github.com)](https://github.com/travis-ci/travis-ci/issues/4746)）\n\n在加密操作之前，请先确认你的电脑上是否安装有ruby，否则无法使用gem包管理工具。\n\n执行下面的命令以安装Travis：`gem install travis`。\n\n登录Travis：`travis login --github-token <token> --pro`。注意这里必须加上后缀`--pro`，否则这个命令默认登录的是`https://api.travis-ci.org`而非`https://api.travis-ci.com`。\n\n在存放有你的私钥`id_rsa`以及`.travis.yml`的目录下执行：`travis encrypt-file id_rsa --add --pro `。如果这个目录不是你存放博客的Github仓库的本地文件夹，那么请按照给出的提示添加后缀。\n\n执行完毕后，在该文件夹下会新增一个`id_rsa.enc`文件。这个文件就是经过加密后的私钥了。检查`.travis.yml`文件，会发现其中多了一行类似于下面的代码：\n\n```yaml\n- openssl aes-256-cbc -K $encrypted_<key>_key -iv $encrypted_<iv>_iv  -in id_rsa.enc -out id_rsa -d\n```\n\n上面`<key>`和`<iv>`的值是随机生成的数字和字母的组合，该命令的作用在于解密`id_rsa.enc`以得到私钥`id_rsa`。`-in`表示输入文件，`-out`表示解密后的文件，我们将其路径修改为`~/.ssh/id_rsa`，可以得到：\n\n```yaml\n- openssl aes-256-cbc -K $encrypted_<key>_key -iv $encrypted_<iv>_iv\n  -in <id_rsa.enc> -out ~/.ssh/id_rsa -d\n```\n\n此外，在Travis CI对应仓库的设置中，还会新增两个环境变量`encrypted_<key>_key`与`encrypted_<iv>_iv`。\n\n在得到私钥后，我们还要进行下面的操作以使Travis CI可以免密登录服务器。\n\n在`.travis.yml`中按照模板的格式添加以下代码：\n\n```yaml\n- chmod 600 ~/.ssh/id_rsa\n- eval $(ssh-agent)\n- ssh-add ~/.ssh/id_rsa\n- cp ./ssh_config ~/.ssh/config\n```\n\n然后，将`id_rsa.enc`移入你的博客的根目录下，并切记**删除你在博客目录下的私钥！**。\n\n在博客根目录下新建文件`ssh_config`，将下面的内容复制进去并保存。我们需要它来配置Travis CI上的ssh登录过程。\n\n```\nHost *\n  User git\n  StrictHostKeyChecking no\n  IdentityFile ~/.ssh/id_rsa\n  IdentitiesOnly yes\n```\n\n到这里，所有的配置工作就完成了！\n\n## 最终实现的效果\n\n经过上面的一系列复杂操作，我们最终实现了博客的持续集成，其工作流如下：\n\n1. 在本地编辑Markdown文件\n2. 编辑完成后直接推送到Github的目标分支上\n3. Travis CI检测到指定分支上文件的更改\n4. Travis CI创建虚拟机并依据配置文件生成博客网页文件\n5. Travis CI将生成的网页复制到服务器的指定位置，完成部署\n\n在部署的过程中，只有第二步是需要我们进行操作的，其他的工作全部由Travis CI自动完成了，非常的方便。\n\n点击Travis CI对应仓库标题右侧的绿色图标可以将其以Markdown格式添加到你的Github仓库的`readme.md`文件中。如果Travis CI操作的分支不是默认分支，那么这个图标将只显示`unknown`的状态。\n\n![](https://astrobear.top/resource/astroblog/content/build_passing_mark.png)\n\n\n\n---\n\n参考：\n\n[使用 Travis 打造 SpringBoot 应用持续集成和自动部署 | Travis CI 初体验 (juejin.cn)](https://juejin.cn/post/6946220560938434596#heading-13)\n\n[基于 Hexo 的全自动博客构建部署系统 - KChen's Blog](https://kchen.cc/2016/11/12/hexo-instructions/#总结)\n\n","source":"_posts/Hexo的安装和自动部署.md","raw":"---\ntitle: Hexo博客的安装和自动部署\ndate: 2021-08-16 18:00:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Hexo\n\t- Travis CI\n\t- Blog\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/TravisCI.png\n\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/TravisCI.png\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 填坑。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n\n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第二篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n- “建站搭博客”系列之一：[华为云+nginx服务器搭建总结](https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/)\n- “建站搭博客”系列之三：[Hexo主题Icarus的自定义](https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/)\n\n> 在2020年年初Astroblog搭建完成的时候，我就打算记录下当时整个服务器搭建和博客的部署过程。这个过程我打算分为三篇文章来水，分别是服务器搭建、Hexo安装与自动部署、博客主题Icarus的自定义。后来由于种种原因，只写完了三篇文章中的第一篇，剩下两篇拖更到现在。前段时间刚好换了电脑，由于当时部署博客的很多细节都不记得了，迁移的过程尤其痛苦，踩了各种坑之后才终于搞定。于是趁热打铁，赶紧把这两个坑填了，权当备忘。\n\n# 关于Hexo\n\nHexo是一个高效、简洁的博客框架。它基于Node.js，通过几条命令就可以由Markdown文件快速生成静态的HTML网页。静态网站具有轻量、速度快等特点。它的部署非常方便灵活，不但可以部署在服务器上，还可以部署在静态托管网站上，比如Github Pages。本文主要讨论如何将Hexo部署在服务器上。\n\n首先来认识一下Hexo项目中有什么文件：\n\n```yaml\n.\n├── _config.yml #Hexo的配置文件\n├── db.json #Hexo自动生成的文件\n├── package.json #插件配置文件，下同\n├── package-lock.json \n├── node_modules #生成网站需要用到的Node.js模块\n├── scaffolds #存放模板的文件夹\n├── source #博客Markdown源文件夹\n├── public #存放生成的静态HTML文件\n└── themes #主题文件夹\n```\n\n一般来说，Hexo部署的过程是这样的：\n\n1. 在本地编辑Markdown文件并通过Hexo生成静态网页，存放于`./public`文件夹中\n2. 将`./public`文件夹中的文件复制到远程服务器上\n3. 设置服务器访问的网址为博客首页\n\n你同样可以在服务器上配置Hexo环境，将Markdown源文件上传到服务器上编译。不过一般还是推荐在本地编译，这样比较方便，并且还可以预览生成的博客。\n\n下面开始介绍Hexo博客安装和部署的具体操作。\n\n# Windows系统下Hexo的安装与部署\n\n## 安装相关依赖\n\nHexo是基于Node.js来生成网页的，那么首先就要安装Node.js。Windows用户清前往[Node.js官方下载地址](http://nodejs.cn/download/)下载最新版本的`.msi`格式的安装包，下载之后打开安装包直接安装即可。安装程序可能会询问你是否自动安装必要的工具，这里没有必要勾选这个选项。\n\n![](https://astrobear.top/resource/astroblog/content/install_node.png)\n\n一般来说安装最新版本的Node.js就可以了。但是作者在迁移博客的过程中发现，由于没有更新Hexo至最新版本，使用最新版本的Node.js会导致编译生成的网页全是空白的，所以作者最后还是使用了`v12.22.5`版本的Node.js。有需要的朋友可以在[这里](https://npm.taobao.org/mirrors/node/)下载到历史版本。\n\n## 安装Hexo并撰写博客\n\n根据Hexo官方提供的安装方法，安装过程需要使用npm包管理工具。新版本的Node.js已经集成了npm，所以打开Powershell终端直接按顺序输入下面的命令行进行安装即可：\n\n```shell\nnpm install hexo-cli -g #安装hexo\ncd <dir> #进入选定的博客存放目录\nhexo init #在当前目录初始化博客\nhexo g #生成博客文件\nhexo s #在本地浏览器预览你的博客\n```\n\n如果你看到终端输出了类似下面的信息，恭喜你，你的博客已经构建成功了！你可以在浏览器中访问`http://localhost:4000`来预览你的博客。\n\n![](https://astrobear.top/resource/astroblog/content/hexo_init.png)\n\n你可以使用`./scafflods/post.md`作为模板创建你的第一篇博客。使用编辑器打开这个文件，可以模仿下面的内容来编写你的文章。模板中三根横线之间的内容是`yaml`文件头，并不使用Markdown语法，需要注意。\n\n```yaml\n---\ntitle: Hello World! #标题\ndate: 2021-8-17 18:30:00 #按格式填写博文创建的日期\ntags: #按照下面的格式添加博文的标签\n    - demo\n    - hello\n    \n#在横线下面开始编辑你的博客正文\n---\nHello World!\n你好，世界！\n```\n\n写完以后，将这个文件放入`./source/_posts`文件夹中，该文件夹中的Markdown文件会被编译生成网页。而存放在`./source/_drafts`文件夹中的文件则只是草稿，并不会在网页中出现。\n\n最后，在你的博客目录下，再次执行`hexo g`和`hexo s`两条命令，你编辑的第一篇博客便可以以网页的形式在浏览器中预览了。另外，你还可以通过`hexo clean`命令来清除之前生成的HTML网页。\n\n## 在服务器上部署Hexo\n\n在本地生成了博客网页以后还不够，只有我们将`./public`中的HTML文件上传到服务器之后，其他人才能通过互联网浏览我们的博客。\n\n你可以使用命令行或者FTP客户端来将你的博客上传到服务器上的指定文件夹。由于作者不擅长使用命令行，所以还是使用了`FileZilla`这个有图形化界面的FTP软件来完成这个工作。\n\n最后，你需要将你的服务器的IP地址或者域名定向到你博客的首页。这里以nginx为例简单说说配置方法。\n\n在nginx的配置文件中的`server-location`项中，将`index`的值修改为博客首页的HTML文件，也即`<dir>/public/intex.html`，其中`<dir>`为你在服务器上存放博客`pubic`文件夹的目录。\n\n保存文件并重启nginx服务后，你应该便可以通过你的服务器的IP地址或者域名来访问你的博客了！\n\n# 配置博客自动部署功能\n\n通过上面的方法，可以完成博客的编辑和部署工作。但是每次编辑完成以后，部署工作显得复杂繁琐。有没有一种办法，能够在完成博客的编辑以后，通过简单的操作就可以将博客部署到服务器上呢？答案是有的。我想实现的效果大概是这样：\n\n1. 完成Markdown的编辑以后，直接上传`./source/_posts`文件夹中的源文件\n2. 通过某种方式自动生成HTML文件并将其拷贝到服务器上\n\n这样我们就不需要每次都进行复杂的部署，并且可以专注于写作本身。\n\n下面具体来讲一下怎么实现这个目标。\n\n## 什么是持续集成？\n\n想要实现博客的自动化部署，就必须引入持续集成这个概念。\n\n> 持续集成（Continuous Integration, CI）指的是，频繁地（一天多次）将代码集成到主干。持续集成可以使产品快速迭代，同时保证质量。——[持续集成是什么？ - 阮一峰的网络日志](https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html)\n\n一般来说，持续集成可以让人们快速发现错误。在持续集成之后，随之而来的是持续交付和持续部署。持续交付指的是频繁地将软件提交给质量团队或者用户进行评审，如果评审通过，那么久将软件自动部署到生产环境中。我们通常说的持续集成，同时包括了上面三个过程。\n\n对于个人博客而言，持续集成和持续交付通常是一体的，也就是我们编辑博客内容的过程。而现在我们需要实现的就是持续部署的功能，即将自己的博客源文件自动生成网页并部署到服务器上。\n\n实现持续集成，就必须使用相应的工具。目前市面上的主流持续集成工具有：Jenkins、Travis CI、Gitlab CI等。在这里我们使用Github + Travis CI的组合来实现持续集成的功能。\n\nTravis CI是一个依赖于Github的持续集成工具，它从Github的代码仓库中拉取代码。它在检测到仓库文件有更改之后，会在远程自动创建一个虚拟机，然后根据你的Travis CI配置文件编译你仓库中的代码并执行其他一些操作。\n\n需要注意的是，Travis CI的[官方网址](https://travis-ci.com)现在变为**travis-ci.com**而非travis-ci.org。后者现在是只读模式，请务必注意。\n\n## Github授权并生成Token\n\n使用Travis CI首先就要对其授权使其可以访问自己的Github仓库。\n\n进入Travis CI的官网后直接用Github账号登录，根据提示开通Travis CI对仓库的访问授权。你可以选择允许访问所有仓库，也可以指定部分仓库以供访问。\n\n在自动部署的过程中，Travis CI需要通过命令对Github的仓库进行修改操作，这就需要我们登录Github服务。但是在登录的过程中，将自己的密码直接暴露出去是很危险的。所以，这里使用Token（令牌）来代替密码，以增强安全性。\n\n关于生成Github Token的方法，请看[创建个人访问令牌 - GitHub Docs](https://docs.github.com/cn/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token)。\n\n请妥善保存生成的Token。\n\n## 使用Travis CI进行持续集成\n\n### 配置ssh免密登录服务器\n\n自动部署必然会对服务器端的文件进行操作，因此必须远程登录服务器。但是部署过程是由Travis CI自动完成的，我们也无法在Travis CI的控制台中输入服务器的登录密码。因此我们还要能够免密登录服务器。\n\n免密登录是基于密钥对来实现的。密钥对分为私钥和公钥，私钥以明文形式存储，由我们自己保存，千万不可泄露。而公钥由私钥加密而来，在进行ssh免密登录时，在网络中由本地传送到服务器的就是公钥。本地电脑和服务器经过一系列操作后比对生成的校验值，如果校验通过便可以登录到服务器。\n\nssh免密登录的具体原理可以参考下图（来源：[图解SSH原理 - 简书 (jianshu.com)](https://www.jianshu.com/p/33461b619d53)）。\n\n![](https://astrobear.top/resource/astroblog/content/ssh.jpeg)\n\n接下来讲讲实现方法。\n\n在Powershell中输入：`ssh-keygen -t rsa`。\n\n之后会提示你输入秘钥的名字，如果直接按回车跳过则会使用默认的文件名`id_rsa`。\n\n接着会让你输入并确定需要加密的密码，这里我们直接跳过。\n\n然后我们就可以在`C:/Users/<你的用户名>/.ssh`中看到新创建的两个文件，其中`id_rsa`为私钥，`id_rsa.pub`为公钥。\n\n在刚才的那个文件夹中创建文件`config`，不需要后缀名。其内容如下：\n\n```\n# 远程主机名称\nHost <你的服务器域名或ip地址>\n# 远程主机域名或者 ip 地址\nHostName <你的服务器域名或ip地址>\n# 认证方式\nPreferredAuthentications publickey\n# 私钥位置\nIdentityFile C:/Users/<你的用户名>/.ssh/id_rsa\n# 用户名\nUser root\n```\n\n将公钥复制一份，重命名为`authorized_keys`。然后将`id_rsa.pub`和`authorized_keys`上传到服务器的`~/.ssh`文件夹中。\n\n在终端里输入：`ssh root@<你的服务器域名或ip地址>`。如果不需要密码就可以登录的话，那就说明ssh免密登录设置成功了。\n\n如果在完成了上面的步骤之后在登录服务器时仍然需要输入密码，或者出现了类似下面的报错：\n\n`Permission denied (publickey,gssapi-keyex,gssapi-with-mic).`\n\n那么请尝试执行下面三条命令，更改服务器上`~/.ssh`文件夹的权限。\n\n```\nchmod 700 ~/.ssh/\nchmod 700 /home/userName\nchmod 600 ~/.ssh/authorized_keys\n```\n\n### 配置Travis Ci\n\n在博客的的根目录下面创建Travis CI的配置文件`.travis.yml`，并且将下面模板的内容添加到文件中。\n\n```yaml\n#设置构建环境为Node.js\nlanguage: node_js \n#选择Node.js版本，我这里由于没有更新Hexo，所以使用了较老的版本，该项值一般为\"stable\"\nnode_js: 12.22.5 \n\n#设置需要编译的代码分支，Travis CI只检测当前分支的变动，请根据自己的实际情况修改\nbranches:\n  only:\n  - hexo\n\n#在每次构建之前需要先配好环境\nbefore_install:\n#配置Travis CI免密登录服务器\n- openssl aes-256-cbc -K $encrypted_<key>_key -iv $encrypted_<iv>_iv\n  -in <id_rsa.enc> -out ~/.ssh/id_rsa -d\n- chmod 600 ~/.ssh/id_rsa\n- eval $(ssh-agent)\n- ssh-add ~/.ssh/id_rsa\n- cp ./ssh_config ~/.ssh/config\n#配置Github信息以使Travis CI可以更改仓库\n- git config --global user.name \"$GIT_NAME\"\n- git config --global user.email \"$GIT_EMAIL\"\n#安装Hexo\n- npm install -g hexo-cli\n\n#安装package.json中的插件\ninstall:\n- npm install\n\n#生成网页\nscript:\n- hexo clean\n- hexo generate\n\n#生成成功之后需要执行的操作（部署）\nafter_success:\n#将./public文件夹中的网页复制到服务器上的指定位置\n- scp -o stricthostkeychecking=no -r ./public/* root@<你的域名或IP>:<博客网页存放的路径>\n#在Travis CI上切换到你的博客的./public文件夹，在该路径下初始化git，以\"Travis CI Auto Builder\"的名称提交代码并推送到\"master\"分支上\n- cd ./public\n- git init\n- git add --all .\n- git commit -m \"Travis CI Auto Builder\"\n- git push --quiet --force https://$GIT_TOKEN@<你博客的Github仓库网址>\n  master\n  \n#配置已知的主机，以保证可以成功登陆\naddons:\n  ssh_known_hosts:\n  - <你的域名或IP>\n```\n\n观察上面的文件可以发现，其中以`$`开头的变量一共出现了五次。在Travis CI的配置文件中，这些变量为环境变量，它们的值不以明文的形式出现在配置文件中，需要你自己在Travis CI的网页上设置值。\n\n在Travis CI的网页中找到你的博客的仓库。点击右上角的`More options`按钮后再点击`Settings`进入设置页面。\n\n在设置页面中，必须要打开`General`栏中的`Build pushed branches`。否则即使你推送了代码，Travis CI不会自动构建项目。\n\n然后在`Environment Variables`一栏中的空白文本框处，分别填写你的环境变量的名称`NAME`和值`VALUE`，然后点击`Add`按钮以添加。在这一小节，我们需要添加三个环境变量：\n\n|   Name    |                Value                 |\n| :-------: | :----------------------------------: |\n| GIT_EMAIL |       <填写你Github绑定的邮箱>       |\n| GIT_NAME  |        <填写你Github的账户名>        |\n| GIT_TOKEN | <填写你在上一节中生成的Github Token> |\n\n### 文件加密\n\n接下来讲讲Travis CI免密登录服务器的配置以及最后剩下的两个环境变量。\n\n类比之前设置本地ssh免密登录服务器的方法，要想让Travis CI生成的虚拟机可以免密登录服务器，其必须要有公钥`id_rsa.pub`、私钥`id_rsa`、以及配置文件`config`。但是直接将私钥以明文形式上传太危险了。Travis CI提供了加密服务，可以将私钥加密以后上传到它的服务器，再在其虚拟机上解密生成私钥。这样一来，Travis CI就可以安全地进行ssh免密登录了。\n\n接下来的加密操作建议在Linux或者macOS下进行，在Windows 10上操作有可能会产生`bad decrypt`的错误。（参见：[File decryption fails (wrong final block length) on Windows · Issue #4746 · travis-ci/travis-ci (github.com)](https://github.com/travis-ci/travis-ci/issues/4746)）\n\n在加密操作之前，请先确认你的电脑上是否安装有ruby，否则无法使用gem包管理工具。\n\n执行下面的命令以安装Travis：`gem install travis`。\n\n登录Travis：`travis login --github-token <token> --pro`。注意这里必须加上后缀`--pro`，否则这个命令默认登录的是`https://api.travis-ci.org`而非`https://api.travis-ci.com`。\n\n在存放有你的私钥`id_rsa`以及`.travis.yml`的目录下执行：`travis encrypt-file id_rsa --add --pro `。如果这个目录不是你存放博客的Github仓库的本地文件夹，那么请按照给出的提示添加后缀。\n\n执行完毕后，在该文件夹下会新增一个`id_rsa.enc`文件。这个文件就是经过加密后的私钥了。检查`.travis.yml`文件，会发现其中多了一行类似于下面的代码：\n\n```yaml\n- openssl aes-256-cbc -K $encrypted_<key>_key -iv $encrypted_<iv>_iv  -in id_rsa.enc -out id_rsa -d\n```\n\n上面`<key>`和`<iv>`的值是随机生成的数字和字母的组合，该命令的作用在于解密`id_rsa.enc`以得到私钥`id_rsa`。`-in`表示输入文件，`-out`表示解密后的文件，我们将其路径修改为`~/.ssh/id_rsa`，可以得到：\n\n```yaml\n- openssl aes-256-cbc -K $encrypted_<key>_key -iv $encrypted_<iv>_iv\n  -in <id_rsa.enc> -out ~/.ssh/id_rsa -d\n```\n\n此外，在Travis CI对应仓库的设置中，还会新增两个环境变量`encrypted_<key>_key`与`encrypted_<iv>_iv`。\n\n在得到私钥后，我们还要进行下面的操作以使Travis CI可以免密登录服务器。\n\n在`.travis.yml`中按照模板的格式添加以下代码：\n\n```yaml\n- chmod 600 ~/.ssh/id_rsa\n- eval $(ssh-agent)\n- ssh-add ~/.ssh/id_rsa\n- cp ./ssh_config ~/.ssh/config\n```\n\n然后，将`id_rsa.enc`移入你的博客的根目录下，并切记**删除你在博客目录下的私钥！**。\n\n在博客根目录下新建文件`ssh_config`，将下面的内容复制进去并保存。我们需要它来配置Travis CI上的ssh登录过程。\n\n```\nHost *\n  User git\n  StrictHostKeyChecking no\n  IdentityFile ~/.ssh/id_rsa\n  IdentitiesOnly yes\n```\n\n到这里，所有的配置工作就完成了！\n\n## 最终实现的效果\n\n经过上面的一系列复杂操作，我们最终实现了博客的持续集成，其工作流如下：\n\n1. 在本地编辑Markdown文件\n2. 编辑完成后直接推送到Github的目标分支上\n3. Travis CI检测到指定分支上文件的更改\n4. Travis CI创建虚拟机并依据配置文件生成博客网页文件\n5. Travis CI将生成的网页复制到服务器的指定位置，完成部署\n\n在部署的过程中，只有第二步是需要我们进行操作的，其他的工作全部由Travis CI自动完成了，非常的方便。\n\n点击Travis CI对应仓库标题右侧的绿色图标可以将其以Markdown格式添加到你的Github仓库的`readme.md`文件中。如果Travis CI操作的分支不是默认分支，那么这个图标将只显示`unknown`的状态。\n\n![](https://astrobear.top/resource/astroblog/content/build_passing_mark.png)\n\n\n\n---\n\n参考：\n\n[使用 Travis 打造 SpringBoot 应用持续集成和自动部署 | Travis CI 初体验 (juejin.cn)](https://juejin.cn/post/6946220560938434596#heading-13)\n\n[基于 Hexo 的全自动博客构建部署系统 - KChen's Blog](https://kchen.cc/2016/11/12/hexo-instructions/#总结)\n\n","slug":"Hexo的安装和自动部署","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzq00051q39h1xcgn54","content":"<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第二篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n<ul>\n<li>“建站搭博客”系列之一：<a href=\"https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/\">华为云+nginx服务器搭建总结</a></li>\n<li>“建站搭博客”系列之三：<a href=\"https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/\">Hexo主题Icarus的自定义</a></li>\n</ul>\n<blockquote>\n<p>在2020年年初Astroblog搭建完成的时候，我就打算记录下当时整个服务器搭建和博客的部署过程。这个过程我打算分为三篇文章来水，分别是服务器搭建、Hexo安装与自动部署、博客主题Icarus的自定义。后来由于种种原因，只写完了三篇文章中的第一篇，剩下两篇拖更到现在。前段时间刚好换了电脑，由于当时部署博客的很多细节都不记得了，迁移的过程尤其痛苦，踩了各种坑之后才终于搞定。于是趁热打铁，赶紧把这两个坑填了，权当备忘。</p>\n</blockquote>\n<h1 id=\"关于Hexo\"><a href=\"#关于Hexo\" class=\"headerlink\" title=\"关于Hexo\"></a>关于Hexo</h1><p>Hexo是一个高效、简洁的博客框架。它基于Node.js，通过几条命令就可以由Markdown文件快速生成静态的HTML网页。静态网站具有轻量、速度快等特点。它的部署非常方便灵活，不但可以部署在服务器上，还可以部署在静态托管网站上，比如Github Pages。本文主要讨论如何将Hexo部署在服务器上。</p>\n<p>首先来认识一下Hexo项目中有什么文件：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">.</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">_config.yml</span> <span class=\"comment\">#Hexo的配置文件</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">db.json</span> <span class=\"comment\">#Hexo自动生成的文件</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">package.json</span> <span class=\"comment\">#插件配置文件，下同</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">package-lock.json</span> </span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">node_modules</span> <span class=\"comment\">#生成网站需要用到的Node.js模块</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">scaffolds</span> <span class=\"comment\">#存放模板的文件夹</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">source</span> <span class=\"comment\">#博客Markdown源文件夹</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">public</span> <span class=\"comment\">#存放生成的静态HTML文件</span></span><br><span class=\"line\"><span class=\"string\">└──</span> <span class=\"string\">themes</span> <span class=\"comment\">#主题文件夹</span></span><br></pre></td></tr></table></figure>\n\n<p>一般来说，Hexo部署的过程是这样的：</p>\n<ol>\n<li>在本地编辑Markdown文件并通过Hexo生成静态网页，存放于<code>./public</code>文件夹中</li>\n<li>将<code>./public</code>文件夹中的文件复制到远程服务器上</li>\n<li>设置服务器访问的网址为博客首页</li>\n</ol>\n<p>你同样可以在服务器上配置Hexo环境，将Markdown源文件上传到服务器上编译。不过一般还是推荐在本地编译，这样比较方便，并且还可以预览生成的博客。</p>\n<p>下面开始介绍Hexo博客安装和部署的具体操作。</p>\n<h1 id=\"Windows系统下Hexo的安装与部署\"><a href=\"#Windows系统下Hexo的安装与部署\" class=\"headerlink\" title=\"Windows系统下Hexo的安装与部署\"></a>Windows系统下Hexo的安装与部署</h1><h2 id=\"安装相关依赖\"><a href=\"#安装相关依赖\" class=\"headerlink\" title=\"安装相关依赖\"></a>安装相关依赖</h2><p>Hexo是基于Node.js来生成网页的，那么首先就要安装Node.js。Windows用户清前往<a href=\"http://nodejs.cn/download/\">Node.js官方下载地址</a>下载最新版本的<code>.msi</code>格式的安装包，下载之后打开安装包直接安装即可。安装程序可能会询问你是否自动安装必要的工具，这里没有必要勾选这个选项。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/install_node.png\" alt=\"\"></p>\n<p>一般来说安装最新版本的Node.js就可以了。但是作者在迁移博客的过程中发现，由于没有更新Hexo至最新版本，使用最新版本的Node.js会导致编译生成的网页全是空白的，所以作者最后还是使用了<code>v12.22.5</code>版本的Node.js。有需要的朋友可以在<a href=\"https://npm.taobao.org/mirrors/node/\">这里</a>下载到历史版本。</p>\n<h2 id=\"安装Hexo并撰写博客\"><a href=\"#安装Hexo并撰写博客\" class=\"headerlink\" title=\"安装Hexo并撰写博客\"></a>安装Hexo并撰写博客</h2><p>根据Hexo官方提供的安装方法，安装过程需要使用npm包管理工具。新版本的Node.js已经集成了npm，所以打开Powershell终端直接按顺序输入下面的命令行进行安装即可：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-cli -g #安装hexo</span><br><span class=\"line\">cd &lt;dir&gt; #进入选定的博客存放目录</span><br><span class=\"line\">hexo init #在当前目录初始化博客</span><br><span class=\"line\">hexo g #生成博客文件</span><br><span class=\"line\">hexo s #在本地浏览器预览你的博客</span><br></pre></td></tr></table></figure>\n\n<p>如果你看到终端输出了类似下面的信息，恭喜你，你的博客已经构建成功了！你可以在浏览器中访问<code>http://localhost:4000</code>来预览你的博客。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hexo_init.png\" alt=\"\"></p>\n<p>你可以使用<code>./scafflods/post.md</code>作为模板创建你的第一篇博客。使用编辑器打开这个文件，可以模仿下面的内容来编写你的文章。模板中三根横线之间的内容是<code>yaml</code>文件头，并不使用Markdown语法，需要注意。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">Hello</span> <span class=\"string\">World!</span> <span class=\"comment\">#标题</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2021-8</span><span class=\"number\">-17</span> <span class=\"number\">18</span><span class=\"string\">:30:00</span> <span class=\"comment\">#按格式填写博文创建的日期</span></span><br><span class=\"line\"><span class=\"attr\">tags:</span> <span class=\"comment\">#按照下面的格式添加博文的标签</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">demo</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">hello</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">#在横线下面开始编辑你的博客正文</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"string\">Hello</span> <span class=\"string\">World!</span></span><br><span class=\"line\"><span class=\"string\">你好，世界！</span></span><br></pre></td></tr></table></figure>\n\n<p>写完以后，将这个文件放入<code>./source/_posts</code>文件夹中，该文件夹中的Markdown文件会被编译生成网页。而存放在<code>./source/_drafts</code>文件夹中的文件则只是草稿，并不会在网页中出现。</p>\n<p>最后，在你的博客目录下，再次执行<code>hexo g</code>和<code>hexo s</code>两条命令，你编辑的第一篇博客便可以以网页的形式在浏览器中预览了。另外，你还可以通过<code>hexo clean</code>命令来清除之前生成的HTML网页。</p>\n<h2 id=\"在服务器上部署Hexo\"><a href=\"#在服务器上部署Hexo\" class=\"headerlink\" title=\"在服务器上部署Hexo\"></a>在服务器上部署Hexo</h2><p>在本地生成了博客网页以后还不够，只有我们将<code>./public</code>中的HTML文件上传到服务器之后，其他人才能通过互联网浏览我们的博客。</p>\n<p>你可以使用命令行或者FTP客户端来将你的博客上传到服务器上的指定文件夹。由于作者不擅长使用命令行，所以还是使用了<code>FileZilla</code>这个有图形化界面的FTP软件来完成这个工作。</p>\n<p>最后，你需要将你的服务器的IP地址或者域名定向到你博客的首页。这里以nginx为例简单说说配置方法。</p>\n<p>在nginx的配置文件中的<code>server-location</code>项中，将<code>index</code>的值修改为博客首页的HTML文件，也即<code>&lt;dir&gt;/public/intex.html</code>，其中<code>&lt;dir&gt;</code>为你在服务器上存放博客<code>pubic</code>文件夹的目录。</p>\n<p>保存文件并重启nginx服务后，你应该便可以通过你的服务器的IP地址或者域名来访问你的博客了！</p>\n<h1 id=\"配置博客自动部署功能\"><a href=\"#配置博客自动部署功能\" class=\"headerlink\" title=\"配置博客自动部署功能\"></a>配置博客自动部署功能</h1><p>通过上面的方法，可以完成博客的编辑和部署工作。但是每次编辑完成以后，部署工作显得复杂繁琐。有没有一种办法，能够在完成博客的编辑以后，通过简单的操作就可以将博客部署到服务器上呢？答案是有的。我想实现的效果大概是这样：</p>\n<ol>\n<li>完成Markdown的编辑以后，直接上传<code>./source/_posts</code>文件夹中的源文件</li>\n<li>通过某种方式自动生成HTML文件并将其拷贝到服务器上</li>\n</ol>\n<p>这样我们就不需要每次都进行复杂的部署，并且可以专注于写作本身。</p>\n<p>下面具体来讲一下怎么实现这个目标。</p>\n<h2 id=\"什么是持续集成？\"><a href=\"#什么是持续集成？\" class=\"headerlink\" title=\"什么是持续集成？\"></a>什么是持续集成？</h2><p>想要实现博客的自动化部署，就必须引入持续集成这个概念。</p>\n<blockquote>\n<p>持续集成（Continuous Integration, CI）指的是，频繁地（一天多次）将代码集成到主干。持续集成可以使产品快速迭代，同时保证质量。——<a href=\"https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html\">持续集成是什么？ - 阮一峰的网络日志</a></p>\n</blockquote>\n<p>一般来说，持续集成可以让人们快速发现错误。在持续集成之后，随之而来的是持续交付和持续部署。持续交付指的是频繁地将软件提交给质量团队或者用户进行评审，如果评审通过，那么久将软件自动部署到生产环境中。我们通常说的持续集成，同时包括了上面三个过程。</p>\n<p>对于个人博客而言，持续集成和持续交付通常是一体的，也就是我们编辑博客内容的过程。而现在我们需要实现的就是持续部署的功能，即将自己的博客源文件自动生成网页并部署到服务器上。</p>\n<p>实现持续集成，就必须使用相应的工具。目前市面上的主流持续集成工具有：Jenkins、Travis CI、Gitlab CI等。在这里我们使用Github + Travis CI的组合来实现持续集成的功能。</p>\n<p>Travis CI是一个依赖于Github的持续集成工具，它从Github的代码仓库中拉取代码。它在检测到仓库文件有更改之后，会在远程自动创建一个虚拟机，然后根据你的Travis CI配置文件编译你仓库中的代码并执行其他一些操作。</p>\n<p>需要注意的是，Travis CI的<a href=\"https://travis-ci.com\">官方网址</a>现在变为<strong>travis-ci.com</strong>而非travis-ci.org。后者现在是只读模式，请务必注意。</p>\n<h2 id=\"Github授权并生成Token\"><a href=\"#Github授权并生成Token\" class=\"headerlink\" title=\"Github授权并生成Token\"></a>Github授权并生成Token</h2><p>使用Travis CI首先就要对其授权使其可以访问自己的Github仓库。</p>\n<p>进入Travis CI的官网后直接用Github账号登录，根据提示开通Travis CI对仓库的访问授权。你可以选择允许访问所有仓库，也可以指定部分仓库以供访问。</p>\n<p>在自动部署的过程中，Travis CI需要通过命令对Github的仓库进行修改操作，这就需要我们登录Github服务。但是在登录的过程中，将自己的密码直接暴露出去是很危险的。所以，这里使用Token（令牌）来代替密码，以增强安全性。</p>\n<p>关于生成Github Token的方法，请看<a href=\"https://docs.github.com/cn/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token\">创建个人访问令牌 - GitHub Docs</a>。</p>\n<p>请妥善保存生成的Token。</p>\n<h2 id=\"使用Travis-CI进行持续集成\"><a href=\"#使用Travis-CI进行持续集成\" class=\"headerlink\" title=\"使用Travis CI进行持续集成\"></a>使用Travis CI进行持续集成</h2><h3 id=\"配置ssh免密登录服务器\"><a href=\"#配置ssh免密登录服务器\" class=\"headerlink\" title=\"配置ssh免密登录服务器\"></a>配置ssh免密登录服务器</h3><p>自动部署必然会对服务器端的文件进行操作，因此必须远程登录服务器。但是部署过程是由Travis CI自动完成的，我们也无法在Travis CI的控制台中输入服务器的登录密码。因此我们还要能够免密登录服务器。</p>\n<p>免密登录是基于密钥对来实现的。密钥对分为私钥和公钥，私钥以明文形式存储，由我们自己保存，千万不可泄露。而公钥由私钥加密而来，在进行ssh免密登录时，在网络中由本地传送到服务器的就是公钥。本地电脑和服务器经过一系列操作后比对生成的校验值，如果校验通过便可以登录到服务器。</p>\n<p>ssh免密登录的具体原理可以参考下图（来源：<a href=\"https://www.jianshu.com/p/33461b619d53\">图解SSH原理 - 简书 (jianshu.com)</a>）。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/ssh.jpeg\" alt=\"\"></p>\n<p>接下来讲讲实现方法。</p>\n<p>在Powershell中输入：<code>ssh-keygen -t rsa</code>。</p>\n<p>之后会提示你输入秘钥的名字，如果直接按回车跳过则会使用默认的文件名<code>id_rsa</code>。</p>\n<p>接着会让你输入并确定需要加密的密码，这里我们直接跳过。</p>\n<p>然后我们就可以在<code>C:/Users/&lt;你的用户名&gt;/.ssh</code>中看到新创建的两个文件，其中<code>id_rsa</code>为私钥，<code>id_rsa.pub</code>为公钥。</p>\n<p>在刚才的那个文件夹中创建文件<code>config</code>，不需要后缀名。其内容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 远程主机名称</span><br><span class=\"line\">Host &lt;你的服务器域名或ip地址&gt;</span><br><span class=\"line\"># 远程主机域名或者 ip 地址</span><br><span class=\"line\">HostName &lt;你的服务器域名或ip地址&gt;</span><br><span class=\"line\"># 认证方式</span><br><span class=\"line\">PreferredAuthentications publickey</span><br><span class=\"line\"># 私钥位置</span><br><span class=\"line\">IdentityFile C:/Users/&lt;你的用户名&gt;/.ssh/id_rsa</span><br><span class=\"line\"># 用户名</span><br><span class=\"line\">User root</span><br></pre></td></tr></table></figure>\n\n<p>将公钥复制一份，重命名为<code>authorized_keys</code>。然后将<code>id_rsa.pub</code>和<code>authorized_keys</code>上传到服务器的<code>~/.ssh</code>文件夹中。</p>\n<p>在终端里输入：<code>ssh root@&lt;你的服务器域名或ip地址&gt;</code>。如果不需要密码就可以登录的话，那就说明ssh免密登录设置成功了。</p>\n<p>如果在完成了上面的步骤之后在登录服务器时仍然需要输入密码，或者出现了类似下面的报错：</p>\n<p><code>Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</code></p>\n<p>那么请尝试执行下面三条命令，更改服务器上<code>~/.ssh</code>文件夹的权限。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 700 ~/.ssh/</span><br><span class=\"line\">chmod 700 /home/userName</span><br><span class=\"line\">chmod 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置Travis-Ci\"><a href=\"#配置Travis-Ci\" class=\"headerlink\" title=\"配置Travis Ci\"></a>配置Travis Ci</h3><p>在博客的的根目录下面创建Travis CI的配置文件<code>.travis.yml</code>，并且将下面模板的内容添加到文件中。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#设置构建环境为Node.js</span></span><br><span class=\"line\"><span class=\"attr\">language:</span> <span class=\"string\">node_js</span> </span><br><span class=\"line\"><span class=\"comment\">#选择Node.js版本，我这里由于没有更新Hexo，所以使用了较老的版本，该项值一般为&quot;stable&quot;</span></span><br><span class=\"line\"><span class=\"attr\">node_js:</span> <span class=\"number\">12.22</span><span class=\"number\">.5</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置需要编译的代码分支，Travis CI只检测当前分支的变动，请根据自己的实际情况修改</span></span><br><span class=\"line\"><span class=\"attr\">branches:</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hexo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#在每次构建之前需要先配好环境</span></span><br><span class=\"line\"><span class=\"attr\">before_install:</span></span><br><span class=\"line\"><span class=\"comment\">#配置Travis CI免密登录服务器</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">openssl</span> <span class=\"string\">aes-256-cbc</span> <span class=\"string\">-K</span> <span class=\"string\">$encrypted_&lt;key&gt;_key</span> <span class=\"string\">-iv</span> <span class=\"string\">$encrypted_&lt;iv&gt;_iv</span></span><br><span class=\"line\">  <span class=\"string\">-in</span> <span class=\"string\">&lt;id_rsa.enc&gt;</span> <span class=\"string\">-out</span> <span class=\"string\">~/.ssh/id_rsa</span> <span class=\"string\">-d</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">chmod</span> <span class=\"number\">600</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">eval</span> <span class=\"string\">$(ssh-agent)</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">ssh-add</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">cp</span> <span class=\"string\">./ssh_config</span> <span class=\"string\">~/.ssh/config</span></span><br><span class=\"line\"><span class=\"comment\">#配置Github信息以使Travis CI可以更改仓库</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">&quot;$GIT_NAME&quot;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">&quot;$GIT_EMAIL&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#安装Hexo</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">-g</span> <span class=\"string\">hexo-cli</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装package.json中的插件</span></span><br><span class=\"line\"><span class=\"attr\">install:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#生成网页</span></span><br><span class=\"line\"><span class=\"attr\">script:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">clean</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">generate</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#生成成功之后需要执行的操作（部署）</span></span><br><span class=\"line\"><span class=\"attr\">after_success:</span></span><br><span class=\"line\"><span class=\"comment\">#将./public文件夹中的网页复制到服务器上的指定位置</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">scp</span> <span class=\"string\">-o</span> <span class=\"string\">stricthostkeychecking=no</span> <span class=\"string\">-r</span> <span class=\"string\">./public/*</span> <span class=\"string\">root@&lt;你的域名或IP&gt;:&lt;博客网页存放的路径&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#在Travis CI上切换到你的博客的./public文件夹，在该路径下初始化git，以&quot;Travis CI Auto Builder&quot;的名称提交代码并推送到&quot;master&quot;分支上</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">cd</span> <span class=\"string\">./public</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">init</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">add</span> <span class=\"string\">--all</span> <span class=\"string\">.</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">commit</span> <span class=\"string\">-m</span> <span class=\"string\">&quot;Travis CI Auto Builder&quot;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">push</span> <span class=\"string\">--quiet</span> <span class=\"string\">--force</span> <span class=\"string\">https://$GIT_TOKEN@&lt;你博客的Github仓库网址&gt;</span></span><br><span class=\"line\">  <span class=\"string\">master</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">#配置已知的主机，以保证可以成功登陆</span></span><br><span class=\"line\"><span class=\"attr\">addons:</span></span><br><span class=\"line\">  <span class=\"attr\">ssh_known_hosts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&lt;你的域名或IP&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>观察上面的文件可以发现，其中以<code>$</code>开头的变量一共出现了五次。在Travis CI的配置文件中，这些变量为环境变量，它们的值不以明文的形式出现在配置文件中，需要你自己在Travis CI的网页上设置值。</p>\n<p>在Travis CI的网页中找到你的博客的仓库。点击右上角的<code>More options</code>按钮后再点击<code>Settings</code>进入设置页面。</p>\n<p>在设置页面中，必须要打开<code>General</code>栏中的<code>Build pushed branches</code>。否则即使你推送了代码，Travis CI不会自动构建项目。</p>\n<p>然后在<code>Environment Variables</code>一栏中的空白文本框处，分别填写你的环境变量的名称<code>NAME</code>和值<code>VALUE</code>，然后点击<code>Add</code>按钮以添加。在这一小节，我们需要添加三个环境变量：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Name</th>\n<th align=\"center\">Value</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">GIT_EMAIL</td>\n<td align=\"center\">&lt;填写你Github绑定的邮箱&gt;</td>\n</tr>\n<tr>\n<td align=\"center\">GIT_NAME</td>\n<td align=\"center\">&lt;填写你Github的账户名&gt;</td>\n</tr>\n<tr>\n<td align=\"center\">GIT_TOKEN</td>\n<td align=\"center\">&lt;填写你在上一节中生成的Github Token&gt;</td>\n</tr>\n</tbody></table>\n<h3 id=\"文件加密\"><a href=\"#文件加密\" class=\"headerlink\" title=\"文件加密\"></a>文件加密</h3><p>接下来讲讲Travis CI免密登录服务器的配置以及最后剩下的两个环境变量。</p>\n<p>类比之前设置本地ssh免密登录服务器的方法，要想让Travis CI生成的虚拟机可以免密登录服务器，其必须要有公钥<code>id_rsa.pub</code>、私钥<code>id_rsa</code>、以及配置文件<code>config</code>。但是直接将私钥以明文形式上传太危险了。Travis CI提供了加密服务，可以将私钥加密以后上传到它的服务器，再在其虚拟机上解密生成私钥。这样一来，Travis CI就可以安全地进行ssh免密登录了。</p>\n<p>接下来的加密操作建议在Linux或者macOS下进行，在Windows 10上操作有可能会产生<code>bad decrypt</code>的错误。（参见：<a href=\"https://github.com/travis-ci/travis-ci/issues/4746\">File decryption fails (wrong final block length) on Windows · Issue #4746 · travis-ci/travis-ci (github.com)</a>）</p>\n<p>在加密操作之前，请先确认你的电脑上是否安装有ruby，否则无法使用gem包管理工具。</p>\n<p>执行下面的命令以安装Travis：<code>gem install travis</code>。</p>\n<p>登录Travis：<code>travis login --github-token &lt;token&gt; --pro</code>。注意这里必须加上后缀<code>--pro</code>，否则这个命令默认登录的是<code>https://api.travis-ci.org</code>而非<code>https://api.travis-ci.com</code>。</p>\n<p>在存放有你的私钥<code>id_rsa</code>以及<code>.travis.yml</code>的目录下执行：<code>travis encrypt-file id_rsa --add --pro</code>。如果这个目录不是你存放博客的Github仓库的本地文件夹，那么请按照给出的提示添加后缀。</p>\n<p>执行完毕后，在该文件夹下会新增一个<code>id_rsa.enc</code>文件。这个文件就是经过加密后的私钥了。检查<code>.travis.yml</code>文件，会发现其中多了一行类似于下面的代码：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">openssl</span> <span class=\"string\">aes-256-cbc</span> <span class=\"string\">-K</span> <span class=\"string\">$encrypted_&lt;key&gt;_key</span> <span class=\"string\">-iv</span> <span class=\"string\">$encrypted_&lt;iv&gt;_iv</span>  <span class=\"string\">-in</span> <span class=\"string\">id_rsa.enc</span> <span class=\"string\">-out</span> <span class=\"string\">id_rsa</span> <span class=\"string\">-d</span></span><br></pre></td></tr></table></figure>\n\n<p>上面<code>&lt;key&gt;</code>和<code>&lt;iv&gt;</code>的值是随机生成的数字和字母的组合，该命令的作用在于解密<code>id_rsa.enc</code>以得到私钥<code>id_rsa</code>。<code>-in</code>表示输入文件，<code>-out</code>表示解密后的文件，我们将其路径修改为<code>~/.ssh/id_rsa</code>，可以得到：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">openssl</span> <span class=\"string\">aes-256-cbc</span> <span class=\"string\">-K</span> <span class=\"string\">$encrypted_&lt;key&gt;_key</span> <span class=\"string\">-iv</span> <span class=\"string\">$encrypted_&lt;iv&gt;_iv</span></span><br><span class=\"line\">  <span class=\"string\">-in</span> <span class=\"string\">&lt;id_rsa.enc&gt;</span> <span class=\"string\">-out</span> <span class=\"string\">~/.ssh/id_rsa</span> <span class=\"string\">-d</span></span><br></pre></td></tr></table></figure>\n\n<p>此外，在Travis CI对应仓库的设置中，还会新增两个环境变量<code>encrypted_&lt;key&gt;_key</code>与<code>encrypted_&lt;iv&gt;_iv</code>。</p>\n<p>在得到私钥后，我们还要进行下面的操作以使Travis CI可以免密登录服务器。</p>\n<p>在<code>.travis.yml</code>中按照模板的格式添加以下代码：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">chmod</span> <span class=\"number\">600</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">eval</span> <span class=\"string\">$(ssh-agent)</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">ssh-add</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">cp</span> <span class=\"string\">./ssh_config</span> <span class=\"string\">~/.ssh/config</span></span><br></pre></td></tr></table></figure>\n\n<p>然后，将<code>id_rsa.enc</code>移入你的博客的根目录下，并切记<strong>删除你在博客目录下的私钥！</strong>。</p>\n<p>在博客根目录下新建文件<code>ssh_config</code>，将下面的内容复制进去并保存。我们需要它来配置Travis CI上的ssh登录过程。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Host *</span><br><span class=\"line\">  User git</span><br><span class=\"line\">  StrictHostKeyChecking no</span><br><span class=\"line\">  IdentityFile ~/.ssh/id_rsa</span><br><span class=\"line\">  IdentitiesOnly yes</span><br></pre></td></tr></table></figure>\n\n<p>到这里，所有的配置工作就完成了！</p>\n<h2 id=\"最终实现的效果\"><a href=\"#最终实现的效果\" class=\"headerlink\" title=\"最终实现的效果\"></a>最终实现的效果</h2><p>经过上面的一系列复杂操作，我们最终实现了博客的持续集成，其工作流如下：</p>\n<ol>\n<li>在本地编辑Markdown文件</li>\n<li>编辑完成后直接推送到Github的目标分支上</li>\n<li>Travis CI检测到指定分支上文件的更改</li>\n<li>Travis CI创建虚拟机并依据配置文件生成博客网页文件</li>\n<li>Travis CI将生成的网页复制到服务器的指定位置，完成部署</li>\n</ol>\n<p>在部署的过程中，只有第二步是需要我们进行操作的，其他的工作全部由Travis CI自动完成了，非常的方便。</p>\n<p>点击Travis CI对应仓库标题右侧的绿色图标可以将其以Markdown格式添加到你的Github仓库的<code>readme.md</code>文件中。如果Travis CI操作的分支不是默认分支，那么这个图标将只显示<code>unknown</code>的状态。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/build_passing_mark.png\" alt=\"\"></p>\n<hr>\n<p>参考：</p>\n<p><a href=\"https://juejin.cn/post/6946220560938434596#heading-13\">使用 Travis 打造 SpringBoot 应用持续集成和自动部署 | Travis CI 初体验 (juejin.cn)</a></p>\n<p><a href=\"https://kchen.cc/2016/11/12/hexo-instructions/#总结\">基于 Hexo 的全自动博客构建部署系统 - KChen’s Blog</a></p>\n","site":{"data":{}},"more":"<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第二篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n<ul>\n<li>“建站搭博客”系列之一：<a href=\"https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/\">华为云+nginx服务器搭建总结</a></li>\n<li>“建站搭博客”系列之三：<a href=\"https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/\">Hexo主题Icarus的自定义</a></li>\n</ul>\n<blockquote>\n<p>在2020年年初Astroblog搭建完成的时候，我就打算记录下当时整个服务器搭建和博客的部署过程。这个过程我打算分为三篇文章来水，分别是服务器搭建、Hexo安装与自动部署、博客主题Icarus的自定义。后来由于种种原因，只写完了三篇文章中的第一篇，剩下两篇拖更到现在。前段时间刚好换了电脑，由于当时部署博客的很多细节都不记得了，迁移的过程尤其痛苦，踩了各种坑之后才终于搞定。于是趁热打铁，赶紧把这两个坑填了，权当备忘。</p>\n</blockquote>\n<h1 id=\"关于Hexo\"><a href=\"#关于Hexo\" class=\"headerlink\" title=\"关于Hexo\"></a>关于Hexo</h1><p>Hexo是一个高效、简洁的博客框架。它基于Node.js，通过几条命令就可以由Markdown文件快速生成静态的HTML网页。静态网站具有轻量、速度快等特点。它的部署非常方便灵活，不但可以部署在服务器上，还可以部署在静态托管网站上，比如Github Pages。本文主要讨论如何将Hexo部署在服务器上。</p>\n<p>首先来认识一下Hexo项目中有什么文件：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">.</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">_config.yml</span> <span class=\"comment\">#Hexo的配置文件</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">db.json</span> <span class=\"comment\">#Hexo自动生成的文件</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">package.json</span> <span class=\"comment\">#插件配置文件，下同</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">package-lock.json</span> </span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">node_modules</span> <span class=\"comment\">#生成网站需要用到的Node.js模块</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">scaffolds</span> <span class=\"comment\">#存放模板的文件夹</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">source</span> <span class=\"comment\">#博客Markdown源文件夹</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">public</span> <span class=\"comment\">#存放生成的静态HTML文件</span></span><br><span class=\"line\"><span class=\"string\">└──</span> <span class=\"string\">themes</span> <span class=\"comment\">#主题文件夹</span></span><br></pre></td></tr></table></figure>\n\n<p>一般来说，Hexo部署的过程是这样的：</p>\n<ol>\n<li>在本地编辑Markdown文件并通过Hexo生成静态网页，存放于<code>./public</code>文件夹中</li>\n<li>将<code>./public</code>文件夹中的文件复制到远程服务器上</li>\n<li>设置服务器访问的网址为博客首页</li>\n</ol>\n<p>你同样可以在服务器上配置Hexo环境，将Markdown源文件上传到服务器上编译。不过一般还是推荐在本地编译，这样比较方便，并且还可以预览生成的博客。</p>\n<p>下面开始介绍Hexo博客安装和部署的具体操作。</p>\n<h1 id=\"Windows系统下Hexo的安装与部署\"><a href=\"#Windows系统下Hexo的安装与部署\" class=\"headerlink\" title=\"Windows系统下Hexo的安装与部署\"></a>Windows系统下Hexo的安装与部署</h1><h2 id=\"安装相关依赖\"><a href=\"#安装相关依赖\" class=\"headerlink\" title=\"安装相关依赖\"></a>安装相关依赖</h2><p>Hexo是基于Node.js来生成网页的，那么首先就要安装Node.js。Windows用户清前往<a href=\"http://nodejs.cn/download/\">Node.js官方下载地址</a>下载最新版本的<code>.msi</code>格式的安装包，下载之后打开安装包直接安装即可。安装程序可能会询问你是否自动安装必要的工具，这里没有必要勾选这个选项。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/install_node.png\" alt=\"\"></p>\n<p>一般来说安装最新版本的Node.js就可以了。但是作者在迁移博客的过程中发现，由于没有更新Hexo至最新版本，使用最新版本的Node.js会导致编译生成的网页全是空白的，所以作者最后还是使用了<code>v12.22.5</code>版本的Node.js。有需要的朋友可以在<a href=\"https://npm.taobao.org/mirrors/node/\">这里</a>下载到历史版本。</p>\n<h2 id=\"安装Hexo并撰写博客\"><a href=\"#安装Hexo并撰写博客\" class=\"headerlink\" title=\"安装Hexo并撰写博客\"></a>安装Hexo并撰写博客</h2><p>根据Hexo官方提供的安装方法，安装过程需要使用npm包管理工具。新版本的Node.js已经集成了npm，所以打开Powershell终端直接按顺序输入下面的命令行进行安装即可：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-cli -g #安装hexo</span><br><span class=\"line\">cd &lt;dir&gt; #进入选定的博客存放目录</span><br><span class=\"line\">hexo init #在当前目录初始化博客</span><br><span class=\"line\">hexo g #生成博客文件</span><br><span class=\"line\">hexo s #在本地浏览器预览你的博客</span><br></pre></td></tr></table></figure>\n\n<p>如果你看到终端输出了类似下面的信息，恭喜你，你的博客已经构建成功了！你可以在浏览器中访问<code>http://localhost:4000</code>来预览你的博客。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hexo_init.png\" alt=\"\"></p>\n<p>你可以使用<code>./scafflods/post.md</code>作为模板创建你的第一篇博客。使用编辑器打开这个文件，可以模仿下面的内容来编写你的文章。模板中三根横线之间的内容是<code>yaml</code>文件头，并不使用Markdown语法，需要注意。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">Hello</span> <span class=\"string\">World!</span> <span class=\"comment\">#标题</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2021-8</span><span class=\"number\">-17</span> <span class=\"number\">18</span><span class=\"string\">:30:00</span> <span class=\"comment\">#按格式填写博文创建的日期</span></span><br><span class=\"line\"><span class=\"attr\">tags:</span> <span class=\"comment\">#按照下面的格式添加博文的标签</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">demo</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">hello</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">#在横线下面开始编辑你的博客正文</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"string\">Hello</span> <span class=\"string\">World!</span></span><br><span class=\"line\"><span class=\"string\">你好，世界！</span></span><br></pre></td></tr></table></figure>\n\n<p>写完以后，将这个文件放入<code>./source/_posts</code>文件夹中，该文件夹中的Markdown文件会被编译生成网页。而存放在<code>./source/_drafts</code>文件夹中的文件则只是草稿，并不会在网页中出现。</p>\n<p>最后，在你的博客目录下，再次执行<code>hexo g</code>和<code>hexo s</code>两条命令，你编辑的第一篇博客便可以以网页的形式在浏览器中预览了。另外，你还可以通过<code>hexo clean</code>命令来清除之前生成的HTML网页。</p>\n<h2 id=\"在服务器上部署Hexo\"><a href=\"#在服务器上部署Hexo\" class=\"headerlink\" title=\"在服务器上部署Hexo\"></a>在服务器上部署Hexo</h2><p>在本地生成了博客网页以后还不够，只有我们将<code>./public</code>中的HTML文件上传到服务器之后，其他人才能通过互联网浏览我们的博客。</p>\n<p>你可以使用命令行或者FTP客户端来将你的博客上传到服务器上的指定文件夹。由于作者不擅长使用命令行，所以还是使用了<code>FileZilla</code>这个有图形化界面的FTP软件来完成这个工作。</p>\n<p>最后，你需要将你的服务器的IP地址或者域名定向到你博客的首页。这里以nginx为例简单说说配置方法。</p>\n<p>在nginx的配置文件中的<code>server-location</code>项中，将<code>index</code>的值修改为博客首页的HTML文件，也即<code>&lt;dir&gt;/public/intex.html</code>，其中<code>&lt;dir&gt;</code>为你在服务器上存放博客<code>pubic</code>文件夹的目录。</p>\n<p>保存文件并重启nginx服务后，你应该便可以通过你的服务器的IP地址或者域名来访问你的博客了！</p>\n<h1 id=\"配置博客自动部署功能\"><a href=\"#配置博客自动部署功能\" class=\"headerlink\" title=\"配置博客自动部署功能\"></a>配置博客自动部署功能</h1><p>通过上面的方法，可以完成博客的编辑和部署工作。但是每次编辑完成以后，部署工作显得复杂繁琐。有没有一种办法，能够在完成博客的编辑以后，通过简单的操作就可以将博客部署到服务器上呢？答案是有的。我想实现的效果大概是这样：</p>\n<ol>\n<li>完成Markdown的编辑以后，直接上传<code>./source/_posts</code>文件夹中的源文件</li>\n<li>通过某种方式自动生成HTML文件并将其拷贝到服务器上</li>\n</ol>\n<p>这样我们就不需要每次都进行复杂的部署，并且可以专注于写作本身。</p>\n<p>下面具体来讲一下怎么实现这个目标。</p>\n<h2 id=\"什么是持续集成？\"><a href=\"#什么是持续集成？\" class=\"headerlink\" title=\"什么是持续集成？\"></a>什么是持续集成？</h2><p>想要实现博客的自动化部署，就必须引入持续集成这个概念。</p>\n<blockquote>\n<p>持续集成（Continuous Integration, CI）指的是，频繁地（一天多次）将代码集成到主干。持续集成可以使产品快速迭代，同时保证质量。——<a href=\"https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html\">持续集成是什么？ - 阮一峰的网络日志</a></p>\n</blockquote>\n<p>一般来说，持续集成可以让人们快速发现错误。在持续集成之后，随之而来的是持续交付和持续部署。持续交付指的是频繁地将软件提交给质量团队或者用户进行评审，如果评审通过，那么久将软件自动部署到生产环境中。我们通常说的持续集成，同时包括了上面三个过程。</p>\n<p>对于个人博客而言，持续集成和持续交付通常是一体的，也就是我们编辑博客内容的过程。而现在我们需要实现的就是持续部署的功能，即将自己的博客源文件自动生成网页并部署到服务器上。</p>\n<p>实现持续集成，就必须使用相应的工具。目前市面上的主流持续集成工具有：Jenkins、Travis CI、Gitlab CI等。在这里我们使用Github + Travis CI的组合来实现持续集成的功能。</p>\n<p>Travis CI是一个依赖于Github的持续集成工具，它从Github的代码仓库中拉取代码。它在检测到仓库文件有更改之后，会在远程自动创建一个虚拟机，然后根据你的Travis CI配置文件编译你仓库中的代码并执行其他一些操作。</p>\n<p>需要注意的是，Travis CI的<a href=\"https://travis-ci.com\">官方网址</a>现在变为<strong>travis-ci.com</strong>而非travis-ci.org。后者现在是只读模式，请务必注意。</p>\n<h2 id=\"Github授权并生成Token\"><a href=\"#Github授权并生成Token\" class=\"headerlink\" title=\"Github授权并生成Token\"></a>Github授权并生成Token</h2><p>使用Travis CI首先就要对其授权使其可以访问自己的Github仓库。</p>\n<p>进入Travis CI的官网后直接用Github账号登录，根据提示开通Travis CI对仓库的访问授权。你可以选择允许访问所有仓库，也可以指定部分仓库以供访问。</p>\n<p>在自动部署的过程中，Travis CI需要通过命令对Github的仓库进行修改操作，这就需要我们登录Github服务。但是在登录的过程中，将自己的密码直接暴露出去是很危险的。所以，这里使用Token（令牌）来代替密码，以增强安全性。</p>\n<p>关于生成Github Token的方法，请看<a href=\"https://docs.github.com/cn/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token\">创建个人访问令牌 - GitHub Docs</a>。</p>\n<p>请妥善保存生成的Token。</p>\n<h2 id=\"使用Travis-CI进行持续集成\"><a href=\"#使用Travis-CI进行持续集成\" class=\"headerlink\" title=\"使用Travis CI进行持续集成\"></a>使用Travis CI进行持续集成</h2><h3 id=\"配置ssh免密登录服务器\"><a href=\"#配置ssh免密登录服务器\" class=\"headerlink\" title=\"配置ssh免密登录服务器\"></a>配置ssh免密登录服务器</h3><p>自动部署必然会对服务器端的文件进行操作，因此必须远程登录服务器。但是部署过程是由Travis CI自动完成的，我们也无法在Travis CI的控制台中输入服务器的登录密码。因此我们还要能够免密登录服务器。</p>\n<p>免密登录是基于密钥对来实现的。密钥对分为私钥和公钥，私钥以明文形式存储，由我们自己保存，千万不可泄露。而公钥由私钥加密而来，在进行ssh免密登录时，在网络中由本地传送到服务器的就是公钥。本地电脑和服务器经过一系列操作后比对生成的校验值，如果校验通过便可以登录到服务器。</p>\n<p>ssh免密登录的具体原理可以参考下图（来源：<a href=\"https://www.jianshu.com/p/33461b619d53\">图解SSH原理 - 简书 (jianshu.com)</a>）。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/ssh.jpeg\" alt=\"\"></p>\n<p>接下来讲讲实现方法。</p>\n<p>在Powershell中输入：<code>ssh-keygen -t rsa</code>。</p>\n<p>之后会提示你输入秘钥的名字，如果直接按回车跳过则会使用默认的文件名<code>id_rsa</code>。</p>\n<p>接着会让你输入并确定需要加密的密码，这里我们直接跳过。</p>\n<p>然后我们就可以在<code>C:/Users/&lt;你的用户名&gt;/.ssh</code>中看到新创建的两个文件，其中<code>id_rsa</code>为私钥，<code>id_rsa.pub</code>为公钥。</p>\n<p>在刚才的那个文件夹中创建文件<code>config</code>，不需要后缀名。其内容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 远程主机名称</span><br><span class=\"line\">Host &lt;你的服务器域名或ip地址&gt;</span><br><span class=\"line\"># 远程主机域名或者 ip 地址</span><br><span class=\"line\">HostName &lt;你的服务器域名或ip地址&gt;</span><br><span class=\"line\"># 认证方式</span><br><span class=\"line\">PreferredAuthentications publickey</span><br><span class=\"line\"># 私钥位置</span><br><span class=\"line\">IdentityFile C:/Users/&lt;你的用户名&gt;/.ssh/id_rsa</span><br><span class=\"line\"># 用户名</span><br><span class=\"line\">User root</span><br></pre></td></tr></table></figure>\n\n<p>将公钥复制一份，重命名为<code>authorized_keys</code>。然后将<code>id_rsa.pub</code>和<code>authorized_keys</code>上传到服务器的<code>~/.ssh</code>文件夹中。</p>\n<p>在终端里输入：<code>ssh root@&lt;你的服务器域名或ip地址&gt;</code>。如果不需要密码就可以登录的话，那就说明ssh免密登录设置成功了。</p>\n<p>如果在完成了上面的步骤之后在登录服务器时仍然需要输入密码，或者出现了类似下面的报错：</p>\n<p><code>Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</code></p>\n<p>那么请尝试执行下面三条命令，更改服务器上<code>~/.ssh</code>文件夹的权限。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 700 ~/.ssh/</span><br><span class=\"line\">chmod 700 /home/userName</span><br><span class=\"line\">chmod 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置Travis-Ci\"><a href=\"#配置Travis-Ci\" class=\"headerlink\" title=\"配置Travis Ci\"></a>配置Travis Ci</h3><p>在博客的的根目录下面创建Travis CI的配置文件<code>.travis.yml</code>，并且将下面模板的内容添加到文件中。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#设置构建环境为Node.js</span></span><br><span class=\"line\"><span class=\"attr\">language:</span> <span class=\"string\">node_js</span> </span><br><span class=\"line\"><span class=\"comment\">#选择Node.js版本，我这里由于没有更新Hexo，所以使用了较老的版本，该项值一般为&quot;stable&quot;</span></span><br><span class=\"line\"><span class=\"attr\">node_js:</span> <span class=\"number\">12.22</span><span class=\"number\">.5</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置需要编译的代码分支，Travis CI只检测当前分支的变动，请根据自己的实际情况修改</span></span><br><span class=\"line\"><span class=\"attr\">branches:</span></span><br><span class=\"line\">  <span class=\"attr\">only:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hexo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#在每次构建之前需要先配好环境</span></span><br><span class=\"line\"><span class=\"attr\">before_install:</span></span><br><span class=\"line\"><span class=\"comment\">#配置Travis CI免密登录服务器</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">openssl</span> <span class=\"string\">aes-256-cbc</span> <span class=\"string\">-K</span> <span class=\"string\">$encrypted_&lt;key&gt;_key</span> <span class=\"string\">-iv</span> <span class=\"string\">$encrypted_&lt;iv&gt;_iv</span></span><br><span class=\"line\">  <span class=\"string\">-in</span> <span class=\"string\">&lt;id_rsa.enc&gt;</span> <span class=\"string\">-out</span> <span class=\"string\">~/.ssh/id_rsa</span> <span class=\"string\">-d</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">chmod</span> <span class=\"number\">600</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">eval</span> <span class=\"string\">$(ssh-agent)</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">ssh-add</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">cp</span> <span class=\"string\">./ssh_config</span> <span class=\"string\">~/.ssh/config</span></span><br><span class=\"line\"><span class=\"comment\">#配置Github信息以使Travis CI可以更改仓库</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">&quot;$GIT_NAME&quot;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">&quot;$GIT_EMAIL&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#安装Hexo</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">-g</span> <span class=\"string\">hexo-cli</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装package.json中的插件</span></span><br><span class=\"line\"><span class=\"attr\">install:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#生成网页</span></span><br><span class=\"line\"><span class=\"attr\">script:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">clean</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">hexo</span> <span class=\"string\">generate</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#生成成功之后需要执行的操作（部署）</span></span><br><span class=\"line\"><span class=\"attr\">after_success:</span></span><br><span class=\"line\"><span class=\"comment\">#将./public文件夹中的网页复制到服务器上的指定位置</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">scp</span> <span class=\"string\">-o</span> <span class=\"string\">stricthostkeychecking=no</span> <span class=\"string\">-r</span> <span class=\"string\">./public/*</span> <span class=\"string\">root@&lt;你的域名或IP&gt;:&lt;博客网页存放的路径&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#在Travis CI上切换到你的博客的./public文件夹，在该路径下初始化git，以&quot;Travis CI Auto Builder&quot;的名称提交代码并推送到&quot;master&quot;分支上</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">cd</span> <span class=\"string\">./public</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">init</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">add</span> <span class=\"string\">--all</span> <span class=\"string\">.</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">commit</span> <span class=\"string\">-m</span> <span class=\"string\">&quot;Travis CI Auto Builder&quot;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">git</span> <span class=\"string\">push</span> <span class=\"string\">--quiet</span> <span class=\"string\">--force</span> <span class=\"string\">https://$GIT_TOKEN@&lt;你博客的Github仓库网址&gt;</span></span><br><span class=\"line\">  <span class=\"string\">master</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">#配置已知的主机，以保证可以成功登陆</span></span><br><span class=\"line\"><span class=\"attr\">addons:</span></span><br><span class=\"line\">  <span class=\"attr\">ssh_known_hosts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&lt;你的域名或IP&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>观察上面的文件可以发现，其中以<code>$</code>开头的变量一共出现了五次。在Travis CI的配置文件中，这些变量为环境变量，它们的值不以明文的形式出现在配置文件中，需要你自己在Travis CI的网页上设置值。</p>\n<p>在Travis CI的网页中找到你的博客的仓库。点击右上角的<code>More options</code>按钮后再点击<code>Settings</code>进入设置页面。</p>\n<p>在设置页面中，必须要打开<code>General</code>栏中的<code>Build pushed branches</code>。否则即使你推送了代码，Travis CI不会自动构建项目。</p>\n<p>然后在<code>Environment Variables</code>一栏中的空白文本框处，分别填写你的环境变量的名称<code>NAME</code>和值<code>VALUE</code>，然后点击<code>Add</code>按钮以添加。在这一小节，我们需要添加三个环境变量：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Name</th>\n<th align=\"center\">Value</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">GIT_EMAIL</td>\n<td align=\"center\">&lt;填写你Github绑定的邮箱&gt;</td>\n</tr>\n<tr>\n<td align=\"center\">GIT_NAME</td>\n<td align=\"center\">&lt;填写你Github的账户名&gt;</td>\n</tr>\n<tr>\n<td align=\"center\">GIT_TOKEN</td>\n<td align=\"center\">&lt;填写你在上一节中生成的Github Token&gt;</td>\n</tr>\n</tbody></table>\n<h3 id=\"文件加密\"><a href=\"#文件加密\" class=\"headerlink\" title=\"文件加密\"></a>文件加密</h3><p>接下来讲讲Travis CI免密登录服务器的配置以及最后剩下的两个环境变量。</p>\n<p>类比之前设置本地ssh免密登录服务器的方法，要想让Travis CI生成的虚拟机可以免密登录服务器，其必须要有公钥<code>id_rsa.pub</code>、私钥<code>id_rsa</code>、以及配置文件<code>config</code>。但是直接将私钥以明文形式上传太危险了。Travis CI提供了加密服务，可以将私钥加密以后上传到它的服务器，再在其虚拟机上解密生成私钥。这样一来，Travis CI就可以安全地进行ssh免密登录了。</p>\n<p>接下来的加密操作建议在Linux或者macOS下进行，在Windows 10上操作有可能会产生<code>bad decrypt</code>的错误。（参见：<a href=\"https://github.com/travis-ci/travis-ci/issues/4746\">File decryption fails (wrong final block length) on Windows · Issue #4746 · travis-ci/travis-ci (github.com)</a>）</p>\n<p>在加密操作之前，请先确认你的电脑上是否安装有ruby，否则无法使用gem包管理工具。</p>\n<p>执行下面的命令以安装Travis：<code>gem install travis</code>。</p>\n<p>登录Travis：<code>travis login --github-token &lt;token&gt; --pro</code>。注意这里必须加上后缀<code>--pro</code>，否则这个命令默认登录的是<code>https://api.travis-ci.org</code>而非<code>https://api.travis-ci.com</code>。</p>\n<p>在存放有你的私钥<code>id_rsa</code>以及<code>.travis.yml</code>的目录下执行：<code>travis encrypt-file id_rsa --add --pro</code>。如果这个目录不是你存放博客的Github仓库的本地文件夹，那么请按照给出的提示添加后缀。</p>\n<p>执行完毕后，在该文件夹下会新增一个<code>id_rsa.enc</code>文件。这个文件就是经过加密后的私钥了。检查<code>.travis.yml</code>文件，会发现其中多了一行类似于下面的代码：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">openssl</span> <span class=\"string\">aes-256-cbc</span> <span class=\"string\">-K</span> <span class=\"string\">$encrypted_&lt;key&gt;_key</span> <span class=\"string\">-iv</span> <span class=\"string\">$encrypted_&lt;iv&gt;_iv</span>  <span class=\"string\">-in</span> <span class=\"string\">id_rsa.enc</span> <span class=\"string\">-out</span> <span class=\"string\">id_rsa</span> <span class=\"string\">-d</span></span><br></pre></td></tr></table></figure>\n\n<p>上面<code>&lt;key&gt;</code>和<code>&lt;iv&gt;</code>的值是随机生成的数字和字母的组合，该命令的作用在于解密<code>id_rsa.enc</code>以得到私钥<code>id_rsa</code>。<code>-in</code>表示输入文件，<code>-out</code>表示解密后的文件，我们将其路径修改为<code>~/.ssh/id_rsa</code>，可以得到：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">openssl</span> <span class=\"string\">aes-256-cbc</span> <span class=\"string\">-K</span> <span class=\"string\">$encrypted_&lt;key&gt;_key</span> <span class=\"string\">-iv</span> <span class=\"string\">$encrypted_&lt;iv&gt;_iv</span></span><br><span class=\"line\">  <span class=\"string\">-in</span> <span class=\"string\">&lt;id_rsa.enc&gt;</span> <span class=\"string\">-out</span> <span class=\"string\">~/.ssh/id_rsa</span> <span class=\"string\">-d</span></span><br></pre></td></tr></table></figure>\n\n<p>此外，在Travis CI对应仓库的设置中，还会新增两个环境变量<code>encrypted_&lt;key&gt;_key</code>与<code>encrypted_&lt;iv&gt;_iv</code>。</p>\n<p>在得到私钥后，我们还要进行下面的操作以使Travis CI可以免密登录服务器。</p>\n<p>在<code>.travis.yml</code>中按照模板的格式添加以下代码：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">chmod</span> <span class=\"number\">600</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">eval</span> <span class=\"string\">$(ssh-agent)</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">ssh-add</span> <span class=\"string\">~/.ssh/id_rsa</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"string\">cp</span> <span class=\"string\">./ssh_config</span> <span class=\"string\">~/.ssh/config</span></span><br></pre></td></tr></table></figure>\n\n<p>然后，将<code>id_rsa.enc</code>移入你的博客的根目录下，并切记<strong>删除你在博客目录下的私钥！</strong>。</p>\n<p>在博客根目录下新建文件<code>ssh_config</code>，将下面的内容复制进去并保存。我们需要它来配置Travis CI上的ssh登录过程。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Host *</span><br><span class=\"line\">  User git</span><br><span class=\"line\">  StrictHostKeyChecking no</span><br><span class=\"line\">  IdentityFile ~/.ssh/id_rsa</span><br><span class=\"line\">  IdentitiesOnly yes</span><br></pre></td></tr></table></figure>\n\n<p>到这里，所有的配置工作就完成了！</p>\n<h2 id=\"最终实现的效果\"><a href=\"#最终实现的效果\" class=\"headerlink\" title=\"最终实现的效果\"></a>最终实现的效果</h2><p>经过上面的一系列复杂操作，我们最终实现了博客的持续集成，其工作流如下：</p>\n<ol>\n<li>在本地编辑Markdown文件</li>\n<li>编辑完成后直接推送到Github的目标分支上</li>\n<li>Travis CI检测到指定分支上文件的更改</li>\n<li>Travis CI创建虚拟机并依据配置文件生成博客网页文件</li>\n<li>Travis CI将生成的网页复制到服务器的指定位置，完成部署</li>\n</ol>\n<p>在部署的过程中，只有第二步是需要我们进行操作的，其他的工作全部由Travis CI自动完成了，非常的方便。</p>\n<p>点击Travis CI对应仓库标题右侧的绿色图标可以将其以Markdown格式添加到你的Github仓库的<code>readme.md</code>文件中。如果Travis CI操作的分支不是默认分支，那么这个图标将只显示<code>unknown</code>的状态。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/build_passing_mark.png\" alt=\"\"></p>\n<hr>\n<p>参考：</p>\n<p><a href=\"https://juejin.cn/post/6946220560938434596#heading-13\">使用 Travis 打造 SpringBoot 应用持续集成和自动部署 | Travis CI 初体验 (juejin.cn)</a></p>\n<p><a href=\"https://kchen.cc/2016/11/12/hexo-instructions/#总结\">基于 Hexo 的全自动博客构建部署系统 - KChen’s Blog</a></p>\n"},{"title":"Hexo主题Icarus的自定义","date":"2021-08-23T09:20:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/icarus.png","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/icarus.png","excerpt":"填坑。","_content":"\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第三篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n- “建站搭博客”系列之一：[华为云+nginx服务器搭建总结](https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/)\n- “建站搭博客”系列之二：[Hexo博客的安装和自动部署](https://astrobear.top/2021/08/16/Hexo的安装和自动部署/)\n\nIcarus是Hexo的一款简单、精致、现代的主题，也是我的博客目前正在使用的主题。这款主题无论从颜值还是从功能上看都相当优秀。但是针对我的需求而言，它仍然有一些不足之处。即使Icarus支持大量的自定义功能以及丰富的插件，要想实现我的目标功能，依旧需要对这个主题进行魔改。此外，在博客迁移的过程中，我还顺便将其版本升级为最新。在此将其过程一并记录下来以供参考。\n\n# Icarus的升级过程\n\n<article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n在升级前请务必备份你的原文件！\n</div>\n</article>\n\n根据主题作者的教程，如果你打算通过修改源代码的方式自定义主题，你必须从源代码安装主题。所以我直接在[该主题的Release](https://github.com/ppoffice/hexo-theme-icarus/releases)下载了其最新版本（4.4.0）的源代码，将文件夹下`./themes/icarus/`中现有的旧文件全部删除后，再将新版本的主题文件复制进去。\n\n完成上面的操作以后在终端中执行`hexo clean`，再执行`hexo g`。由于只是将主题由旧版本升级到最新，其使用的相关依赖和包都还没升级。因此，在生成的过程中可能会出现错误。\n\n依照命令行给出的提示，输入：`npm install --save bulma-stylus@0.8.0 hexo@^5.0.2 hexo-log@^2.0.0 hexo-renderer-inferno@^0.1.3 hexo-renderer-stylus@^2.0.0 hexo-util@^2.2.0 hexo-component-inferno@^0.13.0 inferno@^7.3.3 inferno-create-element@^7.3.3`（视实际情况，命令的内容会有所不同），终端会自动安装所需要的依赖。\n\n安装完成后再次尝试生成博客，这时应该不会再报错了。但是，控制台中出现了新的警告：\n\n```\nDeprecated as of 10.7.0. highlight(lang, code, ...args) has been deprecated.\nDeprecated as of 10.7.0. Please use highlight(code, options) instead.\nhttps://github.com/highlightjs/highlight.js/issues/2277\n```\n\n经过查询，这是由Hexo的一个依赖：`hexo-util`引起的，其作者已经在最新的版本中修正了这一错误（参考：[BugFix: Correct highlighting of multi-line element (fix #10 and hexojs/hexo#2291) by seaoak · Pull Request #22 · hexojs/hexo-util (github.com)](https://github.com/hexojs/hexo-util/pull/22)）。因此，只需要在终端中输入`npm install hexo-util --save`将其更新即可（终端的操作位置应当切换到你的博客所在的文件夹下）。\n\n此外，在更新的过程中，Icarus还会在你的博客根目录创建一个新的主题配置文件`_config,icarus.yml`。这一动作会在终端中以警告的形式表现出来。在完成上述操作后，请不要忘记将旧的主题文件的配置迁移到新的上面。\n\n# 布局\n\n## 文章页面设为两栏布局\n\nIcarus的默认布局为三栏布局，但是在显示文章正文时，三栏布局的挂件（Widgets）会占用文章大量的显示空间。所以，在这里将文章设置成两栏布局较好。\n\nIcarus在更新后提供了通过配置文件来设置页面布局的方法。我们在博客的根目录下新建一个配置文件`_config.post.yml`。在文章页面，`_config.post.yml`会覆盖同一文件夹下的`_config.icarus.yml`中的设置，也即文章页面将只显示在`_config.post.yml`中指明的挂件。所以在该配置文件中，只需要写入想要在文章页面显示的挂件便可以实现两栏布局。\n\n下面给出了`_config.post.yml`的示例，请根据自己的需要增删内容。\n\n```yaml _config.post.yml\nwidgets:\n    # Profile widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: profile\n        # Author name\n        author: Astrobear\n        # Author title\n        author_title: Building my fortress.\n        # Author's current location\n        location: PRC\n        # URL or path to the avatar image\n        avatar: /img/avatar.jpeg\n        # Whether show the rounded avatar image\n        avatar_rounded: true\n        # Email address for the Gravatar\n        gravatar: \n        # URL or path for the follow button\n        follow_link: 'https://github.com/Astrobr'\n        # Links to be shown on the bottom of the profile widget\n        social_links:\n            Github:\n                icon: fab fa-github\n                url: 'https://github.com/Astrobr'\n            Facebook:\n                icon: fab fa-facebook\n                url: 'https://www.facebook.com/astrobearforwork'\n            Instagram:\n                icon: fab fa-instagram\n                url: 'https://www.instagram.com/astrobarchen/'\n            #Twitter:\n            #    icon: fab fa-twitter\n            #    url: 'https://twitter.com'\n            #Dribbble:\n            #    icon: fab fa-dribbble\n            #    url: 'https://dribbble.com'\n            #RSS:\n            #    icon: fas fa-rss\n            #    url: /\n    # Table of contents widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: toc\n        # Whether to show the index of each heading\n        index: true\n        # Whether to collapse sub-headings when they are out-of-view\n        collapsed: true\n        # Maximum level of headings to show (1-6)\n        depth: 3\n```\n\n在按照上面的方法修改后，页面右侧的挂件被移除后会空出很多空间。因此我们需要调整一下两栏布局的宽度，使所有页面的侧边宽度一致。下面所有的代码对应文件的路径，除特别注明外，均在Icarus的主题文件夹`./themes/icarus/`下。\n```diff layout/layout.jsx\n             <Head site={site} config={config} helper={helper} page={page} />\n-            <body class={`is-${columnCount}-column`}>\n+            <body class={`is-3-column`}>\n                 <Navbar config={config} helper={helper} page={page} />\n```\n\n```diff layout/layout.jsx\n                                 'is-12': columnCount === 1,\n-                                'is-8-tablet is-8-desktop is-8-widescreen': columnCount === 2,\n+                                'is-8-tablet is-8-desktop is-9-widescreen': columnCount === 2,\n                                 'is-8-tablet is-8-desktop is-6-widescreen': columnCount === 3\n```\n\n```diff layout/common/widgets.jsx\nfunction getColumnSizeClass(columnCount) {\n     switch (columnCount) {\n         case 2:\n-            return 'is-4-tablet is-4-desktop is-4-widescreen';\n+            return 'is-4-tablet is-4-desktop is-3-widescreen';\n         case 3:\n             return 'is-4-tablet is-4-desktop is-3-widescreen';\n     }\n```\n\n下面的代码用于优化不同屏幕大小下的宽度。\n\n```diff include/style/responsive.styl\n +widescreen()\n+    .is-3-column .container\n+        max-width: $widescreen - $gap\n+        width: $widescreen - $gap\n+\n     .is-1-column .container, .is-2-column .container\n         max-width: $desktop - 2 * $gap\n         width: $desktop - 2 * $gap\n\n +fullhd()\n+    .is-3-column .container\n+        max-width: $fullhd - 2 * $gap\n+        width: $fullhd - 2 * $gap\n+\n     .is-2-column .container\n         max-width: $widescreen - 2 * $gap\n         width: $widescreen - 2 * $gap\n```\n\n## 优化标题布局\n\n这里将标题移动到正文上方，增加了更新时间，以及相对应的图标。\n\n```diff layout/common/article.jsx\n                 {/* Metadata */}\n                 <article class={`card-content article${'direction' in page ? ' ' + page.direction : ''}`} role=\"article\">\n+                    {/* Title */}\n+                    <h1 className=\"title is-size-3 is-size-4-mobile has-text-weight-normal\">\n+                        {index ?\n+                            <a className=\"has-link-black-ter\" href={url_for(page.link || page.path)}>\n+                                <i className=\"fas fa-angle-double-right\"></i>{page.title}\n+                            </a> :\n+                            [<i className=\"fas fa-angle-double-right\"></i>, page.title]\n+                        }\n+                    </h1>\n                     {page.layout !== 'page' ? <div class=\"article-meta is-size-7 is-uppercase level is-mobile\">\n                         <div class=\"level-left\">\n                             {/* Creation Date */}\n-                            {page.date && <span class=\"level-item\" dangerouslySetInnerHTML={{\n-                                __html: _p('article.created_at', `<time dateTime=\"${date_xml(page.date)}\" title=\"${date_xml(page.date)}\">${date(page.date)}</time>`)\n-                            }}></span>}\n+                            {page.date && <span class=\"level-item\">\n+                                <i className=\"far fa-calendar-alt\">&nbsp;</i>\n+                                <time dateTime=\"${date_xml(page.date)}\" title=\"${date_xml(page.date)}\">{date(page.date)}</time>\n+                            </span>}\n                             {/* Last Update Date */}\n-                            {page.updated && <span class=\"level-item\" dangerouslySetInnerHTML={{\n-                                __html: _p('article.updated_at', `<time dateTime=\"${date_xml(page.updated)}\" title=\"${date_xml(page.updated)}\">${date(page.updated)}</time>`)\n-                            }}></span>}\n+                            {page.updated && <span class=\"level-item is-hidden-mobile\">\n+                                <i class=\"far fa-calendar-check\">&nbsp;</i>\n+                                <time dateTime=\"${date_xml(page.updated)}\" title=\"${date_xml(page.updated)}\">{date(page.updated)}</time>\n+                            </span>}\n                             {/* author */}\n                             {page.author ? <span class=\"level-item\"> {page.author} </span> : null}\n```\n\n标题下方的发布时间与更新时间均改为直接使用日期。\n\n```diff source/js/main.js\n-    if (typeof moment === 'function') {\n-        $('.article-meta time').each(function() {\n-            $(this).text(moment($(this).attr('datetime')).fromNow());\n-        });\n-    }\n```\n\n## 优化文章结尾布局\n\n在文章结尾增加一个`hr`以调整间距。另外设置在预览时也显示标签（tags），并将`Read More`按钮置于右侧且添加图标。\n\n```diff layout/common/article.jsx\n                     {/* Licensing block */}\n                     {!index && article && article.licenses && Object.keys(article.licenses)\n                         ? <ArticleLicensing.Cacheable page={page} config={config} helper={helper} /> : null}\n+                    <hr style=\"height:1px;margin:1rem 0\"/>\n+                    <div className=\"level is-mobile is-flex\">\n                     {/* Tags */}\n-                    {!index && page.tags && page.tags.length ? <div class=\"article-tags is-size-7 mb-4\">\n-                        <span class=\"mr-2\">#</span>\n-                        {page.tags.map(tag => {\n-                            return <a class=\"link-muted mr-2\" rel=\"tag\" href={url_for(tag.path)}>{tag.name}</a>;\n+                    {page.tags && page.tags.length ? <div class=\"article-tags is-size-7 is-uppercase\">\n+                        <i class=\"fas fa-tags has-text-grey\"></i>&nbsp;\n+                        {page.tags.map((tag, index) => {\n+                            return <a class=\"link-muted\" rel=\"tag\" href={url_for(tag.path)}>{tag.name}{index !== page.tags.length-1? ', ':''}</a>;\n                         })}\n                     </div> : null}\n                     {/* \"Read more\" button */}\n-                    {index && page.excerpt ? <a class=\"article-more button is-small is-size-7\" href={`${url_for(page.link || page.path)}#more`}>{__('article.more')}</a> : null}\n+                    {index && page.excerpt ? <a class=\"article-more button is-small is-size-7\" href={`${url_for(page.link || page.path)}#more`}><i class=\"fas fa-book-reader has-text-grey\"></i>&nbsp;&nbsp;{__('article.more')}</a> : null}\n+                    </div>\n                     {/* Share button */}\n```\n\n## 优化个人信息布局\n\n将下方博客数据统计修改为链接，在`Follow`按钮前增加Github图标。\n\n```diff layout/widget/profile.jsx\n-                    <div class=\"level-item has-text-centered is-marginless\">\n+                    <a class=\"level-item has-text-centered is-marginless\" href={counter.category.url}>\n                         <div>\n                             <p class=\"heading\">{counter.category.title}</p>\n-                            <a href={counter.category.url}>\n+                            <div>\n                                 <p class=\"title\">{counter.category.count}</p>\n-                            </a>\n+                            </div>\n                         </div>\n-                    </div>\n+                    </a>\n```\n\n```diff layout/widget/profile.jsx\n{followLink ? <div class=\"level\">\n-\t\t\t\t\t <a class=\"level-item button is-primary is-rounded\" href={followLink} target=\"_blank\" rel=\"noopener\">&nbsp;&nbsp;{followTitle}</a>\n+                    <a class=\"level-item button is-primary is-rounded\" href={followLink} target=\"_blank\" rel=\"noopener\"><i class=\"fab fa-github\"></i>&nbsp;&nbsp;{followTitle}</a>\n                </div> : null}\n```\n\n## 目录粘性定位\n\n```diff source/js/main.js\nif ($toc.length > 0) {\n+        $toc.addClass('column-left is-sticky');\n         const $mask = $('<div>');\n```\n\n```diff include/style/widget.styl\n+#toc\n+    max-height: calc(100vh - 22px)\n+    overflow-y: scroll\n```\n\n# 功能\n\n## 夜间模式\n\n复制下面的代码，然后在`./themes/icarus/source/css/`目录下创建`night.styl`文件并粘贴。\n\n{% codeblock \"night.styl\" lang:stylus >folded %}\ndark-primary-color = rgb(55, 61, 72)\ndark-primary-color-hover = rgb(67, 74, 86)\ndark-primary-color-active = rgb(44, 49, 58)\ndark-font-color = #c0c0c0\n\n\n\n#universe\n  display: none\n\n.navbar-logo,\n.footer-logo\n  .logo-img-dark\n    display: none\n\nbody.night\n  background: #0e1225\n\n.night\n  // code highlight (https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css)\n  // navigation bar, cards\n  .content code\n    color: rgb(203,186,125)\n\n  // night icon changed to fas fa-sun\n  #night-nav #night-icon:before\n    content: '\\f185'\n\n  .navbar-menu\n    background-color: inherit\n  .navbar-main .navbar-menu .navbar-item\n    &:hover,\n    &:focus\n      color: #ffffff\n      background-color: dark-primary-color\n  .navbar,\n  .card\n    background-color: rgba(40, 44, 52, 0.5)\n    backdrop-filter: none\n    -webkit-backdrop-filter: none\n\n  .card\n    &:hover\n      background-color: rgba(40, 44, 52, 0.8)\n\n  .footer\n    background-color: rgba(40, 44, 52, 0.5)\n    backdrop-filter: none\n    -webkit-backdrop-filter: none\n\n    &:before\n      background-color: rgba(40, 44, 52, 0.5)\n\n  // input\n\n  .input, .textarea\n    background-color: dark-primary-color-hover\n    border-color: dark-primary-color\n\n  // message\n  .message.message-immersive\n    background-color: #c2c2c2\n    .message-body\n      color: #222222\n  .message.message-immersive.is-info\n    background-color: #bdc3c8 \n    .message-body\n      color: #004779\n  .message.message-immersive.is-warning\n    background-color: #cbc8ba\n    .message-body\n      color: #5b4b00\n  .message.message-immersive.is-danger\n    background-color: #c6babe\n    .message-body\n      color: #79000f\n  .message.message-immersive.is-success\n    background-color: #bfc7c0\n    .message-body\n      color: #1e4d1c\n  .message.message-immersive.is-primary\n    background-color: #bdc0c9\n    .message-body\n      color: #003790\n\n\n\n\n\n  // button\n\n  .button.is-primary, .button.is-light, .button.is-small\n    background-color: dark-primary-color\n    color: dark-font-color\n\n    &:hover, &.is-hovered\n      color: #ffffff\n      background-color: dark-primary-color-hover\n    \n    &:active, &.is-active\n      color: #ffffff\n      background-color: dark-primary-color-active\n\n  .button.is-white,\n  .button.is-transparent\n    background-color: transparent\n\n    &:hover\n      background-color: dark-primary-color !important\n\n  .pagination .pagination-next,\n  .pagination .pagination-previous\n  .pagination-link:not(.is-current)\n    color: dark-font-color\n\n\n\n\n\n  // button\n\n  .button.is-primary, .button.is-light, .button.is-small\n    background-color: dark-primary-color\n    color: dark-font-color\n\n    &:hover, &.is-hovered\n      color: #ffffff\n      background-color: dark-primary-color-hover\n    \n    &:active, &.is-active\n      color: #ffffff\n      background-color: dark-primary-color-active\n\n  .button.is-white,\n  .button.is-transparent\n    background-color: transparent\n\n    &:hover\n      background-color: dark-primary-color !important\n\n  .pagination .pagination-next,\n  .pagination .pagination-previous\n  .pagination-link:not(.is-current)\n    color: dark-font-color\n    background-color: dark-primary-color\n\n    a\n      color: dark-font-color\n\n  .pagination-link.is-current\n    background-color: dark-primary-color-hover\n    border-color: dark-primary-color-hover\n\n  // comment\n\n  .v .vwrap,\n  .v .vwrap .vheader .vinput\n    border-color: dark-primary-color\n\n  .v .vwrap .vheader .vinput:focus\n    border-color: dark-primary-color-hover\n\n  .v .vbtn\n    color: dark-font-color\n    background-color: dark-primary-color\n    border-color: dark-primary-color\n\n    &:hover\n      background-color: dark-primary-color-hover\n    \n    &:active\n      background-color: dark-primary-color-active\n\n  .v .vlist .vcard .vhead .vsys\n    background-color: dark-primary-color\n\n  .v a:hover,\n  .v .vlist .vcard .vh .vmeta .vat\n    color: #ffffff\n\n  .v .vlist .vcard .vcontent.expand:before\n    background: -webkit-gradient(linear, left top, left bottom, from(rgba(37, 41, 54, 0)), to(rgba(37, 41, 54, 1)))\n    background: linear-gradient(180deg, rgba(37, 41, 54, 0), rgba(37, 41, 54, 1))\n\n  .v .vlist .vcard .vcontent.expand:after\n    background: rgba(37, 41, 54, 1)\n\n  .v .vlist .vcard .vh,\n  .v .vlist .vcard .vquote\n    border-color: dark-primary-color-hover\n\n  // font color\n\n  body,\n  strong,\n  time,\n  .title,\n  .footer,\n  .card,\n  .content h1,\n  .content h2,\n  .content h3,\n  .content h4,\n  .content h5,\n  .content h6,\n  .navbar-item,\n  .navbar-item.is-active,\n  .navbar-link,\n  .menu-list a,\n  .menu-label,\n  .level-item,\n  .input,\n  .textarea,\n  .button.is-white,\n  .button.is-transparent,\n  .article-licensing,\n  .v *\n    color: dark-font-color\n\n  .media-content,\n  .has-text-grey,\n  .link-muted\n    color: dark-font-color !important\n\n  a\n    color: rgb(82, 153, 224)\n\n    &:hover\n      color: #ffffff\n\n  // quote\n\n  .content blockquote,\n  .article-licensing\n    background-color: dark-primary-color\n    border-color: dark-primary-color-hover\n\n  .post-copyright\n    background-color: dark-primary-color\n    border-color: dark-primary-color-hover\n\n  // table\n\n  .content table thead td,\n  .content table thead th\n    color: dark-font-color\n\n  .content table td,\n  .content table th\n    border-color: dark-primary-color-hover\n\n  // break line\n\n  hr\n    background-color: dark-primary-color-hover\n\n  // tags and menus\n\n  article.article, article.media\n\n    .title:hover a\n      // override anotherr !important\n      color: dark-font-color !important\n\n  .tag:not(body)\n    color: dark-font-color\n    background-color: dark-primary-color\n\n  .tag.is-grey\n    background-color: dark-primary-color-hover\n\n  .menu-list a:hover\n    background-color: dark-primary-color\n\n  .menu-list a.is-active\n    background-color: dark-primary-color-hover\n\n  .menu-list li ul\n    border-color: dark-primary-color\n\n  // time line\n\n  .timeline .media:last-child:after\n    background-color: rgb(37, 41, 54)\n\n  .timeline\n    border-color: dark-primary-color-hover\n\n  .timeline .media:before\n    background-color: dark-primary-color-hover\n\n  // search box\n\n  .searchbox\n    .searchbox-container,\n    .searchbox-header,\n    .searchbox-header .searchbox-input,\n    .searchbox-header .searchbox-close,\n    .searchbox-body,\n    .searchbox-result-section,\n    .searchbox-result-item\n      color: dark-font-color\n      background-color: dark-primary-color\n      border-color: dark-primary-color-hover\n\n    .searchbox-container .searchbox-result-section .searchbox-result-item:hover,\n    .searchbox-container .searchbox-result-section .searchbox-result-item.active,\n    .searchbox-container .searchbox-header .searchbox-close:hover\n      color: #ffffff\n      background-color: dark-primary-color-hover\n\n  // selection\n\n  ::selection\n    color: #ffffff\n    background-color: rgba(52, 109, 167, 0.8)\n\n  ::-moz-selection\n    color: #ffffff\n    background-color: rgba(52, 109, 167, 0.8)\n\n  input:-webkit-autofill\n    -webkit-text-fill-color: dark-font-color !important\n    box-shadow: 0 0 0px 1000px dark-primary-color inset\n\n  .hljs {\n    display: block;\n    overflow-x: auto;\n\n    padding: 0.5em;\n    color: #abb2bf;\n    background: #282c34\n  }\n\n  .hljs-comment, .hljs-quote {\n    color: #5c6370;\n    font-style: italic\n  }\n\n  .hljs-doctag, .hljs-keyword, .hljs-formula {\n    color: #c678dd\n  }\n\n  .hljs-section, .hljs-name, .hljs-selector-tag, .hljs-deletion, .hljs-subst {\n    color: #e06c75\n  }\n\n  .hljs-literal {\n    color: #56b6c2\n  }\n\n  .hljs-string, .hljs-regexp, .hljs-addition, .hljs-attribute, .hljs-meta-string {\n    color: #98c379\n  }\n\n  .hljs-built_in, .hljs-class .hljs-title {\n    color: #e6c07b\n  }\n\n  .hljs-attr, .hljs-variable, .hljs-template-variable, .hljs-type, .hljs-selector-class, .hljs-selector-attr, .hljs-selector-pseudo, .hljs-number {\n    color: #d19a66\n  }\n\n  .hljs-symbol, .hljs-bullet, .hljs-link, .hljs-meta, .hljs-selector-id, .hljs-title {\n    color: #61aeee\n  }\n\n  .hljs-emphasis {\n    font-style: italic\n  }\n\n  .hljs-strong {\n    font-weight: bold\n  }\n\n  .hljs-link {\n    text-decoration: underline\n  }\n{% endcodeblock %}\n\n接下来需要修改一下样式文件。\n\n```diff source/css/default.styl\n  @import 'style'\n+ @import 'night'\n```\n\n然后在`./themes/icarus/source/js`下创建`night.js`文件，其内容如下：\n\n```js night.js\n(function () {\n  /**\n\n   * Icarus 夜间模式 by iMaeGoo\n   * https://www.imaegoo.com/\n      */\n\n    var isNight = localStorage.getItem('night');\n    var nightNav;\n\n  function applyNight(value) {\n      if (value.toString() === 'true') {\n          document.body.classList.remove('light');\n          document.body.classList.add('night');\n      } else {\n          document.body.classList.remove('night');\n          document.body.classList.add('light');\n      }\n  }\n\n  function findNightNav() {\n      nightNav = document.getElementById('night-nav');\n      if (!nightNav) {\n          setTimeout(findNightNav, 100);\n      } else {\n          nightNav.addEventListener('click', switchNight);\n      }\n  }\n\n  function switchNight() {\n      isNight = isNight ? isNight.toString() !== 'true' : true;\n      applyNight(isNight);\n      localStorage.setItem('night', isNight);\n  }\n\n  findNightNav();\n  isNight && applyNight(isNight);\n}());\n```\n\n最后，还要修改一下下面两个文件。\n\n```diff layout/common/scripts.jsx\n\t\t\t <script src={url_for('/js/main.js')} defer></script>\n+            <script src={url_for('/js/night.js')} defer={true}></script>\n        </Fragment>;\n```\n\n```diff layout/commom/navbar.jsx\n\t\t\t\t<div class=\"navbar-end\">\n+                        <a class=\"navbar-item night\" id=\"night-nav\" title=\"Night Mode\" href=\"javascript:;\">\n+\t                        <i class=\"fas fa-moon\" id=\"night-icon\"></i>\n+                        </a>\n                        {Object.keys(links).length ? <Fragment>\n```\n\n## Mathjax自动换行\n\n在文章中，如果一行数学公式过长的话，公式内容会跑到文章栏的外面，非常难看。这里要设置的是使长公式根据页面宽度自动换行显示。\n\n在`./themes/icarus/source/js/`目录下新建一个名为`mathjax-config.js`的文件，其内容如下：\n\n```js mathjax-config.js\ndocument.addEventListener('DOMContentLoaded', function () {\n    MathJax.Hub.Config({\n        showProcessingMessages: false,\n        messageStyle: \"none\",\n        'HTML-CSS': {\n            matchFontHeight: false,\n            linebreaks: { automatic: true },\n        },\n        SVG: {\n            matchFontHeight: false,\n            linebreaks: { automatic: true },\n        },\n        CommonHTML: {\n            matchFontHeight: false,\n            linebreaks: { automatic: true },\n        },\n        tex2jax: {\n            inlineMath: [\n                ['$','$'],\n                ['\\\\(','\\\\)']\n            ],\n            displayMath: [ \n                ['$$','$$'], \n                [\"\\\\[\",\"\\\\]\"] \n            ]\n        }\n    });\n});\n```\n\n然后修改下面的文件即可。\n\n```diff layout/layout.jsx\n \t\t<Search config={config} helper={helper} />\n             </body>\n+            <script type=\"text/javascript\" src=\"/js/mathjax-config.js\"></script>\n        </html>;\n```\n\n# 样式\n\n## 在页面底部添加创作共用许可协议的图标\n\n按照下面的方法更改代码即可。\n\n```diff layout/common/footer.jsx\n                                 const link = links[name];\n                                 return <p class=\"control\">\n                                     <a class={`button is-transparent ${link.icon ? 'is-large' : ''}`} target=\"_blank\" rel=\"noopener\" title={name} href={link.url}>\n-                                        {link.icon ? <i class={link.icon}></i> : name}\n+                                        {link.icon ?\n+                                            (Array.isArray(link.icon) ?\n+                                                link.icon.map(i => [<i className={i}></i>, '\\u00A0']) :\n+                                                <i className={link.icon}></i>\n+                                        ) : name}\n                                     </a>\n                                 </p>;\n                             })}\n```\n\n```diff include/schema/common/footer.json\n-            \"$ref\": \"/misc/poly_links.json\",\n```\n\n在`_config.icarus.yml`中添加如下配置：\n\n```yaml _config.icarus.yml\nfooter:\n    links:\n        CC BY-NC-SA 4.0:\n            icon:\n              - fab fa-creative-commons\n              - fab fa-creative-commons-by\n              - fab fa-creative-commons-nc\n              - fab fa-creative-commons-sa\n            url: 'https://creativecommons.org/licenses/by-nc-sa/4.0/'\n```\n\n## 按钮背景颜色增加渐变\n\n```diff include/style/widget.styl\n .widget\n     .menu-list\n         li\n             ul\n                 margin-right: 0\n+        a\n+            transition: background-color 0.3s ease-in-out\n         .level\n             margin-bottom: 0\n```\n\n## 挂件卡片增加浮动效果\n\n当鼠标悬浮在卡片上时增大阴影，并且设置渐变动画效果。\n\n```diff include/style/card.styl\n .card\n     overflow: visible\n     border-radius: $card-radius\n+    &:hover\n+        box-shadow: 0 6px 15px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1)\n```\n\n```diff source/js/animation.js\n     setTimeout(() => {\n         $('body > .navbar, body > .section, body > .footer').forEach(element => {\n             element.style.opacity = '1';\n-            element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';\n+            element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out';\n         });\n```\n\n```diff source/js/animation.js\n                     element.style.transform = '';\n-                    element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';\n+                    element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out';\n                 }, i * 100);\n```\n\n## 修改标签颜色\n\n由于此处新增了夜间模式，所以需要修改两个`.styl`文件。\n\n```diff include/style/widget.styl\n\t.tags\n         .tag:first-child\n-            background: $primary\n-            color: $primary-invert\n+            background: $light-grey\n+            color: #4a4a4a\n\n         .tag:last-child\n-            background: $light-grey\n+            background: #e7e7e7\n             color: $white-invert\n```\n\n```diff source/css/night.styl\n .title:hover a\n       // override anotherr !important\n       color: dark-font-color !important\n\n+  .tags\n+    .tag:first-child\n+      background: dark-primary-color\n+      color: dark-font-color\n+\n+    .tag:last-child\n+      background: rgb(45, 51, 62)\n+      color: dark-font-color\n\n   .tag:not(body)\n     color: dark-font-color\n     background-color: dark-primary-color\n```\n\n## 滚动条统一改为新样式\n\nIcarus在最近的更新中修改了滚动条的样式。相比之前的系统默认样式，新版本的滚动条看起来更窄并做了圆角化处理。但是Icarus的作者只修改了桌面端的滚动条样式，在移动端或者当桌面端的浏览器窗口变窄时，滚动条会变为之前傻大黑粗的默认样式。为了美观和统一，只需要在`./themes/icarus/include/style/base.styl`文件的末尾添加下面的代码，即可完美解决上述问题。\n\n```stylus base.styl\n+mobile()\n    ::-webkit-scrollbar\n        width: 8px\n        height: 8px\n\n    ::-webkit-scrollbar-track\n        border-radius: 3px\n        background: rgba(0,0,0,0.06)\n        box-shadow: inset 0 0 5px rgba(0,0,0,0.1)\n\n    ::-webkit-scrollbar-thumb\n        border-radius: 3px\n        background: rgba(0,0,0,0.12)\n        box-shadow: inset 0 0 10px rgba(0,0,0,0.2)\n\n    ::-webkit-scrollbar-thumb:hover\n        background: rgba(0,0,0,0.24)\n\n+tablet()\n    ::-webkit-scrollbar\n        width: 8px\n        height: 8px\n\n    ::-webkit-scrollbar-track\n        border-radius: 3px\n        background: rgba(0,0,0,0.06)\n        box-shadow: inset 0 0 5px rgba(0,0,0,0.1)\n\n    ::-webkit-scrollbar-thumb\n        border-radius: 3px\n        background: rgba(0,0,0,0.12)\n        box-shadow: inset 0 0 10px rgba(0,0,0,0.2)\n\n    ::-webkit-scrollbar-thumb:hover\n        background: rgba(0,0,0,0.24)\n```\n\n\n\n---\n\n参考：\n\n[Icarus 主题自定义 - Alpha Lxy](https://www.alphalxy.com/2019/03/customize-icarus/#页面footer显示一组icon)\n\n[Icarus用户指南 - 主题配置 - Icarus (ppoffice.github.io)](https://ppoffice.github.io/hexo-theme-icarus/Configuration/icarus用户指南-主题配置/)\n\n[Hexo 主题 icarus 4 配置夜间模式 Night Mode - Asahi's Blog (asahih.com)](https://blog.asahih.com/hexo-icarus-night-mode/)\n\n[Hexo折腾系列（四）鼠标指针美化 - 江风引雨の小po站 (luzy.top)](https://blog.luzy.top/posts/486003558/)\n\n\n\n\n\n\n\n\n\n","source":"_posts/Hexo主题Icarus的自定义.md","raw":"---\ntitle: Hexo主题Icarus的自定义\ndate: 2021-08-23 17:20:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Hexo\n\t- Icarus\n\t- Blog\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/icarus.png\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/icarus.png\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 填坑。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第三篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n- “建站搭博客”系列之一：[华为云+nginx服务器搭建总结](https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/)\n- “建站搭博客”系列之二：[Hexo博客的安装和自动部署](https://astrobear.top/2021/08/16/Hexo的安装和自动部署/)\n\nIcarus是Hexo的一款简单、精致、现代的主题，也是我的博客目前正在使用的主题。这款主题无论从颜值还是从功能上看都相当优秀。但是针对我的需求而言，它仍然有一些不足之处。即使Icarus支持大量的自定义功能以及丰富的插件，要想实现我的目标功能，依旧需要对这个主题进行魔改。此外，在博客迁移的过程中，我还顺便将其版本升级为最新。在此将其过程一并记录下来以供参考。\n\n# Icarus的升级过程\n\n<article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n在升级前请务必备份你的原文件！\n</div>\n</article>\n\n根据主题作者的教程，如果你打算通过修改源代码的方式自定义主题，你必须从源代码安装主题。所以我直接在[该主题的Release](https://github.com/ppoffice/hexo-theme-icarus/releases)下载了其最新版本（4.4.0）的源代码，将文件夹下`./themes/icarus/`中现有的旧文件全部删除后，再将新版本的主题文件复制进去。\n\n完成上面的操作以后在终端中执行`hexo clean`，再执行`hexo g`。由于只是将主题由旧版本升级到最新，其使用的相关依赖和包都还没升级。因此，在生成的过程中可能会出现错误。\n\n依照命令行给出的提示，输入：`npm install --save bulma-stylus@0.8.0 hexo@^5.0.2 hexo-log@^2.0.0 hexo-renderer-inferno@^0.1.3 hexo-renderer-stylus@^2.0.0 hexo-util@^2.2.0 hexo-component-inferno@^0.13.0 inferno@^7.3.3 inferno-create-element@^7.3.3`（视实际情况，命令的内容会有所不同），终端会自动安装所需要的依赖。\n\n安装完成后再次尝试生成博客，这时应该不会再报错了。但是，控制台中出现了新的警告：\n\n```\nDeprecated as of 10.7.0. highlight(lang, code, ...args) has been deprecated.\nDeprecated as of 10.7.0. Please use highlight(code, options) instead.\nhttps://github.com/highlightjs/highlight.js/issues/2277\n```\n\n经过查询，这是由Hexo的一个依赖：`hexo-util`引起的，其作者已经在最新的版本中修正了这一错误（参考：[BugFix: Correct highlighting of multi-line element (fix #10 and hexojs/hexo#2291) by seaoak · Pull Request #22 · hexojs/hexo-util (github.com)](https://github.com/hexojs/hexo-util/pull/22)）。因此，只需要在终端中输入`npm install hexo-util --save`将其更新即可（终端的操作位置应当切换到你的博客所在的文件夹下）。\n\n此外，在更新的过程中，Icarus还会在你的博客根目录创建一个新的主题配置文件`_config,icarus.yml`。这一动作会在终端中以警告的形式表现出来。在完成上述操作后，请不要忘记将旧的主题文件的配置迁移到新的上面。\n\n# 布局\n\n## 文章页面设为两栏布局\n\nIcarus的默认布局为三栏布局，但是在显示文章正文时，三栏布局的挂件（Widgets）会占用文章大量的显示空间。所以，在这里将文章设置成两栏布局较好。\n\nIcarus在更新后提供了通过配置文件来设置页面布局的方法。我们在博客的根目录下新建一个配置文件`_config.post.yml`。在文章页面，`_config.post.yml`会覆盖同一文件夹下的`_config.icarus.yml`中的设置，也即文章页面将只显示在`_config.post.yml`中指明的挂件。所以在该配置文件中，只需要写入想要在文章页面显示的挂件便可以实现两栏布局。\n\n下面给出了`_config.post.yml`的示例，请根据自己的需要增删内容。\n\n```yaml _config.post.yml\nwidgets:\n    # Profile widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: profile\n        # Author name\n        author: Astrobear\n        # Author title\n        author_title: Building my fortress.\n        # Author's current location\n        location: PRC\n        # URL or path to the avatar image\n        avatar: /img/avatar.jpeg\n        # Whether show the rounded avatar image\n        avatar_rounded: true\n        # Email address for the Gravatar\n        gravatar: \n        # URL or path for the follow button\n        follow_link: 'https://github.com/Astrobr'\n        # Links to be shown on the bottom of the profile widget\n        social_links:\n            Github:\n                icon: fab fa-github\n                url: 'https://github.com/Astrobr'\n            Facebook:\n                icon: fab fa-facebook\n                url: 'https://www.facebook.com/astrobearforwork'\n            Instagram:\n                icon: fab fa-instagram\n                url: 'https://www.instagram.com/astrobarchen/'\n            #Twitter:\n            #    icon: fab fa-twitter\n            #    url: 'https://twitter.com'\n            #Dribbble:\n            #    icon: fab fa-dribbble\n            #    url: 'https://dribbble.com'\n            #RSS:\n            #    icon: fas fa-rss\n            #    url: /\n    # Table of contents widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: toc\n        # Whether to show the index of each heading\n        index: true\n        # Whether to collapse sub-headings when they are out-of-view\n        collapsed: true\n        # Maximum level of headings to show (1-6)\n        depth: 3\n```\n\n在按照上面的方法修改后，页面右侧的挂件被移除后会空出很多空间。因此我们需要调整一下两栏布局的宽度，使所有页面的侧边宽度一致。下面所有的代码对应文件的路径，除特别注明外，均在Icarus的主题文件夹`./themes/icarus/`下。\n```diff layout/layout.jsx\n             <Head site={site} config={config} helper={helper} page={page} />\n-            <body class={`is-${columnCount}-column`}>\n+            <body class={`is-3-column`}>\n                 <Navbar config={config} helper={helper} page={page} />\n```\n\n```diff layout/layout.jsx\n                                 'is-12': columnCount === 1,\n-                                'is-8-tablet is-8-desktop is-8-widescreen': columnCount === 2,\n+                                'is-8-tablet is-8-desktop is-9-widescreen': columnCount === 2,\n                                 'is-8-tablet is-8-desktop is-6-widescreen': columnCount === 3\n```\n\n```diff layout/common/widgets.jsx\nfunction getColumnSizeClass(columnCount) {\n     switch (columnCount) {\n         case 2:\n-            return 'is-4-tablet is-4-desktop is-4-widescreen';\n+            return 'is-4-tablet is-4-desktop is-3-widescreen';\n         case 3:\n             return 'is-4-tablet is-4-desktop is-3-widescreen';\n     }\n```\n\n下面的代码用于优化不同屏幕大小下的宽度。\n\n```diff include/style/responsive.styl\n +widescreen()\n+    .is-3-column .container\n+        max-width: $widescreen - $gap\n+        width: $widescreen - $gap\n+\n     .is-1-column .container, .is-2-column .container\n         max-width: $desktop - 2 * $gap\n         width: $desktop - 2 * $gap\n\n +fullhd()\n+    .is-3-column .container\n+        max-width: $fullhd - 2 * $gap\n+        width: $fullhd - 2 * $gap\n+\n     .is-2-column .container\n         max-width: $widescreen - 2 * $gap\n         width: $widescreen - 2 * $gap\n```\n\n## 优化标题布局\n\n这里将标题移动到正文上方，增加了更新时间，以及相对应的图标。\n\n```diff layout/common/article.jsx\n                 {/* Metadata */}\n                 <article class={`card-content article${'direction' in page ? ' ' + page.direction : ''}`} role=\"article\">\n+                    {/* Title */}\n+                    <h1 className=\"title is-size-3 is-size-4-mobile has-text-weight-normal\">\n+                        {index ?\n+                            <a className=\"has-link-black-ter\" href={url_for(page.link || page.path)}>\n+                                <i className=\"fas fa-angle-double-right\"></i>{page.title}\n+                            </a> :\n+                            [<i className=\"fas fa-angle-double-right\"></i>, page.title]\n+                        }\n+                    </h1>\n                     {page.layout !== 'page' ? <div class=\"article-meta is-size-7 is-uppercase level is-mobile\">\n                         <div class=\"level-left\">\n                             {/* Creation Date */}\n-                            {page.date && <span class=\"level-item\" dangerouslySetInnerHTML={{\n-                                __html: _p('article.created_at', `<time dateTime=\"${date_xml(page.date)}\" title=\"${date_xml(page.date)}\">${date(page.date)}</time>`)\n-                            }}></span>}\n+                            {page.date && <span class=\"level-item\">\n+                                <i className=\"far fa-calendar-alt\">&nbsp;</i>\n+                                <time dateTime=\"${date_xml(page.date)}\" title=\"${date_xml(page.date)}\">{date(page.date)}</time>\n+                            </span>}\n                             {/* Last Update Date */}\n-                            {page.updated && <span class=\"level-item\" dangerouslySetInnerHTML={{\n-                                __html: _p('article.updated_at', `<time dateTime=\"${date_xml(page.updated)}\" title=\"${date_xml(page.updated)}\">${date(page.updated)}</time>`)\n-                            }}></span>}\n+                            {page.updated && <span class=\"level-item is-hidden-mobile\">\n+                                <i class=\"far fa-calendar-check\">&nbsp;</i>\n+                                <time dateTime=\"${date_xml(page.updated)}\" title=\"${date_xml(page.updated)}\">{date(page.updated)}</time>\n+                            </span>}\n                             {/* author */}\n                             {page.author ? <span class=\"level-item\"> {page.author} </span> : null}\n```\n\n标题下方的发布时间与更新时间均改为直接使用日期。\n\n```diff source/js/main.js\n-    if (typeof moment === 'function') {\n-        $('.article-meta time').each(function() {\n-            $(this).text(moment($(this).attr('datetime')).fromNow());\n-        });\n-    }\n```\n\n## 优化文章结尾布局\n\n在文章结尾增加一个`hr`以调整间距。另外设置在预览时也显示标签（tags），并将`Read More`按钮置于右侧且添加图标。\n\n```diff layout/common/article.jsx\n                     {/* Licensing block */}\n                     {!index && article && article.licenses && Object.keys(article.licenses)\n                         ? <ArticleLicensing.Cacheable page={page} config={config} helper={helper} /> : null}\n+                    <hr style=\"height:1px;margin:1rem 0\"/>\n+                    <div className=\"level is-mobile is-flex\">\n                     {/* Tags */}\n-                    {!index && page.tags && page.tags.length ? <div class=\"article-tags is-size-7 mb-4\">\n-                        <span class=\"mr-2\">#</span>\n-                        {page.tags.map(tag => {\n-                            return <a class=\"link-muted mr-2\" rel=\"tag\" href={url_for(tag.path)}>{tag.name}</a>;\n+                    {page.tags && page.tags.length ? <div class=\"article-tags is-size-7 is-uppercase\">\n+                        <i class=\"fas fa-tags has-text-grey\"></i>&nbsp;\n+                        {page.tags.map((tag, index) => {\n+                            return <a class=\"link-muted\" rel=\"tag\" href={url_for(tag.path)}>{tag.name}{index !== page.tags.length-1? ', ':''}</a>;\n                         })}\n                     </div> : null}\n                     {/* \"Read more\" button */}\n-                    {index && page.excerpt ? <a class=\"article-more button is-small is-size-7\" href={`${url_for(page.link || page.path)}#more`}>{__('article.more')}</a> : null}\n+                    {index && page.excerpt ? <a class=\"article-more button is-small is-size-7\" href={`${url_for(page.link || page.path)}#more`}><i class=\"fas fa-book-reader has-text-grey\"></i>&nbsp;&nbsp;{__('article.more')}</a> : null}\n+                    </div>\n                     {/* Share button */}\n```\n\n## 优化个人信息布局\n\n将下方博客数据统计修改为链接，在`Follow`按钮前增加Github图标。\n\n```diff layout/widget/profile.jsx\n-                    <div class=\"level-item has-text-centered is-marginless\">\n+                    <a class=\"level-item has-text-centered is-marginless\" href={counter.category.url}>\n                         <div>\n                             <p class=\"heading\">{counter.category.title}</p>\n-                            <a href={counter.category.url}>\n+                            <div>\n                                 <p class=\"title\">{counter.category.count}</p>\n-                            </a>\n+                            </div>\n                         </div>\n-                    </div>\n+                    </a>\n```\n\n```diff layout/widget/profile.jsx\n{followLink ? <div class=\"level\">\n-\t\t\t\t\t <a class=\"level-item button is-primary is-rounded\" href={followLink} target=\"_blank\" rel=\"noopener\">&nbsp;&nbsp;{followTitle}</a>\n+                    <a class=\"level-item button is-primary is-rounded\" href={followLink} target=\"_blank\" rel=\"noopener\"><i class=\"fab fa-github\"></i>&nbsp;&nbsp;{followTitle}</a>\n                </div> : null}\n```\n\n## 目录粘性定位\n\n```diff source/js/main.js\nif ($toc.length > 0) {\n+        $toc.addClass('column-left is-sticky');\n         const $mask = $('<div>');\n```\n\n```diff include/style/widget.styl\n+#toc\n+    max-height: calc(100vh - 22px)\n+    overflow-y: scroll\n```\n\n# 功能\n\n## 夜间模式\n\n复制下面的代码，然后在`./themes/icarus/source/css/`目录下创建`night.styl`文件并粘贴。\n\n{% codeblock \"night.styl\" lang:stylus >folded %}\ndark-primary-color = rgb(55, 61, 72)\ndark-primary-color-hover = rgb(67, 74, 86)\ndark-primary-color-active = rgb(44, 49, 58)\ndark-font-color = #c0c0c0\n\n\n\n#universe\n  display: none\n\n.navbar-logo,\n.footer-logo\n  .logo-img-dark\n    display: none\n\nbody.night\n  background: #0e1225\n\n.night\n  // code highlight (https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css)\n  // navigation bar, cards\n  .content code\n    color: rgb(203,186,125)\n\n  // night icon changed to fas fa-sun\n  #night-nav #night-icon:before\n    content: '\\f185'\n\n  .navbar-menu\n    background-color: inherit\n  .navbar-main .navbar-menu .navbar-item\n    &:hover,\n    &:focus\n      color: #ffffff\n      background-color: dark-primary-color\n  .navbar,\n  .card\n    background-color: rgba(40, 44, 52, 0.5)\n    backdrop-filter: none\n    -webkit-backdrop-filter: none\n\n  .card\n    &:hover\n      background-color: rgba(40, 44, 52, 0.8)\n\n  .footer\n    background-color: rgba(40, 44, 52, 0.5)\n    backdrop-filter: none\n    -webkit-backdrop-filter: none\n\n    &:before\n      background-color: rgba(40, 44, 52, 0.5)\n\n  // input\n\n  .input, .textarea\n    background-color: dark-primary-color-hover\n    border-color: dark-primary-color\n\n  // message\n  .message.message-immersive\n    background-color: #c2c2c2\n    .message-body\n      color: #222222\n  .message.message-immersive.is-info\n    background-color: #bdc3c8 \n    .message-body\n      color: #004779\n  .message.message-immersive.is-warning\n    background-color: #cbc8ba\n    .message-body\n      color: #5b4b00\n  .message.message-immersive.is-danger\n    background-color: #c6babe\n    .message-body\n      color: #79000f\n  .message.message-immersive.is-success\n    background-color: #bfc7c0\n    .message-body\n      color: #1e4d1c\n  .message.message-immersive.is-primary\n    background-color: #bdc0c9\n    .message-body\n      color: #003790\n\n\n\n\n\n  // button\n\n  .button.is-primary, .button.is-light, .button.is-small\n    background-color: dark-primary-color\n    color: dark-font-color\n\n    &:hover, &.is-hovered\n      color: #ffffff\n      background-color: dark-primary-color-hover\n    \n    &:active, &.is-active\n      color: #ffffff\n      background-color: dark-primary-color-active\n\n  .button.is-white,\n  .button.is-transparent\n    background-color: transparent\n\n    &:hover\n      background-color: dark-primary-color !important\n\n  .pagination .pagination-next,\n  .pagination .pagination-previous\n  .pagination-link:not(.is-current)\n    color: dark-font-color\n\n\n\n\n\n  // button\n\n  .button.is-primary, .button.is-light, .button.is-small\n    background-color: dark-primary-color\n    color: dark-font-color\n\n    &:hover, &.is-hovered\n      color: #ffffff\n      background-color: dark-primary-color-hover\n    \n    &:active, &.is-active\n      color: #ffffff\n      background-color: dark-primary-color-active\n\n  .button.is-white,\n  .button.is-transparent\n    background-color: transparent\n\n    &:hover\n      background-color: dark-primary-color !important\n\n  .pagination .pagination-next,\n  .pagination .pagination-previous\n  .pagination-link:not(.is-current)\n    color: dark-font-color\n    background-color: dark-primary-color\n\n    a\n      color: dark-font-color\n\n  .pagination-link.is-current\n    background-color: dark-primary-color-hover\n    border-color: dark-primary-color-hover\n\n  // comment\n\n  .v .vwrap,\n  .v .vwrap .vheader .vinput\n    border-color: dark-primary-color\n\n  .v .vwrap .vheader .vinput:focus\n    border-color: dark-primary-color-hover\n\n  .v .vbtn\n    color: dark-font-color\n    background-color: dark-primary-color\n    border-color: dark-primary-color\n\n    &:hover\n      background-color: dark-primary-color-hover\n    \n    &:active\n      background-color: dark-primary-color-active\n\n  .v .vlist .vcard .vhead .vsys\n    background-color: dark-primary-color\n\n  .v a:hover,\n  .v .vlist .vcard .vh .vmeta .vat\n    color: #ffffff\n\n  .v .vlist .vcard .vcontent.expand:before\n    background: -webkit-gradient(linear, left top, left bottom, from(rgba(37, 41, 54, 0)), to(rgba(37, 41, 54, 1)))\n    background: linear-gradient(180deg, rgba(37, 41, 54, 0), rgba(37, 41, 54, 1))\n\n  .v .vlist .vcard .vcontent.expand:after\n    background: rgba(37, 41, 54, 1)\n\n  .v .vlist .vcard .vh,\n  .v .vlist .vcard .vquote\n    border-color: dark-primary-color-hover\n\n  // font color\n\n  body,\n  strong,\n  time,\n  .title,\n  .footer,\n  .card,\n  .content h1,\n  .content h2,\n  .content h3,\n  .content h4,\n  .content h5,\n  .content h6,\n  .navbar-item,\n  .navbar-item.is-active,\n  .navbar-link,\n  .menu-list a,\n  .menu-label,\n  .level-item,\n  .input,\n  .textarea,\n  .button.is-white,\n  .button.is-transparent,\n  .article-licensing,\n  .v *\n    color: dark-font-color\n\n  .media-content,\n  .has-text-grey,\n  .link-muted\n    color: dark-font-color !important\n\n  a\n    color: rgb(82, 153, 224)\n\n    &:hover\n      color: #ffffff\n\n  // quote\n\n  .content blockquote,\n  .article-licensing\n    background-color: dark-primary-color\n    border-color: dark-primary-color-hover\n\n  .post-copyright\n    background-color: dark-primary-color\n    border-color: dark-primary-color-hover\n\n  // table\n\n  .content table thead td,\n  .content table thead th\n    color: dark-font-color\n\n  .content table td,\n  .content table th\n    border-color: dark-primary-color-hover\n\n  // break line\n\n  hr\n    background-color: dark-primary-color-hover\n\n  // tags and menus\n\n  article.article, article.media\n\n    .title:hover a\n      // override anotherr !important\n      color: dark-font-color !important\n\n  .tag:not(body)\n    color: dark-font-color\n    background-color: dark-primary-color\n\n  .tag.is-grey\n    background-color: dark-primary-color-hover\n\n  .menu-list a:hover\n    background-color: dark-primary-color\n\n  .menu-list a.is-active\n    background-color: dark-primary-color-hover\n\n  .menu-list li ul\n    border-color: dark-primary-color\n\n  // time line\n\n  .timeline .media:last-child:after\n    background-color: rgb(37, 41, 54)\n\n  .timeline\n    border-color: dark-primary-color-hover\n\n  .timeline .media:before\n    background-color: dark-primary-color-hover\n\n  // search box\n\n  .searchbox\n    .searchbox-container,\n    .searchbox-header,\n    .searchbox-header .searchbox-input,\n    .searchbox-header .searchbox-close,\n    .searchbox-body,\n    .searchbox-result-section,\n    .searchbox-result-item\n      color: dark-font-color\n      background-color: dark-primary-color\n      border-color: dark-primary-color-hover\n\n    .searchbox-container .searchbox-result-section .searchbox-result-item:hover,\n    .searchbox-container .searchbox-result-section .searchbox-result-item.active,\n    .searchbox-container .searchbox-header .searchbox-close:hover\n      color: #ffffff\n      background-color: dark-primary-color-hover\n\n  // selection\n\n  ::selection\n    color: #ffffff\n    background-color: rgba(52, 109, 167, 0.8)\n\n  ::-moz-selection\n    color: #ffffff\n    background-color: rgba(52, 109, 167, 0.8)\n\n  input:-webkit-autofill\n    -webkit-text-fill-color: dark-font-color !important\n    box-shadow: 0 0 0px 1000px dark-primary-color inset\n\n  .hljs {\n    display: block;\n    overflow-x: auto;\n\n    padding: 0.5em;\n    color: #abb2bf;\n    background: #282c34\n  }\n\n  .hljs-comment, .hljs-quote {\n    color: #5c6370;\n    font-style: italic\n  }\n\n  .hljs-doctag, .hljs-keyword, .hljs-formula {\n    color: #c678dd\n  }\n\n  .hljs-section, .hljs-name, .hljs-selector-tag, .hljs-deletion, .hljs-subst {\n    color: #e06c75\n  }\n\n  .hljs-literal {\n    color: #56b6c2\n  }\n\n  .hljs-string, .hljs-regexp, .hljs-addition, .hljs-attribute, .hljs-meta-string {\n    color: #98c379\n  }\n\n  .hljs-built_in, .hljs-class .hljs-title {\n    color: #e6c07b\n  }\n\n  .hljs-attr, .hljs-variable, .hljs-template-variable, .hljs-type, .hljs-selector-class, .hljs-selector-attr, .hljs-selector-pseudo, .hljs-number {\n    color: #d19a66\n  }\n\n  .hljs-symbol, .hljs-bullet, .hljs-link, .hljs-meta, .hljs-selector-id, .hljs-title {\n    color: #61aeee\n  }\n\n  .hljs-emphasis {\n    font-style: italic\n  }\n\n  .hljs-strong {\n    font-weight: bold\n  }\n\n  .hljs-link {\n    text-decoration: underline\n  }\n{% endcodeblock %}\n\n接下来需要修改一下样式文件。\n\n```diff source/css/default.styl\n  @import 'style'\n+ @import 'night'\n```\n\n然后在`./themes/icarus/source/js`下创建`night.js`文件，其内容如下：\n\n```js night.js\n(function () {\n  /**\n\n   * Icarus 夜间模式 by iMaeGoo\n   * https://www.imaegoo.com/\n      */\n\n    var isNight = localStorage.getItem('night');\n    var nightNav;\n\n  function applyNight(value) {\n      if (value.toString() === 'true') {\n          document.body.classList.remove('light');\n          document.body.classList.add('night');\n      } else {\n          document.body.classList.remove('night');\n          document.body.classList.add('light');\n      }\n  }\n\n  function findNightNav() {\n      nightNav = document.getElementById('night-nav');\n      if (!nightNav) {\n          setTimeout(findNightNav, 100);\n      } else {\n          nightNav.addEventListener('click', switchNight);\n      }\n  }\n\n  function switchNight() {\n      isNight = isNight ? isNight.toString() !== 'true' : true;\n      applyNight(isNight);\n      localStorage.setItem('night', isNight);\n  }\n\n  findNightNav();\n  isNight && applyNight(isNight);\n}());\n```\n\n最后，还要修改一下下面两个文件。\n\n```diff layout/common/scripts.jsx\n\t\t\t <script src={url_for('/js/main.js')} defer></script>\n+            <script src={url_for('/js/night.js')} defer={true}></script>\n        </Fragment>;\n```\n\n```diff layout/commom/navbar.jsx\n\t\t\t\t<div class=\"navbar-end\">\n+                        <a class=\"navbar-item night\" id=\"night-nav\" title=\"Night Mode\" href=\"javascript:;\">\n+\t                        <i class=\"fas fa-moon\" id=\"night-icon\"></i>\n+                        </a>\n                        {Object.keys(links).length ? <Fragment>\n```\n\n## Mathjax自动换行\n\n在文章中，如果一行数学公式过长的话，公式内容会跑到文章栏的外面，非常难看。这里要设置的是使长公式根据页面宽度自动换行显示。\n\n在`./themes/icarus/source/js/`目录下新建一个名为`mathjax-config.js`的文件，其内容如下：\n\n```js mathjax-config.js\ndocument.addEventListener('DOMContentLoaded', function () {\n    MathJax.Hub.Config({\n        showProcessingMessages: false,\n        messageStyle: \"none\",\n        'HTML-CSS': {\n            matchFontHeight: false,\n            linebreaks: { automatic: true },\n        },\n        SVG: {\n            matchFontHeight: false,\n            linebreaks: { automatic: true },\n        },\n        CommonHTML: {\n            matchFontHeight: false,\n            linebreaks: { automatic: true },\n        },\n        tex2jax: {\n            inlineMath: [\n                ['$','$'],\n                ['\\\\(','\\\\)']\n            ],\n            displayMath: [ \n                ['$$','$$'], \n                [\"\\\\[\",\"\\\\]\"] \n            ]\n        }\n    });\n});\n```\n\n然后修改下面的文件即可。\n\n```diff layout/layout.jsx\n \t\t<Search config={config} helper={helper} />\n             </body>\n+            <script type=\"text/javascript\" src=\"/js/mathjax-config.js\"></script>\n        </html>;\n```\n\n# 样式\n\n## 在页面底部添加创作共用许可协议的图标\n\n按照下面的方法更改代码即可。\n\n```diff layout/common/footer.jsx\n                                 const link = links[name];\n                                 return <p class=\"control\">\n                                     <a class={`button is-transparent ${link.icon ? 'is-large' : ''}`} target=\"_blank\" rel=\"noopener\" title={name} href={link.url}>\n-                                        {link.icon ? <i class={link.icon}></i> : name}\n+                                        {link.icon ?\n+                                            (Array.isArray(link.icon) ?\n+                                                link.icon.map(i => [<i className={i}></i>, '\\u00A0']) :\n+                                                <i className={link.icon}></i>\n+                                        ) : name}\n                                     </a>\n                                 </p>;\n                             })}\n```\n\n```diff include/schema/common/footer.json\n-            \"$ref\": \"/misc/poly_links.json\",\n```\n\n在`_config.icarus.yml`中添加如下配置：\n\n```yaml _config.icarus.yml\nfooter:\n    links:\n        CC BY-NC-SA 4.0:\n            icon:\n              - fab fa-creative-commons\n              - fab fa-creative-commons-by\n              - fab fa-creative-commons-nc\n              - fab fa-creative-commons-sa\n            url: 'https://creativecommons.org/licenses/by-nc-sa/4.0/'\n```\n\n## 按钮背景颜色增加渐变\n\n```diff include/style/widget.styl\n .widget\n     .menu-list\n         li\n             ul\n                 margin-right: 0\n+        a\n+            transition: background-color 0.3s ease-in-out\n         .level\n             margin-bottom: 0\n```\n\n## 挂件卡片增加浮动效果\n\n当鼠标悬浮在卡片上时增大阴影，并且设置渐变动画效果。\n\n```diff include/style/card.styl\n .card\n     overflow: visible\n     border-radius: $card-radius\n+    &:hover\n+        box-shadow: 0 6px 15px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1)\n```\n\n```diff source/js/animation.js\n     setTimeout(() => {\n         $('body > .navbar, body > .section, body > .footer').forEach(element => {\n             element.style.opacity = '1';\n-            element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';\n+            element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out';\n         });\n```\n\n```diff source/js/animation.js\n                     element.style.transform = '';\n-                    element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';\n+                    element.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out';\n                 }, i * 100);\n```\n\n## 修改标签颜色\n\n由于此处新增了夜间模式，所以需要修改两个`.styl`文件。\n\n```diff include/style/widget.styl\n\t.tags\n         .tag:first-child\n-            background: $primary\n-            color: $primary-invert\n+            background: $light-grey\n+            color: #4a4a4a\n\n         .tag:last-child\n-            background: $light-grey\n+            background: #e7e7e7\n             color: $white-invert\n```\n\n```diff source/css/night.styl\n .title:hover a\n       // override anotherr !important\n       color: dark-font-color !important\n\n+  .tags\n+    .tag:first-child\n+      background: dark-primary-color\n+      color: dark-font-color\n+\n+    .tag:last-child\n+      background: rgb(45, 51, 62)\n+      color: dark-font-color\n\n   .tag:not(body)\n     color: dark-font-color\n     background-color: dark-primary-color\n```\n\n## 滚动条统一改为新样式\n\nIcarus在最近的更新中修改了滚动条的样式。相比之前的系统默认样式，新版本的滚动条看起来更窄并做了圆角化处理。但是Icarus的作者只修改了桌面端的滚动条样式，在移动端或者当桌面端的浏览器窗口变窄时，滚动条会变为之前傻大黑粗的默认样式。为了美观和统一，只需要在`./themes/icarus/include/style/base.styl`文件的末尾添加下面的代码，即可完美解决上述问题。\n\n```stylus base.styl\n+mobile()\n    ::-webkit-scrollbar\n        width: 8px\n        height: 8px\n\n    ::-webkit-scrollbar-track\n        border-radius: 3px\n        background: rgba(0,0,0,0.06)\n        box-shadow: inset 0 0 5px rgba(0,0,0,0.1)\n\n    ::-webkit-scrollbar-thumb\n        border-radius: 3px\n        background: rgba(0,0,0,0.12)\n        box-shadow: inset 0 0 10px rgba(0,0,0,0.2)\n\n    ::-webkit-scrollbar-thumb:hover\n        background: rgba(0,0,0,0.24)\n\n+tablet()\n    ::-webkit-scrollbar\n        width: 8px\n        height: 8px\n\n    ::-webkit-scrollbar-track\n        border-radius: 3px\n        background: rgba(0,0,0,0.06)\n        box-shadow: inset 0 0 5px rgba(0,0,0,0.1)\n\n    ::-webkit-scrollbar-thumb\n        border-radius: 3px\n        background: rgba(0,0,0,0.12)\n        box-shadow: inset 0 0 10px rgba(0,0,0,0.2)\n\n    ::-webkit-scrollbar-thumb:hover\n        background: rgba(0,0,0,0.24)\n```\n\n\n\n---\n\n参考：\n\n[Icarus 主题自定义 - Alpha Lxy](https://www.alphalxy.com/2019/03/customize-icarus/#页面footer显示一组icon)\n\n[Icarus用户指南 - 主题配置 - Icarus (ppoffice.github.io)](https://ppoffice.github.io/hexo-theme-icarus/Configuration/icarus用户指南-主题配置/)\n\n[Hexo 主题 icarus 4 配置夜间模式 Night Mode - Asahi's Blog (asahih.com)](https://blog.asahih.com/hexo-icarus-night-mode/)\n\n[Hexo折腾系列（四）鼠标指针美化 - 江风引雨の小po站 (luzy.top)](https://blog.luzy.top/posts/486003558/)\n\n\n\n\n\n\n\n\n\n","slug":"Hexo主题Icarus的自定义","published":1,"updated":"2022-03-17T09:28:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzr00061q3915czaqwm","content":"<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第三篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n<ul>\n<li>“建站搭博客”系列之一：<a href=\"https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/\">华为云+nginx服务器搭建总结</a></li>\n<li>“建站搭博客”系列之二：<a href=\"https://astrobear.top/2021/08/16/Hexo的安装和自动部署/\">Hexo博客的安装和自动部署</a></li>\n</ul>\n<p>Icarus是Hexo的一款简单、精致、现代的主题，也是我的博客目前正在使用的主题。这款主题无论从颜值还是从功能上看都相当优秀。但是针对我的需求而言，它仍然有一些不足之处。即使Icarus支持大量的自定义功能以及丰富的插件，要想实现我的目标功能，依旧需要对这个主题进行魔改。此外，在博客迁移的过程中，我还顺便将其版本升级为最新。在此将其过程一并记录下来以供参考。</p>\n<h1 id=\"Icarus的升级过程\"><a href=\"#Icarus的升级过程\" class=\"headerlink\" title=\"Icarus的升级过程\"></a>Icarus的升级过程</h1><article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n在升级前请务必备份你的原文件！\n</div>\n</article>\n\n<p>根据主题作者的教程，如果你打算通过修改源代码的方式自定义主题，你必须从源代码安装主题。所以我直接在<a href=\"https://github.com/ppoffice/hexo-theme-icarus/releases\">该主题的Release</a>下载了其最新版本（4.4.0）的源代码，将文件夹下<code>./themes/icarus/</code>中现有的旧文件全部删除后，再将新版本的主题文件复制进去。</p>\n<p>完成上面的操作以后在终端中执行<code>hexo clean</code>，再执行<code>hexo g</code>。由于只是将主题由旧版本升级到最新，其使用的相关依赖和包都还没升级。因此，在生成的过程中可能会出现错误。</p>\n<p>依照命令行给出的提示，输入：<code>npm install --save bulma-stylus@0.8.0 hexo@^5.0.2 hexo-log@^2.0.0 hexo-renderer-inferno@^0.1.3 hexo-renderer-stylus@^2.0.0 hexo-util@^2.2.0 hexo-component-inferno@^0.13.0 inferno@^7.3.3 inferno-create-element@^7.3.3</code>（视实际情况，命令的内容会有所不同），终端会自动安装所需要的依赖。</p>\n<p>安装完成后再次尝试生成博客，这时应该不会再报错了。但是，控制台中出现了新的警告：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Deprecated as of 10.7.0. highlight(lang, code, ...args) has been deprecated.</span><br><span class=\"line\">Deprecated as of 10.7.0. Please use highlight(code, options) instead.</span><br><span class=\"line\">https://github.com/highlightjs/highlight.js/issues/2277</span><br></pre></td></tr></table></figure>\n\n<p>经过查询，这是由Hexo的一个依赖：<code>hexo-util</code>引起的，其作者已经在最新的版本中修正了这一错误（参考：<a href=\"https://github.com/hexojs/hexo-util/pull/22\">BugFix: Correct highlighting of multi-line element (fix #10 and hexojs/hexo#2291) by seaoak · Pull Request #22 · hexojs/hexo-util (github.com)</a>）。因此，只需要在终端中输入<code>npm install hexo-util --save</code>将其更新即可（终端的操作位置应当切换到你的博客所在的文件夹下）。</p>\n<p>此外，在更新的过程中，Icarus还会在你的博客根目录创建一个新的主题配置文件<code>_config,icarus.yml</code>。这一动作会在终端中以警告的形式表现出来。在完成上述操作后，请不要忘记将旧的主题文件的配置迁移到新的上面。</p>\n<h1 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h1><h2 id=\"文章页面设为两栏布局\"><a href=\"#文章页面设为两栏布局\" class=\"headerlink\" title=\"文章页面设为两栏布局\"></a>文章页面设为两栏布局</h2><p>Icarus的默认布局为三栏布局，但是在显示文章正文时，三栏布局的挂件（Widgets）会占用文章大量的显示空间。所以，在这里将文章设置成两栏布局较好。</p>\n<p>Icarus在更新后提供了通过配置文件来设置页面布局的方法。我们在博客的根目录下新建一个配置文件<code>_config.post.yml</code>。在文章页面，<code>_config.post.yml</code>会覆盖同一文件夹下的<code>_config.icarus.yml</code>中的设置，也即文章页面将只显示在<code>_config.post.yml</code>中指明的挂件。所以在该配置文件中，只需要写入想要在文章页面显示的挂件便可以实现两栏布局。</p>\n<p>下面给出了<code>_config.post.yml</code>的示例，请根据自己的需要增删内容。</p>\n<figure class=\"highlight yaml\"><figcaption><span>_config.post.yml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">widgets:</span></span><br><span class=\"line\">    <span class=\"comment\"># Profile widget configurations</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span></span><br><span class=\"line\">        <span class=\"comment\"># Where should the widget be placed, left sidebar or right sidebar</span></span><br><span class=\"line\">        <span class=\"attr\">position:</span> <span class=\"string\">left</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">profile</span></span><br><span class=\"line\">        <span class=\"comment\"># Author name</span></span><br><span class=\"line\">        <span class=\"attr\">author:</span> <span class=\"string\">Astrobear</span></span><br><span class=\"line\">        <span class=\"comment\"># Author title</span></span><br><span class=\"line\">        <span class=\"attr\">author_title:</span> <span class=\"string\">Building</span> <span class=\"string\">my</span> <span class=\"string\">fortress.</span></span><br><span class=\"line\">        <span class=\"comment\"># Author&#x27;s current location</span></span><br><span class=\"line\">        <span class=\"attr\">location:</span> <span class=\"string\">PRC</span></span><br><span class=\"line\">        <span class=\"comment\"># URL or path to the avatar image</span></span><br><span class=\"line\">        <span class=\"attr\">avatar:</span> <span class=\"string\">/img/avatar.jpeg</span></span><br><span class=\"line\">        <span class=\"comment\"># Whether show the rounded avatar image</span></span><br><span class=\"line\">        <span class=\"attr\">avatar_rounded:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># Email address for the Gravatar</span></span><br><span class=\"line\">        <span class=\"attr\">gravatar:</span> </span><br><span class=\"line\">        <span class=\"comment\"># URL or path for the follow button</span></span><br><span class=\"line\">        <span class=\"attr\">follow_link:</span> <span class=\"string\">&#x27;https://github.com/Astrobr&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\"># Links to be shown on the bottom of the profile widget</span></span><br><span class=\"line\">        <span class=\"attr\">social_links:</span></span><br><span class=\"line\">            <span class=\"attr\">Github:</span></span><br><span class=\"line\">                <span class=\"attr\">icon:</span> <span class=\"string\">fab</span> <span class=\"string\">fa-github</span></span><br><span class=\"line\">                <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://github.com/Astrobr&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">Facebook:</span></span><br><span class=\"line\">                <span class=\"attr\">icon:</span> <span class=\"string\">fab</span> <span class=\"string\">fa-facebook</span></span><br><span class=\"line\">                <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://www.facebook.com/astrobearforwork&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">Instagram:</span></span><br><span class=\"line\">                <span class=\"attr\">icon:</span> <span class=\"string\">fab</span> <span class=\"string\">fa-instagram</span></span><br><span class=\"line\">                <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://www.instagram.com/astrobarchen/&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">#Twitter:</span></span><br><span class=\"line\">            <span class=\"comment\">#    icon: fab fa-twitter</span></span><br><span class=\"line\">            <span class=\"comment\">#    url: &#x27;https://twitter.com&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">#Dribbble:</span></span><br><span class=\"line\">            <span class=\"comment\">#    icon: fab fa-dribbble</span></span><br><span class=\"line\">            <span class=\"comment\">#    url: &#x27;https://dribbble.com&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">#RSS:</span></span><br><span class=\"line\">            <span class=\"comment\">#    icon: fas fa-rss</span></span><br><span class=\"line\">            <span class=\"comment\">#    url: /</span></span><br><span class=\"line\">    <span class=\"comment\"># Table of contents widget configurations</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span></span><br><span class=\"line\">        <span class=\"comment\"># Where should the widget be placed, left sidebar or right sidebar</span></span><br><span class=\"line\">        <span class=\"attr\">position:</span> <span class=\"string\">left</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">toc</span></span><br><span class=\"line\">        <span class=\"comment\"># Whether to show the index of each heading</span></span><br><span class=\"line\">        <span class=\"attr\">index:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># Whether to collapse sub-headings when they are out-of-view</span></span><br><span class=\"line\">        <span class=\"attr\">collapsed:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># Maximum level of headings to show (1-6)</span></span><br><span class=\"line\">        <span class=\"attr\">depth:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p>在按照上面的方法修改后，页面右侧的挂件被移除后会空出很多空间。因此我们需要调整一下两栏布局的宽度，使所有页面的侧边宽度一致。下面所有的代码对应文件的路径，除特别注明外，均在Icarus的主题文件夹<code>./themes/icarus/</code>下。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/layout.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">             &lt;Head site=&#123;site&#125; config=&#123;config&#125; helper=&#123;helper&#125; page=&#123;page&#125; /&gt;</span><br><span class=\"line\"><span class=\"deletion\">-            &lt;body class=&#123;`is-$&#123;columnCount&#125;-column`&#125;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+            &lt;body class=&#123;`is-3-column`&#125;&gt;</span></span><br><span class=\"line\">                 &lt;Navbar config=&#123;config&#125; helper=&#123;helper&#125; page=&#123;page&#125; /&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/layout.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                 &#x27;is-12&#x27;: columnCount <span class=\"comment\">=== 1,</span></span><br><span class=\"line\"><span class=\"deletion\">-                                &#x27;is-8-tablet is-8-desktop is-8-widescreen&#x27;: columnCount === 2,</span></span><br><span class=\"line\"><span class=\"addition\">+                                &#x27;is-8-tablet is-8-desktop is-9-widescreen&#x27;: columnCount === 2,</span></span><br><span class=\"line\">                                 &#x27;is-8-tablet is-8-desktop is-6-widescreen&#x27;: columnCount <span class=\"comment\">=== 3</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/common/widgets.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getColumnSizeClass(columnCount) &#123;</span><br><span class=\"line\">     switch (columnCount) &#123;</span><br><span class=\"line\">         case 2:</span><br><span class=\"line\"><span class=\"deletion\">-            return &#x27;is-4-tablet is-4-desktop is-4-widescreen&#x27;;</span></span><br><span class=\"line\"><span class=\"addition\">+            return &#x27;is-4-tablet is-4-desktop is-3-widescreen&#x27;;</span></span><br><span class=\"line\">         case 3:</span><br><span class=\"line\">             return &#x27;is-4-tablet is-4-desktop is-3-widescreen&#x27;;</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面的代码用于优化不同屏幕大小下的宽度。</p>\n<figure class=\"highlight diff\"><figcaption><span>include/style/responsive.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> +widescreen()</span><br><span class=\"line\"><span class=\"addition\">+    .is-3-column .container</span></span><br><span class=\"line\"><span class=\"addition\">+        max-width: $widescreen - $gap</span></span><br><span class=\"line\"><span class=\"addition\">+        width: $widescreen - $gap</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\">     .is-1-column .container, .is-2-column .container</span><br><span class=\"line\">         max-width: $desktop - 2 * $gap</span><br><span class=\"line\">         width: $desktop - 2 * $gap</span><br><span class=\"line\"></span><br><span class=\"line\"> +fullhd()</span><br><span class=\"line\"><span class=\"addition\">+    .is-3-column .container</span></span><br><span class=\"line\"><span class=\"addition\">+        max-width: $fullhd - 2 * $gap</span></span><br><span class=\"line\"><span class=\"addition\">+        width: $fullhd - 2 * $gap</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\">     .is-2-column .container</span><br><span class=\"line\">         max-width: $widescreen - 2 * $gap</span><br><span class=\"line\">         width: $widescreen - 2 * $gap</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"优化标题布局\"><a href=\"#优化标题布局\" class=\"headerlink\" title=\"优化标题布局\"></a>优化标题布局</h2><p>这里将标题移动到正文上方，增加了更新时间，以及相对应的图标。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/article.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                 &#123;/* Metadata */&#125;</span><br><span class=\"line\">                 &lt;article class=&#123;`card-content article$&#123;&#x27;direction&#x27; in page ? &#x27; &#x27; + page.direction : &#x27;&#x27;&#125;`&#125; role=&quot;article&quot;&gt;</span><br><span class=\"line\"><span class=\"addition\">+                    &#123;/* Title */&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;h1 className=&quot;title is-size-3 is-size-4-mobile has-text-weight-normal&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &#123;index ?</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;a className=&quot;has-link-black-ter&quot; href=&#123;url_for(page.link || page.path)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;i className=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;&#123;page.title&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/a&gt; :</span></span><br><span class=\"line\"><span class=\"addition\">+                            [&lt;i className=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;, page.title]</span></span><br><span class=\"line\"><span class=\"addition\">+                        &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;/h1&gt;</span></span><br><span class=\"line\">                     &#123;page.layout !== &#x27;page&#x27; ? &lt;div class=&quot;article-meta is-size-7 is-uppercase level is-mobile&quot;&gt;</span><br><span class=\"line\">                         &lt;div class=&quot;level-left&quot;&gt;</span><br><span class=\"line\">                             &#123;/* Creation Date */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                            &#123;page.date &amp;&amp; &lt;span class=&quot;level-item&quot; dangerouslySetInnerHTML=&#123;&#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                                __html: _p(&#x27;article.created_at&#x27;, `&lt;time dateTime=&quot;$&#123;date_xml(page.date)&#125;&quot; title=&quot;$&#123;date_xml(page.date)&#125;&quot;&gt;$&#123;date(page.date)&#125;&lt;/time&gt;`)</span></span><br><span class=\"line\"><span class=\"deletion\">-                            &#125;&#125;&gt;&lt;/span&gt;&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &#123;page.date &amp;&amp; &lt;span class=&quot;level-item&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;i className=&quot;far fa-calendar-alt&quot;&gt;&amp;nbsp;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;time dateTime=&quot;$&#123;date_xml(page.date)&#125;&quot; title=&quot;$&#123;date_xml(page.date)&#125;&quot;&gt;&#123;date(page.date)&#125;&lt;/time&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/span&gt;&#125;</span></span><br><span class=\"line\">                             &#123;/* Last Update Date */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                            &#123;page.updated &amp;&amp; &lt;span class=&quot;level-item&quot; dangerouslySetInnerHTML=&#123;&#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                                __html: _p(&#x27;article.updated_at&#x27;, `&lt;time dateTime=&quot;$&#123;date_xml(page.updated)&#125;&quot; title=&quot;$&#123;date_xml(page.updated)&#125;&quot;&gt;$&#123;date(page.updated)&#125;&lt;/time&gt;`)</span></span><br><span class=\"line\"><span class=\"deletion\">-                            &#125;&#125;&gt;&lt;/span&gt;&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &#123;page.updated &amp;&amp; &lt;span class=&quot;level-item is-hidden-mobile&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;i class=&quot;far fa-calendar-check&quot;&gt;&amp;nbsp;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;time dateTime=&quot;$&#123;date_xml(page.updated)&#125;&quot; title=&quot;$&#123;date_xml(page.updated)&#125;&quot;&gt;&#123;date(page.updated)&#125;&lt;/time&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/span&gt;&#125;</span></span><br><span class=\"line\">                             &#123;/* author */&#125;</span><br><span class=\"line\">                             &#123;page.author ? &lt;span class=&quot;level-item&quot;&gt; &#123;page.author&#125; &lt;/span&gt; : null&#125;</span><br></pre></td></tr></table></figure>\n\n<p>标题下方的发布时间与更新时间均改为直接使用日期。</p>\n<figure class=\"highlight diff\"><figcaption><span>source/js/main.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">-    if (typeof moment === &#x27;function&#x27;) &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-        $(&#x27;.article-meta time&#x27;).each(function() &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-            $(this).text(moment($(this).attr(&#x27;datetime&#x27;)).fromNow());</span></span><br><span class=\"line\"><span class=\"deletion\">-        &#125;);</span></span><br><span class=\"line\"><span class=\"deletion\">-    &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"优化文章结尾布局\"><a href=\"#优化文章结尾布局\" class=\"headerlink\" title=\"优化文章结尾布局\"></a>优化文章结尾布局</h2><p>在文章结尾增加一个<code>hr</code>以调整间距。另外设置在预览时也显示标签（tags），并将<code>Read More</code>按钮置于右侧且添加图标。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/article.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     &#123;/* Licensing block */&#125;</span><br><span class=\"line\">                     &#123;!index &amp;&amp; article &amp;&amp; article.licenses &amp;&amp; Object.keys(article.licenses)</span><br><span class=\"line\">                         ? &lt;ArticleLicensing.Cacheable page=&#123;page&#125; config=&#123;config&#125; helper=&#123;helper&#125; /&gt; : null&#125;</span><br><span class=\"line\"><span class=\"addition\">+                    &lt;hr style=&quot;height:1px;margin:1rem 0&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;div className=&quot;level is-mobile is-flex&quot;&gt;</span></span><br><span class=\"line\">                     &#123;/* Tags */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                    &#123;!index &amp;&amp; page.tags &amp;&amp; page.tags.length ? &lt;div class=&quot;article-tags is-size-7 mb-4&quot;&gt;</span></span><br><span class=\"line\"><span class=\"deletion\">-                        &lt;span class=&quot;mr-2&quot;&gt;#&lt;/span&gt;</span></span><br><span class=\"line\"><span class=\"deletion\">-                        &#123;page.tags.map(tag =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                            return &lt;a class=&quot;link-muted mr-2&quot; rel=&quot;tag&quot; href=&#123;url_for(tag.path)&#125;&gt;&#123;tag.name&#125;&lt;/a&gt;;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &#123;page.tags &amp;&amp; page.tags.length ? &lt;div class=&quot;article-tags is-size-7 is-uppercase&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &lt;i class=&quot;fas fa-tags has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &#123;page.tags.map((tag, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                            return &lt;a class=&quot;link-muted&quot; rel=&quot;tag&quot; href=&#123;url_for(tag.path)&#125;&gt;&#123;tag.name&#125;&#123;index !== page.tags.length-1? &#x27;, &#x27;:&#x27;&#x27;&#125;&lt;/a&gt;;</span></span><br><span class=\"line\">                         &#125;)&#125;</span><br><span class=\"line\">                     &lt;/div&gt; : null&#125;</span><br><span class=\"line\">                     &#123;/* &quot;Read more&quot; button */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                    &#123;index &amp;&amp; page.excerpt ? &lt;a class=&quot;article-more button is-small is-size-7&quot; href=&#123;`$&#123;url_for(page.link || page.path)&#125;#more`&#125;&gt;&#123;__(&#x27;article.more&#x27;)&#125;&lt;/a&gt; : null&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &#123;index &amp;&amp; page.excerpt ? &lt;a class=&quot;article-more button is-small is-size-7&quot; href=&#123;`$&#123;url_for(page.link || page.path)&#125;#more`&#125;&gt;&lt;i class=&quot;fas fa-book-reader has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp;&amp;nbsp;&#123;__(&#x27;article.more&#x27;)&#125;&lt;/a&gt; : null&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;/div&gt;</span></span><br><span class=\"line\">                     &#123;/* Share button */&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"优化个人信息布局\"><a href=\"#优化个人信息布局\" class=\"headerlink\" title=\"优化个人信息布局\"></a>优化个人信息布局</h2><p>将下方博客数据统计修改为链接，在<code>Follow</code>按钮前增加Github图标。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/widget/profile.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">-                    &lt;div class=&quot;level-item has-text-centered is-marginless&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;a class=&quot;level-item has-text-centered is-marginless&quot; href=&#123;counter.category.url&#125;&gt;</span></span><br><span class=\"line\">                         &lt;div&gt;</span><br><span class=\"line\">                             &lt;p class=&quot;heading&quot;&gt;&#123;counter.category.title&#125;&lt;/p&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                            &lt;a href=&#123;counter.category.url&#125;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;div&gt;</span></span><br><span class=\"line\">                                 &lt;p class=&quot;title&quot;&gt;&#123;counter.category.count&#125;&lt;/p&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                            &lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/div&gt;</span></span><br><span class=\"line\">                         &lt;/div&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;/a&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/widget/profile.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;followLink ? &lt;div class=&quot;level&quot;&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                     &lt;a class=&quot;level-item button is-primary is-rounded&quot; href=&#123;followLink&#125; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&amp;nbsp;&amp;nbsp;&#123;followTitle&#125;&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;a class=&quot;level-item button is-primary is-rounded&quot; href=&#123;followLink&#125; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;i class=&quot;fab fa-github&quot;&gt;&lt;/i&gt;&amp;nbsp;&amp;nbsp;&#123;followTitle&#125;&lt;/a&gt;</span></span><br><span class=\"line\">                &lt;/div&gt; : null&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"目录粘性定位\"><a href=\"#目录粘性定位\" class=\"headerlink\" title=\"目录粘性定位\"></a>目录粘性定位</h2><figure class=\"highlight diff\"><figcaption><span>source/js/main.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if ($toc.length &gt; 0) &#123;</span><br><span class=\"line\"><span class=\"addition\">+        $toc.addClass(&#x27;column-left is-sticky&#x27;);</span></span><br><span class=\"line\">         const $mask = $(&#x27;&lt;div&gt;&#x27;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>include/style/widget.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+#toc</span></span><br><span class=\"line\"><span class=\"addition\">+    max-height: calc(100vh - 22px)</span></span><br><span class=\"line\"><span class=\"addition\">+    overflow-y: scroll</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"功能\"><a href=\"#功能\" class=\"headerlink\" title=\"功能\"></a>功能</h1><h2 id=\"夜间模式\"><a href=\"#夜间模式\" class=\"headerlink\" title=\"夜间模式\"></a>夜间模式</h2><p>复制下面的代码，然后在<code>./themes/icarus/source/css/</code>目录下创建<code>night.styl</code>文件并粘贴。</p>\n<figure class=\"highlight stylus\"><figcaption><span>night.styl >folded</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dark-primary-<span class=\"attribute\">color</span> = rgb(<span class=\"number\">55</span>, <span class=\"number\">61</span>, <span class=\"number\">72</span>)</span><br><span class=\"line\">dark-primary-<span class=\"attribute\">color</span>-hover = rgb(<span class=\"number\">67</span>, <span class=\"number\">74</span>, <span class=\"number\">86</span>)</span><br><span class=\"line\">dark-primary-<span class=\"attribute\">color</span>-active = rgb(<span class=\"number\">44</span>, <span class=\"number\">49</span>, <span class=\"number\">58</span>)</span><br><span class=\"line\">dark-<span class=\"attribute\">font</span>-color = <span class=\"number\">#c0c0c0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#universe</span></span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.navbar-logo</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.footer-logo</span></span><br><span class=\"line\">  <span class=\"selector-class\">.logo-img-dark</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">body</span><span class=\"selector-class\">.night</span></span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#0e1225</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.night</span></span><br><span class=\"line\">  <span class=\"comment\">// code highlight (https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css)</span></span><br><span class=\"line\">  <span class=\"comment\">// navigation bar, cards</span></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">code</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">203</span>,<span class=\"number\">186</span>,<span class=\"number\">125</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// night icon changed to fas fa-sun</span></span><br><span class=\"line\">  <span class=\"selector-id\">#night-nav</span> <span class=\"selector-id\">#night-icon</span>:before</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;\\f185&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-menu</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: inherit</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-main</span> <span class=\"selector-class\">.navbar-menu</span> <span class=\"selector-class\">.navbar-item</span></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span>,</span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:focus</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.card</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.5</span>)</span><br><span class=\"line\">    backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\">    -webkit-backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.card</span></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.footer</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.5</span>)</span><br><span class=\"line\">    backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\">    -webkit-backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;:before</span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// input</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.input</span>, <span class=\"selector-class\">.textarea</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// message</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#c2c2c2</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#222222</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-info</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#bdc3c8</span> </span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#004779</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-warning</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#cbc8ba</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#5b4b00</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-danger</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#c6babe</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#79000f</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-success</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#bfc7c0</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#1e4d1c</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-primary</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#bdc0c9</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#003790</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// button</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-primary</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-light</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-small</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span>, &amp;<span class=\"selector-class\">.is-hovered</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:active</span>, &amp;<span class=\"selector-class\">.is-active</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-active</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-white</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-transparent</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: transparent</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-next</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-previous</span></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination-link</span><span class=\"selector-pseudo\">:not</span>(.is-current)</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// button</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-primary</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-light</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-small</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span>, &amp;<span class=\"selector-class\">.is-hovered</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:active</span>, &amp;<span class=\"selector-class\">.is-active</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-active</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-white</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-transparent</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: transparent</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-next</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-previous</span></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination-link</span><span class=\"selector-pseudo\">:not</span>(.is-current)</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">a</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination-link</span><span class=\"selector-class\">.is-current</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// comment</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vwrap</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vwrap</span> <span class=\"selector-class\">.vheader</span> <span class=\"selector-class\">.vinput</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vwrap</span> <span class=\"selector-class\">.vheader</span> <span class=\"selector-class\">.vinput</span><span class=\"selector-pseudo\">:focus</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vbtn</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:active</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-active</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vhead</span> <span class=\"selector-class\">.vsys</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vh</span> <span class=\"selector-class\">.vmeta</span> <span class=\"selector-class\">.vat</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vcontent</span><span class=\"selector-class\">.expand</span>:before</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -webkit-gradient(linear, left top, left bottom, from(rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">0</span>)), to(rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">1</span>)))</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: linear-gradient(<span class=\"number\">180deg</span>, rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">0</span>), rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vcontent</span><span class=\"selector-class\">.expand</span>:after</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vh</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vquote</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// font color</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">body</span>,</span><br><span class=\"line\">  <span class=\"selector-tag\">strong</span>,</span><br><span class=\"line\">  <span class=\"selector-tag\">time</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.title</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.footer</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.card</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h1</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h2</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h3</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h4</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h5</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h6</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-item</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-item</span><span class=\"selector-class\">.is-active</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-link</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">a</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.menu-label</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.level-item</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.input</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.textarea</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-white</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-transparent</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.article-licensing</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> *</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.media-content</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.has-text-grey</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.link-muted</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">a</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">82</span>, <span class=\"number\">153</span>, <span class=\"number\">224</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// quote</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">blockquote</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.article-licensing</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.post-copyright</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// table</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">thead</span> <span class=\"selector-tag\">td</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">thead</span> <span class=\"selector-tag\">th</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">td</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">th</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// break line</span></span><br><span class=\"line\"></span><br><span class=\"line\">  hr</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// tags and menus</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">article</span><span class=\"selector-class\">.article</span>, <span class=\"selector-tag\">article</span><span class=\"selector-class\">.media</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.title</span><span class=\"selector-pseudo\">:hover</span> <span class=\"selector-tag\">a</span></span><br><span class=\"line\">      <span class=\"comment\">// override anotherr !important</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: dark-font-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.tag</span><span class=\"selector-pseudo\">:not</span>(body)</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.tag</span><span class=\"selector-class\">.is-grey</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">a</span><span class=\"selector-class\">.is-active</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">li</span> <span class=\"selector-tag\">ul</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// time line</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.timeline</span> <span class=\"selector-class\">.media</span><span class=\"selector-pseudo\">:last-child</span>:after</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgb(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.timeline</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.timeline</span> <span class=\"selector-class\">.media</span>:before</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// search box</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.searchbox</span></span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-header</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-header</span> <span class=\"selector-class\">.searchbox-input</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-header</span> <span class=\"selector-class\">.searchbox-close</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-body</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-result-section</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-result-item</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">      <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span> <span class=\"selector-class\">.searchbox-result-section</span> <span class=\"selector-class\">.searchbox-result-item</span><span class=\"selector-pseudo\">:hover</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span> <span class=\"selector-class\">.searchbox-result-section</span> <span class=\"selector-class\">.searchbox-result-item</span><span class=\"selector-class\">.active</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span> <span class=\"selector-class\">.searchbox-header</span> <span class=\"selector-class\">.searchbox-close</span><span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// selection</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-pseudo\">::selection</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">52</span>, <span class=\"number\">109</span>, <span class=\"number\">167</span>, <span class=\"number\">0.8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  ::-moz-selection</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">52</span>, <span class=\"number\">109</span>, <span class=\"number\">167</span>, <span class=\"number\">0.8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">input</span>:-webkit-autofill</span><br><span class=\"line\">    -webkit-text-fill-<span class=\"attribute\">color</span>: dark-font-color <span class=\"meta\">!important</span></span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0px</span> <span class=\"number\">1000px</span> dark-primary-color inset</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">overflow-x</span>: auto;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0.5em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#abb2bf</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#282c34</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-comment</span>, <span class=\"selector-class\">.hljs-quote</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#5c6370</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-style</span>: italic</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-doctag</span>, <span class=\"selector-class\">.hljs-keyword</span>, <span class=\"selector-class\">.hljs-formula</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#c678dd</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-section</span>, <span class=\"selector-class\">.hljs-name</span>, <span class=\"selector-class\">.hljs-selector-tag</span>, <span class=\"selector-class\">.hljs-deletion</span>, <span class=\"selector-class\">.hljs-subst</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#e06c75</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-literal</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#56b6c2</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-string</span>, <span class=\"selector-class\">.hljs-regexp</span>, <span class=\"selector-class\">.hljs-addition</span>, <span class=\"selector-class\">.hljs-attribute</span>, <span class=\"selector-class\">.hljs-meta-string</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#98c379</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-built_in</span>, <span class=\"selector-class\">.hljs-class</span> <span class=\"selector-class\">.hljs-title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#e6c07b</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-attr</span>, <span class=\"selector-class\">.hljs-variable</span>, <span class=\"selector-class\">.hljs-template-variable</span>, <span class=\"selector-class\">.hljs-type</span>, <span class=\"selector-class\">.hljs-selector-class</span>, <span class=\"selector-class\">.hljs-selector-attr</span>, <span class=\"selector-class\">.hljs-selector-pseudo</span>, <span class=\"selector-class\">.hljs-number</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d19a66</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-symbol</span>, <span class=\"selector-class\">.hljs-bullet</span>, <span class=\"selector-class\">.hljs-link</span>, <span class=\"selector-class\">.hljs-meta</span>, <span class=\"selector-class\">.hljs-selector-id</span>, <span class=\"selector-class\">.hljs-title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#61aeee</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-emphasis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-style</span>: italic</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-strong</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-weight</span>: bold</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-link</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">text-decoration</span>: underline</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>接下来需要修改一下样式文件。</p>\n<figure class=\"highlight diff\"><figcaption><span>source/css/default.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  @import &#x27;style&#x27;</span><br><span class=\"line\"><span class=\"addition\">+ @import &#x27;night&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后在<code>./themes/icarus/source/js</code>下创建<code>night.js</code>文件，其内容如下：</p>\n<figure class=\"highlight js\"><figcaption><span>night.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">   * Icarus 夜间模式 by iMaeGoo</span></span><br><span class=\"line\"><span class=\"comment\">   * https://www.imaegoo.com/</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isNight = <span class=\"built_in\">localStorage</span>.getItem(<span class=\"string\">&#x27;night&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> nightNav;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyNight</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (value.toString() === <span class=\"string\">&#x27;true&#x27;</span>) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.remove(<span class=\"string\">&#x27;light&#x27;</span>);</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.add(<span class=\"string\">&#x27;night&#x27;</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.remove(<span class=\"string\">&#x27;night&#x27;</span>);</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.add(<span class=\"string\">&#x27;light&#x27;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findNightNav</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      nightNav = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;night-nav&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!nightNav) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">setTimeout</span>(findNightNav, <span class=\"number\">100</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          nightNav.addEventListener(<span class=\"string\">&#x27;click&#x27;</span>, switchNight);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">switchNight</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      isNight = isNight ? isNight.toString() !== <span class=\"string\">&#x27;true&#x27;</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\">      applyNight(isNight);</span><br><span class=\"line\">      <span class=\"built_in\">localStorage</span>.setItem(<span class=\"string\">&#x27;night&#x27;</span>, isNight);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  findNightNav();</span><br><span class=\"line\">  isNight &amp;&amp; applyNight(isNight);</span><br><span class=\"line\">&#125;());</span><br></pre></td></tr></table></figure>\n\n<p>最后，还要修改一下下面两个文件。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/scripts.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">             &lt;script src=&#123;url_for(&#x27;/js/main.js&#x27;)&#125; defer&gt;&lt;/script&gt;</span><br><span class=\"line\"><span class=\"addition\">+            &lt;script src=&#123;url_for(&#x27;/js/night.js&#x27;)&#125; defer=&#123;true&#125;&gt;&lt;/script&gt;</span></span><br><span class=\"line\">        &lt;/Fragment&gt;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/commom/navbar.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                &lt;div class=&quot;navbar-end&quot;&gt;</span><br><span class=\"line\"><span class=\"addition\">+                        &lt;a class=&quot;navbar-item night&quot; id=&quot;night-nav&quot; title=&quot;Night Mode&quot; href=&quot;javascript:;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;i class=&quot;fas fa-moon&quot; id=&quot;night-icon&quot;&gt;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &lt;/a&gt;</span></span><br><span class=\"line\">                        &#123;Object.keys(links).length ? &lt;Fragment&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Mathjax自动换行\"><a href=\"#Mathjax自动换行\" class=\"headerlink\" title=\"Mathjax自动换行\"></a>Mathjax自动换行</h2><p>在文章中，如果一行数学公式过长的话，公式内容会跑到文章栏的外面，非常难看。这里要设置的是使长公式根据页面宽度自动换行显示。</p>\n<p>在<code>./themes/icarus/source/js/</code>目录下新建一个名为<code>mathjax-config.js</code>的文件，其内容如下：</p>\n<figure class=\"highlight js\"><figcaption><span>mathjax-config.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">&#x27;DOMContentLoaded&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    MathJax.Hub.Config(&#123;</span><br><span class=\"line\">        <span class=\"attr\">showProcessingMessages</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">messageStyle</span>: <span class=\"string\">&quot;none&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;HTML-CSS&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">matchFontHeight</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"attr\">linebreaks</span>: &#123; <span class=\"attr\">automatic</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">SVG</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">matchFontHeight</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"attr\">linebreaks</span>: &#123; <span class=\"attr\">automatic</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">CommonHTML</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">matchFontHeight</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"attr\">linebreaks</span>: &#123; <span class=\"attr\">automatic</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">tex2jax</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">inlineMath</span>: [</span><br><span class=\"line\">                [<span class=\"string\">&#x27;$&#x27;</span>,<span class=\"string\">&#x27;$&#x27;</span>],</span><br><span class=\"line\">                [<span class=\"string\">&#x27;\\\\(&#x27;</span>,<span class=\"string\">&#x27;\\\\)&#x27;</span>]</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"attr\">displayMath</span>: [ </span><br><span class=\"line\">                [<span class=\"string\">&#x27;$$&#x27;</span>,<span class=\"string\">&#x27;$$&#x27;</span>], </span><br><span class=\"line\">                [<span class=\"string\">&quot;\\\\[&quot;</span>,<span class=\"string\">&quot;\\\\]&quot;</span>] </span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>然后修改下面的文件即可。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/layout.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">         &lt;Search config=&#123;config&#125; helper=&#123;helper&#125; /&gt;</span><br><span class=\"line\">             &lt;/body&gt;</span><br><span class=\"line\"><span class=\"addition\">+            &lt;script type=&quot;text/javascript&quot; src=&quot;/js/mathjax-config.js&quot;&gt;&lt;/script&gt;</span></span><br><span class=\"line\">        &lt;/html&gt;;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"样式\"><a href=\"#样式\" class=\"headerlink\" title=\"样式\"></a>样式</h1><h2 id=\"在页面底部添加创作共用许可协议的图标\"><a href=\"#在页面底部添加创作共用许可协议的图标\" class=\"headerlink\" title=\"在页面底部添加创作共用许可协议的图标\"></a>在页面底部添加创作共用许可协议的图标</h2><p>按照下面的方法更改代码即可。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/footer.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                 const link = links[name];</span><br><span class=\"line\">                                 return &lt;p class=&quot;control&quot;&gt;</span><br><span class=\"line\">                                     &lt;a class=&#123;`button is-transparent $&#123;link.icon ? &#x27;is-large&#x27; : &#x27;&#x27;&#125;`&#125; target=&quot;_blank&quot; rel=&quot;noopener&quot; title=&#123;name&#125; href=&#123;link.url&#125;&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                                        &#123;link.icon ? &lt;i class=&#123;link.icon&#125;&gt;&lt;/i&gt; : name&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                                        &#123;link.icon ?</span></span><br><span class=\"line\"><span class=\"addition\">+                                            (Array.isArray(link.icon) ?</span></span><br><span class=\"line\"><span class=\"addition\">+                                                link.icon.map(i =&gt; [&lt;i className=&#123;i&#125;&gt;&lt;/i&gt;, &#x27;\\u00A0&#x27;]) :</span></span><br><span class=\"line\"><span class=\"addition\">+                                                &lt;i className=&#123;link.icon&#125;&gt;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                        ) : name&#125;</span></span><br><span class=\"line\">                                     &lt;/a&gt;</span><br><span class=\"line\">                                 &lt;/p&gt;;</span><br><span class=\"line\">                             &#125;)&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>include/schema/common/footer.json</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">-            &quot;$ref&quot;: &quot;/misc/poly_links.json&quot;,</span></span><br></pre></td></tr></table></figure>\n\n<p>在<code>_config.icarus.yml</code>中添加如下配置：</p>\n<figure class=\"highlight yaml\"><figcaption><span>_config.icarus.yml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">    <span class=\"attr\">links:</span></span><br><span class=\"line\">        <span class=\"attr\">CC BY-NC-SA 4.0:</span></span><br><span class=\"line\">            <span class=\"attr\">icon:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons-by</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons-nc</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons-sa</span></span><br><span class=\"line\">            <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://creativecommons.org/licenses/by-nc-sa/4.0/&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"按钮背景颜色增加渐变\"><a href=\"#按钮背景颜色增加渐变\" class=\"headerlink\" title=\"按钮背景颜色增加渐变\"></a>按钮背景颜色增加渐变</h2><figure class=\"highlight diff\"><figcaption><span>include/style/widget.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .widget</span><br><span class=\"line\">     .menu-list</span><br><span class=\"line\">         li</span><br><span class=\"line\">             ul</span><br><span class=\"line\">                 margin-right: 0</span><br><span class=\"line\"><span class=\"addition\">+        a</span></span><br><span class=\"line\"><span class=\"addition\">+            transition: background-color 0.3s ease-in-out</span></span><br><span class=\"line\">         .level</span><br><span class=\"line\">             margin-bottom: 0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"挂件卡片增加浮动效果\"><a href=\"#挂件卡片增加浮动效果\" class=\"headerlink\" title=\"挂件卡片增加浮动效果\"></a>挂件卡片增加浮动效果</h2><p>当鼠标悬浮在卡片上时增大阴影，并且设置渐变动画效果。</p>\n<figure class=\"highlight diff\"><figcaption><span>include/style/card.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .card</span><br><span class=\"line\">     overflow: visible</span><br><span class=\"line\">     border-radius: $card-radius</span><br><span class=\"line\"><span class=\"addition\">+    &amp;:hover</span></span><br><span class=\"line\"><span class=\"addition\">+        box-shadow: 0 6px 15px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>source/js/animation.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">     setTimeout(() =&gt; &#123;</span><br><span class=\"line\">         $(&#x27;body &gt; .navbar, body &gt; .section, body &gt; .footer&#x27;).forEach(element =&gt; &#123;</span><br><span class=\"line\">             element.style.opacity = &#x27;1&#x27;;</span><br><span class=\"line\"><span class=\"deletion\">-            element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out&#x27;;</span></span><br><span class=\"line\"><span class=\"addition\">+            element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out&#x27;;</span></span><br><span class=\"line\">         &#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>source/js/animation.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     element.style.transform = &#x27;&#x27;;</span><br><span class=\"line\"><span class=\"deletion\">-                    element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out&#x27;;</span></span><br><span class=\"line\"><span class=\"addition\">+                    element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out&#x27;;</span></span><br><span class=\"line\">                 &#125;, i * 100);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修改标签颜色\"><a href=\"#修改标签颜色\" class=\"headerlink\" title=\"修改标签颜色\"></a>修改标签颜色</h2><p>由于此处新增了夜间模式，所以需要修改两个<code>.styl</code>文件。</p>\n<figure class=\"highlight diff\"><figcaption><span>include/style/widget.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    .tags</span><br><span class=\"line\">         .tag:first-child</span><br><span class=\"line\"><span class=\"deletion\">-            background: $primary</span></span><br><span class=\"line\"><span class=\"deletion\">-            color: $primary-invert</span></span><br><span class=\"line\"><span class=\"addition\">+            background: $light-grey</span></span><br><span class=\"line\"><span class=\"addition\">+            color: #4a4a4a</span></span><br><span class=\"line\"></span><br><span class=\"line\">         .tag:last-child</span><br><span class=\"line\"><span class=\"deletion\">-            background: $light-grey</span></span><br><span class=\"line\"><span class=\"addition\">+            background: #e7e7e7</span></span><br><span class=\"line\">             color: $white-invert</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>source/css/night.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .title:hover a</span><br><span class=\"line\">       // override anotherr !important</span><br><span class=\"line\">       color: dark-font-color !important</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+  .tags</span></span><br><span class=\"line\"><span class=\"addition\">+    .tag:first-child</span></span><br><span class=\"line\"><span class=\"addition\">+      background: dark-primary-color</span></span><br><span class=\"line\"><span class=\"addition\">+      color: dark-font-color</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+    .tag:last-child</span></span><br><span class=\"line\"><span class=\"addition\">+      background: rgb(45, 51, 62)</span></span><br><span class=\"line\"><span class=\"addition\">+      color: dark-font-color</span></span><br><span class=\"line\"></span><br><span class=\"line\">   .tag:not(body)</span><br><span class=\"line\">     color: dark-font-color</span><br><span class=\"line\">     background-color: dark-primary-color</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"滚动条统一改为新样式\"><a href=\"#滚动条统一改为新样式\" class=\"headerlink\" title=\"滚动条统一改为新样式\"></a>滚动条统一改为新样式</h2><p>Icarus在最近的更新中修改了滚动条的样式。相比之前的系统默认样式，新版本的滚动条看起来更窄并做了圆角化处理。但是Icarus的作者只修改了桌面端的滚动条样式，在移动端或者当桌面端的浏览器窗口变窄时，滚动条会变为之前傻大黑粗的默认样式。为了美观和统一，只需要在<code>./themes/icarus/include/style/base.styl</code>文件的末尾添加下面的代码，即可完美解决上述问题。</p>\n<figure class=\"highlight stylus\"><figcaption><span>base.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+mobile()</span><br><span class=\"line\">    ::-webkit-scrollbar</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">8px</span></span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">8px</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-track</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.06</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.12</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">10px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb<span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.24</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">+tablet()</span><br><span class=\"line\">    ::-webkit-scrollbar</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">8px</span></span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">8px</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-track</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.06</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.12</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">10px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb<span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.24</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<p>参考：</p>\n<p><a href=\"https://www.alphalxy.com/2019/03/customize-icarus/#页面footer显示一组icon\">Icarus 主题自定义 - Alpha Lxy</a></p>\n<p><a href=\"https://ppoffice.github.io/hexo-theme-icarus/Configuration/icarus用户指南-主题配置/\">Icarus用户指南 - 主题配置 - Icarus (ppoffice.github.io)</a></p>\n<p><a href=\"https://blog.asahih.com/hexo-icarus-night-mode/\">Hexo 主题 icarus 4 配置夜间模式 Night Mode - Asahi’s Blog (asahih.com)</a></p>\n<p><a href=\"https://blog.luzy.top/posts/486003558/\">Hexo折腾系列（四）鼠标指针美化 - 江风引雨の小po站 (luzy.top)</a></p>\n","site":{"data":{}},"more":"<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第三篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n<ul>\n<li>“建站搭博客”系列之一：<a href=\"https://astrobear.top/2020/01/08/华为云+nginx服务器搭建总结/\">华为云+nginx服务器搭建总结</a></li>\n<li>“建站搭博客”系列之二：<a href=\"https://astrobear.top/2021/08/16/Hexo的安装和自动部署/\">Hexo博客的安装和自动部署</a></li>\n</ul>\n<p>Icarus是Hexo的一款简单、精致、现代的主题，也是我的博客目前正在使用的主题。这款主题无论从颜值还是从功能上看都相当优秀。但是针对我的需求而言，它仍然有一些不足之处。即使Icarus支持大量的自定义功能以及丰富的插件，要想实现我的目标功能，依旧需要对这个主题进行魔改。此外，在博客迁移的过程中，我还顺便将其版本升级为最新。在此将其过程一并记录下来以供参考。</p>\n<h1 id=\"Icarus的升级过程\"><a href=\"#Icarus的升级过程\" class=\"headerlink\" title=\"Icarus的升级过程\"></a>Icarus的升级过程</h1><article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n在升级前请务必备份你的原文件！\n</div>\n</article>\n\n<p>根据主题作者的教程，如果你打算通过修改源代码的方式自定义主题，你必须从源代码安装主题。所以我直接在<a href=\"https://github.com/ppoffice/hexo-theme-icarus/releases\">该主题的Release</a>下载了其最新版本（4.4.0）的源代码，将文件夹下<code>./themes/icarus/</code>中现有的旧文件全部删除后，再将新版本的主题文件复制进去。</p>\n<p>完成上面的操作以后在终端中执行<code>hexo clean</code>，再执行<code>hexo g</code>。由于只是将主题由旧版本升级到最新，其使用的相关依赖和包都还没升级。因此，在生成的过程中可能会出现错误。</p>\n<p>依照命令行给出的提示，输入：<code>npm install --save bulma-stylus@0.8.0 hexo@^5.0.2 hexo-log@^2.0.0 hexo-renderer-inferno@^0.1.3 hexo-renderer-stylus@^2.0.0 hexo-util@^2.2.0 hexo-component-inferno@^0.13.0 inferno@^7.3.3 inferno-create-element@^7.3.3</code>（视实际情况，命令的内容会有所不同），终端会自动安装所需要的依赖。</p>\n<p>安装完成后再次尝试生成博客，这时应该不会再报错了。但是，控制台中出现了新的警告：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Deprecated as of 10.7.0. highlight(lang, code, ...args) has been deprecated.</span><br><span class=\"line\">Deprecated as of 10.7.0. Please use highlight(code, options) instead.</span><br><span class=\"line\">https://github.com/highlightjs/highlight.js/issues/2277</span><br></pre></td></tr></table></figure>\n\n<p>经过查询，这是由Hexo的一个依赖：<code>hexo-util</code>引起的，其作者已经在最新的版本中修正了这一错误（参考：<a href=\"https://github.com/hexojs/hexo-util/pull/22\">BugFix: Correct highlighting of multi-line element (fix #10 and hexojs/hexo#2291) by seaoak · Pull Request #22 · hexojs/hexo-util (github.com)</a>）。因此，只需要在终端中输入<code>npm install hexo-util --save</code>将其更新即可（终端的操作位置应当切换到你的博客所在的文件夹下）。</p>\n<p>此外，在更新的过程中，Icarus还会在你的博客根目录创建一个新的主题配置文件<code>_config,icarus.yml</code>。这一动作会在终端中以警告的形式表现出来。在完成上述操作后，请不要忘记将旧的主题文件的配置迁移到新的上面。</p>\n<h1 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h1><h2 id=\"文章页面设为两栏布局\"><a href=\"#文章页面设为两栏布局\" class=\"headerlink\" title=\"文章页面设为两栏布局\"></a>文章页面设为两栏布局</h2><p>Icarus的默认布局为三栏布局，但是在显示文章正文时，三栏布局的挂件（Widgets）会占用文章大量的显示空间。所以，在这里将文章设置成两栏布局较好。</p>\n<p>Icarus在更新后提供了通过配置文件来设置页面布局的方法。我们在博客的根目录下新建一个配置文件<code>_config.post.yml</code>。在文章页面，<code>_config.post.yml</code>会覆盖同一文件夹下的<code>_config.icarus.yml</code>中的设置，也即文章页面将只显示在<code>_config.post.yml</code>中指明的挂件。所以在该配置文件中，只需要写入想要在文章页面显示的挂件便可以实现两栏布局。</p>\n<p>下面给出了<code>_config.post.yml</code>的示例，请根据自己的需要增删内容。</p>\n<figure class=\"highlight yaml\"><figcaption><span>_config.post.yml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">widgets:</span></span><br><span class=\"line\">    <span class=\"comment\"># Profile widget configurations</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span></span><br><span class=\"line\">        <span class=\"comment\"># Where should the widget be placed, left sidebar or right sidebar</span></span><br><span class=\"line\">        <span class=\"attr\">position:</span> <span class=\"string\">left</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">profile</span></span><br><span class=\"line\">        <span class=\"comment\"># Author name</span></span><br><span class=\"line\">        <span class=\"attr\">author:</span> <span class=\"string\">Astrobear</span></span><br><span class=\"line\">        <span class=\"comment\"># Author title</span></span><br><span class=\"line\">        <span class=\"attr\">author_title:</span> <span class=\"string\">Building</span> <span class=\"string\">my</span> <span class=\"string\">fortress.</span></span><br><span class=\"line\">        <span class=\"comment\"># Author&#x27;s current location</span></span><br><span class=\"line\">        <span class=\"attr\">location:</span> <span class=\"string\">PRC</span></span><br><span class=\"line\">        <span class=\"comment\"># URL or path to the avatar image</span></span><br><span class=\"line\">        <span class=\"attr\">avatar:</span> <span class=\"string\">/img/avatar.jpeg</span></span><br><span class=\"line\">        <span class=\"comment\"># Whether show the rounded avatar image</span></span><br><span class=\"line\">        <span class=\"attr\">avatar_rounded:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># Email address for the Gravatar</span></span><br><span class=\"line\">        <span class=\"attr\">gravatar:</span> </span><br><span class=\"line\">        <span class=\"comment\"># URL or path for the follow button</span></span><br><span class=\"line\">        <span class=\"attr\">follow_link:</span> <span class=\"string\">&#x27;https://github.com/Astrobr&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\"># Links to be shown on the bottom of the profile widget</span></span><br><span class=\"line\">        <span class=\"attr\">social_links:</span></span><br><span class=\"line\">            <span class=\"attr\">Github:</span></span><br><span class=\"line\">                <span class=\"attr\">icon:</span> <span class=\"string\">fab</span> <span class=\"string\">fa-github</span></span><br><span class=\"line\">                <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://github.com/Astrobr&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">Facebook:</span></span><br><span class=\"line\">                <span class=\"attr\">icon:</span> <span class=\"string\">fab</span> <span class=\"string\">fa-facebook</span></span><br><span class=\"line\">                <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://www.facebook.com/astrobearforwork&#x27;</span></span><br><span class=\"line\">            <span class=\"attr\">Instagram:</span></span><br><span class=\"line\">                <span class=\"attr\">icon:</span> <span class=\"string\">fab</span> <span class=\"string\">fa-instagram</span></span><br><span class=\"line\">                <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://www.instagram.com/astrobarchen/&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">#Twitter:</span></span><br><span class=\"line\">            <span class=\"comment\">#    icon: fab fa-twitter</span></span><br><span class=\"line\">            <span class=\"comment\">#    url: &#x27;https://twitter.com&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">#Dribbble:</span></span><br><span class=\"line\">            <span class=\"comment\">#    icon: fab fa-dribbble</span></span><br><span class=\"line\">            <span class=\"comment\">#    url: &#x27;https://dribbble.com&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">#RSS:</span></span><br><span class=\"line\">            <span class=\"comment\">#    icon: fas fa-rss</span></span><br><span class=\"line\">            <span class=\"comment\">#    url: /</span></span><br><span class=\"line\">    <span class=\"comment\"># Table of contents widget configurations</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span></span><br><span class=\"line\">        <span class=\"comment\"># Where should the widget be placed, left sidebar or right sidebar</span></span><br><span class=\"line\">        <span class=\"attr\">position:</span> <span class=\"string\">left</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">toc</span></span><br><span class=\"line\">        <span class=\"comment\"># Whether to show the index of each heading</span></span><br><span class=\"line\">        <span class=\"attr\">index:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># Whether to collapse sub-headings when they are out-of-view</span></span><br><span class=\"line\">        <span class=\"attr\">collapsed:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\"># Maximum level of headings to show (1-6)</span></span><br><span class=\"line\">        <span class=\"attr\">depth:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p>在按照上面的方法修改后，页面右侧的挂件被移除后会空出很多空间。因此我们需要调整一下两栏布局的宽度，使所有页面的侧边宽度一致。下面所有的代码对应文件的路径，除特别注明外，均在Icarus的主题文件夹<code>./themes/icarus/</code>下。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/layout.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">             &lt;Head site=&#123;site&#125; config=&#123;config&#125; helper=&#123;helper&#125; page=&#123;page&#125; /&gt;</span><br><span class=\"line\"><span class=\"deletion\">-            &lt;body class=&#123;`is-$&#123;columnCount&#125;-column`&#125;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+            &lt;body class=&#123;`is-3-column`&#125;&gt;</span></span><br><span class=\"line\">                 &lt;Navbar config=&#123;config&#125; helper=&#123;helper&#125; page=&#123;page&#125; /&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/layout.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                 &#x27;is-12&#x27;: columnCount <span class=\"comment\">=== 1,</span></span><br><span class=\"line\"><span class=\"deletion\">-                                &#x27;is-8-tablet is-8-desktop is-8-widescreen&#x27;: columnCount === 2,</span></span><br><span class=\"line\"><span class=\"addition\">+                                &#x27;is-8-tablet is-8-desktop is-9-widescreen&#x27;: columnCount === 2,</span></span><br><span class=\"line\">                                 &#x27;is-8-tablet is-8-desktop is-6-widescreen&#x27;: columnCount <span class=\"comment\">=== 3</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/common/widgets.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getColumnSizeClass(columnCount) &#123;</span><br><span class=\"line\">     switch (columnCount) &#123;</span><br><span class=\"line\">         case 2:</span><br><span class=\"line\"><span class=\"deletion\">-            return &#x27;is-4-tablet is-4-desktop is-4-widescreen&#x27;;</span></span><br><span class=\"line\"><span class=\"addition\">+            return &#x27;is-4-tablet is-4-desktop is-3-widescreen&#x27;;</span></span><br><span class=\"line\">         case 3:</span><br><span class=\"line\">             return &#x27;is-4-tablet is-4-desktop is-3-widescreen&#x27;;</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面的代码用于优化不同屏幕大小下的宽度。</p>\n<figure class=\"highlight diff\"><figcaption><span>include/style/responsive.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> +widescreen()</span><br><span class=\"line\"><span class=\"addition\">+    .is-3-column .container</span></span><br><span class=\"line\"><span class=\"addition\">+        max-width: $widescreen - $gap</span></span><br><span class=\"line\"><span class=\"addition\">+        width: $widescreen - $gap</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\">     .is-1-column .container, .is-2-column .container</span><br><span class=\"line\">         max-width: $desktop - 2 * $gap</span><br><span class=\"line\">         width: $desktop - 2 * $gap</span><br><span class=\"line\"></span><br><span class=\"line\"> +fullhd()</span><br><span class=\"line\"><span class=\"addition\">+    .is-3-column .container</span></span><br><span class=\"line\"><span class=\"addition\">+        max-width: $fullhd - 2 * $gap</span></span><br><span class=\"line\"><span class=\"addition\">+        width: $fullhd - 2 * $gap</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\">     .is-2-column .container</span><br><span class=\"line\">         max-width: $widescreen - 2 * $gap</span><br><span class=\"line\">         width: $widescreen - 2 * $gap</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"优化标题布局\"><a href=\"#优化标题布局\" class=\"headerlink\" title=\"优化标题布局\"></a>优化标题布局</h2><p>这里将标题移动到正文上方，增加了更新时间，以及相对应的图标。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/article.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                 &#123;/* Metadata */&#125;</span><br><span class=\"line\">                 &lt;article class=&#123;`card-content article$&#123;&#x27;direction&#x27; in page ? &#x27; &#x27; + page.direction : &#x27;&#x27;&#125;`&#125; role=&quot;article&quot;&gt;</span><br><span class=\"line\"><span class=\"addition\">+                    &#123;/* Title */&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;h1 className=&quot;title is-size-3 is-size-4-mobile has-text-weight-normal&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &#123;index ?</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;a className=&quot;has-link-black-ter&quot; href=&#123;url_for(page.link || page.path)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;i className=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;&#123;page.title&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/a&gt; :</span></span><br><span class=\"line\"><span class=\"addition\">+                            [&lt;i className=&quot;fas fa-angle-double-right&quot;&gt;&lt;/i&gt;, page.title]</span></span><br><span class=\"line\"><span class=\"addition\">+                        &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;/h1&gt;</span></span><br><span class=\"line\">                     &#123;page.layout !== &#x27;page&#x27; ? &lt;div class=&quot;article-meta is-size-7 is-uppercase level is-mobile&quot;&gt;</span><br><span class=\"line\">                         &lt;div class=&quot;level-left&quot;&gt;</span><br><span class=\"line\">                             &#123;/* Creation Date */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                            &#123;page.date &amp;&amp; &lt;span class=&quot;level-item&quot; dangerouslySetInnerHTML=&#123;&#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                                __html: _p(&#x27;article.created_at&#x27;, `&lt;time dateTime=&quot;$&#123;date_xml(page.date)&#125;&quot; title=&quot;$&#123;date_xml(page.date)&#125;&quot;&gt;$&#123;date(page.date)&#125;&lt;/time&gt;`)</span></span><br><span class=\"line\"><span class=\"deletion\">-                            &#125;&#125;&gt;&lt;/span&gt;&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &#123;page.date &amp;&amp; &lt;span class=&quot;level-item&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;i className=&quot;far fa-calendar-alt&quot;&gt;&amp;nbsp;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;time dateTime=&quot;$&#123;date_xml(page.date)&#125;&quot; title=&quot;$&#123;date_xml(page.date)&#125;&quot;&gt;&#123;date(page.date)&#125;&lt;/time&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/span&gt;&#125;</span></span><br><span class=\"line\">                             &#123;/* Last Update Date */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                            &#123;page.updated &amp;&amp; &lt;span class=&quot;level-item&quot; dangerouslySetInnerHTML=&#123;&#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                                __html: _p(&#x27;article.updated_at&#x27;, `&lt;time dateTime=&quot;$&#123;date_xml(page.updated)&#125;&quot; title=&quot;$&#123;date_xml(page.updated)&#125;&quot;&gt;$&#123;date(page.updated)&#125;&lt;/time&gt;`)</span></span><br><span class=\"line\"><span class=\"deletion\">-                            &#125;&#125;&gt;&lt;/span&gt;&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &#123;page.updated &amp;&amp; &lt;span class=&quot;level-item is-hidden-mobile&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;i class=&quot;far fa-calendar-check&quot;&gt;&amp;nbsp;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                &lt;time dateTime=&quot;$&#123;date_xml(page.updated)&#125;&quot; title=&quot;$&#123;date_xml(page.updated)&#125;&quot;&gt;&#123;date(page.updated)&#125;&lt;/time&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/span&gt;&#125;</span></span><br><span class=\"line\">                             &#123;/* author */&#125;</span><br><span class=\"line\">                             &#123;page.author ? &lt;span class=&quot;level-item&quot;&gt; &#123;page.author&#125; &lt;/span&gt; : null&#125;</span><br></pre></td></tr></table></figure>\n\n<p>标题下方的发布时间与更新时间均改为直接使用日期。</p>\n<figure class=\"highlight diff\"><figcaption><span>source/js/main.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">-    if (typeof moment === &#x27;function&#x27;) &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-        $(&#x27;.article-meta time&#x27;).each(function() &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-            $(this).text(moment($(this).attr(&#x27;datetime&#x27;)).fromNow());</span></span><br><span class=\"line\"><span class=\"deletion\">-        &#125;);</span></span><br><span class=\"line\"><span class=\"deletion\">-    &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"优化文章结尾布局\"><a href=\"#优化文章结尾布局\" class=\"headerlink\" title=\"优化文章结尾布局\"></a>优化文章结尾布局</h2><p>在文章结尾增加一个<code>hr</code>以调整间距。另外设置在预览时也显示标签（tags），并将<code>Read More</code>按钮置于右侧且添加图标。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/article.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     &#123;/* Licensing block */&#125;</span><br><span class=\"line\">                     &#123;!index &amp;&amp; article &amp;&amp; article.licenses &amp;&amp; Object.keys(article.licenses)</span><br><span class=\"line\">                         ? &lt;ArticleLicensing.Cacheable page=&#123;page&#125; config=&#123;config&#125; helper=&#123;helper&#125; /&gt; : null&#125;</span><br><span class=\"line\"><span class=\"addition\">+                    &lt;hr style=&quot;height:1px;margin:1rem 0&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;div className=&quot;level is-mobile is-flex&quot;&gt;</span></span><br><span class=\"line\">                     &#123;/* Tags */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                    &#123;!index &amp;&amp; page.tags &amp;&amp; page.tags.length ? &lt;div class=&quot;article-tags is-size-7 mb-4&quot;&gt;</span></span><br><span class=\"line\"><span class=\"deletion\">-                        &lt;span class=&quot;mr-2&quot;&gt;#&lt;/span&gt;</span></span><br><span class=\"line\"><span class=\"deletion\">-                        &#123;page.tags.map(tag =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                            return &lt;a class=&quot;link-muted mr-2&quot; rel=&quot;tag&quot; href=&#123;url_for(tag.path)&#125;&gt;&#123;tag.name&#125;&lt;/a&gt;;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &#123;page.tags &amp;&amp; page.tags.length ? &lt;div class=&quot;article-tags is-size-7 is-uppercase&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &lt;i class=&quot;fas fa-tags has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &#123;page.tags.map((tag, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                            return &lt;a class=&quot;link-muted&quot; rel=&quot;tag&quot; href=&#123;url_for(tag.path)&#125;&gt;&#123;tag.name&#125;&#123;index !== page.tags.length-1? &#x27;, &#x27;:&#x27;&#x27;&#125;&lt;/a&gt;;</span></span><br><span class=\"line\">                         &#125;)&#125;</span><br><span class=\"line\">                     &lt;/div&gt; : null&#125;</span><br><span class=\"line\">                     &#123;/* &quot;Read more&quot; button */&#125;</span><br><span class=\"line\"><span class=\"deletion\">-                    &#123;index &amp;&amp; page.excerpt ? &lt;a class=&quot;article-more button is-small is-size-7&quot; href=&#123;`$&#123;url_for(page.link || page.path)&#125;#more`&#125;&gt;&#123;__(&#x27;article.more&#x27;)&#125;&lt;/a&gt; : null&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &#123;index &amp;&amp; page.excerpt ? &lt;a class=&quot;article-more button is-small is-size-7&quot; href=&#123;`$&#123;url_for(page.link || page.path)&#125;#more`&#125;&gt;&lt;i class=&quot;fas fa-book-reader has-text-grey&quot;&gt;&lt;/i&gt;&amp;nbsp;&amp;nbsp;&#123;__(&#x27;article.more&#x27;)&#125;&lt;/a&gt; : null&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;/div&gt;</span></span><br><span class=\"line\">                     &#123;/* Share button */&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"优化个人信息布局\"><a href=\"#优化个人信息布局\" class=\"headerlink\" title=\"优化个人信息布局\"></a>优化个人信息布局</h2><p>将下方博客数据统计修改为链接，在<code>Follow</code>按钮前增加Github图标。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/widget/profile.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">-                    &lt;div class=&quot;level-item has-text-centered is-marginless&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;a class=&quot;level-item has-text-centered is-marginless&quot; href=&#123;counter.category.url&#125;&gt;</span></span><br><span class=\"line\">                         &lt;div&gt;</span><br><span class=\"line\">                             &lt;p class=&quot;heading&quot;&gt;&#123;counter.category.title&#125;&lt;/p&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                            &lt;a href=&#123;counter.category.url&#125;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;div&gt;</span></span><br><span class=\"line\">                                 &lt;p class=&quot;title&quot;&gt;&#123;counter.category.count&#125;&lt;/p&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                            &lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;/div&gt;</span></span><br><span class=\"line\">                         &lt;/div&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                    &lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;/a&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/widget/profile.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;followLink ? &lt;div class=&quot;level&quot;&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                     &lt;a class=&quot;level-item button is-primary is-rounded&quot; href=&#123;followLink&#125; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&amp;nbsp;&amp;nbsp;&#123;followTitle&#125;&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                    &lt;a class=&quot;level-item button is-primary is-rounded&quot; href=&#123;followLink&#125; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;i class=&quot;fab fa-github&quot;&gt;&lt;/i&gt;&amp;nbsp;&amp;nbsp;&#123;followTitle&#125;&lt;/a&gt;</span></span><br><span class=\"line\">                &lt;/div&gt; : null&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"目录粘性定位\"><a href=\"#目录粘性定位\" class=\"headerlink\" title=\"目录粘性定位\"></a>目录粘性定位</h2><figure class=\"highlight diff\"><figcaption><span>source/js/main.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if ($toc.length &gt; 0) &#123;</span><br><span class=\"line\"><span class=\"addition\">+        $toc.addClass(&#x27;column-left is-sticky&#x27;);</span></span><br><span class=\"line\">         const $mask = $(&#x27;&lt;div&gt;&#x27;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>include/style/widget.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+#toc</span></span><br><span class=\"line\"><span class=\"addition\">+    max-height: calc(100vh - 22px)</span></span><br><span class=\"line\"><span class=\"addition\">+    overflow-y: scroll</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"功能\"><a href=\"#功能\" class=\"headerlink\" title=\"功能\"></a>功能</h1><h2 id=\"夜间模式\"><a href=\"#夜间模式\" class=\"headerlink\" title=\"夜间模式\"></a>夜间模式</h2><p>复制下面的代码，然后在<code>./themes/icarus/source/css/</code>目录下创建<code>night.styl</code>文件并粘贴。</p>\n<figure class=\"highlight stylus\"><figcaption><span>night.styl >folded</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dark-primary-<span class=\"attribute\">color</span> = rgb(<span class=\"number\">55</span>, <span class=\"number\">61</span>, <span class=\"number\">72</span>)</span><br><span class=\"line\">dark-primary-<span class=\"attribute\">color</span>-hover = rgb(<span class=\"number\">67</span>, <span class=\"number\">74</span>, <span class=\"number\">86</span>)</span><br><span class=\"line\">dark-primary-<span class=\"attribute\">color</span>-active = rgb(<span class=\"number\">44</span>, <span class=\"number\">49</span>, <span class=\"number\">58</span>)</span><br><span class=\"line\">dark-<span class=\"attribute\">font</span>-color = <span class=\"number\">#c0c0c0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#universe</span></span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.navbar-logo</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.footer-logo</span></span><br><span class=\"line\">  <span class=\"selector-class\">.logo-img-dark</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">body</span><span class=\"selector-class\">.night</span></span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#0e1225</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.night</span></span><br><span class=\"line\">  <span class=\"comment\">// code highlight (https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css)</span></span><br><span class=\"line\">  <span class=\"comment\">// navigation bar, cards</span></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">code</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">203</span>,<span class=\"number\">186</span>,<span class=\"number\">125</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// night icon changed to fas fa-sun</span></span><br><span class=\"line\">  <span class=\"selector-id\">#night-nav</span> <span class=\"selector-id\">#night-icon</span>:before</span><br><span class=\"line\">    <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;\\f185&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-menu</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: inherit</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-main</span> <span class=\"selector-class\">.navbar-menu</span> <span class=\"selector-class\">.navbar-item</span></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span>,</span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:focus</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.card</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.5</span>)</span><br><span class=\"line\">    backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\">    -webkit-backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.card</span></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.footer</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.5</span>)</span><br><span class=\"line\">    backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\">    -webkit-backdrop-<span class=\"attribute\">filter</span>: none</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;:before</span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">40</span>, <span class=\"number\">44</span>, <span class=\"number\">52</span>, <span class=\"number\">0.5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// input</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.input</span>, <span class=\"selector-class\">.textarea</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// message</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#c2c2c2</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#222222</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-info</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#bdc3c8</span> </span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#004779</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-warning</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#cbc8ba</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#5b4b00</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-danger</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#c6babe</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#79000f</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-success</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#bfc7c0</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#1e4d1c</span></span><br><span class=\"line\">  <span class=\"selector-class\">.message</span><span class=\"selector-class\">.message-immersive</span><span class=\"selector-class\">.is-primary</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"number\">#bdc0c9</span></span><br><span class=\"line\">    <span class=\"selector-class\">.message-body</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#003790</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// button</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-primary</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-light</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-small</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span>, &amp;<span class=\"selector-class\">.is-hovered</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:active</span>, &amp;<span class=\"selector-class\">.is-active</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-active</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-white</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-transparent</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: transparent</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-next</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-previous</span></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination-link</span><span class=\"selector-pseudo\">:not</span>(.is-current)</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// button</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-primary</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-light</span>, <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-small</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span>, &amp;<span class=\"selector-class\">.is-hovered</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:active</span>, &amp;<span class=\"selector-class\">.is-active</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-active</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-white</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-transparent</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: transparent</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-next</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.pagination</span> <span class=\"selector-class\">.pagination-previous</span></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination-link</span><span class=\"selector-pseudo\">:not</span>(.is-current)</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">a</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.pagination-link</span><span class=\"selector-class\">.is-current</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// comment</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vwrap</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vwrap</span> <span class=\"selector-class\">.vheader</span> <span class=\"selector-class\">.vinput</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vwrap</span> <span class=\"selector-class\">.vheader</span> <span class=\"selector-class\">.vinput</span><span class=\"selector-pseudo\">:focus</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vbtn</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:active</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-active</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vhead</span> <span class=\"selector-class\">.vsys</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vh</span> <span class=\"selector-class\">.vmeta</span> <span class=\"selector-class\">.vat</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vcontent</span><span class=\"selector-class\">.expand</span>:before</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: -webkit-gradient(linear, left top, left bottom, from(rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">0</span>)), to(rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">1</span>)))</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: linear-gradient(<span class=\"number\">180deg</span>, rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">0</span>), rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vcontent</span><span class=\"selector-class\">.expand</span>:after</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: rgba(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vh</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> <span class=\"selector-class\">.vlist</span> <span class=\"selector-class\">.vcard</span> <span class=\"selector-class\">.vquote</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// font color</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">body</span>,</span><br><span class=\"line\">  <span class=\"selector-tag\">strong</span>,</span><br><span class=\"line\">  <span class=\"selector-tag\">time</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.title</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.footer</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.card</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h1</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h2</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h3</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h4</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h5</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">h6</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-item</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-item</span><span class=\"selector-class\">.is-active</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.navbar-link</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">a</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.menu-label</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.level-item</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.input</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.textarea</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-white</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.button</span><span class=\"selector-class\">.is-transparent</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.article-licensing</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.v</span> *</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.media-content</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.has-text-grey</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.link-muted</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">a</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: rgb(<span class=\"number\">82</span>, <span class=\"number\">153</span>, <span class=\"number\">224</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-pseudo\">&amp;:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// quote</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">blockquote</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.article-licensing</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.post-copyright</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// table</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">thead</span> <span class=\"selector-tag\">td</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">thead</span> <span class=\"selector-tag\">th</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">td</span>,</span><br><span class=\"line\">  <span class=\"selector-class\">.content</span> <span class=\"selector-tag\">table</span> <span class=\"selector-tag\">th</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// break line</span></span><br><span class=\"line\"></span><br><span class=\"line\">  hr</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// tags and menus</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">article</span><span class=\"selector-class\">.article</span>, <span class=\"selector-tag\">article</span><span class=\"selector-class\">.media</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.title</span><span class=\"selector-pseudo\">:hover</span> <span class=\"selector-tag\">a</span></span><br><span class=\"line\">      <span class=\"comment\">// override anotherr !important</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: dark-font-color <span class=\"meta\">!important</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.tag</span><span class=\"selector-pseudo\">:not</span>(body)</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.tag</span><span class=\"selector-class\">.is-grey</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">a</span><span class=\"selector-class\">.is-active</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.menu-list</span> <span class=\"selector-tag\">li</span> <span class=\"selector-tag\">ul</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// time line</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.timeline</span> <span class=\"selector-class\">.media</span><span class=\"selector-pseudo\">:last-child</span>:after</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgb(<span class=\"number\">37</span>, <span class=\"number\">41</span>, <span class=\"number\">54</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.timeline</span></span><br><span class=\"line\">    <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.timeline</span> <span class=\"selector-class\">.media</span>:before</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// search box</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.searchbox</span></span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-header</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-header</span> <span class=\"selector-class\">.searchbox-input</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-header</span> <span class=\"selector-class\">.searchbox-close</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-body</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-result-section</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-result-item</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: dark-font-color</span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color</span><br><span class=\"line\">      <span class=\"attribute\">border-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span> <span class=\"selector-class\">.searchbox-result-section</span> <span class=\"selector-class\">.searchbox-result-item</span><span class=\"selector-pseudo\">:hover</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span> <span class=\"selector-class\">.searchbox-result-section</span> <span class=\"selector-class\">.searchbox-result-item</span><span class=\"selector-class\">.active</span>,</span><br><span class=\"line\">    <span class=\"selector-class\">.searchbox-container</span> <span class=\"selector-class\">.searchbox-header</span> <span class=\"selector-class\">.searchbox-close</span><span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">      <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: dark-primary-color-hover</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// selection</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-pseudo\">::selection</span></span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">52</span>, <span class=\"number\">109</span>, <span class=\"number\">167</span>, <span class=\"number\">0.8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  ::-moz-selection</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#ffffff</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">52</span>, <span class=\"number\">109</span>, <span class=\"number\">167</span>, <span class=\"number\">0.8</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">input</span>:-webkit-autofill</span><br><span class=\"line\">    -webkit-text-fill-<span class=\"attribute\">color</span>: dark-font-color <span class=\"meta\">!important</span></span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0px</span> <span class=\"number\">1000px</span> dark-primary-color inset</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">    <span class=\"attribute\">overflow-x</span>: auto;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0.5em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#abb2bf</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#282c34</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-comment</span>, <span class=\"selector-class\">.hljs-quote</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#5c6370</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-style</span>: italic</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-doctag</span>, <span class=\"selector-class\">.hljs-keyword</span>, <span class=\"selector-class\">.hljs-formula</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#c678dd</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-section</span>, <span class=\"selector-class\">.hljs-name</span>, <span class=\"selector-class\">.hljs-selector-tag</span>, <span class=\"selector-class\">.hljs-deletion</span>, <span class=\"selector-class\">.hljs-subst</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#e06c75</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-literal</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#56b6c2</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-string</span>, <span class=\"selector-class\">.hljs-regexp</span>, <span class=\"selector-class\">.hljs-addition</span>, <span class=\"selector-class\">.hljs-attribute</span>, <span class=\"selector-class\">.hljs-meta-string</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#98c379</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-built_in</span>, <span class=\"selector-class\">.hljs-class</span> <span class=\"selector-class\">.hljs-title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#e6c07b</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-attr</span>, <span class=\"selector-class\">.hljs-variable</span>, <span class=\"selector-class\">.hljs-template-variable</span>, <span class=\"selector-class\">.hljs-type</span>, <span class=\"selector-class\">.hljs-selector-class</span>, <span class=\"selector-class\">.hljs-selector-attr</span>, <span class=\"selector-class\">.hljs-selector-pseudo</span>, <span class=\"selector-class\">.hljs-number</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#d19a66</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-symbol</span>, <span class=\"selector-class\">.hljs-bullet</span>, <span class=\"selector-class\">.hljs-link</span>, <span class=\"selector-class\">.hljs-meta</span>, <span class=\"selector-class\">.hljs-selector-id</span>, <span class=\"selector-class\">.hljs-title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"number\">#61aeee</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-emphasis</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-style</span>: italic</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-strong</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-weight</span>: bold</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-class\">.hljs-link</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">text-decoration</span>: underline</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>接下来需要修改一下样式文件。</p>\n<figure class=\"highlight diff\"><figcaption><span>source/css/default.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  @import &#x27;style&#x27;</span><br><span class=\"line\"><span class=\"addition\">+ @import &#x27;night&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后在<code>./themes/icarus/source/js</code>下创建<code>night.js</code>文件，其内容如下：</p>\n<figure class=\"highlight js\"><figcaption><span>night.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">   * Icarus 夜间模式 by iMaeGoo</span></span><br><span class=\"line\"><span class=\"comment\">   * https://www.imaegoo.com/</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isNight = <span class=\"built_in\">localStorage</span>.getItem(<span class=\"string\">&#x27;night&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> nightNav;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyNight</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (value.toString() === <span class=\"string\">&#x27;true&#x27;</span>) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.remove(<span class=\"string\">&#x27;light&#x27;</span>);</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.add(<span class=\"string\">&#x27;night&#x27;</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.remove(<span class=\"string\">&#x27;night&#x27;</span>);</span><br><span class=\"line\">          <span class=\"built_in\">document</span>.body.classList.add(<span class=\"string\">&#x27;light&#x27;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findNightNav</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      nightNav = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;night-nav&#x27;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!nightNav) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">setTimeout</span>(findNightNav, <span class=\"number\">100</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          nightNav.addEventListener(<span class=\"string\">&#x27;click&#x27;</span>, switchNight);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">switchNight</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      isNight = isNight ? isNight.toString() !== <span class=\"string\">&#x27;true&#x27;</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\">      applyNight(isNight);</span><br><span class=\"line\">      <span class=\"built_in\">localStorage</span>.setItem(<span class=\"string\">&#x27;night&#x27;</span>, isNight);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  findNightNav();</span><br><span class=\"line\">  isNight &amp;&amp; applyNight(isNight);</span><br><span class=\"line\">&#125;());</span><br></pre></td></tr></table></figure>\n\n<p>最后，还要修改一下下面两个文件。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/scripts.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">             &lt;script src=&#123;url_for(&#x27;/js/main.js&#x27;)&#125; defer&gt;&lt;/script&gt;</span><br><span class=\"line\"><span class=\"addition\">+            &lt;script src=&#123;url_for(&#x27;/js/night.js&#x27;)&#125; defer=&#123;true&#125;&gt;&lt;/script&gt;</span></span><br><span class=\"line\">        &lt;/Fragment&gt;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>layout/commom/navbar.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                &lt;div class=&quot;navbar-end&quot;&gt;</span><br><span class=\"line\"><span class=\"addition\">+                        &lt;a class=&quot;navbar-item night&quot; id=&quot;night-nav&quot; title=&quot;Night Mode&quot; href=&quot;javascript:;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                            &lt;i class=&quot;fas fa-moon&quot; id=&quot;night-icon&quot;&gt;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                        &lt;/a&gt;</span></span><br><span class=\"line\">                        &#123;Object.keys(links).length ? &lt;Fragment&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Mathjax自动换行\"><a href=\"#Mathjax自动换行\" class=\"headerlink\" title=\"Mathjax自动换行\"></a>Mathjax自动换行</h2><p>在文章中，如果一行数学公式过长的话，公式内容会跑到文章栏的外面，非常难看。这里要设置的是使长公式根据页面宽度自动换行显示。</p>\n<p>在<code>./themes/icarus/source/js/</code>目录下新建一个名为<code>mathjax-config.js</code>的文件，其内容如下：</p>\n<figure class=\"highlight js\"><figcaption><span>mathjax-config.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">&#x27;DOMContentLoaded&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    MathJax.Hub.Config(&#123;</span><br><span class=\"line\">        <span class=\"attr\">showProcessingMessages</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"attr\">messageStyle</span>: <span class=\"string\">&quot;none&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;HTML-CSS&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">matchFontHeight</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"attr\">linebreaks</span>: &#123; <span class=\"attr\">automatic</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">SVG</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">matchFontHeight</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"attr\">linebreaks</span>: &#123; <span class=\"attr\">automatic</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">CommonHTML</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">matchFontHeight</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"attr\">linebreaks</span>: &#123; <span class=\"attr\">automatic</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">tex2jax</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">inlineMath</span>: [</span><br><span class=\"line\">                [<span class=\"string\">&#x27;$&#x27;</span>,<span class=\"string\">&#x27;$&#x27;</span>],</span><br><span class=\"line\">                [<span class=\"string\">&#x27;\\\\(&#x27;</span>,<span class=\"string\">&#x27;\\\\)&#x27;</span>]</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"attr\">displayMath</span>: [ </span><br><span class=\"line\">                [<span class=\"string\">&#x27;$$&#x27;</span>,<span class=\"string\">&#x27;$$&#x27;</span>], </span><br><span class=\"line\">                [<span class=\"string\">&quot;\\\\[&quot;</span>,<span class=\"string\">&quot;\\\\]&quot;</span>] </span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>然后修改下面的文件即可。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/layout.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">         &lt;Search config=&#123;config&#125; helper=&#123;helper&#125; /&gt;</span><br><span class=\"line\">             &lt;/body&gt;</span><br><span class=\"line\"><span class=\"addition\">+            &lt;script type=&quot;text/javascript&quot; src=&quot;/js/mathjax-config.js&quot;&gt;&lt;/script&gt;</span></span><br><span class=\"line\">        &lt;/html&gt;;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"样式\"><a href=\"#样式\" class=\"headerlink\" title=\"样式\"></a>样式</h1><h2 id=\"在页面底部添加创作共用许可协议的图标\"><a href=\"#在页面底部添加创作共用许可协议的图标\" class=\"headerlink\" title=\"在页面底部添加创作共用许可协议的图标\"></a>在页面底部添加创作共用许可协议的图标</h2><p>按照下面的方法更改代码即可。</p>\n<figure class=\"highlight diff\"><figcaption><span>layout/common/footer.jsx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                 const link = links[name];</span><br><span class=\"line\">                                 return &lt;p class=&quot;control&quot;&gt;</span><br><span class=\"line\">                                     &lt;a class=&#123;`button is-transparent $&#123;link.icon ? &#x27;is-large&#x27; : &#x27;&#x27;&#125;`&#125; target=&quot;_blank&quot; rel=&quot;noopener&quot; title=&#123;name&#125; href=&#123;link.url&#125;&gt;</span><br><span class=\"line\"><span class=\"deletion\">-                                        &#123;link.icon ? &lt;i class=&#123;link.icon&#125;&gt;&lt;/i&gt; : name&#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                                        &#123;link.icon ?</span></span><br><span class=\"line\"><span class=\"addition\">+                                            (Array.isArray(link.icon) ?</span></span><br><span class=\"line\"><span class=\"addition\">+                                                link.icon.map(i =&gt; [&lt;i className=&#123;i&#125;&gt;&lt;/i&gt;, &#x27;\\u00A0&#x27;]) :</span></span><br><span class=\"line\"><span class=\"addition\">+                                                &lt;i className=&#123;link.icon&#125;&gt;&lt;/i&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+                                        ) : name&#125;</span></span><br><span class=\"line\">                                     &lt;/a&gt;</span><br><span class=\"line\">                                 &lt;/p&gt;;</span><br><span class=\"line\">                             &#125;)&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>include/schema/common/footer.json</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">-            &quot;$ref&quot;: &quot;/misc/poly_links.json&quot;,</span></span><br></pre></td></tr></table></figure>\n\n<p>在<code>_config.icarus.yml</code>中添加如下配置：</p>\n<figure class=\"highlight yaml\"><figcaption><span>_config.icarus.yml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">footer:</span></span><br><span class=\"line\">    <span class=\"attr\">links:</span></span><br><span class=\"line\">        <span class=\"attr\">CC BY-NC-SA 4.0:</span></span><br><span class=\"line\">            <span class=\"attr\">icon:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons-by</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons-nc</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"string\">fab</span> <span class=\"string\">fa-creative-commons-sa</span></span><br><span class=\"line\">            <span class=\"attr\">url:</span> <span class=\"string\">&#x27;https://creativecommons.org/licenses/by-nc-sa/4.0/&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"按钮背景颜色增加渐变\"><a href=\"#按钮背景颜色增加渐变\" class=\"headerlink\" title=\"按钮背景颜色增加渐变\"></a>按钮背景颜色增加渐变</h2><figure class=\"highlight diff\"><figcaption><span>include/style/widget.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .widget</span><br><span class=\"line\">     .menu-list</span><br><span class=\"line\">         li</span><br><span class=\"line\">             ul</span><br><span class=\"line\">                 margin-right: 0</span><br><span class=\"line\"><span class=\"addition\">+        a</span></span><br><span class=\"line\"><span class=\"addition\">+            transition: background-color 0.3s ease-in-out</span></span><br><span class=\"line\">         .level</span><br><span class=\"line\">             margin-bottom: 0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"挂件卡片增加浮动效果\"><a href=\"#挂件卡片增加浮动效果\" class=\"headerlink\" title=\"挂件卡片增加浮动效果\"></a>挂件卡片增加浮动效果</h2><p>当鼠标悬浮在卡片上时增大阴影，并且设置渐变动画效果。</p>\n<figure class=\"highlight diff\"><figcaption><span>include/style/card.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .card</span><br><span class=\"line\">     overflow: visible</span><br><span class=\"line\">     border-radius: $card-radius</span><br><span class=\"line\"><span class=\"addition\">+    &amp;:hover</span></span><br><span class=\"line\"><span class=\"addition\">+        box-shadow: 0 6px 15px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1)</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>source/js/animation.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">     setTimeout(() =&gt; &#123;</span><br><span class=\"line\">         $(&#x27;body &gt; .navbar, body &gt; .section, body &gt; .footer&#x27;).forEach(element =&gt; &#123;</span><br><span class=\"line\">             element.style.opacity = &#x27;1&#x27;;</span><br><span class=\"line\"><span class=\"deletion\">-            element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out&#x27;;</span></span><br><span class=\"line\"><span class=\"addition\">+            element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out&#x27;;</span></span><br><span class=\"line\">         &#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>source/js/animation.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                     element.style.transform = &#x27;&#x27;;</span><br><span class=\"line\"><span class=\"deletion\">-                    element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out&#x27;;</span></span><br><span class=\"line\"><span class=\"addition\">+                    element.style.transition = &#x27;opacity 0.3s ease-out, transform 0.3s ease-out, box-shadow 0.3s ease-in-out&#x27;;</span></span><br><span class=\"line\">                 &#125;, i * 100);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修改标签颜色\"><a href=\"#修改标签颜色\" class=\"headerlink\" title=\"修改标签颜色\"></a>修改标签颜色</h2><p>由于此处新增了夜间模式，所以需要修改两个<code>.styl</code>文件。</p>\n<figure class=\"highlight diff\"><figcaption><span>include/style/widget.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    .tags</span><br><span class=\"line\">         .tag:first-child</span><br><span class=\"line\"><span class=\"deletion\">-            background: $primary</span></span><br><span class=\"line\"><span class=\"deletion\">-            color: $primary-invert</span></span><br><span class=\"line\"><span class=\"addition\">+            background: $light-grey</span></span><br><span class=\"line\"><span class=\"addition\">+            color: #4a4a4a</span></span><br><span class=\"line\"></span><br><span class=\"line\">         .tag:last-child</span><br><span class=\"line\"><span class=\"deletion\">-            background: $light-grey</span></span><br><span class=\"line\"><span class=\"addition\">+            background: #e7e7e7</span></span><br><span class=\"line\">             color: $white-invert</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight diff\"><figcaption><span>source/css/night.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> .title:hover a</span><br><span class=\"line\">       // override anotherr !important</span><br><span class=\"line\">       color: dark-font-color !important</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+  .tags</span></span><br><span class=\"line\"><span class=\"addition\">+    .tag:first-child</span></span><br><span class=\"line\"><span class=\"addition\">+      background: dark-primary-color</span></span><br><span class=\"line\"><span class=\"addition\">+      color: dark-font-color</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+    .tag:last-child</span></span><br><span class=\"line\"><span class=\"addition\">+      background: rgb(45, 51, 62)</span></span><br><span class=\"line\"><span class=\"addition\">+      color: dark-font-color</span></span><br><span class=\"line\"></span><br><span class=\"line\">   .tag:not(body)</span><br><span class=\"line\">     color: dark-font-color</span><br><span class=\"line\">     background-color: dark-primary-color</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"滚动条统一改为新样式\"><a href=\"#滚动条统一改为新样式\" class=\"headerlink\" title=\"滚动条统一改为新样式\"></a>滚动条统一改为新样式</h2><p>Icarus在最近的更新中修改了滚动条的样式。相比之前的系统默认样式，新版本的滚动条看起来更窄并做了圆角化处理。但是Icarus的作者只修改了桌面端的滚动条样式，在移动端或者当桌面端的浏览器窗口变窄时，滚动条会变为之前傻大黑粗的默认样式。为了美观和统一，只需要在<code>./themes/icarus/include/style/base.styl</code>文件的末尾添加下面的代码，即可完美解决上述问题。</p>\n<figure class=\"highlight stylus\"><figcaption><span>base.styl</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+mobile()</span><br><span class=\"line\">    ::-webkit-scrollbar</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">8px</span></span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">8px</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-track</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.06</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.12</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">10px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb<span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.24</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">+tablet()</span><br><span class=\"line\">    ::-webkit-scrollbar</span><br><span class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">8px</span></span><br><span class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">8px</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-track</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.06</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">5px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb</span><br><span class=\"line\">        <span class=\"attribute\">border-radius</span>: <span class=\"number\">3px</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.12</span>)</span><br><span class=\"line\">        <span class=\"attribute\">box-shadow</span>: inset <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">10px</span> rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar-thumb<span class=\"selector-pseudo\">:hover</span></span><br><span class=\"line\">        <span class=\"attribute\">background</span>: rgba(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.24</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<p>参考：</p>\n<p><a href=\"https://www.alphalxy.com/2019/03/customize-icarus/#页面footer显示一组icon\">Icarus 主题自定义 - Alpha Lxy</a></p>\n<p><a href=\"https://ppoffice.github.io/hexo-theme-icarus/Configuration/icarus用户指南-主题配置/\">Icarus用户指南 - 主题配置 - Icarus (ppoffice.github.io)</a></p>\n<p><a href=\"https://blog.asahih.com/hexo-icarus-night-mode/\">Hexo 主题 icarus 4 配置夜间模式 Night Mode - Asahi’s Blog (asahih.com)</a></p>\n<p><a href=\"https://blog.luzy.top/posts/486003558/\">Hexo折腾系列（四）鼠标指针美化 - 江风引雨の小po站 (luzy.top)</a></p>\n"},{"title":"Icarus消息框模板","date":"2021-08-22T07:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/icarus.png","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/icarus.png","_content":"Hexo主题Icarus的[示例网站](https://ppoffice.github.io/hexo-theme-icarus/)更新后文章中出现了样式美观的提示框，但是好像这个提示框并不是主题的新特性。查看作者的源码后发现，这个提示框仍然是以HTML代码的形式插入在Markdown文件中的。这里将这些代码整理成一个模板以便日后使用。\n<!-- more -->\n# 白\n<article class=\"message message-immersive is-white\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认白色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```html\n<article class=\"message message-immersive is-white\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认白色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 黑\n<article class=\"message message-immersive is-black\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认黑色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-black\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认黑色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 亮\n<article class=\"message message-immersive is-light\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认亮消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-light\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认亮消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 暗\n<article class=\"message message-immersive is-dark\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认暗消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-dark\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认暗消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 基本\n<article class=\"message message-immersive is-primary\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个基本消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-primary\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个基本消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 链接\n<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n这是一个链接消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n这是一个链接消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 信息\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个信息消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个信息消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 成功\n<article class=\"message message-immersive is-success\">\n<div class=\"message-body\">\n<i class=\"fas fa-check mr-2\"></i>\n这是一个成功消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-success\">\n<div class=\"message-body\">\n<i class=\"fas fa-check mr-2\"></i>\n这是一个成功消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 警告\n<article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n这是一个警告消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n这是一个警告消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 危险\n<article class=\"message message-immersive is-danger\">\n<div class=\"message-body\">\n<i class=\"fas fa-bug mr-2\"></i>\n这是一个危险消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-danger\">\n<div class=\"message-body\">\n<i class=\"fas fa-bug mr-2\"></i>\n这是一个危险消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n","source":"_posts/Icarus消息框模板.md","raw":"---\ntitle: Icarus消息框模板\ndate: 2021-08-22 15:00:00\ncategories: \n\t- [Others]\n\t#- [cate2]\n\t#...\ntags: \n\t- Hexo\n\t- Icarus\n\t- Template\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/icarus.png\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/icarus.png\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\n#excerpt: ...\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\nHexo主题Icarus的[示例网站](https://ppoffice.github.io/hexo-theme-icarus/)更新后文章中出现了样式美观的提示框，但是好像这个提示框并不是主题的新特性。查看作者的源码后发现，这个提示框仍然是以HTML代码的形式插入在Markdown文件中的。这里将这些代码整理成一个模板以便日后使用。\n<!-- more -->\n# 白\n<article class=\"message message-immersive is-white\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认白色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```html\n<article class=\"message message-immersive is-white\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认白色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 黑\n<article class=\"message message-immersive is-black\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认黑色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-black\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认黑色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 亮\n<article class=\"message message-immersive is-light\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认亮消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-light\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认亮消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 暗\n<article class=\"message message-immersive is-dark\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认暗消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-dark\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认暗消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 基本\n<article class=\"message message-immersive is-primary\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个基本消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-primary\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个基本消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 链接\n<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n这是一个链接消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n这是一个链接消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 信息\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个信息消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个信息消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 成功\n<article class=\"message message-immersive is-success\">\n<div class=\"message-body\">\n<i class=\"fas fa-check mr-2\"></i>\n这是一个成功消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-success\">\n<div class=\"message-body\">\n<i class=\"fas fa-check mr-2\"></i>\n这是一个成功消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 警告\n<article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n这是一个警告消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n这是一个警告消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n# 危险\n<article class=\"message message-immersive is-danger\">\n<div class=\"message-body\">\n<i class=\"fas fa-bug mr-2\"></i>\n这是一个危险消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```HTML\n<article class=\"message message-immersive is-danger\">\n<div class=\"message-body\">\n<i class=\"fas fa-bug mr-2\"></i>\n这是一个危险消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n```\n\n","slug":"Icarus消息框模板","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzs00091q390um1aueu","content":"<p>Hexo主题Icarus的<a href=\"https://ppoffice.github.io/hexo-theme-icarus/\">示例网站</a>更新后文章中出现了样式美观的提示框，但是好像这个提示框并不是主题的新特性。查看作者的源码后发现，这个提示框仍然是以HTML代码的形式插入在Markdown文件中的。这里将这些代码整理成一个模板以便日后使用。</p>\n<a id=\"more\"></a>\n<h1 id=\"白\"><a href=\"#白\" class=\"headerlink\" title=\"白\"></a>白</h1><article class=\"message message-immersive is-white\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认白色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-white&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认白色消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"黑\"><a href=\"#黑\" class=\"headerlink\" title=\"黑\"></a>黑</h1><article class=\"message message-immersive is-black\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认黑色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-black&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认黑色消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"亮\"><a href=\"#亮\" class=\"headerlink\" title=\"亮\"></a>亮</h1><article class=\"message message-immersive is-light\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认亮消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-light&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认亮消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"暗\"><a href=\"#暗\" class=\"headerlink\" title=\"暗\"></a>暗</h1><article class=\"message message-immersive is-dark\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认暗消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-dark&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认暗消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"基本\"><a href=\"#基本\" class=\"headerlink\" title=\"基本\"></a>基本</h1><article class=\"message message-immersive is-primary\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个基本消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-primary&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个基本消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"链接\"><a href=\"#链接\" class=\"headerlink\" title=\"链接\"></a>链接</h1><article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n这是一个链接消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-link&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-link mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个链接消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"信息\"><a href=\"#信息\" class=\"headerlink\" title=\"信息\"></a>信息</h1><article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个信息消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-info&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个信息消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"成功\"><a href=\"#成功\" class=\"headerlink\" title=\"成功\"></a>成功</h1><article class=\"message message-immersive is-success\">\n<div class=\"message-body\">\n<i class=\"fas fa-check mr-2\"></i>\n这是一个成功消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-success&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-check mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个成功消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"警告\"><a href=\"#警告\" class=\"headerlink\" title=\"警告\"></a>警告</h1><article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n这是一个警告消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-warning&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-exclamation-triangle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个警告消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"危险\"><a href=\"#危险\" class=\"headerlink\" title=\"危险\"></a>危险</h1><article class=\"message message-immersive is-danger\">\n<div class=\"message-body\">\n<i class=\"fas fa-bug mr-2\"></i>\n这是一个危险消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-danger&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-bug mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个危险消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>Hexo主题Icarus的<a href=\"https://ppoffice.github.io/hexo-theme-icarus/\">示例网站</a>更新后文章中出现了样式美观的提示框，但是好像这个提示框并不是主题的新特性。查看作者的源码后发现，这个提示框仍然是以HTML代码的形式插入在Markdown文件中的。这里将这些代码整理成一个模板以便日后使用。</p>","more":"<h1 id=\"白\"><a href=\"#白\" class=\"headerlink\" title=\"白\"></a>白</h1><article class=\"message message-immersive is-white\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认白色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-white&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认白色消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"黑\"><a href=\"#黑\" class=\"headerlink\" title=\"黑\"></a>黑</h1><article class=\"message message-immersive is-black\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认黑色消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-black&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认黑色消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"亮\"><a href=\"#亮\" class=\"headerlink\" title=\"亮\"></a>亮</h1><article class=\"message message-immersive is-light\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认亮消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-light&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认亮消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"暗\"><a href=\"#暗\" class=\"headerlink\" title=\"暗\"></a>暗</h1><article class=\"message message-immersive is-dark\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个默认暗消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-dark&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个默认暗消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"基本\"><a href=\"#基本\" class=\"headerlink\" title=\"基本\"></a>基本</h1><article class=\"message message-immersive is-primary\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个基本消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-primary&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个基本消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"链接\"><a href=\"#链接\" class=\"headerlink\" title=\"链接\"></a>链接</h1><article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n这是一个链接消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-link&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-link mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个链接消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"信息\"><a href=\"#信息\" class=\"headerlink\" title=\"信息\"></a>信息</h1><article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是一个信息消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-info&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-info-circle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个信息消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"成功\"><a href=\"#成功\" class=\"headerlink\" title=\"成功\"></a>成功</h1><article class=\"message message-immersive is-success\">\n<div class=\"message-body\">\n<i class=\"fas fa-check mr-2\"></i>\n这是一个成功消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-success&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-check mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个成功消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"警告\"><a href=\"#警告\" class=\"headerlink\" title=\"警告\"></a>警告</h1><article class=\"message message-immersive is-warning\">\n<div class=\"message-body\">\n<i class=\"fas fa-exclamation-triangle mr-2\"></i>\n这是一个警告消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-warning&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-exclamation-triangle mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个警告消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"危险\"><a href=\"#危险\" class=\"headerlink\" title=\"危险\"></a>危险</h1><article class=\"message message-immersive is-danger\">\n<div class=\"message-body\">\n<i class=\"fas fa-bug mr-2\"></i>\n这是一个危险消息框，点击<a href=\"https://astrobear.top\">此处</a>以浏览更多。\n</div>\n</article>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message message-immersive is-danger&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;message-body&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fas fa-bug mr-2&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></span><br><span class=\"line\">这是一个危险消息框，点击<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://astrobear.top&quot;</span>&gt;</span>此处<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>以浏览更多。</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"黑苹果入门完全指南","date":"2020-02-14T12:36:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg","excerpt":"震惊！黑苹果的背后居然有着这些不为人知的秘密！","_content":"\n### 关于黑苹果\n\n欢迎步入黑苹果的世界！众所周知，Mac因其独特的macOS系统在众多Windows电脑中独树一帜。macOS具有许多与Windows不同的特性和优点（当然，也有不足），而且有些软件在macOS上的优化会比Windows更好或者只支持macOS平台。这就是为什么Mac在市场上一直有着广泛的需求的根本原因——即macOS的独特性。由于苹果的封闭性策略，macOS在正常情况下只能安装在Mac上。而黑苹果的出现，给广大对macOS有需求的人们提供了一个新的选择——你再也不需要为了一个系统去购买在同等硬件或性能条件下价格更为昂贵的电脑了。\n\n黑苹果，意思就是安装有macOS的，可以正常工作的非Mac的电脑，也可以指为非Mac的电脑安装macOS的行为，亦可以指安装在非Mac电脑上的macOS。对于这个词的确切定义还是模糊不清的，不过这不是关键所在。与黑苹果相对，白苹果的含义就非常明显了，也就是苹果的Mac或者安装在Mac上的macOS。\n\n黑苹果的原理就是通过对电脑主板的破解和对系统的欺骗，让macOS以为这是一台Mac，再通过一系列驱动和补丁使得这台电脑可以在macOS下正常运行。需要注意的是：\n\n<font size=4>**将macOS安装在非Mac的电脑上是违反苹果公司的法律条款的！**</font>\n\n所以安装黑苹果是存在一定的法律风险的，这有可能（但是非常非常罕见）导致你的AppleID被锁死。但是一般情况下，苹果公司对这种行为都是睁一只眼闭一只眼。只是随着黑苹果数量上的日益增长，不知道什么时候会引起苹果公司的重视并对此采取措施。而在另一方面，如果你使用黑苹果来牟利的话，性质就完全不同了，你有可能会受到法律的制裁。\n\n由于macOS从一开始就不被允许安装在非Mac的电脑上，因此安装黑苹果绝对不是一件容易的事情，它涉及到对主板的破解，对硬件的驱动，对系统的欺骗，同时也会产生很多奇奇怪怪的bug。黑苹果有很多缺点：\n\n- 不完美的黑苹果相对于白苹果不那么稳定\n- 黑苹果在硬件层面上的缺失导致很多功能无法实现，如Touch Bar，Touch ID，力度触控板等\n- 安装黑苹果仍需要满足一定的硬件条件，某些型号的硬件在黑苹果下是无法驱动的\n- 安装黑苹果费时费力，相当折腾\n\n既然黑苹果有那么多缺点，并且还是非法的行为，那为什么还有那么多人在使用黑苹果并且人数还在日益增长呢？因为黑苹果与同样安装有macOS的电脑相比，还是有其优点的：\n\n- 完美的黑苹果在使用体验上基本不输给Mac\n\n- 黑苹果在同等硬件或性能条件下比起Mac便宜许多\n- 黑苹果的定制性和可扩展性在某些方面比Mac强大许多\n\n从黑苹果的优点来看，再结合实际情况，我们可以发现使用黑苹果的人群可以分为以下几类：\n\n- 对macOS有刚需，但是又不想花钱/没钱买Mac的，如某些影视、音乐工作者\n- 对macOS有刚需，但是受限于苹果封闭的生态，只能通过黑苹果的高可扩展性来满足自己对硬件的需求的特定行业从业者\n- 对macOS没有刚需，具有反叛精神的极客，专门研究操作系统和硬件的工程师，通常这类人也有白苹果\n- 对macOS没有刚需，只是想要体验macOS或苹果完整生态却又不想花钱/没钱购买Mac的人\n\n而博主作为一个穷学生，就是属于最后一类的人😂。我折腾黑苹果已经有1年时间，现在自己在用的电脑是惠普的`Envy-13 ad024TU`，装有Windows和macOS两个系统。博主的黑苹果已经基本完美，在使用体验上已经与白苹果相差无几。关于我的黑苹果的更多信息，可以参考我的[GitHub仓库](https://github.com/Astrobr/HackintoshForEnvy13-ad0xx)，或者我的[另一篇博客](https://astrobear.top/2020/02/14/HP_Envy-13_ad024TU_Hackintosh/)，在那篇博客里我主要总结了给自己的电脑安装黑苹果时踩过的一些坑。而这篇文章主要是针对笔记本电脑，让大家对黑苹果有一个初步的了解。看完这篇文章，你就基本入门黑苹果了。\n\n### 黑苹果的原理以及核心\n\n#### 黑苹果的原理\n\n在讨论这个问题以前，我们先要了解一下电脑是怎么启动的。\n\n首先，在你按下开机键以后，电脑上电，各硬件进入了待命状态。CPU（Central Processing Unit，中央处理器）启动以后，按照其在设计时就固定好的功能送出了第一条指令，这一条指令将会使BIOS（Basic Input/Output System，基本输入输出系统）芯片中装载的程序开始执行。BIOS程序可以实现很多功能，比如系统自检，提供中断服务等。但是它最主要的功能则是将存放于硬盘引导区的操作系统引导程序（Boot loader，下文简称引导）装载入内存，再通过引导将操作系统装载进内存。\n\n当然，现在市面上新发售的电脑大部分都已经采用了一种更新的方式来装载引导，也就是所谓的UEFI（Unified Extensible Firmware Interface，统一可扩部件接口）。UEFI作为一种较新的方案，它和BIOS的区别主要是在可扩展性方面。但是除了一些细微的差别，它在整个启动的流程上与BIOS基本相同，且最终目的都是将引导装载进内存当中。另外在开发者圈子中，BIOS和UEFI也常常被混为一谈。因此尽管现在的主流是采用更先进的UEFI，但在下面的叙述中我还是会使用BIOS的概念。这并不会给理解带来困难，只是你们需要知道这两者有些许微妙的区别即可。\n\n也许有人会问，为什么不使用BIOS直接将操作系统装载进内存呢？首先，如果有多个操作系统，那么不同的操作系统的装载过程会有所不同。如果要让BIOS适配不同的操作系统，那么会导致它的体积过于庞大，系统过于复杂，不利于它的的稳定。其次就是，BIOS是固定在BIOS芯片中的，不方便修改。这也导致了我们难以让BIOS对不同的操作系统做适配。因此，我们需要引导来完成操作系统加载的工作。\n\n具体而言，引导需要完成的工作主要有以下几点：\n\n- 初始化其他硬件设备，为系统提供可访问的表和服务\n- 为操作系统分配内存空间，再将它加载进内存当中\n- 为高级计算机程序语言提供执行环境\n- 将控制权移交给操作系统\n\n在此之后，系统的完整的启动过程就结束了，操作系统接管了整个电脑。简而言之，电脑的启动过程可以概括为：`BIOS->Bootloder->OS(操作系统)`。\n\n回到黑苹果上来。我们想要在一款非Mac的电脑上运行macOS，与我们在电脑上运行Windows的最大区别在哪儿？当然是操作系统不同啊！由于macOS与Windows是两个完全不同的操作系统，因此他们启动和加载的过程也完全不同。所以我们肯定不可以用启动Windows的那一套方法去启动macOS，而必须要有专门的适应macOS的一套启动方法（程序）。\n\n我们想要将macOS加载到我们的内存当中，就要对当前我们的启动程序进行修改和适配。回顾上文所说的电脑的启动过程我们可以发现，BIOS是固定在芯片中的，不易修改。那么我们可以操作的部分就只有引导了。所以我们要找到合适的引导程序，使其可以将macOS正确地装载进内存，并给它提供正确的服务，让它可以与硬件正常交流，最终使它正常运行。\n\n通过上面的一番讲解，我们可以发现，安装黑苹果的核心就是引导。而实际上，折腾黑苹果折腾的也主要就是引导。而由于白苹果的硬件，BIOS，和引导都是针对macOS开发的，所以当然不要任何的折腾，开箱即用就行（废话......）。\n\n目前主流的可以用于在非Mac的电脑上启动macOS的引导主要有两个，分别是`Clover`和`OpenCore`（下文简称OC）。由于OC是新开发的引导，目前还在公测阶段，而且其在社区普及率远远不如Clover，所以下面将主要讲解Clover，而对于OC只作非常简单的介绍。\n\n#### Clover\n\n> 启动器的名字`Clover`由一位创建者kabyl命名。他发现了四叶草和Mac键盘上Commmand键（⌘）的相似之处，由此起了Clover这个名字。四叶草是三叶草的稀有变种。根据西方传统，发现者四叶草意味的是好运，尤其是偶然发现的，更是祥瑞之兆。另外，第一片叶子代表信仰，第二片叶子代表希望，第三片叶子代表爱情，第四片叶子代表运气。——摘自维基百科\n\nClover是一个操作系统引导程序，可以通过新老两种方式进行启动，也就是BIOS方式和UEFI方式。目前主流的操作系统都已经是通过UEFI方式启动的了，如macOS，Windows 7/8/10 (64-bit)，Linux。\n\n所有的引导都是放在电脑硬盘开头部分的引导区（ESP分区）的EFI文件夹中，Clover也不例外。当然，EFI文件中还存放着Windows，Linux，或者其他操作系统的引导。下面就来看看Clover的文件结构吧。\n\n![重要的文件夹和其功能在图中注明](https://astrobear.top/resource/astroblog/content/hack1.png)\n\n在Clover下使用UEFI方式启动的流程是这样的：`UEFI->CLOVERX64.efi->OS`。\n\n下面我将主要根据在实际操作中用到的一些功能来介绍Clover。\n\n- 进入操作系统\n\n  这一步非常简单，开机之后用方向键选择你需要进入的操作系统的卷标，按下回车即可。\n\n  ![图中出现了三种不同系统的卷标(Credit: daliansky)](http://7.daliansky.net/1-main.png)\n\n- 显示帮助\n\n  按下`F1`键会出现帮助信息。\n\n  ![帮助信息(Credit: daliansky)](http://7.daliansky.net/Help_F11.png)\n\n- 更新Clover\n\n  请在[这里](https://github.com/Dids/clover-builder/releases)下载最新版本的`CLOVERX64.efi`并使用它替换掉你的EFI文件夹中的Clover文件夹中的同名文件。\n\n- 开启啰嗦模式启动\n\n  首先我要介绍一下什么是啰嗦模式。一般来说，我们在启动系统的时候只能看到一个进度条或者旋转的表示加载中的图案。而啰嗦模式就是将系统启动时各种详细参数和日志以及报错消息全部显示出来的模式，如下图所示。如果发生了操作系统启动异常/失败的情况，通过开启啰嗦模式，我们可以快速定位到出错的位置。\n\n  开启啰嗦模式的方法很简单。首先选择你想要进入的系统的图标，按空格即可进入下图所示的页面，然后勾选图示选项，再选择`Boot macOS with selected options`启动。\n\n  ![开启啰嗦模式(Credit: daliansky)](http://7.daliansky.net/space-selected.png)\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack2.jpg\" alt=\"开启啰嗦模式的效果\" />\n\n- 显示隐藏的卷标\n\n  有的时候在Clover的启动页面中会出现很多以不同方式启动同一系统的卷标（Volume，可以理解为入口），我们可以通过修改Clover的配置文件来隐藏这些卷标，但是有的时候你又需要它们显示出来（比如你要通过进入`Recovery`卷标来关闭macOS的系统完整性保护的时候）。这个时候我们不必重新修改配置文件，只需要在Clover的主界面按下`F3`，即可将隐藏的卷标显示出来。\n\n  关于怎么隐藏卷标，我将在下面介绍。\n\n- 提取DSDT\n\n  DSDT的全称为 Differentiated System Description Table，它是一个描述系统硬件不同信息的表，通过查阅这个表中的信息可以知道你的电脑有什么硬件，它们的名称是什么。知道这些信息有利于我们理顺硬件之间的关系，再通过修改补丁更正硬件信息，以优化操作系统的工作状况。\n\n  在Clover主界面下按`F4`即可将你的DSDT信息保存到`EFI/CLOVER/ACPI/origin/`文件夹中。请注意，DSDT是由多个文件组成的。\n\n- 选择你想要启用/禁用的驱动程序\n\n  通过Clover加载的驱动程序保存在`EFI/CLOVER/kexts/Other`中，这些驱动程序是针对macOS生效的。在上面所说的那个文件夹中包含了很多不同的驱动文件，有些驱动文件之间会产生冲突，而有些驱动文件又是完全没有必要存在的。为了管理和精简你的驱动程序，你可以在Clover中设置你想要禁用的驱动程序以排查各种驱动的工作状况。\n\n  首先你要选择macOS的图标，按下空格键。然后在新的页面中将光标移动到`Block injected kexts`，按下回车后进入该选项。再在新的页面中选择`Other`选项，这个时候你就可以看到你的驱动程序了。勾选你想要禁用的驱动程序以后，按`Esc`回到主页面，再直接回车进入macOS。\n\n  ![选择你想要禁用的驱动程序(Credit: daliansky)](http://7.daliansky.net/BIKChoose.png)\n\n  请注意，你的这一设置只对这一次启动有效，在之后的启动中将不会保留。\n\n- 设置Clover（修改`config.plist`）\n\n  有多种方法进行设置。\n\n  - 你可以在开机以后的Clover主界面下按下按键`O`进入设置页面，然后你就可以选择不同的选项开始修改你的配置文件了，不过一般情况下我们不会使用这种`抽象`的方式来修改\n\n    ![Clover的设置页面(Credit: daliansky)](http://7.daliansky.net/options.png)\n\n  - 使用Clover Configurator来修改\n\n    Clover Configurator是一款运行在macOS下的应用程序，专门用来修改Clover的配置文件。它具有友好的图形化界面，每个选项都有比较详细的功能说明，操作起来比在启动时修改要轻松得多。Clover Configurator的下载链接放在文末。\n\n    在设置以前，你需要在Clover Configurator的`挂载分区`选项卡中挂载你ESP分区（通常情况下这个分区都是隐藏的）。然后在你的Clover文件夹下使用Clover Configurator打开`config.plist`文件，进行修改。修改完成以后，请点击左下角的保存图标（图中以红框标明）。\n\n    ![Clover Configurator的设置界面](https://astrobear.top/resource/astroblog/content/hack3.png)\n\n    ![Clover Configurator的设置界面](https://astrobear.top/resource/astroblog/content/hack4.png)\n\n  - 你还可以使用普通的文本文档编辑器（如Xcode或者Visual Studio Code）打开`config.plist`对其进行编辑，但是这个方法依旧比较`抽象`，不推荐新手或者代码小白这样操作\n\n    ![在Visual Studio Code中打开的Clover配置文件](https://astrobear.top/resource/astroblog/content/hack5.png)\n\n- 增加/删除/修改/查找驱动程序\n\n  在启动以后，你可以使用Clover Configurator挂载EFI分区，然后直接使用访达在驱动文件夹中以可视化的方式管理你的驱动程序。\n\n  当然，你也可以使用`Disk Genius`在Windows下管理你的驱动程序。在下一章节中有关于`Disk Genius`的更多介绍。\n\n- 更换Clover的主题\n\n  Clover提供了很多自定义功能，你可以选择自己喜欢的Clover开机主题。Clover的主题存放在`EFI/CLOVER/themes/`文件夹中，你可以下载你喜欢的主题文件夹并将其保存到上述路径中。然后，你需要在Clover Configurator中的`引导界面`选项卡中填写你想要设置的主题文件夹的名字（如下图）并保存。\n\n  ![修改Clover主题](https://astrobear.top/resource/astroblog/content/hack6.png)\n\n  作者目前用的是一款名为`Simple`的主题，可以点击[此处](https://github.com/burpsuite/clover_theme)下载。在GitHub上还有很多不同的Clover主题可供选择。\n\n  ![作者正在使用的Simple主题](https://astrobear.top/resource/astroblog/content/hack7.png)\n\n- 隐藏你不需要的卷标\n\n  如果你的Clover启动界面有很多引导同一系统的卷标，你可以将他们隐藏起来。具体方法是，Clover Configurator中的`引导界面`选项卡中的`隐藏卷`一栏中填写你想要隐藏的卷标的名称，然后保存文件。\n\n  ![隐藏你不需要的卷标](https://astrobear.top/resource/astroblog/content/hack8.png)\n\nClover的主要功能就介绍到这里了。由于本文是纯粹的新手向，在这里就不介绍如何配置`config.plist`了。一般来说，只要你能够找到完全对应你机型的EFI文件，基本上就不需要再重新配置Clover了。下面，我们再简单介绍一下新时代的引导工具：OpenCore。\n\n#### OpenCore\n\nOpenCore是一个着眼于未来的先进的开源引导工具，他支持多种主流操作系统的引导。OC的历史使命就是有朝一日代替Clover，成为主流。OC主要有以下几个优势：\n\n- 从 2019 年 9 月以后, Acidanthera（神级大佬，黑苹果现有的大部分驱动目前都是他在开发管理）开发的内核驱动 （Lilu, AppleALC 等）将**不再会**在 Clover 上做兼容性测试（虽然这不能算是优势，但是很关键好吗！）\n- OC的安全性更好，对文件保险箱（FileVault）有更强大的支持\n- OC使用更先进的方法注入第三方内核驱动（也就是你`EFI/CLOVER/kexts/Other`里面的那些`kext`文件）\n- OC在启动体验上会更加接近白苹果\n\n当然，为什么现在OC还未能成为主流，首先是因为它还处于开发阶段，各方面还未达到最成熟的状态；其次是因为OC的配置相对于Clover要复杂许多，而且目前没有像Clover Configurator一样直观的图形化界面的配置工具；最后是因为，OC在社区中普及程度不高，导致遇到问题很难找到现成的案例解决。这些原因使很多人放弃了折腾。但是历史的发展是一个螺旋上升的过程，未来将一定是OC的！（笑）\n\n### 黑苹果的初步安装\n\n讨论完了黑苹果的原理以及核心，下一步就该讲讲如何安装了！但是请大家注意，因为这篇文章主要是面向新手的，所以我只会介绍一些最最基本和通用的操作，目的是为了让大家先把黑苹果装上。而安装完成以后的那些各种优化的操作，包括配置Clover的配置文件，给系统打补丁等定制性比较强的内容，都**不会**在本文中涉及。博主可能在接下来一段很长的时间内陆陆续续更新一些系统优化的内容，敬请期待！闲话少说，我们开始吧！\n\n---\n\n#### 制作安装盘\n\n下面的操作均在Windows系统下进行。\n\n- 在[黑果小兵的部落阁](https://blog.daliansky.net)按照你的需要下载某个版本的系统镜像文件（后缀为`iso`）\n\n- 打开`WinMD5`软件，将下载完成的`iso`镜像文件拖入软件窗口，与网站上提供的`md5`值比对，校验`md5`值是否正确，如不正确，请重新下载（`md5`值相当于一个文件的身份证号码，它的值是唯一的，如果你下载下来的文件的`md5`值与官方提供的不一样，说明你下载的文件可能被修改过或者出错了）\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322163623208.png\" alt=\"校验MD5值\" style=\"zoom:50%;\" />\n\n- 找到一个容量为16GB或以上的**空U盘**，插入电脑\n\n- 以管理员身份打开`TransMac`软件，在窗口中左侧列表鼠标右击你的U盘，点击`Restore With Disk Image`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164230903.png\" alt=\"Restore with Disk Image\" style=\"zoom:50%;\" />\n\n- 点击后有可能会弹出下图所示的警告，是提示你的U盘可能含有已经挂载的卷，请确保你选择的U盘是正确的，然后点击`Yes`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164627959.png\" alt=\"请确保你选择的U盘正确！\" style=\"zoom:50%;\" />\n\n- 在弹出的窗口中选择你刚才下载好的`iso`文件，点击`OK`，这个时候会**格式化**你的U盘并把系统镜像烧录到你的U盘中，耐心等待安装盘制作完成吧，这一过程大约要持续20~30分钟\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164435201.png\" alt=\"选择镜像文件\" style=\"zoom:50%;\" />\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322165214199.png\" alt=\"等待时间，来杯卡布奇诺\" style=\"zoom:50%;\" />\n\n- 制作完成以后会弹出对话框，直接点击`OK`\n\n- 在此之后系统会提示你要格式化U盘，不必理会，直接点击`取消`\n\n---\n\n#### 替换安装盘中的EFI文件\n\n安装macOS时，我们运行的是在U盘上的`macOS安装程序`，这一步与运行macOS其实是差不多的。此时我们的U盘就相当于一个外置的系统盘，需要通过位于U盘上的Clover引导来启动`macOS安装程序`。\n\n为了可以正确引导操作系统，不同型号，甚至不同批次的电脑的EFI文件都是不太一样的。因为这些电脑之间的硬件有所区别，所以你需要确保你的电脑的EFI文件是与你的电脑硬件适配的。这个问题的原理我们已经在前面提到过了。\n\n但是这个软硬件适配的工作对于小白来说极度不友好，因为这需要一部分的数字电路，微型计算机原理，以及代码编写的知识。那有什么办法可以解决这个问题呢？答案就是：“拿来主义”。多亏了开源社区的发展，有许多人在网站上将他们已经完善的EFI文件分享给其他使用同一型号电脑的人。所以你现在要做的就是：找到与你的电脑型号对应的EFI文件，然后下载下来。\n\ndaliansky整理了一个清单，里面收集了大量不同机型的EFI文件，你可以在里面找找有没有自己电脑的型号：[Hackintosh黑苹果长期维护机型整理清单](https://blog.daliansky.net/Hackintosh-long-term-maintenance-model-checklist.html)。如果有的话，点击链接，然后将别人提供的这个EFI文件下载下来即可。\n\n这时有人会问了，如果没找到自己电脑的型号怎么办呢？不要气馁，你也可以尝试使用与你的电脑硬件配置类似的其他机型的EFI文件，或者使用daliansky提供的镜像中的通用EFI文件。\n\n按照daliansky的建议，在安装macOS时不必将镜像中的通用EFI文件替换为对应自己机型的EFI文件。但是我个人认为，如果你已经找到了与你的机型对应的EFI文件，那么在安装之前就将其更换，可能会在安装过程中避免一些错误的发生。\n\n下面就来介绍一下如何替换安装盘中的EFI文件吧！\n\n- 打开`DiskGenius`软件，在左侧列表中找到你已经制作好的安装盘，并单击选中\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322172930142.png\" alt=\"选择你已经制作好的安装盘\" style=\"zoom:50%;\" />\n\n- 依次双击右侧列表中的`ESP(0)`卷标，`EFI`文件夹，进入如下页面\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322173254704.png\" style=\"zoom:50%;\" />\n\n- 单击`CLOVER`文件夹，然后按`delete`键，弹出对话框后点击`删除`，将这个文件夹删除掉\n\n- 选中你从别人那儿拿来的EFI文件中的`CLOVER`文件夹，按下`Ctrl+C`后将窗口切回`DiskGenius`，然后再按下`Ctrl+V`将新的`CLOVER`文件夹复制进去，这样就完成了EFI文件的替换了\n\n---\n\n#### 给硬盘分区\n\n接下来我们要在电脑的硬盘上给即将安装的macOS分配一块足够大的空间。\n\n以下操作均在Windows下的`DiskGenius`软件中进行，且以我的U盘作为示例，操作方法与在电脑内置硬盘上的一样。在进行以下操作之前，请先备份你的文件。\n\n- 打开`DiskGenius`软件，在右侧列表中选中你的硬盘，然后在顶部查看你的硬盘空间分配情况，在顶部最左侧找到你的EFI分区，确保你的EFI分区的空间大于200MB，否则macOS将无法安装\n\n  ![](https://astrobear.top/resource/astroblog/content/image-20200322174413977.png)\n\n- 右键单击你的硬盘，选择`转换分区表类型为GUID`模式，否则macOS将无法安装，如果这个选项是灰色的而下一个选项可选，则无须转换\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322174834408.png\" alt=\"转换为GUID格式\" style=\"zoom:50%;\" />\n\n- 右键单击上方的蓝色容量条，点击`建立新分区`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175353564.png\" alt=\"建立新分区\" style=\"zoom:50%;\" />\n\n- 在弹出的窗口中调整你要分给macOS的容量大小，然后点击`开始`，接下来会有弹窗出现，请**严格遵守弹窗中给出的要求**操作，以免发生意外，然后点击`是`，开始分区\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175546512.png\" style=\"zoom:50%;\" />\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181027988.png\" alt=\"别怪我没提醒你!\" style=\"zoom:50%;\" />\n\n- 分区完成以后，右键单击顶部蓝色容量条，点击`删除当前分区`（因为macOS的磁盘格式为APFS，因此现在对其进行格式化没有意义）\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181359400.png\" style=\"zoom:50%;\" />\n\n---\n\n#### 设置BIOS\n\n前文已经说过，操作系统的启动顺序是`UEFI/BIOS->CLOVERX64.efi->OS`。因此，为了使我们的电脑可以启动安装盘上的`macOS安装程序`，我们还需要正确设置我们的BIOS。\n\n由于不同品牌的电脑使用不同的主板，所以BIOS的设置以及进行操作的键位也千差万别，这里仅以作者的电脑举例。由于作者电脑的BIOS十分垃圾，可供调整的选项寥寥无几，因此下面所给出的操作步骤中的设置配置要求是最基本的。如果你的电脑的BIOS功能足够强大且有很多其他的设置选项的话，请尽量弄懂这些选项的含义，并按照需要进行设置。\n\n- 按下开机按钮以后，迅速按`F10`进入BIOS设置\n\n- 按方向键进入`系统设置`菜单中的`启动选项`，请开启`传统模式`，禁用`安全启动模式`，启用`USB启动`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack11.JPG\" style=\"zoom:50%;\" />\n\n- 按`F10`保存设置，电脑将自动重启\n\n现在BIOS也已经设置完成。做完这些前期准备工作以后，接下来就要正式开始安装系统了！\n\n---\n\n#### 安装系统\n\n下面以macOS 10.15.3的安装过程为例。\n\n- 重启电脑，看到左下角的提示以后，按`esc`暂停启动\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack10.JPG\" alt=\"这是惠普的BIOS操作方法\" style=\"zoom:50%;\" />\n\n- 进入`启动菜单`，按`F9`进入`启动设备选项`\n\n- 在列出的一串引导中，选择`USB硬盘（UEFI）`的选项以启动安装盘中的引导，如果你使用的是daliansky提供的较新的系统镜像，安装盘中会出现两个引导，一个是微PE（后面会提到），另一个是Clover，我们需要启动的是Clover\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack12.JPG\" style=\"zoom:50%;\" />\n\n- 进入Clover界面以后，按照前文所说过的方法，开启啰嗦模式\n\n- 如果你需要使用镜像中的通用EFI文件，那么请执行下面的步骤，否则直接跳过：\n\n  - 在Clover主界面按`O`进入选项，光标移动到`Configs`后按回车进入进入该选项，这个选项是用来选择需要生效的Clover配置文件的\n\n    ![选择Configs(Credit: daliansky)](http://7.daliansky.net/10.15.3/2_Clover_Configs.png)\n\n  - 选择`config_Install`这个配置文件\n\n    ![选择config_Install(Credit: daliansky)](http://7.daliansky.net/10.15.3/3_Clover_Select_Installer.png)\n\n  - 按两次`esc`返回到Clover主界面\n\n- 在Clover主界面选择卷标`Boot macOS Install from Install macOS Catalina`，然后按下回车，开始引导安装程序\n\n  ![开始引导(Credit: daliansky)](http://7.daliansky.net/10.15.3/1_Clover_Installer.png)\n\n- 这个时候会出现如下图所示的安装日志，如果你很不幸地卡住了，那么你可以参考[macOS Catalina 10.15安装中常见的问题及解决方法](https://blog.daliansky.net/Common-problems-and-solutions-in-macOS-Catalina-10.15-installation.html)，或者附上你卡住的地方的照片和你的电脑配置，在各种交 流 群中询问大佬\n\n  ![这是一个群友的求助图片，出现的问题是卡ec了](https://astrobear.top/resource/astroblog/content/hack2.jpg)\n\n- 如果没有卡住，你的日志会消失，然后出现苹果的logo和进度条\n\n  ![白苹果(Credit: daliansky)](http://7.daliansky.net/Air13/1.png)\n\n- 等待一段时间以后，会出现语言选择界面，请选择中文并点击`继续`，如果有装逼需求或者想练习外语，你也可以选择其他语言\n\n  ![还是选择中文吧(Credit: daliansky)](http://7.daliansky.net/Air13/4.png)\n\n- 选择`磁盘工具`并点击`继续`\n\n  ![实用工具(Credit: daliansky)](http://7.daliansky.net/10.15.3/3.png)\n\n- 进入磁盘工具以后，在左上角右键点击你的磁盘，并选择`显示所有设备`，并找到你之前已经准备好安装macOS的分区\n\n  ![选择显示所有设备](http://7.daliansky.net/10.15.3/4.png)\n\n- 选中你之前已经准备好安装macOS的分区，然后点击`抹掉`，在弹出的窗口中，你需要给你的分区起一个名字，并将格式设置成`APFS`，然后将方案设置为`GUID分区图`，再点击`抹掉`，这一步会将你电脑上的硬盘分区格式化\n\n  ![抹掉磁盘(Credit: daliansky)](http://7.daliansky.net/10.15.3/6.png)\n\n- 操作完成以后，点击左上方`磁盘工具`，在弹出的选项中选择`退出磁盘工具`并返回到安装界面\n\n  ![退出磁盘工具(Credit: daliansky)](http://7.daliansky.net/10.15.3/8.png)\n\n- 在主界面选择`安装macOS`并点击`继续`，再闭着眼睛同意条款\n\n- 在下图所示的界面中选择你要安装的磁盘分区，然后点击`安装`，接下来安装程序会将安装文件复制到你的分区中，这个过程会持续几分钟，待复制完成以后，电脑会重新启动\n\n  ![选择你准备好的那个磁盘分区(Credit: daliansky)](http://7.daliansky.net/10.15.3/12.png)\n\n- 重启之后，按照本节一开始所述方法进入Clover，这时候你会发现，Clover主界面会多出来几个卷标，从现在开始直到安装完成，请都选择`Boot macOS Install form xxx（你给你的macOS分区起的名字）`卷标启动，在安装过程中请耐心等待，无论你做了什么奇怪的事情让你增加了什么奇怪的知识，都不要在出现白苹果logo的时候乱动鼠标或者键盘\n\n- 经过两到三次重启以后，你会发现`Boot macOS Install form xxx`的卷标消失了，新出现了`Boot macOS form xxx`的卷标，选中它，然后进入，再对着白苹果等待几分钟，难得的休息时间马上就要结束了\n\n- 进度条走完，出现设置向导，接下来会让你设置你的国家和地区，语言和输入法，按照你的需要设置即可，然后会进入`数据和隐私`界面，点击`继续`\n\n  ![选择国家和地区(Credit: daliansky)](http://7.daliansky.net/Air13/22.png)\n\n- 接下来会问你是否需要将macOS从你的备份中恢复，黑苹果玩家一无所有，选择`现在不传输任何信息`并点击`继续`\n\n  ![没有备份，无需恢复(Credit: daliansky)](http://7.daliansky.net/Air13/25.png)\n\n- 接下来要你使用Apple ID登陆，这里先跳过\n\n  ![不要登陆！登陆了也没用(Credit: daliansky)](http://7.daliansky.net/10.15.3/15.png)\n\n- 还是闭着眼接受条款\n\n  ![接受就完事了(Credit: daliansky)](http://7.daliansky.net/10.15.3/16.png)\n\n- 接下来你需要创建一个电脑用户，这是一个管理员帐户，请注意，在这里设置了用户名以后，如果未来要更改的话会极为麻烦，建议想清楚了再继续下一步\n\n  ![不要起什么奇奇怪怪的名字(Credit: daliansky)](http://7.daliansky.net/Air13/30.png)\n\n- 进入`快捷设置`页面，点击`继续`，然后会进入`分析`页面，取消勾选`与App开发共享崩溃与使用数据`，黑苹果这种东西自己偷摸着用就行\n\n  ![不要共享(Credit: daliansky)](http://7.daliansky.net/10.15.3/17.png)\n\n- 接下来还会要你设置屏幕使用时间，Siri，以及外观，这些选项按照你的需要设置就行，一路`继续`下去，直到出现`正在设置你的Mac`页面，请稍等片刻\n\n  ![即将完成！(Credit: daliansky)](http://7.daliansky.net/Air13/34.png)\n\n- 终于进入了桌面，这时macOS的基本安装已经完成了！先庆祝一下，折腾的事情还在后头呢（虽然这篇文章不会写吧......）\n\n  ![老二次元了doge](https://astrobear.top/resource/astroblog/content/hack9.png)\n\n---\n\n#### 将引导添加到硬盘并调整顺序\n\n现在，macOS已经成功安装到我们电脑的硬盘上了，但是我们电脑硬盘上的macOS还是通过U盘里的Clover引导的。这就意味着，如果拔掉U盘，我们将不能够启动macOS。所以我们需要将U盘引导区中的Clover文件夹复制到硬盘引导区的EFI文件夹中，以实现脱离U盘启动。这一步的操作与前文`替换安装盘中的EFI文件`这一小节的操作基本是一致的，需要你在Windows系统下使用`DiskGenius`操作，这里就不再赘述了。\n\n如果现在重启电脑，你还是会发现直接进入了Windows的引导而不是Clover。这是因为除了Clover之外，电脑当然还有许多其他的引导项，这些引导项按顺序排列在启动序列之中。现在我们只是把Clover的文件夹放入了硬盘的引导区中，但是还没有把Clover添加到启动序列之中。电脑不知道自己居然还可以用Clover引导macOS，只能继续用老一套方法直接引导Windows启动了。那么下面我们就要告诉电脑，让它知道自己可以使用Clover引导操作系统。下面的操作都是在Windows下进行的。\n\n- 打开`EasyUEFI`软件，你可以看到所有的引导项之中没有Clover，点击红框中按钮创建新的引导项\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405233601042.png\" alt=\"创建引导项\" style=\"zoom:50%;\" />\n\n- 在弹出的窗口中，`类型`选择`Linux或者其它操作系统`，`描述`可以随便填写，这里使用的是`CLOVER`，目标分区选择`磁盘0`的ESP分区（唯一可选的那一个）\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234307270.png\" style=\"zoom:50%;\" />\n\n- 在`文件路径`一行中，点击`浏览`，在弹出的窗口中显示了一个硬盘的图标，这个就是你电脑上硬盘的ESP分区了，点击它左侧的加号将其展开，在EFI文件夹中找到`CLOVERX64.efi`，这个就是Clover的引导文件，选中后点击`确定`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234725001.png\" style=\"zoom:50%;\" />\n\n- 回到原先的界面之后，点击`确定`，可以发现Clover已经添加到启动序列中了\n\n- 到这里还没结束，因为Clover被上面众多引导项压着，启动的时候怎么也轮不到它，因此我们点击红框中的按钮，将Clover移到启动序列的第一位，使电脑开机的时候默认使用Clover引导操作系统\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405235126649.png\" style=\"zoom:50%;\" />\n\n现在再重启电脑，不要按`esc`暂停启动，电脑会默认使用Clover进行引导。选择macOS分卷，按回车进入。如果成功启动了，那么你便可以重新设置你的BIOS，将`传统模式`关闭了（但不要开启`安全启动模式`）。\n\n到这里，macOS的前期安装已经正式完成！夸赞一波自己吧！\n\n---\n\n#### 黑苹果单系统安装\n\n按照上面所说的步骤，如果不出问题，你便在电脑上成功安装了Windows和macOS双系统。如果你只需要macOS的单系统，操作步骤与上面所说有些许不同，但是绝大部分步骤是一样的，唯一的区别在于`给磁盘分区`和`将引导添加到硬盘并调整顺序`这两部步。如果你在制作安装盘的时候，下载的是daliansky提供的较新系统版本的镜像，或者你在制作完系统启动U盘以后，在`此电脑`中可以看到有诸如`微PE`字样的磁盘，那么下面步骤中的前三步可以省略掉。大致的操作方法如下：\n\n- 于[官网](http://www.wepe.com.cn/download.html)下载`微PE工具箱V2.0 64位版本`\n- 打开软件，将微PE工具安装到你的已经制作好的macOS安装盘中\n- 将`DiskGenius`和`UEFIManager`拷贝到微PE的文件盘中（微PE系统中本身自带非专业版的`DiskGenius`，某些功能有缺失）\n- 设置BIOS\n- 重启，在BIOS中使用安装盘中微PE的引导启动\n- 进入系统后你可以发现界面与Windows10几乎一样，运行你存放在U盘中的`DiskGenius`，删除你硬盘中Windows使用的分区，并删除硬盘EFI分区的Windows文件夹\n- 将硬盘分区表类型转换为`GUID`格式\n- 按照你的需要以及前文所述要求，重新分配你的硬盘分区，并将他们格式化\n- 接下来就是安装系统了，如果一切顺利进入了macOS的桌面，你可以继续下面的步骤\n- 重启，使用安装盘中微PE的引导启动\n- 运行`DiskGenius`，将安装盘EFI文件夹中`CLOVER`文件夹复制到电脑硬盘的EFI文件夹中\n- 运行`UEFIManager`，然后参考上文所说的方法，添加并调整你的引导项\n- 如果没有问题，关闭BIOS的`传统模式`启动\n- 大功告成！\n\n### 安装完成后可能出现的问题\n\n完成macOS的安装并不代表你的电脑就已经是可堪重用的生产力/娱乐工具了。绝大多数情况下，刚刚完成安装的黑苹果还会存在着各种各样的问题。即使你使用的是完全对应你的电脑型号的EFI文件，依然有大概率会出现这些问题。**黑苹果的折腾之处不是安装macOS的过程，而是完全解决这些问题的过程。**所以这就是为什么我建议大家不要在安装的最后几步（包括完成安装以后）登陆你的苹果服务，因为你的电脑存在的一些问题会导致苹果服务登不上去，而且折腾的过程也有可能把你的Apple ID中的信息搞乱，就像下图一样。\n\n<img src=\"https://astrobear.top/resource/astroblog/content/hack13.JPG\" alt=\"瞬间富有\" style=\"zoom:50%;\" />\n\n安装完成以后，大家可以检查一下自己的电脑有没有出现下面列出的这些问题。下面的检查大部分都在macOS的设置中完成，还有一些直接观察即可。在每个问题的末尾都会给大家提供一些解决问题的思考方向，但并不会提供具体的解决办法。另外还附上了无故障发生的效果图供大家参考。\n\n- 网络与蓝牙的问题：下面的这些问题与你的**网卡的型号或者驱动**有关\n\n  - 打开`系统偏好设置-网络`选项，里面没有有Wi-Fi选项，即使有也打不开Wi-Fi\n  - 打开`系统偏好设置-蓝牙`选项，无法开启蓝牙\n  - 无法使用随航\n  - 无法使用Siri，FaceTime，iMessage\n\n  ![](https://astrobear.top/resource/astroblog/content/hack14.png)\n\n  ![](https://astrobear.top/resource/astroblog/content/hack15.png)\n\n- 声音的问题：这个问题的表现形式很多，出现这些问题是因为**声卡没有驱动**\n\n  - 打开系统`系统偏好设置-声音`选项，无法调节音量\n  - 勾选`当更改音量时播放反馈`再调节音量，电脑没有声音\n  - 麦克风没有输入电平的变化\n  - 使用快捷键调节音量，喇叭图标下出现禁行标志\n\n  ![](https://astrobear.top/resource/astroblog/content/hack16.png)\n\n- 触控板的问题：触控板根本没有反应，或者在`系统偏好设置-触控板`选项中某些手势无法使用，或者某些功能不显示，这个问题与你的**触控板驱动**有关\n\n  ![](https://astrobear.top/resource/astroblog/content/hack17.png)\n\n- 显示的问题：这个问题也涉及到很多方面，注意**下面给出的图片是错误示例，不是正确的打开方式**\n\n  - 色偏严重：这个问题与你的**显示器描述文件和EDID**有关\n\n    ![严重的色偏](https://astrobear.top/resource/astroblog/content/hack18.JPG)\n\n  - 文字显示过小，图标与文字比例失调：这个问题与你的**EDID以及是否开启了HiDPI**有关\n\n    ![失调的比例](https://astrobear.top/resource/astroblog/content/hack19.png)\n\n  - 出现颜色断层：这个问题与你的**EDID和显卡缓冲帧**有关\n\n    <img src=\"https://astrobear.top/resource/astroblog/content/hack20.jpg\" alt=\"断层的色彩\" style=\"zoom:50%;\" />\n    \n  - 无法调节亮度：在`系统偏好设置-显示器`选项中没有亮度调节条，键盘上的亮度调节快捷键也没有反应，这个问题可能与你的**亮度调节驱动或者系统补丁**有关\n\n- 电源管理的问题：这个问题的表现形式很多，导致这个问题产生的原因也很多\n\n  - 节能管理未加载：在`系统偏好设置-节能`选项中没有将4个（台式机为5个）选项全部加载，出现这个问题是因为你**没有加载macOS原生的电源管理**\n\n    ![](https://astrobear.top/resource/astroblog/content/hack21.png)\n\n  - 睡眠失灵：睡眠秒醒或者睡眠自动关机/死机/重启，这个问题与你的**电源管理或者USB驱动**有关\n\n- USB总线的问题：USB接口部分或者全部失灵，打开`Photo Booth`后摄像头无画面，这个问题与你的**USB驱动**有关（话说回来`Photo Booth`还是蛮有意思的😂）\n\n- 独立显卡无法驱动：黑苹果下只有部分独立显卡可以驱动，如果你的独显**有独立输出并且满足特定型号要求**的话可以尝试将其驱动，否则你就需要屏蔽独显，使用集显了，这里不展开叙述\n\n另外，你也可以在`左上角苹果图标-关于本机-系统报告`中直接查看你电脑的硬件情况。通过检查各个硬件的驱动情况和相关数据，一样可以判断你的电脑是否会有上面的问题。\n\n上面给大家介绍的都是一些典型的问题，你也有可能遇到其他的疑难杂症。希望大家面对问题不要望而却步，尽情享受折腾的过程吧！\n\n(～￣▽￣)～\n\n### 黑苹果相关资源推荐\n\n折腾黑苹果，宜广集信息，多多提问；忌盲目瞎搞，重复建设。\n\n#### 黑苹果相关优秀网站\n\n- [黑果小兵的部落阁](https://blog.daliansky.net)：也就是daliansky——国内黑苹果领军人物的博客，他的网站会非常及时地更新系统镜像并不定时地提供一些精品教程\n- [IT密码](https://www.itpwd.com)：网站上面的资源非常丰富，从系统镜像到软件资源再到方法技巧一应俱全，博主也是非常牛啤的\n- [OC简体中文参考手册](https://oc.skk.moe)：由业界大佬合力完成，仍在维护中，学习OC必备\n- [GitHub](https://github.com)：这个不用多说了，绝大部分黑苹果软件和驱动的来源，全球最大同性交友网站🐶，神奇的地方\n- [远景论坛](http://www.pcbeta.com)：国内最主要的黑苹果交流论坛，注册需要邀请码\n- [tonymacx86](https://www.tonymacx86.com)：国外知名的黑苹果交流论坛，资源丰富，需要一定的英语能力\n- [insanelymac](https://www.insanelymac.com/forum/)：与tonymacx86类似的论坛\n\n#### 黑苹果软件、驱动资源\n\n下面只列出了一些至关重要的驱动和软件，其他功能的还有很多，这里就不一一列出了。\n\n- [Clover Configurator](https://mackie100projects.altervista.org/download-clover-configurator/)：Clover的图形化配置软件\n- [Hackintool](https://github.com/headkaze/Hackintool/releases)：黑苹果完善必备工具\n- [Clover](https://github.com/CloverHackyColor/CloverBootloader/releases)：在这里可以找到已经编译好的Clover\n- [Lilu.kext](https://github.com/acidanthera/Lilu/releases)：众多常用驱动的依赖\n- [AppleALC.kext](https://github.com/acidanthera/AppleALC/releases)：常用声卡驱动\n- [VoodooPS2Controller.kext](https://github.com/acidanthera/VoodooPS2/releases)：PS2总线输入设备（鼠标，键盘，触控板）的驱动，此外对于I2C总线的输入设备还有VoodooI2C.kext\n- [VoodooInput.kext](https://github.com/acidanthera/VoodooInput/releases)：VoodooPS2Controller的依赖\n- [WhateverGreen.kext](https://github.com/acidanthera/WhateverGreen/releases)：用于驱动Intel集成显卡\n- [FakeSMC.kext](https://bitbucket.org/RehabMan/os-x-fakesmc-kozlek/downloads/)：必备驱动，用于仿冒SMC设备，欺骗macOS，让它以为我们的电脑就是Mac\n\n\n\n### 声明与致谢\n\n黑苹果社区的健康需要大家共同维护，恳请新人们注意以下几点：\n\n- 不要把社区的成果（如各种机型的EFI，开源软件等）拿来作商业用途\n- 不要购买淘宝上面的EFI！所有现存的EFI都可以在网上免费获得！请不要支持那些兜售EFI的无良商家，他们也是从网上下载的\n- 不建议去淘宝上购买安装黑苹果的服务，出了问题到最后还是要你自己解决\n- 不建议把自己的折腾成果在网络上有偿提供，这样并不利于社区的发展\n- 网友没有义务去无偿地帮你解决问题，另外也请善用搜索引擎\n\n黑苹果一开始是极客的产物，是反叛精神的象征。令人意料不到的是，现在它居然可以为我们普通人所用。而从极客到大众的过渡，黑苹果的开源社区对此作出了极大贡献。对那些对社区做出过极大贡献的极客和工程师们，对社区建设贡献出自己的一份力量、努力维护社区健康发展的成员，我向你们表达最诚挚的感谢。没有社区，就没有黑苹果的今天。作为从社区中获益的普通成员，也应该通过自己的努力，以自己的方式去回馈这个社区，帮助它更好地发展。\n\n博主在此谨向你们表达我的感谢：[RehabMan](https://github.com/RehabMan)，[Acidanthera](https://github.com/acidanthera)，[黑果小兵](https://blog.daliansky.net)，[SlientSliver](https://github.com/SilentSliver)，[IT密码](https://www.itpwd.com)，以及其他给予过我帮助的网友或开发者们😘。\n\n\n\n附：[软件度盘链接](https://pan.baidu.com/s/17yVMb2FQyzfK2sAYbHuZnw) ，密码：3lkx。\n\n\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n在这篇文章写成之后不久，Apple推出了M1芯片以及macOS Big Sur。这对黑苹果来说无疑是一个重大打击。虽然macOS肯定还会对使用Intel CPU的电脑继续提供几年的支持，但是如果苹果未来不再推出使用Intel CPU的电脑，那么黑苹果的未来恐怕不容乐观。另外，黑苹果社区也出现了比较大的变化。随着更先进更安全更简单的Open Core逐渐成熟，其使用者也越来越多。虽然Clover仍然保留了对最新的macOS的支持，但是其已然落后。这也就是说，在这篇文章写完之后，其内容已经过时了（悲，但如果是安装Big Sur以下版本的macOS，这篇文章还是有一定的指导意义的）。最后，出于时间和精力的考虑，博主已经不打算再折腾黑苹果了。感谢黑苹果这两年来的陪伴。\n</div>\n</article>\n","source":"_posts/Introduction_to_hackintosh.md","raw":"---\ntitle: 黑苹果入门完全指南\ndate: 2020-2-14 20:36:00\ncategories: \n\t- [Hackintosh]\n\t#- [cate2]\n\t#...\ntags: \n\t- macOS\n\t- Hackintosh\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg\n\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/hpenvy13hackintosh.jpeg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 震惊！黑苹果的背后居然有着这些不为人知的秘密！\n\n#You can begin to input your article below now.\n\n---\n\n### 关于黑苹果\n\n欢迎步入黑苹果的世界！众所周知，Mac因其独特的macOS系统在众多Windows电脑中独树一帜。macOS具有许多与Windows不同的特性和优点（当然，也有不足），而且有些软件在macOS上的优化会比Windows更好或者只支持macOS平台。这就是为什么Mac在市场上一直有着广泛的需求的根本原因——即macOS的独特性。由于苹果的封闭性策略，macOS在正常情况下只能安装在Mac上。而黑苹果的出现，给广大对macOS有需求的人们提供了一个新的选择——你再也不需要为了一个系统去购买在同等硬件或性能条件下价格更为昂贵的电脑了。\n\n黑苹果，意思就是安装有macOS的，可以正常工作的非Mac的电脑，也可以指为非Mac的电脑安装macOS的行为，亦可以指安装在非Mac电脑上的macOS。对于这个词的确切定义还是模糊不清的，不过这不是关键所在。与黑苹果相对，白苹果的含义就非常明显了，也就是苹果的Mac或者安装在Mac上的macOS。\n\n黑苹果的原理就是通过对电脑主板的破解和对系统的欺骗，让macOS以为这是一台Mac，再通过一系列驱动和补丁使得这台电脑可以在macOS下正常运行。需要注意的是：\n\n<font size=4>**将macOS安装在非Mac的电脑上是违反苹果公司的法律条款的！**</font>\n\n所以安装黑苹果是存在一定的法律风险的，这有可能（但是非常非常罕见）导致你的AppleID被锁死。但是一般情况下，苹果公司对这种行为都是睁一只眼闭一只眼。只是随着黑苹果数量上的日益增长，不知道什么时候会引起苹果公司的重视并对此采取措施。而在另一方面，如果你使用黑苹果来牟利的话，性质就完全不同了，你有可能会受到法律的制裁。\n\n由于macOS从一开始就不被允许安装在非Mac的电脑上，因此安装黑苹果绝对不是一件容易的事情，它涉及到对主板的破解，对硬件的驱动，对系统的欺骗，同时也会产生很多奇奇怪怪的bug。黑苹果有很多缺点：\n\n- 不完美的黑苹果相对于白苹果不那么稳定\n- 黑苹果在硬件层面上的缺失导致很多功能无法实现，如Touch Bar，Touch ID，力度触控板等\n- 安装黑苹果仍需要满足一定的硬件条件，某些型号的硬件在黑苹果下是无法驱动的\n- 安装黑苹果费时费力，相当折腾\n\n既然黑苹果有那么多缺点，并且还是非法的行为，那为什么还有那么多人在使用黑苹果并且人数还在日益增长呢？因为黑苹果与同样安装有macOS的电脑相比，还是有其优点的：\n\n- 完美的黑苹果在使用体验上基本不输给Mac\n\n- 黑苹果在同等硬件或性能条件下比起Mac便宜许多\n- 黑苹果的定制性和可扩展性在某些方面比Mac强大许多\n\n从黑苹果的优点来看，再结合实际情况，我们可以发现使用黑苹果的人群可以分为以下几类：\n\n- 对macOS有刚需，但是又不想花钱/没钱买Mac的，如某些影视、音乐工作者\n- 对macOS有刚需，但是受限于苹果封闭的生态，只能通过黑苹果的高可扩展性来满足自己对硬件的需求的特定行业从业者\n- 对macOS没有刚需，具有反叛精神的极客，专门研究操作系统和硬件的工程师，通常这类人也有白苹果\n- 对macOS没有刚需，只是想要体验macOS或苹果完整生态却又不想花钱/没钱购买Mac的人\n\n而博主作为一个穷学生，就是属于最后一类的人😂。我折腾黑苹果已经有1年时间，现在自己在用的电脑是惠普的`Envy-13 ad024TU`，装有Windows和macOS两个系统。博主的黑苹果已经基本完美，在使用体验上已经与白苹果相差无几。关于我的黑苹果的更多信息，可以参考我的[GitHub仓库](https://github.com/Astrobr/HackintoshForEnvy13-ad0xx)，或者我的[另一篇博客](https://astrobear.top/2020/02/14/HP_Envy-13_ad024TU_Hackintosh/)，在那篇博客里我主要总结了给自己的电脑安装黑苹果时踩过的一些坑。而这篇文章主要是针对笔记本电脑，让大家对黑苹果有一个初步的了解。看完这篇文章，你就基本入门黑苹果了。\n\n### 黑苹果的原理以及核心\n\n#### 黑苹果的原理\n\n在讨论这个问题以前，我们先要了解一下电脑是怎么启动的。\n\n首先，在你按下开机键以后，电脑上电，各硬件进入了待命状态。CPU（Central Processing Unit，中央处理器）启动以后，按照其在设计时就固定好的功能送出了第一条指令，这一条指令将会使BIOS（Basic Input/Output System，基本输入输出系统）芯片中装载的程序开始执行。BIOS程序可以实现很多功能，比如系统自检，提供中断服务等。但是它最主要的功能则是将存放于硬盘引导区的操作系统引导程序（Boot loader，下文简称引导）装载入内存，再通过引导将操作系统装载进内存。\n\n当然，现在市面上新发售的电脑大部分都已经采用了一种更新的方式来装载引导，也就是所谓的UEFI（Unified Extensible Firmware Interface，统一可扩部件接口）。UEFI作为一种较新的方案，它和BIOS的区别主要是在可扩展性方面。但是除了一些细微的差别，它在整个启动的流程上与BIOS基本相同，且最终目的都是将引导装载进内存当中。另外在开发者圈子中，BIOS和UEFI也常常被混为一谈。因此尽管现在的主流是采用更先进的UEFI，但在下面的叙述中我还是会使用BIOS的概念。这并不会给理解带来困难，只是你们需要知道这两者有些许微妙的区别即可。\n\n也许有人会问，为什么不使用BIOS直接将操作系统装载进内存呢？首先，如果有多个操作系统，那么不同的操作系统的装载过程会有所不同。如果要让BIOS适配不同的操作系统，那么会导致它的体积过于庞大，系统过于复杂，不利于它的的稳定。其次就是，BIOS是固定在BIOS芯片中的，不方便修改。这也导致了我们难以让BIOS对不同的操作系统做适配。因此，我们需要引导来完成操作系统加载的工作。\n\n具体而言，引导需要完成的工作主要有以下几点：\n\n- 初始化其他硬件设备，为系统提供可访问的表和服务\n- 为操作系统分配内存空间，再将它加载进内存当中\n- 为高级计算机程序语言提供执行环境\n- 将控制权移交给操作系统\n\n在此之后，系统的完整的启动过程就结束了，操作系统接管了整个电脑。简而言之，电脑的启动过程可以概括为：`BIOS->Bootloder->OS(操作系统)`。\n\n回到黑苹果上来。我们想要在一款非Mac的电脑上运行macOS，与我们在电脑上运行Windows的最大区别在哪儿？当然是操作系统不同啊！由于macOS与Windows是两个完全不同的操作系统，因此他们启动和加载的过程也完全不同。所以我们肯定不可以用启动Windows的那一套方法去启动macOS，而必须要有专门的适应macOS的一套启动方法（程序）。\n\n我们想要将macOS加载到我们的内存当中，就要对当前我们的启动程序进行修改和适配。回顾上文所说的电脑的启动过程我们可以发现，BIOS是固定在芯片中的，不易修改。那么我们可以操作的部分就只有引导了。所以我们要找到合适的引导程序，使其可以将macOS正确地装载进内存，并给它提供正确的服务，让它可以与硬件正常交流，最终使它正常运行。\n\n通过上面的一番讲解，我们可以发现，安装黑苹果的核心就是引导。而实际上，折腾黑苹果折腾的也主要就是引导。而由于白苹果的硬件，BIOS，和引导都是针对macOS开发的，所以当然不要任何的折腾，开箱即用就行（废话......）。\n\n目前主流的可以用于在非Mac的电脑上启动macOS的引导主要有两个，分别是`Clover`和`OpenCore`（下文简称OC）。由于OC是新开发的引导，目前还在公测阶段，而且其在社区普及率远远不如Clover，所以下面将主要讲解Clover，而对于OC只作非常简单的介绍。\n\n#### Clover\n\n> 启动器的名字`Clover`由一位创建者kabyl命名。他发现了四叶草和Mac键盘上Commmand键（⌘）的相似之处，由此起了Clover这个名字。四叶草是三叶草的稀有变种。根据西方传统，发现者四叶草意味的是好运，尤其是偶然发现的，更是祥瑞之兆。另外，第一片叶子代表信仰，第二片叶子代表希望，第三片叶子代表爱情，第四片叶子代表运气。——摘自维基百科\n\nClover是一个操作系统引导程序，可以通过新老两种方式进行启动，也就是BIOS方式和UEFI方式。目前主流的操作系统都已经是通过UEFI方式启动的了，如macOS，Windows 7/8/10 (64-bit)，Linux。\n\n所有的引导都是放在电脑硬盘开头部分的引导区（ESP分区）的EFI文件夹中，Clover也不例外。当然，EFI文件中还存放着Windows，Linux，或者其他操作系统的引导。下面就来看看Clover的文件结构吧。\n\n![重要的文件夹和其功能在图中注明](https://astrobear.top/resource/astroblog/content/hack1.png)\n\n在Clover下使用UEFI方式启动的流程是这样的：`UEFI->CLOVERX64.efi->OS`。\n\n下面我将主要根据在实际操作中用到的一些功能来介绍Clover。\n\n- 进入操作系统\n\n  这一步非常简单，开机之后用方向键选择你需要进入的操作系统的卷标，按下回车即可。\n\n  ![图中出现了三种不同系统的卷标(Credit: daliansky)](http://7.daliansky.net/1-main.png)\n\n- 显示帮助\n\n  按下`F1`键会出现帮助信息。\n\n  ![帮助信息(Credit: daliansky)](http://7.daliansky.net/Help_F11.png)\n\n- 更新Clover\n\n  请在[这里](https://github.com/Dids/clover-builder/releases)下载最新版本的`CLOVERX64.efi`并使用它替换掉你的EFI文件夹中的Clover文件夹中的同名文件。\n\n- 开启啰嗦模式启动\n\n  首先我要介绍一下什么是啰嗦模式。一般来说，我们在启动系统的时候只能看到一个进度条或者旋转的表示加载中的图案。而啰嗦模式就是将系统启动时各种详细参数和日志以及报错消息全部显示出来的模式，如下图所示。如果发生了操作系统启动异常/失败的情况，通过开启啰嗦模式，我们可以快速定位到出错的位置。\n\n  开启啰嗦模式的方法很简单。首先选择你想要进入的系统的图标，按空格即可进入下图所示的页面，然后勾选图示选项，再选择`Boot macOS with selected options`启动。\n\n  ![开启啰嗦模式(Credit: daliansky)](http://7.daliansky.net/space-selected.png)\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack2.jpg\" alt=\"开启啰嗦模式的效果\" />\n\n- 显示隐藏的卷标\n\n  有的时候在Clover的启动页面中会出现很多以不同方式启动同一系统的卷标（Volume，可以理解为入口），我们可以通过修改Clover的配置文件来隐藏这些卷标，但是有的时候你又需要它们显示出来（比如你要通过进入`Recovery`卷标来关闭macOS的系统完整性保护的时候）。这个时候我们不必重新修改配置文件，只需要在Clover的主界面按下`F3`，即可将隐藏的卷标显示出来。\n\n  关于怎么隐藏卷标，我将在下面介绍。\n\n- 提取DSDT\n\n  DSDT的全称为 Differentiated System Description Table，它是一个描述系统硬件不同信息的表，通过查阅这个表中的信息可以知道你的电脑有什么硬件，它们的名称是什么。知道这些信息有利于我们理顺硬件之间的关系，再通过修改补丁更正硬件信息，以优化操作系统的工作状况。\n\n  在Clover主界面下按`F4`即可将你的DSDT信息保存到`EFI/CLOVER/ACPI/origin/`文件夹中。请注意，DSDT是由多个文件组成的。\n\n- 选择你想要启用/禁用的驱动程序\n\n  通过Clover加载的驱动程序保存在`EFI/CLOVER/kexts/Other`中，这些驱动程序是针对macOS生效的。在上面所说的那个文件夹中包含了很多不同的驱动文件，有些驱动文件之间会产生冲突，而有些驱动文件又是完全没有必要存在的。为了管理和精简你的驱动程序，你可以在Clover中设置你想要禁用的驱动程序以排查各种驱动的工作状况。\n\n  首先你要选择macOS的图标，按下空格键。然后在新的页面中将光标移动到`Block injected kexts`，按下回车后进入该选项。再在新的页面中选择`Other`选项，这个时候你就可以看到你的驱动程序了。勾选你想要禁用的驱动程序以后，按`Esc`回到主页面，再直接回车进入macOS。\n\n  ![选择你想要禁用的驱动程序(Credit: daliansky)](http://7.daliansky.net/BIKChoose.png)\n\n  请注意，你的这一设置只对这一次启动有效，在之后的启动中将不会保留。\n\n- 设置Clover（修改`config.plist`）\n\n  有多种方法进行设置。\n\n  - 你可以在开机以后的Clover主界面下按下按键`O`进入设置页面，然后你就可以选择不同的选项开始修改你的配置文件了，不过一般情况下我们不会使用这种`抽象`的方式来修改\n\n    ![Clover的设置页面(Credit: daliansky)](http://7.daliansky.net/options.png)\n\n  - 使用Clover Configurator来修改\n\n    Clover Configurator是一款运行在macOS下的应用程序，专门用来修改Clover的配置文件。它具有友好的图形化界面，每个选项都有比较详细的功能说明，操作起来比在启动时修改要轻松得多。Clover Configurator的下载链接放在文末。\n\n    在设置以前，你需要在Clover Configurator的`挂载分区`选项卡中挂载你ESP分区（通常情况下这个分区都是隐藏的）。然后在你的Clover文件夹下使用Clover Configurator打开`config.plist`文件，进行修改。修改完成以后，请点击左下角的保存图标（图中以红框标明）。\n\n    ![Clover Configurator的设置界面](https://astrobear.top/resource/astroblog/content/hack3.png)\n\n    ![Clover Configurator的设置界面](https://astrobear.top/resource/astroblog/content/hack4.png)\n\n  - 你还可以使用普通的文本文档编辑器（如Xcode或者Visual Studio Code）打开`config.plist`对其进行编辑，但是这个方法依旧比较`抽象`，不推荐新手或者代码小白这样操作\n\n    ![在Visual Studio Code中打开的Clover配置文件](https://astrobear.top/resource/astroblog/content/hack5.png)\n\n- 增加/删除/修改/查找驱动程序\n\n  在启动以后，你可以使用Clover Configurator挂载EFI分区，然后直接使用访达在驱动文件夹中以可视化的方式管理你的驱动程序。\n\n  当然，你也可以使用`Disk Genius`在Windows下管理你的驱动程序。在下一章节中有关于`Disk Genius`的更多介绍。\n\n- 更换Clover的主题\n\n  Clover提供了很多自定义功能，你可以选择自己喜欢的Clover开机主题。Clover的主题存放在`EFI/CLOVER/themes/`文件夹中，你可以下载你喜欢的主题文件夹并将其保存到上述路径中。然后，你需要在Clover Configurator中的`引导界面`选项卡中填写你想要设置的主题文件夹的名字（如下图）并保存。\n\n  ![修改Clover主题](https://astrobear.top/resource/astroblog/content/hack6.png)\n\n  作者目前用的是一款名为`Simple`的主题，可以点击[此处](https://github.com/burpsuite/clover_theme)下载。在GitHub上还有很多不同的Clover主题可供选择。\n\n  ![作者正在使用的Simple主题](https://astrobear.top/resource/astroblog/content/hack7.png)\n\n- 隐藏你不需要的卷标\n\n  如果你的Clover启动界面有很多引导同一系统的卷标，你可以将他们隐藏起来。具体方法是，Clover Configurator中的`引导界面`选项卡中的`隐藏卷`一栏中填写你想要隐藏的卷标的名称，然后保存文件。\n\n  ![隐藏你不需要的卷标](https://astrobear.top/resource/astroblog/content/hack8.png)\n\nClover的主要功能就介绍到这里了。由于本文是纯粹的新手向，在这里就不介绍如何配置`config.plist`了。一般来说，只要你能够找到完全对应你机型的EFI文件，基本上就不需要再重新配置Clover了。下面，我们再简单介绍一下新时代的引导工具：OpenCore。\n\n#### OpenCore\n\nOpenCore是一个着眼于未来的先进的开源引导工具，他支持多种主流操作系统的引导。OC的历史使命就是有朝一日代替Clover，成为主流。OC主要有以下几个优势：\n\n- 从 2019 年 9 月以后, Acidanthera（神级大佬，黑苹果现有的大部分驱动目前都是他在开发管理）开发的内核驱动 （Lilu, AppleALC 等）将**不再会**在 Clover 上做兼容性测试（虽然这不能算是优势，但是很关键好吗！）\n- OC的安全性更好，对文件保险箱（FileVault）有更强大的支持\n- OC使用更先进的方法注入第三方内核驱动（也就是你`EFI/CLOVER/kexts/Other`里面的那些`kext`文件）\n- OC在启动体验上会更加接近白苹果\n\n当然，为什么现在OC还未能成为主流，首先是因为它还处于开发阶段，各方面还未达到最成熟的状态；其次是因为OC的配置相对于Clover要复杂许多，而且目前没有像Clover Configurator一样直观的图形化界面的配置工具；最后是因为，OC在社区中普及程度不高，导致遇到问题很难找到现成的案例解决。这些原因使很多人放弃了折腾。但是历史的发展是一个螺旋上升的过程，未来将一定是OC的！（笑）\n\n### 黑苹果的初步安装\n\n讨论完了黑苹果的原理以及核心，下一步就该讲讲如何安装了！但是请大家注意，因为这篇文章主要是面向新手的，所以我只会介绍一些最最基本和通用的操作，目的是为了让大家先把黑苹果装上。而安装完成以后的那些各种优化的操作，包括配置Clover的配置文件，给系统打补丁等定制性比较强的内容，都**不会**在本文中涉及。博主可能在接下来一段很长的时间内陆陆续续更新一些系统优化的内容，敬请期待！闲话少说，我们开始吧！\n\n---\n\n#### 制作安装盘\n\n下面的操作均在Windows系统下进行。\n\n- 在[黑果小兵的部落阁](https://blog.daliansky.net)按照你的需要下载某个版本的系统镜像文件（后缀为`iso`）\n\n- 打开`WinMD5`软件，将下载完成的`iso`镜像文件拖入软件窗口，与网站上提供的`md5`值比对，校验`md5`值是否正确，如不正确，请重新下载（`md5`值相当于一个文件的身份证号码，它的值是唯一的，如果你下载下来的文件的`md5`值与官方提供的不一样，说明你下载的文件可能被修改过或者出错了）\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322163623208.png\" alt=\"校验MD5值\" style=\"zoom:50%;\" />\n\n- 找到一个容量为16GB或以上的**空U盘**，插入电脑\n\n- 以管理员身份打开`TransMac`软件，在窗口中左侧列表鼠标右击你的U盘，点击`Restore With Disk Image`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164230903.png\" alt=\"Restore with Disk Image\" style=\"zoom:50%;\" />\n\n- 点击后有可能会弹出下图所示的警告，是提示你的U盘可能含有已经挂载的卷，请确保你选择的U盘是正确的，然后点击`Yes`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164627959.png\" alt=\"请确保你选择的U盘正确！\" style=\"zoom:50%;\" />\n\n- 在弹出的窗口中选择你刚才下载好的`iso`文件，点击`OK`，这个时候会**格式化**你的U盘并把系统镜像烧录到你的U盘中，耐心等待安装盘制作完成吧，这一过程大约要持续20~30分钟\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164435201.png\" alt=\"选择镜像文件\" style=\"zoom:50%;\" />\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322165214199.png\" alt=\"等待时间，来杯卡布奇诺\" style=\"zoom:50%;\" />\n\n- 制作完成以后会弹出对话框，直接点击`OK`\n\n- 在此之后系统会提示你要格式化U盘，不必理会，直接点击`取消`\n\n---\n\n#### 替换安装盘中的EFI文件\n\n安装macOS时，我们运行的是在U盘上的`macOS安装程序`，这一步与运行macOS其实是差不多的。此时我们的U盘就相当于一个外置的系统盘，需要通过位于U盘上的Clover引导来启动`macOS安装程序`。\n\n为了可以正确引导操作系统，不同型号，甚至不同批次的电脑的EFI文件都是不太一样的。因为这些电脑之间的硬件有所区别，所以你需要确保你的电脑的EFI文件是与你的电脑硬件适配的。这个问题的原理我们已经在前面提到过了。\n\n但是这个软硬件适配的工作对于小白来说极度不友好，因为这需要一部分的数字电路，微型计算机原理，以及代码编写的知识。那有什么办法可以解决这个问题呢？答案就是：“拿来主义”。多亏了开源社区的发展，有许多人在网站上将他们已经完善的EFI文件分享给其他使用同一型号电脑的人。所以你现在要做的就是：找到与你的电脑型号对应的EFI文件，然后下载下来。\n\ndaliansky整理了一个清单，里面收集了大量不同机型的EFI文件，你可以在里面找找有没有自己电脑的型号：[Hackintosh黑苹果长期维护机型整理清单](https://blog.daliansky.net/Hackintosh-long-term-maintenance-model-checklist.html)。如果有的话，点击链接，然后将别人提供的这个EFI文件下载下来即可。\n\n这时有人会问了，如果没找到自己电脑的型号怎么办呢？不要气馁，你也可以尝试使用与你的电脑硬件配置类似的其他机型的EFI文件，或者使用daliansky提供的镜像中的通用EFI文件。\n\n按照daliansky的建议，在安装macOS时不必将镜像中的通用EFI文件替换为对应自己机型的EFI文件。但是我个人认为，如果你已经找到了与你的机型对应的EFI文件，那么在安装之前就将其更换，可能会在安装过程中避免一些错误的发生。\n\n下面就来介绍一下如何替换安装盘中的EFI文件吧！\n\n- 打开`DiskGenius`软件，在左侧列表中找到你已经制作好的安装盘，并单击选中\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322172930142.png\" alt=\"选择你已经制作好的安装盘\" style=\"zoom:50%;\" />\n\n- 依次双击右侧列表中的`ESP(0)`卷标，`EFI`文件夹，进入如下页面\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322173254704.png\" style=\"zoom:50%;\" />\n\n- 单击`CLOVER`文件夹，然后按`delete`键，弹出对话框后点击`删除`，将这个文件夹删除掉\n\n- 选中你从别人那儿拿来的EFI文件中的`CLOVER`文件夹，按下`Ctrl+C`后将窗口切回`DiskGenius`，然后再按下`Ctrl+V`将新的`CLOVER`文件夹复制进去，这样就完成了EFI文件的替换了\n\n---\n\n#### 给硬盘分区\n\n接下来我们要在电脑的硬盘上给即将安装的macOS分配一块足够大的空间。\n\n以下操作均在Windows下的`DiskGenius`软件中进行，且以我的U盘作为示例，操作方法与在电脑内置硬盘上的一样。在进行以下操作之前，请先备份你的文件。\n\n- 打开`DiskGenius`软件，在右侧列表中选中你的硬盘，然后在顶部查看你的硬盘空间分配情况，在顶部最左侧找到你的EFI分区，确保你的EFI分区的空间大于200MB，否则macOS将无法安装\n\n  ![](https://astrobear.top/resource/astroblog/content/image-20200322174413977.png)\n\n- 右键单击你的硬盘，选择`转换分区表类型为GUID`模式，否则macOS将无法安装，如果这个选项是灰色的而下一个选项可选，则无须转换\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322174834408.png\" alt=\"转换为GUID格式\" style=\"zoom:50%;\" />\n\n- 右键单击上方的蓝色容量条，点击`建立新分区`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175353564.png\" alt=\"建立新分区\" style=\"zoom:50%;\" />\n\n- 在弹出的窗口中调整你要分给macOS的容量大小，然后点击`开始`，接下来会有弹窗出现，请**严格遵守弹窗中给出的要求**操作，以免发生意外，然后点击`是`，开始分区\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175546512.png\" style=\"zoom:50%;\" />\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181027988.png\" alt=\"别怪我没提醒你!\" style=\"zoom:50%;\" />\n\n- 分区完成以后，右键单击顶部蓝色容量条，点击`删除当前分区`（因为macOS的磁盘格式为APFS，因此现在对其进行格式化没有意义）\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181359400.png\" style=\"zoom:50%;\" />\n\n---\n\n#### 设置BIOS\n\n前文已经说过，操作系统的启动顺序是`UEFI/BIOS->CLOVERX64.efi->OS`。因此，为了使我们的电脑可以启动安装盘上的`macOS安装程序`，我们还需要正确设置我们的BIOS。\n\n由于不同品牌的电脑使用不同的主板，所以BIOS的设置以及进行操作的键位也千差万别，这里仅以作者的电脑举例。由于作者电脑的BIOS十分垃圾，可供调整的选项寥寥无几，因此下面所给出的操作步骤中的设置配置要求是最基本的。如果你的电脑的BIOS功能足够强大且有很多其他的设置选项的话，请尽量弄懂这些选项的含义，并按照需要进行设置。\n\n- 按下开机按钮以后，迅速按`F10`进入BIOS设置\n\n- 按方向键进入`系统设置`菜单中的`启动选项`，请开启`传统模式`，禁用`安全启动模式`，启用`USB启动`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack11.JPG\" style=\"zoom:50%;\" />\n\n- 按`F10`保存设置，电脑将自动重启\n\n现在BIOS也已经设置完成。做完这些前期准备工作以后，接下来就要正式开始安装系统了！\n\n---\n\n#### 安装系统\n\n下面以macOS 10.15.3的安装过程为例。\n\n- 重启电脑，看到左下角的提示以后，按`esc`暂停启动\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack10.JPG\" alt=\"这是惠普的BIOS操作方法\" style=\"zoom:50%;\" />\n\n- 进入`启动菜单`，按`F9`进入`启动设备选项`\n\n- 在列出的一串引导中，选择`USB硬盘（UEFI）`的选项以启动安装盘中的引导，如果你使用的是daliansky提供的较新的系统镜像，安装盘中会出现两个引导，一个是微PE（后面会提到），另一个是Clover，我们需要启动的是Clover\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/hack12.JPG\" style=\"zoom:50%;\" />\n\n- 进入Clover界面以后，按照前文所说过的方法，开启啰嗦模式\n\n- 如果你需要使用镜像中的通用EFI文件，那么请执行下面的步骤，否则直接跳过：\n\n  - 在Clover主界面按`O`进入选项，光标移动到`Configs`后按回车进入进入该选项，这个选项是用来选择需要生效的Clover配置文件的\n\n    ![选择Configs(Credit: daliansky)](http://7.daliansky.net/10.15.3/2_Clover_Configs.png)\n\n  - 选择`config_Install`这个配置文件\n\n    ![选择config_Install(Credit: daliansky)](http://7.daliansky.net/10.15.3/3_Clover_Select_Installer.png)\n\n  - 按两次`esc`返回到Clover主界面\n\n- 在Clover主界面选择卷标`Boot macOS Install from Install macOS Catalina`，然后按下回车，开始引导安装程序\n\n  ![开始引导(Credit: daliansky)](http://7.daliansky.net/10.15.3/1_Clover_Installer.png)\n\n- 这个时候会出现如下图所示的安装日志，如果你很不幸地卡住了，那么你可以参考[macOS Catalina 10.15安装中常见的问题及解决方法](https://blog.daliansky.net/Common-problems-and-solutions-in-macOS-Catalina-10.15-installation.html)，或者附上你卡住的地方的照片和你的电脑配置，在各种交 流 群中询问大佬\n\n  ![这是一个群友的求助图片，出现的问题是卡ec了](https://astrobear.top/resource/astroblog/content/hack2.jpg)\n\n- 如果没有卡住，你的日志会消失，然后出现苹果的logo和进度条\n\n  ![白苹果(Credit: daliansky)](http://7.daliansky.net/Air13/1.png)\n\n- 等待一段时间以后，会出现语言选择界面，请选择中文并点击`继续`，如果有装逼需求或者想练习外语，你也可以选择其他语言\n\n  ![还是选择中文吧(Credit: daliansky)](http://7.daliansky.net/Air13/4.png)\n\n- 选择`磁盘工具`并点击`继续`\n\n  ![实用工具(Credit: daliansky)](http://7.daliansky.net/10.15.3/3.png)\n\n- 进入磁盘工具以后，在左上角右键点击你的磁盘，并选择`显示所有设备`，并找到你之前已经准备好安装macOS的分区\n\n  ![选择显示所有设备](http://7.daliansky.net/10.15.3/4.png)\n\n- 选中你之前已经准备好安装macOS的分区，然后点击`抹掉`，在弹出的窗口中，你需要给你的分区起一个名字，并将格式设置成`APFS`，然后将方案设置为`GUID分区图`，再点击`抹掉`，这一步会将你电脑上的硬盘分区格式化\n\n  ![抹掉磁盘(Credit: daliansky)](http://7.daliansky.net/10.15.3/6.png)\n\n- 操作完成以后，点击左上方`磁盘工具`，在弹出的选项中选择`退出磁盘工具`并返回到安装界面\n\n  ![退出磁盘工具(Credit: daliansky)](http://7.daliansky.net/10.15.3/8.png)\n\n- 在主界面选择`安装macOS`并点击`继续`，再闭着眼睛同意条款\n\n- 在下图所示的界面中选择你要安装的磁盘分区，然后点击`安装`，接下来安装程序会将安装文件复制到你的分区中，这个过程会持续几分钟，待复制完成以后，电脑会重新启动\n\n  ![选择你准备好的那个磁盘分区(Credit: daliansky)](http://7.daliansky.net/10.15.3/12.png)\n\n- 重启之后，按照本节一开始所述方法进入Clover，这时候你会发现，Clover主界面会多出来几个卷标，从现在开始直到安装完成，请都选择`Boot macOS Install form xxx（你给你的macOS分区起的名字）`卷标启动，在安装过程中请耐心等待，无论你做了什么奇怪的事情让你增加了什么奇怪的知识，都不要在出现白苹果logo的时候乱动鼠标或者键盘\n\n- 经过两到三次重启以后，你会发现`Boot macOS Install form xxx`的卷标消失了，新出现了`Boot macOS form xxx`的卷标，选中它，然后进入，再对着白苹果等待几分钟，难得的休息时间马上就要结束了\n\n- 进度条走完，出现设置向导，接下来会让你设置你的国家和地区，语言和输入法，按照你的需要设置即可，然后会进入`数据和隐私`界面，点击`继续`\n\n  ![选择国家和地区(Credit: daliansky)](http://7.daliansky.net/Air13/22.png)\n\n- 接下来会问你是否需要将macOS从你的备份中恢复，黑苹果玩家一无所有，选择`现在不传输任何信息`并点击`继续`\n\n  ![没有备份，无需恢复(Credit: daliansky)](http://7.daliansky.net/Air13/25.png)\n\n- 接下来要你使用Apple ID登陆，这里先跳过\n\n  ![不要登陆！登陆了也没用(Credit: daliansky)](http://7.daliansky.net/10.15.3/15.png)\n\n- 还是闭着眼接受条款\n\n  ![接受就完事了(Credit: daliansky)](http://7.daliansky.net/10.15.3/16.png)\n\n- 接下来你需要创建一个电脑用户，这是一个管理员帐户，请注意，在这里设置了用户名以后，如果未来要更改的话会极为麻烦，建议想清楚了再继续下一步\n\n  ![不要起什么奇奇怪怪的名字(Credit: daliansky)](http://7.daliansky.net/Air13/30.png)\n\n- 进入`快捷设置`页面，点击`继续`，然后会进入`分析`页面，取消勾选`与App开发共享崩溃与使用数据`，黑苹果这种东西自己偷摸着用就行\n\n  ![不要共享(Credit: daliansky)](http://7.daliansky.net/10.15.3/17.png)\n\n- 接下来还会要你设置屏幕使用时间，Siri，以及外观，这些选项按照你的需要设置就行，一路`继续`下去，直到出现`正在设置你的Mac`页面，请稍等片刻\n\n  ![即将完成！(Credit: daliansky)](http://7.daliansky.net/Air13/34.png)\n\n- 终于进入了桌面，这时macOS的基本安装已经完成了！先庆祝一下，折腾的事情还在后头呢（虽然这篇文章不会写吧......）\n\n  ![老二次元了doge](https://astrobear.top/resource/astroblog/content/hack9.png)\n\n---\n\n#### 将引导添加到硬盘并调整顺序\n\n现在，macOS已经成功安装到我们电脑的硬盘上了，但是我们电脑硬盘上的macOS还是通过U盘里的Clover引导的。这就意味着，如果拔掉U盘，我们将不能够启动macOS。所以我们需要将U盘引导区中的Clover文件夹复制到硬盘引导区的EFI文件夹中，以实现脱离U盘启动。这一步的操作与前文`替换安装盘中的EFI文件`这一小节的操作基本是一致的，需要你在Windows系统下使用`DiskGenius`操作，这里就不再赘述了。\n\n如果现在重启电脑，你还是会发现直接进入了Windows的引导而不是Clover。这是因为除了Clover之外，电脑当然还有许多其他的引导项，这些引导项按顺序排列在启动序列之中。现在我们只是把Clover的文件夹放入了硬盘的引导区中，但是还没有把Clover添加到启动序列之中。电脑不知道自己居然还可以用Clover引导macOS，只能继续用老一套方法直接引导Windows启动了。那么下面我们就要告诉电脑，让它知道自己可以使用Clover引导操作系统。下面的操作都是在Windows下进行的。\n\n- 打开`EasyUEFI`软件，你可以看到所有的引导项之中没有Clover，点击红框中按钮创建新的引导项\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405233601042.png\" alt=\"创建引导项\" style=\"zoom:50%;\" />\n\n- 在弹出的窗口中，`类型`选择`Linux或者其它操作系统`，`描述`可以随便填写，这里使用的是`CLOVER`，目标分区选择`磁盘0`的ESP分区（唯一可选的那一个）\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234307270.png\" style=\"zoom:50%;\" />\n\n- 在`文件路径`一行中，点击`浏览`，在弹出的窗口中显示了一个硬盘的图标，这个就是你电脑上硬盘的ESP分区了，点击它左侧的加号将其展开，在EFI文件夹中找到`CLOVERX64.efi`，这个就是Clover的引导文件，选中后点击`确定`\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234725001.png\" style=\"zoom:50%;\" />\n\n- 回到原先的界面之后，点击`确定`，可以发现Clover已经添加到启动序列中了\n\n- 到这里还没结束，因为Clover被上面众多引导项压着，启动的时候怎么也轮不到它，因此我们点击红框中的按钮，将Clover移到启动序列的第一位，使电脑开机的时候默认使用Clover引导操作系统\n\n  <img src=\"https://astrobear.top/resource/astroblog/content/image-20200405235126649.png\" style=\"zoom:50%;\" />\n\n现在再重启电脑，不要按`esc`暂停启动，电脑会默认使用Clover进行引导。选择macOS分卷，按回车进入。如果成功启动了，那么你便可以重新设置你的BIOS，将`传统模式`关闭了（但不要开启`安全启动模式`）。\n\n到这里，macOS的前期安装已经正式完成！夸赞一波自己吧！\n\n---\n\n#### 黑苹果单系统安装\n\n按照上面所说的步骤，如果不出问题，你便在电脑上成功安装了Windows和macOS双系统。如果你只需要macOS的单系统，操作步骤与上面所说有些许不同，但是绝大部分步骤是一样的，唯一的区别在于`给磁盘分区`和`将引导添加到硬盘并调整顺序`这两部步。如果你在制作安装盘的时候，下载的是daliansky提供的较新系统版本的镜像，或者你在制作完系统启动U盘以后，在`此电脑`中可以看到有诸如`微PE`字样的磁盘，那么下面步骤中的前三步可以省略掉。大致的操作方法如下：\n\n- 于[官网](http://www.wepe.com.cn/download.html)下载`微PE工具箱V2.0 64位版本`\n- 打开软件，将微PE工具安装到你的已经制作好的macOS安装盘中\n- 将`DiskGenius`和`UEFIManager`拷贝到微PE的文件盘中（微PE系统中本身自带非专业版的`DiskGenius`，某些功能有缺失）\n- 设置BIOS\n- 重启，在BIOS中使用安装盘中微PE的引导启动\n- 进入系统后你可以发现界面与Windows10几乎一样，运行你存放在U盘中的`DiskGenius`，删除你硬盘中Windows使用的分区，并删除硬盘EFI分区的Windows文件夹\n- 将硬盘分区表类型转换为`GUID`格式\n- 按照你的需要以及前文所述要求，重新分配你的硬盘分区，并将他们格式化\n- 接下来就是安装系统了，如果一切顺利进入了macOS的桌面，你可以继续下面的步骤\n- 重启，使用安装盘中微PE的引导启动\n- 运行`DiskGenius`，将安装盘EFI文件夹中`CLOVER`文件夹复制到电脑硬盘的EFI文件夹中\n- 运行`UEFIManager`，然后参考上文所说的方法，添加并调整你的引导项\n- 如果没有问题，关闭BIOS的`传统模式`启动\n- 大功告成！\n\n### 安装完成后可能出现的问题\n\n完成macOS的安装并不代表你的电脑就已经是可堪重用的生产力/娱乐工具了。绝大多数情况下，刚刚完成安装的黑苹果还会存在着各种各样的问题。即使你使用的是完全对应你的电脑型号的EFI文件，依然有大概率会出现这些问题。**黑苹果的折腾之处不是安装macOS的过程，而是完全解决这些问题的过程。**所以这就是为什么我建议大家不要在安装的最后几步（包括完成安装以后）登陆你的苹果服务，因为你的电脑存在的一些问题会导致苹果服务登不上去，而且折腾的过程也有可能把你的Apple ID中的信息搞乱，就像下图一样。\n\n<img src=\"https://astrobear.top/resource/astroblog/content/hack13.JPG\" alt=\"瞬间富有\" style=\"zoom:50%;\" />\n\n安装完成以后，大家可以检查一下自己的电脑有没有出现下面列出的这些问题。下面的检查大部分都在macOS的设置中完成，还有一些直接观察即可。在每个问题的末尾都会给大家提供一些解决问题的思考方向，但并不会提供具体的解决办法。另外还附上了无故障发生的效果图供大家参考。\n\n- 网络与蓝牙的问题：下面的这些问题与你的**网卡的型号或者驱动**有关\n\n  - 打开`系统偏好设置-网络`选项，里面没有有Wi-Fi选项，即使有也打不开Wi-Fi\n  - 打开`系统偏好设置-蓝牙`选项，无法开启蓝牙\n  - 无法使用随航\n  - 无法使用Siri，FaceTime，iMessage\n\n  ![](https://astrobear.top/resource/astroblog/content/hack14.png)\n\n  ![](https://astrobear.top/resource/astroblog/content/hack15.png)\n\n- 声音的问题：这个问题的表现形式很多，出现这些问题是因为**声卡没有驱动**\n\n  - 打开系统`系统偏好设置-声音`选项，无法调节音量\n  - 勾选`当更改音量时播放反馈`再调节音量，电脑没有声音\n  - 麦克风没有输入电平的变化\n  - 使用快捷键调节音量，喇叭图标下出现禁行标志\n\n  ![](https://astrobear.top/resource/astroblog/content/hack16.png)\n\n- 触控板的问题：触控板根本没有反应，或者在`系统偏好设置-触控板`选项中某些手势无法使用，或者某些功能不显示，这个问题与你的**触控板驱动**有关\n\n  ![](https://astrobear.top/resource/astroblog/content/hack17.png)\n\n- 显示的问题：这个问题也涉及到很多方面，注意**下面给出的图片是错误示例，不是正确的打开方式**\n\n  - 色偏严重：这个问题与你的**显示器描述文件和EDID**有关\n\n    ![严重的色偏](https://astrobear.top/resource/astroblog/content/hack18.JPG)\n\n  - 文字显示过小，图标与文字比例失调：这个问题与你的**EDID以及是否开启了HiDPI**有关\n\n    ![失调的比例](https://astrobear.top/resource/astroblog/content/hack19.png)\n\n  - 出现颜色断层：这个问题与你的**EDID和显卡缓冲帧**有关\n\n    <img src=\"https://astrobear.top/resource/astroblog/content/hack20.jpg\" alt=\"断层的色彩\" style=\"zoom:50%;\" />\n    \n  - 无法调节亮度：在`系统偏好设置-显示器`选项中没有亮度调节条，键盘上的亮度调节快捷键也没有反应，这个问题可能与你的**亮度调节驱动或者系统补丁**有关\n\n- 电源管理的问题：这个问题的表现形式很多，导致这个问题产生的原因也很多\n\n  - 节能管理未加载：在`系统偏好设置-节能`选项中没有将4个（台式机为5个）选项全部加载，出现这个问题是因为你**没有加载macOS原生的电源管理**\n\n    ![](https://astrobear.top/resource/astroblog/content/hack21.png)\n\n  - 睡眠失灵：睡眠秒醒或者睡眠自动关机/死机/重启，这个问题与你的**电源管理或者USB驱动**有关\n\n- USB总线的问题：USB接口部分或者全部失灵，打开`Photo Booth`后摄像头无画面，这个问题与你的**USB驱动**有关（话说回来`Photo Booth`还是蛮有意思的😂）\n\n- 独立显卡无法驱动：黑苹果下只有部分独立显卡可以驱动，如果你的独显**有独立输出并且满足特定型号要求**的话可以尝试将其驱动，否则你就需要屏蔽独显，使用集显了，这里不展开叙述\n\n另外，你也可以在`左上角苹果图标-关于本机-系统报告`中直接查看你电脑的硬件情况。通过检查各个硬件的驱动情况和相关数据，一样可以判断你的电脑是否会有上面的问题。\n\n上面给大家介绍的都是一些典型的问题，你也有可能遇到其他的疑难杂症。希望大家面对问题不要望而却步，尽情享受折腾的过程吧！\n\n(～￣▽￣)～\n\n### 黑苹果相关资源推荐\n\n折腾黑苹果，宜广集信息，多多提问；忌盲目瞎搞，重复建设。\n\n#### 黑苹果相关优秀网站\n\n- [黑果小兵的部落阁](https://blog.daliansky.net)：也就是daliansky——国内黑苹果领军人物的博客，他的网站会非常及时地更新系统镜像并不定时地提供一些精品教程\n- [IT密码](https://www.itpwd.com)：网站上面的资源非常丰富，从系统镜像到软件资源再到方法技巧一应俱全，博主也是非常牛啤的\n- [OC简体中文参考手册](https://oc.skk.moe)：由业界大佬合力完成，仍在维护中，学习OC必备\n- [GitHub](https://github.com)：这个不用多说了，绝大部分黑苹果软件和驱动的来源，全球最大同性交友网站🐶，神奇的地方\n- [远景论坛](http://www.pcbeta.com)：国内最主要的黑苹果交流论坛，注册需要邀请码\n- [tonymacx86](https://www.tonymacx86.com)：国外知名的黑苹果交流论坛，资源丰富，需要一定的英语能力\n- [insanelymac](https://www.insanelymac.com/forum/)：与tonymacx86类似的论坛\n\n#### 黑苹果软件、驱动资源\n\n下面只列出了一些至关重要的驱动和软件，其他功能的还有很多，这里就不一一列出了。\n\n- [Clover Configurator](https://mackie100projects.altervista.org/download-clover-configurator/)：Clover的图形化配置软件\n- [Hackintool](https://github.com/headkaze/Hackintool/releases)：黑苹果完善必备工具\n- [Clover](https://github.com/CloverHackyColor/CloverBootloader/releases)：在这里可以找到已经编译好的Clover\n- [Lilu.kext](https://github.com/acidanthera/Lilu/releases)：众多常用驱动的依赖\n- [AppleALC.kext](https://github.com/acidanthera/AppleALC/releases)：常用声卡驱动\n- [VoodooPS2Controller.kext](https://github.com/acidanthera/VoodooPS2/releases)：PS2总线输入设备（鼠标，键盘，触控板）的驱动，此外对于I2C总线的输入设备还有VoodooI2C.kext\n- [VoodooInput.kext](https://github.com/acidanthera/VoodooInput/releases)：VoodooPS2Controller的依赖\n- [WhateverGreen.kext](https://github.com/acidanthera/WhateverGreen/releases)：用于驱动Intel集成显卡\n- [FakeSMC.kext](https://bitbucket.org/RehabMan/os-x-fakesmc-kozlek/downloads/)：必备驱动，用于仿冒SMC设备，欺骗macOS，让它以为我们的电脑就是Mac\n\n\n\n### 声明与致谢\n\n黑苹果社区的健康需要大家共同维护，恳请新人们注意以下几点：\n\n- 不要把社区的成果（如各种机型的EFI，开源软件等）拿来作商业用途\n- 不要购买淘宝上面的EFI！所有现存的EFI都可以在网上免费获得！请不要支持那些兜售EFI的无良商家，他们也是从网上下载的\n- 不建议去淘宝上购买安装黑苹果的服务，出了问题到最后还是要你自己解决\n- 不建议把自己的折腾成果在网络上有偿提供，这样并不利于社区的发展\n- 网友没有义务去无偿地帮你解决问题，另外也请善用搜索引擎\n\n黑苹果一开始是极客的产物，是反叛精神的象征。令人意料不到的是，现在它居然可以为我们普通人所用。而从极客到大众的过渡，黑苹果的开源社区对此作出了极大贡献。对那些对社区做出过极大贡献的极客和工程师们，对社区建设贡献出自己的一份力量、努力维护社区健康发展的成员，我向你们表达最诚挚的感谢。没有社区，就没有黑苹果的今天。作为从社区中获益的普通成员，也应该通过自己的努力，以自己的方式去回馈这个社区，帮助它更好地发展。\n\n博主在此谨向你们表达我的感谢：[RehabMan](https://github.com/RehabMan)，[Acidanthera](https://github.com/acidanthera)，[黑果小兵](https://blog.daliansky.net)，[SlientSliver](https://github.com/SilentSliver)，[IT密码](https://www.itpwd.com)，以及其他给予过我帮助的网友或开发者们😘。\n\n\n\n附：[软件度盘链接](https://pan.baidu.com/s/17yVMb2FQyzfK2sAYbHuZnw) ，密码：3lkx。\n\n\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n在这篇文章写成之后不久，Apple推出了M1芯片以及macOS Big Sur。这对黑苹果来说无疑是一个重大打击。虽然macOS肯定还会对使用Intel CPU的电脑继续提供几年的支持，但是如果苹果未来不再推出使用Intel CPU的电脑，那么黑苹果的未来恐怕不容乐观。另外，黑苹果社区也出现了比较大的变化。随着更先进更安全更简单的Open Core逐渐成熟，其使用者也越来越多。虽然Clover仍然保留了对最新的macOS的支持，但是其已然落后。这也就是说，在这篇文章写完之后，其内容已经过时了（悲，但如果是安装Big Sur以下版本的macOS，这篇文章还是有一定的指导意义的）。最后，出于时间和精力的考虑，博主已经不打算再折腾黑苹果了。感谢黑苹果这两年来的陪伴。\n</div>\n</article>\n","slug":"Introduction_to_hackintosh","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzt000a1q398xmvcq6p","content":"<h3 id=\"关于黑苹果\"><a href=\"#关于黑苹果\" class=\"headerlink\" title=\"关于黑苹果\"></a>关于黑苹果</h3><p>欢迎步入黑苹果的世界！众所周知，Mac因其独特的macOS系统在众多Windows电脑中独树一帜。macOS具有许多与Windows不同的特性和优点（当然，也有不足），而且有些软件在macOS上的优化会比Windows更好或者只支持macOS平台。这就是为什么Mac在市场上一直有着广泛的需求的根本原因——即macOS的独特性。由于苹果的封闭性策略，macOS在正常情况下只能安装在Mac上。而黑苹果的出现，给广大对macOS有需求的人们提供了一个新的选择——你再也不需要为了一个系统去购买在同等硬件或性能条件下价格更为昂贵的电脑了。</p>\n<p>黑苹果，意思就是安装有macOS的，可以正常工作的非Mac的电脑，也可以指为非Mac的电脑安装macOS的行为，亦可以指安装在非Mac电脑上的macOS。对于这个词的确切定义还是模糊不清的，不过这不是关键所在。与黑苹果相对，白苹果的含义就非常明显了，也就是苹果的Mac或者安装在Mac上的macOS。</p>\n<p>黑苹果的原理就是通过对电脑主板的破解和对系统的欺骗，让macOS以为这是一台Mac，再通过一系列驱动和补丁使得这台电脑可以在macOS下正常运行。需要注意的是：</p>\n<p><font size=4><strong>将macOS安装在非Mac的电脑上是违反苹果公司的法律条款的！</strong></font></p>\n<p>所以安装黑苹果是存在一定的法律风险的，这有可能（但是非常非常罕见）导致你的AppleID被锁死。但是一般情况下，苹果公司对这种行为都是睁一只眼闭一只眼。只是随着黑苹果数量上的日益增长，不知道什么时候会引起苹果公司的重视并对此采取措施。而在另一方面，如果你使用黑苹果来牟利的话，性质就完全不同了，你有可能会受到法律的制裁。</p>\n<p>由于macOS从一开始就不被允许安装在非Mac的电脑上，因此安装黑苹果绝对不是一件容易的事情，它涉及到对主板的破解，对硬件的驱动，对系统的欺骗，同时也会产生很多奇奇怪怪的bug。黑苹果有很多缺点：</p>\n<ul>\n<li>不完美的黑苹果相对于白苹果不那么稳定</li>\n<li>黑苹果在硬件层面上的缺失导致很多功能无法实现，如Touch Bar，Touch ID，力度触控板等</li>\n<li>安装黑苹果仍需要满足一定的硬件条件，某些型号的硬件在黑苹果下是无法驱动的</li>\n<li>安装黑苹果费时费力，相当折腾</li>\n</ul>\n<p>既然黑苹果有那么多缺点，并且还是非法的行为，那为什么还有那么多人在使用黑苹果并且人数还在日益增长呢？因为黑苹果与同样安装有macOS的电脑相比，还是有其优点的：</p>\n<ul>\n<li><p>完美的黑苹果在使用体验上基本不输给Mac</p>\n</li>\n<li><p>黑苹果在同等硬件或性能条件下比起Mac便宜许多</p>\n</li>\n<li><p>黑苹果的定制性和可扩展性在某些方面比Mac强大许多</p>\n</li>\n</ul>\n<p>从黑苹果的优点来看，再结合实际情况，我们可以发现使用黑苹果的人群可以分为以下几类：</p>\n<ul>\n<li>对macOS有刚需，但是又不想花钱/没钱买Mac的，如某些影视、音乐工作者</li>\n<li>对macOS有刚需，但是受限于苹果封闭的生态，只能通过黑苹果的高可扩展性来满足自己对硬件的需求的特定行业从业者</li>\n<li>对macOS没有刚需，具有反叛精神的极客，专门研究操作系统和硬件的工程师，通常这类人也有白苹果</li>\n<li>对macOS没有刚需，只是想要体验macOS或苹果完整生态却又不想花钱/没钱购买Mac的人</li>\n</ul>\n<p>而博主作为一个穷学生，就是属于最后一类的人😂。我折腾黑苹果已经有1年时间，现在自己在用的电脑是惠普的<code>Envy-13 ad024TU</code>，装有Windows和macOS两个系统。博主的黑苹果已经基本完美，在使用体验上已经与白苹果相差无几。关于我的黑苹果的更多信息，可以参考我的<a href=\"https://github.com/Astrobr/HackintoshForEnvy13-ad0xx\">GitHub仓库</a>，或者我的<a href=\"https://astrobear.top/2020/02/14/HP_Envy-13_ad024TU_Hackintosh/\">另一篇博客</a>，在那篇博客里我主要总结了给自己的电脑安装黑苹果时踩过的一些坑。而这篇文章主要是针对笔记本电脑，让大家对黑苹果有一个初步的了解。看完这篇文章，你就基本入门黑苹果了。</p>\n<h3 id=\"黑苹果的原理以及核心\"><a href=\"#黑苹果的原理以及核心\" class=\"headerlink\" title=\"黑苹果的原理以及核心\"></a>黑苹果的原理以及核心</h3><h4 id=\"黑苹果的原理\"><a href=\"#黑苹果的原理\" class=\"headerlink\" title=\"黑苹果的原理\"></a>黑苹果的原理</h4><p>在讨论这个问题以前，我们先要了解一下电脑是怎么启动的。</p>\n<p>首先，在你按下开机键以后，电脑上电，各硬件进入了待命状态。CPU（Central Processing Unit，中央处理器）启动以后，按照其在设计时就固定好的功能送出了第一条指令，这一条指令将会使BIOS（Basic Input/Output System，基本输入输出系统）芯片中装载的程序开始执行。BIOS程序可以实现很多功能，比如系统自检，提供中断服务等。但是它最主要的功能则是将存放于硬盘引导区的操作系统引导程序（Boot loader，下文简称引导）装载入内存，再通过引导将操作系统装载进内存。</p>\n<p>当然，现在市面上新发售的电脑大部分都已经采用了一种更新的方式来装载引导，也就是所谓的UEFI（Unified Extensible Firmware Interface，统一可扩部件接口）。UEFI作为一种较新的方案，它和BIOS的区别主要是在可扩展性方面。但是除了一些细微的差别，它在整个启动的流程上与BIOS基本相同，且最终目的都是将引导装载进内存当中。另外在开发者圈子中，BIOS和UEFI也常常被混为一谈。因此尽管现在的主流是采用更先进的UEFI，但在下面的叙述中我还是会使用BIOS的概念。这并不会给理解带来困难，只是你们需要知道这两者有些许微妙的区别即可。</p>\n<p>也许有人会问，为什么不使用BIOS直接将操作系统装载进内存呢？首先，如果有多个操作系统，那么不同的操作系统的装载过程会有所不同。如果要让BIOS适配不同的操作系统，那么会导致它的体积过于庞大，系统过于复杂，不利于它的的稳定。其次就是，BIOS是固定在BIOS芯片中的，不方便修改。这也导致了我们难以让BIOS对不同的操作系统做适配。因此，我们需要引导来完成操作系统加载的工作。</p>\n<p>具体而言，引导需要完成的工作主要有以下几点：</p>\n<ul>\n<li>初始化其他硬件设备，为系统提供可访问的表和服务</li>\n<li>为操作系统分配内存空间，再将它加载进内存当中</li>\n<li>为高级计算机程序语言提供执行环境</li>\n<li>将控制权移交给操作系统</li>\n</ul>\n<p>在此之后，系统的完整的启动过程就结束了，操作系统接管了整个电脑。简而言之，电脑的启动过程可以概括为：<code>BIOS-&gt;Bootloder-&gt;OS(操作系统)</code>。</p>\n<p>回到黑苹果上来。我们想要在一款非Mac的电脑上运行macOS，与我们在电脑上运行Windows的最大区别在哪儿？当然是操作系统不同啊！由于macOS与Windows是两个完全不同的操作系统，因此他们启动和加载的过程也完全不同。所以我们肯定不可以用启动Windows的那一套方法去启动macOS，而必须要有专门的适应macOS的一套启动方法（程序）。</p>\n<p>我们想要将macOS加载到我们的内存当中，就要对当前我们的启动程序进行修改和适配。回顾上文所说的电脑的启动过程我们可以发现，BIOS是固定在芯片中的，不易修改。那么我们可以操作的部分就只有引导了。所以我们要找到合适的引导程序，使其可以将macOS正确地装载进内存，并给它提供正确的服务，让它可以与硬件正常交流，最终使它正常运行。</p>\n<p>通过上面的一番讲解，我们可以发现，安装黑苹果的核心就是引导。而实际上，折腾黑苹果折腾的也主要就是引导。而由于白苹果的硬件，BIOS，和引导都是针对macOS开发的，所以当然不要任何的折腾，开箱即用就行（废话……）。</p>\n<p>目前主流的可以用于在非Mac的电脑上启动macOS的引导主要有两个，分别是<code>Clover</code>和<code>OpenCore</code>（下文简称OC）。由于OC是新开发的引导，目前还在公测阶段，而且其在社区普及率远远不如Clover，所以下面将主要讲解Clover，而对于OC只作非常简单的介绍。</p>\n<h4 id=\"Clover\"><a href=\"#Clover\" class=\"headerlink\" title=\"Clover\"></a>Clover</h4><blockquote>\n<p>启动器的名字<code>Clover</code>由一位创建者kabyl命名。他发现了四叶草和Mac键盘上Commmand键（⌘）的相似之处，由此起了Clover这个名字。四叶草是三叶草的稀有变种。根据西方传统，发现者四叶草意味的是好运，尤其是偶然发现的，更是祥瑞之兆。另外，第一片叶子代表信仰，第二片叶子代表希望，第三片叶子代表爱情，第四片叶子代表运气。——摘自维基百科</p>\n</blockquote>\n<p>Clover是一个操作系统引导程序，可以通过新老两种方式进行启动，也就是BIOS方式和UEFI方式。目前主流的操作系统都已经是通过UEFI方式启动的了，如macOS，Windows 7/8/10 (64-bit)，Linux。</p>\n<p>所有的引导都是放在电脑硬盘开头部分的引导区（ESP分区）的EFI文件夹中，Clover也不例外。当然，EFI文件中还存放着Windows，Linux，或者其他操作系统的引导。下面就来看看Clover的文件结构吧。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack1.png\" alt=\"重要的文件夹和其功能在图中注明\"></p>\n<p>在Clover下使用UEFI方式启动的流程是这样的：<code>UEFI-&gt;CLOVERX64.efi-&gt;OS</code>。</p>\n<p>下面我将主要根据在实际操作中用到的一些功能来介绍Clover。</p>\n<ul>\n<li><p>进入操作系统</p>\n<p>这一步非常简单，开机之后用方向键选择你需要进入的操作系统的卷标，按下回车即可。</p>\n<p><img src=\"http://7.daliansky.net/1-main.png\" alt=\"图中出现了三种不同系统的卷标(Credit: daliansky)\"></p>\n</li>\n<li><p>显示帮助</p>\n<p>按下<code>F1</code>键会出现帮助信息。</p>\n<p><img src=\"http://7.daliansky.net/Help_F11.png\" alt=\"帮助信息(Credit: daliansky)\"></p>\n</li>\n<li><p>更新Clover</p>\n<p>请在<a href=\"https://github.com/Dids/clover-builder/releases\">这里</a>下载最新版本的<code>CLOVERX64.efi</code>并使用它替换掉你的EFI文件夹中的Clover文件夹中的同名文件。</p>\n</li>\n<li><p>开启啰嗦模式启动</p>\n<p>首先我要介绍一下什么是啰嗦模式。一般来说，我们在启动系统的时候只能看到一个进度条或者旋转的表示加载中的图案。而啰嗦模式就是将系统启动时各种详细参数和日志以及报错消息全部显示出来的模式，如下图所示。如果发生了操作系统启动异常/失败的情况，通过开启啰嗦模式，我们可以快速定位到出错的位置。</p>\n<p>开启啰嗦模式的方法很简单。首先选择你想要进入的系统的图标，按空格即可进入下图所示的页面，然后勾选图示选项，再选择<code>Boot macOS with selected options</code>启动。</p>\n<p><img src=\"http://7.daliansky.net/space-selected.png\" alt=\"开启啰嗦模式(Credit: daliansky)\"></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack2.jpg\" alt=\"开启啰嗦模式的效果\" />\n</li>\n<li><p>显示隐藏的卷标</p>\n<p>有的时候在Clover的启动页面中会出现很多以不同方式启动同一系统的卷标（Volume，可以理解为入口），我们可以通过修改Clover的配置文件来隐藏这些卷标，但是有的时候你又需要它们显示出来（比如你要通过进入<code>Recovery</code>卷标来关闭macOS的系统完整性保护的时候）。这个时候我们不必重新修改配置文件，只需要在Clover的主界面按下<code>F3</code>，即可将隐藏的卷标显示出来。</p>\n<p>关于怎么隐藏卷标，我将在下面介绍。</p>\n</li>\n<li><p>提取DSDT</p>\n<p>DSDT的全称为 Differentiated System Description Table，它是一个描述系统硬件不同信息的表，通过查阅这个表中的信息可以知道你的电脑有什么硬件，它们的名称是什么。知道这些信息有利于我们理顺硬件之间的关系，再通过修改补丁更正硬件信息，以优化操作系统的工作状况。</p>\n<p>在Clover主界面下按<code>F4</code>即可将你的DSDT信息保存到<code>EFI/CLOVER/ACPI/origin/</code>文件夹中。请注意，DSDT是由多个文件组成的。</p>\n</li>\n<li><p>选择你想要启用/禁用的驱动程序</p>\n<p>通过Clover加载的驱动程序保存在<code>EFI/CLOVER/kexts/Other</code>中，这些驱动程序是针对macOS生效的。在上面所说的那个文件夹中包含了很多不同的驱动文件，有些驱动文件之间会产生冲突，而有些驱动文件又是完全没有必要存在的。为了管理和精简你的驱动程序，你可以在Clover中设置你想要禁用的驱动程序以排查各种驱动的工作状况。</p>\n<p>首先你要选择macOS的图标，按下空格键。然后在新的页面中将光标移动到<code>Block injected kexts</code>，按下回车后进入该选项。再在新的页面中选择<code>Other</code>选项，这个时候你就可以看到你的驱动程序了。勾选你想要禁用的驱动程序以后，按<code>Esc</code>回到主页面，再直接回车进入macOS。</p>\n<p><img src=\"http://7.daliansky.net/BIKChoose.png\" alt=\"选择你想要禁用的驱动程序(Credit: daliansky)\"></p>\n<p>请注意，你的这一设置只对这一次启动有效，在之后的启动中将不会保留。</p>\n</li>\n<li><p>设置Clover（修改<code>config.plist</code>）</p>\n<p>有多种方法进行设置。</p>\n<ul>\n<li><p>你可以在开机以后的Clover主界面下按下按键<code>O</code>进入设置页面，然后你就可以选择不同的选项开始修改你的配置文件了，不过一般情况下我们不会使用这种<code>抽象</code>的方式来修改</p>\n<p><img src=\"http://7.daliansky.net/options.png\" alt=\"Clover的设置页面(Credit: daliansky)\"></p>\n</li>\n<li><p>使用Clover Configurator来修改</p>\n<p>Clover Configurator是一款运行在macOS下的应用程序，专门用来修改Clover的配置文件。它具有友好的图形化界面，每个选项都有比较详细的功能说明，操作起来比在启动时修改要轻松得多。Clover Configurator的下载链接放在文末。</p>\n<p>在设置以前，你需要在Clover Configurator的<code>挂载分区</code>选项卡中挂载你ESP分区（通常情况下这个分区都是隐藏的）。然后在你的Clover文件夹下使用Clover Configurator打开<code>config.plist</code>文件，进行修改。修改完成以后，请点击左下角的保存图标（图中以红框标明）。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack3.png\" alt=\"Clover Configurator的设置界面\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack4.png\" alt=\"Clover Configurator的设置界面\"></p>\n</li>\n<li><p>你还可以使用普通的文本文档编辑器（如Xcode或者Visual Studio Code）打开<code>config.plist</code>对其进行编辑，但是这个方法依旧比较<code>抽象</code>，不推荐新手或者代码小白这样操作</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack5.png\" alt=\"在Visual Studio Code中打开的Clover配置文件\"></p>\n</li>\n</ul>\n</li>\n<li><p>增加/删除/修改/查找驱动程序</p>\n<p>在启动以后，你可以使用Clover Configurator挂载EFI分区，然后直接使用访达在驱动文件夹中以可视化的方式管理你的驱动程序。</p>\n<p>当然，你也可以使用<code>Disk Genius</code>在Windows下管理你的驱动程序。在下一章节中有关于<code>Disk Genius</code>的更多介绍。</p>\n</li>\n<li><p>更换Clover的主题</p>\n<p>Clover提供了很多自定义功能，你可以选择自己喜欢的Clover开机主题。Clover的主题存放在<code>EFI/CLOVER/themes/</code>文件夹中，你可以下载你喜欢的主题文件夹并将其保存到上述路径中。然后，你需要在Clover Configurator中的<code>引导界面</code>选项卡中填写你想要设置的主题文件夹的名字（如下图）并保存。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack6.png\" alt=\"修改Clover主题\"></p>\n<p>作者目前用的是一款名为<code>Simple</code>的主题，可以点击<a href=\"https://github.com/burpsuite/clover_theme\">此处</a>下载。在GitHub上还有很多不同的Clover主题可供选择。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack7.png\" alt=\"作者正在使用的Simple主题\"></p>\n</li>\n<li><p>隐藏你不需要的卷标</p>\n<p>如果你的Clover启动界面有很多引导同一系统的卷标，你可以将他们隐藏起来。具体方法是，Clover Configurator中的<code>引导界面</code>选项卡中的<code>隐藏卷</code>一栏中填写你想要隐藏的卷标的名称，然后保存文件。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack8.png\" alt=\"隐藏你不需要的卷标\"></p>\n</li>\n</ul>\n<p>Clover的主要功能就介绍到这里了。由于本文是纯粹的新手向，在这里就不介绍如何配置<code>config.plist</code>了。一般来说，只要你能够找到完全对应你机型的EFI文件，基本上就不需要再重新配置Clover了。下面，我们再简单介绍一下新时代的引导工具：OpenCore。</p>\n<h4 id=\"OpenCore\"><a href=\"#OpenCore\" class=\"headerlink\" title=\"OpenCore\"></a>OpenCore</h4><p>OpenCore是一个着眼于未来的先进的开源引导工具，他支持多种主流操作系统的引导。OC的历史使命就是有朝一日代替Clover，成为主流。OC主要有以下几个优势：</p>\n<ul>\n<li>从 2019 年 9 月以后, Acidanthera（神级大佬，黑苹果现有的大部分驱动目前都是他在开发管理）开发的内核驱动 （Lilu, AppleALC 等）将<strong>不再会</strong>在 Clover 上做兼容性测试（虽然这不能算是优势，但是很关键好吗！）</li>\n<li>OC的安全性更好，对文件保险箱（FileVault）有更强大的支持</li>\n<li>OC使用更先进的方法注入第三方内核驱动（也就是你<code>EFI/CLOVER/kexts/Other</code>里面的那些<code>kext</code>文件）</li>\n<li>OC在启动体验上会更加接近白苹果</li>\n</ul>\n<p>当然，为什么现在OC还未能成为主流，首先是因为它还处于开发阶段，各方面还未达到最成熟的状态；其次是因为OC的配置相对于Clover要复杂许多，而且目前没有像Clover Configurator一样直观的图形化界面的配置工具；最后是因为，OC在社区中普及程度不高，导致遇到问题很难找到现成的案例解决。这些原因使很多人放弃了折腾。但是历史的发展是一个螺旋上升的过程，未来将一定是OC的！（笑）</p>\n<h3 id=\"黑苹果的初步安装\"><a href=\"#黑苹果的初步安装\" class=\"headerlink\" title=\"黑苹果的初步安装\"></a>黑苹果的初步安装</h3><p>讨论完了黑苹果的原理以及核心，下一步就该讲讲如何安装了！但是请大家注意，因为这篇文章主要是面向新手的，所以我只会介绍一些最最基本和通用的操作，目的是为了让大家先把黑苹果装上。而安装完成以后的那些各种优化的操作，包括配置Clover的配置文件，给系统打补丁等定制性比较强的内容，都<strong>不会</strong>在本文中涉及。博主可能在接下来一段很长的时间内陆陆续续更新一些系统优化的内容，敬请期待！闲话少说，我们开始吧！</p>\n<hr>\n<h4 id=\"制作安装盘\"><a href=\"#制作安装盘\" class=\"headerlink\" title=\"制作安装盘\"></a>制作安装盘</h4><p>下面的操作均在Windows系统下进行。</p>\n<ul>\n<li><p>在<a href=\"https://blog.daliansky.net\">黑果小兵的部落阁</a>按照你的需要下载某个版本的系统镜像文件（后缀为<code>iso</code>）</p>\n</li>\n<li><p>打开<code>WinMD5</code>软件，将下载完成的<code>iso</code>镜像文件拖入软件窗口，与网站上提供的<code>md5</code>值比对，校验<code>md5</code>值是否正确，如不正确，请重新下载（<code>md5</code>值相当于一个文件的身份证号码，它的值是唯一的，如果你下载下来的文件的<code>md5</code>值与官方提供的不一样，说明你下载的文件可能被修改过或者出错了）</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322163623208.png\" alt=\"校验MD5值\" style=\"zoom:50%;\" />\n</li>\n<li><p>找到一个容量为16GB或以上的<strong>空U盘</strong>，插入电脑</p>\n</li>\n<li><p>以管理员身份打开<code>TransMac</code>软件，在窗口中左侧列表鼠标右击你的U盘，点击<code>Restore With Disk Image</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164230903.png\" alt=\"Restore with Disk Image\" style=\"zoom:50%;\" />\n</li>\n<li><p>点击后有可能会弹出下图所示的警告，是提示你的U盘可能含有已经挂载的卷，请确保你选择的U盘是正确的，然后点击<code>Yes</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164627959.png\" alt=\"请确保你选择的U盘正确！\" style=\"zoom:50%;\" />\n</li>\n<li><p>在弹出的窗口中选择你刚才下载好的<code>iso</code>文件，点击<code>OK</code>，这个时候会<strong>格式化</strong>你的U盘并把系统镜像烧录到你的U盘中，耐心等待安装盘制作完成吧，这一过程大约要持续20~30分钟</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164435201.png\" alt=\"选择镜像文件\" style=\"zoom:50%;\" />\n\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322165214199.png\" alt=\"等待时间，来杯卡布奇诺\" style=\"zoom:50%;\" />\n</li>\n<li><p>制作完成以后会弹出对话框，直接点击<code>OK</code></p>\n</li>\n<li><p>在此之后系统会提示你要格式化U盘，不必理会，直接点击<code>取消</code></p>\n</li>\n</ul>\n<hr>\n<h4 id=\"替换安装盘中的EFI文件\"><a href=\"#替换安装盘中的EFI文件\" class=\"headerlink\" title=\"替换安装盘中的EFI文件\"></a>替换安装盘中的EFI文件</h4><p>安装macOS时，我们运行的是在U盘上的<code>macOS安装程序</code>，这一步与运行macOS其实是差不多的。此时我们的U盘就相当于一个外置的系统盘，需要通过位于U盘上的Clover引导来启动<code>macOS安装程序</code>。</p>\n<p>为了可以正确引导操作系统，不同型号，甚至不同批次的电脑的EFI文件都是不太一样的。因为这些电脑之间的硬件有所区别，所以你需要确保你的电脑的EFI文件是与你的电脑硬件适配的。这个问题的原理我们已经在前面提到过了。</p>\n<p>但是这个软硬件适配的工作对于小白来说极度不友好，因为这需要一部分的数字电路，微型计算机原理，以及代码编写的知识。那有什么办法可以解决这个问题呢？答案就是：“拿来主义”。多亏了开源社区的发展，有许多人在网站上将他们已经完善的EFI文件分享给其他使用同一型号电脑的人。所以你现在要做的就是：找到与你的电脑型号对应的EFI文件，然后下载下来。</p>\n<p>daliansky整理了一个清单，里面收集了大量不同机型的EFI文件，你可以在里面找找有没有自己电脑的型号：<a href=\"https://blog.daliansky.net/Hackintosh-long-term-maintenance-model-checklist.html\">Hackintosh黑苹果长期维护机型整理清单</a>。如果有的话，点击链接，然后将别人提供的这个EFI文件下载下来即可。</p>\n<p>这时有人会问了，如果没找到自己电脑的型号怎么办呢？不要气馁，你也可以尝试使用与你的电脑硬件配置类似的其他机型的EFI文件，或者使用daliansky提供的镜像中的通用EFI文件。</p>\n<p>按照daliansky的建议，在安装macOS时不必将镜像中的通用EFI文件替换为对应自己机型的EFI文件。但是我个人认为，如果你已经找到了与你的机型对应的EFI文件，那么在安装之前就将其更换，可能会在安装过程中避免一些错误的发生。</p>\n<p>下面就来介绍一下如何替换安装盘中的EFI文件吧！</p>\n<ul>\n<li><p>打开<code>DiskGenius</code>软件，在左侧列表中找到你已经制作好的安装盘，并单击选中</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322172930142.png\" alt=\"选择你已经制作好的安装盘\" style=\"zoom:50%;\" />\n</li>\n<li><p>依次双击右侧列表中的<code>ESP(0)</code>卷标，<code>EFI</code>文件夹，进入如下页面</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322173254704.png\" style=\"zoom:50%;\" />\n</li>\n<li><p>单击<code>CLOVER</code>文件夹，然后按<code>delete</code>键，弹出对话框后点击<code>删除</code>，将这个文件夹删除掉</p>\n</li>\n<li><p>选中你从别人那儿拿来的EFI文件中的<code>CLOVER</code>文件夹，按下<code>Ctrl+C</code>后将窗口切回<code>DiskGenius</code>，然后再按下<code>Ctrl+V</code>将新的<code>CLOVER</code>文件夹复制进去，这样就完成了EFI文件的替换了</p>\n</li>\n</ul>\n<hr>\n<h4 id=\"给硬盘分区\"><a href=\"#给硬盘分区\" class=\"headerlink\" title=\"给硬盘分区\"></a>给硬盘分区</h4><p>接下来我们要在电脑的硬盘上给即将安装的macOS分配一块足够大的空间。</p>\n<p>以下操作均在Windows下的<code>DiskGenius</code>软件中进行，且以我的U盘作为示例，操作方法与在电脑内置硬盘上的一样。在进行以下操作之前，请先备份你的文件。</p>\n<ul>\n<li><p>打开<code>DiskGenius</code>软件，在右侧列表中选中你的硬盘，然后在顶部查看你的硬盘空间分配情况，在顶部最左侧找到你的EFI分区，确保你的EFI分区的空间大于200MB，否则macOS将无法安装</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/image-20200322174413977.png\" alt=\"\"></p>\n</li>\n<li><p>右键单击你的硬盘，选择<code>转换分区表类型为GUID</code>模式，否则macOS将无法安装，如果这个选项是灰色的而下一个选项可选，则无须转换</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322174834408.png\" alt=\"转换为GUID格式\" style=\"zoom:50%;\" />\n</li>\n<li><p>右键单击上方的蓝色容量条，点击<code>建立新分区</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175353564.png\" alt=\"建立新分区\" style=\"zoom:50%;\" />\n</li>\n<li><p>在弹出的窗口中调整你要分给macOS的容量大小，然后点击<code>开始</code>，接下来会有弹窗出现，请<strong>严格遵守弹窗中给出的要求</strong>操作，以免发生意外，然后点击<code>是</code>，开始分区</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175546512.png\" style=\"zoom:50%;\" />\n\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181027988.png\" alt=\"别怪我没提醒你!\" style=\"zoom:50%;\" />\n</li>\n<li><p>分区完成以后，右键单击顶部蓝色容量条，点击<code>删除当前分区</code>（因为macOS的磁盘格式为APFS，因此现在对其进行格式化没有意义）</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181359400.png\" style=\"zoom:50%;\" />\n\n</li>\n</ul>\n<hr>\n<h4 id=\"设置BIOS\"><a href=\"#设置BIOS\" class=\"headerlink\" title=\"设置BIOS\"></a>设置BIOS</h4><p>前文已经说过，操作系统的启动顺序是<code>UEFI/BIOS-&gt;CLOVERX64.efi-&gt;OS</code>。因此，为了使我们的电脑可以启动安装盘上的<code>macOS安装程序</code>，我们还需要正确设置我们的BIOS。</p>\n<p>由于不同品牌的电脑使用不同的主板，所以BIOS的设置以及进行操作的键位也千差万别，这里仅以作者的电脑举例。由于作者电脑的BIOS十分垃圾，可供调整的选项寥寥无几，因此下面所给出的操作步骤中的设置配置要求是最基本的。如果你的电脑的BIOS功能足够强大且有很多其他的设置选项的话，请尽量弄懂这些选项的含义，并按照需要进行设置。</p>\n<ul>\n<li><p>按下开机按钮以后，迅速按<code>F10</code>进入BIOS设置</p>\n</li>\n<li><p>按方向键进入<code>系统设置</code>菜单中的<code>启动选项</code>，请开启<code>传统模式</code>，禁用<code>安全启动模式</code>，启用<code>USB启动</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack11.JPG\" style=\"zoom:50%;\" />\n</li>\n<li><p>按<code>F10</code>保存设置，电脑将自动重启</p>\n</li>\n</ul>\n<p>现在BIOS也已经设置完成。做完这些前期准备工作以后，接下来就要正式开始安装系统了！</p>\n<hr>\n<h4 id=\"安装系统\"><a href=\"#安装系统\" class=\"headerlink\" title=\"安装系统\"></a>安装系统</h4><p>下面以macOS 10.15.3的安装过程为例。</p>\n<ul>\n<li><p>重启电脑，看到左下角的提示以后，按<code>esc</code>暂停启动</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack10.JPG\" alt=\"这是惠普的BIOS操作方法\" style=\"zoom:50%;\" />\n</li>\n<li><p>进入<code>启动菜单</code>，按<code>F9</code>进入<code>启动设备选项</code></p>\n</li>\n<li><p>在列出的一串引导中，选择<code>USB硬盘（UEFI）</code>的选项以启动安装盘中的引导，如果你使用的是daliansky提供的较新的系统镜像，安装盘中会出现两个引导，一个是微PE（后面会提到），另一个是Clover，我们需要启动的是Clover</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack12.JPG\" style=\"zoom:50%;\" />\n</li>\n<li><p>进入Clover界面以后，按照前文所说过的方法，开启啰嗦模式</p>\n</li>\n<li><p>如果你需要使用镜像中的通用EFI文件，那么请执行下面的步骤，否则直接跳过：</p>\n<ul>\n<li><p>在Clover主界面按<code>O</code>进入选项，光标移动到<code>Configs</code>后按回车进入进入该选项，这个选项是用来选择需要生效的Clover配置文件的</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/2_Clover_Configs.png\" alt=\"选择Configs(Credit: daliansky)\"></p>\n</li>\n<li><p>选择<code>config_Install</code>这个配置文件</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/3_Clover_Select_Installer.png\" alt=\"选择config_Install(Credit: daliansky)\"></p>\n</li>\n<li><p>按两次<code>esc</code>返回到Clover主界面</p>\n</li>\n</ul>\n</li>\n<li><p>在Clover主界面选择卷标<code>Boot macOS Install from Install macOS Catalina</code>，然后按下回车，开始引导安装程序</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/1_Clover_Installer.png\" alt=\"开始引导(Credit: daliansky)\"></p>\n</li>\n<li><p>这个时候会出现如下图所示的安装日志，如果你很不幸地卡住了，那么你可以参考<a href=\"https://blog.daliansky.net/Common-problems-and-solutions-in-macOS-Catalina-10.15-installation.html\">macOS Catalina 10.15安装中常见的问题及解决方法</a>，或者附上你卡住的地方的照片和你的电脑配置，在各种交 流 群中询问大佬</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack2.jpg\" alt=\"这是一个群友的求助图片，出现的问题是卡ec了\"></p>\n</li>\n<li><p>如果没有卡住，你的日志会消失，然后出现苹果的logo和进度条</p>\n<p><img src=\"http://7.daliansky.net/Air13/1.png\" alt=\"白苹果(Credit: daliansky)\"></p>\n</li>\n<li><p>等待一段时间以后，会出现语言选择界面，请选择中文并点击<code>继续</code>，如果有装逼需求或者想练习外语，你也可以选择其他语言</p>\n<p><img src=\"http://7.daliansky.net/Air13/4.png\" alt=\"还是选择中文吧(Credit: daliansky)\"></p>\n</li>\n<li><p>选择<code>磁盘工具</code>并点击<code>继续</code></p>\n<p><img src=\"http://7.daliansky.net/10.15.3/3.png\" alt=\"实用工具(Credit: daliansky)\"></p>\n</li>\n<li><p>进入磁盘工具以后，在左上角右键点击你的磁盘，并选择<code>显示所有设备</code>，并找到你之前已经准备好安装macOS的分区</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/4.png\" alt=\"选择显示所有设备\"></p>\n</li>\n<li><p>选中你之前已经准备好安装macOS的分区，然后点击<code>抹掉</code>，在弹出的窗口中，你需要给你的分区起一个名字，并将格式设置成<code>APFS</code>，然后将方案设置为<code>GUID分区图</code>，再点击<code>抹掉</code>，这一步会将你电脑上的硬盘分区格式化</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/6.png\" alt=\"抹掉磁盘(Credit: daliansky)\"></p>\n</li>\n<li><p>操作完成以后，点击左上方<code>磁盘工具</code>，在弹出的选项中选择<code>退出磁盘工具</code>并返回到安装界面</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/8.png\" alt=\"退出磁盘工具(Credit: daliansky)\"></p>\n</li>\n<li><p>在主界面选择<code>安装macOS</code>并点击<code>继续</code>，再闭着眼睛同意条款</p>\n</li>\n<li><p>在下图所示的界面中选择你要安装的磁盘分区，然后点击<code>安装</code>，接下来安装程序会将安装文件复制到你的分区中，这个过程会持续几分钟，待复制完成以后，电脑会重新启动</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/12.png\" alt=\"选择你准备好的那个磁盘分区(Credit: daliansky)\"></p>\n</li>\n<li><p>重启之后，按照本节一开始所述方法进入Clover，这时候你会发现，Clover主界面会多出来几个卷标，从现在开始直到安装完成，请都选择<code>Boot macOS Install form xxx（你给你的macOS分区起的名字）</code>卷标启动，在安装过程中请耐心等待，无论你做了什么奇怪的事情让你增加了什么奇怪的知识，都不要在出现白苹果logo的时候乱动鼠标或者键盘</p>\n</li>\n<li><p>经过两到三次重启以后，你会发现<code>Boot macOS Install form xxx</code>的卷标消失了，新出现了<code>Boot macOS form xxx</code>的卷标，选中它，然后进入，再对着白苹果等待几分钟，难得的休息时间马上就要结束了</p>\n</li>\n<li><p>进度条走完，出现设置向导，接下来会让你设置你的国家和地区，语言和输入法，按照你的需要设置即可，然后会进入<code>数据和隐私</code>界面，点击<code>继续</code></p>\n<p><img src=\"http://7.daliansky.net/Air13/22.png\" alt=\"选择国家和地区(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来会问你是否需要将macOS从你的备份中恢复，黑苹果玩家一无所有，选择<code>现在不传输任何信息</code>并点击<code>继续</code></p>\n<p><img src=\"http://7.daliansky.net/Air13/25.png\" alt=\"没有备份，无需恢复(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来要你使用Apple ID登陆，这里先跳过</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/15.png\" alt=\"不要登陆！登陆了也没用(Credit: daliansky)\"></p>\n</li>\n<li><p>还是闭着眼接受条款</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/16.png\" alt=\"接受就完事了(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来你需要创建一个电脑用户，这是一个管理员帐户，请注意，在这里设置了用户名以后，如果未来要更改的话会极为麻烦，建议想清楚了再继续下一步</p>\n<p><img src=\"http://7.daliansky.net/Air13/30.png\" alt=\"不要起什么奇奇怪怪的名字(Credit: daliansky)\"></p>\n</li>\n<li><p>进入<code>快捷设置</code>页面，点击<code>继续</code>，然后会进入<code>分析</code>页面，取消勾选<code>与App开发共享崩溃与使用数据</code>，黑苹果这种东西自己偷摸着用就行</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/17.png\" alt=\"不要共享(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来还会要你设置屏幕使用时间，Siri，以及外观，这些选项按照你的需要设置就行，一路<code>继续</code>下去，直到出现<code>正在设置你的Mac</code>页面，请稍等片刻</p>\n<p><img src=\"http://7.daliansky.net/Air13/34.png\" alt=\"即将完成！(Credit: daliansky)\"></p>\n</li>\n<li><p>终于进入了桌面，这时macOS的基本安装已经完成了！先庆祝一下，折腾的事情还在后头呢（虽然这篇文章不会写吧……）</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack9.png\" alt=\"老二次元了doge\"></p>\n</li>\n</ul>\n<hr>\n<h4 id=\"将引导添加到硬盘并调整顺序\"><a href=\"#将引导添加到硬盘并调整顺序\" class=\"headerlink\" title=\"将引导添加到硬盘并调整顺序\"></a>将引导添加到硬盘并调整顺序</h4><p>现在，macOS已经成功安装到我们电脑的硬盘上了，但是我们电脑硬盘上的macOS还是通过U盘里的Clover引导的。这就意味着，如果拔掉U盘，我们将不能够启动macOS。所以我们需要将U盘引导区中的Clover文件夹复制到硬盘引导区的EFI文件夹中，以实现脱离U盘启动。这一步的操作与前文<code>替换安装盘中的EFI文件</code>这一小节的操作基本是一致的，需要你在Windows系统下使用<code>DiskGenius</code>操作，这里就不再赘述了。</p>\n<p>如果现在重启电脑，你还是会发现直接进入了Windows的引导而不是Clover。这是因为除了Clover之外，电脑当然还有许多其他的引导项，这些引导项按顺序排列在启动序列之中。现在我们只是把Clover的文件夹放入了硬盘的引导区中，但是还没有把Clover添加到启动序列之中。电脑不知道自己居然还可以用Clover引导macOS，只能继续用老一套方法直接引导Windows启动了。那么下面我们就要告诉电脑，让它知道自己可以使用Clover引导操作系统。下面的操作都是在Windows下进行的。</p>\n<ul>\n<li><p>打开<code>EasyUEFI</code>软件，你可以看到所有的引导项之中没有Clover，点击红框中按钮创建新的引导项</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405233601042.png\" alt=\"创建引导项\" style=\"zoom:50%;\" />\n</li>\n<li><p>在弹出的窗口中，<code>类型</code>选择<code>Linux或者其它操作系统</code>，<code>描述</code>可以随便填写，这里使用的是<code>CLOVER</code>，目标分区选择<code>磁盘0</code>的ESP分区（唯一可选的那一个）</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234307270.png\" style=\"zoom:50%;\" />\n</li>\n<li><p>在<code>文件路径</code>一行中，点击<code>浏览</code>，在弹出的窗口中显示了一个硬盘的图标，这个就是你电脑上硬盘的ESP分区了，点击它左侧的加号将其展开，在EFI文件夹中找到<code>CLOVERX64.efi</code>，这个就是Clover的引导文件，选中后点击<code>确定</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234725001.png\" style=\"zoom:50%;\" />\n</li>\n<li><p>回到原先的界面之后，点击<code>确定</code>，可以发现Clover已经添加到启动序列中了</p>\n</li>\n<li><p>到这里还没结束，因为Clover被上面众多引导项压着，启动的时候怎么也轮不到它，因此我们点击红框中的按钮，将Clover移到启动序列的第一位，使电脑开机的时候默认使用Clover引导操作系统</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405235126649.png\" style=\"zoom:50%;\" />\n\n</li>\n</ul>\n<p>现在再重启电脑，不要按<code>esc</code>暂停启动，电脑会默认使用Clover进行引导。选择macOS分卷，按回车进入。如果成功启动了，那么你便可以重新设置你的BIOS，将<code>传统模式</code>关闭了（但不要开启<code>安全启动模式</code>）。</p>\n<p>到这里，macOS的前期安装已经正式完成！夸赞一波自己吧！</p>\n<hr>\n<h4 id=\"黑苹果单系统安装\"><a href=\"#黑苹果单系统安装\" class=\"headerlink\" title=\"黑苹果单系统安装\"></a>黑苹果单系统安装</h4><p>按照上面所说的步骤，如果不出问题，你便在电脑上成功安装了Windows和macOS双系统。如果你只需要macOS的单系统，操作步骤与上面所说有些许不同，但是绝大部分步骤是一样的，唯一的区别在于<code>给磁盘分区</code>和<code>将引导添加到硬盘并调整顺序</code>这两部步。如果你在制作安装盘的时候，下载的是daliansky提供的较新系统版本的镜像，或者你在制作完系统启动U盘以后，在<code>此电脑</code>中可以看到有诸如<code>微PE</code>字样的磁盘，那么下面步骤中的前三步可以省略掉。大致的操作方法如下：</p>\n<ul>\n<li>于<a href=\"http://www.wepe.com.cn/download.html\">官网</a>下载<code>微PE工具箱V2.0 64位版本</code></li>\n<li>打开软件，将微PE工具安装到你的已经制作好的macOS安装盘中</li>\n<li>将<code>DiskGenius</code>和<code>UEFIManager</code>拷贝到微PE的文件盘中（微PE系统中本身自带非专业版的<code>DiskGenius</code>，某些功能有缺失）</li>\n<li>设置BIOS</li>\n<li>重启，在BIOS中使用安装盘中微PE的引导启动</li>\n<li>进入系统后你可以发现界面与Windows10几乎一样，运行你存放在U盘中的<code>DiskGenius</code>，删除你硬盘中Windows使用的分区，并删除硬盘EFI分区的Windows文件夹</li>\n<li>将硬盘分区表类型转换为<code>GUID</code>格式</li>\n<li>按照你的需要以及前文所述要求，重新分配你的硬盘分区，并将他们格式化</li>\n<li>接下来就是安装系统了，如果一切顺利进入了macOS的桌面，你可以继续下面的步骤</li>\n<li>重启，使用安装盘中微PE的引导启动</li>\n<li>运行<code>DiskGenius</code>，将安装盘EFI文件夹中<code>CLOVER</code>文件夹复制到电脑硬盘的EFI文件夹中</li>\n<li>运行<code>UEFIManager</code>，然后参考上文所说的方法，添加并调整你的引导项</li>\n<li>如果没有问题，关闭BIOS的<code>传统模式</code>启动</li>\n<li>大功告成！</li>\n</ul>\n<h3 id=\"安装完成后可能出现的问题\"><a href=\"#安装完成后可能出现的问题\" class=\"headerlink\" title=\"安装完成后可能出现的问题\"></a>安装完成后可能出现的问题</h3><p>完成macOS的安装并不代表你的电脑就已经是可堪重用的生产力/娱乐工具了。绝大多数情况下，刚刚完成安装的黑苹果还会存在着各种各样的问题。即使你使用的是完全对应你的电脑型号的EFI文件，依然有大概率会出现这些问题。<strong>黑苹果的折腾之处不是安装macOS的过程，而是完全解决这些问题的过程。</strong>所以这就是为什么我建议大家不要在安装的最后几步（包括完成安装以后）登陆你的苹果服务，因为你的电脑存在的一些问题会导致苹果服务登不上去，而且折腾的过程也有可能把你的Apple ID中的信息搞乱，就像下图一样。</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack13.JPG\" alt=\"瞬间富有\" style=\"zoom:50%;\" />\n\n<p>安装完成以后，大家可以检查一下自己的电脑有没有出现下面列出的这些问题。下面的检查大部分都在macOS的设置中完成，还有一些直接观察即可。在每个问题的末尾都会给大家提供一些解决问题的思考方向，但并不会提供具体的解决办法。另外还附上了无故障发生的效果图供大家参考。</p>\n<ul>\n<li><p>网络与蓝牙的问题：下面的这些问题与你的<strong>网卡的型号或者驱动</strong>有关</p>\n<ul>\n<li>打开<code>系统偏好设置-网络</code>选项，里面没有有Wi-Fi选项，即使有也打不开Wi-Fi</li>\n<li>打开<code>系统偏好设置-蓝牙</code>选项，无法开启蓝牙</li>\n<li>无法使用随航</li>\n<li>无法使用Siri，FaceTime，iMessage</li>\n</ul>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack14.png\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack15.png\" alt=\"\"></p>\n</li>\n<li><p>声音的问题：这个问题的表现形式很多，出现这些问题是因为<strong>声卡没有驱动</strong></p>\n<ul>\n<li>打开系统<code>系统偏好设置-声音</code>选项，无法调节音量</li>\n<li>勾选<code>当更改音量时播放反馈</code>再调节音量，电脑没有声音</li>\n<li>麦克风没有输入电平的变化</li>\n<li>使用快捷键调节音量，喇叭图标下出现禁行标志</li>\n</ul>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack16.png\" alt=\"\"></p>\n</li>\n<li><p>触控板的问题：触控板根本没有反应，或者在<code>系统偏好设置-触控板</code>选项中某些手势无法使用，或者某些功能不显示，这个问题与你的<strong>触控板驱动</strong>有关</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack17.png\" alt=\"\"></p>\n</li>\n<li><p>显示的问题：这个问题也涉及到很多方面，注意<strong>下面给出的图片是错误示例，不是正确的打开方式</strong></p>\n<ul>\n<li><p>色偏严重：这个问题与你的<strong>显示器描述文件和EDID</strong>有关</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack18.JPG\" alt=\"严重的色偏\"></p>\n</li>\n<li><p>文字显示过小，图标与文字比例失调：这个问题与你的<strong>EDID以及是否开启了HiDPI</strong>有关</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack19.png\" alt=\"失调的比例\"></p>\n</li>\n<li><p>出现颜色断层：这个问题与你的<strong>EDID和显卡缓冲帧</strong>有关</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack20.jpg\" alt=\"断层的色彩\" style=\"zoom:50%;\" />\n</li>\n<li><p>无法调节亮度：在<code>系统偏好设置-显示器</code>选项中没有亮度调节条，键盘上的亮度调节快捷键也没有反应，这个问题可能与你的<strong>亮度调节驱动或者系统补丁</strong>有关</p>\n</li>\n</ul>\n</li>\n<li><p>电源管理的问题：这个问题的表现形式很多，导致这个问题产生的原因也很多</p>\n<ul>\n<li><p>节能管理未加载：在<code>系统偏好设置-节能</code>选项中没有将4个（台式机为5个）选项全部加载，出现这个问题是因为你<strong>没有加载macOS原生的电源管理</strong></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack21.png\" alt=\"\"></p>\n</li>\n<li><p>睡眠失灵：睡眠秒醒或者睡眠自动关机/死机/重启，这个问题与你的<strong>电源管理或者USB驱动</strong>有关</p>\n</li>\n</ul>\n</li>\n<li><p>USB总线的问题：USB接口部分或者全部失灵，打开<code>Photo Booth</code>后摄像头无画面，这个问题与你的<strong>USB驱动</strong>有关（话说回来<code>Photo Booth</code>还是蛮有意思的😂）</p>\n</li>\n<li><p>独立显卡无法驱动：黑苹果下只有部分独立显卡可以驱动，如果你的独显<strong>有独立输出并且满足特定型号要求</strong>的话可以尝试将其驱动，否则你就需要屏蔽独显，使用集显了，这里不展开叙述</p>\n</li>\n</ul>\n<p>另外，你也可以在<code>左上角苹果图标-关于本机-系统报告</code>中直接查看你电脑的硬件情况。通过检查各个硬件的驱动情况和相关数据，一样可以判断你的电脑是否会有上面的问题。</p>\n<p>上面给大家介绍的都是一些典型的问题，你也有可能遇到其他的疑难杂症。希望大家面对问题不要望而却步，尽情享受折腾的过程吧！</p>\n<p>(～￣▽￣)～</p>\n<h3 id=\"黑苹果相关资源推荐\"><a href=\"#黑苹果相关资源推荐\" class=\"headerlink\" title=\"黑苹果相关资源推荐\"></a>黑苹果相关资源推荐</h3><p>折腾黑苹果，宜广集信息，多多提问；忌盲目瞎搞，重复建设。</p>\n<h4 id=\"黑苹果相关优秀网站\"><a href=\"#黑苹果相关优秀网站\" class=\"headerlink\" title=\"黑苹果相关优秀网站\"></a>黑苹果相关优秀网站</h4><ul>\n<li><a href=\"https://blog.daliansky.net\">黑果小兵的部落阁</a>：也就是daliansky——国内黑苹果领军人物的博客，他的网站会非常及时地更新系统镜像并不定时地提供一些精品教程</li>\n<li><a href=\"https://www.itpwd.com\">IT密码</a>：网站上面的资源非常丰富，从系统镜像到软件资源再到方法技巧一应俱全，博主也是非常牛啤的</li>\n<li><a href=\"https://oc.skk.moe\">OC简体中文参考手册</a>：由业界大佬合力完成，仍在维护中，学习OC必备</li>\n<li><a href=\"https://github.com\">GitHub</a>：这个不用多说了，绝大部分黑苹果软件和驱动的来源，全球最大同性交友网站🐶，神奇的地方</li>\n<li><a href=\"http://www.pcbeta.com\">远景论坛</a>：国内最主要的黑苹果交流论坛，注册需要邀请码</li>\n<li><a href=\"https://www.tonymacx86.com\">tonymacx86</a>：国外知名的黑苹果交流论坛，资源丰富，需要一定的英语能力</li>\n<li><a href=\"https://www.insanelymac.com/forum/\">insanelymac</a>：与tonymacx86类似的论坛</li>\n</ul>\n<h4 id=\"黑苹果软件、驱动资源\"><a href=\"#黑苹果软件、驱动资源\" class=\"headerlink\" title=\"黑苹果软件、驱动资源\"></a>黑苹果软件、驱动资源</h4><p>下面只列出了一些至关重要的驱动和软件，其他功能的还有很多，这里就不一一列出了。</p>\n<ul>\n<li><a href=\"https://mackie100projects.altervista.org/download-clover-configurator/\">Clover Configurator</a>：Clover的图形化配置软件</li>\n<li><a href=\"https://github.com/headkaze/Hackintool/releases\">Hackintool</a>：黑苹果完善必备工具</li>\n<li><a href=\"https://github.com/CloverHackyColor/CloverBootloader/releases\">Clover</a>：在这里可以找到已经编译好的Clover</li>\n<li><a href=\"https://github.com/acidanthera/Lilu/releases\">Lilu.kext</a>：众多常用驱动的依赖</li>\n<li><a href=\"https://github.com/acidanthera/AppleALC/releases\">AppleALC.kext</a>：常用声卡驱动</li>\n<li><a href=\"https://github.com/acidanthera/VoodooPS2/releases\">VoodooPS2Controller.kext</a>：PS2总线输入设备（鼠标，键盘，触控板）的驱动，此外对于I2C总线的输入设备还有VoodooI2C.kext</li>\n<li><a href=\"https://github.com/acidanthera/VoodooInput/releases\">VoodooInput.kext</a>：VoodooPS2Controller的依赖</li>\n<li><a href=\"https://github.com/acidanthera/WhateverGreen/releases\">WhateverGreen.kext</a>：用于驱动Intel集成显卡</li>\n<li><a href=\"https://bitbucket.org/RehabMan/os-x-fakesmc-kozlek/downloads/\">FakeSMC.kext</a>：必备驱动，用于仿冒SMC设备，欺骗macOS，让它以为我们的电脑就是Mac</li>\n</ul>\n<h3 id=\"声明与致谢\"><a href=\"#声明与致谢\" class=\"headerlink\" title=\"声明与致谢\"></a>声明与致谢</h3><p>黑苹果社区的健康需要大家共同维护，恳请新人们注意以下几点：</p>\n<ul>\n<li>不要把社区的成果（如各种机型的EFI，开源软件等）拿来作商业用途</li>\n<li>不要购买淘宝上面的EFI！所有现存的EFI都可以在网上免费获得！请不要支持那些兜售EFI的无良商家，他们也是从网上下载的</li>\n<li>不建议去淘宝上购买安装黑苹果的服务，出了问题到最后还是要你自己解决</li>\n<li>不建议把自己的折腾成果在网络上有偿提供，这样并不利于社区的发展</li>\n<li>网友没有义务去无偿地帮你解决问题，另外也请善用搜索引擎</li>\n</ul>\n<p>黑苹果一开始是极客的产物，是反叛精神的象征。令人意料不到的是，现在它居然可以为我们普通人所用。而从极客到大众的过渡，黑苹果的开源社区对此作出了极大贡献。对那些对社区做出过极大贡献的极客和工程师们，对社区建设贡献出自己的一份力量、努力维护社区健康发展的成员，我向你们表达最诚挚的感谢。没有社区，就没有黑苹果的今天。作为从社区中获益的普通成员，也应该通过自己的努力，以自己的方式去回馈这个社区，帮助它更好地发展。</p>\n<p>博主在此谨向你们表达我的感谢：<a href=\"https://github.com/RehabMan\">RehabMan</a>，<a href=\"https://github.com/acidanthera\">Acidanthera</a>，<a href=\"https://blog.daliansky.net\">黑果小兵</a>，<a href=\"https://github.com/SilentSliver\">SlientSliver</a>，<a href=\"https://www.itpwd.com\">IT密码</a>，以及其他给予过我帮助的网友或开发者们😘。</p>\n<p>附：<a href=\"https://pan.baidu.com/s/17yVMb2FQyzfK2sAYbHuZnw\">软件度盘链接</a> ，密码：3lkx。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n在这篇文章写成之后不久，Apple推出了M1芯片以及macOS Big Sur。这对黑苹果来说无疑是一个重大打击。虽然macOS肯定还会对使用Intel CPU的电脑继续提供几年的支持，但是如果苹果未来不再推出使用Intel CPU的电脑，那么黑苹果的未来恐怕不容乐观。另外，黑苹果社区也出现了比较大的变化。随着更先进更安全更简单的Open Core逐渐成熟，其使用者也越来越多。虽然Clover仍然保留了对最新的macOS的支持，但是其已然落后。这也就是说，在这篇文章写完之后，其内容已经过时了（悲，但如果是安装Big Sur以下版本的macOS，这篇文章还是有一定的指导意义的）。最后，出于时间和精力的考虑，博主已经不打算再折腾黑苹果了。感谢黑苹果这两年来的陪伴。\n</div>\n</article>\n","site":{"data":{}},"more":"<h3 id=\"关于黑苹果\"><a href=\"#关于黑苹果\" class=\"headerlink\" title=\"关于黑苹果\"></a>关于黑苹果</h3><p>欢迎步入黑苹果的世界！众所周知，Mac因其独特的macOS系统在众多Windows电脑中独树一帜。macOS具有许多与Windows不同的特性和优点（当然，也有不足），而且有些软件在macOS上的优化会比Windows更好或者只支持macOS平台。这就是为什么Mac在市场上一直有着广泛的需求的根本原因——即macOS的独特性。由于苹果的封闭性策略，macOS在正常情况下只能安装在Mac上。而黑苹果的出现，给广大对macOS有需求的人们提供了一个新的选择——你再也不需要为了一个系统去购买在同等硬件或性能条件下价格更为昂贵的电脑了。</p>\n<p>黑苹果，意思就是安装有macOS的，可以正常工作的非Mac的电脑，也可以指为非Mac的电脑安装macOS的行为，亦可以指安装在非Mac电脑上的macOS。对于这个词的确切定义还是模糊不清的，不过这不是关键所在。与黑苹果相对，白苹果的含义就非常明显了，也就是苹果的Mac或者安装在Mac上的macOS。</p>\n<p>黑苹果的原理就是通过对电脑主板的破解和对系统的欺骗，让macOS以为这是一台Mac，再通过一系列驱动和补丁使得这台电脑可以在macOS下正常运行。需要注意的是：</p>\n<p><font size=4><strong>将macOS安装在非Mac的电脑上是违反苹果公司的法律条款的！</strong></font></p>\n<p>所以安装黑苹果是存在一定的法律风险的，这有可能（但是非常非常罕见）导致你的AppleID被锁死。但是一般情况下，苹果公司对这种行为都是睁一只眼闭一只眼。只是随着黑苹果数量上的日益增长，不知道什么时候会引起苹果公司的重视并对此采取措施。而在另一方面，如果你使用黑苹果来牟利的话，性质就完全不同了，你有可能会受到法律的制裁。</p>\n<p>由于macOS从一开始就不被允许安装在非Mac的电脑上，因此安装黑苹果绝对不是一件容易的事情，它涉及到对主板的破解，对硬件的驱动，对系统的欺骗，同时也会产生很多奇奇怪怪的bug。黑苹果有很多缺点：</p>\n<ul>\n<li>不完美的黑苹果相对于白苹果不那么稳定</li>\n<li>黑苹果在硬件层面上的缺失导致很多功能无法实现，如Touch Bar，Touch ID，力度触控板等</li>\n<li>安装黑苹果仍需要满足一定的硬件条件，某些型号的硬件在黑苹果下是无法驱动的</li>\n<li>安装黑苹果费时费力，相当折腾</li>\n</ul>\n<p>既然黑苹果有那么多缺点，并且还是非法的行为，那为什么还有那么多人在使用黑苹果并且人数还在日益增长呢？因为黑苹果与同样安装有macOS的电脑相比，还是有其优点的：</p>\n<ul>\n<li><p>完美的黑苹果在使用体验上基本不输给Mac</p>\n</li>\n<li><p>黑苹果在同等硬件或性能条件下比起Mac便宜许多</p>\n</li>\n<li><p>黑苹果的定制性和可扩展性在某些方面比Mac强大许多</p>\n</li>\n</ul>\n<p>从黑苹果的优点来看，再结合实际情况，我们可以发现使用黑苹果的人群可以分为以下几类：</p>\n<ul>\n<li>对macOS有刚需，但是又不想花钱/没钱买Mac的，如某些影视、音乐工作者</li>\n<li>对macOS有刚需，但是受限于苹果封闭的生态，只能通过黑苹果的高可扩展性来满足自己对硬件的需求的特定行业从业者</li>\n<li>对macOS没有刚需，具有反叛精神的极客，专门研究操作系统和硬件的工程师，通常这类人也有白苹果</li>\n<li>对macOS没有刚需，只是想要体验macOS或苹果完整生态却又不想花钱/没钱购买Mac的人</li>\n</ul>\n<p>而博主作为一个穷学生，就是属于最后一类的人😂。我折腾黑苹果已经有1年时间，现在自己在用的电脑是惠普的<code>Envy-13 ad024TU</code>，装有Windows和macOS两个系统。博主的黑苹果已经基本完美，在使用体验上已经与白苹果相差无几。关于我的黑苹果的更多信息，可以参考我的<a href=\"https://github.com/Astrobr/HackintoshForEnvy13-ad0xx\">GitHub仓库</a>，或者我的<a href=\"https://astrobear.top/2020/02/14/HP_Envy-13_ad024TU_Hackintosh/\">另一篇博客</a>，在那篇博客里我主要总结了给自己的电脑安装黑苹果时踩过的一些坑。而这篇文章主要是针对笔记本电脑，让大家对黑苹果有一个初步的了解。看完这篇文章，你就基本入门黑苹果了。</p>\n<h3 id=\"黑苹果的原理以及核心\"><a href=\"#黑苹果的原理以及核心\" class=\"headerlink\" title=\"黑苹果的原理以及核心\"></a>黑苹果的原理以及核心</h3><h4 id=\"黑苹果的原理\"><a href=\"#黑苹果的原理\" class=\"headerlink\" title=\"黑苹果的原理\"></a>黑苹果的原理</h4><p>在讨论这个问题以前，我们先要了解一下电脑是怎么启动的。</p>\n<p>首先，在你按下开机键以后，电脑上电，各硬件进入了待命状态。CPU（Central Processing Unit，中央处理器）启动以后，按照其在设计时就固定好的功能送出了第一条指令，这一条指令将会使BIOS（Basic Input/Output System，基本输入输出系统）芯片中装载的程序开始执行。BIOS程序可以实现很多功能，比如系统自检，提供中断服务等。但是它最主要的功能则是将存放于硬盘引导区的操作系统引导程序（Boot loader，下文简称引导）装载入内存，再通过引导将操作系统装载进内存。</p>\n<p>当然，现在市面上新发售的电脑大部分都已经采用了一种更新的方式来装载引导，也就是所谓的UEFI（Unified Extensible Firmware Interface，统一可扩部件接口）。UEFI作为一种较新的方案，它和BIOS的区别主要是在可扩展性方面。但是除了一些细微的差别，它在整个启动的流程上与BIOS基本相同，且最终目的都是将引导装载进内存当中。另外在开发者圈子中，BIOS和UEFI也常常被混为一谈。因此尽管现在的主流是采用更先进的UEFI，但在下面的叙述中我还是会使用BIOS的概念。这并不会给理解带来困难，只是你们需要知道这两者有些许微妙的区别即可。</p>\n<p>也许有人会问，为什么不使用BIOS直接将操作系统装载进内存呢？首先，如果有多个操作系统，那么不同的操作系统的装载过程会有所不同。如果要让BIOS适配不同的操作系统，那么会导致它的体积过于庞大，系统过于复杂，不利于它的的稳定。其次就是，BIOS是固定在BIOS芯片中的，不方便修改。这也导致了我们难以让BIOS对不同的操作系统做适配。因此，我们需要引导来完成操作系统加载的工作。</p>\n<p>具体而言，引导需要完成的工作主要有以下几点：</p>\n<ul>\n<li>初始化其他硬件设备，为系统提供可访问的表和服务</li>\n<li>为操作系统分配内存空间，再将它加载进内存当中</li>\n<li>为高级计算机程序语言提供执行环境</li>\n<li>将控制权移交给操作系统</li>\n</ul>\n<p>在此之后，系统的完整的启动过程就结束了，操作系统接管了整个电脑。简而言之，电脑的启动过程可以概括为：<code>BIOS-&gt;Bootloder-&gt;OS(操作系统)</code>。</p>\n<p>回到黑苹果上来。我们想要在一款非Mac的电脑上运行macOS，与我们在电脑上运行Windows的最大区别在哪儿？当然是操作系统不同啊！由于macOS与Windows是两个完全不同的操作系统，因此他们启动和加载的过程也完全不同。所以我们肯定不可以用启动Windows的那一套方法去启动macOS，而必须要有专门的适应macOS的一套启动方法（程序）。</p>\n<p>我们想要将macOS加载到我们的内存当中，就要对当前我们的启动程序进行修改和适配。回顾上文所说的电脑的启动过程我们可以发现，BIOS是固定在芯片中的，不易修改。那么我们可以操作的部分就只有引导了。所以我们要找到合适的引导程序，使其可以将macOS正确地装载进内存，并给它提供正确的服务，让它可以与硬件正常交流，最终使它正常运行。</p>\n<p>通过上面的一番讲解，我们可以发现，安装黑苹果的核心就是引导。而实际上，折腾黑苹果折腾的也主要就是引导。而由于白苹果的硬件，BIOS，和引导都是针对macOS开发的，所以当然不要任何的折腾，开箱即用就行（废话……）。</p>\n<p>目前主流的可以用于在非Mac的电脑上启动macOS的引导主要有两个，分别是<code>Clover</code>和<code>OpenCore</code>（下文简称OC）。由于OC是新开发的引导，目前还在公测阶段，而且其在社区普及率远远不如Clover，所以下面将主要讲解Clover，而对于OC只作非常简单的介绍。</p>\n<h4 id=\"Clover\"><a href=\"#Clover\" class=\"headerlink\" title=\"Clover\"></a>Clover</h4><blockquote>\n<p>启动器的名字<code>Clover</code>由一位创建者kabyl命名。他发现了四叶草和Mac键盘上Commmand键（⌘）的相似之处，由此起了Clover这个名字。四叶草是三叶草的稀有变种。根据西方传统，发现者四叶草意味的是好运，尤其是偶然发现的，更是祥瑞之兆。另外，第一片叶子代表信仰，第二片叶子代表希望，第三片叶子代表爱情，第四片叶子代表运气。——摘自维基百科</p>\n</blockquote>\n<p>Clover是一个操作系统引导程序，可以通过新老两种方式进行启动，也就是BIOS方式和UEFI方式。目前主流的操作系统都已经是通过UEFI方式启动的了，如macOS，Windows 7/8/10 (64-bit)，Linux。</p>\n<p>所有的引导都是放在电脑硬盘开头部分的引导区（ESP分区）的EFI文件夹中，Clover也不例外。当然，EFI文件中还存放着Windows，Linux，或者其他操作系统的引导。下面就来看看Clover的文件结构吧。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack1.png\" alt=\"重要的文件夹和其功能在图中注明\"></p>\n<p>在Clover下使用UEFI方式启动的流程是这样的：<code>UEFI-&gt;CLOVERX64.efi-&gt;OS</code>。</p>\n<p>下面我将主要根据在实际操作中用到的一些功能来介绍Clover。</p>\n<ul>\n<li><p>进入操作系统</p>\n<p>这一步非常简单，开机之后用方向键选择你需要进入的操作系统的卷标，按下回车即可。</p>\n<p><img src=\"http://7.daliansky.net/1-main.png\" alt=\"图中出现了三种不同系统的卷标(Credit: daliansky)\"></p>\n</li>\n<li><p>显示帮助</p>\n<p>按下<code>F1</code>键会出现帮助信息。</p>\n<p><img src=\"http://7.daliansky.net/Help_F11.png\" alt=\"帮助信息(Credit: daliansky)\"></p>\n</li>\n<li><p>更新Clover</p>\n<p>请在<a href=\"https://github.com/Dids/clover-builder/releases\">这里</a>下载最新版本的<code>CLOVERX64.efi</code>并使用它替换掉你的EFI文件夹中的Clover文件夹中的同名文件。</p>\n</li>\n<li><p>开启啰嗦模式启动</p>\n<p>首先我要介绍一下什么是啰嗦模式。一般来说，我们在启动系统的时候只能看到一个进度条或者旋转的表示加载中的图案。而啰嗦模式就是将系统启动时各种详细参数和日志以及报错消息全部显示出来的模式，如下图所示。如果发生了操作系统启动异常/失败的情况，通过开启啰嗦模式，我们可以快速定位到出错的位置。</p>\n<p>开启啰嗦模式的方法很简单。首先选择你想要进入的系统的图标，按空格即可进入下图所示的页面，然后勾选图示选项，再选择<code>Boot macOS with selected options</code>启动。</p>\n<p><img src=\"http://7.daliansky.net/space-selected.png\" alt=\"开启啰嗦模式(Credit: daliansky)\"></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack2.jpg\" alt=\"开启啰嗦模式的效果\" />\n</li>\n<li><p>显示隐藏的卷标</p>\n<p>有的时候在Clover的启动页面中会出现很多以不同方式启动同一系统的卷标（Volume，可以理解为入口），我们可以通过修改Clover的配置文件来隐藏这些卷标，但是有的时候你又需要它们显示出来（比如你要通过进入<code>Recovery</code>卷标来关闭macOS的系统完整性保护的时候）。这个时候我们不必重新修改配置文件，只需要在Clover的主界面按下<code>F3</code>，即可将隐藏的卷标显示出来。</p>\n<p>关于怎么隐藏卷标，我将在下面介绍。</p>\n</li>\n<li><p>提取DSDT</p>\n<p>DSDT的全称为 Differentiated System Description Table，它是一个描述系统硬件不同信息的表，通过查阅这个表中的信息可以知道你的电脑有什么硬件，它们的名称是什么。知道这些信息有利于我们理顺硬件之间的关系，再通过修改补丁更正硬件信息，以优化操作系统的工作状况。</p>\n<p>在Clover主界面下按<code>F4</code>即可将你的DSDT信息保存到<code>EFI/CLOVER/ACPI/origin/</code>文件夹中。请注意，DSDT是由多个文件组成的。</p>\n</li>\n<li><p>选择你想要启用/禁用的驱动程序</p>\n<p>通过Clover加载的驱动程序保存在<code>EFI/CLOVER/kexts/Other</code>中，这些驱动程序是针对macOS生效的。在上面所说的那个文件夹中包含了很多不同的驱动文件，有些驱动文件之间会产生冲突，而有些驱动文件又是完全没有必要存在的。为了管理和精简你的驱动程序，你可以在Clover中设置你想要禁用的驱动程序以排查各种驱动的工作状况。</p>\n<p>首先你要选择macOS的图标，按下空格键。然后在新的页面中将光标移动到<code>Block injected kexts</code>，按下回车后进入该选项。再在新的页面中选择<code>Other</code>选项，这个时候你就可以看到你的驱动程序了。勾选你想要禁用的驱动程序以后，按<code>Esc</code>回到主页面，再直接回车进入macOS。</p>\n<p><img src=\"http://7.daliansky.net/BIKChoose.png\" alt=\"选择你想要禁用的驱动程序(Credit: daliansky)\"></p>\n<p>请注意，你的这一设置只对这一次启动有效，在之后的启动中将不会保留。</p>\n</li>\n<li><p>设置Clover（修改<code>config.plist</code>）</p>\n<p>有多种方法进行设置。</p>\n<ul>\n<li><p>你可以在开机以后的Clover主界面下按下按键<code>O</code>进入设置页面，然后你就可以选择不同的选项开始修改你的配置文件了，不过一般情况下我们不会使用这种<code>抽象</code>的方式来修改</p>\n<p><img src=\"http://7.daliansky.net/options.png\" alt=\"Clover的设置页面(Credit: daliansky)\"></p>\n</li>\n<li><p>使用Clover Configurator来修改</p>\n<p>Clover Configurator是一款运行在macOS下的应用程序，专门用来修改Clover的配置文件。它具有友好的图形化界面，每个选项都有比较详细的功能说明，操作起来比在启动时修改要轻松得多。Clover Configurator的下载链接放在文末。</p>\n<p>在设置以前，你需要在Clover Configurator的<code>挂载分区</code>选项卡中挂载你ESP分区（通常情况下这个分区都是隐藏的）。然后在你的Clover文件夹下使用Clover Configurator打开<code>config.plist</code>文件，进行修改。修改完成以后，请点击左下角的保存图标（图中以红框标明）。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack3.png\" alt=\"Clover Configurator的设置界面\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack4.png\" alt=\"Clover Configurator的设置界面\"></p>\n</li>\n<li><p>你还可以使用普通的文本文档编辑器（如Xcode或者Visual Studio Code）打开<code>config.plist</code>对其进行编辑，但是这个方法依旧比较<code>抽象</code>，不推荐新手或者代码小白这样操作</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack5.png\" alt=\"在Visual Studio Code中打开的Clover配置文件\"></p>\n</li>\n</ul>\n</li>\n<li><p>增加/删除/修改/查找驱动程序</p>\n<p>在启动以后，你可以使用Clover Configurator挂载EFI分区，然后直接使用访达在驱动文件夹中以可视化的方式管理你的驱动程序。</p>\n<p>当然，你也可以使用<code>Disk Genius</code>在Windows下管理你的驱动程序。在下一章节中有关于<code>Disk Genius</code>的更多介绍。</p>\n</li>\n<li><p>更换Clover的主题</p>\n<p>Clover提供了很多自定义功能，你可以选择自己喜欢的Clover开机主题。Clover的主题存放在<code>EFI/CLOVER/themes/</code>文件夹中，你可以下载你喜欢的主题文件夹并将其保存到上述路径中。然后，你需要在Clover Configurator中的<code>引导界面</code>选项卡中填写你想要设置的主题文件夹的名字（如下图）并保存。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack6.png\" alt=\"修改Clover主题\"></p>\n<p>作者目前用的是一款名为<code>Simple</code>的主题，可以点击<a href=\"https://github.com/burpsuite/clover_theme\">此处</a>下载。在GitHub上还有很多不同的Clover主题可供选择。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack7.png\" alt=\"作者正在使用的Simple主题\"></p>\n</li>\n<li><p>隐藏你不需要的卷标</p>\n<p>如果你的Clover启动界面有很多引导同一系统的卷标，你可以将他们隐藏起来。具体方法是，Clover Configurator中的<code>引导界面</code>选项卡中的<code>隐藏卷</code>一栏中填写你想要隐藏的卷标的名称，然后保存文件。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack8.png\" alt=\"隐藏你不需要的卷标\"></p>\n</li>\n</ul>\n<p>Clover的主要功能就介绍到这里了。由于本文是纯粹的新手向，在这里就不介绍如何配置<code>config.plist</code>了。一般来说，只要你能够找到完全对应你机型的EFI文件，基本上就不需要再重新配置Clover了。下面，我们再简单介绍一下新时代的引导工具：OpenCore。</p>\n<h4 id=\"OpenCore\"><a href=\"#OpenCore\" class=\"headerlink\" title=\"OpenCore\"></a>OpenCore</h4><p>OpenCore是一个着眼于未来的先进的开源引导工具，他支持多种主流操作系统的引导。OC的历史使命就是有朝一日代替Clover，成为主流。OC主要有以下几个优势：</p>\n<ul>\n<li>从 2019 年 9 月以后, Acidanthera（神级大佬，黑苹果现有的大部分驱动目前都是他在开发管理）开发的内核驱动 （Lilu, AppleALC 等）将<strong>不再会</strong>在 Clover 上做兼容性测试（虽然这不能算是优势，但是很关键好吗！）</li>\n<li>OC的安全性更好，对文件保险箱（FileVault）有更强大的支持</li>\n<li>OC使用更先进的方法注入第三方内核驱动（也就是你<code>EFI/CLOVER/kexts/Other</code>里面的那些<code>kext</code>文件）</li>\n<li>OC在启动体验上会更加接近白苹果</li>\n</ul>\n<p>当然，为什么现在OC还未能成为主流，首先是因为它还处于开发阶段，各方面还未达到最成熟的状态；其次是因为OC的配置相对于Clover要复杂许多，而且目前没有像Clover Configurator一样直观的图形化界面的配置工具；最后是因为，OC在社区中普及程度不高，导致遇到问题很难找到现成的案例解决。这些原因使很多人放弃了折腾。但是历史的发展是一个螺旋上升的过程，未来将一定是OC的！（笑）</p>\n<h3 id=\"黑苹果的初步安装\"><a href=\"#黑苹果的初步安装\" class=\"headerlink\" title=\"黑苹果的初步安装\"></a>黑苹果的初步安装</h3><p>讨论完了黑苹果的原理以及核心，下一步就该讲讲如何安装了！但是请大家注意，因为这篇文章主要是面向新手的，所以我只会介绍一些最最基本和通用的操作，目的是为了让大家先把黑苹果装上。而安装完成以后的那些各种优化的操作，包括配置Clover的配置文件，给系统打补丁等定制性比较强的内容，都<strong>不会</strong>在本文中涉及。博主可能在接下来一段很长的时间内陆陆续续更新一些系统优化的内容，敬请期待！闲话少说，我们开始吧！</p>\n<hr>\n<h4 id=\"制作安装盘\"><a href=\"#制作安装盘\" class=\"headerlink\" title=\"制作安装盘\"></a>制作安装盘</h4><p>下面的操作均在Windows系统下进行。</p>\n<ul>\n<li><p>在<a href=\"https://blog.daliansky.net\">黑果小兵的部落阁</a>按照你的需要下载某个版本的系统镜像文件（后缀为<code>iso</code>）</p>\n</li>\n<li><p>打开<code>WinMD5</code>软件，将下载完成的<code>iso</code>镜像文件拖入软件窗口，与网站上提供的<code>md5</code>值比对，校验<code>md5</code>值是否正确，如不正确，请重新下载（<code>md5</code>值相当于一个文件的身份证号码，它的值是唯一的，如果你下载下来的文件的<code>md5</code>值与官方提供的不一样，说明你下载的文件可能被修改过或者出错了）</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322163623208.png\" alt=\"校验MD5值\" style=\"zoom:50%;\" />\n</li>\n<li><p>找到一个容量为16GB或以上的<strong>空U盘</strong>，插入电脑</p>\n</li>\n<li><p>以管理员身份打开<code>TransMac</code>软件，在窗口中左侧列表鼠标右击你的U盘，点击<code>Restore With Disk Image</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164230903.png\" alt=\"Restore with Disk Image\" style=\"zoom:50%;\" />\n</li>\n<li><p>点击后有可能会弹出下图所示的警告，是提示你的U盘可能含有已经挂载的卷，请确保你选择的U盘是正确的，然后点击<code>Yes</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164627959.png\" alt=\"请确保你选择的U盘正确！\" style=\"zoom:50%;\" />\n</li>\n<li><p>在弹出的窗口中选择你刚才下载好的<code>iso</code>文件，点击<code>OK</code>，这个时候会<strong>格式化</strong>你的U盘并把系统镜像烧录到你的U盘中，耐心等待安装盘制作完成吧，这一过程大约要持续20~30分钟</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322164435201.png\" alt=\"选择镜像文件\" style=\"zoom:50%;\" />\n\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322165214199.png\" alt=\"等待时间，来杯卡布奇诺\" style=\"zoom:50%;\" />\n</li>\n<li><p>制作完成以后会弹出对话框，直接点击<code>OK</code></p>\n</li>\n<li><p>在此之后系统会提示你要格式化U盘，不必理会，直接点击<code>取消</code></p>\n</li>\n</ul>\n<hr>\n<h4 id=\"替换安装盘中的EFI文件\"><a href=\"#替换安装盘中的EFI文件\" class=\"headerlink\" title=\"替换安装盘中的EFI文件\"></a>替换安装盘中的EFI文件</h4><p>安装macOS时，我们运行的是在U盘上的<code>macOS安装程序</code>，这一步与运行macOS其实是差不多的。此时我们的U盘就相当于一个外置的系统盘，需要通过位于U盘上的Clover引导来启动<code>macOS安装程序</code>。</p>\n<p>为了可以正确引导操作系统，不同型号，甚至不同批次的电脑的EFI文件都是不太一样的。因为这些电脑之间的硬件有所区别，所以你需要确保你的电脑的EFI文件是与你的电脑硬件适配的。这个问题的原理我们已经在前面提到过了。</p>\n<p>但是这个软硬件适配的工作对于小白来说极度不友好，因为这需要一部分的数字电路，微型计算机原理，以及代码编写的知识。那有什么办法可以解决这个问题呢？答案就是：“拿来主义”。多亏了开源社区的发展，有许多人在网站上将他们已经完善的EFI文件分享给其他使用同一型号电脑的人。所以你现在要做的就是：找到与你的电脑型号对应的EFI文件，然后下载下来。</p>\n<p>daliansky整理了一个清单，里面收集了大量不同机型的EFI文件，你可以在里面找找有没有自己电脑的型号：<a href=\"https://blog.daliansky.net/Hackintosh-long-term-maintenance-model-checklist.html\">Hackintosh黑苹果长期维护机型整理清单</a>。如果有的话，点击链接，然后将别人提供的这个EFI文件下载下来即可。</p>\n<p>这时有人会问了，如果没找到自己电脑的型号怎么办呢？不要气馁，你也可以尝试使用与你的电脑硬件配置类似的其他机型的EFI文件，或者使用daliansky提供的镜像中的通用EFI文件。</p>\n<p>按照daliansky的建议，在安装macOS时不必将镜像中的通用EFI文件替换为对应自己机型的EFI文件。但是我个人认为，如果你已经找到了与你的机型对应的EFI文件，那么在安装之前就将其更换，可能会在安装过程中避免一些错误的发生。</p>\n<p>下面就来介绍一下如何替换安装盘中的EFI文件吧！</p>\n<ul>\n<li><p>打开<code>DiskGenius</code>软件，在左侧列表中找到你已经制作好的安装盘，并单击选中</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322172930142.png\" alt=\"选择你已经制作好的安装盘\" style=\"zoom:50%;\" />\n</li>\n<li><p>依次双击右侧列表中的<code>ESP(0)</code>卷标，<code>EFI</code>文件夹，进入如下页面</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322173254704.png\" style=\"zoom:50%;\" />\n</li>\n<li><p>单击<code>CLOVER</code>文件夹，然后按<code>delete</code>键，弹出对话框后点击<code>删除</code>，将这个文件夹删除掉</p>\n</li>\n<li><p>选中你从别人那儿拿来的EFI文件中的<code>CLOVER</code>文件夹，按下<code>Ctrl+C</code>后将窗口切回<code>DiskGenius</code>，然后再按下<code>Ctrl+V</code>将新的<code>CLOVER</code>文件夹复制进去，这样就完成了EFI文件的替换了</p>\n</li>\n</ul>\n<hr>\n<h4 id=\"给硬盘分区\"><a href=\"#给硬盘分区\" class=\"headerlink\" title=\"给硬盘分区\"></a>给硬盘分区</h4><p>接下来我们要在电脑的硬盘上给即将安装的macOS分配一块足够大的空间。</p>\n<p>以下操作均在Windows下的<code>DiskGenius</code>软件中进行，且以我的U盘作为示例，操作方法与在电脑内置硬盘上的一样。在进行以下操作之前，请先备份你的文件。</p>\n<ul>\n<li><p>打开<code>DiskGenius</code>软件，在右侧列表中选中你的硬盘，然后在顶部查看你的硬盘空间分配情况，在顶部最左侧找到你的EFI分区，确保你的EFI分区的空间大于200MB，否则macOS将无法安装</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/image-20200322174413977.png\" alt=\"\"></p>\n</li>\n<li><p>右键单击你的硬盘，选择<code>转换分区表类型为GUID</code>模式，否则macOS将无法安装，如果这个选项是灰色的而下一个选项可选，则无须转换</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322174834408.png\" alt=\"转换为GUID格式\" style=\"zoom:50%;\" />\n</li>\n<li><p>右键单击上方的蓝色容量条，点击<code>建立新分区</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175353564.png\" alt=\"建立新分区\" style=\"zoom:50%;\" />\n</li>\n<li><p>在弹出的窗口中调整你要分给macOS的容量大小，然后点击<code>开始</code>，接下来会有弹窗出现，请<strong>严格遵守弹窗中给出的要求</strong>操作，以免发生意外，然后点击<code>是</code>，开始分区</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322175546512.png\" style=\"zoom:50%;\" />\n\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181027988.png\" alt=\"别怪我没提醒你!\" style=\"zoom:50%;\" />\n</li>\n<li><p>分区完成以后，右键单击顶部蓝色容量条，点击<code>删除当前分区</code>（因为macOS的磁盘格式为APFS，因此现在对其进行格式化没有意义）</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200322181359400.png\" style=\"zoom:50%;\" />\n\n</li>\n</ul>\n<hr>\n<h4 id=\"设置BIOS\"><a href=\"#设置BIOS\" class=\"headerlink\" title=\"设置BIOS\"></a>设置BIOS</h4><p>前文已经说过，操作系统的启动顺序是<code>UEFI/BIOS-&gt;CLOVERX64.efi-&gt;OS</code>。因此，为了使我们的电脑可以启动安装盘上的<code>macOS安装程序</code>，我们还需要正确设置我们的BIOS。</p>\n<p>由于不同品牌的电脑使用不同的主板，所以BIOS的设置以及进行操作的键位也千差万别，这里仅以作者的电脑举例。由于作者电脑的BIOS十分垃圾，可供调整的选项寥寥无几，因此下面所给出的操作步骤中的设置配置要求是最基本的。如果你的电脑的BIOS功能足够强大且有很多其他的设置选项的话，请尽量弄懂这些选项的含义，并按照需要进行设置。</p>\n<ul>\n<li><p>按下开机按钮以后，迅速按<code>F10</code>进入BIOS设置</p>\n</li>\n<li><p>按方向键进入<code>系统设置</code>菜单中的<code>启动选项</code>，请开启<code>传统模式</code>，禁用<code>安全启动模式</code>，启用<code>USB启动</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack11.JPG\" style=\"zoom:50%;\" />\n</li>\n<li><p>按<code>F10</code>保存设置，电脑将自动重启</p>\n</li>\n</ul>\n<p>现在BIOS也已经设置完成。做完这些前期准备工作以后，接下来就要正式开始安装系统了！</p>\n<hr>\n<h4 id=\"安装系统\"><a href=\"#安装系统\" class=\"headerlink\" title=\"安装系统\"></a>安装系统</h4><p>下面以macOS 10.15.3的安装过程为例。</p>\n<ul>\n<li><p>重启电脑，看到左下角的提示以后，按<code>esc</code>暂停启动</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack10.JPG\" alt=\"这是惠普的BIOS操作方法\" style=\"zoom:50%;\" />\n</li>\n<li><p>进入<code>启动菜单</code>，按<code>F9</code>进入<code>启动设备选项</code></p>\n</li>\n<li><p>在列出的一串引导中，选择<code>USB硬盘（UEFI）</code>的选项以启动安装盘中的引导，如果你使用的是daliansky提供的较新的系统镜像，安装盘中会出现两个引导，一个是微PE（后面会提到），另一个是Clover，我们需要启动的是Clover</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack12.JPG\" style=\"zoom:50%;\" />\n</li>\n<li><p>进入Clover界面以后，按照前文所说过的方法，开启啰嗦模式</p>\n</li>\n<li><p>如果你需要使用镜像中的通用EFI文件，那么请执行下面的步骤，否则直接跳过：</p>\n<ul>\n<li><p>在Clover主界面按<code>O</code>进入选项，光标移动到<code>Configs</code>后按回车进入进入该选项，这个选项是用来选择需要生效的Clover配置文件的</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/2_Clover_Configs.png\" alt=\"选择Configs(Credit: daliansky)\"></p>\n</li>\n<li><p>选择<code>config_Install</code>这个配置文件</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/3_Clover_Select_Installer.png\" alt=\"选择config_Install(Credit: daliansky)\"></p>\n</li>\n<li><p>按两次<code>esc</code>返回到Clover主界面</p>\n</li>\n</ul>\n</li>\n<li><p>在Clover主界面选择卷标<code>Boot macOS Install from Install macOS Catalina</code>，然后按下回车，开始引导安装程序</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/1_Clover_Installer.png\" alt=\"开始引导(Credit: daliansky)\"></p>\n</li>\n<li><p>这个时候会出现如下图所示的安装日志，如果你很不幸地卡住了，那么你可以参考<a href=\"https://blog.daliansky.net/Common-problems-and-solutions-in-macOS-Catalina-10.15-installation.html\">macOS Catalina 10.15安装中常见的问题及解决方法</a>，或者附上你卡住的地方的照片和你的电脑配置，在各种交 流 群中询问大佬</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack2.jpg\" alt=\"这是一个群友的求助图片，出现的问题是卡ec了\"></p>\n</li>\n<li><p>如果没有卡住，你的日志会消失，然后出现苹果的logo和进度条</p>\n<p><img src=\"http://7.daliansky.net/Air13/1.png\" alt=\"白苹果(Credit: daliansky)\"></p>\n</li>\n<li><p>等待一段时间以后，会出现语言选择界面，请选择中文并点击<code>继续</code>，如果有装逼需求或者想练习外语，你也可以选择其他语言</p>\n<p><img src=\"http://7.daliansky.net/Air13/4.png\" alt=\"还是选择中文吧(Credit: daliansky)\"></p>\n</li>\n<li><p>选择<code>磁盘工具</code>并点击<code>继续</code></p>\n<p><img src=\"http://7.daliansky.net/10.15.3/3.png\" alt=\"实用工具(Credit: daliansky)\"></p>\n</li>\n<li><p>进入磁盘工具以后，在左上角右键点击你的磁盘，并选择<code>显示所有设备</code>，并找到你之前已经准备好安装macOS的分区</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/4.png\" alt=\"选择显示所有设备\"></p>\n</li>\n<li><p>选中你之前已经准备好安装macOS的分区，然后点击<code>抹掉</code>，在弹出的窗口中，你需要给你的分区起一个名字，并将格式设置成<code>APFS</code>，然后将方案设置为<code>GUID分区图</code>，再点击<code>抹掉</code>，这一步会将你电脑上的硬盘分区格式化</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/6.png\" alt=\"抹掉磁盘(Credit: daliansky)\"></p>\n</li>\n<li><p>操作完成以后，点击左上方<code>磁盘工具</code>，在弹出的选项中选择<code>退出磁盘工具</code>并返回到安装界面</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/8.png\" alt=\"退出磁盘工具(Credit: daliansky)\"></p>\n</li>\n<li><p>在主界面选择<code>安装macOS</code>并点击<code>继续</code>，再闭着眼睛同意条款</p>\n</li>\n<li><p>在下图所示的界面中选择你要安装的磁盘分区，然后点击<code>安装</code>，接下来安装程序会将安装文件复制到你的分区中，这个过程会持续几分钟，待复制完成以后，电脑会重新启动</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/12.png\" alt=\"选择你准备好的那个磁盘分区(Credit: daliansky)\"></p>\n</li>\n<li><p>重启之后，按照本节一开始所述方法进入Clover，这时候你会发现，Clover主界面会多出来几个卷标，从现在开始直到安装完成，请都选择<code>Boot macOS Install form xxx（你给你的macOS分区起的名字）</code>卷标启动，在安装过程中请耐心等待，无论你做了什么奇怪的事情让你增加了什么奇怪的知识，都不要在出现白苹果logo的时候乱动鼠标或者键盘</p>\n</li>\n<li><p>经过两到三次重启以后，你会发现<code>Boot macOS Install form xxx</code>的卷标消失了，新出现了<code>Boot macOS form xxx</code>的卷标，选中它，然后进入，再对着白苹果等待几分钟，难得的休息时间马上就要结束了</p>\n</li>\n<li><p>进度条走完，出现设置向导，接下来会让你设置你的国家和地区，语言和输入法，按照你的需要设置即可，然后会进入<code>数据和隐私</code>界面，点击<code>继续</code></p>\n<p><img src=\"http://7.daliansky.net/Air13/22.png\" alt=\"选择国家和地区(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来会问你是否需要将macOS从你的备份中恢复，黑苹果玩家一无所有，选择<code>现在不传输任何信息</code>并点击<code>继续</code></p>\n<p><img src=\"http://7.daliansky.net/Air13/25.png\" alt=\"没有备份，无需恢复(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来要你使用Apple ID登陆，这里先跳过</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/15.png\" alt=\"不要登陆！登陆了也没用(Credit: daliansky)\"></p>\n</li>\n<li><p>还是闭着眼接受条款</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/16.png\" alt=\"接受就完事了(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来你需要创建一个电脑用户，这是一个管理员帐户，请注意，在这里设置了用户名以后，如果未来要更改的话会极为麻烦，建议想清楚了再继续下一步</p>\n<p><img src=\"http://7.daliansky.net/Air13/30.png\" alt=\"不要起什么奇奇怪怪的名字(Credit: daliansky)\"></p>\n</li>\n<li><p>进入<code>快捷设置</code>页面，点击<code>继续</code>，然后会进入<code>分析</code>页面，取消勾选<code>与App开发共享崩溃与使用数据</code>，黑苹果这种东西自己偷摸着用就行</p>\n<p><img src=\"http://7.daliansky.net/10.15.3/17.png\" alt=\"不要共享(Credit: daliansky)\"></p>\n</li>\n<li><p>接下来还会要你设置屏幕使用时间，Siri，以及外观，这些选项按照你的需要设置就行，一路<code>继续</code>下去，直到出现<code>正在设置你的Mac</code>页面，请稍等片刻</p>\n<p><img src=\"http://7.daliansky.net/Air13/34.png\" alt=\"即将完成！(Credit: daliansky)\"></p>\n</li>\n<li><p>终于进入了桌面，这时macOS的基本安装已经完成了！先庆祝一下，折腾的事情还在后头呢（虽然这篇文章不会写吧……）</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack9.png\" alt=\"老二次元了doge\"></p>\n</li>\n</ul>\n<hr>\n<h4 id=\"将引导添加到硬盘并调整顺序\"><a href=\"#将引导添加到硬盘并调整顺序\" class=\"headerlink\" title=\"将引导添加到硬盘并调整顺序\"></a>将引导添加到硬盘并调整顺序</h4><p>现在，macOS已经成功安装到我们电脑的硬盘上了，但是我们电脑硬盘上的macOS还是通过U盘里的Clover引导的。这就意味着，如果拔掉U盘，我们将不能够启动macOS。所以我们需要将U盘引导区中的Clover文件夹复制到硬盘引导区的EFI文件夹中，以实现脱离U盘启动。这一步的操作与前文<code>替换安装盘中的EFI文件</code>这一小节的操作基本是一致的，需要你在Windows系统下使用<code>DiskGenius</code>操作，这里就不再赘述了。</p>\n<p>如果现在重启电脑，你还是会发现直接进入了Windows的引导而不是Clover。这是因为除了Clover之外，电脑当然还有许多其他的引导项，这些引导项按顺序排列在启动序列之中。现在我们只是把Clover的文件夹放入了硬盘的引导区中，但是还没有把Clover添加到启动序列之中。电脑不知道自己居然还可以用Clover引导macOS，只能继续用老一套方法直接引导Windows启动了。那么下面我们就要告诉电脑，让它知道自己可以使用Clover引导操作系统。下面的操作都是在Windows下进行的。</p>\n<ul>\n<li><p>打开<code>EasyUEFI</code>软件，你可以看到所有的引导项之中没有Clover，点击红框中按钮创建新的引导项</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405233601042.png\" alt=\"创建引导项\" style=\"zoom:50%;\" />\n</li>\n<li><p>在弹出的窗口中，<code>类型</code>选择<code>Linux或者其它操作系统</code>，<code>描述</code>可以随便填写，这里使用的是<code>CLOVER</code>，目标分区选择<code>磁盘0</code>的ESP分区（唯一可选的那一个）</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234307270.png\" style=\"zoom:50%;\" />\n</li>\n<li><p>在<code>文件路径</code>一行中，点击<code>浏览</code>，在弹出的窗口中显示了一个硬盘的图标，这个就是你电脑上硬盘的ESP分区了，点击它左侧的加号将其展开，在EFI文件夹中找到<code>CLOVERX64.efi</code>，这个就是Clover的引导文件，选中后点击<code>确定</code></p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405234725001.png\" style=\"zoom:50%;\" />\n</li>\n<li><p>回到原先的界面之后，点击<code>确定</code>，可以发现Clover已经添加到启动序列中了</p>\n</li>\n<li><p>到这里还没结束，因为Clover被上面众多引导项压着，启动的时候怎么也轮不到它，因此我们点击红框中的按钮，将Clover移到启动序列的第一位，使电脑开机的时候默认使用Clover引导操作系统</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/image-20200405235126649.png\" style=\"zoom:50%;\" />\n\n</li>\n</ul>\n<p>现在再重启电脑，不要按<code>esc</code>暂停启动，电脑会默认使用Clover进行引导。选择macOS分卷，按回车进入。如果成功启动了，那么你便可以重新设置你的BIOS，将<code>传统模式</code>关闭了（但不要开启<code>安全启动模式</code>）。</p>\n<p>到这里，macOS的前期安装已经正式完成！夸赞一波自己吧！</p>\n<hr>\n<h4 id=\"黑苹果单系统安装\"><a href=\"#黑苹果单系统安装\" class=\"headerlink\" title=\"黑苹果单系统安装\"></a>黑苹果单系统安装</h4><p>按照上面所说的步骤，如果不出问题，你便在电脑上成功安装了Windows和macOS双系统。如果你只需要macOS的单系统，操作步骤与上面所说有些许不同，但是绝大部分步骤是一样的，唯一的区别在于<code>给磁盘分区</code>和<code>将引导添加到硬盘并调整顺序</code>这两部步。如果你在制作安装盘的时候，下载的是daliansky提供的较新系统版本的镜像，或者你在制作完系统启动U盘以后，在<code>此电脑</code>中可以看到有诸如<code>微PE</code>字样的磁盘，那么下面步骤中的前三步可以省略掉。大致的操作方法如下：</p>\n<ul>\n<li>于<a href=\"http://www.wepe.com.cn/download.html\">官网</a>下载<code>微PE工具箱V2.0 64位版本</code></li>\n<li>打开软件，将微PE工具安装到你的已经制作好的macOS安装盘中</li>\n<li>将<code>DiskGenius</code>和<code>UEFIManager</code>拷贝到微PE的文件盘中（微PE系统中本身自带非专业版的<code>DiskGenius</code>，某些功能有缺失）</li>\n<li>设置BIOS</li>\n<li>重启，在BIOS中使用安装盘中微PE的引导启动</li>\n<li>进入系统后你可以发现界面与Windows10几乎一样，运行你存放在U盘中的<code>DiskGenius</code>，删除你硬盘中Windows使用的分区，并删除硬盘EFI分区的Windows文件夹</li>\n<li>将硬盘分区表类型转换为<code>GUID</code>格式</li>\n<li>按照你的需要以及前文所述要求，重新分配你的硬盘分区，并将他们格式化</li>\n<li>接下来就是安装系统了，如果一切顺利进入了macOS的桌面，你可以继续下面的步骤</li>\n<li>重启，使用安装盘中微PE的引导启动</li>\n<li>运行<code>DiskGenius</code>，将安装盘EFI文件夹中<code>CLOVER</code>文件夹复制到电脑硬盘的EFI文件夹中</li>\n<li>运行<code>UEFIManager</code>，然后参考上文所说的方法，添加并调整你的引导项</li>\n<li>如果没有问题，关闭BIOS的<code>传统模式</code>启动</li>\n<li>大功告成！</li>\n</ul>\n<h3 id=\"安装完成后可能出现的问题\"><a href=\"#安装完成后可能出现的问题\" class=\"headerlink\" title=\"安装完成后可能出现的问题\"></a>安装完成后可能出现的问题</h3><p>完成macOS的安装并不代表你的电脑就已经是可堪重用的生产力/娱乐工具了。绝大多数情况下，刚刚完成安装的黑苹果还会存在着各种各样的问题。即使你使用的是完全对应你的电脑型号的EFI文件，依然有大概率会出现这些问题。<strong>黑苹果的折腾之处不是安装macOS的过程，而是完全解决这些问题的过程。</strong>所以这就是为什么我建议大家不要在安装的最后几步（包括完成安装以后）登陆你的苹果服务，因为你的电脑存在的一些问题会导致苹果服务登不上去，而且折腾的过程也有可能把你的Apple ID中的信息搞乱，就像下图一样。</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack13.JPG\" alt=\"瞬间富有\" style=\"zoom:50%;\" />\n\n<p>安装完成以后，大家可以检查一下自己的电脑有没有出现下面列出的这些问题。下面的检查大部分都在macOS的设置中完成，还有一些直接观察即可。在每个问题的末尾都会给大家提供一些解决问题的思考方向，但并不会提供具体的解决办法。另外还附上了无故障发生的效果图供大家参考。</p>\n<ul>\n<li><p>网络与蓝牙的问题：下面的这些问题与你的<strong>网卡的型号或者驱动</strong>有关</p>\n<ul>\n<li>打开<code>系统偏好设置-网络</code>选项，里面没有有Wi-Fi选项，即使有也打不开Wi-Fi</li>\n<li>打开<code>系统偏好设置-蓝牙</code>选项，无法开启蓝牙</li>\n<li>无法使用随航</li>\n<li>无法使用Siri，FaceTime，iMessage</li>\n</ul>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack14.png\" alt=\"\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack15.png\" alt=\"\"></p>\n</li>\n<li><p>声音的问题：这个问题的表现形式很多，出现这些问题是因为<strong>声卡没有驱动</strong></p>\n<ul>\n<li>打开系统<code>系统偏好设置-声音</code>选项，无法调节音量</li>\n<li>勾选<code>当更改音量时播放反馈</code>再调节音量，电脑没有声音</li>\n<li>麦克风没有输入电平的变化</li>\n<li>使用快捷键调节音量，喇叭图标下出现禁行标志</li>\n</ul>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack16.png\" alt=\"\"></p>\n</li>\n<li><p>触控板的问题：触控板根本没有反应，或者在<code>系统偏好设置-触控板</code>选项中某些手势无法使用，或者某些功能不显示，这个问题与你的<strong>触控板驱动</strong>有关</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack17.png\" alt=\"\"></p>\n</li>\n<li><p>显示的问题：这个问题也涉及到很多方面，注意<strong>下面给出的图片是错误示例，不是正确的打开方式</strong></p>\n<ul>\n<li><p>色偏严重：这个问题与你的<strong>显示器描述文件和EDID</strong>有关</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack18.JPG\" alt=\"严重的色偏\"></p>\n</li>\n<li><p>文字显示过小，图标与文字比例失调：这个问题与你的<strong>EDID以及是否开启了HiDPI</strong>有关</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack19.png\" alt=\"失调的比例\"></p>\n</li>\n<li><p>出现颜色断层：这个问题与你的<strong>EDID和显卡缓冲帧</strong>有关</p>\n<img src=\"https://astrobear.top/resource/astroblog/content/hack20.jpg\" alt=\"断层的色彩\" style=\"zoom:50%;\" />\n</li>\n<li><p>无法调节亮度：在<code>系统偏好设置-显示器</code>选项中没有亮度调节条，键盘上的亮度调节快捷键也没有反应，这个问题可能与你的<strong>亮度调节驱动或者系统补丁</strong>有关</p>\n</li>\n</ul>\n</li>\n<li><p>电源管理的问题：这个问题的表现形式很多，导致这个问题产生的原因也很多</p>\n<ul>\n<li><p>节能管理未加载：在<code>系统偏好设置-节能</code>选项中没有将4个（台式机为5个）选项全部加载，出现这个问题是因为你<strong>没有加载macOS原生的电源管理</strong></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hack21.png\" alt=\"\"></p>\n</li>\n<li><p>睡眠失灵：睡眠秒醒或者睡眠自动关机/死机/重启，这个问题与你的<strong>电源管理或者USB驱动</strong>有关</p>\n</li>\n</ul>\n</li>\n<li><p>USB总线的问题：USB接口部分或者全部失灵，打开<code>Photo Booth</code>后摄像头无画面，这个问题与你的<strong>USB驱动</strong>有关（话说回来<code>Photo Booth</code>还是蛮有意思的😂）</p>\n</li>\n<li><p>独立显卡无法驱动：黑苹果下只有部分独立显卡可以驱动，如果你的独显<strong>有独立输出并且满足特定型号要求</strong>的话可以尝试将其驱动，否则你就需要屏蔽独显，使用集显了，这里不展开叙述</p>\n</li>\n</ul>\n<p>另外，你也可以在<code>左上角苹果图标-关于本机-系统报告</code>中直接查看你电脑的硬件情况。通过检查各个硬件的驱动情况和相关数据，一样可以判断你的电脑是否会有上面的问题。</p>\n<p>上面给大家介绍的都是一些典型的问题，你也有可能遇到其他的疑难杂症。希望大家面对问题不要望而却步，尽情享受折腾的过程吧！</p>\n<p>(～￣▽￣)～</p>\n<h3 id=\"黑苹果相关资源推荐\"><a href=\"#黑苹果相关资源推荐\" class=\"headerlink\" title=\"黑苹果相关资源推荐\"></a>黑苹果相关资源推荐</h3><p>折腾黑苹果，宜广集信息，多多提问；忌盲目瞎搞，重复建设。</p>\n<h4 id=\"黑苹果相关优秀网站\"><a href=\"#黑苹果相关优秀网站\" class=\"headerlink\" title=\"黑苹果相关优秀网站\"></a>黑苹果相关优秀网站</h4><ul>\n<li><a href=\"https://blog.daliansky.net\">黑果小兵的部落阁</a>：也就是daliansky——国内黑苹果领军人物的博客，他的网站会非常及时地更新系统镜像并不定时地提供一些精品教程</li>\n<li><a href=\"https://www.itpwd.com\">IT密码</a>：网站上面的资源非常丰富，从系统镜像到软件资源再到方法技巧一应俱全，博主也是非常牛啤的</li>\n<li><a href=\"https://oc.skk.moe\">OC简体中文参考手册</a>：由业界大佬合力完成，仍在维护中，学习OC必备</li>\n<li><a href=\"https://github.com\">GitHub</a>：这个不用多说了，绝大部分黑苹果软件和驱动的来源，全球最大同性交友网站🐶，神奇的地方</li>\n<li><a href=\"http://www.pcbeta.com\">远景论坛</a>：国内最主要的黑苹果交流论坛，注册需要邀请码</li>\n<li><a href=\"https://www.tonymacx86.com\">tonymacx86</a>：国外知名的黑苹果交流论坛，资源丰富，需要一定的英语能力</li>\n<li><a href=\"https://www.insanelymac.com/forum/\">insanelymac</a>：与tonymacx86类似的论坛</li>\n</ul>\n<h4 id=\"黑苹果软件、驱动资源\"><a href=\"#黑苹果软件、驱动资源\" class=\"headerlink\" title=\"黑苹果软件、驱动资源\"></a>黑苹果软件、驱动资源</h4><p>下面只列出了一些至关重要的驱动和软件，其他功能的还有很多，这里就不一一列出了。</p>\n<ul>\n<li><a href=\"https://mackie100projects.altervista.org/download-clover-configurator/\">Clover Configurator</a>：Clover的图形化配置软件</li>\n<li><a href=\"https://github.com/headkaze/Hackintool/releases\">Hackintool</a>：黑苹果完善必备工具</li>\n<li><a href=\"https://github.com/CloverHackyColor/CloverBootloader/releases\">Clover</a>：在这里可以找到已经编译好的Clover</li>\n<li><a href=\"https://github.com/acidanthera/Lilu/releases\">Lilu.kext</a>：众多常用驱动的依赖</li>\n<li><a href=\"https://github.com/acidanthera/AppleALC/releases\">AppleALC.kext</a>：常用声卡驱动</li>\n<li><a href=\"https://github.com/acidanthera/VoodooPS2/releases\">VoodooPS2Controller.kext</a>：PS2总线输入设备（鼠标，键盘，触控板）的驱动，此外对于I2C总线的输入设备还有VoodooI2C.kext</li>\n<li><a href=\"https://github.com/acidanthera/VoodooInput/releases\">VoodooInput.kext</a>：VoodooPS2Controller的依赖</li>\n<li><a href=\"https://github.com/acidanthera/WhateverGreen/releases\">WhateverGreen.kext</a>：用于驱动Intel集成显卡</li>\n<li><a href=\"https://bitbucket.org/RehabMan/os-x-fakesmc-kozlek/downloads/\">FakeSMC.kext</a>：必备驱动，用于仿冒SMC设备，欺骗macOS，让它以为我们的电脑就是Mac</li>\n</ul>\n<h3 id=\"声明与致谢\"><a href=\"#声明与致谢\" class=\"headerlink\" title=\"声明与致谢\"></a>声明与致谢</h3><p>黑苹果社区的健康需要大家共同维护，恳请新人们注意以下几点：</p>\n<ul>\n<li>不要把社区的成果（如各种机型的EFI，开源软件等）拿来作商业用途</li>\n<li>不要购买淘宝上面的EFI！所有现存的EFI都可以在网上免费获得！请不要支持那些兜售EFI的无良商家，他们也是从网上下载的</li>\n<li>不建议去淘宝上购买安装黑苹果的服务，出了问题到最后还是要你自己解决</li>\n<li>不建议把自己的折腾成果在网络上有偿提供，这样并不利于社区的发展</li>\n<li>网友没有义务去无偿地帮你解决问题，另外也请善用搜索引擎</li>\n</ul>\n<p>黑苹果一开始是极客的产物，是反叛精神的象征。令人意料不到的是，现在它居然可以为我们普通人所用。而从极客到大众的过渡，黑苹果的开源社区对此作出了极大贡献。对那些对社区做出过极大贡献的极客和工程师们，对社区建设贡献出自己的一份力量、努力维护社区健康发展的成员，我向你们表达最诚挚的感谢。没有社区，就没有黑苹果的今天。作为从社区中获益的普通成员，也应该通过自己的努力，以自己的方式去回馈这个社区，帮助它更好地发展。</p>\n<p>博主在此谨向你们表达我的感谢：<a href=\"https://github.com/RehabMan\">RehabMan</a>，<a href=\"https://github.com/acidanthera\">Acidanthera</a>，<a href=\"https://blog.daliansky.net\">黑果小兵</a>，<a href=\"https://github.com/SilentSliver\">SlientSliver</a>，<a href=\"https://www.itpwd.com\">IT密码</a>，以及其他给予过我帮助的网友或开发者们😘。</p>\n<p>附：<a href=\"https://pan.baidu.com/s/17yVMb2FQyzfK2sAYbHuZnw\">软件度盘链接</a> ，密码：3lkx。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n在这篇文章写成之后不久，Apple推出了M1芯片以及macOS Big Sur。这对黑苹果来说无疑是一个重大打击。虽然macOS肯定还会对使用Intel CPU的电脑继续提供几年的支持，但是如果苹果未来不再推出使用Intel CPU的电脑，那么黑苹果的未来恐怕不容乐观。另外，黑苹果社区也出现了比较大的变化。随着更先进更安全更简单的Open Core逐渐成熟，其使用者也越来越多。虽然Clover仍然保留了对最新的macOS的支持，但是其已然落后。这也就是说，在这篇文章写完之后，其内容已经过时了（悲，但如果是安装Big Sur以下版本的macOS，这篇文章还是有一定的指导意义的）。最后，出于时间和精力的考虑，博主已经不打算再折腾黑苹果了。感谢黑苹果这两年来的陪伴。\n</div>\n</article>\n"},{"title":"Python学习笔记","date":"2020-01-06T09:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/t4.png","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/t4.png","excerpt":"记录本人在学习Python时遇到的坑以及这门语言的特性。","_content":"\n> 这篇文章主要记录本人在学习Python时遇到的坑以及这个语言的一些特性，内容以时间顺序整理，比较零散杂乱。对于从零开始的同学，请参考官方文档[Python 3.8.1 中文文档](https://docs.python.org/zh-cn/3/)或其他网络上的教程。本文章将持续更新。\n\n### 19/9/14\n\n- 注释方法：`#（一行注释）`，`“”“ ”“”（多行注释）`\n- for循环：`for （变量） in （范围）`，范围可以用`range`函数\n- `Input`函数的输入是`char`类型的\n- `// `是整除运算\n- 逗号不可以用来分隔语句\n- 使用缩进（4个空格）来代替C/C++中的大括号\n\n### 19/9/15\n\n- `for...in`循环中，`_ `可以作为循环变量，这时候仅循环指定次数，而不需要关心循环变量的值；事实上，`_ `是一个合法的标识符，如果不关心这个变量，就可以将其定义成这个值，它是一个垃圾桶\n- 定义函数时，使用`函数名(*参数名)`的定义方式， `*` 代表函数的参数是可变参数，可以有0到多个参数\n- 一个文件代表一个模块(module)，若在不同的模块中含有同名函数，那么可以通过`import`导入指定的模块中的函数，如`from 模块 import 函数`，或者`import 模块 as 自定义模块名称`，再通过`自定义模块名称.函数`的方式调用\n- `__name__`是Python中一个隐含的变量，代表了模块的名字，只用直接执行的模块的名字才是`__main__`\n- 可以使用`global`指定使用的是一个全局变量，如果全局变量中没有找到对应的，那么会定义一个新的全局变量\n- 嵌套作用域：对于函数a内部的函数b而言，a中定义的变量对b来说是在嵌套作用域中的，若要指定修改嵌套作用域中的变量，可以使用`nonlocal`指示变量来自嵌套作用域\n- `pass`是一个空语句，只起到占位作用\n- 可以定义一个`main`函数（或者与模块名字相同的函数），再按照`if __name__ = '__main__'`的格式使脚本执行\n\n### 19/9/17\n\n- 与字符串有关的函数的调用方式为：`字符串名称.字符串操作函数()`，在此时字符串是一个对象，字符串操作函数的作用是向字符串对象发送一个消息\n- 字符串实质上是一个数组，可以进行下标运算\n- 字符串切片可以在下标运算中使用冒号进行运算，`[起始字符:结束字符:间隔]`，若不定义起始与终止字符，则默认为整个字符串，当间隔为负值时，以为着切片操作反向\n- 字符串的索引为负值时，意味着索引从右到左数\n- 列表可以理解为一个数组，其操作与字符串类似\n- 可使用`sorted`函数对列表进行排序\n- 可以使用生成式语法创建列表：`f = [x for x in range(1, 10)]`（此方法在创建列表后元素已经准备就绪，耗费较多内存），或`f = (x for x in range(1, 10))`（此方法创建的是一个生成器对象，需要数据时列表通过生成器产生，节省内存但是耗费较多时间）\n- 可以使用`yield`关键字来实现迭代，使用`yield`就是产生了一个生成器，每次遇到` yield `时函数会暂停并保存当前所有的运行信息，返回` yield `的值，并在下一次执行此方法是从当前位置开始运行\n- 可以定义元组，其相当于不能修改的数组，一个元组中的元素数据类型可以不同，定义元组使用`t = ()`\n- 列表和元组可以互相转换\n- 可以定义集合，定义集合可以使用`set = {}`，元组可以转换为集合\n- 字典类似于数组，但是它是由多组键值对组成的\n\n### 19/9/19\n\n- 使用class关键字定义类，再在类中定义函数，如：`class 类名(object)`\n- `__init__`函数是用于在创建对象时进行的初始化操作\n- self是类的本身，是它的实例变量，在类中所有函数的第一个参数就是self，在类中修改属性值需使用`self.属性值 = x`的语法\n- 实例化类的方法：`对象名 = 类名(初始化函数参数)`\n- 对象中方法的引用可以采用`对象.方法（也即函数）`的语句，通过此方式向对象发送消息\n- Python中，属性和方法的访问权限只有`public`和`private`，若希望属性或方法是私有的，在给它们命名的时候要使用`__`开头，但是不建议将属性设置为私有的\n- 使用`_`开头暗示属性或方法是受保护(protected)的，访问它们建议通过特定的方法，但实际上它们还是可以直接被外部访问\n- 可以通过在类中定义方法以访问对象受保护的属性，在定义这些方法（函数）时，要在上一行使用`@property`包装这些方法\n- 对于被保护的属性，在访问它们时采用`getter`方法，需添加`@property`，在修改它们时采用`setter`方法，需添加`@函数（即方法）名.setter`\n- Python可以对对象动态绑定新的属性或方法\n- 可以使用`__slots__`限定对象只能绑定某些属性，但是它只对当前类的对象生效，对子类不起作用\n- 可以通过给类发送消息，在类的对象被创建出来之前直接使用其中的方法，此种方法被称为静态方法，需要在定义时添加`@staticmethod`，此类方法的参数不含有`self`\n- 通过类方法可以获取类相关的信息并且可以__创建出类的对象__，需要在定义时添加`@classmethod`，类方法的第一个参数是`cls`，这个`cls`相当于就是在外部实例化类时定义的对象名，只不过它是放在类的内部使用了，其功能就是可以像在外部调用对象的属性和方法一样在类的内部使用对象（类）的属性和方法\n\n### 19/9/20\n\n- 类之间的关系：\n  - is-a：继承或者泛化，如：__student__ is a __human being__，__cell phone__ is a __electronic device__\n  - has-a：关联，如 __department__ has an __employee__\n  - use-a：依赖，如 __driver__ use a __car__ \n- 类与类之间可以继承，提供继承信息的成为父类（超类或者基类），得到继承的称为子类（派生类或者衍生类）\n- Python中继承的写法：`class 子类名(基类名)`\n- 在编程中一般使用子类去替代基类\n- 在子类中，通过重新定义父类中的方法，可以让同一种方法在不同的子类中有不同的行为，这称为重写\n\n### 20/1/11\n\n- Python中提供两个重要的功能：异常处理和断言（Assertions）来处理运行中出现的异常和错误，他们的功能是用于调试Python程序\n- 异常：无法正常处理程序时会发生异常，是一个对象，如果不捕获异常，程序会终止执行\n- Python中异常处理的写法：\n\n```python\ntry: \n\t#operation1\nexcept exception_type, argument:\n\t#if error occurs in operation1, execute operation2\n  #operation2\nelse: \n\t#if no error occurs in operation1, execute operation3\n  #operation3\n```\n\n- 使用`except`可以不带异常类型，但是会让`try-except`语句捕获所有的异常，不建议这样写\n- 可以使用`expect(exception1[, expection2[, expection3]])`来添加多个异常类型\n- `argument`为异常的参数，可以用于输出异常信息的异常值\n- 也可以使用如下方法，但是与`try-except`有所不同：\n\n```python\ntry:\n\t#operation1\nfinally:\n\t#in error occurs in operation1, directly execute operation2, otherwise, execute operation2 after operation1 finished\n```\n\n- `finally`和`except`不可以同时使用\n\n- 可以使用`raise`触发异常\n- `append()`方法用于在列表末尾添加新的对象，对于一个数组`list`，可以这样使用：`list.append()`\n- 多线程用于同时执行多个不同的程序，可以把占据长时间的程序中的任务放到后台处理\n- 线程与进程：独立的线程有自己的程序入口、执行序列、程序出口，但是线程不可以独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制\n- 在Python中使用线程：`thread.start_new_thread(function, args[, kwargs])`，其中`function`为线程函数，这个函数需要提前定义好，`args`为传递给线程函数的参数，是一个元组，`kwargs`为可选参数，此种方式称为函数式，线程的结束一般靠函数的自然结束\n- 此外还可以使用Python所提供的`threading`模块，直接从`threading.Thread`继承：`class myThread(threading.Thread)`，然后重写`__init__`和`run`方法，把需要执行的代码写到`run`方法里面，`__init__`的重写方法如下：\n\n```python\ndef __init__(self, threadID, name, counter):\n\tthreading.Thread.__init__(self)\n\tself.threadID = threadID\n\tself.name = name\n\tself.counter = counter\n```\n\n- 上述`thread`类提供了以下方法：\n  - `run()`：表示线程活动的方法\n  - `start`：启动线程\n  - `join()`：等待直到线程终止\n  - `isAlive()`：查询线程是否活动\n  - `getName()`：返回线程名\n  - `setName()`：设置线程名\n- 为了避免两个或多个线程同时运行，产生冲突，可以使用线程锁来控制线程执行的优先顺序，被锁定的线程优先执行，其他进程必须停止\n- 可以使用`threading.Lock().acquire()`和`threading.Lock().release()`来锁定和释放线程\n- 可以建立一个空数组用于存放线程，再通过`append`方法将线程添加至该数组中，通过遍历数组可以对其中的线程做同样的操作\n","source":"_posts/Python学习笔记.md","raw":"---\ntitle: Python学习笔记\ndate: 2020-1-6 17:00:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Python\n\t- Programming Language\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/t4.png\n\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/t4.png\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 记录本人在学习Python时遇到的坑以及这门语言的特性。\n\n#You can begin to input your article below now.\n\n---\n\n> 这篇文章主要记录本人在学习Python时遇到的坑以及这个语言的一些特性，内容以时间顺序整理，比较零散杂乱。对于从零开始的同学，请参考官方文档[Python 3.8.1 中文文档](https://docs.python.org/zh-cn/3/)或其他网络上的教程。本文章将持续更新。\n\n### 19/9/14\n\n- 注释方法：`#（一行注释）`，`“”“ ”“”（多行注释）`\n- for循环：`for （变量） in （范围）`，范围可以用`range`函数\n- `Input`函数的输入是`char`类型的\n- `// `是整除运算\n- 逗号不可以用来分隔语句\n- 使用缩进（4个空格）来代替C/C++中的大括号\n\n### 19/9/15\n\n- `for...in`循环中，`_ `可以作为循环变量，这时候仅循环指定次数，而不需要关心循环变量的值；事实上，`_ `是一个合法的标识符，如果不关心这个变量，就可以将其定义成这个值，它是一个垃圾桶\n- 定义函数时，使用`函数名(*参数名)`的定义方式， `*` 代表函数的参数是可变参数，可以有0到多个参数\n- 一个文件代表一个模块(module)，若在不同的模块中含有同名函数，那么可以通过`import`导入指定的模块中的函数，如`from 模块 import 函数`，或者`import 模块 as 自定义模块名称`，再通过`自定义模块名称.函数`的方式调用\n- `__name__`是Python中一个隐含的变量，代表了模块的名字，只用直接执行的模块的名字才是`__main__`\n- 可以使用`global`指定使用的是一个全局变量，如果全局变量中没有找到对应的，那么会定义一个新的全局变量\n- 嵌套作用域：对于函数a内部的函数b而言，a中定义的变量对b来说是在嵌套作用域中的，若要指定修改嵌套作用域中的变量，可以使用`nonlocal`指示变量来自嵌套作用域\n- `pass`是一个空语句，只起到占位作用\n- 可以定义一个`main`函数（或者与模块名字相同的函数），再按照`if __name__ = '__main__'`的格式使脚本执行\n\n### 19/9/17\n\n- 与字符串有关的函数的调用方式为：`字符串名称.字符串操作函数()`，在此时字符串是一个对象，字符串操作函数的作用是向字符串对象发送一个消息\n- 字符串实质上是一个数组，可以进行下标运算\n- 字符串切片可以在下标运算中使用冒号进行运算，`[起始字符:结束字符:间隔]`，若不定义起始与终止字符，则默认为整个字符串，当间隔为负值时，以为着切片操作反向\n- 字符串的索引为负值时，意味着索引从右到左数\n- 列表可以理解为一个数组，其操作与字符串类似\n- 可使用`sorted`函数对列表进行排序\n- 可以使用生成式语法创建列表：`f = [x for x in range(1, 10)]`（此方法在创建列表后元素已经准备就绪，耗费较多内存），或`f = (x for x in range(1, 10))`（此方法创建的是一个生成器对象，需要数据时列表通过生成器产生，节省内存但是耗费较多时间）\n- 可以使用`yield`关键字来实现迭代，使用`yield`就是产生了一个生成器，每次遇到` yield `时函数会暂停并保存当前所有的运行信息，返回` yield `的值，并在下一次执行此方法是从当前位置开始运行\n- 可以定义元组，其相当于不能修改的数组，一个元组中的元素数据类型可以不同，定义元组使用`t = ()`\n- 列表和元组可以互相转换\n- 可以定义集合，定义集合可以使用`set = {}`，元组可以转换为集合\n- 字典类似于数组，但是它是由多组键值对组成的\n\n### 19/9/19\n\n- 使用class关键字定义类，再在类中定义函数，如：`class 类名(object)`\n- `__init__`函数是用于在创建对象时进行的初始化操作\n- self是类的本身，是它的实例变量，在类中所有函数的第一个参数就是self，在类中修改属性值需使用`self.属性值 = x`的语法\n- 实例化类的方法：`对象名 = 类名(初始化函数参数)`\n- 对象中方法的引用可以采用`对象.方法（也即函数）`的语句，通过此方式向对象发送消息\n- Python中，属性和方法的访问权限只有`public`和`private`，若希望属性或方法是私有的，在给它们命名的时候要使用`__`开头，但是不建议将属性设置为私有的\n- 使用`_`开头暗示属性或方法是受保护(protected)的，访问它们建议通过特定的方法，但实际上它们还是可以直接被外部访问\n- 可以通过在类中定义方法以访问对象受保护的属性，在定义这些方法（函数）时，要在上一行使用`@property`包装这些方法\n- 对于被保护的属性，在访问它们时采用`getter`方法，需添加`@property`，在修改它们时采用`setter`方法，需添加`@函数（即方法）名.setter`\n- Python可以对对象动态绑定新的属性或方法\n- 可以使用`__slots__`限定对象只能绑定某些属性，但是它只对当前类的对象生效，对子类不起作用\n- 可以通过给类发送消息，在类的对象被创建出来之前直接使用其中的方法，此种方法被称为静态方法，需要在定义时添加`@staticmethod`，此类方法的参数不含有`self`\n- 通过类方法可以获取类相关的信息并且可以__创建出类的对象__，需要在定义时添加`@classmethod`，类方法的第一个参数是`cls`，这个`cls`相当于就是在外部实例化类时定义的对象名，只不过它是放在类的内部使用了，其功能就是可以像在外部调用对象的属性和方法一样在类的内部使用对象（类）的属性和方法\n\n### 19/9/20\n\n- 类之间的关系：\n  - is-a：继承或者泛化，如：__student__ is a __human being__，__cell phone__ is a __electronic device__\n  - has-a：关联，如 __department__ has an __employee__\n  - use-a：依赖，如 __driver__ use a __car__ \n- 类与类之间可以继承，提供继承信息的成为父类（超类或者基类），得到继承的称为子类（派生类或者衍生类）\n- Python中继承的写法：`class 子类名(基类名)`\n- 在编程中一般使用子类去替代基类\n- 在子类中，通过重新定义父类中的方法，可以让同一种方法在不同的子类中有不同的行为，这称为重写\n\n### 20/1/11\n\n- Python中提供两个重要的功能：异常处理和断言（Assertions）来处理运行中出现的异常和错误，他们的功能是用于调试Python程序\n- 异常：无法正常处理程序时会发生异常，是一个对象，如果不捕获异常，程序会终止执行\n- Python中异常处理的写法：\n\n```python\ntry: \n\t#operation1\nexcept exception_type, argument:\n\t#if error occurs in operation1, execute operation2\n  #operation2\nelse: \n\t#if no error occurs in operation1, execute operation3\n  #operation3\n```\n\n- 使用`except`可以不带异常类型，但是会让`try-except`语句捕获所有的异常，不建议这样写\n- 可以使用`expect(exception1[, expection2[, expection3]])`来添加多个异常类型\n- `argument`为异常的参数，可以用于输出异常信息的异常值\n- 也可以使用如下方法，但是与`try-except`有所不同：\n\n```python\ntry:\n\t#operation1\nfinally:\n\t#in error occurs in operation1, directly execute operation2, otherwise, execute operation2 after operation1 finished\n```\n\n- `finally`和`except`不可以同时使用\n\n- 可以使用`raise`触发异常\n- `append()`方法用于在列表末尾添加新的对象，对于一个数组`list`，可以这样使用：`list.append()`\n- 多线程用于同时执行多个不同的程序，可以把占据长时间的程序中的任务放到后台处理\n- 线程与进程：独立的线程有自己的程序入口、执行序列、程序出口，但是线程不可以独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制\n- 在Python中使用线程：`thread.start_new_thread(function, args[, kwargs])`，其中`function`为线程函数，这个函数需要提前定义好，`args`为传递给线程函数的参数，是一个元组，`kwargs`为可选参数，此种方式称为函数式，线程的结束一般靠函数的自然结束\n- 此外还可以使用Python所提供的`threading`模块，直接从`threading.Thread`继承：`class myThread(threading.Thread)`，然后重写`__init__`和`run`方法，把需要执行的代码写到`run`方法里面，`__init__`的重写方法如下：\n\n```python\ndef __init__(self, threadID, name, counter):\n\tthreading.Thread.__init__(self)\n\tself.threadID = threadID\n\tself.name = name\n\tself.counter = counter\n```\n\n- 上述`thread`类提供了以下方法：\n  - `run()`：表示线程活动的方法\n  - `start`：启动线程\n  - `join()`：等待直到线程终止\n  - `isAlive()`：查询线程是否活动\n  - `getName()`：返回线程名\n  - `setName()`：设置线程名\n- 为了避免两个或多个线程同时运行，产生冲突，可以使用线程锁来控制线程执行的优先顺序，被锁定的线程优先执行，其他进程必须停止\n- 可以使用`threading.Lock().acquire()`和`threading.Lock().release()`来锁定和释放线程\n- 可以建立一个空数组用于存放线程，再通过`append`方法将线程添加至该数组中，通过遍历数组可以对其中的线程做同样的操作\n","slug":"Python学习笔记","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzu000d1q394rsx43zq","content":"<blockquote>\n<p>这篇文章主要记录本人在学习Python时遇到的坑以及这个语言的一些特性，内容以时间顺序整理，比较零散杂乱。对于从零开始的同学，请参考官方文档<a href=\"https://docs.python.org/zh-cn/3/\">Python 3.8.1 中文文档</a>或其他网络上的教程。本文章将持续更新。</p>\n</blockquote>\n<h3 id=\"19-9-14\"><a href=\"#19-9-14\" class=\"headerlink\" title=\"19/9/14\"></a>19/9/14</h3><ul>\n<li>注释方法：<code>#（一行注释）</code>，<code>“”“ ”“”（多行注释）</code></li>\n<li>for循环：<code>for （变量） in （范围）</code>，范围可以用<code>range</code>函数</li>\n<li><code>Input</code>函数的输入是<code>char</code>类型的</li>\n<li><code>//</code>是整除运算</li>\n<li>逗号不可以用来分隔语句</li>\n<li>使用缩进（4个空格）来代替C/C++中的大括号</li>\n</ul>\n<h3 id=\"19-9-15\"><a href=\"#19-9-15\" class=\"headerlink\" title=\"19/9/15\"></a>19/9/15</h3><ul>\n<li><code>for...in</code>循环中，<code>_</code>可以作为循环变量，这时候仅循环指定次数，而不需要关心循环变量的值；事实上，<code>_</code>是一个合法的标识符，如果不关心这个变量，就可以将其定义成这个值，它是一个垃圾桶</li>\n<li>定义函数时，使用<code>函数名(*参数名)</code>的定义方式， <code>*</code> 代表函数的参数是可变参数，可以有0到多个参数</li>\n<li>一个文件代表一个模块(module)，若在不同的模块中含有同名函数，那么可以通过<code>import</code>导入指定的模块中的函数，如<code>from 模块 import 函数</code>，或者<code>import 模块 as 自定义模块名称</code>，再通过<code>自定义模块名称.函数</code>的方式调用</li>\n<li><code>__name__</code>是Python中一个隐含的变量，代表了模块的名字，只用直接执行的模块的名字才是<code>__main__</code></li>\n<li>可以使用<code>global</code>指定使用的是一个全局变量，如果全局变量中没有找到对应的，那么会定义一个新的全局变量</li>\n<li>嵌套作用域：对于函数a内部的函数b而言，a中定义的变量对b来说是在嵌套作用域中的，若要指定修改嵌套作用域中的变量，可以使用<code>nonlocal</code>指示变量来自嵌套作用域</li>\n<li><code>pass</code>是一个空语句，只起到占位作用</li>\n<li>可以定义一个<code>main</code>函数（或者与模块名字相同的函数），再按照<code>if __name__ = &#39;__main__&#39;</code>的格式使脚本执行</li>\n</ul>\n<h3 id=\"19-9-17\"><a href=\"#19-9-17\" class=\"headerlink\" title=\"19/9/17\"></a>19/9/17</h3><ul>\n<li>与字符串有关的函数的调用方式为：<code>字符串名称.字符串操作函数()</code>，在此时字符串是一个对象，字符串操作函数的作用是向字符串对象发送一个消息</li>\n<li>字符串实质上是一个数组，可以进行下标运算</li>\n<li>字符串切片可以在下标运算中使用冒号进行运算，<code>[起始字符:结束字符:间隔]</code>，若不定义起始与终止字符，则默认为整个字符串，当间隔为负值时，以为着切片操作反向</li>\n<li>字符串的索引为负值时，意味着索引从右到左数</li>\n<li>列表可以理解为一个数组，其操作与字符串类似</li>\n<li>可使用<code>sorted</code>函数对列表进行排序</li>\n<li>可以使用生成式语法创建列表：<code>f = [x for x in range(1, 10)]</code>（此方法在创建列表后元素已经准备就绪，耗费较多内存），或<code>f = (x for x in range(1, 10))</code>（此方法创建的是一个生成器对象，需要数据时列表通过生成器产生，节省内存但是耗费较多时间）</li>\n<li>可以使用<code>yield</code>关键字来实现迭代，使用<code>yield</code>就是产生了一个生成器，每次遇到<code>yield</code>时函数会暂停并保存当前所有的运行信息，返回<code>yield</code>的值，并在下一次执行此方法是从当前位置开始运行</li>\n<li>可以定义元组，其相当于不能修改的数组，一个元组中的元素数据类型可以不同，定义元组使用<code>t = ()</code></li>\n<li>列表和元组可以互相转换</li>\n<li>可以定义集合，定义集合可以使用<code>set = &#123;&#125;</code>，元组可以转换为集合</li>\n<li>字典类似于数组，但是它是由多组键值对组成的</li>\n</ul>\n<h3 id=\"19-9-19\"><a href=\"#19-9-19\" class=\"headerlink\" title=\"19/9/19\"></a>19/9/19</h3><ul>\n<li>使用class关键字定义类，再在类中定义函数，如：<code>class 类名(object)</code></li>\n<li><code>__init__</code>函数是用于在创建对象时进行的初始化操作</li>\n<li>self是类的本身，是它的实例变量，在类中所有函数的第一个参数就是self，在类中修改属性值需使用<code>self.属性值 = x</code>的语法</li>\n<li>实例化类的方法：<code>对象名 = 类名(初始化函数参数)</code></li>\n<li>对象中方法的引用可以采用<code>对象.方法（也即函数）</code>的语句，通过此方式向对象发送消息</li>\n<li>Python中，属性和方法的访问权限只有<code>public</code>和<code>private</code>，若希望属性或方法是私有的，在给它们命名的时候要使用<code>__</code>开头，但是不建议将属性设置为私有的</li>\n<li>使用<code>_</code>开头暗示属性或方法是受保护(protected)的，访问它们建议通过特定的方法，但实际上它们还是可以直接被外部访问</li>\n<li>可以通过在类中定义方法以访问对象受保护的属性，在定义这些方法（函数）时，要在上一行使用<code>@property</code>包装这些方法</li>\n<li>对于被保护的属性，在访问它们时采用<code>getter</code>方法，需添加<code>@property</code>，在修改它们时采用<code>setter</code>方法，需添加<code>@函数（即方法）名.setter</code></li>\n<li>Python可以对对象动态绑定新的属性或方法</li>\n<li>可以使用<code>__slots__</code>限定对象只能绑定某些属性，但是它只对当前类的对象生效，对子类不起作用</li>\n<li>可以通过给类发送消息，在类的对象被创建出来之前直接使用其中的方法，此种方法被称为静态方法，需要在定义时添加<code>@staticmethod</code>，此类方法的参数不含有<code>self</code></li>\n<li>通过类方法可以获取类相关的信息并且可以<strong>创建出类的对象</strong>，需要在定义时添加<code>@classmethod</code>，类方法的第一个参数是<code>cls</code>，这个<code>cls</code>相当于就是在外部实例化类时定义的对象名，只不过它是放在类的内部使用了，其功能就是可以像在外部调用对象的属性和方法一样在类的内部使用对象（类）的属性和方法</li>\n</ul>\n<h3 id=\"19-9-20\"><a href=\"#19-9-20\" class=\"headerlink\" title=\"19/9/20\"></a>19/9/20</h3><ul>\n<li>类之间的关系：<ul>\n<li>is-a：继承或者泛化，如：<strong>student</strong> is a <strong>human being</strong>，<strong>cell phone</strong> is a <strong>electronic device</strong></li>\n<li>has-a：关联，如 <strong>department</strong> has an <strong>employee</strong></li>\n<li>use-a：依赖，如 <strong>driver</strong> use a <strong>car</strong> </li>\n</ul>\n</li>\n<li>类与类之间可以继承，提供继承信息的成为父类（超类或者基类），得到继承的称为子类（派生类或者衍生类）</li>\n<li>Python中继承的写法：<code>class 子类名(基类名)</code></li>\n<li>在编程中一般使用子类去替代基类</li>\n<li>在子类中，通过重新定义父类中的方法，可以让同一种方法在不同的子类中有不同的行为，这称为重写</li>\n</ul>\n<h3 id=\"20-1-11\"><a href=\"#20-1-11\" class=\"headerlink\" title=\"20/1/11\"></a>20/1/11</h3><ul>\n<li>Python中提供两个重要的功能：异常处理和断言（Assertions）来处理运行中出现的异常和错误，他们的功能是用于调试Python程序</li>\n<li>异常：无法正常处理程序时会发生异常，是一个对象，如果不捕获异常，程序会终止执行</li>\n<li>Python中异常处理的写法：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>: </span><br><span class=\"line\">    <span class=\"comment\">#operation1</span></span><br><span class=\"line\"><span class=\"keyword\">except</span> exception_type, argument:</span><br><span class=\"line\">    <span class=\"comment\">#if error occurs in operation1, execute operation2</span></span><br><span class=\"line\">  <span class=\"comment\">#operation2</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>: </span><br><span class=\"line\">    <span class=\"comment\">#if no error occurs in operation1, execute operation3</span></span><br><span class=\"line\">  <span class=\"comment\">#operation3</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用<code>except</code>可以不带异常类型，但是会让<code>try-except</code>语句捕获所有的异常，不建议这样写</li>\n<li>可以使用<code>expect(exception1[, expection2[, expection3]])</code>来添加多个异常类型</li>\n<li><code>argument</code>为异常的参数，可以用于输出异常信息的异常值</li>\n<li>也可以使用如下方法，但是与<code>try-except</code>有所不同：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"comment\">#operation1</span></span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">    <span class=\"comment\">#in error occurs in operation1, directly execute operation2, otherwise, execute operation2 after operation1 finished</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><code>finally</code>和<code>except</code>不可以同时使用</p>\n</li>\n<li><p>可以使用<code>raise</code>触发异常</p>\n</li>\n<li><p><code>append()</code>方法用于在列表末尾添加新的对象，对于一个数组<code>list</code>，可以这样使用：<code>list.append()</code></p>\n</li>\n<li><p>多线程用于同时执行多个不同的程序，可以把占据长时间的程序中的任务放到后台处理</p>\n</li>\n<li><p>线程与进程：独立的线程有自己的程序入口、执行序列、程序出口，但是线程不可以独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制</p>\n</li>\n<li><p>在Python中使用线程：<code>thread.start_new_thread(function, args[, kwargs])</code>，其中<code>function</code>为线程函数，这个函数需要提前定义好，<code>args</code>为传递给线程函数的参数，是一个元组，<code>kwargs</code>为可选参数，此种方式称为函数式，线程的结束一般靠函数的自然结束</p>\n</li>\n<li><p>此外还可以使用Python所提供的<code>threading</code>模块，直接从<code>threading.Thread</code>继承：<code>class myThread(threading.Thread)</code>，然后重写<code>__init__</code>和<code>run</code>方法，把需要执行的代码写到<code>run</code>方法里面，<code>__init__</code>的重写方法如下：</p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, threadID, name, counter</span>):</span></span><br><span class=\"line\">    threading.Thread.__init__(self)</span><br><span class=\"line\">    self.threadID = threadID</span><br><span class=\"line\">    self.name = name</span><br><span class=\"line\">    self.counter = counter</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>上述<code>thread</code>类提供了以下方法：<ul>\n<li><code>run()</code>：表示线程活动的方法</li>\n<li><code>start</code>：启动线程</li>\n<li><code>join()</code>：等待直到线程终止</li>\n<li><code>isAlive()</code>：查询线程是否活动</li>\n<li><code>getName()</code>：返回线程名</li>\n<li><code>setName()</code>：设置线程名</li>\n</ul>\n</li>\n<li>为了避免两个或多个线程同时运行，产生冲突，可以使用线程锁来控制线程执行的优先顺序，被锁定的线程优先执行，其他进程必须停止</li>\n<li>可以使用<code>threading.Lock().acquire()</code>和<code>threading.Lock().release()</code>来锁定和释放线程</li>\n<li>可以建立一个空数组用于存放线程，再通过<code>append</code>方法将线程添加至该数组中，通过遍历数组可以对其中的线程做同样的操作</li>\n</ul>\n","site":{"data":{}},"more":"<blockquote>\n<p>这篇文章主要记录本人在学习Python时遇到的坑以及这个语言的一些特性，内容以时间顺序整理，比较零散杂乱。对于从零开始的同学，请参考官方文档<a href=\"https://docs.python.org/zh-cn/3/\">Python 3.8.1 中文文档</a>或其他网络上的教程。本文章将持续更新。</p>\n</blockquote>\n<h3 id=\"19-9-14\"><a href=\"#19-9-14\" class=\"headerlink\" title=\"19/9/14\"></a>19/9/14</h3><ul>\n<li>注释方法：<code>#（一行注释）</code>，<code>“”“ ”“”（多行注释）</code></li>\n<li>for循环：<code>for （变量） in （范围）</code>，范围可以用<code>range</code>函数</li>\n<li><code>Input</code>函数的输入是<code>char</code>类型的</li>\n<li><code>//</code>是整除运算</li>\n<li>逗号不可以用来分隔语句</li>\n<li>使用缩进（4个空格）来代替C/C++中的大括号</li>\n</ul>\n<h3 id=\"19-9-15\"><a href=\"#19-9-15\" class=\"headerlink\" title=\"19/9/15\"></a>19/9/15</h3><ul>\n<li><code>for...in</code>循环中，<code>_</code>可以作为循环变量，这时候仅循环指定次数，而不需要关心循环变量的值；事实上，<code>_</code>是一个合法的标识符，如果不关心这个变量，就可以将其定义成这个值，它是一个垃圾桶</li>\n<li>定义函数时，使用<code>函数名(*参数名)</code>的定义方式， <code>*</code> 代表函数的参数是可变参数，可以有0到多个参数</li>\n<li>一个文件代表一个模块(module)，若在不同的模块中含有同名函数，那么可以通过<code>import</code>导入指定的模块中的函数，如<code>from 模块 import 函数</code>，或者<code>import 模块 as 自定义模块名称</code>，再通过<code>自定义模块名称.函数</code>的方式调用</li>\n<li><code>__name__</code>是Python中一个隐含的变量，代表了模块的名字，只用直接执行的模块的名字才是<code>__main__</code></li>\n<li>可以使用<code>global</code>指定使用的是一个全局变量，如果全局变量中没有找到对应的，那么会定义一个新的全局变量</li>\n<li>嵌套作用域：对于函数a内部的函数b而言，a中定义的变量对b来说是在嵌套作用域中的，若要指定修改嵌套作用域中的变量，可以使用<code>nonlocal</code>指示变量来自嵌套作用域</li>\n<li><code>pass</code>是一个空语句，只起到占位作用</li>\n<li>可以定义一个<code>main</code>函数（或者与模块名字相同的函数），再按照<code>if __name__ = &#39;__main__&#39;</code>的格式使脚本执行</li>\n</ul>\n<h3 id=\"19-9-17\"><a href=\"#19-9-17\" class=\"headerlink\" title=\"19/9/17\"></a>19/9/17</h3><ul>\n<li>与字符串有关的函数的调用方式为：<code>字符串名称.字符串操作函数()</code>，在此时字符串是一个对象，字符串操作函数的作用是向字符串对象发送一个消息</li>\n<li>字符串实质上是一个数组，可以进行下标运算</li>\n<li>字符串切片可以在下标运算中使用冒号进行运算，<code>[起始字符:结束字符:间隔]</code>，若不定义起始与终止字符，则默认为整个字符串，当间隔为负值时，以为着切片操作反向</li>\n<li>字符串的索引为负值时，意味着索引从右到左数</li>\n<li>列表可以理解为一个数组，其操作与字符串类似</li>\n<li>可使用<code>sorted</code>函数对列表进行排序</li>\n<li>可以使用生成式语法创建列表：<code>f = [x for x in range(1, 10)]</code>（此方法在创建列表后元素已经准备就绪，耗费较多内存），或<code>f = (x for x in range(1, 10))</code>（此方法创建的是一个生成器对象，需要数据时列表通过生成器产生，节省内存但是耗费较多时间）</li>\n<li>可以使用<code>yield</code>关键字来实现迭代，使用<code>yield</code>就是产生了一个生成器，每次遇到<code>yield</code>时函数会暂停并保存当前所有的运行信息，返回<code>yield</code>的值，并在下一次执行此方法是从当前位置开始运行</li>\n<li>可以定义元组，其相当于不能修改的数组，一个元组中的元素数据类型可以不同，定义元组使用<code>t = ()</code></li>\n<li>列表和元组可以互相转换</li>\n<li>可以定义集合，定义集合可以使用<code>set = &#123;&#125;</code>，元组可以转换为集合</li>\n<li>字典类似于数组，但是它是由多组键值对组成的</li>\n</ul>\n<h3 id=\"19-9-19\"><a href=\"#19-9-19\" class=\"headerlink\" title=\"19/9/19\"></a>19/9/19</h3><ul>\n<li>使用class关键字定义类，再在类中定义函数，如：<code>class 类名(object)</code></li>\n<li><code>__init__</code>函数是用于在创建对象时进行的初始化操作</li>\n<li>self是类的本身，是它的实例变量，在类中所有函数的第一个参数就是self，在类中修改属性值需使用<code>self.属性值 = x</code>的语法</li>\n<li>实例化类的方法：<code>对象名 = 类名(初始化函数参数)</code></li>\n<li>对象中方法的引用可以采用<code>对象.方法（也即函数）</code>的语句，通过此方式向对象发送消息</li>\n<li>Python中，属性和方法的访问权限只有<code>public</code>和<code>private</code>，若希望属性或方法是私有的，在给它们命名的时候要使用<code>__</code>开头，但是不建议将属性设置为私有的</li>\n<li>使用<code>_</code>开头暗示属性或方法是受保护(protected)的，访问它们建议通过特定的方法，但实际上它们还是可以直接被外部访问</li>\n<li>可以通过在类中定义方法以访问对象受保护的属性，在定义这些方法（函数）时，要在上一行使用<code>@property</code>包装这些方法</li>\n<li>对于被保护的属性，在访问它们时采用<code>getter</code>方法，需添加<code>@property</code>，在修改它们时采用<code>setter</code>方法，需添加<code>@函数（即方法）名.setter</code></li>\n<li>Python可以对对象动态绑定新的属性或方法</li>\n<li>可以使用<code>__slots__</code>限定对象只能绑定某些属性，但是它只对当前类的对象生效，对子类不起作用</li>\n<li>可以通过给类发送消息，在类的对象被创建出来之前直接使用其中的方法，此种方法被称为静态方法，需要在定义时添加<code>@staticmethod</code>，此类方法的参数不含有<code>self</code></li>\n<li>通过类方法可以获取类相关的信息并且可以<strong>创建出类的对象</strong>，需要在定义时添加<code>@classmethod</code>，类方法的第一个参数是<code>cls</code>，这个<code>cls</code>相当于就是在外部实例化类时定义的对象名，只不过它是放在类的内部使用了，其功能就是可以像在外部调用对象的属性和方法一样在类的内部使用对象（类）的属性和方法</li>\n</ul>\n<h3 id=\"19-9-20\"><a href=\"#19-9-20\" class=\"headerlink\" title=\"19/9/20\"></a>19/9/20</h3><ul>\n<li>类之间的关系：<ul>\n<li>is-a：继承或者泛化，如：<strong>student</strong> is a <strong>human being</strong>，<strong>cell phone</strong> is a <strong>electronic device</strong></li>\n<li>has-a：关联，如 <strong>department</strong> has an <strong>employee</strong></li>\n<li>use-a：依赖，如 <strong>driver</strong> use a <strong>car</strong> </li>\n</ul>\n</li>\n<li>类与类之间可以继承，提供继承信息的成为父类（超类或者基类），得到继承的称为子类（派生类或者衍生类）</li>\n<li>Python中继承的写法：<code>class 子类名(基类名)</code></li>\n<li>在编程中一般使用子类去替代基类</li>\n<li>在子类中，通过重新定义父类中的方法，可以让同一种方法在不同的子类中有不同的行为，这称为重写</li>\n</ul>\n<h3 id=\"20-1-11\"><a href=\"#20-1-11\" class=\"headerlink\" title=\"20/1/11\"></a>20/1/11</h3><ul>\n<li>Python中提供两个重要的功能：异常处理和断言（Assertions）来处理运行中出现的异常和错误，他们的功能是用于调试Python程序</li>\n<li>异常：无法正常处理程序时会发生异常，是一个对象，如果不捕获异常，程序会终止执行</li>\n<li>Python中异常处理的写法：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>: </span><br><span class=\"line\">    <span class=\"comment\">#operation1</span></span><br><span class=\"line\"><span class=\"keyword\">except</span> exception_type, argument:</span><br><span class=\"line\">    <span class=\"comment\">#if error occurs in operation1, execute operation2</span></span><br><span class=\"line\">  <span class=\"comment\">#operation2</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>: </span><br><span class=\"line\">    <span class=\"comment\">#if no error occurs in operation1, execute operation3</span></span><br><span class=\"line\">  <span class=\"comment\">#operation3</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用<code>except</code>可以不带异常类型，但是会让<code>try-except</code>语句捕获所有的异常，不建议这样写</li>\n<li>可以使用<code>expect(exception1[, expection2[, expection3]])</code>来添加多个异常类型</li>\n<li><code>argument</code>为异常的参数，可以用于输出异常信息的异常值</li>\n<li>也可以使用如下方法，但是与<code>try-except</code>有所不同：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"comment\">#operation1</span></span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">    <span class=\"comment\">#in error occurs in operation1, directly execute operation2, otherwise, execute operation2 after operation1 finished</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><code>finally</code>和<code>except</code>不可以同时使用</p>\n</li>\n<li><p>可以使用<code>raise</code>触发异常</p>\n</li>\n<li><p><code>append()</code>方法用于在列表末尾添加新的对象，对于一个数组<code>list</code>，可以这样使用：<code>list.append()</code></p>\n</li>\n<li><p>多线程用于同时执行多个不同的程序，可以把占据长时间的程序中的任务放到后台处理</p>\n</li>\n<li><p>线程与进程：独立的线程有自己的程序入口、执行序列、程序出口，但是线程不可以独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制</p>\n</li>\n<li><p>在Python中使用线程：<code>thread.start_new_thread(function, args[, kwargs])</code>，其中<code>function</code>为线程函数，这个函数需要提前定义好，<code>args</code>为传递给线程函数的参数，是一个元组，<code>kwargs</code>为可选参数，此种方式称为函数式，线程的结束一般靠函数的自然结束</p>\n</li>\n<li><p>此外还可以使用Python所提供的<code>threading</code>模块，直接从<code>threading.Thread</code>继承：<code>class myThread(threading.Thread)</code>，然后重写<code>__init__</code>和<code>run</code>方法，把需要执行的代码写到<code>run</code>方法里面，<code>__init__</code>的重写方法如下：</p>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, threadID, name, counter</span>):</span></span><br><span class=\"line\">    threading.Thread.__init__(self)</span><br><span class=\"line\">    self.threadID = threadID</span><br><span class=\"line\">    self.name = name</span><br><span class=\"line\">    self.counter = counter</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>上述<code>thread</code>类提供了以下方法：<ul>\n<li><code>run()</code>：表示线程活动的方法</li>\n<li><code>start</code>：启动线程</li>\n<li><code>join()</code>：等待直到线程终止</li>\n<li><code>isAlive()</code>：查询线程是否活动</li>\n<li><code>getName()</code>：返回线程名</li>\n<li><code>setName()</code>：设置线程名</li>\n</ul>\n</li>\n<li>为了避免两个或多个线程同时运行，产生冲突，可以使用线程锁来控制线程执行的优先顺序，被锁定的线程优先执行，其他进程必须停止</li>\n<li>可以使用<code>threading.Lock().acquire()</code>和<code>threading.Lock().release()</code>来锁定和释放线程</li>\n<li>可以建立一个空数组用于存放线程，再通过<code>append</code>方法将线程添加至该数组中，通过遍历数组可以对其中的线程做同样的操作</li>\n</ul>\n"},{"title":"Summary of Reinforcement Learning 1","date":"2020-01-17T13:14:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/t3.jpeg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/t3.jpeg","excerpt":"A brief introduction to reinforcement learning.","_content":"\n### Preface\n\nThis blog is the first one of my series of blogs that summary the key points of reinforcement learning, other blogs will be updated recently according to my learning progress. \n\nThese series of blogs of mine are mostly based on the following works and I'm really grateful to the contributors: \n\n- Online courses of [Stanford University CS234: Reinforcement Learning, Emma Brunskill](https://www.youtube.com/watch?v=FgzM3zpZ55o&list=PLoROMvodv4rOSOPzutgyCTapiGlY2Nd8u) and [lecture notes](https://drive.google.com/drive/folders/1tDME7YQWuipE7WVi0QHFoLhMOvAQdWIn).\n- [Blogs of 从流域到海域](https://blog.csdn.net/solo95/category_9298323.html).\n- [Blogs of 叶强](https://zhuanlan.zhihu.com/reinforce).\n\nIf you find any mistake in my articles, please feel free to tell me in comments.\n\n### What is reinforcement learning (RL)?\n\nRL is a kind of machine learning method that mainly focuses on the interaction between the agent (subject) and the model (environment, world). Through this interaction, the agent can gain experience and then have a better performance in some specific aspects. For example, a robot player can get a high score in a game after being trained by using RL method, or we can make the autopilot of the car to control it keep its lane and drive to the destination smoothly without any collision.\n\nA RL agent may interact with the world, and then recieve some feedback signal for each interaction. By jduging whether the feedback signal is good (beneficial to the agent's desire performance) or not, the agent can then change its way interacting with the world (make better decisions) in order to reach the best performance. By accumulating these experiences, the agent can become more and more \"smarter\" and has a better performance.\n\n### Some basic notions of RL\n\nBecause in the real world, we make decisions in a sequence in a period. Therefore, we need to introduce \"time\" to clearly indicate the quantities related to the agent at the specific position on the time axis. The notation with subscript \"t\" means time it is in a time sequence. \n\n- **Agent**: The subject of RL, it is agent that interact with the world.\n- **Model**: The world, the environment, the *agent* stays in the *model*.\n- **Reward**: $ \\{r_t\\} $ , the feedback signal from the *model*, *agent* recieves the *reward*. The *reward* can have different values according to the different **states** of the *agent*.\n- **State**: $\\{s_t\\}$ , the *state* of the *agent*. The *state* can be either finite or infinite, and it is set by people.\n- **Action**: $\\{a_t\\}$ , the movement of the *agent* in the *model*, *actions* are different under different *states*.\n- **Observation**: $\\{o_t\\}$ , the *agent* need to observe its *state* and determine the *reward*.\n- **History**: a sequence of *action*, *reward*, *observation*, which is: $h_t=(a_1,o_1,r_1,...,a_t,o_t,r_t)$.\n- **Sequential Decision Making**: make decision base on the *history*, that is: $a_{t+1}=f(h_t)$.\n\nFigure 1.1 shows how an agent interact with its world.\n\n![Figure 1.1](https://astrobear.top/resource/astroblog/content/rl1.1.jpeg)\n\n### How to model the world?\n\n#### Markov Property\n\n$P(s_{t+1}|s_t,a_t,...,s_1,a_1)=P(s_{t+1}|s_t,a_t)$\n\nLeft-hand side is called the *transition dynamics* of the world, whcih means the probability distribution over $S$. In RL, we often use this assumption. \n\nA model consists of the two elements below. \n\n#### Transition dynamics $P(s_{t+1}|s_t,a_t)$\n\nThe probability of a specific state in the next timestep. Because an agent always has many states, $P$ is often a matrix. The dimension of $P$ denpends on the dimension of the state space. \n\n#### Reward function $R(s,a)$\n\nUsually, we consider the reward $r_t$ to be received on the transition between states, $s_t\\rightarrow{s_{t+1}}$. A reward function is used to predict rewards, which can be written in the form $R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.\n\n### How to make a RL agent?\n\nLet the agent state be a function of the history, $s_t^a=g(h_t)$.\n\nAn agent often consists the three elements below.\n\n#### Policy $\\pi(a_t|s_a^t)$\n\nPolicy is a mapping from the state to an action, which means we can determine the action through the policy if we know the state. Please notice that the policy we mention here is stochastic.  When the agent want to take an action and $\\pi$ is stochastic, it picks action $a\\in A$ with probability\n\n$P(a_t=a)=\\pi(a|s_t^a)$.\n\n#### Value function $V^\\pi$\n\nIf we have discount factor $\\gamma\\in [0,1]$, which is used to weigh immediate rewards versus delayed rewards, value function is an expected sum of discounted rewards\n\n$V^\\pi=\\Bbb E_\\pi[r_t+\\gamma r_{t+1}+\\gamma ^2 r_{t+2}+...|s_t=s]$.\n\n#### Model\n\nThe agent in RL may have a model. I have introduced how to make a model in section 3.\n\n### Three questions we are facing\n\n#### Do we need exploration or exploitation?\n\nIn RL, the agent must be able to optimize its actions to maximize the reward signal it receives. We have 2 ways to achieve this target, the first is to let the agent exploit what it already knows, the second is to explore the world where is unknown for the agent. This leads to a trade-off between exploration and exploitation.\n\n#### Can the agent generalize its experience?\n\nIn actual world, the agent often has infinite states. However, it is impossible for us to include all of them in RL. Can the agent learn whether some actions are good or bad in previously unseen states?\n\n#### Delayed consequences\n\nThe action executed by the agent may let it recieve high reward at present state. However, this action may have negative effects in the future. Or we can also ask, if the rewards are caused by the action the agent just took or because of the action taken much earlier?\n\n### What's next?\n\nNow we have known the basic frame and its components of reinforcement learning. But what is the exact form of the transition dynamics, reward function, policy, value function? And what's the relationship between these functions? How can I use these functions to make an agent? We will discuss these questions in the next chapter.","source":"_posts/RLSummary1.md","raw":"---\ntitle: Summary of Reinforcement Learning 1\ndate: 2020-1-17 21:14:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- RL\n\t- Research\n\t- Python\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/t3.jpeg\n\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/t3.jpeg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: A brief introduction to reinforcement learning.\n\n#You can begin to input your article below now.\n\n---\n\n### Preface\n\nThis blog is the first one of my series of blogs that summary the key points of reinforcement learning, other blogs will be updated recently according to my learning progress. \n\nThese series of blogs of mine are mostly based on the following works and I'm really grateful to the contributors: \n\n- Online courses of [Stanford University CS234: Reinforcement Learning, Emma Brunskill](https://www.youtube.com/watch?v=FgzM3zpZ55o&list=PLoROMvodv4rOSOPzutgyCTapiGlY2Nd8u) and [lecture notes](https://drive.google.com/drive/folders/1tDME7YQWuipE7WVi0QHFoLhMOvAQdWIn).\n- [Blogs of 从流域到海域](https://blog.csdn.net/solo95/category_9298323.html).\n- [Blogs of 叶强](https://zhuanlan.zhihu.com/reinforce).\n\nIf you find any mistake in my articles, please feel free to tell me in comments.\n\n### What is reinforcement learning (RL)?\n\nRL is a kind of machine learning method that mainly focuses on the interaction between the agent (subject) and the model (environment, world). Through this interaction, the agent can gain experience and then have a better performance in some specific aspects. For example, a robot player can get a high score in a game after being trained by using RL method, or we can make the autopilot of the car to control it keep its lane and drive to the destination smoothly without any collision.\n\nA RL agent may interact with the world, and then recieve some feedback signal for each interaction. By jduging whether the feedback signal is good (beneficial to the agent's desire performance) or not, the agent can then change its way interacting with the world (make better decisions) in order to reach the best performance. By accumulating these experiences, the agent can become more and more \"smarter\" and has a better performance.\n\n### Some basic notions of RL\n\nBecause in the real world, we make decisions in a sequence in a period. Therefore, we need to introduce \"time\" to clearly indicate the quantities related to the agent at the specific position on the time axis. The notation with subscript \"t\" means time it is in a time sequence. \n\n- **Agent**: The subject of RL, it is agent that interact with the world.\n- **Model**: The world, the environment, the *agent* stays in the *model*.\n- **Reward**: $ \\{r_t\\} $ , the feedback signal from the *model*, *agent* recieves the *reward*. The *reward* can have different values according to the different **states** of the *agent*.\n- **State**: $\\{s_t\\}$ , the *state* of the *agent*. The *state* can be either finite or infinite, and it is set by people.\n- **Action**: $\\{a_t\\}$ , the movement of the *agent* in the *model*, *actions* are different under different *states*.\n- **Observation**: $\\{o_t\\}$ , the *agent* need to observe its *state* and determine the *reward*.\n- **History**: a sequence of *action*, *reward*, *observation*, which is: $h_t=(a_1,o_1,r_1,...,a_t,o_t,r_t)$.\n- **Sequential Decision Making**: make decision base on the *history*, that is: $a_{t+1}=f(h_t)$.\n\nFigure 1.1 shows how an agent interact with its world.\n\n![Figure 1.1](https://astrobear.top/resource/astroblog/content/rl1.1.jpeg)\n\n### How to model the world?\n\n#### Markov Property\n\n$P(s_{t+1}|s_t,a_t,...,s_1,a_1)=P(s_{t+1}|s_t,a_t)$\n\nLeft-hand side is called the *transition dynamics* of the world, whcih means the probability distribution over $S$. In RL, we often use this assumption. \n\nA model consists of the two elements below. \n\n#### Transition dynamics $P(s_{t+1}|s_t,a_t)$\n\nThe probability of a specific state in the next timestep. Because an agent always has many states, $P$ is often a matrix. The dimension of $P$ denpends on the dimension of the state space. \n\n#### Reward function $R(s,a)$\n\nUsually, we consider the reward $r_t$ to be received on the transition between states, $s_t\\rightarrow{s_{t+1}}$. A reward function is used to predict rewards, which can be written in the form $R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.\n\n### How to make a RL agent?\n\nLet the agent state be a function of the history, $s_t^a=g(h_t)$.\n\nAn agent often consists the three elements below.\n\n#### Policy $\\pi(a_t|s_a^t)$\n\nPolicy is a mapping from the state to an action, which means we can determine the action through the policy if we know the state. Please notice that the policy we mention here is stochastic.  When the agent want to take an action and $\\pi$ is stochastic, it picks action $a\\in A$ with probability\n\n$P(a_t=a)=\\pi(a|s_t^a)$.\n\n#### Value function $V^\\pi$\n\nIf we have discount factor $\\gamma\\in [0,1]$, which is used to weigh immediate rewards versus delayed rewards, value function is an expected sum of discounted rewards\n\n$V^\\pi=\\Bbb E_\\pi[r_t+\\gamma r_{t+1}+\\gamma ^2 r_{t+2}+...|s_t=s]$.\n\n#### Model\n\nThe agent in RL may have a model. I have introduced how to make a model in section 3.\n\n### Three questions we are facing\n\n#### Do we need exploration or exploitation?\n\nIn RL, the agent must be able to optimize its actions to maximize the reward signal it receives. We have 2 ways to achieve this target, the first is to let the agent exploit what it already knows, the second is to explore the world where is unknown for the agent. This leads to a trade-off between exploration and exploitation.\n\n#### Can the agent generalize its experience?\n\nIn actual world, the agent often has infinite states. However, it is impossible for us to include all of them in RL. Can the agent learn whether some actions are good or bad in previously unseen states?\n\n#### Delayed consequences\n\nThe action executed by the agent may let it recieve high reward at present state. However, this action may have negative effects in the future. Or we can also ask, if the rewards are caused by the action the agent just took or because of the action taken much earlier?\n\n### What's next?\n\nNow we have known the basic frame and its components of reinforcement learning. But what is the exact form of the transition dynamics, reward function, policy, value function? And what's the relationship between these functions? How can I use these functions to make an agent? We will discuss these questions in the next chapter.","slug":"RLSummary1","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzv000f1q39eqrrh1vb","content":"<h3 id=\"Preface\"><a href=\"#Preface\" class=\"headerlink\" title=\"Preface\"></a>Preface</h3><p>This blog is the first one of my series of blogs that summary the key points of reinforcement learning, other blogs will be updated recently according to my learning progress. </p>\n<p>These series of blogs of mine are mostly based on the following works and I’m really grateful to the contributors: </p>\n<ul>\n<li>Online courses of <a href=\"https://www.youtube.com/watch?v=FgzM3zpZ55o&list=PLoROMvodv4rOSOPzutgyCTapiGlY2Nd8u\">Stanford University CS234: Reinforcement Learning, Emma Brunskill</a> and <a href=\"https://drive.google.com/drive/folders/1tDME7YQWuipE7WVi0QHFoLhMOvAQdWIn\">lecture notes</a>.</li>\n<li><a href=\"https://blog.csdn.net/solo95/category_9298323.html\">Blogs of 从流域到海域</a>.</li>\n<li><a href=\"https://zhuanlan.zhihu.com/reinforce\">Blogs of 叶强</a>.</li>\n</ul>\n<p>If you find any mistake in my articles, please feel free to tell me in comments.</p>\n<h3 id=\"What-is-reinforcement-learning-RL\"><a href=\"#What-is-reinforcement-learning-RL\" class=\"headerlink\" title=\"What is reinforcement learning (RL)?\"></a>What is reinforcement learning (RL)?</h3><p>RL is a kind of machine learning method that mainly focuses on the interaction between the agent (subject) and the model (environment, world). Through this interaction, the agent can gain experience and then have a better performance in some specific aspects. For example, a robot player can get a high score in a game after being trained by using RL method, or we can make the autopilot of the car to control it keep its lane and drive to the destination smoothly without any collision.</p>\n<p>A RL agent may interact with the world, and then recieve some feedback signal for each interaction. By jduging whether the feedback signal is good (beneficial to the agent’s desire performance) or not, the agent can then change its way interacting with the world (make better decisions) in order to reach the best performance. By accumulating these experiences, the agent can become more and more “smarter” and has a better performance.</p>\n<h3 id=\"Some-basic-notions-of-RL\"><a href=\"#Some-basic-notions-of-RL\" class=\"headerlink\" title=\"Some basic notions of RL\"></a>Some basic notions of RL</h3><p>Because in the real world, we make decisions in a sequence in a period. Therefore, we need to introduce “time” to clearly indicate the quantities related to the agent at the specific position on the time axis. The notation with subscript “t” means time it is in a time sequence. </p>\n<ul>\n<li><strong>Agent</strong>: The subject of RL, it is agent that interact with the world.</li>\n<li><strong>Model</strong>: The world, the environment, the <em>agent</em> stays in the <em>model</em>.</li>\n<li><strong>Reward</strong>: $ {r_t} $ , the feedback signal from the <em>model</em>, <em>agent</em> recieves the <em>reward</em>. The <em>reward</em> can have different values according to the different <strong>states</strong> of the <em>agent</em>.</li>\n<li><strong>State</strong>: ${s_t}$ , the <em>state</em> of the <em>agent</em>. The <em>state</em> can be either finite or infinite, and it is set by people.</li>\n<li><strong>Action</strong>: ${a_t}$ , the movement of the <em>agent</em> in the <em>model</em>, <em>actions</em> are different under different <em>states</em>.</li>\n<li><strong>Observation</strong>: ${o_t}$ , the <em>agent</em> need to observe its <em>state</em> and determine the <em>reward</em>.</li>\n<li><strong>History</strong>: a sequence of <em>action</em>, <em>reward</em>, <em>observation</em>, which is: $h_t=(a_1,o_1,r_1,…,a_t,o_t,r_t)$.</li>\n<li><strong>Sequential Decision Making</strong>: make decision base on the <em>history</em>, that is: $a_{t+1}=f(h_t)$.</li>\n</ul>\n<p>Figure 1.1 shows how an agent interact with its world.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/rl1.1.jpeg\" alt=\"Figure 1.1\"></p>\n<h3 id=\"How-to-model-the-world\"><a href=\"#How-to-model-the-world\" class=\"headerlink\" title=\"How to model the world?\"></a>How to model the world?</h3><h4 id=\"Markov-Property\"><a href=\"#Markov-Property\" class=\"headerlink\" title=\"Markov Property\"></a>Markov Property</h4><p>$P(s_{t+1}|s_t,a_t,…,s_1,a_1)=P(s_{t+1}|s_t,a_t)$</p>\n<p>Left-hand side is called the <em>transition dynamics</em> of the world, whcih means the probability distribution over $S$. In RL, we often use this assumption. </p>\n<p>A model consists of the two elements below. </p>\n<h4 id=\"Transition-dynamics-P-s-t-1-s-t-a-t\"><a href=\"#Transition-dynamics-P-s-t-1-s-t-a-t\" class=\"headerlink\" title=\"Transition dynamics $P(s_{t+1}|s_t,a_t)$\"></a>Transition dynamics $P(s_{t+1}|s_t,a_t)$</h4><p>The probability of a specific state in the next timestep. Because an agent always has many states, $P$ is often a matrix. The dimension of $P$ denpends on the dimension of the state space. </p>\n<h4 id=\"Reward-function-R-s-a\"><a href=\"#Reward-function-R-s-a\" class=\"headerlink\" title=\"Reward function $R(s,a)$\"></a>Reward function $R(s,a)$</h4><p>Usually, we consider the reward $r_t$ to be received on the transition between states, $s_t\\rightarrow{s_{t+1}}$. A reward function is used to predict rewards, which can be written in the form $R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.</p>\n<h3 id=\"How-to-make-a-RL-agent\"><a href=\"#How-to-make-a-RL-agent\" class=\"headerlink\" title=\"How to make a RL agent?\"></a>How to make a RL agent?</h3><p>Let the agent state be a function of the history, $s_t^a=g(h_t)$.</p>\n<p>An agent often consists the three elements below.</p>\n<h4 id=\"Policy-pi-a-t-s-a-t\"><a href=\"#Policy-pi-a-t-s-a-t\" class=\"headerlink\" title=\"Policy $\\pi(a_t|s_a^t)$\"></a>Policy $\\pi(a_t|s_a^t)$</h4><p>Policy is a mapping from the state to an action, which means we can determine the action through the policy if we know the state. Please notice that the policy we mention here is stochastic.  When the agent want to take an action and $\\pi$ is stochastic, it picks action $a\\in A$ with probability</p>\n<p>$P(a_t=a)=\\pi(a|s_t^a)$.</p>\n<h4 id=\"Value-function-V-pi\"><a href=\"#Value-function-V-pi\" class=\"headerlink\" title=\"Value function $V^\\pi$\"></a>Value function $V^\\pi$</h4><p>If we have discount factor $\\gamma\\in [0,1]$, which is used to weigh immediate rewards versus delayed rewards, value function is an expected sum of discounted rewards</p>\n<p>$V^\\pi=\\Bbb E_\\pi[r_t+\\gamma r_{t+1}+\\gamma ^2 r_{t+2}+…|s_t=s]$.</p>\n<h4 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h4><p>The agent in RL may have a model. I have introduced how to make a model in section 3.</p>\n<h3 id=\"Three-questions-we-are-facing\"><a href=\"#Three-questions-we-are-facing\" class=\"headerlink\" title=\"Three questions we are facing\"></a>Three questions we are facing</h3><h4 id=\"Do-we-need-exploration-or-exploitation\"><a href=\"#Do-we-need-exploration-or-exploitation\" class=\"headerlink\" title=\"Do we need exploration or exploitation?\"></a>Do we need exploration or exploitation?</h4><p>In RL, the agent must be able to optimize its actions to maximize the reward signal it receives. We have 2 ways to achieve this target, the first is to let the agent exploit what it already knows, the second is to explore the world where is unknown for the agent. This leads to a trade-off between exploration and exploitation.</p>\n<h4 id=\"Can-the-agent-generalize-its-experience\"><a href=\"#Can-the-agent-generalize-its-experience\" class=\"headerlink\" title=\"Can the agent generalize its experience?\"></a>Can the agent generalize its experience?</h4><p>In actual world, the agent often has infinite states. However, it is impossible for us to include all of them in RL. Can the agent learn whether some actions are good or bad in previously unseen states?</p>\n<h4 id=\"Delayed-consequences\"><a href=\"#Delayed-consequences\" class=\"headerlink\" title=\"Delayed consequences\"></a>Delayed consequences</h4><p>The action executed by the agent may let it recieve high reward at present state. However, this action may have negative effects in the future. Or we can also ask, if the rewards are caused by the action the agent just took or because of the action taken much earlier?</p>\n<h3 id=\"What’s-next\"><a href=\"#What’s-next\" class=\"headerlink\" title=\"What’s next?\"></a>What’s next?</h3><p>Now we have known the basic frame and its components of reinforcement learning. But what is the exact form of the transition dynamics, reward function, policy, value function? And what’s the relationship between these functions? How can I use these functions to make an agent? We will discuss these questions in the next chapter.</p>\n","site":{"data":{}},"more":"<h3 id=\"Preface\"><a href=\"#Preface\" class=\"headerlink\" title=\"Preface\"></a>Preface</h3><p>This blog is the first one of my series of blogs that summary the key points of reinforcement learning, other blogs will be updated recently according to my learning progress. </p>\n<p>These series of blogs of mine are mostly based on the following works and I’m really grateful to the contributors: </p>\n<ul>\n<li>Online courses of <a href=\"https://www.youtube.com/watch?v=FgzM3zpZ55o&list=PLoROMvodv4rOSOPzutgyCTapiGlY2Nd8u\">Stanford University CS234: Reinforcement Learning, Emma Brunskill</a> and <a href=\"https://drive.google.com/drive/folders/1tDME7YQWuipE7WVi0QHFoLhMOvAQdWIn\">lecture notes</a>.</li>\n<li><a href=\"https://blog.csdn.net/solo95/category_9298323.html\">Blogs of 从流域到海域</a>.</li>\n<li><a href=\"https://zhuanlan.zhihu.com/reinforce\">Blogs of 叶强</a>.</li>\n</ul>\n<p>If you find any mistake in my articles, please feel free to tell me in comments.</p>\n<h3 id=\"What-is-reinforcement-learning-RL\"><a href=\"#What-is-reinforcement-learning-RL\" class=\"headerlink\" title=\"What is reinforcement learning (RL)?\"></a>What is reinforcement learning (RL)?</h3><p>RL is a kind of machine learning method that mainly focuses on the interaction between the agent (subject) and the model (environment, world). Through this interaction, the agent can gain experience and then have a better performance in some specific aspects. For example, a robot player can get a high score in a game after being trained by using RL method, or we can make the autopilot of the car to control it keep its lane and drive to the destination smoothly without any collision.</p>\n<p>A RL agent may interact with the world, and then recieve some feedback signal for each interaction. By jduging whether the feedback signal is good (beneficial to the agent’s desire performance) or not, the agent can then change its way interacting with the world (make better decisions) in order to reach the best performance. By accumulating these experiences, the agent can become more and more “smarter” and has a better performance.</p>\n<h3 id=\"Some-basic-notions-of-RL\"><a href=\"#Some-basic-notions-of-RL\" class=\"headerlink\" title=\"Some basic notions of RL\"></a>Some basic notions of RL</h3><p>Because in the real world, we make decisions in a sequence in a period. Therefore, we need to introduce “time” to clearly indicate the quantities related to the agent at the specific position on the time axis. The notation with subscript “t” means time it is in a time sequence. </p>\n<ul>\n<li><strong>Agent</strong>: The subject of RL, it is agent that interact with the world.</li>\n<li><strong>Model</strong>: The world, the environment, the <em>agent</em> stays in the <em>model</em>.</li>\n<li><strong>Reward</strong>: $ {r_t} $ , the feedback signal from the <em>model</em>, <em>agent</em> recieves the <em>reward</em>. The <em>reward</em> can have different values according to the different <strong>states</strong> of the <em>agent</em>.</li>\n<li><strong>State</strong>: ${s_t}$ , the <em>state</em> of the <em>agent</em>. The <em>state</em> can be either finite or infinite, and it is set by people.</li>\n<li><strong>Action</strong>: ${a_t}$ , the movement of the <em>agent</em> in the <em>model</em>, <em>actions</em> are different under different <em>states</em>.</li>\n<li><strong>Observation</strong>: ${o_t}$ , the <em>agent</em> need to observe its <em>state</em> and determine the <em>reward</em>.</li>\n<li><strong>History</strong>: a sequence of <em>action</em>, <em>reward</em>, <em>observation</em>, which is: $h_t=(a_1,o_1,r_1,…,a_t,o_t,r_t)$.</li>\n<li><strong>Sequential Decision Making</strong>: make decision base on the <em>history</em>, that is: $a_{t+1}=f(h_t)$.</li>\n</ul>\n<p>Figure 1.1 shows how an agent interact with its world.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/rl1.1.jpeg\" alt=\"Figure 1.1\"></p>\n<h3 id=\"How-to-model-the-world\"><a href=\"#How-to-model-the-world\" class=\"headerlink\" title=\"How to model the world?\"></a>How to model the world?</h3><h4 id=\"Markov-Property\"><a href=\"#Markov-Property\" class=\"headerlink\" title=\"Markov Property\"></a>Markov Property</h4><p>$P(s_{t+1}|s_t,a_t,…,s_1,a_1)=P(s_{t+1}|s_t,a_t)$</p>\n<p>Left-hand side is called the <em>transition dynamics</em> of the world, whcih means the probability distribution over $S$. In RL, we often use this assumption. </p>\n<p>A model consists of the two elements below. </p>\n<h4 id=\"Transition-dynamics-P-s-t-1-s-t-a-t\"><a href=\"#Transition-dynamics-P-s-t-1-s-t-a-t\" class=\"headerlink\" title=\"Transition dynamics $P(s_{t+1}|s_t,a_t)$\"></a>Transition dynamics $P(s_{t+1}|s_t,a_t)$</h4><p>The probability of a specific state in the next timestep. Because an agent always has many states, $P$ is often a matrix. The dimension of $P$ denpends on the dimension of the state space. </p>\n<h4 id=\"Reward-function-R-s-a\"><a href=\"#Reward-function-R-s-a\" class=\"headerlink\" title=\"Reward function $R(s,a)$\"></a>Reward function $R(s,a)$</h4><p>Usually, we consider the reward $r_t$ to be received on the transition between states, $s_t\\rightarrow{s_{t+1}}$. A reward function is used to predict rewards, which can be written in the form $R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.</p>\n<h3 id=\"How-to-make-a-RL-agent\"><a href=\"#How-to-make-a-RL-agent\" class=\"headerlink\" title=\"How to make a RL agent?\"></a>How to make a RL agent?</h3><p>Let the agent state be a function of the history, $s_t^a=g(h_t)$.</p>\n<p>An agent often consists the three elements below.</p>\n<h4 id=\"Policy-pi-a-t-s-a-t\"><a href=\"#Policy-pi-a-t-s-a-t\" class=\"headerlink\" title=\"Policy $\\pi(a_t|s_a^t)$\"></a>Policy $\\pi(a_t|s_a^t)$</h4><p>Policy is a mapping from the state to an action, which means we can determine the action through the policy if we know the state. Please notice that the policy we mention here is stochastic.  When the agent want to take an action and $\\pi$ is stochastic, it picks action $a\\in A$ with probability</p>\n<p>$P(a_t=a)=\\pi(a|s_t^a)$.</p>\n<h4 id=\"Value-function-V-pi\"><a href=\"#Value-function-V-pi\" class=\"headerlink\" title=\"Value function $V^\\pi$\"></a>Value function $V^\\pi$</h4><p>If we have discount factor $\\gamma\\in [0,1]$, which is used to weigh immediate rewards versus delayed rewards, value function is an expected sum of discounted rewards</p>\n<p>$V^\\pi=\\Bbb E_\\pi[r_t+\\gamma r_{t+1}+\\gamma ^2 r_{t+2}+…|s_t=s]$.</p>\n<h4 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h4><p>The agent in RL may have a model. I have introduced how to make a model in section 3.</p>\n<h3 id=\"Three-questions-we-are-facing\"><a href=\"#Three-questions-we-are-facing\" class=\"headerlink\" title=\"Three questions we are facing\"></a>Three questions we are facing</h3><h4 id=\"Do-we-need-exploration-or-exploitation\"><a href=\"#Do-we-need-exploration-or-exploitation\" class=\"headerlink\" title=\"Do we need exploration or exploitation?\"></a>Do we need exploration or exploitation?</h4><p>In RL, the agent must be able to optimize its actions to maximize the reward signal it receives. We have 2 ways to achieve this target, the first is to let the agent exploit what it already knows, the second is to explore the world where is unknown for the agent. This leads to a trade-off between exploration and exploitation.</p>\n<h4 id=\"Can-the-agent-generalize-its-experience\"><a href=\"#Can-the-agent-generalize-its-experience\" class=\"headerlink\" title=\"Can the agent generalize its experience?\"></a>Can the agent generalize its experience?</h4><p>In actual world, the agent often has infinite states. However, it is impossible for us to include all of them in RL. Can the agent learn whether some actions are good or bad in previously unseen states?</p>\n<h4 id=\"Delayed-consequences\"><a href=\"#Delayed-consequences\" class=\"headerlink\" title=\"Delayed consequences\"></a>Delayed consequences</h4><p>The action executed by the agent may let it recieve high reward at present state. However, this action may have negative effects in the future. Or we can also ask, if the rewards are caused by the action the agent just took or because of the action taken much earlier?</p>\n<h3 id=\"What’s-next\"><a href=\"#What’s-next\" class=\"headerlink\" title=\"What’s next?\"></a>What’s next?</h3><p>Now we have known the basic frame and its components of reinforcement learning. But what is the exact form of the transition dynamics, reward function, policy, value function? And what’s the relationship between these functions? How can I use these functions to make an agent? We will discuss these questions in the next chapter.</p>\n"},{"title":"Summary of Reinforcement Learning 2","date":"2020-01-18T13:06:00.000Z","cover":"https://pic1.zhimg.com/80/v2-e1e894383536e4ff019f63e5507c2a18_hd.png","thumbnail":"https://pic1.zhimg.com/80/v2-e1e894383536e4ff019f63e5507c2a18_hd.png","excerpt":"Introduction to MP, MRP, and MDP.","_content":"\n### Markov process (MP)\n\nMarkov process is a stochastic process that satisfies the Markov property, which means it is \"memoryless\" and will not be influenced by the history. MP is sometimes called Markov chain. However, their defination have some slight differences. \n\nWe need to make two assumptions before we define the Markov process. The first assumption is that *the state of MP is finite*, and we have $s_i\\in S, i\\in1,2,...$ , where $|S|<\\infty$. The second assumption is that *the transition probabilities are time independent*. Transition probabilities are the probability to transform from the current state to a given state, whcih can be written as $P(s_i|s_{i-1}), \\forall i=1,2,...$.\n\nBase on these two assumption, we can define a *transition transform matrix*:\n\n![](https://astrobear.top/resource/astroblog/content/RLS2F0.png)\n\nThe size of $\\bf P$ is $|S|\\times |S|$ and the sum of each row of $\\bf P$ equals 1.\n\nHenceforth, we can define a Markov process using a tuple $(S,\\bf P)$.\n\n- $S$: A finite state space.\n- $\\bf P$: A transition probability.\n\nBy calculating $S\\bf P$ we can get the distribution of the new state.\n\nFigure 1 shows a student MP example.\n\n![Figure 1](https://pic1.zhimg.com/80/v2-23b6d59cfe253c4a678a1d9e8df43110_hd.png)\n\n### Markov reward process (MRP)\n\nMRP is a MP together with the specification of a reward function $R$ and a discount factor $\\gamma$. We can also use a tuple $(S,\\bf P,\\mit R,\\gamma)$ to describe it.\n\n- $S$: A finite state space.\n- $\\bf P$: A transition probability.\n- $R$: A reward function that maps states to rewards (real numbers).\n- $\\gamma$: Discount factor between 0 and 1.\n\nHere are some explaintions.\n\n#### Reward function\n\nWhen we are moving from the current state $s$ to a *successor state* $s'$, a reward is obtained depending on the current state $s$ (in reality we get the reward at $s'$ ). For a state $s\\in S$, we define the expected reward by\n\n$R(s)=\\Bbb E[r_t|s_t=s]$. \n\nHere we assume that the reward is time independent. $R$ can be represented as a vector of dimension $|S|$.\n\n#### Horizon\n\nIt is defined as the number of time steps in each episode of the process. An *episode* is the whole process of a round of training. The horizon can be finite or infinite.\n\n#### Return\n\nThe return $G_t$ is defined as the discounted sum of rewards starting at time $t$ up to the horizon *H*. We can calculate the return using\n\n$G_t=\\sum^{H-1}_{i=t}\\gamma^{i-t}r_i$.\n\n#### State value function\n\nThe state value function $V_t(s)$ is defined as the expected return starting from state $s$ and time $t$ and is given by the following expression\n\n$V_t(s)=\\Bbb E[G_t|s_t=s]$. \n\nIf the episode is determined, then the $G_t$ as well as $V_t(s)$ will remain unchanged. However, because every episode is a random process, the return and state value function will be different in different episodes.\n\n#### Discount factor\n\nWe design the discount factor for many reasons. The best reason among them I think is that, people always pay more attention to the immediate reward rather than the long-term reward. If we set $\\gamma <1$, the agent will behave like a human more. We should notice that when $\\gamma=0$, we just foucs on the immediate reward. When $\\gamma=1$, we put as much importance on future rewards as compared the present.\n\nFigure 2 and 3 shows an example of how to calculate the return.\n\n![Figure 2](https://astrobear.top/resource/astroblog/content/RLS2F2.png)\n\n![Figure 3](https://pic2.zhimg.com/v2-91921a745909435f7b984d1dae5ef271_r.jpg)\n\nIt is significant to find out a value function while many problems of RL is how to get a value function essentially.\n\n#### Computing the value function\n\nWe have three ways to compute the value function.\n\n- Simulation. Through simulation, we can get the value function by averaing many returns of episodes.\n\n- Analytic solution. We have defined the state value function \n\n  $V_t(s)=\\Bbb E[G_t|s_t=s]$. \n\n  Then, make a little transformation, see Figure 4 in detail. \n\n  ![Figure 4](https://astrobear.top/resource/astroblog/content/RLS2F4.png)\n\n  Then, we have\n\n  $V(s)=R(s)+\\gamma \\sum P(s'|s)V(s')$, \n\n  \n\n  $V=R+\\gamma\\bf P\\mit V$. \n\n  Therefore we have\n\n  $V=(1-\\gamma \\bf P\\rm )\\mit^{-1}R$. \n\n  If $0<\\gamma<1$, then $(1-\\gamma \\bf P\\rm)$ is always invertible. However, the computational cost of the analytical method is $O(|S|^3)$, hence it is only suitable for the cases where the $|S|$ is not very large.\n\n  Notice that $s'$ includes all the possible successor states. Here is an example in Figure 5. This example shows that how to calculate the value of the state represented by the red circle.\n\n  ![Figure 5](https://pic4.zhimg.com/80/v2-a8997be4d72fcb8faaee4db82db495b3_hd.png)\n\n- Iterative solution. \n\n  $V_t(s)=R(s)+\\gamma \\sum P(s'|s)V_{t+1}(s'), \\forall t=0,...,H-1,V_H(s)=0$. \n\n  We can iterate it again and again and use $|V_t-V_{t-1}|<\\epsilon$ ($\\epsilon$ is tolerance) to jduge the convergence of the algorithm. \n\n### Markov decision process (MDP)\n\nMDP is MRP with the specification of a set of actions $A$. We can use a tuple $(S,A,\\bf P,\\mit R,\\gamma)$ to describe it. \n\n- $S$: A finite state space.\n- $A$: A finite set of actions which are available from each state $s$.\n- $\\bf P$: A transition probability.\n- $R$: A reward function that maps states to rewards (real numbers).\n- $\\gamma$: Discount factor between 0 and 1.\n\nHere are some explanations.\n\n#### Notifications\n\n- Both $S$ and $A$ are finite.\n\n- In MDP, the transition probabilities at time $t$ are a function of the successor state $s_{t+1}$ along with both the current state $s_t$ and the action $a_t$, written as\n\n  $P(s_{t+1}|s_t,a_t)$.\n\n- In MDP, the reward $r_t$ at time $t$ depends on both $s_t$ and $a_t$, written as\n\n  $R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.\n\n- Expect for the value functions and what we have mentioned in this section, other notions are exactly the same as MRP.\n\n#### Policy\n\nBefore we mention the state value function, we need to talk about the policy for the MDP first. \n\nA policy specifies what action to take in each state, which is actually a probability distribution over actions given the current state. The policy may be *varying with time*, especially when the horizon is finite. A policy can be written as\n\n$\\pi(a|s)=P(a_t=a|s_t=s)$. \n\nIf given a MDP and a $\\pi$, the process of reward satisfies the following two relationships: \n\n- $P^\\pi(s'|s)=\\sum_{a\\in A}\\pi(a|s) P(s'|s,a)$\n\n  When we have a policy $\\pi$, the probability of the state transforms from $s$ to $s'$ equals to the sum of a series probabilities. These probabilities are the production of the probability to execute a specific action $a$ under the state $s$ and the probability of the state transforms from $s$ to $s'$ when executing an action $a$.\n\n- $R^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)R(s,a)$\n\n  When we have a policy $\\pi$, the reward of the state $s$ is the sum of the product of he probability to execute a specific action $a$ under the state $s$ and all rewards that the action $a$ can get under the state $s$.\n\n#### Value functions in MDP (Bellman expectation equations)\n\nGiven a policy $\\pi$ can define two quantities: *the state value function* and *the state-action value function*. These two value functions are both *Bellman expectation equations*.\n\n- State value function: The state value function $V^\\pi_t(s)$ for a state $s\\in S$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and the following policy $\\pi$, and is given by the expression\n\n  $V^\\pi_t(s)=\\Bbb E_\\pi[G_t|s_t=s]=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$. \n\n  Frequently we will drop the subscript $\\pi$ in the expectation. \n\n- State-action value function: The state-action value function $Q^\\pi_t(s,a)$ for a state $s$ and action $a$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and taking the action $a_t=a$ that has nothing to do with the policy, and then subsequently following the policy $pi$, written in a mathmatical form\n\n  $Q^\\pi_t(s,a)=\\Bbb E[G_t|s_t=s,a_t=a]=\\Bbb E[R_{t+1}+\\gamma Q_\\pi (s_{t+1},a_{t+1})|s_t=s,a_t=a]$. \n\n  It evaluates the value of acting the action $a$ under current state $s$. \n\nNow let's talk about the relationships between these two value functions.\n\nFigure 6 shows the actions that an agent can choose under a specific state, the white circle represents the state while black circles represent actions.\n\n![Figure 6](https://pic1.zhimg.com/80/v2-afda4ee31b7ea7238f7c2bc15709e5a8_hd.png)\n\nWe can discover that the value of a state can be denoted as\n\n$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$.\n\nIn a similar way, Figure 7 shows what states that an action can lead to.\n\n![Figure 7](https://pic4.zhimg.com/80/v2-5f4535af4300fa2228348c233724227b_hd.png)\n\nWe can also find that \n\n$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)V^\\pi(s')$. \n\nOn the right-hand side, the first part is the value of the state $s$, the second part is the sum of the product of the value of new state $s'$ and the probability of getting into that new state. \n\nIf we combine the two Bellman equation with each other, we can get\n\n$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)[R(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V^\\pi(s')]$\n\n​            $=R(s',\\pi(s'))+\\gamma\\sum_{s'\\in S}P(s'|s,\\pi(s)) V^\\pi(s')$, \n\nand\n\n$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)\\sum_{a\\in A}\\pi(a'|s')Q_\\pi(s',a')$. \n\nThe example in Figure 8 shows that how to calculate the state value of the state represented by the red circle. Notice that actions $Study$ and $Pub$ have the same probabilities $\\pi(a|s)$ to be executed, which means they are all $0.5$.\n\n![Figure 8](https://pic1.zhimg.com/80/v2-1ef95dc0d203c5f2e85986faf31464b0_hd.png)\n\n#### Optimality value function (Bellman optimality equation)\n\n- Optimality state value function $V^*(s)=\\tt max\\mit V^\\pi(s)$ indicates a state value function generated by a policy that makes the value of state $s$ the biggest. \n- Optimality state-action value function $Q^*(s,a)=\\tt max\\mit Q_\\pi(s,a)$ indicates a state-action value function generated by a policy that makes the value of the state-action $(s,a)$ the biggest.\n\nOptimality value function determines the best performance of a MDP. When we know the optimality value function, we know the best policy and the best value of every state, and the MDP problem is solved. Solving an optimality value function require us to solve the best policy at first. \n\n### Find the best policy\n\nThe best policy is defined precisely as *optimal policy*  $\\pi^ *$ , which means for every policy $\\pi$, for all time steps, and for all states  $s\\in S$ , there is  $V_t^{\\pi^ *}(s)\\geq V_t^\\pi(s)$.\n\nFor an infinite horizon MDP, existence of an optimal policy also implies the existence of a stationary optimal policy. Although there is an infinite horizon, we still just need to search finite policies, which equals $|A|^{|S|}$. Moreover, the optimal policy might not be unique.\n\nWe can compute the optimal policy by\n\n$\\pi^*(s)=\\tt argmax\\mit V^\\pi(s)$,\n\nWhich means finding the arguments ($V(s),\\pi(s)$) that produce the biggest value function. \n\nIf an optimal policy exists then its value function must be a fixed point of the operator $B^*$. \n\n#### Bellman optimality backup operator\n\nBellman optimality backup operator is written as $B^*$ with a value function behind it \n\n$B^*V(s)=\\tt max_a \\mit R(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V(s')$. \n\nIf $\\gamma<1$, $B^*$ is a strict contraction and has a unique fixed point. This means \n\n$B^*V(s)\\geq V^\\pi(s)$.\n\nBellman operator return to a new value function and it will improve the value if possible. Sometimes we will use $BV$ to replace Bellman operator and substitute the $V$ on right-hand side of the equation.\n\nNext I'll briefly introduce some algorithms to compute the optimal value function and an optimal policy.\n\n#### Policy search\n\nThis algorithm is very simple but acquires a great number of computing resources. What it do is just trying all the possible policies and find out the biggest value function, return a value function and a policy. \n\n#### Policy iteration\n\nThe algorithm of policy iteration is shown below: \n\n`while` True `do`\n\n​\t$V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)\n\n​\t$\\pi^*$ = Policy improvement $(M,V^\\pi)$\n\n`if` $\\pi^*(s)=\\pi(s)$ `then`\n\n​\t`break`\n\n`else`\n\n​\t$\\pi$ = $\\pi^*$\n\n$V^*$ = $V^\\pi$ . \n\nPolicy evaluation is about how to compute the value of a policy. As for policy improvement, we need to compute\n\n$Q_{\\pi i}(s,a)=R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)V^{\\pi i}(s')$ \n\nfor all the $a$ and $s$ and then take the max\n\n`return` $\\pi_{i+1}=\\tt argmax\\mit Q_{\\pi i}(s,a)$.\n\nNotice that there is a relationship\n\n$\\tt max\\mit Q_{\\pi i}(s,a)\\geq Q_{\\pi i}(s,\\pi_i(s))$.\n\nThis means the agent may adopt the new policy and take better actions (greater) or it just take actions following the former policy (equal). After the improvement the new policy will be monotonically better than the old policy. At the same time, once the policy converge it will never change again.\n\n#### Value iteration\n\nThe algorithm of value iteration is shown below:\n\n$V'(s)=0, V(s)=\\infty$, for all $s\\in S$\n\n`while` $||V-V'||_\\infty>\\epsilon$ `do`\n\n​\t$V=V'$\n\n​\t$V'(s)=\\tt max\\mit_aR(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V'(s)$, for all states $s\\in S$ \n\n$V^*=V$, for all $s\\in S$ \n\n$\\pi^ *=\\tt argmax_{a\\in A}\\mit R(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V^ *(s'),\\ \\forall s\\in S$ . \n\nThe idea is to run fixed point iterations to find the fixed point $V^* $ of $B^ *$.\n\n","source":"_posts/RLSummary2.md","raw":"---\ntitle: Summary of Reinforcement Learning 2\ndate: 2020-1-18 21:06:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- RL\n\t- Research\n\t- Python\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://pic1.zhimg.com/80/v2-e1e894383536e4ff019f63e5507c2a18_hd.png\n\nthumbnail: https://pic1.zhimg.com/80/v2-e1e894383536e4ff019f63e5507c2a18_hd.png\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: Introduction to MP, MRP, and MDP.\n\n#You can begin to input your article below now.\n\n---\n\n### Markov process (MP)\n\nMarkov process is a stochastic process that satisfies the Markov property, which means it is \"memoryless\" and will not be influenced by the history. MP is sometimes called Markov chain. However, their defination have some slight differences. \n\nWe need to make two assumptions before we define the Markov process. The first assumption is that *the state of MP is finite*, and we have $s_i\\in S, i\\in1,2,...$ , where $|S|<\\infty$. The second assumption is that *the transition probabilities are time independent*. Transition probabilities are the probability to transform from the current state to a given state, whcih can be written as $P(s_i|s_{i-1}), \\forall i=1,2,...$.\n\nBase on these two assumption, we can define a *transition transform matrix*:\n\n![](https://astrobear.top/resource/astroblog/content/RLS2F0.png)\n\nThe size of $\\bf P$ is $|S|\\times |S|$ and the sum of each row of $\\bf P$ equals 1.\n\nHenceforth, we can define a Markov process using a tuple $(S,\\bf P)$.\n\n- $S$: A finite state space.\n- $\\bf P$: A transition probability.\n\nBy calculating $S\\bf P$ we can get the distribution of the new state.\n\nFigure 1 shows a student MP example.\n\n![Figure 1](https://pic1.zhimg.com/80/v2-23b6d59cfe253c4a678a1d9e8df43110_hd.png)\n\n### Markov reward process (MRP)\n\nMRP is a MP together with the specification of a reward function $R$ and a discount factor $\\gamma$. We can also use a tuple $(S,\\bf P,\\mit R,\\gamma)$ to describe it.\n\n- $S$: A finite state space.\n- $\\bf P$: A transition probability.\n- $R$: A reward function that maps states to rewards (real numbers).\n- $\\gamma$: Discount factor between 0 and 1.\n\nHere are some explaintions.\n\n#### Reward function\n\nWhen we are moving from the current state $s$ to a *successor state* $s'$, a reward is obtained depending on the current state $s$ (in reality we get the reward at $s'$ ). For a state $s\\in S$, we define the expected reward by\n\n$R(s)=\\Bbb E[r_t|s_t=s]$. \n\nHere we assume that the reward is time independent. $R$ can be represented as a vector of dimension $|S|$.\n\n#### Horizon\n\nIt is defined as the number of time steps in each episode of the process. An *episode* is the whole process of a round of training. The horizon can be finite or infinite.\n\n#### Return\n\nThe return $G_t$ is defined as the discounted sum of rewards starting at time $t$ up to the horizon *H*. We can calculate the return using\n\n$G_t=\\sum^{H-1}_{i=t}\\gamma^{i-t}r_i$.\n\n#### State value function\n\nThe state value function $V_t(s)$ is defined as the expected return starting from state $s$ and time $t$ and is given by the following expression\n\n$V_t(s)=\\Bbb E[G_t|s_t=s]$. \n\nIf the episode is determined, then the $G_t$ as well as $V_t(s)$ will remain unchanged. However, because every episode is a random process, the return and state value function will be different in different episodes.\n\n#### Discount factor\n\nWe design the discount factor for many reasons. The best reason among them I think is that, people always pay more attention to the immediate reward rather than the long-term reward. If we set $\\gamma <1$, the agent will behave like a human more. We should notice that when $\\gamma=0$, we just foucs on the immediate reward. When $\\gamma=1$, we put as much importance on future rewards as compared the present.\n\nFigure 2 and 3 shows an example of how to calculate the return.\n\n![Figure 2](https://astrobear.top/resource/astroblog/content/RLS2F2.png)\n\n![Figure 3](https://pic2.zhimg.com/v2-91921a745909435f7b984d1dae5ef271_r.jpg)\n\nIt is significant to find out a value function while many problems of RL is how to get a value function essentially.\n\n#### Computing the value function\n\nWe have three ways to compute the value function.\n\n- Simulation. Through simulation, we can get the value function by averaing many returns of episodes.\n\n- Analytic solution. We have defined the state value function \n\n  $V_t(s)=\\Bbb E[G_t|s_t=s]$. \n\n  Then, make a little transformation, see Figure 4 in detail. \n\n  ![Figure 4](https://astrobear.top/resource/astroblog/content/RLS2F4.png)\n\n  Then, we have\n\n  $V(s)=R(s)+\\gamma \\sum P(s'|s)V(s')$, \n\n  \n\n  $V=R+\\gamma\\bf P\\mit V$. \n\n  Therefore we have\n\n  $V=(1-\\gamma \\bf P\\rm )\\mit^{-1}R$. \n\n  If $0<\\gamma<1$, then $(1-\\gamma \\bf P\\rm)$ is always invertible. However, the computational cost of the analytical method is $O(|S|^3)$, hence it is only suitable for the cases where the $|S|$ is not very large.\n\n  Notice that $s'$ includes all the possible successor states. Here is an example in Figure 5. This example shows that how to calculate the value of the state represented by the red circle.\n\n  ![Figure 5](https://pic4.zhimg.com/80/v2-a8997be4d72fcb8faaee4db82db495b3_hd.png)\n\n- Iterative solution. \n\n  $V_t(s)=R(s)+\\gamma \\sum P(s'|s)V_{t+1}(s'), \\forall t=0,...,H-1,V_H(s)=0$. \n\n  We can iterate it again and again and use $|V_t-V_{t-1}|<\\epsilon$ ($\\epsilon$ is tolerance) to jduge the convergence of the algorithm. \n\n### Markov decision process (MDP)\n\nMDP is MRP with the specification of a set of actions $A$. We can use a tuple $(S,A,\\bf P,\\mit R,\\gamma)$ to describe it. \n\n- $S$: A finite state space.\n- $A$: A finite set of actions which are available from each state $s$.\n- $\\bf P$: A transition probability.\n- $R$: A reward function that maps states to rewards (real numbers).\n- $\\gamma$: Discount factor between 0 and 1.\n\nHere are some explanations.\n\n#### Notifications\n\n- Both $S$ and $A$ are finite.\n\n- In MDP, the transition probabilities at time $t$ are a function of the successor state $s_{t+1}$ along with both the current state $s_t$ and the action $a_t$, written as\n\n  $P(s_{t+1}|s_t,a_t)$.\n\n- In MDP, the reward $r_t$ at time $t$ depends on both $s_t$ and $a_t$, written as\n\n  $R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.\n\n- Expect for the value functions and what we have mentioned in this section, other notions are exactly the same as MRP.\n\n#### Policy\n\nBefore we mention the state value function, we need to talk about the policy for the MDP first. \n\nA policy specifies what action to take in each state, which is actually a probability distribution over actions given the current state. The policy may be *varying with time*, especially when the horizon is finite. A policy can be written as\n\n$\\pi(a|s)=P(a_t=a|s_t=s)$. \n\nIf given a MDP and a $\\pi$, the process of reward satisfies the following two relationships: \n\n- $P^\\pi(s'|s)=\\sum_{a\\in A}\\pi(a|s) P(s'|s,a)$\n\n  When we have a policy $\\pi$, the probability of the state transforms from $s$ to $s'$ equals to the sum of a series probabilities. These probabilities are the production of the probability to execute a specific action $a$ under the state $s$ and the probability of the state transforms from $s$ to $s'$ when executing an action $a$.\n\n- $R^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)R(s,a)$\n\n  When we have a policy $\\pi$, the reward of the state $s$ is the sum of the product of he probability to execute a specific action $a$ under the state $s$ and all rewards that the action $a$ can get under the state $s$.\n\n#### Value functions in MDP (Bellman expectation equations)\n\nGiven a policy $\\pi$ can define two quantities: *the state value function* and *the state-action value function*. These two value functions are both *Bellman expectation equations*.\n\n- State value function: The state value function $V^\\pi_t(s)$ for a state $s\\in S$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and the following policy $\\pi$, and is given by the expression\n\n  $V^\\pi_t(s)=\\Bbb E_\\pi[G_t|s_t=s]=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$. \n\n  Frequently we will drop the subscript $\\pi$ in the expectation. \n\n- State-action value function: The state-action value function $Q^\\pi_t(s,a)$ for a state $s$ and action $a$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and taking the action $a_t=a$ that has nothing to do with the policy, and then subsequently following the policy $pi$, written in a mathmatical form\n\n  $Q^\\pi_t(s,a)=\\Bbb E[G_t|s_t=s,a_t=a]=\\Bbb E[R_{t+1}+\\gamma Q_\\pi (s_{t+1},a_{t+1})|s_t=s,a_t=a]$. \n\n  It evaluates the value of acting the action $a$ under current state $s$. \n\nNow let's talk about the relationships between these two value functions.\n\nFigure 6 shows the actions that an agent can choose under a specific state, the white circle represents the state while black circles represent actions.\n\n![Figure 6](https://pic1.zhimg.com/80/v2-afda4ee31b7ea7238f7c2bc15709e5a8_hd.png)\n\nWe can discover that the value of a state can be denoted as\n\n$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$.\n\nIn a similar way, Figure 7 shows what states that an action can lead to.\n\n![Figure 7](https://pic4.zhimg.com/80/v2-5f4535af4300fa2228348c233724227b_hd.png)\n\nWe can also find that \n\n$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)V^\\pi(s')$. \n\nOn the right-hand side, the first part is the value of the state $s$, the second part is the sum of the product of the value of new state $s'$ and the probability of getting into that new state. \n\nIf we combine the two Bellman equation with each other, we can get\n\n$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)[R(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V^\\pi(s')]$\n\n​            $=R(s',\\pi(s'))+\\gamma\\sum_{s'\\in S}P(s'|s,\\pi(s)) V^\\pi(s')$, \n\nand\n\n$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)\\sum_{a\\in A}\\pi(a'|s')Q_\\pi(s',a')$. \n\nThe example in Figure 8 shows that how to calculate the state value of the state represented by the red circle. Notice that actions $Study$ and $Pub$ have the same probabilities $\\pi(a|s)$ to be executed, which means they are all $0.5$.\n\n![Figure 8](https://pic1.zhimg.com/80/v2-1ef95dc0d203c5f2e85986faf31464b0_hd.png)\n\n#### Optimality value function (Bellman optimality equation)\n\n- Optimality state value function $V^*(s)=\\tt max\\mit V^\\pi(s)$ indicates a state value function generated by a policy that makes the value of state $s$ the biggest. \n- Optimality state-action value function $Q^*(s,a)=\\tt max\\mit Q_\\pi(s,a)$ indicates a state-action value function generated by a policy that makes the value of the state-action $(s,a)$ the biggest.\n\nOptimality value function determines the best performance of a MDP. When we know the optimality value function, we know the best policy and the best value of every state, and the MDP problem is solved. Solving an optimality value function require us to solve the best policy at first. \n\n### Find the best policy\n\nThe best policy is defined precisely as *optimal policy*  $\\pi^ *$ , which means for every policy $\\pi$, for all time steps, and for all states  $s\\in S$ , there is  $V_t^{\\pi^ *}(s)\\geq V_t^\\pi(s)$.\n\nFor an infinite horizon MDP, existence of an optimal policy also implies the existence of a stationary optimal policy. Although there is an infinite horizon, we still just need to search finite policies, which equals $|A|^{|S|}$. Moreover, the optimal policy might not be unique.\n\nWe can compute the optimal policy by\n\n$\\pi^*(s)=\\tt argmax\\mit V^\\pi(s)$,\n\nWhich means finding the arguments ($V(s),\\pi(s)$) that produce the biggest value function. \n\nIf an optimal policy exists then its value function must be a fixed point of the operator $B^*$. \n\n#### Bellman optimality backup operator\n\nBellman optimality backup operator is written as $B^*$ with a value function behind it \n\n$B^*V(s)=\\tt max_a \\mit R(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V(s')$. \n\nIf $\\gamma<1$, $B^*$ is a strict contraction and has a unique fixed point. This means \n\n$B^*V(s)\\geq V^\\pi(s)$.\n\nBellman operator return to a new value function and it will improve the value if possible. Sometimes we will use $BV$ to replace Bellman operator and substitute the $V$ on right-hand side of the equation.\n\nNext I'll briefly introduce some algorithms to compute the optimal value function and an optimal policy.\n\n#### Policy search\n\nThis algorithm is very simple but acquires a great number of computing resources. What it do is just trying all the possible policies and find out the biggest value function, return a value function and a policy. \n\n#### Policy iteration\n\nThe algorithm of policy iteration is shown below: \n\n`while` True `do`\n\n​\t$V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)\n\n​\t$\\pi^*$ = Policy improvement $(M,V^\\pi)$\n\n`if` $\\pi^*(s)=\\pi(s)$ `then`\n\n​\t`break`\n\n`else`\n\n​\t$\\pi$ = $\\pi^*$\n\n$V^*$ = $V^\\pi$ . \n\nPolicy evaluation is about how to compute the value of a policy. As for policy improvement, we need to compute\n\n$Q_{\\pi i}(s,a)=R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)V^{\\pi i}(s')$ \n\nfor all the $a$ and $s$ and then take the max\n\n`return` $\\pi_{i+1}=\\tt argmax\\mit Q_{\\pi i}(s,a)$.\n\nNotice that there is a relationship\n\n$\\tt max\\mit Q_{\\pi i}(s,a)\\geq Q_{\\pi i}(s,\\pi_i(s))$.\n\nThis means the agent may adopt the new policy and take better actions (greater) or it just take actions following the former policy (equal). After the improvement the new policy will be monotonically better than the old policy. At the same time, once the policy converge it will never change again.\n\n#### Value iteration\n\nThe algorithm of value iteration is shown below:\n\n$V'(s)=0, V(s)=\\infty$, for all $s\\in S$\n\n`while` $||V-V'||_\\infty>\\epsilon$ `do`\n\n​\t$V=V'$\n\n​\t$V'(s)=\\tt max\\mit_aR(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V'(s)$, for all states $s\\in S$ \n\n$V^*=V$, for all $s\\in S$ \n\n$\\pi^ *=\\tt argmax_{a\\in A}\\mit R(s,a)+\\gamma\\sum_{s'\\in S}P(s'|s,a)V^ *(s'),\\ \\forall s\\in S$ . \n\nThe idea is to run fixed point iterations to find the fixed point $V^* $ of $B^ *$.\n\n","slug":"RLSummary2","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzw000j1q39hyq2hhzs","content":"<h3 id=\"Markov-process-MP\"><a href=\"#Markov-process-MP\" class=\"headerlink\" title=\"Markov process (MP)\"></a>Markov process (MP)</h3><p>Markov process is a stochastic process that satisfies the Markov property, which means it is “memoryless” and will not be influenced by the history. MP is sometimes called Markov chain. However, their defination have some slight differences. </p>\n<p>We need to make two assumptions before we define the Markov process. The first assumption is that <em>the state of MP is finite</em>, and we have $s_i\\in S, i\\in1,2,…$ , where $|S|&lt;\\infty$. The second assumption is that <em>the transition probabilities are time independent</em>. Transition probabilities are the probability to transform from the current state to a given state, whcih can be written as $P(s_i|s_{i-1}), \\forall i=1,2,…$.</p>\n<p>Base on these two assumption, we can define a <em>transition transform matrix</em>:</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS2F0.png\" alt=\"\"></p>\n<p>The size of $\\bf P$ is $|S|\\times |S|$ and the sum of each row of $\\bf P$ equals 1.</p>\n<p>Henceforth, we can define a Markov process using a tuple $(S,\\bf P)$.</p>\n<ul>\n<li>$S$: A finite state space.</li>\n<li>$\\bf P$: A transition probability.</li>\n</ul>\n<p>By calculating $S\\bf P$ we can get the distribution of the new state.</p>\n<p>Figure 1 shows a student MP example.</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-23b6d59cfe253c4a678a1d9e8df43110_hd.png\" alt=\"Figure 1\"></p>\n<h3 id=\"Markov-reward-process-MRP\"><a href=\"#Markov-reward-process-MRP\" class=\"headerlink\" title=\"Markov reward process (MRP)\"></a>Markov reward process (MRP)</h3><p>MRP is a MP together with the specification of a reward function $R$ and a discount factor $\\gamma$. We can also use a tuple $(S,\\bf P,\\mit R,\\gamma)$ to describe it.</p>\n<ul>\n<li>$S$: A finite state space.</li>\n<li>$\\bf P$: A transition probability.</li>\n<li>$R$: A reward function that maps states to rewards (real numbers).</li>\n<li>$\\gamma$: Discount factor between 0 and 1.</li>\n</ul>\n<p>Here are some explaintions.</p>\n<h4 id=\"Reward-function\"><a href=\"#Reward-function\" class=\"headerlink\" title=\"Reward function\"></a>Reward function</h4><p>When we are moving from the current state $s$ to a <em>successor state</em> $s’$, a reward is obtained depending on the current state $s$ (in reality we get the reward at $s’$ ). For a state $s\\in S$, we define the expected reward by</p>\n<p>$R(s)=\\Bbb E[r_t|s_t=s]$. </p>\n<p>Here we assume that the reward is time independent. $R$ can be represented as a vector of dimension $|S|$.</p>\n<h4 id=\"Horizon\"><a href=\"#Horizon\" class=\"headerlink\" title=\"Horizon\"></a>Horizon</h4><p>It is defined as the number of time steps in each episode of the process. An <em>episode</em> is the whole process of a round of training. The horizon can be finite or infinite.</p>\n<h4 id=\"Return\"><a href=\"#Return\" class=\"headerlink\" title=\"Return\"></a>Return</h4><p>The return $G_t$ is defined as the discounted sum of rewards starting at time $t$ up to the horizon <em>H</em>. We can calculate the return using</p>\n<p>$G_t=\\sum^{H-1}_{i=t}\\gamma^{i-t}r_i$.</p>\n<h4 id=\"State-value-function\"><a href=\"#State-value-function\" class=\"headerlink\" title=\"State value function\"></a>State value function</h4><p>The state value function $V_t(s)$ is defined as the expected return starting from state $s$ and time $t$ and is given by the following expression</p>\n<p>$V_t(s)=\\Bbb E[G_t|s_t=s]$. </p>\n<p>If the episode is determined, then the $G_t$ as well as $V_t(s)$ will remain unchanged. However, because every episode is a random process, the return and state value function will be different in different episodes.</p>\n<h4 id=\"Discount-factor\"><a href=\"#Discount-factor\" class=\"headerlink\" title=\"Discount factor\"></a>Discount factor</h4><p>We design the discount factor for many reasons. The best reason among them I think is that, people always pay more attention to the immediate reward rather than the long-term reward. If we set $\\gamma &lt;1$, the agent will behave like a human more. We should notice that when $\\gamma=0$, we just foucs on the immediate reward. When $\\gamma=1$, we put as much importance on future rewards as compared the present.</p>\n<p>Figure 2 and 3 shows an example of how to calculate the return.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS2F2.png\" alt=\"Figure 2\"></p>\n<p><img src=\"https://pic2.zhimg.com/v2-91921a745909435f7b984d1dae5ef271_r.jpg\" alt=\"Figure 3\"></p>\n<p>It is significant to find out a value function while many problems of RL is how to get a value function essentially.</p>\n<h4 id=\"Computing-the-value-function\"><a href=\"#Computing-the-value-function\" class=\"headerlink\" title=\"Computing the value function\"></a>Computing the value function</h4><p>We have three ways to compute the value function.</p>\n<ul>\n<li><p>Simulation. Through simulation, we can get the value function by averaing many returns of episodes.</p>\n</li>\n<li><p>Analytic solution. We have defined the state value function </p>\n<p>$V_t(s)=\\Bbb E[G_t|s_t=s]$. </p>\n<p>Then, make a little transformation, see Figure 4 in detail. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS2F4.png\" alt=\"Figure 4\"></p>\n<p>Then, we have</p>\n<p>$V(s)=R(s)+\\gamma \\sum P(s’|s)V(s’)$, </p>\n</li>\n</ul>\n<p>  $V=R+\\gamma\\bf P\\mit V$. </p>\n<p>  Therefore we have</p>\n<p>  $V=(1-\\gamma \\bf P\\rm )\\mit^{-1}R$. </p>\n<p>  If $0&lt;\\gamma&lt;1$, then $(1-\\gamma \\bf P\\rm)$ is always invertible. However, the computational cost of the analytical method is $O(|S|^3)$, hence it is only suitable for the cases where the $|S|$ is not very large.</p>\n<p>  Notice that $s’$ includes all the possible successor states. Here is an example in Figure 5. This example shows that how to calculate the value of the state represented by the red circle.</p>\n<p>  <img src=\"https://pic4.zhimg.com/80/v2-a8997be4d72fcb8faaee4db82db495b3_hd.png\" alt=\"Figure 5\"></p>\n<ul>\n<li><p>Iterative solution. </p>\n<p>$V_t(s)=R(s)+\\gamma \\sum P(s’|s)V_{t+1}(s’), \\forall t=0,…,H-1,V_H(s)=0$. </p>\n<p>We can iterate it again and again and use $|V_t-V_{t-1}|&lt;\\epsilon$ ($\\epsilon$ is tolerance) to jduge the convergence of the algorithm. </p>\n</li>\n</ul>\n<h3 id=\"Markov-decision-process-MDP\"><a href=\"#Markov-decision-process-MDP\" class=\"headerlink\" title=\"Markov decision process (MDP)\"></a>Markov decision process (MDP)</h3><p>MDP is MRP with the specification of a set of actions $A$. We can use a tuple $(S,A,\\bf P,\\mit R,\\gamma)$ to describe it. </p>\n<ul>\n<li>$S$: A finite state space.</li>\n<li>$A$: A finite set of actions which are available from each state $s$.</li>\n<li>$\\bf P$: A transition probability.</li>\n<li>$R$: A reward function that maps states to rewards (real numbers).</li>\n<li>$\\gamma$: Discount factor between 0 and 1.</li>\n</ul>\n<p>Here are some explanations.</p>\n<h4 id=\"Notifications\"><a href=\"#Notifications\" class=\"headerlink\" title=\"Notifications\"></a>Notifications</h4><ul>\n<li><p>Both $S$ and $A$ are finite.</p>\n</li>\n<li><p>In MDP, the transition probabilities at time $t$ are a function of the successor state $s_{t+1}$ along with both the current state $s_t$ and the action $a_t$, written as</p>\n<p>$P(s_{t+1}|s_t,a_t)$.</p>\n</li>\n<li><p>In MDP, the reward $r_t$ at time $t$ depends on both $s_t$ and $a_t$, written as</p>\n<p>$R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.</p>\n</li>\n<li><p>Expect for the value functions and what we have mentioned in this section, other notions are exactly the same as MRP.</p>\n</li>\n</ul>\n<h4 id=\"Policy\"><a href=\"#Policy\" class=\"headerlink\" title=\"Policy\"></a>Policy</h4><p>Before we mention the state value function, we need to talk about the policy for the MDP first. </p>\n<p>A policy specifies what action to take in each state, which is actually a probability distribution over actions given the current state. The policy may be <em>varying with time</em>, especially when the horizon is finite. A policy can be written as</p>\n<p>$\\pi(a|s)=P(a_t=a|s_t=s)$. </p>\n<p>If given a MDP and a $\\pi$, the process of reward satisfies the following two relationships: </p>\n<ul>\n<li><p>$P^\\pi(s’|s)=\\sum_{a\\in A}\\pi(a|s) P(s’|s,a)$</p>\n<p>When we have a policy $\\pi$, the probability of the state transforms from $s$ to $s’$ equals to the sum of a series probabilities. These probabilities are the production of the probability to execute a specific action $a$ under the state $s$ and the probability of the state transforms from $s$ to $s’$ when executing an action $a$.</p>\n</li>\n<li><p>$R^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)R(s,a)$</p>\n<p>When we have a policy $\\pi$, the reward of the state $s$ is the sum of the product of he probability to execute a specific action $a$ under the state $s$ and all rewards that the action $a$ can get under the state $s$.</p>\n</li>\n</ul>\n<h4 id=\"Value-functions-in-MDP-Bellman-expectation-equations\"><a href=\"#Value-functions-in-MDP-Bellman-expectation-equations\" class=\"headerlink\" title=\"Value functions in MDP (Bellman expectation equations)\"></a>Value functions in MDP (Bellman expectation equations)</h4><p>Given a policy $\\pi$ can define two quantities: <em>the state value function</em> and <em>the state-action value function</em>. These two value functions are both <em>Bellman expectation equations</em>.</p>\n<ul>\n<li><p>State value function: The state value function $V^\\pi_t(s)$ for a state $s\\in S$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and the following policy $\\pi$, and is given by the expression</p>\n<p>$V^\\pi_t(s)=\\Bbb E_\\pi[G_t|s_t=s]=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$. </p>\n<p>Frequently we will drop the subscript $\\pi$ in the expectation. </p>\n</li>\n<li><p>State-action value function: The state-action value function $Q^\\pi_t(s,a)$ for a state $s$ and action $a$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and taking the action $a_t=a$ that has nothing to do with the policy, and then subsequently following the policy $pi$, written in a mathmatical form</p>\n<p>$Q^\\pi_t(s,a)=\\Bbb E[G_t|s_t=s,a_t=a]=\\Bbb E[R_{t+1}+\\gamma Q_\\pi (s_{t+1},a_{t+1})|s_t=s,a_t=a]$. </p>\n<p>It evaluates the value of acting the action $a$ under current state $s$. </p>\n</li>\n</ul>\n<p>Now let’s talk about the relationships between these two value functions.</p>\n<p>Figure 6 shows the actions that an agent can choose under a specific state, the white circle represents the state while black circles represent actions.</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-afda4ee31b7ea7238f7c2bc15709e5a8_hd.png\" alt=\"Figure 6\"></p>\n<p>We can discover that the value of a state can be denoted as</p>\n<p>$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$.</p>\n<p>In a similar way, Figure 7 shows what states that an action can lead to.</p>\n<p><img src=\"https://pic4.zhimg.com/80/v2-5f4535af4300fa2228348c233724227b_hd.png\" alt=\"Figure 7\"></p>\n<p>We can also find that </p>\n<p>$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)V^\\pi(s’)$. </p>\n<p>On the right-hand side, the first part is the value of the state $s$, the second part is the sum of the product of the value of new state $s’$ and the probability of getting into that new state. </p>\n<p>If we combine the two Bellman equation with each other, we can get</p>\n<p>$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)[R(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V^\\pi(s’)]$</p>\n<p>​            $=R(s’,\\pi(s’))+\\gamma\\sum_{s’\\in S}P(s’|s,\\pi(s)) V^\\pi(s’)$, </p>\n<p>and</p>\n<p>$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)\\sum_{a\\in A}\\pi(a’|s’)Q_\\pi(s’,a’)$. </p>\n<p>The example in Figure 8 shows that how to calculate the state value of the state represented by the red circle. Notice that actions $Study$ and $Pub$ have the same probabilities $\\pi(a|s)$ to be executed, which means they are all $0.5$.</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-1ef95dc0d203c5f2e85986faf31464b0_hd.png\" alt=\"Figure 8\"></p>\n<h4 id=\"Optimality-value-function-Bellman-optimality-equation\"><a href=\"#Optimality-value-function-Bellman-optimality-equation\" class=\"headerlink\" title=\"Optimality value function (Bellman optimality equation)\"></a>Optimality value function (Bellman optimality equation)</h4><ul>\n<li>Optimality state value function $V^*(s)=\\tt max\\mit V^\\pi(s)$ indicates a state value function generated by a policy that makes the value of state $s$ the biggest. </li>\n<li>Optimality state-action value function $Q^*(s,a)=\\tt max\\mit Q_\\pi(s,a)$ indicates a state-action value function generated by a policy that makes the value of the state-action $(s,a)$ the biggest.</li>\n</ul>\n<p>Optimality value function determines the best performance of a MDP. When we know the optimality value function, we know the best policy and the best value of every state, and the MDP problem is solved. Solving an optimality value function require us to solve the best policy at first. </p>\n<h3 id=\"Find-the-best-policy\"><a href=\"#Find-the-best-policy\" class=\"headerlink\" title=\"Find the best policy\"></a>Find the best policy</h3><p>The best policy is defined precisely as <em>optimal policy</em>  $\\pi^ *$ , which means for every policy $\\pi$, for all time steps, and for all states  $s\\in S$ , there is  $V_t^{\\pi^ *}(s)\\geq V_t^\\pi(s)$.</p>\n<p>For an infinite horizon MDP, existence of an optimal policy also implies the existence of a stationary optimal policy. Although there is an infinite horizon, we still just need to search finite policies, which equals $|A|^{|S|}$. Moreover, the optimal policy might not be unique.</p>\n<p>We can compute the optimal policy by</p>\n<p>$\\pi^*(s)=\\tt argmax\\mit V^\\pi(s)$,</p>\n<p>Which means finding the arguments ($V(s),\\pi(s)$) that produce the biggest value function. </p>\n<p>If an optimal policy exists then its value function must be a fixed point of the operator $B^*$. </p>\n<h4 id=\"Bellman-optimality-backup-operator\"><a href=\"#Bellman-optimality-backup-operator\" class=\"headerlink\" title=\"Bellman optimality backup operator\"></a>Bellman optimality backup operator</h4><p>Bellman optimality backup operator is written as $B^*$ with a value function behind it </p>\n<p>$B^*V(s)=\\tt max_a \\mit R(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V(s’)$. </p>\n<p>If $\\gamma&lt;1$, $B^*$ is a strict contraction and has a unique fixed point. This means </p>\n<p>$B^*V(s)\\geq V^\\pi(s)$.</p>\n<p>Bellman operator return to a new value function and it will improve the value if possible. Sometimes we will use $BV$ to replace Bellman operator and substitute the $V$ on right-hand side of the equation.</p>\n<p>Next I’ll briefly introduce some algorithms to compute the optimal value function and an optimal policy.</p>\n<h4 id=\"Policy-search\"><a href=\"#Policy-search\" class=\"headerlink\" title=\"Policy search\"></a>Policy search</h4><p>This algorithm is very simple but acquires a great number of computing resources. What it do is just trying all the possible policies and find out the biggest value function, return a value function and a policy. </p>\n<h4 id=\"Policy-iteration\"><a href=\"#Policy-iteration\" class=\"headerlink\" title=\"Policy iteration\"></a>Policy iteration</h4><p>The algorithm of policy iteration is shown below: </p>\n<p><code>while</code> True <code>do</code></p>\n<p>​    $V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)</p>\n<p>​    $\\pi^*$ = Policy improvement $(M,V^\\pi)$</p>\n<p><code>if</code> $\\pi^*(s)=\\pi(s)$ <code>then</code></p>\n<p>​    <code>break</code></p>\n<p><code>else</code></p>\n<p>​    $\\pi$ = $\\pi^*$</p>\n<p>$V^*$ = $V^\\pi$ . </p>\n<p>Policy evaluation is about how to compute the value of a policy. As for policy improvement, we need to compute</p>\n<p>$Q_{\\pi i}(s,a)=R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)V^{\\pi i}(s’)$ </p>\n<p>for all the $a$ and $s$ and then take the max</p>\n<p><code>return</code> $\\pi_{i+1}=\\tt argmax\\mit Q_{\\pi i}(s,a)$.</p>\n<p>Notice that there is a relationship</p>\n<p>$\\tt max\\mit Q_{\\pi i}(s,a)\\geq Q_{\\pi i}(s,\\pi_i(s))$.</p>\n<p>This means the agent may adopt the new policy and take better actions (greater) or it just take actions following the former policy (equal). After the improvement the new policy will be monotonically better than the old policy. At the same time, once the policy converge it will never change again.</p>\n<h4 id=\"Value-iteration\"><a href=\"#Value-iteration\" class=\"headerlink\" title=\"Value iteration\"></a>Value iteration</h4><p>The algorithm of value iteration is shown below:</p>\n<p>$V’(s)=0, V(s)=\\infty$, for all $s\\in S$</p>\n<p><code>while</code> $||V-V’||_\\infty&gt;\\epsilon$ <code>do</code></p>\n<p>​    $V=V’$</p>\n<p>​    $V’(s)=\\tt max\\mit_aR(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V’(s)$, for all states $s\\in S$ </p>\n<p>$V^*=V$, for all $s\\in S$ </p>\n<p>$\\pi^ *=\\tt argmax_{a\\in A}\\mit R(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V^ *(s’),\\ \\forall s\\in S$ . </p>\n<p>The idea is to run fixed point iterations to find the fixed point $V^* $ of $B^ *$.</p>\n","site":{"data":{}},"more":"<h3 id=\"Markov-process-MP\"><a href=\"#Markov-process-MP\" class=\"headerlink\" title=\"Markov process (MP)\"></a>Markov process (MP)</h3><p>Markov process is a stochastic process that satisfies the Markov property, which means it is “memoryless” and will not be influenced by the history. MP is sometimes called Markov chain. However, their defination have some slight differences. </p>\n<p>We need to make two assumptions before we define the Markov process. The first assumption is that <em>the state of MP is finite</em>, and we have $s_i\\in S, i\\in1,2,…$ , where $|S|&lt;\\infty$. The second assumption is that <em>the transition probabilities are time independent</em>. Transition probabilities are the probability to transform from the current state to a given state, whcih can be written as $P(s_i|s_{i-1}), \\forall i=1,2,…$.</p>\n<p>Base on these two assumption, we can define a <em>transition transform matrix</em>:</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS2F0.png\" alt=\"\"></p>\n<p>The size of $\\bf P$ is $|S|\\times |S|$ and the sum of each row of $\\bf P$ equals 1.</p>\n<p>Henceforth, we can define a Markov process using a tuple $(S,\\bf P)$.</p>\n<ul>\n<li>$S$: A finite state space.</li>\n<li>$\\bf P$: A transition probability.</li>\n</ul>\n<p>By calculating $S\\bf P$ we can get the distribution of the new state.</p>\n<p>Figure 1 shows a student MP example.</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-23b6d59cfe253c4a678a1d9e8df43110_hd.png\" alt=\"Figure 1\"></p>\n<h3 id=\"Markov-reward-process-MRP\"><a href=\"#Markov-reward-process-MRP\" class=\"headerlink\" title=\"Markov reward process (MRP)\"></a>Markov reward process (MRP)</h3><p>MRP is a MP together with the specification of a reward function $R$ and a discount factor $\\gamma$. We can also use a tuple $(S,\\bf P,\\mit R,\\gamma)$ to describe it.</p>\n<ul>\n<li>$S$: A finite state space.</li>\n<li>$\\bf P$: A transition probability.</li>\n<li>$R$: A reward function that maps states to rewards (real numbers).</li>\n<li>$\\gamma$: Discount factor between 0 and 1.</li>\n</ul>\n<p>Here are some explaintions.</p>\n<h4 id=\"Reward-function\"><a href=\"#Reward-function\" class=\"headerlink\" title=\"Reward function\"></a>Reward function</h4><p>When we are moving from the current state $s$ to a <em>successor state</em> $s’$, a reward is obtained depending on the current state $s$ (in reality we get the reward at $s’$ ). For a state $s\\in S$, we define the expected reward by</p>\n<p>$R(s)=\\Bbb E[r_t|s_t=s]$. </p>\n<p>Here we assume that the reward is time independent. $R$ can be represented as a vector of dimension $|S|$.</p>\n<h4 id=\"Horizon\"><a href=\"#Horizon\" class=\"headerlink\" title=\"Horizon\"></a>Horizon</h4><p>It is defined as the number of time steps in each episode of the process. An <em>episode</em> is the whole process of a round of training. The horizon can be finite or infinite.</p>\n<h4 id=\"Return\"><a href=\"#Return\" class=\"headerlink\" title=\"Return\"></a>Return</h4><p>The return $G_t$ is defined as the discounted sum of rewards starting at time $t$ up to the horizon <em>H</em>. We can calculate the return using</p>\n<p>$G_t=\\sum^{H-1}_{i=t}\\gamma^{i-t}r_i$.</p>\n<h4 id=\"State-value-function\"><a href=\"#State-value-function\" class=\"headerlink\" title=\"State value function\"></a>State value function</h4><p>The state value function $V_t(s)$ is defined as the expected return starting from state $s$ and time $t$ and is given by the following expression</p>\n<p>$V_t(s)=\\Bbb E[G_t|s_t=s]$. </p>\n<p>If the episode is determined, then the $G_t$ as well as $V_t(s)$ will remain unchanged. However, because every episode is a random process, the return and state value function will be different in different episodes.</p>\n<h4 id=\"Discount-factor\"><a href=\"#Discount-factor\" class=\"headerlink\" title=\"Discount factor\"></a>Discount factor</h4><p>We design the discount factor for many reasons. The best reason among them I think is that, people always pay more attention to the immediate reward rather than the long-term reward. If we set $\\gamma &lt;1$, the agent will behave like a human more. We should notice that when $\\gamma=0$, we just foucs on the immediate reward. When $\\gamma=1$, we put as much importance on future rewards as compared the present.</p>\n<p>Figure 2 and 3 shows an example of how to calculate the return.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS2F2.png\" alt=\"Figure 2\"></p>\n<p><img src=\"https://pic2.zhimg.com/v2-91921a745909435f7b984d1dae5ef271_r.jpg\" alt=\"Figure 3\"></p>\n<p>It is significant to find out a value function while many problems of RL is how to get a value function essentially.</p>\n<h4 id=\"Computing-the-value-function\"><a href=\"#Computing-the-value-function\" class=\"headerlink\" title=\"Computing the value function\"></a>Computing the value function</h4><p>We have three ways to compute the value function.</p>\n<ul>\n<li><p>Simulation. Through simulation, we can get the value function by averaing many returns of episodes.</p>\n</li>\n<li><p>Analytic solution. We have defined the state value function </p>\n<p>$V_t(s)=\\Bbb E[G_t|s_t=s]$. </p>\n<p>Then, make a little transformation, see Figure 4 in detail. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS2F4.png\" alt=\"Figure 4\"></p>\n<p>Then, we have</p>\n<p>$V(s)=R(s)+\\gamma \\sum P(s’|s)V(s’)$, </p>\n</li>\n</ul>\n<p>  $V=R+\\gamma\\bf P\\mit V$. </p>\n<p>  Therefore we have</p>\n<p>  $V=(1-\\gamma \\bf P\\rm )\\mit^{-1}R$. </p>\n<p>  If $0&lt;\\gamma&lt;1$, then $(1-\\gamma \\bf P\\rm)$ is always invertible. However, the computational cost of the analytical method is $O(|S|^3)$, hence it is only suitable for the cases where the $|S|$ is not very large.</p>\n<p>  Notice that $s’$ includes all the possible successor states. Here is an example in Figure 5. This example shows that how to calculate the value of the state represented by the red circle.</p>\n<p>  <img src=\"https://pic4.zhimg.com/80/v2-a8997be4d72fcb8faaee4db82db495b3_hd.png\" alt=\"Figure 5\"></p>\n<ul>\n<li><p>Iterative solution. </p>\n<p>$V_t(s)=R(s)+\\gamma \\sum P(s’|s)V_{t+1}(s’), \\forall t=0,…,H-1,V_H(s)=0$. </p>\n<p>We can iterate it again and again and use $|V_t-V_{t-1}|&lt;\\epsilon$ ($\\epsilon$ is tolerance) to jduge the convergence of the algorithm. </p>\n</li>\n</ul>\n<h3 id=\"Markov-decision-process-MDP\"><a href=\"#Markov-decision-process-MDP\" class=\"headerlink\" title=\"Markov decision process (MDP)\"></a>Markov decision process (MDP)</h3><p>MDP is MRP with the specification of a set of actions $A$. We can use a tuple $(S,A,\\bf P,\\mit R,\\gamma)$ to describe it. </p>\n<ul>\n<li>$S$: A finite state space.</li>\n<li>$A$: A finite set of actions which are available from each state $s$.</li>\n<li>$\\bf P$: A transition probability.</li>\n<li>$R$: A reward function that maps states to rewards (real numbers).</li>\n<li>$\\gamma$: Discount factor between 0 and 1.</li>\n</ul>\n<p>Here are some explanations.</p>\n<h4 id=\"Notifications\"><a href=\"#Notifications\" class=\"headerlink\" title=\"Notifications\"></a>Notifications</h4><ul>\n<li><p>Both $S$ and $A$ are finite.</p>\n</li>\n<li><p>In MDP, the transition probabilities at time $t$ are a function of the successor state $s_{t+1}$ along with both the current state $s_t$ and the action $a_t$, written as</p>\n<p>$P(s_{t+1}|s_t,a_t)$.</p>\n</li>\n<li><p>In MDP, the reward $r_t$ at time $t$ depends on both $s_t$ and $a_t$, written as</p>\n<p>$R(s,a)=\\Bbb E[r_t|s_t=s,a_t=a]$.</p>\n</li>\n<li><p>Expect for the value functions and what we have mentioned in this section, other notions are exactly the same as MRP.</p>\n</li>\n</ul>\n<h4 id=\"Policy\"><a href=\"#Policy\" class=\"headerlink\" title=\"Policy\"></a>Policy</h4><p>Before we mention the state value function, we need to talk about the policy for the MDP first. </p>\n<p>A policy specifies what action to take in each state, which is actually a probability distribution over actions given the current state. The policy may be <em>varying with time</em>, especially when the horizon is finite. A policy can be written as</p>\n<p>$\\pi(a|s)=P(a_t=a|s_t=s)$. </p>\n<p>If given a MDP and a $\\pi$, the process of reward satisfies the following two relationships: </p>\n<ul>\n<li><p>$P^\\pi(s’|s)=\\sum_{a\\in A}\\pi(a|s) P(s’|s,a)$</p>\n<p>When we have a policy $\\pi$, the probability of the state transforms from $s$ to $s’$ equals to the sum of a series probabilities. These probabilities are the production of the probability to execute a specific action $a$ under the state $s$ and the probability of the state transforms from $s$ to $s’$ when executing an action $a$.</p>\n</li>\n<li><p>$R^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)R(s,a)$</p>\n<p>When we have a policy $\\pi$, the reward of the state $s$ is the sum of the product of he probability to execute a specific action $a$ under the state $s$ and all rewards that the action $a$ can get under the state $s$.</p>\n</li>\n</ul>\n<h4 id=\"Value-functions-in-MDP-Bellman-expectation-equations\"><a href=\"#Value-functions-in-MDP-Bellman-expectation-equations\" class=\"headerlink\" title=\"Value functions in MDP (Bellman expectation equations)\"></a>Value functions in MDP (Bellman expectation equations)</h4><p>Given a policy $\\pi$ can define two quantities: <em>the state value function</em> and <em>the state-action value function</em>. These two value functions are both <em>Bellman expectation equations</em>.</p>\n<ul>\n<li><p>State value function: The state value function $V^\\pi_t(s)$ for a state $s\\in S$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and the following policy $\\pi$, and is given by the expression</p>\n<p>$V^\\pi_t(s)=\\Bbb E_\\pi[G_t|s_t=s]=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$. </p>\n<p>Frequently we will drop the subscript $\\pi$ in the expectation. </p>\n</li>\n<li><p>State-action value function: The state-action value function $Q^\\pi_t(s,a)$ for a state $s$ and action $a$ is defined as the expected return starting from the state $s_t=s$ at time $t$ and taking the action $a_t=a$ that has nothing to do with the policy, and then subsequently following the policy $pi$, written in a mathmatical form</p>\n<p>$Q^\\pi_t(s,a)=\\Bbb E[G_t|s_t=s,a_t=a]=\\Bbb E[R_{t+1}+\\gamma Q_\\pi (s_{t+1},a_{t+1})|s_t=s,a_t=a]$. </p>\n<p>It evaluates the value of acting the action $a$ under current state $s$. </p>\n</li>\n</ul>\n<p>Now let’s talk about the relationships between these two value functions.</p>\n<p>Figure 6 shows the actions that an agent can choose under a specific state, the white circle represents the state while black circles represent actions.</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-afda4ee31b7ea7238f7c2bc15709e5a8_hd.png\" alt=\"Figure 6\"></p>\n<p>We can discover that the value of a state can be denoted as</p>\n<p>$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$.</p>\n<p>In a similar way, Figure 7 shows what states that an action can lead to.</p>\n<p><img src=\"https://pic4.zhimg.com/80/v2-5f4535af4300fa2228348c233724227b_hd.png\" alt=\"Figure 7\"></p>\n<p>We can also find that </p>\n<p>$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)V^\\pi(s’)$. </p>\n<p>On the right-hand side, the first part is the value of the state $s$, the second part is the sum of the product of the value of new state $s’$ and the probability of getting into that new state. </p>\n<p>If we combine the two Bellman equation with each other, we can get</p>\n<p>$V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)[R(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V^\\pi(s’)]$</p>\n<p>​            $=R(s’,\\pi(s’))+\\gamma\\sum_{s’\\in S}P(s’|s,\\pi(s)) V^\\pi(s’)$, </p>\n<p>and</p>\n<p>$Q_\\pi(s,a)=R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)\\sum_{a\\in A}\\pi(a’|s’)Q_\\pi(s’,a’)$. </p>\n<p>The example in Figure 8 shows that how to calculate the state value of the state represented by the red circle. Notice that actions $Study$ and $Pub$ have the same probabilities $\\pi(a|s)$ to be executed, which means they are all $0.5$.</p>\n<p><img src=\"https://pic1.zhimg.com/80/v2-1ef95dc0d203c5f2e85986faf31464b0_hd.png\" alt=\"Figure 8\"></p>\n<h4 id=\"Optimality-value-function-Bellman-optimality-equation\"><a href=\"#Optimality-value-function-Bellman-optimality-equation\" class=\"headerlink\" title=\"Optimality value function (Bellman optimality equation)\"></a>Optimality value function (Bellman optimality equation)</h4><ul>\n<li>Optimality state value function $V^*(s)=\\tt max\\mit V^\\pi(s)$ indicates a state value function generated by a policy that makes the value of state $s$ the biggest. </li>\n<li>Optimality state-action value function $Q^*(s,a)=\\tt max\\mit Q_\\pi(s,a)$ indicates a state-action value function generated by a policy that makes the value of the state-action $(s,a)$ the biggest.</li>\n</ul>\n<p>Optimality value function determines the best performance of a MDP. When we know the optimality value function, we know the best policy and the best value of every state, and the MDP problem is solved. Solving an optimality value function require us to solve the best policy at first. </p>\n<h3 id=\"Find-the-best-policy\"><a href=\"#Find-the-best-policy\" class=\"headerlink\" title=\"Find the best policy\"></a>Find the best policy</h3><p>The best policy is defined precisely as <em>optimal policy</em>  $\\pi^ *$ , which means for every policy $\\pi$, for all time steps, and for all states  $s\\in S$ , there is  $V_t^{\\pi^ *}(s)\\geq V_t^\\pi(s)$.</p>\n<p>For an infinite horizon MDP, existence of an optimal policy also implies the existence of a stationary optimal policy. Although there is an infinite horizon, we still just need to search finite policies, which equals $|A|^{|S|}$. Moreover, the optimal policy might not be unique.</p>\n<p>We can compute the optimal policy by</p>\n<p>$\\pi^*(s)=\\tt argmax\\mit V^\\pi(s)$,</p>\n<p>Which means finding the arguments ($V(s),\\pi(s)$) that produce the biggest value function. </p>\n<p>If an optimal policy exists then its value function must be a fixed point of the operator $B^*$. </p>\n<h4 id=\"Bellman-optimality-backup-operator\"><a href=\"#Bellman-optimality-backup-operator\" class=\"headerlink\" title=\"Bellman optimality backup operator\"></a>Bellman optimality backup operator</h4><p>Bellman optimality backup operator is written as $B^*$ with a value function behind it </p>\n<p>$B^*V(s)=\\tt max_a \\mit R(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V(s’)$. </p>\n<p>If $\\gamma&lt;1$, $B^*$ is a strict contraction and has a unique fixed point. This means </p>\n<p>$B^*V(s)\\geq V^\\pi(s)$.</p>\n<p>Bellman operator return to a new value function and it will improve the value if possible. Sometimes we will use $BV$ to replace Bellman operator and substitute the $V$ on right-hand side of the equation.</p>\n<p>Next I’ll briefly introduce some algorithms to compute the optimal value function and an optimal policy.</p>\n<h4 id=\"Policy-search\"><a href=\"#Policy-search\" class=\"headerlink\" title=\"Policy search\"></a>Policy search</h4><p>This algorithm is very simple but acquires a great number of computing resources. What it do is just trying all the possible policies and find out the biggest value function, return a value function and a policy. </p>\n<h4 id=\"Policy-iteration\"><a href=\"#Policy-iteration\" class=\"headerlink\" title=\"Policy iteration\"></a>Policy iteration</h4><p>The algorithm of policy iteration is shown below: </p>\n<p><code>while</code> True <code>do</code></p>\n<p>​    $V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)</p>\n<p>​    $\\pi^*$ = Policy improvement $(M,V^\\pi)$</p>\n<p><code>if</code> $\\pi^*(s)=\\pi(s)$ <code>then</code></p>\n<p>​    <code>break</code></p>\n<p><code>else</code></p>\n<p>​    $\\pi$ = $\\pi^*$</p>\n<p>$V^*$ = $V^\\pi$ . </p>\n<p>Policy evaluation is about how to compute the value of a policy. As for policy improvement, we need to compute</p>\n<p>$Q_{\\pi i}(s,a)=R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)V^{\\pi i}(s’)$ </p>\n<p>for all the $a$ and $s$ and then take the max</p>\n<p><code>return</code> $\\pi_{i+1}=\\tt argmax\\mit Q_{\\pi i}(s,a)$.</p>\n<p>Notice that there is a relationship</p>\n<p>$\\tt max\\mit Q_{\\pi i}(s,a)\\geq Q_{\\pi i}(s,\\pi_i(s))$.</p>\n<p>This means the agent may adopt the new policy and take better actions (greater) or it just take actions following the former policy (equal). After the improvement the new policy will be monotonically better than the old policy. At the same time, once the policy converge it will never change again.</p>\n<h4 id=\"Value-iteration\"><a href=\"#Value-iteration\" class=\"headerlink\" title=\"Value iteration\"></a>Value iteration</h4><p>The algorithm of value iteration is shown below:</p>\n<p>$V’(s)=0, V(s)=\\infty$, for all $s\\in S$</p>\n<p><code>while</code> $||V-V’||_\\infty&gt;\\epsilon$ <code>do</code></p>\n<p>​    $V=V’$</p>\n<p>​    $V’(s)=\\tt max\\mit_aR(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V’(s)$, for all states $s\\in S$ </p>\n<p>$V^*=V$, for all $s\\in S$ </p>\n<p>$\\pi^ *=\\tt argmax_{a\\in A}\\mit R(s,a)+\\gamma\\sum_{s’\\in S}P(s’|s,a)V^ *(s’),\\ \\forall s\\in S$ . </p>\n<p>The idea is to run fixed point iterations to find the fixed point $V^* $ of $B^ *$.</p>\n"},{"title":"","date":"2021-11-23T04:41:10.000Z","_content":"\n","source":"_drafts/template.md","raw":"---\ntitle: #title\ndate: #yyyy-mm-dd hh:mm:ss\ncategories: \n\t#- [cate1]\n\t#- [cate2]\n\t#...\ntags: \n\t#- tag1\n\t#- tag2\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\n#cover: https://astrobear.top/resource/astroblog/thumbnail/xxx\n#thumbnail: https://astrobear.top/resource/astroblog/thumbnail/xxx\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\n#excerpt: ...\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n","slug":"template","published":0,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzyzy000m1q39b30zecug","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Summary of Reinforcement Learning 3","date":"2020-02-01T09:12:00.000Z","cover":"https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg","thumbnail":"https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg","excerpt":"Introduction to MC and TD.","_content":"\n### Introduction\n\nIn the previous article we talked about MP, MRP, MDP and how to find the best policy. All the discussions are based on the fact that we know both the rewards and probabilities for every transition. However, in many cases such information is not readily available to us. Therefore, we are going to discuss *model-free algorithms* in this article. \n\nThroughout this article, we will assume an *infinite horizon* as well as *stationary rewards, transition probabilities and policies*.\n\nFirst comes the definition of *history*: the history is the ordered tuple of states, actions and rewards that an agent experiences. The $j$ th history is: \n\n$h_j=(s_{j,1},a_{j,1},r_{j,1},s_{j,2},a_{j,2},r_{j,2},...,s_{j,L_j})$, \n\nwhere $L_j$ is the length of the interaction (interaction between agent and environment). \n\nIn the article *Summary of Reinforcement Learning 2* I introduced the *iterative solution* of value function, which is\n\n$V_t(s)=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$\n\n​          $=R(s)+\\gamma \\sum P(s'|s)V_{t+1}(s'), \\forall t=0,...,H-1,V_H(s)=0$.\n\nThis ia a bootstraping process, and we estimate the value of the next state using our current estimate of next state. \n\n### Monte Carlo on policy evaluation\n\nIn general, we got the Monte Carlo estimate of some quantity by iterations of how that quantity is generated either in real life or via simulation and then averaging over the observed quantities. By the law of large numbers, this average converges to the expectation of the quantity. \n\nIn reinforcement learning the quantity we want to estimate is $V^\\pi(s)$ and we can get it through three steps: \n\n- Execute a rollout of policy until termination many times\n- Record the returns $G_t$ that we observe when starting at state $s$\n- Take an average of the values we got for $G_t$ to estimate $V^\\pi(s)$. \n\nFigure 1 shows a backup diagram for the Monte Carlo policy evaluation algorithm. And you can find that, unlike what we have talked about in the second article, Monte Carlo on policy evaluation is not a bootstraping process.\n\n![Figure 1](https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg)\n\n#### How to Evaluate the Good and Bad of an Algorithm?\n\nWe use three quntities to evaluate the good and bad of an algorithm.\n\nConsider a statistical model that is parameterized by $\\theta$ and that determins a probability distribution over oberserved data $P(x|\\theta)$. Then consider a statistic $\\hat\\theta$ that provides an estimate of $\\theta$ and it's a function of observed data $x$. Then we have these quantities of the estimator: \n\nBias: $Bias_\\theta(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[\\hat\\theta]-\\theta$, \n\nVariance: $Var(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[(\\hat\\theta-\\Bbb E\\rm[\\hat\\theta])^2]$, \n\nMean squared error (MSE): $MSE(\\hat\\theta)=Var(\\hat\\theta)+Bias_\\theta(\\hat\\theta)$. \n\n#### First-Visit Monte Carlo\n\nHere is the algorithm of First-Visit Monte Carlo: \n\nInitialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$\n\n*$N(s)$: Increment counter of total first visits*\n\n*$G(s)$: Increment total return*\n\n*$V(s)$: Estimate*\n\n`while` each state $s$ visited in episode $i$ `do`\n\n​     `while` **first time $t$** that the state $s$ is visited in episode $i$ `do`\n\n​        $N(s)=N(s)+1$\n\n​        $G(s)=G(s)+G_{i,t}$\n\n​        $V(s)=G(s)/N(s)$ \n\n`return` $V(s)$\n\nFirst-Visit Monte Carlo estimator is an unbised estimator.\n\n#### Every-Visit Monte Carlo\n\nHere is the algorithm of Every-Visit Monte Carlo: \n\nInitialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$\n\n*$N(s)$: Increment counter of total first visits*\n\n*$G(s)$: Increment total return*\n\n*$V(s)$: Estimate*\n\n`while` each state $s$ visited in episode $i$ `do`\n\n​     `while` **every time $t$** that the state $s$ is visited in episode $i$ `do`\n\n​        $N(s)=N(s)+1$\n\n​        $G(s)=G(s)+G_{i,t}$\n\n​        $V(s)=G(s)/N(s)$ \n\n`return` $V(s)$.\n\nEvery-Visit Monte Carlo is a bised estimator becaue the varibles are not IID (Independently Identicaly Distribution). But it has a lower variance which is better than First-Visit Monte Carlo. \n\n#### Increment First-Visit/Every-Visit Monte Carlo\n\nWe can replace $V(s)=G(s)/N(s)$ in both two algorithms by \n\n$V(s)=V(s)+{1\\over N(s)}(G(s)-V(s))$. \n\nBecause\n\n${V(s)(N(s)-1)+G(s)\\over N(s)}=V(s)+{1\\over N(s)}(G(s)-V(s))$. \n\nReplacing $1\\over N(s)$ with $\\alpha$ in the upper expression gives us the more general *Incremental Monte Carlo on policy evaluation*. Setting $\\alpha > {1\\over N(s)}$ gives higher weight to newer data, which can help learning in non-stationary domains. \n\n### Temporal Difference (TD) Learning\n\nTD learning is a new algorithm that combines bootstraping with sampling. It is still model-free, and it will update its value after every observation. \n\nIn dynamic programming, the return is witten as $r_t+\\gamma V^\\pi(s_{t+1})$, where $r_t$ is a sample of the reward at time step $t$ and $V^\\pi(s_{t+1})$ is our current estimate of the value at the next state. We can use the upper expression to replace the $G(s)$ in the incremental Monte Carlo update and then we have \n\n$V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$, \n\nand this is the TD learning update. \n\nIn TD learning update, there are two concepts which are *TD error* and *TD target*. TD error is written as below: \n\n$\\delta_t=r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t)$. \n\nAnd here is TD target, which is the sampled reward combined with the bootstrap estimate of the next state value: \n\n$r_t+\\gamma V^\\pi(s_{t+1})$. \n\nThe algorithm of TD learning is shown below.\n\nInitialize $V^\\pi(s)=0,\\ s\\in S$\n\n`while` True `do`\n\n​    Sample tuple $(s_t,a_t,r_t,s_{t+1})$ \n\n​    $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ \n\nIt is improtance to aware that $V^\\pi(s_{t+1})$ is the current value (estimate) of the next state $s_{t+1}$ and you can get the exact state at the following next time step. Only at that time can you know what the exact $s_{t+1}$ is and then use the current (you can also regard it as the previous one because it remains the same value at $s_t$) estimate $V^\\pi(s_{t+1})$ to calculate the value of $s_t$. Thus that's why it is called the combination of Monte Carlo and dynamic programming due to the sampling (to approximate the expectation) and bootstraping process.\n\nIn reality, if you set $\\alpha$ equals to ${1\\over N}$ or a very small value, the algorithm will converge definitely. On the contrary, it will oscilate when $\\alpha=1$, which means you just ignore the former estimate. \n\nFigure 2 shows a diagram expressing TD learning. \n\n![Figure 2](https://astrobear.top/resource/astroblog/content/RLS3F2.png)\n\n### Summary\n\nTable below gives some fundamental properties of these three algorithms (DP, MC, TD). \n\n| Properties                                                   | DP   | MC                   | TD   |\n| ------------------------------------------------------------ | ---- | -------------------- | ---- |\n| Useble when no models of current domain                      | No   | Yes                  | Yes  |\n| Handles continuing domains (episodes will never terminate)   | Yes  | No                   | Yes  |\n| Handles Non-Markovian domains                                | No   | Yes                  | No   |\n| Coverges to true value in limit (satisfying some conditions) | Yes  | Yes                  | Yes  |\n| Unbised estimate of value                                    | N/A  | Yes (First-Visit MC) | No   |\n| Variance                                                     | N/A  | High                 | Low  |\n\nFigure 3 shows some other properties that may help us to choose the algorithm. \n\n![Figure 3](https://astrobear.top/resource/astroblog/content/RLS3F3.png)\n\n### Batch Monte Carlo and Temporal Difference\n\nThe batch versions of the algorithms is that we have a set of histories that we use to make updates many times and we can use the dataset many times in order to have a better estimate. \n\nIn the Monte Carlo batch setting, the calue at each state converges to the value that minimizes the mean squarred error with the observed returns. While in the TD setting, we converge to the value $V^\\pi$ that is the value of policy $\\pi$ on the maximum likelihood MDP model, where\n\n![Figure 4](https://astrobear.top/resource/astroblog/content/RLS3F4.png). \n\nThe value function derived from the maximum likehood MDP model is known as the *certainty equivalence estimate*. Using this relationship, we can first compute the maximum likelihoood MDP model using the batch. Then we can compute $V^\\pi$ using this model and the model-based policy evaluation methods. This method is highly data efficient but is computationally expensive.","source":"_posts/RLSummary3.md","raw":"---\ntitle: Summary of Reinforcement Learning 3\ndate: 2020-2-1 17:12:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- RL\n\t- Research\n\t- Python\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg\n\nthumbnail: https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: Introduction to MC and TD.\n\n#You can begin to input your article below now.\n\n---\n\n### Introduction\n\nIn the previous article we talked about MP, MRP, MDP and how to find the best policy. All the discussions are based on the fact that we know both the rewards and probabilities for every transition. However, in many cases such information is not readily available to us. Therefore, we are going to discuss *model-free algorithms* in this article. \n\nThroughout this article, we will assume an *infinite horizon* as well as *stationary rewards, transition probabilities and policies*.\n\nFirst comes the definition of *history*: the history is the ordered tuple of states, actions and rewards that an agent experiences. The $j$ th history is: \n\n$h_j=(s_{j,1},a_{j,1},r_{j,1},s_{j,2},a_{j,2},r_{j,2},...,s_{j,L_j})$, \n\nwhere $L_j$ is the length of the interaction (interaction between agent and environment). \n\nIn the article *Summary of Reinforcement Learning 2* I introduced the *iterative solution* of value function, which is\n\n$V_t(s)=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$\n\n​          $=R(s)+\\gamma \\sum P(s'|s)V_{t+1}(s'), \\forall t=0,...,H-1,V_H(s)=0$.\n\nThis ia a bootstraping process, and we estimate the value of the next state using our current estimate of next state. \n\n### Monte Carlo on policy evaluation\n\nIn general, we got the Monte Carlo estimate of some quantity by iterations of how that quantity is generated either in real life or via simulation and then averaging over the observed quantities. By the law of large numbers, this average converges to the expectation of the quantity. \n\nIn reinforcement learning the quantity we want to estimate is $V^\\pi(s)$ and we can get it through three steps: \n\n- Execute a rollout of policy until termination many times\n- Record the returns $G_t$ that we observe when starting at state $s$\n- Take an average of the values we got for $G_t$ to estimate $V^\\pi(s)$. \n\nFigure 1 shows a backup diagram for the Monte Carlo policy evaluation algorithm. And you can find that, unlike what we have talked about in the second article, Monte Carlo on policy evaluation is not a bootstraping process.\n\n![Figure 1](https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg)\n\n#### How to Evaluate the Good and Bad of an Algorithm?\n\nWe use three quntities to evaluate the good and bad of an algorithm.\n\nConsider a statistical model that is parameterized by $\\theta$ and that determins a probability distribution over oberserved data $P(x|\\theta)$. Then consider a statistic $\\hat\\theta$ that provides an estimate of $\\theta$ and it's a function of observed data $x$. Then we have these quantities of the estimator: \n\nBias: $Bias_\\theta(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[\\hat\\theta]-\\theta$, \n\nVariance: $Var(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[(\\hat\\theta-\\Bbb E\\rm[\\hat\\theta])^2]$, \n\nMean squared error (MSE): $MSE(\\hat\\theta)=Var(\\hat\\theta)+Bias_\\theta(\\hat\\theta)$. \n\n#### First-Visit Monte Carlo\n\nHere is the algorithm of First-Visit Monte Carlo: \n\nInitialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$\n\n*$N(s)$: Increment counter of total first visits*\n\n*$G(s)$: Increment total return*\n\n*$V(s)$: Estimate*\n\n`while` each state $s$ visited in episode $i$ `do`\n\n​     `while` **first time $t$** that the state $s$ is visited in episode $i$ `do`\n\n​        $N(s)=N(s)+1$\n\n​        $G(s)=G(s)+G_{i,t}$\n\n​        $V(s)=G(s)/N(s)$ \n\n`return` $V(s)$\n\nFirst-Visit Monte Carlo estimator is an unbised estimator.\n\n#### Every-Visit Monte Carlo\n\nHere is the algorithm of Every-Visit Monte Carlo: \n\nInitialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$\n\n*$N(s)$: Increment counter of total first visits*\n\n*$G(s)$: Increment total return*\n\n*$V(s)$: Estimate*\n\n`while` each state $s$ visited in episode $i$ `do`\n\n​     `while` **every time $t$** that the state $s$ is visited in episode $i$ `do`\n\n​        $N(s)=N(s)+1$\n\n​        $G(s)=G(s)+G_{i,t}$\n\n​        $V(s)=G(s)/N(s)$ \n\n`return` $V(s)$.\n\nEvery-Visit Monte Carlo is a bised estimator becaue the varibles are not IID (Independently Identicaly Distribution). But it has a lower variance which is better than First-Visit Monte Carlo. \n\n#### Increment First-Visit/Every-Visit Monte Carlo\n\nWe can replace $V(s)=G(s)/N(s)$ in both two algorithms by \n\n$V(s)=V(s)+{1\\over N(s)}(G(s)-V(s))$. \n\nBecause\n\n${V(s)(N(s)-1)+G(s)\\over N(s)}=V(s)+{1\\over N(s)}(G(s)-V(s))$. \n\nReplacing $1\\over N(s)$ with $\\alpha$ in the upper expression gives us the more general *Incremental Monte Carlo on policy evaluation*. Setting $\\alpha > {1\\over N(s)}$ gives higher weight to newer data, which can help learning in non-stationary domains. \n\n### Temporal Difference (TD) Learning\n\nTD learning is a new algorithm that combines bootstraping with sampling. It is still model-free, and it will update its value after every observation. \n\nIn dynamic programming, the return is witten as $r_t+\\gamma V^\\pi(s_{t+1})$, where $r_t$ is a sample of the reward at time step $t$ and $V^\\pi(s_{t+1})$ is our current estimate of the value at the next state. We can use the upper expression to replace the $G(s)$ in the incremental Monte Carlo update and then we have \n\n$V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$, \n\nand this is the TD learning update. \n\nIn TD learning update, there are two concepts which are *TD error* and *TD target*. TD error is written as below: \n\n$\\delta_t=r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t)$. \n\nAnd here is TD target, which is the sampled reward combined with the bootstrap estimate of the next state value: \n\n$r_t+\\gamma V^\\pi(s_{t+1})$. \n\nThe algorithm of TD learning is shown below.\n\nInitialize $V^\\pi(s)=0,\\ s\\in S$\n\n`while` True `do`\n\n​    Sample tuple $(s_t,a_t,r_t,s_{t+1})$ \n\n​    $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ \n\nIt is improtance to aware that $V^\\pi(s_{t+1})$ is the current value (estimate) of the next state $s_{t+1}$ and you can get the exact state at the following next time step. Only at that time can you know what the exact $s_{t+1}$ is and then use the current (you can also regard it as the previous one because it remains the same value at $s_t$) estimate $V^\\pi(s_{t+1})$ to calculate the value of $s_t$. Thus that's why it is called the combination of Monte Carlo and dynamic programming due to the sampling (to approximate the expectation) and bootstraping process.\n\nIn reality, if you set $\\alpha$ equals to ${1\\over N}$ or a very small value, the algorithm will converge definitely. On the contrary, it will oscilate when $\\alpha=1$, which means you just ignore the former estimate. \n\nFigure 2 shows a diagram expressing TD learning. \n\n![Figure 2](https://astrobear.top/resource/astroblog/content/RLS3F2.png)\n\n### Summary\n\nTable below gives some fundamental properties of these three algorithms (DP, MC, TD). \n\n| Properties                                                   | DP   | MC                   | TD   |\n| ------------------------------------------------------------ | ---- | -------------------- | ---- |\n| Useble when no models of current domain                      | No   | Yes                  | Yes  |\n| Handles continuing domains (episodes will never terminate)   | Yes  | No                   | Yes  |\n| Handles Non-Markovian domains                                | No   | Yes                  | No   |\n| Coverges to true value in limit (satisfying some conditions) | Yes  | Yes                  | Yes  |\n| Unbised estimate of value                                    | N/A  | Yes (First-Visit MC) | No   |\n| Variance                                                     | N/A  | High                 | Low  |\n\nFigure 3 shows some other properties that may help us to choose the algorithm. \n\n![Figure 3](https://astrobear.top/resource/astroblog/content/RLS3F3.png)\n\n### Batch Monte Carlo and Temporal Difference\n\nThe batch versions of the algorithms is that we have a set of histories that we use to make updates many times and we can use the dataset many times in order to have a better estimate. \n\nIn the Monte Carlo batch setting, the calue at each state converges to the value that minimizes the mean squarred error with the observed returns. While in the TD setting, we converge to the value $V^\\pi$ that is the value of policy $\\pi$ on the maximum likelihood MDP model, where\n\n![Figure 4](https://astrobear.top/resource/astroblog/content/RLS3F4.png). \n\nThe value function derived from the maximum likehood MDP model is known as the *certainty equivalence estimate*. Using this relationship, we can first compute the maximum likelihoood MDP model using the batch. Then we can compute $V^\\pi$ using this model and the model-based policy evaluation methods. This method is highly data efficient but is computationally expensive.","slug":"RLSummary3","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz00000q1q396ty244vj","content":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>In the previous article we talked about MP, MRP, MDP and how to find the best policy. All the discussions are based on the fact that we know both the rewards and probabilities for every transition. However, in many cases such information is not readily available to us. Therefore, we are going to discuss <em>model-free algorithms</em> in this article. </p>\n<p>Throughout this article, we will assume an <em>infinite horizon</em> as well as <em>stationary rewards, transition probabilities and policies</em>.</p>\n<p>First comes the definition of <em>history</em>: the history is the ordered tuple of states, actions and rewards that an agent experiences. The $j$ th history is: </p>\n<p>$h_j=(s_{j,1},a_{j,1},r_{j,1},s_{j,2},a_{j,2},r_{j,2},…,s_{j,L_j})$, </p>\n<p>where $L_j$ is the length of the interaction (interaction between agent and environment). </p>\n<p>In the article <em>Summary of Reinforcement Learning 2</em> I introduced the <em>iterative solution</em> of value function, which is</p>\n<p>$V_t(s)=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$</p>\n<p>​          $=R(s)+\\gamma \\sum P(s’|s)V_{t+1}(s’), \\forall t=0,…,H-1,V_H(s)=0$.</p>\n<p>This ia a bootstraping process, and we estimate the value of the next state using our current estimate of next state. </p>\n<h3 id=\"Monte-Carlo-on-policy-evaluation\"><a href=\"#Monte-Carlo-on-policy-evaluation\" class=\"headerlink\" title=\"Monte Carlo on policy evaluation\"></a>Monte Carlo on policy evaluation</h3><p>In general, we got the Monte Carlo estimate of some quantity by iterations of how that quantity is generated either in real life or via simulation and then averaging over the observed quantities. By the law of large numbers, this average converges to the expectation of the quantity. </p>\n<p>In reinforcement learning the quantity we want to estimate is $V^\\pi(s)$ and we can get it through three steps: </p>\n<ul>\n<li>Execute a rollout of policy until termination many times</li>\n<li>Record the returns $G_t$ that we observe when starting at state $s$</li>\n<li>Take an average of the values we got for $G_t$ to estimate $V^\\pi(s)$. </li>\n</ul>\n<p>Figure 1 shows a backup diagram for the Monte Carlo policy evaluation algorithm. And you can find that, unlike what we have talked about in the second article, Monte Carlo on policy evaluation is not a bootstraping process.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg\" alt=\"Figure 1\"></p>\n<h4 id=\"How-to-Evaluate-the-Good-and-Bad-of-an-Algorithm\"><a href=\"#How-to-Evaluate-the-Good-and-Bad-of-an-Algorithm\" class=\"headerlink\" title=\"How to Evaluate the Good and Bad of an Algorithm?\"></a>How to Evaluate the Good and Bad of an Algorithm?</h4><p>We use three quntities to evaluate the good and bad of an algorithm.</p>\n<p>Consider a statistical model that is parameterized by $\\theta$ and that determins a probability distribution over oberserved data $P(x|\\theta)$. Then consider a statistic $\\hat\\theta$ that provides an estimate of $\\theta$ and it’s a function of observed data $x$. Then we have these quantities of the estimator: </p>\n<p>Bias: $Bias_\\theta(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[\\hat\\theta]-\\theta$, </p>\n<p>Variance: $Var(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[(\\hat\\theta-\\Bbb E\\rm[\\hat\\theta])^2]$, </p>\n<p>Mean squared error (MSE): $MSE(\\hat\\theta)=Var(\\hat\\theta)+Bias_\\theta(\\hat\\theta)$. </p>\n<h4 id=\"First-Visit-Monte-Carlo\"><a href=\"#First-Visit-Monte-Carlo\" class=\"headerlink\" title=\"First-Visit Monte Carlo\"></a>First-Visit Monte Carlo</h4><p>Here is the algorithm of First-Visit Monte Carlo: </p>\n<p>Initialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$</p>\n<p><em>$N(s)$: Increment counter of total first visits</em></p>\n<p><em>$G(s)$: Increment total return</em></p>\n<p><em>$V(s)$: Estimate</em></p>\n<p><code>while</code> each state $s$ visited in episode $i$ <code>do</code></p>\n<p>​     <code>while</code> <strong>first time $t$</strong> that the state $s$ is visited in episode $i$ <code>do</code></p>\n<p>​        $N(s)=N(s)+1$</p>\n<p>​        $G(s)=G(s)+G_{i,t}$</p>\n<p>​        $V(s)=G(s)/N(s)$ </p>\n<p><code>return</code> $V(s)$</p>\n<p>First-Visit Monte Carlo estimator is an unbised estimator.</p>\n<h4 id=\"Every-Visit-Monte-Carlo\"><a href=\"#Every-Visit-Monte-Carlo\" class=\"headerlink\" title=\"Every-Visit Monte Carlo\"></a>Every-Visit Monte Carlo</h4><p>Here is the algorithm of Every-Visit Monte Carlo: </p>\n<p>Initialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$</p>\n<p><em>$N(s)$: Increment counter of total first visits</em></p>\n<p><em>$G(s)$: Increment total return</em></p>\n<p><em>$V(s)$: Estimate</em></p>\n<p><code>while</code> each state $s$ visited in episode $i$ <code>do</code></p>\n<p>​     <code>while</code> <strong>every time $t$</strong> that the state $s$ is visited in episode $i$ <code>do</code></p>\n<p>​        $N(s)=N(s)+1$</p>\n<p>​        $G(s)=G(s)+G_{i,t}$</p>\n<p>​        $V(s)=G(s)/N(s)$ </p>\n<p><code>return</code> $V(s)$.</p>\n<p>Every-Visit Monte Carlo is a bised estimator becaue the varibles are not IID (Independently Identicaly Distribution). But it has a lower variance which is better than First-Visit Monte Carlo. </p>\n<h4 id=\"Increment-First-Visit-Every-Visit-Monte-Carlo\"><a href=\"#Increment-First-Visit-Every-Visit-Monte-Carlo\" class=\"headerlink\" title=\"Increment First-Visit/Every-Visit Monte Carlo\"></a>Increment First-Visit/Every-Visit Monte Carlo</h4><p>We can replace $V(s)=G(s)/N(s)$ in both two algorithms by </p>\n<p>$V(s)=V(s)+{1\\over N(s)}(G(s)-V(s))$. </p>\n<p>Because</p>\n<p>${V(s)(N(s)-1)+G(s)\\over N(s)}=V(s)+{1\\over N(s)}(G(s)-V(s))$. </p>\n<p>Replacing $1\\over N(s)$ with $\\alpha$ in the upper expression gives us the more general <em>Incremental Monte Carlo on policy evaluation</em>. Setting $\\alpha &gt; {1\\over N(s)}$ gives higher weight to newer data, which can help learning in non-stationary domains. </p>\n<h3 id=\"Temporal-Difference-TD-Learning\"><a href=\"#Temporal-Difference-TD-Learning\" class=\"headerlink\" title=\"Temporal Difference (TD) Learning\"></a>Temporal Difference (TD) Learning</h3><p>TD learning is a new algorithm that combines bootstraping with sampling. It is still model-free, and it will update its value after every observation. </p>\n<p>In dynamic programming, the return is witten as $r_t+\\gamma V^\\pi(s_{t+1})$, where $r_t$ is a sample of the reward at time step $t$ and $V^\\pi(s_{t+1})$ is our current estimate of the value at the next state. We can use the upper expression to replace the $G(s)$ in the incremental Monte Carlo update and then we have </p>\n<p>$V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$, </p>\n<p>and this is the TD learning update. </p>\n<p>In TD learning update, there are two concepts which are <em>TD error</em> and <em>TD target</em>. TD error is written as below: </p>\n<p>$\\delta_t=r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t)$. </p>\n<p>And here is TD target, which is the sampled reward combined with the bootstrap estimate of the next state value: </p>\n<p>$r_t+\\gamma V^\\pi(s_{t+1})$. </p>\n<p>The algorithm of TD learning is shown below.</p>\n<p>Initialize $V^\\pi(s)=0,\\ s\\in S$</p>\n<p><code>while</code> True <code>do</code></p>\n<p>​    Sample tuple $(s_t,a_t,r_t,s_{t+1})$ </p>\n<p>​    $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ </p>\n<p>It is improtance to aware that $V^\\pi(s_{t+1})$ is the current value (estimate) of the next state $s_{t+1}$ and you can get the exact state at the following next time step. Only at that time can you know what the exact $s_{t+1}$ is and then use the current (you can also regard it as the previous one because it remains the same value at $s_t$) estimate $V^\\pi(s_{t+1})$ to calculate the value of $s_t$. Thus that’s why it is called the combination of Monte Carlo and dynamic programming due to the sampling (to approximate the expectation) and bootstraping process.</p>\n<p>In reality, if you set $\\alpha$ equals to ${1\\over N}$ or a very small value, the algorithm will converge definitely. On the contrary, it will oscilate when $\\alpha=1$, which means you just ignore the former estimate. </p>\n<p>Figure 2 shows a diagram expressing TD learning. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F2.png\" alt=\"Figure 2\"></p>\n<h3 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h3><p>Table below gives some fundamental properties of these three algorithms (DP, MC, TD). </p>\n<table>\n<thead>\n<tr>\n<th>Properties</th>\n<th>DP</th>\n<th>MC</th>\n<th>TD</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Useble when no models of current domain</td>\n<td>No</td>\n<td>Yes</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>Handles continuing domains (episodes will never terminate)</td>\n<td>Yes</td>\n<td>No</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>Handles Non-Markovian domains</td>\n<td>No</td>\n<td>Yes</td>\n<td>No</td>\n</tr>\n<tr>\n<td>Coverges to true value in limit (satisfying some conditions)</td>\n<td>Yes</td>\n<td>Yes</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>Unbised estimate of value</td>\n<td>N/A</td>\n<td>Yes (First-Visit MC)</td>\n<td>No</td>\n</tr>\n<tr>\n<td>Variance</td>\n<td>N/A</td>\n<td>High</td>\n<td>Low</td>\n</tr>\n</tbody></table>\n<p>Figure 3 shows some other properties that may help us to choose the algorithm. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F3.png\" alt=\"Figure 3\"></p>\n<h3 id=\"Batch-Monte-Carlo-and-Temporal-Difference\"><a href=\"#Batch-Monte-Carlo-and-Temporal-Difference\" class=\"headerlink\" title=\"Batch Monte Carlo and Temporal Difference\"></a>Batch Monte Carlo and Temporal Difference</h3><p>The batch versions of the algorithms is that we have a set of histories that we use to make updates many times and we can use the dataset many times in order to have a better estimate. </p>\n<p>In the Monte Carlo batch setting, the calue at each state converges to the value that minimizes the mean squarred error with the observed returns. While in the TD setting, we converge to the value $V^\\pi$ that is the value of policy $\\pi$ on the maximum likelihood MDP model, where</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F4.png\" alt=\"Figure 4\">. </p>\n<p>The value function derived from the maximum likehood MDP model is known as the <em>certainty equivalence estimate</em>. Using this relationship, we can first compute the maximum likelihoood MDP model using the batch. Then we can compute $V^\\pi$ using this model and the model-based policy evaluation methods. This method is highly data efficient but is computationally expensive.</p>\n","site":{"data":{}},"more":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>In the previous article we talked about MP, MRP, MDP and how to find the best policy. All the discussions are based on the fact that we know both the rewards and probabilities for every transition. However, in many cases such information is not readily available to us. Therefore, we are going to discuss <em>model-free algorithms</em> in this article. </p>\n<p>Throughout this article, we will assume an <em>infinite horizon</em> as well as <em>stationary rewards, transition probabilities and policies</em>.</p>\n<p>First comes the definition of <em>history</em>: the history is the ordered tuple of states, actions and rewards that an agent experiences. The $j$ th history is: </p>\n<p>$h_j=(s_{j,1},a_{j,1},r_{j,1},s_{j,2},a_{j,2},r_{j,2},…,s_{j,L_j})$, </p>\n<p>where $L_j$ is the length of the interaction (interaction between agent and environment). </p>\n<p>In the article <em>Summary of Reinforcement Learning 2</em> I introduced the <em>iterative solution</em> of value function, which is</p>\n<p>$V_t(s)=\\Bbb E_\\pi[R_{t+1}+\\gamma V_\\pi (s_{t+1})|s_t=s]$</p>\n<p>​          $=R(s)+\\gamma \\sum P(s’|s)V_{t+1}(s’), \\forall t=0,…,H-1,V_H(s)=0$.</p>\n<p>This ia a bootstraping process, and we estimate the value of the next state using our current estimate of next state. </p>\n<h3 id=\"Monte-Carlo-on-policy-evaluation\"><a href=\"#Monte-Carlo-on-policy-evaluation\" class=\"headerlink\" title=\"Monte Carlo on policy evaluation\"></a>Monte Carlo on policy evaluation</h3><p>In general, we got the Monte Carlo estimate of some quantity by iterations of how that quantity is generated either in real life or via simulation and then averaging over the observed quantities. By the law of large numbers, this average converges to the expectation of the quantity. </p>\n<p>In reinforcement learning the quantity we want to estimate is $V^\\pi(s)$ and we can get it through three steps: </p>\n<ul>\n<li>Execute a rollout of policy until termination many times</li>\n<li>Record the returns $G_t$ that we observe when starting at state $s$</li>\n<li>Take an average of the values we got for $G_t$ to estimate $V^\\pi(s)$. </li>\n</ul>\n<p>Figure 1 shows a backup diagram for the Monte Carlo policy evaluation algorithm. And you can find that, unlike what we have talked about in the second article, Monte Carlo on policy evaluation is not a bootstraping process.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F1.jpeg\" alt=\"Figure 1\"></p>\n<h4 id=\"How-to-Evaluate-the-Good-and-Bad-of-an-Algorithm\"><a href=\"#How-to-Evaluate-the-Good-and-Bad-of-an-Algorithm\" class=\"headerlink\" title=\"How to Evaluate the Good and Bad of an Algorithm?\"></a>How to Evaluate the Good and Bad of an Algorithm?</h4><p>We use three quntities to evaluate the good and bad of an algorithm.</p>\n<p>Consider a statistical model that is parameterized by $\\theta$ and that determins a probability distribution over oberserved data $P(x|\\theta)$. Then consider a statistic $\\hat\\theta$ that provides an estimate of $\\theta$ and it’s a function of observed data $x$. Then we have these quantities of the estimator: </p>\n<p>Bias: $Bias_\\theta(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[\\hat\\theta]-\\theta$, </p>\n<p>Variance: $Var(\\hat\\theta)=\\Bbb E\\rm_{x|\\theta}[(\\hat\\theta-\\Bbb E\\rm[\\hat\\theta])^2]$, </p>\n<p>Mean squared error (MSE): $MSE(\\hat\\theta)=Var(\\hat\\theta)+Bias_\\theta(\\hat\\theta)$. </p>\n<h4 id=\"First-Visit-Monte-Carlo\"><a href=\"#First-Visit-Monte-Carlo\" class=\"headerlink\" title=\"First-Visit Monte Carlo\"></a>First-Visit Monte Carlo</h4><p>Here is the algorithm of First-Visit Monte Carlo: </p>\n<p>Initialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$</p>\n<p><em>$N(s)$: Increment counter of total first visits</em></p>\n<p><em>$G(s)$: Increment total return</em></p>\n<p><em>$V(s)$: Estimate</em></p>\n<p><code>while</code> each state $s$ visited in episode $i$ <code>do</code></p>\n<p>​     <code>while</code> <strong>first time $t$</strong> that the state $s$ is visited in episode $i$ <code>do</code></p>\n<p>​        $N(s)=N(s)+1$</p>\n<p>​        $G(s)=G(s)+G_{i,t}$</p>\n<p>​        $V(s)=G(s)/N(s)$ </p>\n<p><code>return</code> $V(s)$</p>\n<p>First-Visit Monte Carlo estimator is an unbised estimator.</p>\n<h4 id=\"Every-Visit-Monte-Carlo\"><a href=\"#Every-Visit-Monte-Carlo\" class=\"headerlink\" title=\"Every-Visit Monte Carlo\"></a>Every-Visit Monte Carlo</h4><p>Here is the algorithm of Every-Visit Monte Carlo: </p>\n<p>Initialize $N(s)=0,\\ G(s)=0,\\ V(s)=0,\\ \\forall s\\in S$</p>\n<p><em>$N(s)$: Increment counter of total first visits</em></p>\n<p><em>$G(s)$: Increment total return</em></p>\n<p><em>$V(s)$: Estimate</em></p>\n<p><code>while</code> each state $s$ visited in episode $i$ <code>do</code></p>\n<p>​     <code>while</code> <strong>every time $t$</strong> that the state $s$ is visited in episode $i$ <code>do</code></p>\n<p>​        $N(s)=N(s)+1$</p>\n<p>​        $G(s)=G(s)+G_{i,t}$</p>\n<p>​        $V(s)=G(s)/N(s)$ </p>\n<p><code>return</code> $V(s)$.</p>\n<p>Every-Visit Monte Carlo is a bised estimator becaue the varibles are not IID (Independently Identicaly Distribution). But it has a lower variance which is better than First-Visit Monte Carlo. </p>\n<h4 id=\"Increment-First-Visit-Every-Visit-Monte-Carlo\"><a href=\"#Increment-First-Visit-Every-Visit-Monte-Carlo\" class=\"headerlink\" title=\"Increment First-Visit/Every-Visit Monte Carlo\"></a>Increment First-Visit/Every-Visit Monte Carlo</h4><p>We can replace $V(s)=G(s)/N(s)$ in both two algorithms by </p>\n<p>$V(s)=V(s)+{1\\over N(s)}(G(s)-V(s))$. </p>\n<p>Because</p>\n<p>${V(s)(N(s)-1)+G(s)\\over N(s)}=V(s)+{1\\over N(s)}(G(s)-V(s))$. </p>\n<p>Replacing $1\\over N(s)$ with $\\alpha$ in the upper expression gives us the more general <em>Incremental Monte Carlo on policy evaluation</em>. Setting $\\alpha &gt; {1\\over N(s)}$ gives higher weight to newer data, which can help learning in non-stationary domains. </p>\n<h3 id=\"Temporal-Difference-TD-Learning\"><a href=\"#Temporal-Difference-TD-Learning\" class=\"headerlink\" title=\"Temporal Difference (TD) Learning\"></a>Temporal Difference (TD) Learning</h3><p>TD learning is a new algorithm that combines bootstraping with sampling. It is still model-free, and it will update its value after every observation. </p>\n<p>In dynamic programming, the return is witten as $r_t+\\gamma V^\\pi(s_{t+1})$, where $r_t$ is a sample of the reward at time step $t$ and $V^\\pi(s_{t+1})$ is our current estimate of the value at the next state. We can use the upper expression to replace the $G(s)$ in the incremental Monte Carlo update and then we have </p>\n<p>$V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$, </p>\n<p>and this is the TD learning update. </p>\n<p>In TD learning update, there are two concepts which are <em>TD error</em> and <em>TD target</em>. TD error is written as below: </p>\n<p>$\\delta_t=r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t)$. </p>\n<p>And here is TD target, which is the sampled reward combined with the bootstrap estimate of the next state value: </p>\n<p>$r_t+\\gamma V^\\pi(s_{t+1})$. </p>\n<p>The algorithm of TD learning is shown below.</p>\n<p>Initialize $V^\\pi(s)=0,\\ s\\in S$</p>\n<p><code>while</code> True <code>do</code></p>\n<p>​    Sample tuple $(s_t,a_t,r_t,s_{t+1})$ </p>\n<p>​    $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ </p>\n<p>It is improtance to aware that $V^\\pi(s_{t+1})$ is the current value (estimate) of the next state $s_{t+1}$ and you can get the exact state at the following next time step. Only at that time can you know what the exact $s_{t+1}$ is and then use the current (you can also regard it as the previous one because it remains the same value at $s_t$) estimate $V^\\pi(s_{t+1})$ to calculate the value of $s_t$. Thus that’s why it is called the combination of Monte Carlo and dynamic programming due to the sampling (to approximate the expectation) and bootstraping process.</p>\n<p>In reality, if you set $\\alpha$ equals to ${1\\over N}$ or a very small value, the algorithm will converge definitely. On the contrary, it will oscilate when $\\alpha=1$, which means you just ignore the former estimate. </p>\n<p>Figure 2 shows a diagram expressing TD learning. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F2.png\" alt=\"Figure 2\"></p>\n<h3 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h3><p>Table below gives some fundamental properties of these three algorithms (DP, MC, TD). </p>\n<table>\n<thead>\n<tr>\n<th>Properties</th>\n<th>DP</th>\n<th>MC</th>\n<th>TD</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Useble when no models of current domain</td>\n<td>No</td>\n<td>Yes</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>Handles continuing domains (episodes will never terminate)</td>\n<td>Yes</td>\n<td>No</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>Handles Non-Markovian domains</td>\n<td>No</td>\n<td>Yes</td>\n<td>No</td>\n</tr>\n<tr>\n<td>Coverges to true value in limit (satisfying some conditions)</td>\n<td>Yes</td>\n<td>Yes</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>Unbised estimate of value</td>\n<td>N/A</td>\n<td>Yes (First-Visit MC)</td>\n<td>No</td>\n</tr>\n<tr>\n<td>Variance</td>\n<td>N/A</td>\n<td>High</td>\n<td>Low</td>\n</tr>\n</tbody></table>\n<p>Figure 3 shows some other properties that may help us to choose the algorithm. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F3.png\" alt=\"Figure 3\"></p>\n<h3 id=\"Batch-Monte-Carlo-and-Temporal-Difference\"><a href=\"#Batch-Monte-Carlo-and-Temporal-Difference\" class=\"headerlink\" title=\"Batch Monte Carlo and Temporal Difference\"></a>Batch Monte Carlo and Temporal Difference</h3><p>The batch versions of the algorithms is that we have a set of histories that we use to make updates many times and we can use the dataset many times in order to have a better estimate. </p>\n<p>In the Monte Carlo batch setting, the calue at each state converges to the value that minimizes the mean squarred error with the observed returns. While in the TD setting, we converge to the value $V^\\pi$ that is the value of policy $\\pi$ on the maximum likelihood MDP model, where</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS3F4.png\" alt=\"Figure 4\">. </p>\n<p>The value function derived from the maximum likehood MDP model is known as the <em>certainty equivalence estimate</em>. Using this relationship, we can first compute the maximum likelihoood MDP model using the batch. Then we can compute $V^\\pi$ using this model and the model-based policy evaluation methods. This method is highly data efficient but is computationally expensive.</p>\n"},{"title":"Summary of Reinforcement Learning 4","date":"2020-02-16T08:38:00.000Z","cover":"https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg","thumbnail":"https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg","excerpt":"Something about model-free control.","_content":"\n### Introduction\n\nIn this article we will discuss model-free control where we learn good policies under the same constrains (only interactions, no knowledge of reward structure or transition probabilities). In actual world, many problems can be modeled into a MDP and model-free control is important for some problems in two types of domains: \n\n- MDP model is unknown but we can sample the trajectories from the MDP\n- MDP model is known but computing the value function is really really hard due to the size of the domain\n\nThere are two types of policy learning under model-free control domain, which are *on-policy learning* and *off-policy learning*. \n\n- On-policy learning: base on direct experience and learn to estimate and evaluate a policy from experience obtained from following that policy\n- Off-policy learning: learn to estimate and evaluate a policy using experience gathered from following a different policy\n\n### Generalized Policy Iteration\n\nIn *Summarize of Reinforcement Learning 2* we have learned the algorithm of policy iteration, which is: \n\n(1) `while` True `do`\n\n(2)\t $V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)\n\n(3) \t$\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)=\\tt argmax\\mit \\ [R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)V^{\\pi i}(s')]$ \n\n(4) \t`if` $\\pi^*(s)=\\pi(s)$ `then`\n\n(5) \t\t`break`\n\n(6) \t`else`\n\n(7) \t\t$\\pi$ = $\\pi^*$\n\n(8) $V^*$ = $V^\\pi$ . \n\nIn order to make this algorithm model-free, we can do the policy evaluation (line 2) using the methods we mentioned in the last article. Because we are talking about *control*, so we use state-action value function $Q^\\pi(s,a)$ to substitute $V^\\pi$ in line 2, in a Monte Carlo way. The algorithum of MC for policy Q evaluation is written below: \n\nInitialize $N(s,a)=0,\\ G(s,a)=0,\\ Q^\\pi(s,a)=0,\\ \\forall s\\in S,\\ a\\in A$\n\nUsing policy $\\pi$ to sample an episode $i=s_{i,1},a_{i,1},r_{i,1},...$ \n\n`while` each state, action $(s,a)$ visited in episode $i$ `do`\n\n​\t `while` **first/every time $t$** that the state, action $(s,a)$ is visited in episode $i$ `do`\n\n​\t\t$N(s,a)=N(s,a)+1$\n\n​\t\t$G(s,a)=G(s,a)+G_{i,t}$\n\n​\t\t$Q^{\\pi i}(s,a)=Q^{\\pi i}(s,a)/N(s,a)$ \n\n`return` $Q^{\\pi i}(s,a)$.\n\nThereby, accroding to the definition, we can modify the line 3 directly as: \n\n$\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)$. \n\nThere are a few caveats to this modified algorithm (MC for policy Q evaluation): \n\n- If policy $\\pi$ is determiniistic or dosen't take every action with some positive probability, then we cannot actually compute the argmax in line 3\n- The policy evaluation algorithm gives us an estimate of $Q^\\pi$, so it is not clear whether (while we want to make sure that) line 3 will monotonically improve the policy like the model-based case.\n\n### Importance of Exploration\n\nPlease notice the first caveat we just mentioned above, this means, in other words, the policy $\\pi$ needs to explore actions, even if they might be suboptimal with respect to our current Q-value estimates. And this is what we have talked about in the first article: the relationship between exploration and exploitation. Here is a simple way to balance them. \n\n#### $\\epsilon$-greedy Policies\n\nThis strategy is to take random action with small probability and take the greedy action the rest of the time. Mathematically, an $\\epsilon$-greedy policy with respect to the state-action value $Q^\\pi(s,a)$ takes the following form: \n\n![](https://astrobear.top/resource/astroblog/content/RLS4F6.png).\n\nIt can be summarized as: $\\epsilon$-greedy policy selects a random action with probability $\\epsilon$ or otherwise follows the greedy policy. \n\n#### Monotonic $\\epsilon $-greedy Policy Improvement\n\nWe have already provided a strategy to deal with the first caveat and now we are going to focus on the second one: to prove the monotonic $\\epsilon$-greedy policy improvement. And here is the proof. \n\n![Monotonic e-greedy Policy Improvement](https://astrobear.top/resource/astroblog/content/RLS4F1.jpeg)\n\nNow we have that $Q^{\\pi_i}(s,\\pi_{i+1}(s))\\ge V^{\\pi_i}(s)$ implies $V^{\\pi_{i+1}}(s)\\ge V^{\\pi_i}$ for all states, as desired. Thus, the monotonic $\\epsilon $-greedy policy improvement shows us that our policy does in fact improve if we act $\\epsilon$-greedy on the current $\\epsilon$-greedy policy. \n\n#### Greedy in the Limit of Infinite Exploration (GLIE)\n\n$\\epsilon$-greedy is a naive way to balance exploration and exploitation and we can refine it. The new class of exploration strategies is called *Greedy in the Limit of Infinite Exploration* (GLIE), which allows us to make convergence guarantees about our algorithms. \n\nA policy is GLIE if it satisfies the following two properties: \n\n- All state-action pairs are visited an infinite number of times: $\\lim_{i\\rightarrow\\infty}N_i(s,a)\\rightarrow\\infty$ \n- Behavior policy converges to greedy policy\n\nA simple GLIE strategy is $\\epsilon$-greedy policy where $\\epsilon$ is decayed to zero with $\\epsilon_i={1\\over i}$, $i$ is the epsiode number. \n\n### Monte Carlo Control\n\nHere is the algorithm of online Monte Carlo control: \n\n![Online Monte Carlo Control](https://astrobear.top/resource/astroblog/content/RLS4F2.png). \n\nThe algorithm is first-visit online Monte Carlo control precisely and you can modify it to every-visit online Monte control easily. \n\nIf $\\epsilon$-greedy strategy used in this algorithm is GLIE, then the Q-value derived from the algorithm will converge to the optimal Q-function. \n\n### Tempooral Difference Methods for Control\n\nThere are two methods of TD-style model-free control: on-policy and off-policy. We first introduce the on-policy method, called SARSA. \n\n#### SARSA\n\nHere is the algorithm: \n\n![SARSA](https://astrobear.top/resource/astroblog/content/RLS4F3.jpeg). \n\nSARSA stands for **S**tate, **A**ction, **R**eward, next **S**tate, **A**ction taken in next state. Because this algorithm updates the Q-value after it gets the tuple $(s,a,r,s',a')$, it is called SARSA. SARSA is an on-policy method because the actions $a$ and $a'$ used in the update equation are both from the policy that is being followed at the time of the update. \n\nSARSA for finite-state and finite-action MDP's converges to the optimal action-value if the following conditions hold: \n\n- The sequence of policies $\\pi$ from is GLIE\n- The step-sizes $\\alpha_t$ satisfy the *Robbins-Munro* sequence such that: $\\sum^\\infty_{t=1}\\alpha_t=\\infty,\\ \\sum^\\infty_{t=1}\\alpha_t^2<\\infty$ (although we generally don't use the step-sizes satisfy this condition in reality). \n\n#### Q-Learning\n\nHere is the algorithm: \n\n![Q-Learning](https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg).\n\nThe biggest different between Q-learning and SARSA is that, Q-learning takes a maximum over the actions at the next state, this action is not necessarily the same same as the one we would derive from the current policy. On the contrary, the agent will choose the action that brings the biggest reward directly and this behavior actually updates the policy because, when we adopt $\\epsilon$-greedy we definately introduce Q-value. Q-learning updates the Q-value (policy) after it gets the tuple $(s,a,r,s')$. And this is why it is called *off-policy*. \n\nHowever, in SARSA, as we stated before, the action $a'$ derives from the current policy that has not been updated. The agent may choose a bad action $a'$ randomly following the $\\epsilon$-greedy policy and this may lower the Q-value of some state-action pairs after the update. This consequently lead to the result that, SARSA might not figure out the optimal trajectory of the agent but the suboptimal one. \n\n#### Double Q-Learning\n\nIn Q-learning, the state values $V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$ can suffer from maximization bias (bias introduced by the maximization operation) when we have finitely many samples. Our state value estimate is at least as large as the true value of state $s$, so we are systematically overestimating the value of the state. In Q-learning, we can maintain two independent unbiased estimates, $Q_1$ and $Q_2$ and when we use one to select the maximum, we can use the other to get an estimate of the value of this maximum. This is called *double Q-learning* which is shown below: \n\n![Double Q-Learning](https://astrobear.top/resource/astroblog/content/RLS4F5.jpeg). \n\nDouble Q-learning can significantly speed up training time by eliminating suboptimal actions more quickly then normal Q-learning. \n\n\n\n\n\n","source":"_posts/RLSummary4.md","raw":"---\ntitle: Summary of Reinforcement Learning 4\ndate: 2020-2-16 16:38:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- RL\n\t- Research\n\t- Python\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg\n\nthumbnail: https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: Something about model-free control. \n\n#You can begin to input your article below now.\n\n---\n\n### Introduction\n\nIn this article we will discuss model-free control where we learn good policies under the same constrains (only interactions, no knowledge of reward structure or transition probabilities). In actual world, many problems can be modeled into a MDP and model-free control is important for some problems in two types of domains: \n\n- MDP model is unknown but we can sample the trajectories from the MDP\n- MDP model is known but computing the value function is really really hard due to the size of the domain\n\nThere are two types of policy learning under model-free control domain, which are *on-policy learning* and *off-policy learning*. \n\n- On-policy learning: base on direct experience and learn to estimate and evaluate a policy from experience obtained from following that policy\n- Off-policy learning: learn to estimate and evaluate a policy using experience gathered from following a different policy\n\n### Generalized Policy Iteration\n\nIn *Summarize of Reinforcement Learning 2* we have learned the algorithm of policy iteration, which is: \n\n(1) `while` True `do`\n\n(2)\t $V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)\n\n(3) \t$\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)=\\tt argmax\\mit \\ [R(s,a)+\\gamma\\sum_{s'\\in S} P(s'|s,a)V^{\\pi i}(s')]$ \n\n(4) \t`if` $\\pi^*(s)=\\pi(s)$ `then`\n\n(5) \t\t`break`\n\n(6) \t`else`\n\n(7) \t\t$\\pi$ = $\\pi^*$\n\n(8) $V^*$ = $V^\\pi$ . \n\nIn order to make this algorithm model-free, we can do the policy evaluation (line 2) using the methods we mentioned in the last article. Because we are talking about *control*, so we use state-action value function $Q^\\pi(s,a)$ to substitute $V^\\pi$ in line 2, in a Monte Carlo way. The algorithum of MC for policy Q evaluation is written below: \n\nInitialize $N(s,a)=0,\\ G(s,a)=0,\\ Q^\\pi(s,a)=0,\\ \\forall s\\in S,\\ a\\in A$\n\nUsing policy $\\pi$ to sample an episode $i=s_{i,1},a_{i,1},r_{i,1},...$ \n\n`while` each state, action $(s,a)$ visited in episode $i$ `do`\n\n​\t `while` **first/every time $t$** that the state, action $(s,a)$ is visited in episode $i$ `do`\n\n​\t\t$N(s,a)=N(s,a)+1$\n\n​\t\t$G(s,a)=G(s,a)+G_{i,t}$\n\n​\t\t$Q^{\\pi i}(s,a)=Q^{\\pi i}(s,a)/N(s,a)$ \n\n`return` $Q^{\\pi i}(s,a)$.\n\nThereby, accroding to the definition, we can modify the line 3 directly as: \n\n$\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)$. \n\nThere are a few caveats to this modified algorithm (MC for policy Q evaluation): \n\n- If policy $\\pi$ is determiniistic or dosen't take every action with some positive probability, then we cannot actually compute the argmax in line 3\n- The policy evaluation algorithm gives us an estimate of $Q^\\pi$, so it is not clear whether (while we want to make sure that) line 3 will monotonically improve the policy like the model-based case.\n\n### Importance of Exploration\n\nPlease notice the first caveat we just mentioned above, this means, in other words, the policy $\\pi$ needs to explore actions, even if they might be suboptimal with respect to our current Q-value estimates. And this is what we have talked about in the first article: the relationship between exploration and exploitation. Here is a simple way to balance them. \n\n#### $\\epsilon$-greedy Policies\n\nThis strategy is to take random action with small probability and take the greedy action the rest of the time. Mathematically, an $\\epsilon$-greedy policy with respect to the state-action value $Q^\\pi(s,a)$ takes the following form: \n\n![](https://astrobear.top/resource/astroblog/content/RLS4F6.png).\n\nIt can be summarized as: $\\epsilon$-greedy policy selects a random action with probability $\\epsilon$ or otherwise follows the greedy policy. \n\n#### Monotonic $\\epsilon $-greedy Policy Improvement\n\nWe have already provided a strategy to deal with the first caveat and now we are going to focus on the second one: to prove the monotonic $\\epsilon$-greedy policy improvement. And here is the proof. \n\n![Monotonic e-greedy Policy Improvement](https://astrobear.top/resource/astroblog/content/RLS4F1.jpeg)\n\nNow we have that $Q^{\\pi_i}(s,\\pi_{i+1}(s))\\ge V^{\\pi_i}(s)$ implies $V^{\\pi_{i+1}}(s)\\ge V^{\\pi_i}$ for all states, as desired. Thus, the monotonic $\\epsilon $-greedy policy improvement shows us that our policy does in fact improve if we act $\\epsilon$-greedy on the current $\\epsilon$-greedy policy. \n\n#### Greedy in the Limit of Infinite Exploration (GLIE)\n\n$\\epsilon$-greedy is a naive way to balance exploration and exploitation and we can refine it. The new class of exploration strategies is called *Greedy in the Limit of Infinite Exploration* (GLIE), which allows us to make convergence guarantees about our algorithms. \n\nA policy is GLIE if it satisfies the following two properties: \n\n- All state-action pairs are visited an infinite number of times: $\\lim_{i\\rightarrow\\infty}N_i(s,a)\\rightarrow\\infty$ \n- Behavior policy converges to greedy policy\n\nA simple GLIE strategy is $\\epsilon$-greedy policy where $\\epsilon$ is decayed to zero with $\\epsilon_i={1\\over i}$, $i$ is the epsiode number. \n\n### Monte Carlo Control\n\nHere is the algorithm of online Monte Carlo control: \n\n![Online Monte Carlo Control](https://astrobear.top/resource/astroblog/content/RLS4F2.png). \n\nThe algorithm is first-visit online Monte Carlo control precisely and you can modify it to every-visit online Monte control easily. \n\nIf $\\epsilon$-greedy strategy used in this algorithm is GLIE, then the Q-value derived from the algorithm will converge to the optimal Q-function. \n\n### Tempooral Difference Methods for Control\n\nThere are two methods of TD-style model-free control: on-policy and off-policy. We first introduce the on-policy method, called SARSA. \n\n#### SARSA\n\nHere is the algorithm: \n\n![SARSA](https://astrobear.top/resource/astroblog/content/RLS4F3.jpeg). \n\nSARSA stands for **S**tate, **A**ction, **R**eward, next **S**tate, **A**ction taken in next state. Because this algorithm updates the Q-value after it gets the tuple $(s,a,r,s',a')$, it is called SARSA. SARSA is an on-policy method because the actions $a$ and $a'$ used in the update equation are both from the policy that is being followed at the time of the update. \n\nSARSA for finite-state and finite-action MDP's converges to the optimal action-value if the following conditions hold: \n\n- The sequence of policies $\\pi$ from is GLIE\n- The step-sizes $\\alpha_t$ satisfy the *Robbins-Munro* sequence such that: $\\sum^\\infty_{t=1}\\alpha_t=\\infty,\\ \\sum^\\infty_{t=1}\\alpha_t^2<\\infty$ (although we generally don't use the step-sizes satisfy this condition in reality). \n\n#### Q-Learning\n\nHere is the algorithm: \n\n![Q-Learning](https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg).\n\nThe biggest different between Q-learning and SARSA is that, Q-learning takes a maximum over the actions at the next state, this action is not necessarily the same same as the one we would derive from the current policy. On the contrary, the agent will choose the action that brings the biggest reward directly and this behavior actually updates the policy because, when we adopt $\\epsilon$-greedy we definately introduce Q-value. Q-learning updates the Q-value (policy) after it gets the tuple $(s,a,r,s')$. And this is why it is called *off-policy*. \n\nHowever, in SARSA, as we stated before, the action $a'$ derives from the current policy that has not been updated. The agent may choose a bad action $a'$ randomly following the $\\epsilon$-greedy policy and this may lower the Q-value of some state-action pairs after the update. This consequently lead to the result that, SARSA might not figure out the optimal trajectory of the agent but the suboptimal one. \n\n#### Double Q-Learning\n\nIn Q-learning, the state values $V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$ can suffer from maximization bias (bias introduced by the maximization operation) when we have finitely many samples. Our state value estimate is at least as large as the true value of state $s$, so we are systematically overestimating the value of the state. In Q-learning, we can maintain two independent unbiased estimates, $Q_1$ and $Q_2$ and when we use one to select the maximum, we can use the other to get an estimate of the value of this maximum. This is called *double Q-learning* which is shown below: \n\n![Double Q-Learning](https://astrobear.top/resource/astroblog/content/RLS4F5.jpeg). \n\nDouble Q-learning can significantly speed up training time by eliminating suboptimal actions more quickly then normal Q-learning. \n\n\n\n\n\n","slug":"RLSummary4","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz01000t1q394rv59ewq","content":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>In this article we will discuss model-free control where we learn good policies under the same constrains (only interactions, no knowledge of reward structure or transition probabilities). In actual world, many problems can be modeled into a MDP and model-free control is important for some problems in two types of domains: </p>\n<ul>\n<li>MDP model is unknown but we can sample the trajectories from the MDP</li>\n<li>MDP model is known but computing the value function is really really hard due to the size of the domain</li>\n</ul>\n<p>There are two types of policy learning under model-free control domain, which are <em>on-policy learning</em> and <em>off-policy learning</em>. </p>\n<ul>\n<li>On-policy learning: base on direct experience and learn to estimate and evaluate a policy from experience obtained from following that policy</li>\n<li>Off-policy learning: learn to estimate and evaluate a policy using experience gathered from following a different policy</li>\n</ul>\n<h3 id=\"Generalized-Policy-Iteration\"><a href=\"#Generalized-Policy-Iteration\" class=\"headerlink\" title=\"Generalized Policy Iteration\"></a>Generalized Policy Iteration</h3><p>In <em>Summarize of Reinforcement Learning 2</em> we have learned the algorithm of policy iteration, which is: </p>\n<p>(1) <code>while</code> True <code>do</code></p>\n<p>(2)     $V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)</p>\n<p>(3)     $\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)=\\tt argmax\\mit \\ [R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)V^{\\pi i}(s’)]$ </p>\n<p>(4)     <code>if</code> $\\pi^*(s)=\\pi(s)$ <code>then</code></p>\n<p>(5)         <code>break</code></p>\n<p>(6)     <code>else</code></p>\n<p>(7)         $\\pi$ = $\\pi^*$</p>\n<p>(8) $V^*$ = $V^\\pi$ . </p>\n<p>In order to make this algorithm model-free, we can do the policy evaluation (line 2) using the methods we mentioned in the last article. Because we are talking about <em>control</em>, so we use state-action value function $Q^\\pi(s,a)$ to substitute $V^\\pi$ in line 2, in a Monte Carlo way. The algorithum of MC for policy Q evaluation is written below: </p>\n<p>Initialize $N(s,a)=0,\\ G(s,a)=0,\\ Q^\\pi(s,a)=0,\\ \\forall s\\in S,\\ a\\in A$</p>\n<p>Using policy $\\pi$ to sample an episode $i=s_{i,1},a_{i,1},r_{i,1},…$ </p>\n<p><code>while</code> each state, action $(s,a)$ visited in episode $i$ <code>do</code></p>\n<p>​     <code>while</code> <strong>first/every time $t$</strong> that the state, action $(s,a)$ is visited in episode $i$ <code>do</code></p>\n<p>​        $N(s,a)=N(s,a)+1$</p>\n<p>​        $G(s,a)=G(s,a)+G_{i,t}$</p>\n<p>​        $Q^{\\pi i}(s,a)=Q^{\\pi i}(s,a)/N(s,a)$ </p>\n<p><code>return</code> $Q^{\\pi i}(s,a)$.</p>\n<p>Thereby, accroding to the definition, we can modify the line 3 directly as: </p>\n<p>$\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)$. </p>\n<p>There are a few caveats to this modified algorithm (MC for policy Q evaluation): </p>\n<ul>\n<li>If policy $\\pi$ is determiniistic or dosen’t take every action with some positive probability, then we cannot actually compute the argmax in line 3</li>\n<li>The policy evaluation algorithm gives us an estimate of $Q^\\pi$, so it is not clear whether (while we want to make sure that) line 3 will monotonically improve the policy like the model-based case.</li>\n</ul>\n<h3 id=\"Importance-of-Exploration\"><a href=\"#Importance-of-Exploration\" class=\"headerlink\" title=\"Importance of Exploration\"></a>Importance of Exploration</h3><p>Please notice the first caveat we just mentioned above, this means, in other words, the policy $\\pi$ needs to explore actions, even if they might be suboptimal with respect to our current Q-value estimates. And this is what we have talked about in the first article: the relationship between exploration and exploitation. Here is a simple way to balance them. </p>\n<h4 id=\"epsilon-greedy-Policies\"><a href=\"#epsilon-greedy-Policies\" class=\"headerlink\" title=\"$\\epsilon$-greedy Policies\"></a>$\\epsilon$-greedy Policies</h4><p>This strategy is to take random action with small probability and take the greedy action the rest of the time. Mathematically, an $\\epsilon$-greedy policy with respect to the state-action value $Q^\\pi(s,a)$ takes the following form: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F6.png\" alt=\"\">.</p>\n<p>It can be summarized as: $\\epsilon$-greedy policy selects a random action with probability $\\epsilon$ or otherwise follows the greedy policy. </p>\n<h4 id=\"Monotonic-epsilon-greedy-Policy-Improvement\"><a href=\"#Monotonic-epsilon-greedy-Policy-Improvement\" class=\"headerlink\" title=\"Monotonic $\\epsilon $-greedy Policy Improvement\"></a>Monotonic $\\epsilon $-greedy Policy Improvement</h4><p>We have already provided a strategy to deal with the first caveat and now we are going to focus on the second one: to prove the monotonic $\\epsilon$-greedy policy improvement. And here is the proof. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F1.jpeg\" alt=\"Monotonic e-greedy Policy Improvement\"></p>\n<p>Now we have that $Q^{\\pi_i}(s,\\pi_{i+1}(s))\\ge V^{\\pi_i}(s)$ implies $V^{\\pi_{i+1}}(s)\\ge V^{\\pi_i}$ for all states, as desired. Thus, the monotonic $\\epsilon $-greedy policy improvement shows us that our policy does in fact improve if we act $\\epsilon$-greedy on the current $\\epsilon$-greedy policy. </p>\n<h4 id=\"Greedy-in-the-Limit-of-Infinite-Exploration-GLIE\"><a href=\"#Greedy-in-the-Limit-of-Infinite-Exploration-GLIE\" class=\"headerlink\" title=\"Greedy in the Limit of Infinite Exploration (GLIE)\"></a>Greedy in the Limit of Infinite Exploration (GLIE)</h4><p>$\\epsilon$-greedy is a naive way to balance exploration and exploitation and we can refine it. The new class of exploration strategies is called <em>Greedy in the Limit of Infinite Exploration</em> (GLIE), which allows us to make convergence guarantees about our algorithms. </p>\n<p>A policy is GLIE if it satisfies the following two properties: </p>\n<ul>\n<li>All state-action pairs are visited an infinite number of times: $\\lim_{i\\rightarrow\\infty}N_i(s,a)\\rightarrow\\infty$ </li>\n<li>Behavior policy converges to greedy policy</li>\n</ul>\n<p>A simple GLIE strategy is $\\epsilon$-greedy policy where $\\epsilon$ is decayed to zero with $\\epsilon_i={1\\over i}$, $i$ is the epsiode number. </p>\n<h3 id=\"Monte-Carlo-Control\"><a href=\"#Monte-Carlo-Control\" class=\"headerlink\" title=\"Monte Carlo Control\"></a>Monte Carlo Control</h3><p>Here is the algorithm of online Monte Carlo control: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F2.png\" alt=\"Online Monte Carlo Control\">. </p>\n<p>The algorithm is first-visit online Monte Carlo control precisely and you can modify it to every-visit online Monte control easily. </p>\n<p>If $\\epsilon$-greedy strategy used in this algorithm is GLIE, then the Q-value derived from the algorithm will converge to the optimal Q-function. </p>\n<h3 id=\"Tempooral-Difference-Methods-for-Control\"><a href=\"#Tempooral-Difference-Methods-for-Control\" class=\"headerlink\" title=\"Tempooral Difference Methods for Control\"></a>Tempooral Difference Methods for Control</h3><p>There are two methods of TD-style model-free control: on-policy and off-policy. We first introduce the on-policy method, called SARSA. </p>\n<h4 id=\"SARSA\"><a href=\"#SARSA\" class=\"headerlink\" title=\"SARSA\"></a>SARSA</h4><p>Here is the algorithm: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F3.jpeg\" alt=\"SARSA\">. </p>\n<p>SARSA stands for <strong>S</strong>tate, <strong>A</strong>ction, <strong>R</strong>eward, next <strong>S</strong>tate, <strong>A</strong>ction taken in next state. Because this algorithm updates the Q-value after it gets the tuple $(s,a,r,s’,a’)$, it is called SARSA. SARSA is an on-policy method because the actions $a$ and $a’$ used in the update equation are both from the policy that is being followed at the time of the update. </p>\n<p>SARSA for finite-state and finite-action MDP’s converges to the optimal action-value if the following conditions hold: </p>\n<ul>\n<li>The sequence of policies $\\pi$ from is GLIE</li>\n<li>The step-sizes $\\alpha_t$ satisfy the <em>Robbins-Munro</em> sequence such that: $\\sum^\\infty_{t=1}\\alpha_t=\\infty,\\ \\sum^\\infty_{t=1}\\alpha_t^2&lt;\\infty$ (although we generally don’t use the step-sizes satisfy this condition in reality). </li>\n</ul>\n<h4 id=\"Q-Learning\"><a href=\"#Q-Learning\" class=\"headerlink\" title=\"Q-Learning\"></a>Q-Learning</h4><p>Here is the algorithm: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg\" alt=\"Q-Learning\">.</p>\n<p>The biggest different between Q-learning and SARSA is that, Q-learning takes a maximum over the actions at the next state, this action is not necessarily the same same as the one we would derive from the current policy. On the contrary, the agent will choose the action that brings the biggest reward directly and this behavior actually updates the policy because, when we adopt $\\epsilon$-greedy we definately introduce Q-value. Q-learning updates the Q-value (policy) after it gets the tuple $(s,a,r,s’)$. And this is why it is called <em>off-policy</em>. </p>\n<p>However, in SARSA, as we stated before, the action $a’$ derives from the current policy that has not been updated. The agent may choose a bad action $a’$ randomly following the $\\epsilon$-greedy policy and this may lower the Q-value of some state-action pairs after the update. This consequently lead to the result that, SARSA might not figure out the optimal trajectory of the agent but the suboptimal one. </p>\n<h4 id=\"Double-Q-Learning\"><a href=\"#Double-Q-Learning\" class=\"headerlink\" title=\"Double Q-Learning\"></a>Double Q-Learning</h4><p>In Q-learning, the state values $V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$ can suffer from maximization bias (bias introduced by the maximization operation) when we have finitely many samples. Our state value estimate is at least as large as the true value of state $s$, so we are systematically overestimating the value of the state. In Q-learning, we can maintain two independent unbiased estimates, $Q_1$ and $Q_2$ and when we use one to select the maximum, we can use the other to get an estimate of the value of this maximum. This is called <em>double Q-learning</em> which is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F5.jpeg\" alt=\"Double Q-Learning\">. </p>\n<p>Double Q-learning can significantly speed up training time by eliminating suboptimal actions more quickly then normal Q-learning. </p>\n","site":{"data":{}},"more":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>In this article we will discuss model-free control where we learn good policies under the same constrains (only interactions, no knowledge of reward structure or transition probabilities). In actual world, many problems can be modeled into a MDP and model-free control is important for some problems in two types of domains: </p>\n<ul>\n<li>MDP model is unknown but we can sample the trajectories from the MDP</li>\n<li>MDP model is known but computing the value function is really really hard due to the size of the domain</li>\n</ul>\n<p>There are two types of policy learning under model-free control domain, which are <em>on-policy learning</em> and <em>off-policy learning</em>. </p>\n<ul>\n<li>On-policy learning: base on direct experience and learn to estimate and evaluate a policy from experience obtained from following that policy</li>\n<li>Off-policy learning: learn to estimate and evaluate a policy using experience gathered from following a different policy</li>\n</ul>\n<h3 id=\"Generalized-Policy-Iteration\"><a href=\"#Generalized-Policy-Iteration\" class=\"headerlink\" title=\"Generalized Policy Iteration\"></a>Generalized Policy Iteration</h3><p>In <em>Summarize of Reinforcement Learning 2</em> we have learned the algorithm of policy iteration, which is: </p>\n<p>(1) <code>while</code> True <code>do</code></p>\n<p>(2)     $V^\\pi$ = Policy evaluation $(M,\\pi,\\epsilon)$ ($\\pi$ is initialized randomly here)</p>\n<p>(3)     $\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)=\\tt argmax\\mit \\ [R(s,a)+\\gamma\\sum_{s’\\in S} P(s’|s,a)V^{\\pi i}(s’)]$ </p>\n<p>(4)     <code>if</code> $\\pi^*(s)=\\pi(s)$ <code>then</code></p>\n<p>(5)         <code>break</code></p>\n<p>(6)     <code>else</code></p>\n<p>(7)         $\\pi$ = $\\pi^*$</p>\n<p>(8) $V^*$ = $V^\\pi$ . </p>\n<p>In order to make this algorithm model-free, we can do the policy evaluation (line 2) using the methods we mentioned in the last article. Because we are talking about <em>control</em>, so we use state-action value function $Q^\\pi(s,a)$ to substitute $V^\\pi$ in line 2, in a Monte Carlo way. The algorithum of MC for policy Q evaluation is written below: </p>\n<p>Initialize $N(s,a)=0,\\ G(s,a)=0,\\ Q^\\pi(s,a)=0,\\ \\forall s\\in S,\\ a\\in A$</p>\n<p>Using policy $\\pi$ to sample an episode $i=s_{i,1},a_{i,1},r_{i,1},…$ </p>\n<p><code>while</code> each state, action $(s,a)$ visited in episode $i$ <code>do</code></p>\n<p>​     <code>while</code> <strong>first/every time $t$</strong> that the state, action $(s,a)$ is visited in episode $i$ <code>do</code></p>\n<p>​        $N(s,a)=N(s,a)+1$</p>\n<p>​        $G(s,a)=G(s,a)+G_{i,t}$</p>\n<p>​        $Q^{\\pi i}(s,a)=Q^{\\pi i}(s,a)/N(s,a)$ </p>\n<p><code>return</code> $Q^{\\pi i}(s,a)$.</p>\n<p>Thereby, accroding to the definition, we can modify the line 3 directly as: </p>\n<p>$\\pi_{i+1}=\\tt argmax\\ \\mit Q_{\\pi i}(s,a)$. </p>\n<p>There are a few caveats to this modified algorithm (MC for policy Q evaluation): </p>\n<ul>\n<li>If policy $\\pi$ is determiniistic or dosen’t take every action with some positive probability, then we cannot actually compute the argmax in line 3</li>\n<li>The policy evaluation algorithm gives us an estimate of $Q^\\pi$, so it is not clear whether (while we want to make sure that) line 3 will monotonically improve the policy like the model-based case.</li>\n</ul>\n<h3 id=\"Importance-of-Exploration\"><a href=\"#Importance-of-Exploration\" class=\"headerlink\" title=\"Importance of Exploration\"></a>Importance of Exploration</h3><p>Please notice the first caveat we just mentioned above, this means, in other words, the policy $\\pi$ needs to explore actions, even if they might be suboptimal with respect to our current Q-value estimates. And this is what we have talked about in the first article: the relationship between exploration and exploitation. Here is a simple way to balance them. </p>\n<h4 id=\"epsilon-greedy-Policies\"><a href=\"#epsilon-greedy-Policies\" class=\"headerlink\" title=\"$\\epsilon$-greedy Policies\"></a>$\\epsilon$-greedy Policies</h4><p>This strategy is to take random action with small probability and take the greedy action the rest of the time. Mathematically, an $\\epsilon$-greedy policy with respect to the state-action value $Q^\\pi(s,a)$ takes the following form: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F6.png\" alt=\"\">.</p>\n<p>It can be summarized as: $\\epsilon$-greedy policy selects a random action with probability $\\epsilon$ or otherwise follows the greedy policy. </p>\n<h4 id=\"Monotonic-epsilon-greedy-Policy-Improvement\"><a href=\"#Monotonic-epsilon-greedy-Policy-Improvement\" class=\"headerlink\" title=\"Monotonic $\\epsilon $-greedy Policy Improvement\"></a>Monotonic $\\epsilon $-greedy Policy Improvement</h4><p>We have already provided a strategy to deal with the first caveat and now we are going to focus on the second one: to prove the monotonic $\\epsilon$-greedy policy improvement. And here is the proof. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F1.jpeg\" alt=\"Monotonic e-greedy Policy Improvement\"></p>\n<p>Now we have that $Q^{\\pi_i}(s,\\pi_{i+1}(s))\\ge V^{\\pi_i}(s)$ implies $V^{\\pi_{i+1}}(s)\\ge V^{\\pi_i}$ for all states, as desired. Thus, the monotonic $\\epsilon $-greedy policy improvement shows us that our policy does in fact improve if we act $\\epsilon$-greedy on the current $\\epsilon$-greedy policy. </p>\n<h4 id=\"Greedy-in-the-Limit-of-Infinite-Exploration-GLIE\"><a href=\"#Greedy-in-the-Limit-of-Infinite-Exploration-GLIE\" class=\"headerlink\" title=\"Greedy in the Limit of Infinite Exploration (GLIE)\"></a>Greedy in the Limit of Infinite Exploration (GLIE)</h4><p>$\\epsilon$-greedy is a naive way to balance exploration and exploitation and we can refine it. The new class of exploration strategies is called <em>Greedy in the Limit of Infinite Exploration</em> (GLIE), which allows us to make convergence guarantees about our algorithms. </p>\n<p>A policy is GLIE if it satisfies the following two properties: </p>\n<ul>\n<li>All state-action pairs are visited an infinite number of times: $\\lim_{i\\rightarrow\\infty}N_i(s,a)\\rightarrow\\infty$ </li>\n<li>Behavior policy converges to greedy policy</li>\n</ul>\n<p>A simple GLIE strategy is $\\epsilon$-greedy policy where $\\epsilon$ is decayed to zero with $\\epsilon_i={1\\over i}$, $i$ is the epsiode number. </p>\n<h3 id=\"Monte-Carlo-Control\"><a href=\"#Monte-Carlo-Control\" class=\"headerlink\" title=\"Monte Carlo Control\"></a>Monte Carlo Control</h3><p>Here is the algorithm of online Monte Carlo control: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F2.png\" alt=\"Online Monte Carlo Control\">. </p>\n<p>The algorithm is first-visit online Monte Carlo control precisely and you can modify it to every-visit online Monte control easily. </p>\n<p>If $\\epsilon$-greedy strategy used in this algorithm is GLIE, then the Q-value derived from the algorithm will converge to the optimal Q-function. </p>\n<h3 id=\"Tempooral-Difference-Methods-for-Control\"><a href=\"#Tempooral-Difference-Methods-for-Control\" class=\"headerlink\" title=\"Tempooral Difference Methods for Control\"></a>Tempooral Difference Methods for Control</h3><p>There are two methods of TD-style model-free control: on-policy and off-policy. We first introduce the on-policy method, called SARSA. </p>\n<h4 id=\"SARSA\"><a href=\"#SARSA\" class=\"headerlink\" title=\"SARSA\"></a>SARSA</h4><p>Here is the algorithm: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F3.jpeg\" alt=\"SARSA\">. </p>\n<p>SARSA stands for <strong>S</strong>tate, <strong>A</strong>ction, <strong>R</strong>eward, next <strong>S</strong>tate, <strong>A</strong>ction taken in next state. Because this algorithm updates the Q-value after it gets the tuple $(s,a,r,s’,a’)$, it is called SARSA. SARSA is an on-policy method because the actions $a$ and $a’$ used in the update equation are both from the policy that is being followed at the time of the update. </p>\n<p>SARSA for finite-state and finite-action MDP’s converges to the optimal action-value if the following conditions hold: </p>\n<ul>\n<li>The sequence of policies $\\pi$ from is GLIE</li>\n<li>The step-sizes $\\alpha_t$ satisfy the <em>Robbins-Munro</em> sequence such that: $\\sum^\\infty_{t=1}\\alpha_t=\\infty,\\ \\sum^\\infty_{t=1}\\alpha_t^2&lt;\\infty$ (although we generally don’t use the step-sizes satisfy this condition in reality). </li>\n</ul>\n<h4 id=\"Q-Learning\"><a href=\"#Q-Learning\" class=\"headerlink\" title=\"Q-Learning\"></a>Q-Learning</h4><p>Here is the algorithm: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F4.jpeg\" alt=\"Q-Learning\">.</p>\n<p>The biggest different between Q-learning and SARSA is that, Q-learning takes a maximum over the actions at the next state, this action is not necessarily the same same as the one we would derive from the current policy. On the contrary, the agent will choose the action that brings the biggest reward directly and this behavior actually updates the policy because, when we adopt $\\epsilon$-greedy we definately introduce Q-value. Q-learning updates the Q-value (policy) after it gets the tuple $(s,a,r,s’)$. And this is why it is called <em>off-policy</em>. </p>\n<p>However, in SARSA, as we stated before, the action $a’$ derives from the current policy that has not been updated. The agent may choose a bad action $a’$ randomly following the $\\epsilon$-greedy policy and this may lower the Q-value of some state-action pairs after the update. This consequently lead to the result that, SARSA might not figure out the optimal trajectory of the agent but the suboptimal one. </p>\n<h4 id=\"Double-Q-Learning\"><a href=\"#Double-Q-Learning\" class=\"headerlink\" title=\"Double Q-Learning\"></a>Double Q-Learning</h4><p>In Q-learning, the state values $V^\\pi(s)=\\sum_{a\\in A}\\pi(a|s)Q_\\pi(s,a)$ can suffer from maximization bias (bias introduced by the maximization operation) when we have finitely many samples. Our state value estimate is at least as large as the true value of state $s$, so we are systematically overestimating the value of the state. In Q-learning, we can maintain two independent unbiased estimates, $Q_1$ and $Q_2$ and when we use one to select the maximum, we can use the other to get an estimate of the value of this maximum. This is called <em>double Q-learning</em> which is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS4F5.jpeg\" alt=\"Double Q-Learning\">. </p>\n<p>Double Q-learning can significantly speed up training time by eliminating suboptimal actions more quickly then normal Q-learning. </p>\n"},{"title":"Summary of Reinforcement Learning 5","date":"2020-02-19T11:39:00.000Z","cover":"https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg","thumbnail":"https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg","excerpt":"Value function approximation, a new way to get the value function.","_content":"\n### Introduction\n\nSo far we have presented value function by a lookup table (vector or matrix). However, this approach might not generalize or sufficient well to problems with very large state and/or action spaces in reality. \n\nA popular approach to address this problem via function approximation: $v_\\pi(s)\\approx \\hat v(s,\\vec w)$ or $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. Here $\\vec w$ is usually referred to as the parameter or weights of our function approximator. Our target is to output a reasonable value function (it can also be called as *update target* in this domain) by calculating the proper $\\vec w$ with the input $s$ or $(s,a)$.\n\nIn this set of article, we will explore two popular classes of differentiable function approximators: *Linear feature representations* and *Nerual networks*. We will only focus on linear feature representations in this article. \n\n### Linear Feature Representations\n\n#### Gradient Descent\n\nThe rough definition of *gradient* is that, for a function that has several variables, gradient (a vector) at a spot $x_0$ tells us the direction of the steepest increase in the objective function at $x_0$. Suppose that $J(\\vec w)$ is an arbitrary function and vector $\\vec w$ is its parameter, the gradient of it at some initial spot $\\vec w$ is: \n\n$\\nabla_\\vec wJ(\\vec w)=[{\\partial J(\\vec w)\\over\\partial w_1}{\\partial J(\\vec w)\\over\\partial w_2}...{\\partial J(\\vec w)\\over\\partial w_n}]$. \n\nIn oreder to minimize our objective function, we take a step along the negative direction of the gradient vector and arrive at $\\vec w'$, mathematically written as: \n\n$\\Delta\\vec w=-{1\\over 2}\\alpha \\nabla_\\vec wJ(\\vec w)$, $\\vec w'=\\vec w+\\Delta \\vec w$ ($\\alpha$ is update step). \n\nBy using this way for many times we can reach the point that our objective function is minimize (local optima). \n\nFigure 1 is the visualization of gradient descent. \n\n![Figure 1](https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg)\n\n####Stochastic Gradient Descent (SGD)\n\nIn linear function representations, we use a feature vector to represent a state: \n\n$\\vec x(s)=[x_1(s)\\ x_2(s)\\ ...\\ x_n(s)]$. \n\nWe than approximate our value functions using a linear combination of features: \n\n$\\hat v(s,\\vec w)=\\vec x(s)\\vec w=\\sum_{j=1}^nx_j(s)w_j$. \n\nOur goal is to find the $\\vec w$ that minimizes the loss between a true value function $v_\\pi(s)$ and its approximation $\\hat v(s,\\vec w)$. So now we define the objective function (also known as the loss function) to be: \n\n$J(\\vec w)=\\Bbb E[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$. \n\nThen we can use gradient descent to calculate $\\vec w'$ ($w$ at next time step): \n\n$\\vec w'=\\vec w-{1\\over2}\\alpha\\nabla_\\vec w[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$\n\n​    $=\\vec w+\\alpha[v_\\pi(s)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$. \n\nHowever, it is impossible for us to know the true value of $v_\\pi(s)$ in real world. So we will then talk about how to do value function approximation without a model, or, in other words, find something to replace the true value to make this idea practicable. \n\n#### Monte Carlo with Linear Value Function Approximation (VFA)\n\nAs we know, the return $G$ is an unbiased sample of $v_\\pi(s)$ with some noise. So if we substituted $G$ for $v_\\pi(s)$, we have: \n\n$\\vec w'=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ \n\n​    $=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\vec x(s)$. \n\nTha algorithm of Monte Carlo linear value function approximation is shown below: \n\n![](https://astrobear.top/resource/astroblog/content/RLS5F2.jpeg). \n\nThis algorithm can also be modified into a every-visit type. Once we have $\\vec w'$ we can calculate the approximation of the value function $\\hat v(s,\\vec w)$ by $\\vec x(s)^T\\vec w'$. \n\n#### Temporal Difference with Linear VFA\n\nIn TD learning we use $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ to update $V^\\pi$. To apply this method to VFA, we can rewrite the expression of $\\vec w$ as: \n\n$\\vec w'=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s',\\vec w)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ \n\n​    $=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s',\\vec w)-\\hat v(s,\\vec w)]\\vec x(s)$. \n\nThe algorithm of TD(0) with linear VFA is shown below: \n\n![](https://astrobear.top/resource/astroblog/content/RLS5F3.png).\n\nThe two algorithm we introduced above can both converge to the weights $\\vec w$ with different minimum mean squared error (MSE). Among them the MSE of TD method is slightly greater than the MC one, but it is good engouh. \n\n#### Control Using VFA\n\nSimilar to VFAs, we can also use function approximator for action-values and we let $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. In this part we will use VFA to approximate policy evaluation and than perform $\\epsilon$-greedy policy improvement. However, this process can be unstable because it involes the intersection of function approximation, bootstrapping, and off-policy learning. These three things are called as *the dadely triad*, which may make the result fail to converge or converge to something bad. Now I will quickly pass this part using the basic concept we have mentioned before. \n\nFirst we define our objective function $J(\\vec w)$ as: \n\n$J(\\vec w)=\\Bbb E[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))^2]$. \n\nThen we define the state-action value feature vector: \n\n$\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ ...\\ x_n(s,a)]$, \n\nand represent state-action value as linear combinations of features: \n\n$\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. \n\nCompute the gradient: \n\n$-{1\\over 2}\\nabla_\\vec wJ(\\vec w)=\\Bbb E_\\pi[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\nabla_\\vec w\\hat q^\\pi(s,a,\\vec w)]$\n\n​                      $=(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\vec x(s,a)$. \n\nCompute an update step using gradient descent:\n\n$\\Delta\\vec w=-{1\\over 2}\\alpha\\nabla_\\vec wJ(\\vec w)$\n\n​       $=\\alpha(q_\\pi(s,a)-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. \n\nTake a step towards the local minimum: \n\n$\\vec w'=\\vec w+ \\Delta\\vec w$.  \n\nJust like what we have said before, we cannot get the true value of $q_\\pi(s,a)$ so we gonna use other values to replace it and the difference between those methods is the difference of the value we choose. \n\nFor Monte Carlo methods, we use return $G$, and the update becomes: \n\n$\\Delta\\vec w=\\alpha(G-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. \n\nFor SARSA we have: \n\n$\\Delta\\vec w=\\alpha[r+\\gamma \\hat q^\\pi(s',a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. \n\nAnd for Q-learning: \n\n$\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a'}\\mit\\hat q^\\pi(s',a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. \n\nNotice that because of the value function approximations, which can be expansions, converge is not guaranteed. The table below gives the summary of convergence of control methods with VFA and `(Yes)` means the result chatters around near-optimal value function.\n\n| Algorithm  | Tabular | Linear VFA | Nonlinear VFA |\n| ---------- | ------- | ---------- | ------------- |\n| MC Control | Yes     | (Yes)      | No            |\n| SARSA      | Yes     | (Yes)      | No            |\n| Q-learning | Yes     | No         | No            |\n\nIn the next article we will talk about deep reinforcement learning using nerual networks. ","source":"_posts/RLSummary5.md","raw":"---\ntitle: Summary of Reinforcement Learning 5\ndate: 2020-2-19 19:39:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- RL\n\t- Research\n\t- Python\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg\n\nthumbnail: https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: Value function approximation, a new way to get the value function. \n\n#You can begin to input your article below now.\n\n---\n\n### Introduction\n\nSo far we have presented value function by a lookup table (vector or matrix). However, this approach might not generalize or sufficient well to problems with very large state and/or action spaces in reality. \n\nA popular approach to address this problem via function approximation: $v_\\pi(s)\\approx \\hat v(s,\\vec w)$ or $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. Here $\\vec w$ is usually referred to as the parameter or weights of our function approximator. Our target is to output a reasonable value function (it can also be called as *update target* in this domain) by calculating the proper $\\vec w$ with the input $s$ or $(s,a)$.\n\nIn this set of article, we will explore two popular classes of differentiable function approximators: *Linear feature representations* and *Nerual networks*. We will only focus on linear feature representations in this article. \n\n### Linear Feature Representations\n\n#### Gradient Descent\n\nThe rough definition of *gradient* is that, for a function that has several variables, gradient (a vector) at a spot $x_0$ tells us the direction of the steepest increase in the objective function at $x_0$. Suppose that $J(\\vec w)$ is an arbitrary function and vector $\\vec w$ is its parameter, the gradient of it at some initial spot $\\vec w$ is: \n\n$\\nabla_\\vec wJ(\\vec w)=[{\\partial J(\\vec w)\\over\\partial w_1}{\\partial J(\\vec w)\\over\\partial w_2}...{\\partial J(\\vec w)\\over\\partial w_n}]$. \n\nIn oreder to minimize our objective function, we take a step along the negative direction of the gradient vector and arrive at $\\vec w'$, mathematically written as: \n\n$\\Delta\\vec w=-{1\\over 2}\\alpha \\nabla_\\vec wJ(\\vec w)$, $\\vec w'=\\vec w+\\Delta \\vec w$ ($\\alpha$ is update step). \n\nBy using this way for many times we can reach the point that our objective function is minimize (local optima). \n\nFigure 1 is the visualization of gradient descent. \n\n![Figure 1](https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg)\n\n####Stochastic Gradient Descent (SGD)\n\nIn linear function representations, we use a feature vector to represent a state: \n\n$\\vec x(s)=[x_1(s)\\ x_2(s)\\ ...\\ x_n(s)]$. \n\nWe than approximate our value functions using a linear combination of features: \n\n$\\hat v(s,\\vec w)=\\vec x(s)\\vec w=\\sum_{j=1}^nx_j(s)w_j$. \n\nOur goal is to find the $\\vec w$ that minimizes the loss between a true value function $v_\\pi(s)$ and its approximation $\\hat v(s,\\vec w)$. So now we define the objective function (also known as the loss function) to be: \n\n$J(\\vec w)=\\Bbb E[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$. \n\nThen we can use gradient descent to calculate $\\vec w'$ ($w$ at next time step): \n\n$\\vec w'=\\vec w-{1\\over2}\\alpha\\nabla_\\vec w[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$\n\n​    $=\\vec w+\\alpha[v_\\pi(s)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$. \n\nHowever, it is impossible for us to know the true value of $v_\\pi(s)$ in real world. So we will then talk about how to do value function approximation without a model, or, in other words, find something to replace the true value to make this idea practicable. \n\n#### Monte Carlo with Linear Value Function Approximation (VFA)\n\nAs we know, the return $G$ is an unbiased sample of $v_\\pi(s)$ with some noise. So if we substituted $G$ for $v_\\pi(s)$, we have: \n\n$\\vec w'=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ \n\n​    $=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\vec x(s)$. \n\nTha algorithm of Monte Carlo linear value function approximation is shown below: \n\n![](https://astrobear.top/resource/astroblog/content/RLS5F2.jpeg). \n\nThis algorithm can also be modified into a every-visit type. Once we have $\\vec w'$ we can calculate the approximation of the value function $\\hat v(s,\\vec w)$ by $\\vec x(s)^T\\vec w'$. \n\n#### Temporal Difference with Linear VFA\n\nIn TD learning we use $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ to update $V^\\pi$. To apply this method to VFA, we can rewrite the expression of $\\vec w$ as: \n\n$\\vec w'=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s',\\vec w)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ \n\n​    $=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s',\\vec w)-\\hat v(s,\\vec w)]\\vec x(s)$. \n\nThe algorithm of TD(0) with linear VFA is shown below: \n\n![](https://astrobear.top/resource/astroblog/content/RLS5F3.png).\n\nThe two algorithm we introduced above can both converge to the weights $\\vec w$ with different minimum mean squared error (MSE). Among them the MSE of TD method is slightly greater than the MC one, but it is good engouh. \n\n#### Control Using VFA\n\nSimilar to VFAs, we can also use function approximator for action-values and we let $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. In this part we will use VFA to approximate policy evaluation and than perform $\\epsilon$-greedy policy improvement. However, this process can be unstable because it involes the intersection of function approximation, bootstrapping, and off-policy learning. These three things are called as *the dadely triad*, which may make the result fail to converge or converge to something bad. Now I will quickly pass this part using the basic concept we have mentioned before. \n\nFirst we define our objective function $J(\\vec w)$ as: \n\n$J(\\vec w)=\\Bbb E[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))^2]$. \n\nThen we define the state-action value feature vector: \n\n$\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ ...\\ x_n(s,a)]$, \n\nand represent state-action value as linear combinations of features: \n\n$\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. \n\nCompute the gradient: \n\n$-{1\\over 2}\\nabla_\\vec wJ(\\vec w)=\\Bbb E_\\pi[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\nabla_\\vec w\\hat q^\\pi(s,a,\\vec w)]$\n\n​                      $=(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\vec x(s,a)$. \n\nCompute an update step using gradient descent:\n\n$\\Delta\\vec w=-{1\\over 2}\\alpha\\nabla_\\vec wJ(\\vec w)$\n\n​       $=\\alpha(q_\\pi(s,a)-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. \n\nTake a step towards the local minimum: \n\n$\\vec w'=\\vec w+ \\Delta\\vec w$.  \n\nJust like what we have said before, we cannot get the true value of $q_\\pi(s,a)$ so we gonna use other values to replace it and the difference between those methods is the difference of the value we choose. \n\nFor Monte Carlo methods, we use return $G$, and the update becomes: \n\n$\\Delta\\vec w=\\alpha(G-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. \n\nFor SARSA we have: \n\n$\\Delta\\vec w=\\alpha[r+\\gamma \\hat q^\\pi(s',a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. \n\nAnd for Q-learning: \n\n$\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a'}\\mit\\hat q^\\pi(s',a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. \n\nNotice that because of the value function approximations, which can be expansions, converge is not guaranteed. The table below gives the summary of convergence of control methods with VFA and `(Yes)` means the result chatters around near-optimal value function.\n\n| Algorithm  | Tabular | Linear VFA | Nonlinear VFA |\n| ---------- | ------- | ---------- | ------------- |\n| MC Control | Yes     | (Yes)      | No            |\n| SARSA      | Yes     | (Yes)      | No            |\n| Q-learning | Yes     | No         | No            |\n\nIn the next article we will talk about deep reinforcement learning using nerual networks. ","slug":"RLSummary5","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz02000v1q39e4fzc75g","content":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>So far we have presented value function by a lookup table (vector or matrix). However, this approach might not generalize or sufficient well to problems with very large state and/or action spaces in reality. </p>\n<p>A popular approach to address this problem via function approximation: $v_\\pi(s)\\approx \\hat v(s,\\vec w)$ or $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. Here $\\vec w$ is usually referred to as the parameter or weights of our function approximator. Our target is to output a reasonable value function (it can also be called as <em>update target</em> in this domain) by calculating the proper $\\vec w$ with the input $s$ or $(s,a)$.</p>\n<p>In this set of article, we will explore two popular classes of differentiable function approximators: <em>Linear feature representations</em> and <em>Nerual networks</em>. We will only focus on linear feature representations in this article. </p>\n<h3 id=\"Linear-Feature-Representations\"><a href=\"#Linear-Feature-Representations\" class=\"headerlink\" title=\"Linear Feature Representations\"></a>Linear Feature Representations</h3><h4 id=\"Gradient-Descent\"><a href=\"#Gradient-Descent\" class=\"headerlink\" title=\"Gradient Descent\"></a>Gradient Descent</h4><p>The rough definition of <em>gradient</em> is that, for a function that has several variables, gradient (a vector) at a spot $x_0$ tells us the direction of the steepest increase in the objective function at $x_0$. Suppose that $J(\\vec w)$ is an arbitrary function and vector $\\vec w$ is its parameter, the gradient of it at some initial spot $\\vec w$ is: </p>\n<p>$\\nabla_\\vec wJ(\\vec w)=[{\\partial J(\\vec w)\\over\\partial w_1}{\\partial J(\\vec w)\\over\\partial w_2}…{\\partial J(\\vec w)\\over\\partial w_n}]$. </p>\n<p>In oreder to minimize our objective function, we take a step along the negative direction of the gradient vector and arrive at $\\vec w’$, mathematically written as: </p>\n<p>$\\Delta\\vec w=-{1\\over 2}\\alpha \\nabla_\\vec wJ(\\vec w)$, $\\vec w’=\\vec w+\\Delta \\vec w$ ($\\alpha$ is update step). </p>\n<p>By using this way for many times we can reach the point that our objective function is minimize (local optima). </p>\n<p>Figure 1 is the visualization of gradient descent. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg\" alt=\"Figure 1\"></p>\n<p>####Stochastic Gradient Descent (SGD)</p>\n<p>In linear function representations, we use a feature vector to represent a state: </p>\n<p>$\\vec x(s)=[x_1(s)\\ x_2(s)\\ …\\ x_n(s)]$. </p>\n<p>We than approximate our value functions using a linear combination of features: </p>\n<p>$\\hat v(s,\\vec w)=\\vec x(s)\\vec w=\\sum_{j=1}^nx_j(s)w_j$. </p>\n<p>Our goal is to find the $\\vec w$ that minimizes the loss between a true value function $v_\\pi(s)$ and its approximation $\\hat v(s,\\vec w)$. So now we define the objective function (also known as the loss function) to be: </p>\n<p>$J(\\vec w)=\\Bbb E[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$. </p>\n<p>Then we can use gradient descent to calculate $\\vec w’$ ($w$ at next time step): </p>\n<p>$\\vec w’=\\vec w-{1\\over2}\\alpha\\nabla_\\vec w[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$</p>\n<p>​    $=\\vec w+\\alpha[v_\\pi(s)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$. </p>\n<p>However, it is impossible for us to know the true value of $v_\\pi(s)$ in real world. So we will then talk about how to do value function approximation without a model, or, in other words, find something to replace the true value to make this idea practicable. </p>\n<h4 id=\"Monte-Carlo-with-Linear-Value-Function-Approximation-VFA\"><a href=\"#Monte-Carlo-with-Linear-Value-Function-Approximation-VFA\" class=\"headerlink\" title=\"Monte Carlo with Linear Value Function Approximation (VFA)\"></a>Monte Carlo with Linear Value Function Approximation (VFA)</h4><p>As we know, the return $G$ is an unbiased sample of $v_\\pi(s)$ with some noise. So if we substituted $G$ for $v_\\pi(s)$, we have: </p>\n<p>$\\vec w’=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ </p>\n<p>​    $=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\vec x(s)$. </p>\n<p>Tha algorithm of Monte Carlo linear value function approximation is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS5F2.jpeg\" alt=\"\">. </p>\n<p>This algorithm can also be modified into a every-visit type. Once we have $\\vec w’$ we can calculate the approximation of the value function $\\hat v(s,\\vec w)$ by $\\vec x(s)^T\\vec w’$. </p>\n<h4 id=\"Temporal-Difference-with-Linear-VFA\"><a href=\"#Temporal-Difference-with-Linear-VFA\" class=\"headerlink\" title=\"Temporal Difference with Linear VFA\"></a>Temporal Difference with Linear VFA</h4><p>In TD learning we use $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ to update $V^\\pi$. To apply this method to VFA, we can rewrite the expression of $\\vec w$ as: </p>\n<p>$\\vec w’=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s’,\\vec w)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ </p>\n<p>​    $=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s’,\\vec w)-\\hat v(s,\\vec w)]\\vec x(s)$. </p>\n<p>The algorithm of TD(0) with linear VFA is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS5F3.png\" alt=\"\">.</p>\n<p>The two algorithm we introduced above can both converge to the weights $\\vec w$ with different minimum mean squared error (MSE). Among them the MSE of TD method is slightly greater than the MC one, but it is good engouh. </p>\n<h4 id=\"Control-Using-VFA\"><a href=\"#Control-Using-VFA\" class=\"headerlink\" title=\"Control Using VFA\"></a>Control Using VFA</h4><p>Similar to VFAs, we can also use function approximator for action-values and we let $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. In this part we will use VFA to approximate policy evaluation and than perform $\\epsilon$-greedy policy improvement. However, this process can be unstable because it involes the intersection of function approximation, bootstrapping, and off-policy learning. These three things are called as <em>the dadely triad</em>, which may make the result fail to converge or converge to something bad. Now I will quickly pass this part using the basic concept we have mentioned before. </p>\n<p>First we define our objective function $J(\\vec w)$ as: </p>\n<p>$J(\\vec w)=\\Bbb E[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))^2]$. </p>\n<p>Then we define the state-action value feature vector: </p>\n<p>$\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ …\\ x_n(s,a)]$, </p>\n<p>and represent state-action value as linear combinations of features: </p>\n<p>$\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. </p>\n<p>Compute the gradient: </p>\n<p>$-{1\\over 2}\\nabla_\\vec wJ(\\vec w)=\\Bbb E_\\pi[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\nabla_\\vec w\\hat q^\\pi(s,a,\\vec w)]$</p>\n<p>​                      $=(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\vec x(s,a)$. </p>\n<p>Compute an update step using gradient descent:</p>\n<p>$\\Delta\\vec w=-{1\\over 2}\\alpha\\nabla_\\vec wJ(\\vec w)$</p>\n<p>​       $=\\alpha(q_\\pi(s,a)-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. </p>\n<p>Take a step towards the local minimum: </p>\n<p>$\\vec w’=\\vec w+ \\Delta\\vec w$.  </p>\n<p>Just like what we have said before, we cannot get the true value of $q_\\pi(s,a)$ so we gonna use other values to replace it and the difference between those methods is the difference of the value we choose. </p>\n<p>For Monte Carlo methods, we use return $G$, and the update becomes: </p>\n<p>$\\Delta\\vec w=\\alpha(G-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. </p>\n<p>For SARSA we have: </p>\n<p>$\\Delta\\vec w=\\alpha[r+\\gamma \\hat q^\\pi(s’,a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. </p>\n<p>And for Q-learning: </p>\n<p>$\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a’}\\mit\\hat q^\\pi(s’,a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. </p>\n<p>Notice that because of the value function approximations, which can be expansions, converge is not guaranteed. The table below gives the summary of convergence of control methods with VFA and <code>(Yes)</code> means the result chatters around near-optimal value function.</p>\n<table>\n<thead>\n<tr>\n<th>Algorithm</th>\n<th>Tabular</th>\n<th>Linear VFA</th>\n<th>Nonlinear VFA</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>MC Control</td>\n<td>Yes</td>\n<td>(Yes)</td>\n<td>No</td>\n</tr>\n<tr>\n<td>SARSA</td>\n<td>Yes</td>\n<td>(Yes)</td>\n<td>No</td>\n</tr>\n<tr>\n<td>Q-learning</td>\n<td>Yes</td>\n<td>No</td>\n<td>No</td>\n</tr>\n</tbody></table>\n<p>In the next article we will talk about deep reinforcement learning using nerual networks. </p>\n","site":{"data":{}},"more":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>So far we have presented value function by a lookup table (vector or matrix). However, this approach might not generalize or sufficient well to problems with very large state and/or action spaces in reality. </p>\n<p>A popular approach to address this problem via function approximation: $v_\\pi(s)\\approx \\hat v(s,\\vec w)$ or $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. Here $\\vec w$ is usually referred to as the parameter or weights of our function approximator. Our target is to output a reasonable value function (it can also be called as <em>update target</em> in this domain) by calculating the proper $\\vec w$ with the input $s$ or $(s,a)$.</p>\n<p>In this set of article, we will explore two popular classes of differentiable function approximators: <em>Linear feature representations</em> and <em>Nerual networks</em>. We will only focus on linear feature representations in this article. </p>\n<h3 id=\"Linear-Feature-Representations\"><a href=\"#Linear-Feature-Representations\" class=\"headerlink\" title=\"Linear Feature Representations\"></a>Linear Feature Representations</h3><h4 id=\"Gradient-Descent\"><a href=\"#Gradient-Descent\" class=\"headerlink\" title=\"Gradient Descent\"></a>Gradient Descent</h4><p>The rough definition of <em>gradient</em> is that, for a function that has several variables, gradient (a vector) at a spot $x_0$ tells us the direction of the steepest increase in the objective function at $x_0$. Suppose that $J(\\vec w)$ is an arbitrary function and vector $\\vec w$ is its parameter, the gradient of it at some initial spot $\\vec w$ is: </p>\n<p>$\\nabla_\\vec wJ(\\vec w)=[{\\partial J(\\vec w)\\over\\partial w_1}{\\partial J(\\vec w)\\over\\partial w_2}…{\\partial J(\\vec w)\\over\\partial w_n}]$. </p>\n<p>In oreder to minimize our objective function, we take a step along the negative direction of the gradient vector and arrive at $\\vec w’$, mathematically written as: </p>\n<p>$\\Delta\\vec w=-{1\\over 2}\\alpha \\nabla_\\vec wJ(\\vec w)$, $\\vec w’=\\vec w+\\Delta \\vec w$ ($\\alpha$ is update step). </p>\n<p>By using this way for many times we can reach the point that our objective function is minimize (local optima). </p>\n<p>Figure 1 is the visualization of gradient descent. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS5F1.jpeg\" alt=\"Figure 1\"></p>\n<p>####Stochastic Gradient Descent (SGD)</p>\n<p>In linear function representations, we use a feature vector to represent a state: </p>\n<p>$\\vec x(s)=[x_1(s)\\ x_2(s)\\ …\\ x_n(s)]$. </p>\n<p>We than approximate our value functions using a linear combination of features: </p>\n<p>$\\hat v(s,\\vec w)=\\vec x(s)\\vec w=\\sum_{j=1}^nx_j(s)w_j$. </p>\n<p>Our goal is to find the $\\vec w$ that minimizes the loss between a true value function $v_\\pi(s)$ and its approximation $\\hat v(s,\\vec w)$. So now we define the objective function (also known as the loss function) to be: </p>\n<p>$J(\\vec w)=\\Bbb E[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$. </p>\n<p>Then we can use gradient descent to calculate $\\vec w’$ ($w$ at next time step): </p>\n<p>$\\vec w’=\\vec w-{1\\over2}\\alpha\\nabla_\\vec w[(v_\\pi(s)-\\hat v(s,\\vec w))^2]$</p>\n<p>​    $=\\vec w+\\alpha[v_\\pi(s)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$. </p>\n<p>However, it is impossible for us to know the true value of $v_\\pi(s)$ in real world. So we will then talk about how to do value function approximation without a model, or, in other words, find something to replace the true value to make this idea practicable. </p>\n<h4 id=\"Monte-Carlo-with-Linear-Value-Function-Approximation-VFA\"><a href=\"#Monte-Carlo-with-Linear-Value-Function-Approximation-VFA\" class=\"headerlink\" title=\"Monte Carlo with Linear Value Function Approximation (VFA)\"></a>Monte Carlo with Linear Value Function Approximation (VFA)</h4><p>As we know, the return $G$ is an unbiased sample of $v_\\pi(s)$ with some noise. So if we substituted $G$ for $v_\\pi(s)$, we have: </p>\n<p>$\\vec w’=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ </p>\n<p>​    $=\\vec w+\\alpha[G-\\hat v(s,\\vec w)]\\vec x(s)$. </p>\n<p>Tha algorithm of Monte Carlo linear value function approximation is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS5F2.jpeg\" alt=\"\">. </p>\n<p>This algorithm can also be modified into a every-visit type. Once we have $\\vec w’$ we can calculate the approximation of the value function $\\hat v(s,\\vec w)$ by $\\vec x(s)^T\\vec w’$. </p>\n<h4 id=\"Temporal-Difference-with-Linear-VFA\"><a href=\"#Temporal-Difference-with-Linear-VFA\" class=\"headerlink\" title=\"Temporal Difference with Linear VFA\"></a>Temporal Difference with Linear VFA</h4><p>In TD learning we use $V^\\pi(s_t)=V^\\pi(s_t)+\\alpha(r_t+\\gamma V^\\pi(s_{t+1})-V^\\pi(s_t))$ to update $V^\\pi$. To apply this method to VFA, we can rewrite the expression of $\\vec w$ as: </p>\n<p>$\\vec w’=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s’,\\vec w)-\\hat v(s,\\vec w)]\\nabla_\\vec w\\hat v(s,\\vec w)$ </p>\n<p>​    $=\\vec w+\\alpha[r+\\gamma \\hat v^\\pi(s’,\\vec w)-\\hat v(s,\\vec w)]\\vec x(s)$. </p>\n<p>The algorithm of TD(0) with linear VFA is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS5F3.png\" alt=\"\">.</p>\n<p>The two algorithm we introduced above can both converge to the weights $\\vec w$ with different minimum mean squared error (MSE). Among them the MSE of TD method is slightly greater than the MC one, but it is good engouh. </p>\n<h4 id=\"Control-Using-VFA\"><a href=\"#Control-Using-VFA\" class=\"headerlink\" title=\"Control Using VFA\"></a>Control Using VFA</h4><p>Similar to VFAs, we can also use function approximator for action-values and we let $q_\\pi(s,a)\\approx\\hat q(s,a,\\vec w)$. In this part we will use VFA to approximate policy evaluation and than perform $\\epsilon$-greedy policy improvement. However, this process can be unstable because it involes the intersection of function approximation, bootstrapping, and off-policy learning. These three things are called as <em>the dadely triad</em>, which may make the result fail to converge or converge to something bad. Now I will quickly pass this part using the basic concept we have mentioned before. </p>\n<p>First we define our objective function $J(\\vec w)$ as: </p>\n<p>$J(\\vec w)=\\Bbb E[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))^2]$. </p>\n<p>Then we define the state-action value feature vector: </p>\n<p>$\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ …\\ x_n(s,a)]$, </p>\n<p>and represent state-action value as linear combinations of features: </p>\n<p>$\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. </p>\n<p>Compute the gradient: </p>\n<p>$-{1\\over 2}\\nabla_\\vec wJ(\\vec w)=\\Bbb E_\\pi[(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\nabla_\\vec w\\hat q^\\pi(s,a,\\vec w)]$</p>\n<p>​                      $=(q_\\pi(s,a)-\\hat q^\\pi(s,a,\\vec w))\\vec x(s,a)$. </p>\n<p>Compute an update step using gradient descent:</p>\n<p>$\\Delta\\vec w=-{1\\over 2}\\alpha\\nabla_\\vec wJ(\\vec w)$</p>\n<p>​       $=\\alpha(q_\\pi(s,a)-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. </p>\n<p>Take a step towards the local minimum: </p>\n<p>$\\vec w’=\\vec w+ \\Delta\\vec w$.  </p>\n<p>Just like what we have said before, we cannot get the true value of $q_\\pi(s,a)$ so we gonna use other values to replace it and the difference between those methods is the difference of the value we choose. </p>\n<p>For Monte Carlo methods, we use return $G$, and the update becomes: </p>\n<p>$\\Delta\\vec w=\\alpha(G-\\hat q_\\pi(s,a,\\vec w))\\vec x(s,a)$. </p>\n<p>For SARSA we have: </p>\n<p>$\\Delta\\vec w=\\alpha[r+\\gamma \\hat q^\\pi(s’,a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. </p>\n<p>And for Q-learning: </p>\n<p>$\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a’}\\mit\\hat q^\\pi(s’,a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. </p>\n<p>Notice that because of the value function approximations, which can be expansions, converge is not guaranteed. The table below gives the summary of convergence of control methods with VFA and <code>(Yes)</code> means the result chatters around near-optimal value function.</p>\n<table>\n<thead>\n<tr>\n<th>Algorithm</th>\n<th>Tabular</th>\n<th>Linear VFA</th>\n<th>Nonlinear VFA</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>MC Control</td>\n<td>Yes</td>\n<td>(Yes)</td>\n<td>No</td>\n</tr>\n<tr>\n<td>SARSA</td>\n<td>Yes</td>\n<td>(Yes)</td>\n<td>No</td>\n</tr>\n<tr>\n<td>Q-learning</td>\n<td>Yes</td>\n<td>No</td>\n<td>No</td>\n</tr>\n</tbody></table>\n<p>In the next article we will talk about deep reinforcement learning using nerual networks. </p>\n"},{"title":"Summary of Reinforcement Learning 6","date":"2020-02-23T02:17:00.000Z","cover":"https://pic4.zhimg.com/v2-e7dd00d7fda722d5f8f70a9928e95a17_r.jpg","thumbnail":"https://pic4.zhimg.com/v2-e7dd00d7fda722d5f8f70a9928e95a17_r.jpg","excerpt":"Introduction to deep reinforcement learning.","_content":"\n### Introduction\n\nIn the last article we briefly talked about control using linear vlaue function approximation and three different methods. For example in Q-learning, we have: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a'}\\mit\\hat q^\\pi(s',a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. \n\nThen we can take calcullate the weight: $\\vec w'=\\vec w+\\Delta\\vec w$. \n\nFinally we can compute the function approximator: $\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. \n\nThe performance of linear function approximators highly depends on the quality of features ($\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ ...\\ x_n(s,a)]$) and it is difficult and time-consuming for us to handcraft an appropriate set of features. To scale up to making decisions in really large domains and enable automatic feature extraction, deep neural networks (DNNs) are used as function approximators. \n\nIn the following contents, we will introduce how to approximate $\\hat q^\\pi(s',a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$ via end-to-end training. And we will introduce three popular value-based deep reinforcement learning algorithms: Deep Q-Network (DQN), Double DQN and Dueling DQN. \n\nIt is OK for a deep-learning freshman to study deep reinforcement learning and one doesn't need to expert in deep learning. He/She just need some basic concepts of deep learning which we will discuss next. \n\n### Deep Neural Network (DNN)\n\nDNN is the composition of miltiple functions. Assuming that $\\vec x$ is the input and $\\vec y$ is the output, a simple DNN can be written as: \n\n$\\vec y=h_n(h_{n-1}(...h_1(\\vec x)...))$, \n\nWhere $h$ are different functions. These functions can be linear or non-linear. For linear functions, $h_n=w_n h_{n-1}+b_n$, $w_n$ is weight and $b_n$ is bias. For non-linear functions, $h_n=f_n(h_{n-1})$. The $f_n$ here is called as *activation function*, such as *sigmoid function* or *relu function*. The purpose of setting activation function is to make the nerual network more like the human nerual system. \n\nIf all the functions are differentiable, we can use chain rule to back propagate the gradient of $\\vec y$. Now we have some tools such as Tensorflow or Pytorch to help us compute the gradient automatically. Typically we need a loss function to fit the parameters. \n\nIn DNN (as well as CNN) we update weights and biases to get the desired output. In deep Q-learning, the outputs are always some scalers, in other words, Q-value. \n\nFigure 1 shows the structure of a nerual network that is relatively complex. The  important components of one of the routes is marked. Figure 2 shows the detailed structure of a node. \n\n![Figure 1](https://astrobear.top/resource/astroblog/content/RLS6F1.jpeg)\n\n![Figure 2](https://astrobear.top/resource/astroblog/content/RLS6F2.png)\n\n#### Benefits\n\n- Uses distributed representations instead of local representations\n- Universal function approximator\n- Can potentially need exponentially less nodes/parameters to represent the same function\n- Can learn the parameters using SGD\n\n### Convolutional Nerual Network (CNN)\n\nCNN is widely used in computer vision. If you want to make decisions using pictures, CNN is very useful for visual input. \n\nImages have structure, they have local structure and correlation. They have distictive features in space and frequency domain. CNN can extract these features and give the output. Figure 3 shows the basic process as well as some features of CNN.\n\n![Figure 3](https://astrobear.top/resource/astroblog/content/RLS6F3.png)\n\nNow I am going to give you a brief introduction of how a CNN works.\n\n#### Receptive Field\n\nFirst, we need to randomly choose a part of the image as the input of a hidden unit. That part chosen from the image is called as *filter/kernel/receptive field* (we will call it filter after that). The range of the filter is called *filter size*. In the example showned in Figure 3, the filter size is $5\\times 5$. One CNN will have many filters and they form what we called *input batch*. Input batch is connected to the hidden units. \n\n![Figure 4](https://astrobear.top/resource/astroblog/content/RLS6F4.png)\n\n#### Stride\n\nNow we want the filter to scan all over the image. We can slide the $5\\times5$ filter over all the input pixels. If the filter move 1 pixel each time it slides, we define that the stride length is 1. Of course we can use other stride lengths. Assume the input is $28\\times28$, than we need to move $24\\times24$ times and we will have a $24\\times24$ first hidden-layer. For a filter, it will have 25 weights. \n\n![Figure 5](https://astrobear.top/resource/astroblog/content/RLS6F5.png)\n\n#### Shared Weights and Feature Map\n\nFor a same feature in the image, we want the algorithm able to recognize it no matter it is showned in any part of it (left side, right side, etc.) or in any direction (vertical, horizontal, etc.). Thus, no matter where the filter moves, we want its weights are always the same. In this example, for the whole CNN we will have 25 weights totally. This feature is called *shared weights*. \n\nThe map from the input layer to the hidden layer is therefore a *feature map*: all nodes detect the same feature in different parts. The feature map is defined by the shared weights and bias and it is the result of the application of a convolutional filter. \n\n![Figure 6](https://astrobear.top/resource/astroblog/content/RLS6F6.png)\n\n#### Convolutional Layers\n\nFeature map is the output of *convolutional layer*. Figure 7 and Figure 8 gives you a visualized example of how it works. \n\nIn Figure 8, the green matrix is a image (input) while the yellow matrix in it is a $3\\times3$ filter. The red numbers in the filter are weights. The pink matrix at the right is a feature map derives from the left. The value of each unit in feature map is the sum of the value of each unit in the filter times its weight. \n\n![Figure 7](https://pic1.zhimg.com/50/v2-4fd0400ccebc8adb2dffe24aac163e70_hd.gif)\n\n![Figure 8](https://pic4.zhimg.com/50/v2-7fce29335f9b43bce1b373daa40cccba_hd.gif) \n\n#### Pooling Layers\n\nPooling layers are usually used immediately after convolutional layers. They compress the information in the output from the convolutional layers. A pooling layer takes each feature map output form convolutional layer and prepares a condensed feature map. \n\n![Figure 9](https://astrobear.top/resource/astroblog/content/RLS6F8.png)\n\n#### ReLU Layers\n\nReLU is the abbrivation of *rectified linear unit*. It is constructed by non-linear functions (activation functions). It increases the nonlinear properties of the overall network without affecting the filters of the convolution layer. \n\n#### Fully Connected Layers\n\nThe process we have talked about is designed to catch the features of the image. After we have done this, we are going to do regression. This work is done by *fully connected layers*. They can do regression and output some scalers (Q-value in deep Q learning domain). \n\n![Figure 10](https://astrobear.top/resource/astroblog/content/RLS6F9.png)\n\nWe now have a rough idea towards CNN. If you want know more about it, you can go to [this website](http://cs231n.github.io/convolutional-networks/#conv). \n\n### Deep Q-Learning\n\nOur target is to approximate $\\hat q(s,a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$. I will give you an example first and then talk about algorithms. \n\n#### DQN in Atari\n\nAtari is a video game. Researchers tried to apply DQN to train the computer to play this game. The architecture of the DQN they designed is shown in Figure 11.  \n\n![Figure 11](https://astrobear.top/resource/astroblog/content/RLS6F11.jpeg)\n\nThe input to the network consists of an $84\\times84\\times4$ preprocessed image, followed by three convolutional layers and two fully connected layers with a single output for each valid action. Each hidden layer is followed by a rectifier nonlinearity (ReLU). The network outputs a vector containing Q-values fro each valid action. The reward is change in score for that step. \n\n#### Preprocessing Raw Pixels\n\nThe raw Atari frames are of size $260\\times260\\times3$, where the last dimension is corresponding to the RGB channels. The preprocessing step aims at reducing the imput dimensionality and dealing with some artifacts of game emulator. The process can be summarized as follows: \n\n- Single frame coding: the maximum value of each pixel color value over the frame being encoded and the previous frame is returned. In other words, we return a pixel-wise max-pooling of the 2 consecutive raw pixel frames. \n- Dimensionality reduction: extract the luminance channel, from the encoded RGB frame and rescale it to $84\\times84\\times1$. \n\nThe above preprocessing is applied to the 4 most recent raw RGB frames and the encoded frames are stacked together to produce the input ($84\\times84\\times4$) to the Q-network. \n\n#### Training Algorithm for DQN\n\nEssentially, the Q-network is learned by minimizing the following mean squarred error: \n\n$J(\\vec w)=\\Bbb E_{(s_t,a_t,r_t,s_{t+1})}[(y_t^{DQN}-\\hat q(s_t,a_t,\\vec w))^2]$, \n\nwhere $y_t^{DQN}$ is the one-step ahead learning target: \n\n$y_t^{DQN}=r_t+\\gamma\\tt max_{a’}\\mit \\hat q(s_{t+1},a’,\\vec w^-)$,\n\nwhere $\\vec w^-$ represents the parameters of the target network (belong to CNN, the desire `true value`) and the parameters $\\vec w$ of the online network (belong to function approximator) are updated by sampling gradients from minibatches of past transition tuples $(s_t,a_t,r_t,s_{t+1})$. Notice that when we refer to `target network/targets`, things are related to the so-called `true values` provided from Q-network (CNN). And when we refer to `online network`, things are related to the Q-learning process.\n\nIn the last article, we talked about Q-learning with value function approximation. But Q-learning with VFA can diverge. DQN introduces two major changes in order to avoid divergence, which are *experience replay* and a *separate target network*. \n\n#### Experience Replay\n\nThe agent's experiences (or transitions) at each time step $e_t=(s_t,a_t,r_t,s_{t+1})$ are stored in a fixed-sized dataset (or replay buffer) $D_t=\\{e_1,...,e_t\\}$. Figure 12 shows how a replay buffer looks like. \n\n![Figure 12](https://astrobear.top/resource/astroblog/content/RLS6F12.png)\n\nTo perform experience replay, we need to repeat the following: \n\n- $(s,a,r,s')$~$D$: sample an experience tuple form the dataset\n- Compute the target value for the sampled $s$: $y_t^{DQN}=r_t+\\gamma\\tt max_{a'}\\mit \\hat q(s_{t+1},a',\\vec w^-)$ \n- Use SGD to update the network weights: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a'}\\mit\\hat q^\\pi(s',a,\\vec w^-)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$ \n\n#### Target Network\n\nTo further improve the stability of learning and deal with non-stationary learning targets, a separate target network is used for generating the targets $y_j$ in the Q-learning update. More specifically, after every $C$ steps the target network $\\hat q(s,a,\\vec w^-)$ is updated by copying the parameters' values $(\\vec w^-=\\vec w)$ from the online network $\\hat q(s,a,\\vec w)$, and the target network remains unchanged and generates targets $y_j$ for the following $C$ updates. \n\n#### Summary of DQN and Algorithm\n\n- DQN uses experience replay and fixed Q-tragets\n- Store transition $(s_t,a_t,r_t,s_{t+1})$ in replay buffer $D$\n- Sample minibatch of transitions $(s,a,r,s')$ from $D$\n- Compute Q-learning target with respect to old, fixed parameters $\\vec w^-$\n- Optimizes MSE between Q-network and Q-learning targets\n- Uses stochastic gradient descent\n\nThe algorithm of DQN is shown below: \n\n![](https://astrobear.top/resource/astroblog/content/RLS6F12.5.jpeg)\n\n#### Double Deep Q-Network (DDQN)\n\nAfter the successful application of DQN to Atari, people become very interested in it and developed many other improvements, while DDQN and Dueling DQN are two very popular algorithms among them. Let's talk about DDQN first. \n\nRecall in Double Q-learning, in order to eliminate maximization bias, two Q-functions are maintained and learned by randomly assigning transitions to update one of two functions, resulting two different sets of parameters, denote here as $w$ and $w'$. This idea can also be extented to deep Q-learning.\n\nThe target network in DQN architecture provides a natural candidate for the second Q-function, without introducing additional networks. Similarly, the greedy action is generated accroding to the online network with parameters $w$, but its value is estimated by the target network with parameters $w^-$. The resulting algorithm is reffered as DDQN, which just slightly change the way $y_t$ updates: \n\n$y_t^{DDQN}=r_t+\\gamma\\hat q(s_{t+1},\\tt argmax_{a'}\\mit\\hat q(s_{t+1},a',\\vec w),\\vec w^-)$. \n\n#### Dueling DQN\n\nBefore we delve into dueling architecture, let's first introduce an important quantity, the *advantage function*, which relates the value and Q-functions (assume following a policy $\\pi$): \n\n$A^\\pi(s,a)=Q^\\pi(s,a)-V^\\pi(s)$. \n\nIntuitively, the advantage function sbstracts the value of the state from the Q funciton to get a relative measure of the importance of each action. \n\nDQN approximates the Q-function by decoupling the value function and the advantage function. Figure 13 illustrates the dueling network architecture and the DQN for comparison. \n\n![Figure 13](https://astrobear.top/resource/astroblog/content/RLS6F13.png)\n\nThe different between dueling network and DQN is that, the dueling network uses two streams of fully connected layers. One stream is used to provide value function estimate given a state, while the other stream is for estimating advantage function for each valid action. Finally, the two streams are comined in a way to produce and approximate the Q-function. \n\nWhy these two separated streams are designed? First, for many states, it is unnecessary to estimate the value of each possible action choice. Second, features required to determine the value function may be different than those used to accurately estimate action benefits. \n\nLet's denote the scalar output value function from one stream of fully-connected layers as $\\hat v(s,\\vec w,\\vec w_v)$, and denote the vector output advantage function from the other stream as $A(s,a,\\vec w,\\vec w_A)$. We use $\\vec w$ here to denote the shared parameters in the convolutional layers, and use $\\vec w_v$ and $\\vec w_A$ to represent parameters in the two different streams of fully-connected layers. According to the definition of advantage function, we have: \n\n$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+A(s,a,\\vec w,\\vec w_A)$. \n\nHowever, the expression above is unidentifiable, which means we can not recover $\\hat v$ and $A$ form a given $\\hat q$. This unidentifiable issue is mirrored by poor performance in practice. \n\nTo make Q-function identifiable, we can force the advantage function to have zero estimate at the chosen action. Then, we have: \n\n$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-\\tt max_{a'\\in A}\\mit A(s,a',\\vec w,\\vec w_A))$. \n\nOr we can just use mean as baseline: \n\n$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-{1\\over|A|}\\sum_{a'}A(s,a',\\vec w,\\vec w_A))$.","source":"_posts/RLSummary6.md","raw":"---\ntitle: Summary of Reinforcement Learning 6\ndate: 2020-2-23 10:17:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- RL\n\t- Research\n\t- Python\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://pic4.zhimg.com/v2-e7dd00d7fda722d5f8f70a9928e95a17_r.jpg\n\nthumbnail: https://pic4.zhimg.com/v2-e7dd00d7fda722d5f8f70a9928e95a17_r.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: Introduction to deep reinforcement learning. \n\n#You can begin to input your article below now.\n\n---\n\n### Introduction\n\nIn the last article we briefly talked about control using linear vlaue function approximation and three different methods. For example in Q-learning, we have: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a'}\\mit\\hat q^\\pi(s',a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. \n\nThen we can take calcullate the weight: $\\vec w'=\\vec w+\\Delta\\vec w$. \n\nFinally we can compute the function approximator: $\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. \n\nThe performance of linear function approximators highly depends on the quality of features ($\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ ...\\ x_n(s,a)]$) and it is difficult and time-consuming for us to handcraft an appropriate set of features. To scale up to making decisions in really large domains and enable automatic feature extraction, deep neural networks (DNNs) are used as function approximators. \n\nIn the following contents, we will introduce how to approximate $\\hat q^\\pi(s',a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$ via end-to-end training. And we will introduce three popular value-based deep reinforcement learning algorithms: Deep Q-Network (DQN), Double DQN and Dueling DQN. \n\nIt is OK for a deep-learning freshman to study deep reinforcement learning and one doesn't need to expert in deep learning. He/She just need some basic concepts of deep learning which we will discuss next. \n\n### Deep Neural Network (DNN)\n\nDNN is the composition of miltiple functions. Assuming that $\\vec x$ is the input and $\\vec y$ is the output, a simple DNN can be written as: \n\n$\\vec y=h_n(h_{n-1}(...h_1(\\vec x)...))$, \n\nWhere $h$ are different functions. These functions can be linear or non-linear. For linear functions, $h_n=w_n h_{n-1}+b_n$, $w_n$ is weight and $b_n$ is bias. For non-linear functions, $h_n=f_n(h_{n-1})$. The $f_n$ here is called as *activation function*, such as *sigmoid function* or *relu function*. The purpose of setting activation function is to make the nerual network more like the human nerual system. \n\nIf all the functions are differentiable, we can use chain rule to back propagate the gradient of $\\vec y$. Now we have some tools such as Tensorflow or Pytorch to help us compute the gradient automatically. Typically we need a loss function to fit the parameters. \n\nIn DNN (as well as CNN) we update weights and biases to get the desired output. In deep Q-learning, the outputs are always some scalers, in other words, Q-value. \n\nFigure 1 shows the structure of a nerual network that is relatively complex. The  important components of one of the routes is marked. Figure 2 shows the detailed structure of a node. \n\n![Figure 1](https://astrobear.top/resource/astroblog/content/RLS6F1.jpeg)\n\n![Figure 2](https://astrobear.top/resource/astroblog/content/RLS6F2.png)\n\n#### Benefits\n\n- Uses distributed representations instead of local representations\n- Universal function approximator\n- Can potentially need exponentially less nodes/parameters to represent the same function\n- Can learn the parameters using SGD\n\n### Convolutional Nerual Network (CNN)\n\nCNN is widely used in computer vision. If you want to make decisions using pictures, CNN is very useful for visual input. \n\nImages have structure, they have local structure and correlation. They have distictive features in space and frequency domain. CNN can extract these features and give the output. Figure 3 shows the basic process as well as some features of CNN.\n\n![Figure 3](https://astrobear.top/resource/astroblog/content/RLS6F3.png)\n\nNow I am going to give you a brief introduction of how a CNN works.\n\n#### Receptive Field\n\nFirst, we need to randomly choose a part of the image as the input of a hidden unit. That part chosen from the image is called as *filter/kernel/receptive field* (we will call it filter after that). The range of the filter is called *filter size*. In the example showned in Figure 3, the filter size is $5\\times 5$. One CNN will have many filters and they form what we called *input batch*. Input batch is connected to the hidden units. \n\n![Figure 4](https://astrobear.top/resource/astroblog/content/RLS6F4.png)\n\n#### Stride\n\nNow we want the filter to scan all over the image. We can slide the $5\\times5$ filter over all the input pixels. If the filter move 1 pixel each time it slides, we define that the stride length is 1. Of course we can use other stride lengths. Assume the input is $28\\times28$, than we need to move $24\\times24$ times and we will have a $24\\times24$ first hidden-layer. For a filter, it will have 25 weights. \n\n![Figure 5](https://astrobear.top/resource/astroblog/content/RLS6F5.png)\n\n#### Shared Weights and Feature Map\n\nFor a same feature in the image, we want the algorithm able to recognize it no matter it is showned in any part of it (left side, right side, etc.) or in any direction (vertical, horizontal, etc.). Thus, no matter where the filter moves, we want its weights are always the same. In this example, for the whole CNN we will have 25 weights totally. This feature is called *shared weights*. \n\nThe map from the input layer to the hidden layer is therefore a *feature map*: all nodes detect the same feature in different parts. The feature map is defined by the shared weights and bias and it is the result of the application of a convolutional filter. \n\n![Figure 6](https://astrobear.top/resource/astroblog/content/RLS6F6.png)\n\n#### Convolutional Layers\n\nFeature map is the output of *convolutional layer*. Figure 7 and Figure 8 gives you a visualized example of how it works. \n\nIn Figure 8, the green matrix is a image (input) while the yellow matrix in it is a $3\\times3$ filter. The red numbers in the filter are weights. The pink matrix at the right is a feature map derives from the left. The value of each unit in feature map is the sum of the value of each unit in the filter times its weight. \n\n![Figure 7](https://pic1.zhimg.com/50/v2-4fd0400ccebc8adb2dffe24aac163e70_hd.gif)\n\n![Figure 8](https://pic4.zhimg.com/50/v2-7fce29335f9b43bce1b373daa40cccba_hd.gif) \n\n#### Pooling Layers\n\nPooling layers are usually used immediately after convolutional layers. They compress the information in the output from the convolutional layers. A pooling layer takes each feature map output form convolutional layer and prepares a condensed feature map. \n\n![Figure 9](https://astrobear.top/resource/astroblog/content/RLS6F8.png)\n\n#### ReLU Layers\n\nReLU is the abbrivation of *rectified linear unit*. It is constructed by non-linear functions (activation functions). It increases the nonlinear properties of the overall network without affecting the filters of the convolution layer. \n\n#### Fully Connected Layers\n\nThe process we have talked about is designed to catch the features of the image. After we have done this, we are going to do regression. This work is done by *fully connected layers*. They can do regression and output some scalers (Q-value in deep Q learning domain). \n\n![Figure 10](https://astrobear.top/resource/astroblog/content/RLS6F9.png)\n\nWe now have a rough idea towards CNN. If you want know more about it, you can go to [this website](http://cs231n.github.io/convolutional-networks/#conv). \n\n### Deep Q-Learning\n\nOur target is to approximate $\\hat q(s,a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$. I will give you an example first and then talk about algorithms. \n\n#### DQN in Atari\n\nAtari is a video game. Researchers tried to apply DQN to train the computer to play this game. The architecture of the DQN they designed is shown in Figure 11.  \n\n![Figure 11](https://astrobear.top/resource/astroblog/content/RLS6F11.jpeg)\n\nThe input to the network consists of an $84\\times84\\times4$ preprocessed image, followed by three convolutional layers and two fully connected layers with a single output for each valid action. Each hidden layer is followed by a rectifier nonlinearity (ReLU). The network outputs a vector containing Q-values fro each valid action. The reward is change in score for that step. \n\n#### Preprocessing Raw Pixels\n\nThe raw Atari frames are of size $260\\times260\\times3$, where the last dimension is corresponding to the RGB channels. The preprocessing step aims at reducing the imput dimensionality and dealing with some artifacts of game emulator. The process can be summarized as follows: \n\n- Single frame coding: the maximum value of each pixel color value over the frame being encoded and the previous frame is returned. In other words, we return a pixel-wise max-pooling of the 2 consecutive raw pixel frames. \n- Dimensionality reduction: extract the luminance channel, from the encoded RGB frame and rescale it to $84\\times84\\times1$. \n\nThe above preprocessing is applied to the 4 most recent raw RGB frames and the encoded frames are stacked together to produce the input ($84\\times84\\times4$) to the Q-network. \n\n#### Training Algorithm for DQN\n\nEssentially, the Q-network is learned by minimizing the following mean squarred error: \n\n$J(\\vec w)=\\Bbb E_{(s_t,a_t,r_t,s_{t+1})}[(y_t^{DQN}-\\hat q(s_t,a_t,\\vec w))^2]$, \n\nwhere $y_t^{DQN}$ is the one-step ahead learning target: \n\n$y_t^{DQN}=r_t+\\gamma\\tt max_{a’}\\mit \\hat q(s_{t+1},a’,\\vec w^-)$,\n\nwhere $\\vec w^-$ represents the parameters of the target network (belong to CNN, the desire `true value`) and the parameters $\\vec w$ of the online network (belong to function approximator) are updated by sampling gradients from minibatches of past transition tuples $(s_t,a_t,r_t,s_{t+1})$. Notice that when we refer to `target network/targets`, things are related to the so-called `true values` provided from Q-network (CNN). And when we refer to `online network`, things are related to the Q-learning process.\n\nIn the last article, we talked about Q-learning with value function approximation. But Q-learning with VFA can diverge. DQN introduces two major changes in order to avoid divergence, which are *experience replay* and a *separate target network*. \n\n#### Experience Replay\n\nThe agent's experiences (or transitions) at each time step $e_t=(s_t,a_t,r_t,s_{t+1})$ are stored in a fixed-sized dataset (or replay buffer) $D_t=\\{e_1,...,e_t\\}$. Figure 12 shows how a replay buffer looks like. \n\n![Figure 12](https://astrobear.top/resource/astroblog/content/RLS6F12.png)\n\nTo perform experience replay, we need to repeat the following: \n\n- $(s,a,r,s')$~$D$: sample an experience tuple form the dataset\n- Compute the target value for the sampled $s$: $y_t^{DQN}=r_t+\\gamma\\tt max_{a'}\\mit \\hat q(s_{t+1},a',\\vec w^-)$ \n- Use SGD to update the network weights: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a'}\\mit\\hat q^\\pi(s',a,\\vec w^-)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$ \n\n#### Target Network\n\nTo further improve the stability of learning and deal with non-stationary learning targets, a separate target network is used for generating the targets $y_j$ in the Q-learning update. More specifically, after every $C$ steps the target network $\\hat q(s,a,\\vec w^-)$ is updated by copying the parameters' values $(\\vec w^-=\\vec w)$ from the online network $\\hat q(s,a,\\vec w)$, and the target network remains unchanged and generates targets $y_j$ for the following $C$ updates. \n\n#### Summary of DQN and Algorithm\n\n- DQN uses experience replay and fixed Q-tragets\n- Store transition $(s_t,a_t,r_t,s_{t+1})$ in replay buffer $D$\n- Sample minibatch of transitions $(s,a,r,s')$ from $D$\n- Compute Q-learning target with respect to old, fixed parameters $\\vec w^-$\n- Optimizes MSE between Q-network and Q-learning targets\n- Uses stochastic gradient descent\n\nThe algorithm of DQN is shown below: \n\n![](https://astrobear.top/resource/astroblog/content/RLS6F12.5.jpeg)\n\n#### Double Deep Q-Network (DDQN)\n\nAfter the successful application of DQN to Atari, people become very interested in it and developed many other improvements, while DDQN and Dueling DQN are two very popular algorithms among them. Let's talk about DDQN first. \n\nRecall in Double Q-learning, in order to eliminate maximization bias, two Q-functions are maintained and learned by randomly assigning transitions to update one of two functions, resulting two different sets of parameters, denote here as $w$ and $w'$. This idea can also be extented to deep Q-learning.\n\nThe target network in DQN architecture provides a natural candidate for the second Q-function, without introducing additional networks. Similarly, the greedy action is generated accroding to the online network with parameters $w$, but its value is estimated by the target network with parameters $w^-$. The resulting algorithm is reffered as DDQN, which just slightly change the way $y_t$ updates: \n\n$y_t^{DDQN}=r_t+\\gamma\\hat q(s_{t+1},\\tt argmax_{a'}\\mit\\hat q(s_{t+1},a',\\vec w),\\vec w^-)$. \n\n#### Dueling DQN\n\nBefore we delve into dueling architecture, let's first introduce an important quantity, the *advantage function*, which relates the value and Q-functions (assume following a policy $\\pi$): \n\n$A^\\pi(s,a)=Q^\\pi(s,a)-V^\\pi(s)$. \n\nIntuitively, the advantage function sbstracts the value of the state from the Q funciton to get a relative measure of the importance of each action. \n\nDQN approximates the Q-function by decoupling the value function and the advantage function. Figure 13 illustrates the dueling network architecture and the DQN for comparison. \n\n![Figure 13](https://astrobear.top/resource/astroblog/content/RLS6F13.png)\n\nThe different between dueling network and DQN is that, the dueling network uses two streams of fully connected layers. One stream is used to provide value function estimate given a state, while the other stream is for estimating advantage function for each valid action. Finally, the two streams are comined in a way to produce and approximate the Q-function. \n\nWhy these two separated streams are designed? First, for many states, it is unnecessary to estimate the value of each possible action choice. Second, features required to determine the value function may be different than those used to accurately estimate action benefits. \n\nLet's denote the scalar output value function from one stream of fully-connected layers as $\\hat v(s,\\vec w,\\vec w_v)$, and denote the vector output advantage function from the other stream as $A(s,a,\\vec w,\\vec w_A)$. We use $\\vec w$ here to denote the shared parameters in the convolutional layers, and use $\\vec w_v$ and $\\vec w_A$ to represent parameters in the two different streams of fully-connected layers. According to the definition of advantage function, we have: \n\n$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+A(s,a,\\vec w,\\vec w_A)$. \n\nHowever, the expression above is unidentifiable, which means we can not recover $\\hat v$ and $A$ form a given $\\hat q$. This unidentifiable issue is mirrored by poor performance in practice. \n\nTo make Q-function identifiable, we can force the advantage function to have zero estimate at the chosen action. Then, we have: \n\n$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-\\tt max_{a'\\in A}\\mit A(s,a',\\vec w,\\vec w_A))$. \n\nOr we can just use mean as baseline: \n\n$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-{1\\over|A|}\\sum_{a'}A(s,a',\\vec w,\\vec w_A))$.","slug":"RLSummary6","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz02000y1q391o2j9t17","content":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>In the last article we briefly talked about control using linear vlaue function approximation and three different methods. For example in Q-learning, we have: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a’}\\mit\\hat q^\\pi(s’,a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. </p>\n<p>Then we can take calcullate the weight: $\\vec w’=\\vec w+\\Delta\\vec w$. </p>\n<p>Finally we can compute the function approximator: $\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. </p>\n<p>The performance of linear function approximators highly depends on the quality of features ($\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ …\\ x_n(s,a)]$) and it is difficult and time-consuming for us to handcraft an appropriate set of features. To scale up to making decisions in really large domains and enable automatic feature extraction, deep neural networks (DNNs) are used as function approximators. </p>\n<p>In the following contents, we will introduce how to approximate $\\hat q^\\pi(s’,a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$ via end-to-end training. And we will introduce three popular value-based deep reinforcement learning algorithms: Deep Q-Network (DQN), Double DQN and Dueling DQN. </p>\n<p>It is OK for a deep-learning freshman to study deep reinforcement learning and one doesn’t need to expert in deep learning. He/She just need some basic concepts of deep learning which we will discuss next. </p>\n<h3 id=\"Deep-Neural-Network-DNN\"><a href=\"#Deep-Neural-Network-DNN\" class=\"headerlink\" title=\"Deep Neural Network (DNN)\"></a>Deep Neural Network (DNN)</h3><p>DNN is the composition of miltiple functions. Assuming that $\\vec x$ is the input and $\\vec y$ is the output, a simple DNN can be written as: </p>\n<p>$\\vec y=h_n(h_{n-1}(…h_1(\\vec x)…))$, </p>\n<p>Where $h$ are different functions. These functions can be linear or non-linear. For linear functions, $h_n=w_n h_{n-1}+b_n$, $w_n$ is weight and $b_n$ is bias. For non-linear functions, $h_n=f_n(h_{n-1})$. The $f_n$ here is called as <em>activation function</em>, such as <em>sigmoid function</em> or <em>relu function</em>. The purpose of setting activation function is to make the nerual network more like the human nerual system. </p>\n<p>If all the functions are differentiable, we can use chain rule to back propagate the gradient of $\\vec y$. Now we have some tools such as Tensorflow or Pytorch to help us compute the gradient automatically. Typically we need a loss function to fit the parameters. </p>\n<p>In DNN (as well as CNN) we update weights and biases to get the desired output. In deep Q-learning, the outputs are always some scalers, in other words, Q-value. </p>\n<p>Figure 1 shows the structure of a nerual network that is relatively complex. The  important components of one of the routes is marked. Figure 2 shows the detailed structure of a node. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F1.jpeg\" alt=\"Figure 1\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F2.png\" alt=\"Figure 2\"></p>\n<h4 id=\"Benefits\"><a href=\"#Benefits\" class=\"headerlink\" title=\"Benefits\"></a>Benefits</h4><ul>\n<li>Uses distributed representations instead of local representations</li>\n<li>Universal function approximator</li>\n<li>Can potentially need exponentially less nodes/parameters to represent the same function</li>\n<li>Can learn the parameters using SGD</li>\n</ul>\n<h3 id=\"Convolutional-Nerual-Network-CNN\"><a href=\"#Convolutional-Nerual-Network-CNN\" class=\"headerlink\" title=\"Convolutional Nerual Network (CNN)\"></a>Convolutional Nerual Network (CNN)</h3><p>CNN is widely used in computer vision. If you want to make decisions using pictures, CNN is very useful for visual input. </p>\n<p>Images have structure, they have local structure and correlation. They have distictive features in space and frequency domain. CNN can extract these features and give the output. Figure 3 shows the basic process as well as some features of CNN.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F3.png\" alt=\"Figure 3\"></p>\n<p>Now I am going to give you a brief introduction of how a CNN works.</p>\n<h4 id=\"Receptive-Field\"><a href=\"#Receptive-Field\" class=\"headerlink\" title=\"Receptive Field\"></a>Receptive Field</h4><p>First, we need to randomly choose a part of the image as the input of a hidden unit. That part chosen from the image is called as <em>filter/kernel/receptive field</em> (we will call it filter after that). The range of the filter is called <em>filter size</em>. In the example showned in Figure 3, the filter size is $5\\times 5$. One CNN will have many filters and they form what we called <em>input batch</em>. Input batch is connected to the hidden units. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F4.png\" alt=\"Figure 4\"></p>\n<h4 id=\"Stride\"><a href=\"#Stride\" class=\"headerlink\" title=\"Stride\"></a>Stride</h4><p>Now we want the filter to scan all over the image. We can slide the $5\\times5$ filter over all the input pixels. If the filter move 1 pixel each time it slides, we define that the stride length is 1. Of course we can use other stride lengths. Assume the input is $28\\times28$, than we need to move $24\\times24$ times and we will have a $24\\times24$ first hidden-layer. For a filter, it will have 25 weights. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F5.png\" alt=\"Figure 5\"></p>\n<h4 id=\"Shared-Weights-and-Feature-Map\"><a href=\"#Shared-Weights-and-Feature-Map\" class=\"headerlink\" title=\"Shared Weights and Feature Map\"></a>Shared Weights and Feature Map</h4><p>For a same feature in the image, we want the algorithm able to recognize it no matter it is showned in any part of it (left side, right side, etc.) or in any direction (vertical, horizontal, etc.). Thus, no matter where the filter moves, we want its weights are always the same. In this example, for the whole CNN we will have 25 weights totally. This feature is called <em>shared weights</em>. </p>\n<p>The map from the input layer to the hidden layer is therefore a <em>feature map</em>: all nodes detect the same feature in different parts. The feature map is defined by the shared weights and bias and it is the result of the application of a convolutional filter. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F6.png\" alt=\"Figure 6\"></p>\n<h4 id=\"Convolutional-Layers\"><a href=\"#Convolutional-Layers\" class=\"headerlink\" title=\"Convolutional Layers\"></a>Convolutional Layers</h4><p>Feature map is the output of <em>convolutional layer</em>. Figure 7 and Figure 8 gives you a visualized example of how it works. </p>\n<p>In Figure 8, the green matrix is a image (input) while the yellow matrix in it is a $3\\times3$ filter. The red numbers in the filter are weights. The pink matrix at the right is a feature map derives from the left. The value of each unit in feature map is the sum of the value of each unit in the filter times its weight. </p>\n<p><img src=\"https://pic1.zhimg.com/50/v2-4fd0400ccebc8adb2dffe24aac163e70_hd.gif\" alt=\"Figure 7\"></p>\n<p><img src=\"https://pic4.zhimg.com/50/v2-7fce29335f9b43bce1b373daa40cccba_hd.gif\" alt=\"Figure 8\"> </p>\n<h4 id=\"Pooling-Layers\"><a href=\"#Pooling-Layers\" class=\"headerlink\" title=\"Pooling Layers\"></a>Pooling Layers</h4><p>Pooling layers are usually used immediately after convolutional layers. They compress the information in the output from the convolutional layers. A pooling layer takes each feature map output form convolutional layer and prepares a condensed feature map. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F8.png\" alt=\"Figure 9\"></p>\n<h4 id=\"ReLU-Layers\"><a href=\"#ReLU-Layers\" class=\"headerlink\" title=\"ReLU Layers\"></a>ReLU Layers</h4><p>ReLU is the abbrivation of <em>rectified linear unit</em>. It is constructed by non-linear functions (activation functions). It increases the nonlinear properties of the overall network without affecting the filters of the convolution layer. </p>\n<h4 id=\"Fully-Connected-Layers\"><a href=\"#Fully-Connected-Layers\" class=\"headerlink\" title=\"Fully Connected Layers\"></a>Fully Connected Layers</h4><p>The process we have talked about is designed to catch the features of the image. After we have done this, we are going to do regression. This work is done by <em>fully connected layers</em>. They can do regression and output some scalers (Q-value in deep Q learning domain). </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F9.png\" alt=\"Figure 10\"></p>\n<p>We now have a rough idea towards CNN. If you want know more about it, you can go to <a href=\"http://cs231n.github.io/convolutional-networks/#conv\">this website</a>. </p>\n<h3 id=\"Deep-Q-Learning\"><a href=\"#Deep-Q-Learning\" class=\"headerlink\" title=\"Deep Q-Learning\"></a>Deep Q-Learning</h3><p>Our target is to approximate $\\hat q(s,a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$. I will give you an example first and then talk about algorithms. </p>\n<h4 id=\"DQN-in-Atari\"><a href=\"#DQN-in-Atari\" class=\"headerlink\" title=\"DQN in Atari\"></a>DQN in Atari</h4><p>Atari is a video game. Researchers tried to apply DQN to train the computer to play this game. The architecture of the DQN they designed is shown in Figure 11.  </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F11.jpeg\" alt=\"Figure 11\"></p>\n<p>The input to the network consists of an $84\\times84\\times4$ preprocessed image, followed by three convolutional layers and two fully connected layers with a single output for each valid action. Each hidden layer is followed by a rectifier nonlinearity (ReLU). The network outputs a vector containing Q-values fro each valid action. The reward is change in score for that step. </p>\n<h4 id=\"Preprocessing-Raw-Pixels\"><a href=\"#Preprocessing-Raw-Pixels\" class=\"headerlink\" title=\"Preprocessing Raw Pixels\"></a>Preprocessing Raw Pixels</h4><p>The raw Atari frames are of size $260\\times260\\times3$, where the last dimension is corresponding to the RGB channels. The preprocessing step aims at reducing the imput dimensionality and dealing with some artifacts of game emulator. The process can be summarized as follows: </p>\n<ul>\n<li>Single frame coding: the maximum value of each pixel color value over the frame being encoded and the previous frame is returned. In other words, we return a pixel-wise max-pooling of the 2 consecutive raw pixel frames. </li>\n<li>Dimensionality reduction: extract the luminance channel, from the encoded RGB frame and rescale it to $84\\times84\\times1$. </li>\n</ul>\n<p>The above preprocessing is applied to the 4 most recent raw RGB frames and the encoded frames are stacked together to produce the input ($84\\times84\\times4$) to the Q-network. </p>\n<h4 id=\"Training-Algorithm-for-DQN\"><a href=\"#Training-Algorithm-for-DQN\" class=\"headerlink\" title=\"Training Algorithm for DQN\"></a>Training Algorithm for DQN</h4><p>Essentially, the Q-network is learned by minimizing the following mean squarred error: </p>\n<p>$J(\\vec w)=\\Bbb E_{(s_t,a_t,r_t,s_{t+1})}[(y_t^{DQN}-\\hat q(s_t,a_t,\\vec w))^2]$, </p>\n<p>where $y_t^{DQN}$ is the one-step ahead learning target: </p>\n<p>$y_t^{DQN}=r_t+\\gamma\\tt max_{a’}\\mit \\hat q(s_{t+1},a’,\\vec w^-)$,</p>\n<p>where $\\vec w^-$ represents the parameters of the target network (belong to CNN, the desire <code>true value</code>) and the parameters $\\vec w$ of the online network (belong to function approximator) are updated by sampling gradients from minibatches of past transition tuples $(s_t,a_t,r_t,s_{t+1})$. Notice that when we refer to <code>target network/targets</code>, things are related to the so-called <code>true values</code> provided from Q-network (CNN). And when we refer to <code>online network</code>, things are related to the Q-learning process.</p>\n<p>In the last article, we talked about Q-learning with value function approximation. But Q-learning with VFA can diverge. DQN introduces two major changes in order to avoid divergence, which are <em>experience replay</em> and a <em>separate target network</em>. </p>\n<h4 id=\"Experience-Replay\"><a href=\"#Experience-Replay\" class=\"headerlink\" title=\"Experience Replay\"></a>Experience Replay</h4><p>The agent’s experiences (or transitions) at each time step $e_t=(s_t,a_t,r_t,s_{t+1})$ are stored in a fixed-sized dataset (or replay buffer) $D_t={e_1,…,e_t}$. Figure 12 shows how a replay buffer looks like. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F12.png\" alt=\"Figure 12\"></p>\n<p>To perform experience replay, we need to repeat the following: </p>\n<ul>\n<li>$(s,a,r,s’)$~$D$: sample an experience tuple form the dataset</li>\n<li>Compute the target value for the sampled $s$: $y_t^{DQN}=r_t+\\gamma\\tt max_{a’}\\mit \\hat q(s_{t+1},a’,\\vec w^-)$ </li>\n<li>Use SGD to update the network weights: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a’}\\mit\\hat q^\\pi(s’,a,\\vec w^-)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$ </li>\n</ul>\n<h4 id=\"Target-Network\"><a href=\"#Target-Network\" class=\"headerlink\" title=\"Target Network\"></a>Target Network</h4><p>To further improve the stability of learning and deal with non-stationary learning targets, a separate target network is used for generating the targets $y_j$ in the Q-learning update. More specifically, after every $C$ steps the target network $\\hat q(s,a,\\vec w^-)$ is updated by copying the parameters’ values $(\\vec w^-=\\vec w)$ from the online network $\\hat q(s,a,\\vec w)$, and the target network remains unchanged and generates targets $y_j$ for the following $C$ updates. </p>\n<h4 id=\"Summary-of-DQN-and-Algorithm\"><a href=\"#Summary-of-DQN-and-Algorithm\" class=\"headerlink\" title=\"Summary of DQN and Algorithm\"></a>Summary of DQN and Algorithm</h4><ul>\n<li>DQN uses experience replay and fixed Q-tragets</li>\n<li>Store transition $(s_t,a_t,r_t,s_{t+1})$ in replay buffer $D$</li>\n<li>Sample minibatch of transitions $(s,a,r,s’)$ from $D$</li>\n<li>Compute Q-learning target with respect to old, fixed parameters $\\vec w^-$</li>\n<li>Optimizes MSE between Q-network and Q-learning targets</li>\n<li>Uses stochastic gradient descent</li>\n</ul>\n<p>The algorithm of DQN is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F12.5.jpeg\" alt=\"\"></p>\n<h4 id=\"Double-Deep-Q-Network-DDQN\"><a href=\"#Double-Deep-Q-Network-DDQN\" class=\"headerlink\" title=\"Double Deep Q-Network (DDQN)\"></a>Double Deep Q-Network (DDQN)</h4><p>After the successful application of DQN to Atari, people become very interested in it and developed many other improvements, while DDQN and Dueling DQN are two very popular algorithms among them. Let’s talk about DDQN first. </p>\n<p>Recall in Double Q-learning, in order to eliminate maximization bias, two Q-functions are maintained and learned by randomly assigning transitions to update one of two functions, resulting two different sets of parameters, denote here as $w$ and $w’$. This idea can also be extented to deep Q-learning.</p>\n<p>The target network in DQN architecture provides a natural candidate for the second Q-function, without introducing additional networks. Similarly, the greedy action is generated accroding to the online network with parameters $w$, but its value is estimated by the target network with parameters $w^-$. The resulting algorithm is reffered as DDQN, which just slightly change the way $y_t$ updates: </p>\n<p>$y_t^{DDQN}=r_t+\\gamma\\hat q(s_{t+1},\\tt argmax_{a’}\\mit\\hat q(s_{t+1},a’,\\vec w),\\vec w^-)$. </p>\n<h4 id=\"Dueling-DQN\"><a href=\"#Dueling-DQN\" class=\"headerlink\" title=\"Dueling DQN\"></a>Dueling DQN</h4><p>Before we delve into dueling architecture, let’s first introduce an important quantity, the <em>advantage function</em>, which relates the value and Q-functions (assume following a policy $\\pi$): </p>\n<p>$A^\\pi(s,a)=Q^\\pi(s,a)-V^\\pi(s)$. </p>\n<p>Intuitively, the advantage function sbstracts the value of the state from the Q funciton to get a relative measure of the importance of each action. </p>\n<p>DQN approximates the Q-function by decoupling the value function and the advantage function. Figure 13 illustrates the dueling network architecture and the DQN for comparison. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F13.png\" alt=\"Figure 13\"></p>\n<p>The different between dueling network and DQN is that, the dueling network uses two streams of fully connected layers. One stream is used to provide value function estimate given a state, while the other stream is for estimating advantage function for each valid action. Finally, the two streams are comined in a way to produce and approximate the Q-function. </p>\n<p>Why these two separated streams are designed? First, for many states, it is unnecessary to estimate the value of each possible action choice. Second, features required to determine the value function may be different than those used to accurately estimate action benefits. </p>\n<p>Let’s denote the scalar output value function from one stream of fully-connected layers as $\\hat v(s,\\vec w,\\vec w_v)$, and denote the vector output advantage function from the other stream as $A(s,a,\\vec w,\\vec w_A)$. We use $\\vec w$ here to denote the shared parameters in the convolutional layers, and use $\\vec w_v$ and $\\vec w_A$ to represent parameters in the two different streams of fully-connected layers. According to the definition of advantage function, we have: </p>\n<p>$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+A(s,a,\\vec w,\\vec w_A)$. </p>\n<p>However, the expression above is unidentifiable, which means we can not recover $\\hat v$ and $A$ form a given $\\hat q$. This unidentifiable issue is mirrored by poor performance in practice. </p>\n<p>To make Q-function identifiable, we can force the advantage function to have zero estimate at the chosen action. Then, we have: </p>\n<p>$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-\\tt max_{a’\\in A}\\mit A(s,a’,\\vec w,\\vec w_A))$. </p>\n<p>Or we can just use mean as baseline: </p>\n<p>$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-{1\\over|A|}\\sum_{a’}A(s,a’,\\vec w,\\vec w_A))$.</p>\n","site":{"data":{}},"more":"<h3 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h3><p>In the last article we briefly talked about control using linear vlaue function approximation and three different methods. For example in Q-learning, we have: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a’}\\mit\\hat q^\\pi(s’,a,\\vec w)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$. </p>\n<p>Then we can take calcullate the weight: $\\vec w’=\\vec w+\\Delta\\vec w$. </p>\n<p>Finally we can compute the function approximator: $\\hat q(s,a,\\vec w)=\\vec x(s,a)\\vec w$. </p>\n<p>The performance of linear function approximators highly depends on the quality of features ($\\vec x(s,a)=[x_1(s,a)\\ x_2(s,a)\\ …\\ x_n(s,a)]$) and it is difficult and time-consuming for us to handcraft an appropriate set of features. To scale up to making decisions in really large domains and enable automatic feature extraction, deep neural networks (DNNs) are used as function approximators. </p>\n<p>In the following contents, we will introduce how to approximate $\\hat q^\\pi(s’,a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$ via end-to-end training. And we will introduce three popular value-based deep reinforcement learning algorithms: Deep Q-Network (DQN), Double DQN and Dueling DQN. </p>\n<p>It is OK for a deep-learning freshman to study deep reinforcement learning and one doesn’t need to expert in deep learning. He/She just need some basic concepts of deep learning which we will discuss next. </p>\n<h3 id=\"Deep-Neural-Network-DNN\"><a href=\"#Deep-Neural-Network-DNN\" class=\"headerlink\" title=\"Deep Neural Network (DNN)\"></a>Deep Neural Network (DNN)</h3><p>DNN is the composition of miltiple functions. Assuming that $\\vec x$ is the input and $\\vec y$ is the output, a simple DNN can be written as: </p>\n<p>$\\vec y=h_n(h_{n-1}(…h_1(\\vec x)…))$, </p>\n<p>Where $h$ are different functions. These functions can be linear or non-linear. For linear functions, $h_n=w_n h_{n-1}+b_n$, $w_n$ is weight and $b_n$ is bias. For non-linear functions, $h_n=f_n(h_{n-1})$. The $f_n$ here is called as <em>activation function</em>, such as <em>sigmoid function</em> or <em>relu function</em>. The purpose of setting activation function is to make the nerual network more like the human nerual system. </p>\n<p>If all the functions are differentiable, we can use chain rule to back propagate the gradient of $\\vec y$. Now we have some tools such as Tensorflow or Pytorch to help us compute the gradient automatically. Typically we need a loss function to fit the parameters. </p>\n<p>In DNN (as well as CNN) we update weights and biases to get the desired output. In deep Q-learning, the outputs are always some scalers, in other words, Q-value. </p>\n<p>Figure 1 shows the structure of a nerual network that is relatively complex. The  important components of one of the routes is marked. Figure 2 shows the detailed structure of a node. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F1.jpeg\" alt=\"Figure 1\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F2.png\" alt=\"Figure 2\"></p>\n<h4 id=\"Benefits\"><a href=\"#Benefits\" class=\"headerlink\" title=\"Benefits\"></a>Benefits</h4><ul>\n<li>Uses distributed representations instead of local representations</li>\n<li>Universal function approximator</li>\n<li>Can potentially need exponentially less nodes/parameters to represent the same function</li>\n<li>Can learn the parameters using SGD</li>\n</ul>\n<h3 id=\"Convolutional-Nerual-Network-CNN\"><a href=\"#Convolutional-Nerual-Network-CNN\" class=\"headerlink\" title=\"Convolutional Nerual Network (CNN)\"></a>Convolutional Nerual Network (CNN)</h3><p>CNN is widely used in computer vision. If you want to make decisions using pictures, CNN is very useful for visual input. </p>\n<p>Images have structure, they have local structure and correlation. They have distictive features in space and frequency domain. CNN can extract these features and give the output. Figure 3 shows the basic process as well as some features of CNN.</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F3.png\" alt=\"Figure 3\"></p>\n<p>Now I am going to give you a brief introduction of how a CNN works.</p>\n<h4 id=\"Receptive-Field\"><a href=\"#Receptive-Field\" class=\"headerlink\" title=\"Receptive Field\"></a>Receptive Field</h4><p>First, we need to randomly choose a part of the image as the input of a hidden unit. That part chosen from the image is called as <em>filter/kernel/receptive field</em> (we will call it filter after that). The range of the filter is called <em>filter size</em>. In the example showned in Figure 3, the filter size is $5\\times 5$. One CNN will have many filters and they form what we called <em>input batch</em>. Input batch is connected to the hidden units. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F4.png\" alt=\"Figure 4\"></p>\n<h4 id=\"Stride\"><a href=\"#Stride\" class=\"headerlink\" title=\"Stride\"></a>Stride</h4><p>Now we want the filter to scan all over the image. We can slide the $5\\times5$ filter over all the input pixels. If the filter move 1 pixel each time it slides, we define that the stride length is 1. Of course we can use other stride lengths. Assume the input is $28\\times28$, than we need to move $24\\times24$ times and we will have a $24\\times24$ first hidden-layer. For a filter, it will have 25 weights. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F5.png\" alt=\"Figure 5\"></p>\n<h4 id=\"Shared-Weights-and-Feature-Map\"><a href=\"#Shared-Weights-and-Feature-Map\" class=\"headerlink\" title=\"Shared Weights and Feature Map\"></a>Shared Weights and Feature Map</h4><p>For a same feature in the image, we want the algorithm able to recognize it no matter it is showned in any part of it (left side, right side, etc.) or in any direction (vertical, horizontal, etc.). Thus, no matter where the filter moves, we want its weights are always the same. In this example, for the whole CNN we will have 25 weights totally. This feature is called <em>shared weights</em>. </p>\n<p>The map from the input layer to the hidden layer is therefore a <em>feature map</em>: all nodes detect the same feature in different parts. The feature map is defined by the shared weights and bias and it is the result of the application of a convolutional filter. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F6.png\" alt=\"Figure 6\"></p>\n<h4 id=\"Convolutional-Layers\"><a href=\"#Convolutional-Layers\" class=\"headerlink\" title=\"Convolutional Layers\"></a>Convolutional Layers</h4><p>Feature map is the output of <em>convolutional layer</em>. Figure 7 and Figure 8 gives you a visualized example of how it works. </p>\n<p>In Figure 8, the green matrix is a image (input) while the yellow matrix in it is a $3\\times3$ filter. The red numbers in the filter are weights. The pink matrix at the right is a feature map derives from the left. The value of each unit in feature map is the sum of the value of each unit in the filter times its weight. </p>\n<p><img src=\"https://pic1.zhimg.com/50/v2-4fd0400ccebc8adb2dffe24aac163e70_hd.gif\" alt=\"Figure 7\"></p>\n<p><img src=\"https://pic4.zhimg.com/50/v2-7fce29335f9b43bce1b373daa40cccba_hd.gif\" alt=\"Figure 8\"> </p>\n<h4 id=\"Pooling-Layers\"><a href=\"#Pooling-Layers\" class=\"headerlink\" title=\"Pooling Layers\"></a>Pooling Layers</h4><p>Pooling layers are usually used immediately after convolutional layers. They compress the information in the output from the convolutional layers. A pooling layer takes each feature map output form convolutional layer and prepares a condensed feature map. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F8.png\" alt=\"Figure 9\"></p>\n<h4 id=\"ReLU-Layers\"><a href=\"#ReLU-Layers\" class=\"headerlink\" title=\"ReLU Layers\"></a>ReLU Layers</h4><p>ReLU is the abbrivation of <em>rectified linear unit</em>. It is constructed by non-linear functions (activation functions). It increases the nonlinear properties of the overall network without affecting the filters of the convolution layer. </p>\n<h4 id=\"Fully-Connected-Layers\"><a href=\"#Fully-Connected-Layers\" class=\"headerlink\" title=\"Fully Connected Layers\"></a>Fully Connected Layers</h4><p>The process we have talked about is designed to catch the features of the image. After we have done this, we are going to do regression. This work is done by <em>fully connected layers</em>. They can do regression and output some scalers (Q-value in deep Q learning domain). </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F9.png\" alt=\"Figure 10\"></p>\n<p>We now have a rough idea towards CNN. If you want know more about it, you can go to <a href=\"http://cs231n.github.io/convolutional-networks/#conv\">this website</a>. </p>\n<h3 id=\"Deep-Q-Learning\"><a href=\"#Deep-Q-Learning\" class=\"headerlink\" title=\"Deep Q-Learning\"></a>Deep Q-Learning</h3><p>Our target is to approximate $\\hat q(s,a,\\vec w)$ by using a deep neural network and learn neural network parameters $\\vec w$. I will give you an example first and then talk about algorithms. </p>\n<h4 id=\"DQN-in-Atari\"><a href=\"#DQN-in-Atari\" class=\"headerlink\" title=\"DQN in Atari\"></a>DQN in Atari</h4><p>Atari is a video game. Researchers tried to apply DQN to train the computer to play this game. The architecture of the DQN they designed is shown in Figure 11.  </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F11.jpeg\" alt=\"Figure 11\"></p>\n<p>The input to the network consists of an $84\\times84\\times4$ preprocessed image, followed by three convolutional layers and two fully connected layers with a single output for each valid action. Each hidden layer is followed by a rectifier nonlinearity (ReLU). The network outputs a vector containing Q-values fro each valid action. The reward is change in score for that step. </p>\n<h4 id=\"Preprocessing-Raw-Pixels\"><a href=\"#Preprocessing-Raw-Pixels\" class=\"headerlink\" title=\"Preprocessing Raw Pixels\"></a>Preprocessing Raw Pixels</h4><p>The raw Atari frames are of size $260\\times260\\times3$, where the last dimension is corresponding to the RGB channels. The preprocessing step aims at reducing the imput dimensionality and dealing with some artifacts of game emulator. The process can be summarized as follows: </p>\n<ul>\n<li>Single frame coding: the maximum value of each pixel color value over the frame being encoded and the previous frame is returned. In other words, we return a pixel-wise max-pooling of the 2 consecutive raw pixel frames. </li>\n<li>Dimensionality reduction: extract the luminance channel, from the encoded RGB frame and rescale it to $84\\times84\\times1$. </li>\n</ul>\n<p>The above preprocessing is applied to the 4 most recent raw RGB frames and the encoded frames are stacked together to produce the input ($84\\times84\\times4$) to the Q-network. </p>\n<h4 id=\"Training-Algorithm-for-DQN\"><a href=\"#Training-Algorithm-for-DQN\" class=\"headerlink\" title=\"Training Algorithm for DQN\"></a>Training Algorithm for DQN</h4><p>Essentially, the Q-network is learned by minimizing the following mean squarred error: </p>\n<p>$J(\\vec w)=\\Bbb E_{(s_t,a_t,r_t,s_{t+1})}[(y_t^{DQN}-\\hat q(s_t,a_t,\\vec w))^2]$, </p>\n<p>where $y_t^{DQN}$ is the one-step ahead learning target: </p>\n<p>$y_t^{DQN}=r_t+\\gamma\\tt max_{a’}\\mit \\hat q(s_{t+1},a’,\\vec w^-)$,</p>\n<p>where $\\vec w^-$ represents the parameters of the target network (belong to CNN, the desire <code>true value</code>) and the parameters $\\vec w$ of the online network (belong to function approximator) are updated by sampling gradients from minibatches of past transition tuples $(s_t,a_t,r_t,s_{t+1})$. Notice that when we refer to <code>target network/targets</code>, things are related to the so-called <code>true values</code> provided from Q-network (CNN). And when we refer to <code>online network</code>, things are related to the Q-learning process.</p>\n<p>In the last article, we talked about Q-learning with value function approximation. But Q-learning with VFA can diverge. DQN introduces two major changes in order to avoid divergence, which are <em>experience replay</em> and a <em>separate target network</em>. </p>\n<h4 id=\"Experience-Replay\"><a href=\"#Experience-Replay\" class=\"headerlink\" title=\"Experience Replay\"></a>Experience Replay</h4><p>The agent’s experiences (or transitions) at each time step $e_t=(s_t,a_t,r_t,s_{t+1})$ are stored in a fixed-sized dataset (or replay buffer) $D_t={e_1,…,e_t}$. Figure 12 shows how a replay buffer looks like. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F12.png\" alt=\"Figure 12\"></p>\n<p>To perform experience replay, we need to repeat the following: </p>\n<ul>\n<li>$(s,a,r,s’)$~$D$: sample an experience tuple form the dataset</li>\n<li>Compute the target value for the sampled $s$: $y_t^{DQN}=r_t+\\gamma\\tt max_{a’}\\mit \\hat q(s_{t+1},a’,\\vec w^-)$ </li>\n<li>Use SGD to update the network weights: $\\Delta\\vec w=\\alpha[r+\\gamma\\tt max_{a’}\\mit\\hat q^\\pi(s’,a,\\vec w^-)-\\hat q(s,a,\\vec w)]\\vec x(s,a)$ </li>\n</ul>\n<h4 id=\"Target-Network\"><a href=\"#Target-Network\" class=\"headerlink\" title=\"Target Network\"></a>Target Network</h4><p>To further improve the stability of learning and deal with non-stationary learning targets, a separate target network is used for generating the targets $y_j$ in the Q-learning update. More specifically, after every $C$ steps the target network $\\hat q(s,a,\\vec w^-)$ is updated by copying the parameters’ values $(\\vec w^-=\\vec w)$ from the online network $\\hat q(s,a,\\vec w)$, and the target network remains unchanged and generates targets $y_j$ for the following $C$ updates. </p>\n<h4 id=\"Summary-of-DQN-and-Algorithm\"><a href=\"#Summary-of-DQN-and-Algorithm\" class=\"headerlink\" title=\"Summary of DQN and Algorithm\"></a>Summary of DQN and Algorithm</h4><ul>\n<li>DQN uses experience replay and fixed Q-tragets</li>\n<li>Store transition $(s_t,a_t,r_t,s_{t+1})$ in replay buffer $D$</li>\n<li>Sample minibatch of transitions $(s,a,r,s’)$ from $D$</li>\n<li>Compute Q-learning target with respect to old, fixed parameters $\\vec w^-$</li>\n<li>Optimizes MSE between Q-network and Q-learning targets</li>\n<li>Uses stochastic gradient descent</li>\n</ul>\n<p>The algorithm of DQN is shown below: </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F12.5.jpeg\" alt=\"\"></p>\n<h4 id=\"Double-Deep-Q-Network-DDQN\"><a href=\"#Double-Deep-Q-Network-DDQN\" class=\"headerlink\" title=\"Double Deep Q-Network (DDQN)\"></a>Double Deep Q-Network (DDQN)</h4><p>After the successful application of DQN to Atari, people become very interested in it and developed many other improvements, while DDQN and Dueling DQN are two very popular algorithms among them. Let’s talk about DDQN first. </p>\n<p>Recall in Double Q-learning, in order to eliminate maximization bias, two Q-functions are maintained and learned by randomly assigning transitions to update one of two functions, resulting two different sets of parameters, denote here as $w$ and $w’$. This idea can also be extented to deep Q-learning.</p>\n<p>The target network in DQN architecture provides a natural candidate for the second Q-function, without introducing additional networks. Similarly, the greedy action is generated accroding to the online network with parameters $w$, but its value is estimated by the target network with parameters $w^-$. The resulting algorithm is reffered as DDQN, which just slightly change the way $y_t$ updates: </p>\n<p>$y_t^{DDQN}=r_t+\\gamma\\hat q(s_{t+1},\\tt argmax_{a’}\\mit\\hat q(s_{t+1},a’,\\vec w),\\vec w^-)$. </p>\n<h4 id=\"Dueling-DQN\"><a href=\"#Dueling-DQN\" class=\"headerlink\" title=\"Dueling DQN\"></a>Dueling DQN</h4><p>Before we delve into dueling architecture, let’s first introduce an important quantity, the <em>advantage function</em>, which relates the value and Q-functions (assume following a policy $\\pi$): </p>\n<p>$A^\\pi(s,a)=Q^\\pi(s,a)-V^\\pi(s)$. </p>\n<p>Intuitively, the advantage function sbstracts the value of the state from the Q funciton to get a relative measure of the importance of each action. </p>\n<p>DQN approximates the Q-function by decoupling the value function and the advantage function. Figure 13 illustrates the dueling network architecture and the DQN for comparison. </p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/RLS6F13.png\" alt=\"Figure 13\"></p>\n<p>The different between dueling network and DQN is that, the dueling network uses two streams of fully connected layers. One stream is used to provide value function estimate given a state, while the other stream is for estimating advantage function for each valid action. Finally, the two streams are comined in a way to produce and approximate the Q-function. </p>\n<p>Why these two separated streams are designed? First, for many states, it is unnecessary to estimate the value of each possible action choice. Second, features required to determine the value function may be different than those used to accurately estimate action benefits. </p>\n<p>Let’s denote the scalar output value function from one stream of fully-connected layers as $\\hat v(s,\\vec w,\\vec w_v)$, and denote the vector output advantage function from the other stream as $A(s,a,\\vec w,\\vec w_A)$. We use $\\vec w$ here to denote the shared parameters in the convolutional layers, and use $\\vec w_v$ and $\\vec w_A$ to represent parameters in the two different streams of fully-connected layers. According to the definition of advantage function, we have: </p>\n<p>$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+A(s,a,\\vec w,\\vec w_A)$. </p>\n<p>However, the expression above is unidentifiable, which means we can not recover $\\hat v$ and $A$ form a given $\\hat q$. This unidentifiable issue is mirrored by poor performance in practice. </p>\n<p>To make Q-function identifiable, we can force the advantage function to have zero estimate at the chosen action. Then, we have: </p>\n<p>$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-\\tt max_{a’\\in A}\\mit A(s,a’,\\vec w,\\vec w_A))$. </p>\n<p>Or we can just use mean as baseline: </p>\n<p>$\\hat q(s,a,\\vec w,\\vec w_v,\\vec w_A)=\\hat v(s,\\vec w,\\vec w_v)+(A(s,a,\\vec w,\\vec w_A)-{1\\over|A|}\\sum_{a’}A(s,a’,\\vec w,\\vec w_A))$.</p>\n"},{"title":"Accelerated C++笔记","date":"2021-09-16T02:30:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/cpp.png","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/cpp.png","excerpt":"C++基础知识。","_content":"\n> 虽然两年前就已经接触过C++，但是之前短暂的学习根本不足以让我系统掌握这门语言的用法。现在由于有项目开发的需求，我决定重新开始较为系统地学习C++。由于有C语言的基础，在入门阶段我使用Accelerated C++这本书来学习。这本书虽然较为老旧，但是内容不多，读起来也比较轻松。这篇文章是对我在看书和编程时遇到的问题和重点的总结备忘，内容比较零碎，还请大家谅解。\n\n# 语言特性\n\n## 基础知识\n\n- 声明：告诉编译器有这个对象存在，不需要建立内存\n\n- 定义：需要建立内存的声明，也即实例化一个对象\n\n- `main`函数返回一个整数类型的值作为结果，`0`表示成功\n\n- `void`类型的函数可以不需要`return`语句，也可以写`return;`\n\n- 变量是一个具有名称的**对象**，对象是计算机中一段具有类型的内存空间（在C++中，一切皆对象）\n\n- 在花括号中定义的变量，作用域只在它所在的花括号中\n\n- 对象类型还有**接口**，接口就是可以对对象进行的操作的集合\n\n- 重载：\n\n  - 运算符的重载：一个运算符对于不同类型的操作数有不同的含义，如`1 + 1`与`'A' + 'B'`中的加号具有不同的含义\n  - 函数重载：两个功能不同的函数在具有相同名称时，当它们的参数不同时，会发生重载\n  \n- 关于`const`：\n  - `const`表示该值为常量（只读），必须在定义它时进行初始化，变量也可以对常量进行初始化\n\n  - 如果给一个引用常量对象的函数传输一个非常量对象，那么这个对象会被视为常量\n\n  - 不可以对常量对象调用非常量函数\n\n  - 关于`const`的位置：\n\n    - 修饰指针变量：\n\n      ```c++\n      const int* pt = &n;\t//指针所指的数据是常量，但是指针是变量，可以指向其他地址\n      int* const pt = &n;\t//指针所指的数据是变量，指针是常量，只能指向n的地址\n      const int* const pt = &n; //指针和其所指的数据都不可以改变\n      ```\n\n    - 修饰函数参数：\n\n      ```c++\n      int func(const int n) {}; //函数收到的参数是常量\n      ```\n\n    - 修饰成员函数：\n\n      ```c++\n      int func(int n) const {}; //成员函数不能修改任何除了mutable修饰的的成员变量\n                                //且不可调用非const成员函数\n      ```\n\n    - 修饰函数返回值：\n\n      ```c++\n      const int func(int n) {}; //函数的返回值是常量，一般不需要这样用\n                                //除了重载运算符外，一般不要将返回值类型定为对某个对象的const引用\n      ```\n\n- 关于`static`：\n\n  - `static`表示该变量或函数是静态的，只能声明定义一次\n  - 静态全局变量：具有全局寿命，在程序运行的整个过程中存在，它在进入`main()`函数初始化，在退出`main()`函数后被销毁，它只在声明它的文件中可见\n  - 静态局部变量：在函数第一次执行到声明它的语句时进行初始化，它具有全局寿命，但是只在声明它的函数中可见，在单线程时多次调用包含静态局部变量的函数不会导致该静态局部变量被多次定义与初始化\n  - 静态函数：它只在声明它的文件中可见，其他文件中可以声明名字相同的函数而且不会发生冲突\n  - 静态数据成员：可以让该类的所有对象访问，只初始化一次，而且可以实现全局变量做不到的信息隐藏，它需要在类外部进行初始化\n  - 静态成员函数：一般声明和定义都在类中，它只能访问其他静态成员函数和静态数据成员，它没有`this`指针\n    - 如果静态成员函数的声明在类中，定义在类外部，那么在外部定义时不能够加`static`关键字，否则就相当于声明了两次\n    - 静态成员函数没有与其关联的对象，它可以通过类名或者对象名直接访问\n  - 使用`static` 修饰的变量是可以修改的\n\n- 成员函数：某种类型的对象有一个或者多个函数成员，调用这些函数可以获得一个值，如`str.size()`可以获得字符串`str`的长度\n\n- `using`声明：作用域为它所在的花括号内\n\n  - `using namespace std;`：程序中默认使用`std`这个命名空间\n  - `using namespace-name::name;`：使用`name`指代`namespace-name::name;`\n  - `using std::cout;`：使用`cout`指代`std::cout`，并且我们不会定义自己的`cout`\n  \n- 类型转换的原则：较小的类型转换为较大的类型，有符号的类型会转换为无符号类型，算数值会被转换为布尔值，`0`可以视为`false`，而其他值都被视为`true`\n\n- 缺省初始化：一般来说，在对象定义时如果没有初始化，那么它的内容就是其内存单元中的随机内容，但是下面几种情况下，编译器会进行缺省初始化\n\n  - 全局变量\n  - 自定义类型的对象在没有初始化程序的情况下\n  \n- 左值与右值\n\n  - 左值：位置值，也即内存地址\n  - 右值：地址中存的值\n  \n- 增量/减量运算符（按照优先级排序）：\n\n  - `i++`：对`i`加一，并且返回原始值\n  - `i--`：对`i`减一，并且返回原始值\n  - `++i`：对`i`加一，并且返回相加后的值\n  - `--i`：对`i`减一，并且返回相减后的值\n  \n- 关于`clear()`方法：\n\n  - 对字符串：将字符串的首地址内容存放`\\0`\n  - 对向量：清空向量内容\n  - 对流：清除流内部的错误状态\n  \n- 泛型算法：可以用于不同类型的容器和不同的数据类型的算法\n\n- 迭代器适配器：是一个函数，会产生与其参数相关的属性的迭代器以做他用，它会按照它给定的方式来对迭代器进行操作，下面给出了一些例子：\n  - `back_inserter(des)`：将元素添加到`des`容器的末尾\n  - `front_inserter(des)`：将元素添加到`des`容器的头部（链表支持该种操作，向量和字符串不支持）\n  - `inserter(c, it)`：在`c`的迭代器`it`之前插入元素\n  \n- 不要将重载函数作为参数传递给模板函数，否则编译器将不知道需要使用的是重载函数哪个版本\n\n- 将函数作为参数：将函数作为参数时，在声明的时候参数函数的编写形式类似于函数的声明，返回值和参数函数的参数必须与参数函数相一致，但是名称不需要一致\n\n- 函数的缺省参数：在声明一个函数时，如果在参数后写上`= x`（`x`为某个值、序列、或者函数），那么这个参数默认值为`x`，在调用这个函数可以该参数缺省\n\n- 函数的递归调用：在函数内部调用自身\n\n- 内联函数：在函数声明与定义时，于函数名字前添加了`inline`关键字的函数，在编译时所有调用内联函数的地方都会被替换成函数体的代码以提高运行效率，对一般的函数，只有程序运行到调用函数的那个地方时，函数名才会被替代成相对应的函数代码，内联函数的长度不应超过10行\n\n- `main`函数：\n  - 完整形式：`main(int argc, char** argv)`\n  - 参数：\n    - `argv`：指向一个数组首元素地址的指针，数组中的每一个元素都是都指向一个字符串参数的指针\n    - `argc`：`argv`指向的数组中的指针个数\n  - `argv`的第一个元素指向编译出的程序的名字的字符串的首地址\n  - 在程序中可以直接使用这两个对象\n  \n- `NULL`，`nullptr`，`NaN`，`INF`\n  - `NULL`：历史上曾经用来指代空指针，现在已有了替代，值实际上是`0`\n  - `nullptr`：C++11引入的关键字，指代空指针\n  - `NaN`：表示*Not a Number*，无效数字\n  - `INF`：表示*Infinite*，无穷大，超出了浮点数的表示范围\n  \n- 如果非成员函数的调用位置在定义之前，那么需要先对其进行声明；如果调用位置在定义之后，就不需要声明了\n\n- 前置声明：如果两个类的定义是相互依赖的，那么在定义第一个类前必须先对第二个类进行前置声明，告诉编译器有这个类存在，否则会出现无穷嵌套的问题\n\n## 新类型\n\n### vector（向量）类型\n\n向量类型可以理解为大小可以按需要随意增长的数组\n\n- 定义：`vector<double> grade;`，该语句定义了一个类型为`double`类型的向量`grade`\n- 一个向量中的所有数值具有相同的类型\n- 需要使用`<vector>`头文件\n- `grade.push_back(x)`：将`x`添加到`grade`向量的末尾\n- 描述向量长度的数据类型：`vector<TYPE>::size_type`\n- 访问向量中的指定元素：类似于数组，如`grade[i]`，若一个向量有`grade.size()`个元素，那么它的第一个元素为`grade[0]`或者`grade.begin()`，最后一个元素为`grade[grade.szie() - 1]`或者 `grade.end()`\n- 删除向量中的元素：\n  - 使用`erase()`成员函数，如：`grade.erase(grade.begin() + i)`\n  - `erase()`会在删除掉一个元素的同时，将这个元素后面的元素向前移动一个单位\n  - `erase()`会返回一个迭代器（见下文），并且指向刚刚被删除的元素后面的那个元素\n- 向量元素的预分配：可以减少重复的内存分配带来的系统开销\n  - `v.reverse(n)`：对向量`v`保留`n`个元素的内存空间，但不进行初始化，该操作不会改变容器的大小\n  - `v.resize(n)`：给`v`一个长为`n`的新长度\n    - 新长度小于当前长度：向量位于长度`n`后的元素会被删除\n    - 新长度大于当前长度：向量当前长度后与长度`n`前的空余位置会添加上新的元素，并且会进行初始化\n\n### list（双向链表）类型\n\n链表中的每一个元素都有一个指针指向后一个元素，`list`（双向链表）的每一个元素都有两个指针，一个指向前一个元素，一个指向后一个元素。`list`的特性决定了我们可以快速地在容器的任何一个位置增删元素。在顺序访问的情况下，`list`的访问速度比`vector`差；但是对于大规模随机访问或者增删元素的情况，`list`的性能远远好于`vector`。\n\n- 定义示例：`list<double> grade;`\n- 需要使用`<list>`头文件\n- `list`不支持索引\n- 具有`sort()`成员函数，它有一个可选的参数`compare`用于提供排序的比较方法，如果不提供该参数则默认使用`<`来排序\n\n### 对string类型的新认识\n\n- `string`类型可以视为一种特殊的容器，它支持索引操作，也有相对应的迭代器（类似`vector`）\n- `substr(i, j)`成员函数：创建一个新的字符串来保存`s`在区间`[i,i+j)`中的索引指示的字符的复制\n\n### 对容器的一些其他操作\n\n- `c.rbegin()`：对于允许逆序访问的容器，该语句表示指向容器最后一个元素的迭代器，访问的顺序是逆向的\n- `c.rend()`：对于允许逆序访问的容器，该语句表示指向容器第一个元素之前的迭代器\n- `container<Type> c(c1);`：若`c1`存在，那么该语句表示定义一个容器`c`且其为`c1`的复制\n- `container<Type> c(n);`：定义一个有`n`个元素的容器`c`并根据`Type`对其元素进行初始化\n- `container<Type> c(n, t);`：定义一个有`n`个元素的容器`c`，`c`的元素是`t`的复制\n- `container<Type> c(b, e);`：定义一个有`n`个元素的容器`c`，`c`的元素是迭代器`[b,e)`之间的复制\n- `c.size()`：返回`c`中元素的个数，返回值类型为`size_type`\n- `c.empty()`：用于指示`c`中有无元素，如果没有的话返回`True`\n- `c.insert(d, b, e)`：复制`[b,e)`两个迭代器之间的元素，并将它们插入到`c`容器的`d`迭代器所指示的位置之前\n- `c.erase(b, e)`：从`c`中删除`[b, e)`两个迭代器之间的元素，对于不同的迭代器，该操作的速度有所不同\n\n### iterator（迭代器）类型\n\n迭代器用于代替索引，以库能控制的方式访问元素。\n\n- 每一个标准容器都有两种迭代器类型：\n  - `container-type::const_iterator`：使用该迭代器只能读容器中的元素\n  - `container-type::iterator`：使用该迭代器可以读也可以写容器中的元素\n  - `iterator`类型可以转换为`const_iterator`类型，反之不行\n- 使用例：`vector<double>::const_iterator iter = grade.begin();`，声明了一个名为`iter`的迭代器，且初始值为`grade`的第一个元素\n- 迭代器可以使用增量运算符（重载过）\n- 迭代器相当于是一个指针，可以使用`*`运算符间接引用迭代器所指向元素的内容（访问的是左值），在使用时应当注意运算符的优先顺序\n- 如果要获得迭代器引用的内容的一个元素，可以使用`*(iter).element`或者`iter -> element`两种方式访问\n- 注意，对于不支持随机访问索引操作的容器，**对迭代器的值进行手动更改（如给迭代器加或者减偏移量）将无法通过编译**\n- 删除迭代器当前所指示的元素会使得该迭代器失效\n- 对`vector`容器，`erase`和`push_back`操作会使得被操作以及之后的元素的迭代器失效，而对`list`容器则不会\n- 如果一个容器支持索引，那么它的迭代器也支持索引，如：`iter[2]`等价于`*(iter + 2)`，`iter[-1]`等价于`*(iter - 1)`\n\n### map（映射表）类型\n\n之前提到的向量、链表等容器都是顺序容器，而`map`则属于关联容器。关联容器的序列不依赖于插入元素时的顺序，它只依赖于元素本身的值。关联容器的特性可以使我们更快地对特定元素定位。\n\n- `map`容器中存储的是一个`键-值`对\n  - 键：有点类似于顺序容器中的索引，它指向一个存储空间\n  - 值：键所指向的存储空间中存放的内容\n- 声明例：`map<string, int> m;`，该语句声明了一个名为`m`，从字符串到整数的映射表，其键的类型为`string`，值的类型为`int`\n- 关联容器不可以对元素进行手动排序，一般不对关联容器的内容进行修改\n- 只要声明了一个关联容器，如果我们用一个未曾出现过的键作为映射表的索引，这个映射表会自动创建一个具有这个键的元素，且这个元素具有初始化的值，对于内部类型会被初始化为`0`\n- `pair`（数对）类型：该类型提供了访问映射表的键和值的能力，映射表中的每个元素都是一个数对\n  - 数对有两个成员，`first`成员包含了键，`second`成员包含了值\n  - 间接引用映射表迭代器时，获得的就是这个映射表关联的一个数对`pair<const T1, T2>`\n  - 注意，映射表的键是常量\n- `map`的访问方法：`m[key]`，使用键`key`来索引访问映射表并返回一个左值，如果对于这个键没有一个合适的项目，那么则会新建一个元素\n- `map`的另一种访问方法：若`iter`是一个映射表的迭代器，那么`iter -> first`可以得到数对的键，`iter -> second`可以得到数对的值\n- 常量映射表无法使用索引访问\n- `find()`成员函数：参数为需要查找的键，如果查找到了则返回一个指向这个元素的迭代器，否则返回映射表的末尾\n- 一般情况下`map`都是自动排序的，但是在可以通过`map<K, V> m(cmp);`语句在声明时使用`cmp`来人工确定元素的顺序\n\n### 自定义类型\n\n作为核心语言的一部分，`int` 、`char`、`double`等类型都是内部类型；而`vector`、`string`等类型属于标准库的内容，是自定义类型。用户可以自己定义新的类型，自定义其中的数据、函数、访问接口等，以此对数据结构进行封装。\n\n- 自定义类的格式：\n\n```c++\nclass Class_name {\npublic:\n\t//类型提供的接口\nprivate:\n\t//类型的实现\n};\n```\n\n- `public`：保护标识符，它指示类中的共有成员，类的所有用户都可以访问公有成员\n- `private`：保护标识符，它指示类中的私有成员，类的私有成员对用户来说是不可以直接访问的\n- 同样可以用`struct`关键字来自定义类，但是它与`class`有所区别，如：\n\n```c++\n struct Student_info {\n    string name;\n    double midterm, final;\n    unsigned int gender;\n    unsigned int age;\n};\n```\n\n​\t\t这里`Student_info`为一个具有5个数据成员的类型\n\n- 关于`class`和`struct`：`class`关键字声明的类型在第一个`{`和保护标识符之间的所有成员都是私有的，`struct`则相反\n\n- 自定义的类型只能出现一次，它只能出现在一个头文件中\n\n- 在类型内部自定义成员函数时，可以直接访问对象内部的元素\n\n- 如果是在头文件（`.h`）对应的源文件（`.cpp`）中定义的成员函数，函数的名字前必须加上`Class_name::`的作用域限定运算符，以明确函数是`Class_name`的一个成员函数，否则会出现函数未定义的编译错误\n\n- 将成员函数定义在类内部与类外部的区别：在类内部定义的成员函数，实际就是把函数的调用扩展成内联的，这样可以提高程序运行效率\n\n- 成员函数如果不是定义在类内部，**必须在相对应的源文件（`.cpp`）中定义**，否则会产生重复定义的问题（**模板类除外**）\n\n- 如果在自定义类与全局环境中有同名函数，在函数名字前加上`::`（该运算符左侧没有内容）代表使用的是全局韩静中的那个函数\n\n- 如果需要访问一个私有的数据成员，可以定义一个存取器函数（如下），但是它会破坏类的封装性：\n\n  ```c++\n  std::string name() const { return name; }\n  ```\n\n- 对声明为`static`的成员函数，它只能在类中定义\n\n#### 构造函数\n\n构造函数是类的一个特殊的成员函数，它定义了对象的初始化方式。它的名字是类的名字且没有返回值，它会在创建一个自定义类型的对象时被自动调用。\n\n- 如果没有自定义构造函数，那么编译器会为我们自己创建一个\n\n- 构造函数列表：在`public`作用范围内的构造函数的声明\n\n- 构造函数的定义：\n\n  ```c++\n  Student_info::Student_info(double midterm, double final);\n  ```\n\n  上面定义了一个参数为 `midterm`和`final`的构造函数，下面给出声明与初始化例：\n\n  ```c++\n  Student_info::Student_info stu(100, 99);\n  ```\n\n  上面声明并初始化了一个名为`stu`的`Student_info`类型的对象，并设置了其成员数据的值\n\n- 构造函数默认参数：构造函数的参数同样可以给定其默认值，从而可以进行缺省初始化\n\n- 缺省构造函数：不带参数的构造函数，如：\n\n  ```c++\n  Student_info::Student_info(): midterm(0), final(0) {};\n  ```\n\n  使用该方式同样可以进行对象的缺省初始化\n\n- 上面的语句中，`:`与`{`之间的内容为**构造函数初始化程序**，程序会用括号中的值初始化相应的数据成员\n\n- 创建一个对象时的过程：\n\n  1. 分配相对应的内存\n  2. 执行构造函数初始化程序\n  3. 执行构造函数函数体（在上面的例子中，函数体中没有内容）\n\n- 不建议在构造函数的函数体中对对象进行初始化，如果这样那就相当于对对象做了两次初始化\n\n- `explicit`关键字：函数名前添加了此关键字的构造函数只能在被显式调用时才能使用\n\n- \n\n#### 析构函数\n\n析构函数是在一个对象被删除的时候被调用的，它来定义如何删除一个对象的示例。\n\n- 析构函数的函数名是在类的名字前面加上`~`\n- 析构函数不带参数且没有返回值\n- 定义例：`~Student_info() {}`\n\n## 指针\n\n指针是一种随机存取的迭代器。\n\n- 一个指针是一个存放对象地址的值，一个对象是只包含它本身一个元素的容器，那么指针就是指向这个元素的迭代器\n- 对于一个指向对象`x`的指针`p`，有：\n  - `p`：`x`的地址\n  - `*p`：`x`的内容，也即有`*p = x`，这里 `*`是一个间接引用运算符\n  - `&x`：`p`的内容，也即有`p = &x`，这里`&`是一个取地址运算符\n- 一般使用`0`初始化指针变量，空指针的内容就是`0`\n- 指针具有类型，对于一种类型`T`，可以定义一个指向`T`类型的对象的指针：`T* p;`\n- 指针可以通过加减法修改它指向的值\n- 使用`ptrdiff_t`类型来表示两个指针的间距，它在`<cstddef>`头文件中\n- 野指针：指向被释放的内存空间的指针\n- 函数指针：\n  - 一个指针在声明时如果带上参数，那么他就变成了一个函数指针\n  - 示例：`int (*fp)(int);`，调用`fp`时以一个`int`类型的变量作为参数，同时返回一个`int`类型的结果，这意味着`fp`是一个具有一个`int`类型参数并且返回一个`int`类型结果的函数的指针\n  - 如果存在这样的一个函数：`int func(int)`，那么可以用`fp = &func;`或者`fp = func;`来让`fp`指向`func`\n  - 如果`fp`指向`func`，那么可以使用`(*fp)(i)`或者`fp(i)`的方式调用`func`，其中`i`为整型\n  - 如果将一个函数名作为另一个函数的参数，那么编译器会将这个参数转换成一个指向那个函数的指针\n- 使用指针时可能导致问题出现的原因：\n  - 复制一个指针时不会复制指针所指的对象\n  - 删除一个指针不会释放对象所占用的内存\n  - 删除一个对象但是没有删除指向该对象的指针会产生一个空悬指针\n  - 定义了一个指针但是不进行初始化\n  \n\n## 数组\n\n数组是最基础的容器，它是核心语言的一部分。\n\n- 数组元素个数必须在编译时确定，它不能动态增减尺寸\n- 使用`size_t`类型来表示一个数组的大小，它在`<cstddef>`头文件中\n- 对于一个有`n`个元素的数组，只有指向`[0,n)`的指针是合法的\n- 数组支持索引操作\n- 数组定义的两种方法：\n  - 只声明，需要显式地确定元素个数：`int num[5];`\n  - 定义的同时进行初始化，无需显式地确定元素个数：`int num[] = {1, 2, 3, 4, 5} ;`\n- 字符串实际就是一个字符类型的数组，它的最后一个字符为空字符`\\0`，使用`strlen`函数可以确定字符串的大小\n- `sizeof()`：返回一个`size_t`类型的值，其值以`bytes`为单位，如果需要返回数组的元素个数，那么可以用`sizeof()`的返回值除数组中每个元素占用空间的大小\n- 如果数组以指针的方式作为函数的参数，那么它会退化成一个指针，这个时候无法通过`sizeof()`得到指针所指数组的长度，只能得到指针所占空间的大小\n\n## 内存分配\n\n- 一般来说有三种分配内存的方法：\n  - 自动分配：在使用局部变量时就使用了自动分配内存的策略，用时分配，用完释放\n  - 静态分配：使用`static`关键字限定的对象，系统只会对它进行一次内存分配，直到程序结束才释放\n  - 动态分配：使用`new`与`delete`关键字分配的对象\n- `new`与`delete`：使用`new`创建的对象一直存在直到对其使用`delete`或者程序结束\n- 为对象分配或释放内存：\n  - `new T;`：为一个没有名字的`T`类型的对象分配内存\n  - `new T(args);`：与上面类似，但是内存中存有值`args`\n  - `int* p = new int(100);`：将一个`int`类型的指针`p`指向`new`开辟的存有`100`的内存空间\n  - `delete p;`：删除指针`p`并且释放其指向的内存空间\n\n- 为数组分配或释放内存：\n  - `new T[n];`：为一个具有`n`个`T`类型的对象数组分配内存，并且返回一个指向数组首元素的指针，数组中的每一个对象都会被默认初始化\n  - 在上面的表达式中如果`n`为`0`，那么数组中将没有任何元素，并且`new`无法返回一个有意义的指针\n  - `T* p  = new T[n];`：将指针`p`指向新开辟的数组的首地址\n  - `delete[] p;`：从后向前释放指针`p`指向的数组所用的全部内存空间，如果索引运算符内添加了索引，那么只释放索引指定的那个内存空间\n- `malloc()`函数：\n  - 库：`<stdlib>`\n  - 参数：`size_t`类型，为需要分配的内存空间大小\n  - 返回一个`void*` 类型（未知类型）的指针，在使用时需要进行强制类型转换，若失败则返回`NULL`\n  - 使用例：`char* cp = (char*)malloc(10);`\n  - `malloc`不会对分配的空间进行初始化，而`new`会\n- 内存分区：\n  - 堆区：由用户手动申请与释放，若不释放则在程序结束后释放，使用`new`或 `malloc`申请的内存在此区域\n  - 栈区：由系统管理，主要存放函数的参数以及局部变量\n  - 静态存储区：在编译时就已经分配好内存空间并且进行初始化，主要存放静态变量、全局变量以及常量\n  - 代码区：存放程序体的二进制代码\n- 内存分配器`allocator`：\n  - `allocator<T>`是一个类，它定义在`<memory>`头中，使用时需要加上`std::`\n  - 在使用`allocator<T>`类时，需要先将其实例化，如：`std::allocator<T> alloc;`\n  - 在程序中通过调用对象的成员函数来实现内存分配，下面是一些常用的成员函数：\n    - `T* allocate(size_t)`：用于分配一块长度为`size_t`，类型为`T`但并未被初始化的内存块，并返回这块内存的地址\n    - `void deallocate(T*, size_t)`：用于释放未被初始化的内存，第一个参数为`allocate`函数返回的指针，第二个参数为指针指向的内存块的大小\n    - `void construct(T*, T)`：用于对使用`allocate`函数分配的未初始化的内存进行初始化，第一个参数为`allocate`函数返回的指针，第二个参数需要复制的初始值\n    - `void destroy(T*)`：用于删除指针所指的对象，它会调用析构函数\n- 另外两个内存分配中可能有用的库函数：\n  - `T* std::uninitialized_copy(T*, T*, T*)`：用于将前两个参数指针所指的区域中内存的值复制到第三个参数指针指向的目标内存块中，并且返回一个指向被初始化的你内存中的末元素后一个元素的地址\n  - `void std::uninitialized_fill(T*, T*, const T&)`：用于向前两个参数指针所指的区域的内存中复制第三个参数所引用的值\n\n## 泛型函数\n\n- 含义：不知道参数和返回值类型的函数，用于解决一类抽象问题\n- 函数中使用的变量必须支持函数中所进行的操作\n\n### 模板函数\n\n泛型函数的具体实现。模板函数可以让不同的对象享有共同的行为特性，在定义模板函数的时候我们不知道模板参数对应的特定类型。下面给出了定义模板函数的示例：\n\n```c++\ntemplate <class T>\nT function(vector<T> v)\n{\n    //函数内容...\n}\n```\n\n- `template <class T>`定义了一个模板头，它告诉系统环境定义了一个模板函数，而且这个函数有一个类型参数\n- 如果要使用嵌套类型（也即由模板参数定义的类型），那么必须要使用`typename`关键字，如：`typedef typename vector<T>::size_type vec_sz;`，使系统将这个名称当做一个类型处理\n- 模板函数的实例化过程在不同系统下有所不同\n- 模板函数的正确性是由参数之间的正确关系决定的，如果参数之间产生了可能导致歧义和信息丢失的关系，那么这个函数的程序很有可能是有错误的，甚至无法通过编译\n- 在编写模板函数的时候，为了使函数可以处理存储于各种数据结构中的数值，并且能够作用于容器的一部分而非整容器，一般我们使用迭代器参数而不是容器参数\n\n### 迭代器的类型\n\n下面的迭代器每一种都对应了一个特定的迭代器操作集合，每一个迭代器种类还对应了一个访问容器的策略，同时也对应了特定的算法。在编写模板函数时需要注意不同迭代器的选择。\n\n- 输入迭代器`In`：该种迭代器对一个序列提供了**顺序只读访问**的操作，它支持的操作有：`++`、`==`、`!=`、`*(读)`\n- 输出迭代器`Out`：该种迭代器对一个序列提供了**顺序写入**的操作，它要求调用它的程序不可以在对迭代器的两个赋值之间执行超过一次的自增操作，也不能在没有对迭代器递增时对其多次赋值\n- 正向迭代器`For`：该种迭代器对一个序列提供了**顺序读-写访问**的操作，它可以在对一个元素赋值后再读取它的值，因此不需要满足输出迭代器的一次赋值要求，它支持的操作有：`*(读写)`、`++`、`==`、`->`，所有的标准库容器都满足正向迭代器的要求\n- 双向迭代器`Bi`：该迭代器对一个序列提供了**可逆读-写访问**的操作，它不仅有正迭代器的功能，还支持`--`（也即逆序访问）的操作，所有的标准库容器都支持双向迭代器\n- 随机迭代器`Ran`：该迭代器对一个序列提供了**随机访问**的操作，它的行为有点类似索引，不仅有双向迭代器的功能，而且支持算术运算，若`p`和`q`是两个迭代器，那么它们支持：`p + n`、`p - n`、`n + p`、`p - q`（得到的是两个迭代器之间的距离，整型）、`p < q`、`p > q`、`p >= q`，向量和字符串迭代器都是随机访问迭代器，而链表迭代器则是双向迭代器\n\n## 模板类\n\n模板类用于生成一个类，这个类生成的多个对象可以分别存储不同类型的数据。模板类相当于定义了存储自定类型的数据结构的一个容器。\n\n- 声明例：\n\n  ```c++\n  template <class T> class Name {\n  public:\n  \n  private:\n  \n  };\n  ```\n\n- 上面的语句声明了一个名字为`Name`，可以存储并处理`T`类型数据的模板类，这里的`T`类型会在将这个类实例化的时候确定，如`Name<int> N;`使用`Name`模板创建了一个`T`为`int`类型的对象\n\n- **模板类的声明和实现必须全部写在头文件中**\n\n- 模板类的成员函数如果需要在类外部定义，那么为了将函数的作用域明确为在类的内部，需要做以下更改：\n\n  - 在函数的定义前面加上`template <class T>`\n  - 在函数名前面添加`Name::`\n  - 在所有的`Name`后面添加`<T>`\n\n- 自定义模板类的时候一定要全面地考虑其初始化、内存分配、复制的问题，必要时可以自定义这些操作\n\n- 模板类的构造函数例：\n\n  - `Name() {}`：最普通的无参构造函数\n  - `Name(size_type n, const T& val = T()) {}`：该构造函数的参数为一个指定了对象大小的`size_type`类型的参数`n`，以及提供了初始化的默认值的`const T&`的参数，它的缺省值由`T`的构造函数提供\n\n- 可以使用`typedef`关键字来自定义类型名，如：`typedef T* iterator;`\n\n- 运算符重载：在自定义类中可以对内置的运算符进行重载以实现需要的功能，如：\n\n  ```c++\n  T& operator[](size_type i) { return data[i]; }\n  const T& operator[](size_type i) const { return data[i]; }\n  ```\n\n  - 运算符重载的声明有点像定义了一个`operator\"运算符\"`函数\n  - 如果需要使运算符不改变对象的值，那么就在运算符重载的定义前面以及函数体前面加上`const`关键字\n  - 如果某个重载运算符函数是类的一个成员函数：\n    - 它的左操作数（二元运算符）或者唯一的操作数（一元运算符）必须是调用它的对象\n    - 它的左操作数（二元运算符）会以`this`指针的方式默认地传递给这个成员函数\n  - 如果某个重载运算符函数不是类的一个成员函数，那么重载运算符函数的第一个参数是左操作数，第二个参数是右操作数\n\n- `this`指针：`this`关键词只在成员函数内部有效，代表指向函数操作对象的指针，指针的类型由函数的操作对象决定\n\n- 复制控制：\n  - 复制构造函数：用于复制一个已经存在的同类型的对象，以此来初始化一个新的对象，它只带一个与类本身类型相同的参数，并且由于复制不应该改变已有对象的值，因此它的类型应该为常量引用类型\n  - 复制构造函数的函数体应该为自定义的复制操作，如果函数体为空，那么将使用系统默认的方式进行复制\n  - 在复制对象时，由于对象的副本的地址与原对象不同，因此不可以将原对象中指向原对象本身的指针同时复制过去，应当重置这些指针使得它们对新对象有意义\n  \n- 赋值运算符：\n  - 赋值操作函数：把一个对象中已经存在的值**擦除**，然后装入一个新的值\n  - 类中可以重载赋值运算符，如：`Name& operator=(const Name& n) {}`\n  - 这里的参数为右操作数的一个引用\n  - 在函数体内可以通过该语句判断是否是自我赋值：`&n != this`，该语句比较了左右操作数的地址，如果两者相等则为自我赋值\n  - 赋值与复制的区别：复制是将一个值插入一个新的对象，不需要删除操作\n  - 构造函数只控制初始化操作，`operator=`函数只控制赋值操作\n  \n- 在使用`=`为变量赋初始值时调用的是赋值构造函数，在赋值表达式中`=`调用的是赋值操作函数\n\n- 如果一个类没有显式地定义构造函数或者析构函数，那么编译器将自动生成执行这些操作的默认函数\n\n- 默认的析构函数在删除一个指针变量时不会释放该指针指向的对象占用的内存空间\n\n- 三位一体原则：如果类需要一个析构函数，那么它同时有可能需要一个复制构造函数和一个赋值操作函数\n\n- 友元函数：如果一个函数定义在类的声明外部，但是又需要它具有访问`private`成员数据的权限，那么可以在类内部声明这个函数时，前面加上`friend`关键字，将其声明为一个友元函数\n\n- 模板特化：只有当模板类的实际的对象类型`T`为指定类型时，才调用指定类型对应的模板成员函数，声明与定义如下：\n\n  ```c++\n  template<>\n  int function(int var)\n  {\n  \t...\n  }\n  ```\n\n## 对象的初始化\n\n- 初始化与赋值：\n  - 初始化：在创建一个变量时赋予它一个初始值\n  - 赋值：将对象的当前值擦去，并且用一个新值替代\n- 下列情况发生时会进行初始化：\n  - 声明一个变量\n  - 函数入口处用到函数参数\n  - 函数返回处用到函数返回值\n  - 构造初始化\n- 通过显式地调用构造函数进行初始化称为**显式初始化**，否则称为**隐式初始化**\n- 使用`=`初始化一个对象称为**拷贝初始化**，不用等号则是**直接初始化**\n- 如果对象没有进行显式初始化，则会进入**隐式初始化**的**状态**，在**隐式初始化**状态下会进行**缺省初始化**的**过程**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \n- 关于不同种类对象的缺省初始化方式：\n  - 全局或者静态的对象：空串或者`0`\n  - 对象为局部的内部类型：未定义的值\n  - 内部类型作为类的成员：在某些条件下会被数值初始化为`0`\n  - 自定义类型且有构造函数：使用构造函数初始化\n  - 自定义类型且无构造函数：递归地对对象中的每一个数据成员进行相应的数值初始化或者缺省初始化\n\n## 类型转换\n\n- 自动类型转换：\n  - 自动转换的例子很常见，如将`int`类型的右值赋给`double`类型的左值时，该右值就会被自动转换为`double`类型\n  - 自动类型转换分为下面两种情况：\n    - 内置类型向自定义类型转换\n    - 自定义类型向内置类型转换\n  - 内置类型转换为用户自定义类型：需要在自定义类内部编写带单参数的构造函数\n    - 例如：`Name(const char* cp) { //将参数提供的内容存入临时的Name类型的对象中 }`，对`Name`类型，该构造函数会在编译器需要一个`Name`类型的对象却收到了一个`const char*`类型的对象的时候被调用\n  - 用户自定义类型转换为内置类型：需要在自定义类内部编写如下例所示的成员函数\n    - 例如：`operator int() { //将自定义类型转换为int类型 }`，该函数会在显式强制转换或者对象传入的值类型不符时被调用，函数的返回值为由其类型名确定\n- 如果两个类之间彼此定义了向另一个类的转换操作，会导致转换时出现二义性\n- 混合类型表达式：混合类型表达式意为在一个语句中使用运算符同时操作不同类型的对象的表达式，它在实现的过程中会进行多次类型转换，同时产生大量的临时变量，比较浪费内存\n\n## 引用\n\n- 形如`int& i;`的变量即为引用变量，左侧的表达式是对其进行声明的过程\n- 如果存在一个整型变量`temp`，那么令`i = temp;`，则`i`指向的内存位置与`temp`相同，`i`相当于是`temp`的一个别名\n- 引用作函数参数：\n  - 非常量引用：`int function(vector<string>& count);`，形式参数`count`存放的是实际参数的地址（`&`的意思有一些像取地址，但是二者是有区别的），可以直接在函数内更改实际参数的值，而且不需要重新复制一个变量，减少资源消耗\n  - 常量引用：`int function(const vector<string>& count)`，常量引用只能藉由实际参数的地址读取它的内容且无法进行修改，该操作同样不需要重新复制变量\n  - 一般来说，对于`int`或者`double`类型的参数可以不需要引用，因为对它们的复制是非常快的\n- 值类型作函数返回值：\n  - 对于值类型的返回值，编译器会先将这个值复制到一个临时变量内并且返回这个临时变量\n  - 函数调用完成，这个临时变量在被使用一次后（也可能不被使用），它即被销毁\n- 引用作函数返回值：\n  - 引用作函数返回值的时候，不可以引用局部变量，因为函数调用完成后局部变量就被销毁，这个引用就无效了\n  - 当引用作函数返回值时，不需要将变量重新复制一次保存在临时变量中\n  - 引用作返回值时可以作为左值\n\n## 继承\n\n### 基本概念\n\n- 定义：\n\n  ```c++\n  class A {\n  \tpublic:...\n  \tprivate:...\n  };\n  \n  class B: public A {\n  };\n  ```\n\n  - 上面定义了一个类`B`，它是从`A`中继承而来，称`A`是基类（或者父类），`B`是继承类（派生类、子类）\n  - 这里派生类继承了基类的公有部分，也即基类的公有成员才是子类的一部分\n  - 同样可以使用`private`或者`protected`关键字来指定继承的方式\n\n- 继承关系是可以嵌套的\n\n- 基类和继承类的关系：基类就是继承类，继承类不是基类，对于他们的引用或者指针同样有这个关系\n\n- 基类不可以强制转换为派生类\n\n- 关于基类或者继承类作为函数参数：\n\n  - 形式参数与实际参数匹配的情形不讨论\n  - 如果形式参数是基类类型的，传入一个继承类的对象会将其转换为基类\n  - 如果形式参数是继承类型的，那么实际传入的对象只有继承类的部分\n\n- `protected`：保护标识符，它指示类中的保护成员，类的保护成员可以被其继承类访问\n\n- 如果需要显式地表明某些成员是继承来的或者明确指明调用基类或者继承类的成员函数，可以使用范围（作用域）运算符\n\n- 构造初始化器：也即构造函数，在使用构造初始化器时直接将相应的参数填入构造函数中即可，编译器会根据参数的类型匹配相应的构造函数\n\n- 派生类对象构造的步骤：\n\n  - 为整个对象分配内存空间\n  - 隐式（或者显式）调用基类的构造函数来初始化对象中的基类部分数据\n  - 用构造初始化器对派生类部分的数据进行初始化\n  - 如果有的话，执行派生类构造函数的函数体\n  \n- 继承关系中成员函数的覆盖：如果基类与继承类中有两个同名同参同返回值类型的非`const`函数，那么派生类的这个函数会覆盖基类的函数，当基类与继承类的函数都返回指向他们本身类型的指针时除外\n\n### 虚函数\n\n- 定义：在基类中定义成员函数时前面加上`virtual`关键字，在继承类中同名同参函数的`virtual`的特性也会被继承，因此不需要重复加\n- 虚函数必须要有定义，不能只有声明\n- 功能：由于继承类也是基类，因此当以引用或者指针的形式调用成员函数时，程序根据实际的对象类型来在基类与继承类中选择正确的同名成员函数，也即**动态绑定**\n- 静态绑定：在编译时就确定调用的对象的成员函数的种类\n- **多态**：用一个类型表示多种类型的能力，这里动态绑定实现了多态\n- 只有在*以引用或者指针的形式*调用虚拟函数的时候在运行时选择类型才有意义\n- 虚拟析构函数：当使用指针来控制对象时，调用`delete`函数会调用这个虚拟析构函数，一般虚拟析构函数都是空的\n- 如果基类与继承类中有同名不同参的函数，那么他们之间毫无关系，不需要用到需函数的技术\n- 如果在构造函数内部调用虚函数，那么它会静态绑定成正在构造的对象所属于的类中的那个虚函数\n\n### 代理类\n\n- 代理类实际上就是一个普通的用户自定义类，它的成员数据是指向基类的指针\n- 功能：存储和管理基类指针，这个基类指针既可以指向基类对象又可以指向派生类对象，使用代理类可以实现动态绑定，它将基类和派生类中的细节封装起来，提供了一个统一的接口\n- 代理类中一般包含这些实现细节：\n  - 各种构造（析构）函数与复制控制函数：用于提供分配或者销毁内存空间的操作\n  - 基类和继承类中共有的操作：提供操作接口，实现动态绑定的功能\n  - 其他操作\n- 关于代理类的复制操作：需要在它管理的基类和继承类中定义虚拟的复制控制函数，并且在代理类的复制操作中调用它，在复制时有必要判断指向被复制对象的指针是否时空指针\n- 友元类：将一个类声明为另一个类的友元可以使另一个类中的所有成员都成为那个类的友元\n\n## 句柄类\n\n- 功能：上面提到的代理类可以视为一种简单的句柄类，但是它是通过复制对象来实现动态绑定的，句柄类的最主要功能就是实现在不用复制对象的情况下就实现动态绑定并且自动管理内存\n- 一般来说，句柄类是一个模板类，因为它与它操作的模板之间是相互独立的，句柄类具有通用性\n- 与代理类相似，句柄类要将被控制的类的全部接口封装起来\n- 复制操作：在复制时需要将该句柄类的指针当前所指向的对象删除后再重新将指针指向被复制的对象的地址\n- 使用方法：在实际的程序中，通常使用一个接口类来管理基类与继承类，接口类的成员数据是一个句柄类，接口类通过操作句柄类来控制基类与继承类\n- 接口类的构造函数必须对句柄类做初始化\n\n### 计数句柄类\n\n- 相比于一般的句柄类，计数句柄类在复制对象时会有选择的对底层的对象进行复制，这意味着计数句柄在复制时并不总是将底层对象的内容重新拷贝一份，而是让多个复制出来的句柄的指针同时指向同一个底层对象\n- 为了实现上面的功能，需要在句柄类添加一个**引用计数**指针，它用来记录有多少个对象指向底层对象\n- 复制构造函数：计数句柄类的复制构造函数不需要复制底层的对象，它的基本操作如下：\n  - 对右操作数所指向的对象的引用计数指针加一，表示有一个新的计数句柄类指向同一个底层对象\n  - 如果当前左操作数的引用计数指针值为`1`，那么意味着没有其他句柄指向这个底层对象了，复制操作会将左操作数的指针覆盖掉，所以这里将左操作数指向的对象和其计数指针所占的内存空间释放掉\n  - 将右操作数的对象指针和引用技术指针的复制到左操作数中\n- 析构函数：同样要考虑当前的句柄类是不是最后一个指向该对象的句柄，具体操作不再赘述\n- 在修改句柄类指向的对象的值时，亦需要考虑当前的句柄类是不是最后一个指向该对象的句柄，如果是的话，那么直接修改这个指针指向的对象的值即可，否则要先将当前所指向的对象的引用计数减一，然后基于旧对象复制一个新对象并将指针指向它，并将它的引用计数设为一，上述的操作可写为成员函数并在接口类中调用\n\n## 抽象基类\n\n- 概念：抽象基类是一种接口类，它用于提供一类对象的基本特征，然后再通过由其派生初来的派生类来实现可以归入该类对象下的其他特定类型的对象的详细特征\n- 一般来说，抽象基类使用纯虚函数来实现这种特性\n- 抽象基类可以使用句柄类来自动管理内存\n\n### 纯虚函数\n\n- 纯虚函数的函数体为`= 0`，它没有具体的实现，声明例如下：\n\n  ```c++\n  virtual void display() = 0;\n  ```\n\n- *含有纯虚函数的类就是一个抽象基类*，它不能有一个实际的对象\n- 纯虚函数在抽象基类的派生类中得到实现\n- 如果在派生类中继承而来的纯虚函数没有定义，那么它仍然是一个纯虚函数\n\n## 输入与输出\n\n- 标准输出流：\n\n  ```c++\n  std::cout << \"output\" << std::endl;\n  ```\n\n  - 上面的语句中，`std`为命名空间，命名空间是为了区分在不同的库中，两个名字相同但是功能不同的函数\n  - `::`为作用域运算符\n  - `<<`为标准库的输出运算符\n  - `std::cout`为标准输出流\n  - `std::endl`为输出的结束，该**控制器**会刷新输出缓冲区，并且进行换行，如果没有使用此控制器或者人为添加换行符，那么输出内容不会换行\n  - 控制器：在流中的控制器用于控制这个流\n  - 两个以上的字符串如果只是由空格分开，在输出流中它们会自动连接起来\n  - 控制器`setprecision(x)`：用于为后续输出设定`x`位有效位数，一般可以这样使用（使用完后注意重置为默认值）：\n\n    ```c++\n    //先保存初始的输出精度\n    streamsize prec = cout.precision();\n    //在输出流中调整输出精度为x后再调整回默认值\n    cout << setprecision(x) << grade << precision(prec);\n    ```\n\n  - 注意，在输出流中如果存在多个步骤，如输出流中调用了函数，即使程序仍然会按照流的顺序输出内容，但是程序的执行顺序有可能不是按照流的输出顺序执行的，这样有可能造成程序逻辑上的混乱\n\n  - `setw(length)`函数的使用：\n    - 使用例：`cout << setw(10) << name << endl;`\n    - 属于控制器，用于控制输出字段的长度\n    - 当后面紧跟着的输出字段长度小于`length`的时候，在该字段前面用空格补齐，当输出字段长度大于`length`时，全部整体输出\n    - 默认是右对齐，如果需要左对齐，可以在其前面添加`left`控制器\n\n- 标准输入流：\n\n  ```c++\n  std::cin >> name;\n  ```\n\n  - `cin`为标准输入流，`>>`运算符将输入的东西保存到`name`中，直到遇到**空白字符**或者**EOF**标记\n  - 空白字符：空格，制表键，换行符，回退键\n  - EOF：在Windows系统下，EOF为`CTRL+Z`，在Linux或者Unix系统下则为`CTRL+D`\n  - 输入时`cin`会略去首先输入的空白字符\n  - `cin >> a >> b;`等价于`cin >> a; cin >> b;`\n\n- 循环输入：\n\n  ```c++\n  while (cin >> x) {\n  \t//循环内容\n  }\n  ```\n\n  - 原理：输入首先会保存在缓冲区，然后直到按下回车，输入会以空白字符为界，按顺序将一串数据一个一个存储到变量`x`中，并且每存储一次就执行循环中的内容，直到遇到非法输入（类型与`x`不同）或者EOF退出循环\n\n- 缓冲区：输出/输入库会将输出保存在缓冲区中，只有在必要的时候，缓冲区的内容才会被送到输出装置中，从而将多个输出操作合为一个\n\n- 缓冲区刷新的几种情形：\n\n  - 缓冲区满\n  - 程序请求库从标准输入流中读取数据\n  - 手动刷新缓冲区\n  \n- 流迭代器：\n\n  - 在`<iterator>`中定义，使用时必须指明类型\n  - 输入流迭代器`istream_iterator<Type>(cin)`：迭代器的参数是可选的，通常情况下将其与`cin`连接，从这里读值，该迭代器缺省值的性质是，一旦到达了文件末尾或者处于错误状态，那么这个迭代器会与缺省值相等\n  - 输出流迭代器`ostream_iterator<Type>(cout, string)`：迭代器的第一个参数为`cout`，说明迭代器会往`cout`中写内容，第二个参数指定了一个值（一般是字符串），这个值会写在每个元素之后，这个参数也可以缺省\n  - 流迭代器的本质是模板\n\n- 头文件`<cctype>`中的几个有用的函数：它们在字符`c`满足后面的条件时返回`True`\n\n  - `isspace(c)`：空白\n  - `isalpha(c)`：字母\n  - `isdigit(c)`：数字\n  - `isalnum(c)`：数字或者字母\n  - `ispunct(c)`：标点符号\n  - `isupper(c)`：大写字母\n  - `islower(c)`：小写字母\n\n- 标准错误流：\n\n  - `cerr`：即时输出错误信息，保证一旦发生异常就立刻输出信息\n  - `clog`：倾向于生成日志，它具有着与`cout`一样的缓冲特性，平时存储错误信息，在适当的时候输出\n\n- 文件的输入与输出：\n\n  - `ifstream`：是一个用于读取文件内容的对象的类型\n\n  - `ofstream`：是一个用于向一个文件输出内容的对象的类型\n\n  - 上面两个类型定义在`<fstream>`中，使用时需要先将这两个类型的对象实例化，并且将字符串形式的文件名作为参数\n\n  - 在使用这两个类型的对象时有点类似于`istream`和`ostream`\n\n  - 使用例：\n\n    ```c++\n    ifstream infile(\"in\");\t//定义了一个与in文件相关联的文件输入流\n    ofstream outfile(\"out\");\t//定义了一个与out文件相关联的文件输出流\n    string s;\n    while (getline(infile, s)) {\n    \toutfile << s << endl;\n    }\n    ```\n  \n  - 注意：文件的路径如果使用的是相对路径，那么在调试时是工作区的目录的相对路径，在直接运行程序时则是相对于可执行文件所在位置的相对路径\n\n## 流程与异常控制\n\n### 不变式\n\n不变式可以理解为，一个类或者对象在设计的时候，对它的假设条件，在它的整个生命周期内，这些必须恒为真。例如：\n\n```c++\n//这里假设loop已经输出的行数\nint loop = 0;\nwhile (loop != rows) {\n\t//输出一行...\n}\n```\n\n这里`int loop = 0;`就是一个不变式，它在生命周期中，必须时刻等于输出的行数，否则会导致逻辑和程序流程控制的混乱，由于在这里不变式作为循环的一个判断依据，因此也被称为循环不变式\n\n### 异常控制\n\n异常控制用于给程序的使用者给出错误提示，提高程序的鲁棒性。程序抛出异常后，会在抛出异常的地方终止执行并且跳转到程序的另一部分（有点类似于中断），并向该部分提供一个异常对象，异常对象中含有程序可以处理异常信息。例如：\n\n```c++\ntry {\n  //该部分中任何一个语句发生了domain_error异常，都会停止执行下面的其他语句，转到执行catch下的语句\n  //如果没有发生异常，那么将不会执行catch中的语句\n} catch (domain_error e) {\n  //发生异常后执行的语句\n  //创建了一个异常对象e，名为what的成员函数用到了被复制下来的异常参数\n  cout << e.what();\n}\n```\n\n应当在编程时加入判断，是否满足产生异常的条件，如：\n\n```c++\nif (something == 0) {\n    throw domain_error(“Invalid Value!”);\n}\n```\n\n上面的语句意为，当满足条件时，程序会抛出一个`domian_error`，这种错误类型为域错误，即输入在定义域外的情况。C++中还有许多其他的错误类型可供使用，如`logic_error`，`runtime_error`等。\n\n## 多文件编程\n\n- 文件种类：\n\n  - `main.cpp`：主函数所在的文件\n  - `file_x.h`：头文件\n  - `file_x.cpp`：其他源代码文件\n  ......\n\n- 头文件的写法：\n  ```c++\n  #ifndef FILE_X_H\n  #define FILE_X_H\n  \n  //#ifndef必须位于文件的第一行\n  //不要在头文件中使用using声明，为用户保留最大的灵活性\n  //在头文件中包含其对应的源文件中所有需要用到的库\n  //在头文件中声明对应源文件中定义的函数\n  \n  #endif\n  ```\n\n- `#include <系统环境提供的头文件>`，`#include “自己写的头文件.h”`\n\n## 部分库函数\n\n### sort()\n\n- 库：`<algorithm>`\n\n- 参数：\n\n  1. 迭代器，序列的起始\n  2. 迭代器，序列的末尾\n  3. 谓词，可选参数，是自定义的比较方法\n- 功能：用于比较向量中的内容并按顺序存放，在未注明的情况下，对任何待排序的向量元素类型，它都会使用`<`来操作\n- 关于谓词：是一个函数，返回需值是布尔值\n\n### getline()\n\n- 库：`<string>`\n- 参数：\n  1. 输入流，一般为`cin`\n  2. 字符串引用，直接填目标字符串的名字\n- 功能：用于读一行的内容并将这些内容存储到目标字符串中\n- 如果遇到文件结尾或者无效输入，`getline()`的返回值会指示失败\n\n### copy()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示需要复制的元素的开头\n  2. 迭代器，指示需要复制的元素的末尾后一个元素\n  3. 迭代器适配器\n- 功能：将`[b,e)`之间的元素按迭代器适配器指定的方式添加到目标容器的末尾\n\n### equal()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 迭代器，指示第二个序列的开头（或者末尾）\n- 功能：从第二个序列的开头（或者末尾）开始，按顺序一个元素对应一个元素地比较两个序列中的内容，如果相等的话则返回`True`\n\n### find()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 被查找的值\n- 功能：在指定的序列中查找是否存在第三个参数的值，如果找到了，则返回序列中第一次出现这个值的位置，否则返回这个序列的末尾\n\n### find_if()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示被查找的序列的开头\n  2. 迭代器，指示被查找的序列的末尾\n  3. 谓词，检测自己出参数并且返回一个布尔值\n- 功能：对序列中的每个元素都调用谓词，直到谓词产生一个`True`的结果，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器\n\n### search()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示被查找的序列的开头\n  2. 迭代器，指示被查找的序列的末尾\n  3. 迭代器，指示查找的目标序列的开头\n  4. 迭代器，指示查找的目标序列的末尾\n- 功能：查找第一第二个参数所指示的序列中有没有第三第四个参数所指示的序列，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器\n\n### transform()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示待转换序列的开头\n  2. 迭代器，指示待转换序列的末尾\n  3. 迭代器，存放处理后的元素的容器的开头\n  4. 函数，`transform()`将这个函数作用于待转换序列以获得期望得到的元素\n- 功能：对待转换序列中的元素执行指定函数，并将转换后的结果存储于第三个参数指定的序列中\n\n### accumulate()\n\n- 库：`<numeric>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 单一变量\n- 功能：将序列中的元素之和加上变量中的值后再存储到这个变量中\n- 注意，第三个变量中的值类型会影响最终的结果的类型\n\n### remove_if()，remove()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 谓词，返回一个布尔值\n- 功能：排列序列中的内容，它将视那些使得谓词为`True`的元素所在的位置为空闲位置，并将后面那些使谓词为`False`的元素依次放置在空闲位置中，它的返回值是一个迭代器，它指示了那些所有使谓词为`False`的元素的末尾的位置\n- `remove()`的前两个参数含义与`remove_if()`相同，但是第三个参数是一个值，该函数的作用与`remove_if()`相同，不同之处在于是移动了那些等于第三个参数的元素\n\n### partition()，stable_partition()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 谓词，返回一个布尔值\n- 功能：两个函数的功能都是将谓词作用于序列中的元素，然后将那些使得谓词为`True`的元素位于序列的头部，返回一个指向第一个使得谓词为`False`的元素的迭代器，它们的区别在于`stable_partition()`会保持元素的顺序不变，而`partiotion()`则有可能导致元素的顺序混乱\n\n### rand()\n\n- 库：`<cstdlib>`\n- 参数：无\n- 功能：在`[0,RAND_MAX)`之间返回一个伪随机数，`RAND_MAX`是一个大整数，它也是在`<cstdlib>`中定义的\n- 如何返回在某个指定范围内的随机整数：基本思想是将可以利用的随机数分为长度相等的存储桶，存储桶的个数就是我们需要的随机数的最大值，然后再计算一个随机数并且返回它所在的桶的编号，程序如下：\n\n```c++\nint nrand(int n)\n{\n\tif (n <= 0 || n > RAND_MAX) {\n\t\tthrow domain_error(\"Argument to nrand is out of range. \");\n\t}\n\t\n\tconst int bucket_size = RAND_MAX / n;\n\tint r;\n\tdo r = rand() / bucket_size;\n\twhile (r >= n);\n\treturn r;\n}\n```\n\n# 编程习惯\n\n该部分的内容很多，涉及范围也很广，因此在这里我只纪录根据我个人实际情况需要注意的要点。更全面和详细的内容可以参考[C++ 风格指南 - 内容目录 — Google 开源项目风格指南 (zh-google-styleguide.readthedocs.io)](https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents/)。\n\n- 在编写运行时间较长的程序时，应当在合适的时刻刷新缓冲区\n- 循环的计数习惯：一般循环中的计数变量（假设为`i`）都从`0`开始，这样它的含义就比较明确，也即，`到目前为止，我们已经操作了i次`，此外这样做还有一个好处，那就是我们可以把循环条件设为`i != expected_loop_times`，这个不等式明确地表明了，当循环退出时，我们已经循环了`expectation_loop_times`次\n- 在定义一个变量来保存特定的数据结构时，应该使用库中为特殊用途而定义的类型，如现在想要顶一个存储字符串长度的变量`length`，那么可以有：`std::string::size_type length;`，另外还可以对库中提供的特殊类型重命名，如：`typedef std::string::size_type str_size;`就是将`std::string::size_type`这一类型在作用域内使用`str_size`来指代\n- 在操作容器中的多个元素时，推荐使用左闭右开的表示方法，这个区间中的元素个数就是上下限之间的差，这个区间的右界被称为越界值，这样做的理由有三个：\n  - 如果区间没有元素，那么找不到一个最后的元素标记终点\n  - 按照上面的方法定义，只要两个迭代器相等，那么立即可以判断区间为空\n  - 该方法提供了一种自然的方式表达“区间之外”\n- 在使用标准库提供的容器的时候，尽量使用对应的迭代器\n- 一般都使用`double`类型来进行浮点数计算\n- 在编写程序时，需要预见一些异常或者无意义的情况，在这种情况下程序最好暂时终止或者退出\n- 函数形式参数的名称最好不要太具体，因为某个函数可以用于多种含义不同的数据（这个思想对编写模板函数很重要）\n- 在输出时如果需要在输出的内容之间插入分隔符（如空格、逗号等），应当对第一个元素做特殊处理，具体思想是：当第一个元素生成（或者确保它已经存在）之后，输出第一个元素，然后再判断之后的元素是否存在，如果存在的话，就将它们与分隔符一起输出\n- 对于不希望改变对象内容的函数，应当将它们声明为`const`类型\n- 如果一个函数会改变一个对象的状态，那么这个函数应该作为对象的成员函数\n- 在设计二元运算符的时候，为了能够让左右操作数都可以进行类型转换以保持操作数的对称性，尽量将二元运算符定义在类的声明之外\n- 对于在创建对象时调用的构造函一般不用声明为`explicit`，而对于用于构造新的对象的构造函数需要声明为`explicit`\n- 不可以让用户用指针直接访问类中的私有成员\n- 使用句柄类时，当成员函数会改变底层对象的值时需要酌情进行复制操作，以保证指针的有效性\n\n","source":"_posts/acc_cpp笔记.md","raw":"---\ntitle: Accelerated C++笔记\ndate: 2021-09-16 10:30:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- C++\n\t- Programming Language\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/cpp.png\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/cpp.png\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: C++基础知识。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n> 虽然两年前就已经接触过C++，但是之前短暂的学习根本不足以让我系统掌握这门语言的用法。现在由于有项目开发的需求，我决定重新开始较为系统地学习C++。由于有C语言的基础，在入门阶段我使用Accelerated C++这本书来学习。这本书虽然较为老旧，但是内容不多，读起来也比较轻松。这篇文章是对我在看书和编程时遇到的问题和重点的总结备忘，内容比较零碎，还请大家谅解。\n\n# 语言特性\n\n## 基础知识\n\n- 声明：告诉编译器有这个对象存在，不需要建立内存\n\n- 定义：需要建立内存的声明，也即实例化一个对象\n\n- `main`函数返回一个整数类型的值作为结果，`0`表示成功\n\n- `void`类型的函数可以不需要`return`语句，也可以写`return;`\n\n- 变量是一个具有名称的**对象**，对象是计算机中一段具有类型的内存空间（在C++中，一切皆对象）\n\n- 在花括号中定义的变量，作用域只在它所在的花括号中\n\n- 对象类型还有**接口**，接口就是可以对对象进行的操作的集合\n\n- 重载：\n\n  - 运算符的重载：一个运算符对于不同类型的操作数有不同的含义，如`1 + 1`与`'A' + 'B'`中的加号具有不同的含义\n  - 函数重载：两个功能不同的函数在具有相同名称时，当它们的参数不同时，会发生重载\n  \n- 关于`const`：\n  - `const`表示该值为常量（只读），必须在定义它时进行初始化，变量也可以对常量进行初始化\n\n  - 如果给一个引用常量对象的函数传输一个非常量对象，那么这个对象会被视为常量\n\n  - 不可以对常量对象调用非常量函数\n\n  - 关于`const`的位置：\n\n    - 修饰指针变量：\n\n      ```c++\n      const int* pt = &n;\t//指针所指的数据是常量，但是指针是变量，可以指向其他地址\n      int* const pt = &n;\t//指针所指的数据是变量，指针是常量，只能指向n的地址\n      const int* const pt = &n; //指针和其所指的数据都不可以改变\n      ```\n\n    - 修饰函数参数：\n\n      ```c++\n      int func(const int n) {}; //函数收到的参数是常量\n      ```\n\n    - 修饰成员函数：\n\n      ```c++\n      int func(int n) const {}; //成员函数不能修改任何除了mutable修饰的的成员变量\n                                //且不可调用非const成员函数\n      ```\n\n    - 修饰函数返回值：\n\n      ```c++\n      const int func(int n) {}; //函数的返回值是常量，一般不需要这样用\n                                //除了重载运算符外，一般不要将返回值类型定为对某个对象的const引用\n      ```\n\n- 关于`static`：\n\n  - `static`表示该变量或函数是静态的，只能声明定义一次\n  - 静态全局变量：具有全局寿命，在程序运行的整个过程中存在，它在进入`main()`函数初始化，在退出`main()`函数后被销毁，它只在声明它的文件中可见\n  - 静态局部变量：在函数第一次执行到声明它的语句时进行初始化，它具有全局寿命，但是只在声明它的函数中可见，在单线程时多次调用包含静态局部变量的函数不会导致该静态局部变量被多次定义与初始化\n  - 静态函数：它只在声明它的文件中可见，其他文件中可以声明名字相同的函数而且不会发生冲突\n  - 静态数据成员：可以让该类的所有对象访问，只初始化一次，而且可以实现全局变量做不到的信息隐藏，它需要在类外部进行初始化\n  - 静态成员函数：一般声明和定义都在类中，它只能访问其他静态成员函数和静态数据成员，它没有`this`指针\n    - 如果静态成员函数的声明在类中，定义在类外部，那么在外部定义时不能够加`static`关键字，否则就相当于声明了两次\n    - 静态成员函数没有与其关联的对象，它可以通过类名或者对象名直接访问\n  - 使用`static` 修饰的变量是可以修改的\n\n- 成员函数：某种类型的对象有一个或者多个函数成员，调用这些函数可以获得一个值，如`str.size()`可以获得字符串`str`的长度\n\n- `using`声明：作用域为它所在的花括号内\n\n  - `using namespace std;`：程序中默认使用`std`这个命名空间\n  - `using namespace-name::name;`：使用`name`指代`namespace-name::name;`\n  - `using std::cout;`：使用`cout`指代`std::cout`，并且我们不会定义自己的`cout`\n  \n- 类型转换的原则：较小的类型转换为较大的类型，有符号的类型会转换为无符号类型，算数值会被转换为布尔值，`0`可以视为`false`，而其他值都被视为`true`\n\n- 缺省初始化：一般来说，在对象定义时如果没有初始化，那么它的内容就是其内存单元中的随机内容，但是下面几种情况下，编译器会进行缺省初始化\n\n  - 全局变量\n  - 自定义类型的对象在没有初始化程序的情况下\n  \n- 左值与右值\n\n  - 左值：位置值，也即内存地址\n  - 右值：地址中存的值\n  \n- 增量/减量运算符（按照优先级排序）：\n\n  - `i++`：对`i`加一，并且返回原始值\n  - `i--`：对`i`减一，并且返回原始值\n  - `++i`：对`i`加一，并且返回相加后的值\n  - `--i`：对`i`减一，并且返回相减后的值\n  \n- 关于`clear()`方法：\n\n  - 对字符串：将字符串的首地址内容存放`\\0`\n  - 对向量：清空向量内容\n  - 对流：清除流内部的错误状态\n  \n- 泛型算法：可以用于不同类型的容器和不同的数据类型的算法\n\n- 迭代器适配器：是一个函数，会产生与其参数相关的属性的迭代器以做他用，它会按照它给定的方式来对迭代器进行操作，下面给出了一些例子：\n  - `back_inserter(des)`：将元素添加到`des`容器的末尾\n  - `front_inserter(des)`：将元素添加到`des`容器的头部（链表支持该种操作，向量和字符串不支持）\n  - `inserter(c, it)`：在`c`的迭代器`it`之前插入元素\n  \n- 不要将重载函数作为参数传递给模板函数，否则编译器将不知道需要使用的是重载函数哪个版本\n\n- 将函数作为参数：将函数作为参数时，在声明的时候参数函数的编写形式类似于函数的声明，返回值和参数函数的参数必须与参数函数相一致，但是名称不需要一致\n\n- 函数的缺省参数：在声明一个函数时，如果在参数后写上`= x`（`x`为某个值、序列、或者函数），那么这个参数默认值为`x`，在调用这个函数可以该参数缺省\n\n- 函数的递归调用：在函数内部调用自身\n\n- 内联函数：在函数声明与定义时，于函数名字前添加了`inline`关键字的函数，在编译时所有调用内联函数的地方都会被替换成函数体的代码以提高运行效率，对一般的函数，只有程序运行到调用函数的那个地方时，函数名才会被替代成相对应的函数代码，内联函数的长度不应超过10行\n\n- `main`函数：\n  - 完整形式：`main(int argc, char** argv)`\n  - 参数：\n    - `argv`：指向一个数组首元素地址的指针，数组中的每一个元素都是都指向一个字符串参数的指针\n    - `argc`：`argv`指向的数组中的指针个数\n  - `argv`的第一个元素指向编译出的程序的名字的字符串的首地址\n  - 在程序中可以直接使用这两个对象\n  \n- `NULL`，`nullptr`，`NaN`，`INF`\n  - `NULL`：历史上曾经用来指代空指针，现在已有了替代，值实际上是`0`\n  - `nullptr`：C++11引入的关键字，指代空指针\n  - `NaN`：表示*Not a Number*，无效数字\n  - `INF`：表示*Infinite*，无穷大，超出了浮点数的表示范围\n  \n- 如果非成员函数的调用位置在定义之前，那么需要先对其进行声明；如果调用位置在定义之后，就不需要声明了\n\n- 前置声明：如果两个类的定义是相互依赖的，那么在定义第一个类前必须先对第二个类进行前置声明，告诉编译器有这个类存在，否则会出现无穷嵌套的问题\n\n## 新类型\n\n### vector（向量）类型\n\n向量类型可以理解为大小可以按需要随意增长的数组\n\n- 定义：`vector<double> grade;`，该语句定义了一个类型为`double`类型的向量`grade`\n- 一个向量中的所有数值具有相同的类型\n- 需要使用`<vector>`头文件\n- `grade.push_back(x)`：将`x`添加到`grade`向量的末尾\n- 描述向量长度的数据类型：`vector<TYPE>::size_type`\n- 访问向量中的指定元素：类似于数组，如`grade[i]`，若一个向量有`grade.size()`个元素，那么它的第一个元素为`grade[0]`或者`grade.begin()`，最后一个元素为`grade[grade.szie() - 1]`或者 `grade.end()`\n- 删除向量中的元素：\n  - 使用`erase()`成员函数，如：`grade.erase(grade.begin() + i)`\n  - `erase()`会在删除掉一个元素的同时，将这个元素后面的元素向前移动一个单位\n  - `erase()`会返回一个迭代器（见下文），并且指向刚刚被删除的元素后面的那个元素\n- 向量元素的预分配：可以减少重复的内存分配带来的系统开销\n  - `v.reverse(n)`：对向量`v`保留`n`个元素的内存空间，但不进行初始化，该操作不会改变容器的大小\n  - `v.resize(n)`：给`v`一个长为`n`的新长度\n    - 新长度小于当前长度：向量位于长度`n`后的元素会被删除\n    - 新长度大于当前长度：向量当前长度后与长度`n`前的空余位置会添加上新的元素，并且会进行初始化\n\n### list（双向链表）类型\n\n链表中的每一个元素都有一个指针指向后一个元素，`list`（双向链表）的每一个元素都有两个指针，一个指向前一个元素，一个指向后一个元素。`list`的特性决定了我们可以快速地在容器的任何一个位置增删元素。在顺序访问的情况下，`list`的访问速度比`vector`差；但是对于大规模随机访问或者增删元素的情况，`list`的性能远远好于`vector`。\n\n- 定义示例：`list<double> grade;`\n- 需要使用`<list>`头文件\n- `list`不支持索引\n- 具有`sort()`成员函数，它有一个可选的参数`compare`用于提供排序的比较方法，如果不提供该参数则默认使用`<`来排序\n\n### 对string类型的新认识\n\n- `string`类型可以视为一种特殊的容器，它支持索引操作，也有相对应的迭代器（类似`vector`）\n- `substr(i, j)`成员函数：创建一个新的字符串来保存`s`在区间`[i,i+j)`中的索引指示的字符的复制\n\n### 对容器的一些其他操作\n\n- `c.rbegin()`：对于允许逆序访问的容器，该语句表示指向容器最后一个元素的迭代器，访问的顺序是逆向的\n- `c.rend()`：对于允许逆序访问的容器，该语句表示指向容器第一个元素之前的迭代器\n- `container<Type> c(c1);`：若`c1`存在，那么该语句表示定义一个容器`c`且其为`c1`的复制\n- `container<Type> c(n);`：定义一个有`n`个元素的容器`c`并根据`Type`对其元素进行初始化\n- `container<Type> c(n, t);`：定义一个有`n`个元素的容器`c`，`c`的元素是`t`的复制\n- `container<Type> c(b, e);`：定义一个有`n`个元素的容器`c`，`c`的元素是迭代器`[b,e)`之间的复制\n- `c.size()`：返回`c`中元素的个数，返回值类型为`size_type`\n- `c.empty()`：用于指示`c`中有无元素，如果没有的话返回`True`\n- `c.insert(d, b, e)`：复制`[b,e)`两个迭代器之间的元素，并将它们插入到`c`容器的`d`迭代器所指示的位置之前\n- `c.erase(b, e)`：从`c`中删除`[b, e)`两个迭代器之间的元素，对于不同的迭代器，该操作的速度有所不同\n\n### iterator（迭代器）类型\n\n迭代器用于代替索引，以库能控制的方式访问元素。\n\n- 每一个标准容器都有两种迭代器类型：\n  - `container-type::const_iterator`：使用该迭代器只能读容器中的元素\n  - `container-type::iterator`：使用该迭代器可以读也可以写容器中的元素\n  - `iterator`类型可以转换为`const_iterator`类型，反之不行\n- 使用例：`vector<double>::const_iterator iter = grade.begin();`，声明了一个名为`iter`的迭代器，且初始值为`grade`的第一个元素\n- 迭代器可以使用增量运算符（重载过）\n- 迭代器相当于是一个指针，可以使用`*`运算符间接引用迭代器所指向元素的内容（访问的是左值），在使用时应当注意运算符的优先顺序\n- 如果要获得迭代器引用的内容的一个元素，可以使用`*(iter).element`或者`iter -> element`两种方式访问\n- 注意，对于不支持随机访问索引操作的容器，**对迭代器的值进行手动更改（如给迭代器加或者减偏移量）将无法通过编译**\n- 删除迭代器当前所指示的元素会使得该迭代器失效\n- 对`vector`容器，`erase`和`push_back`操作会使得被操作以及之后的元素的迭代器失效，而对`list`容器则不会\n- 如果一个容器支持索引，那么它的迭代器也支持索引，如：`iter[2]`等价于`*(iter + 2)`，`iter[-1]`等价于`*(iter - 1)`\n\n### map（映射表）类型\n\n之前提到的向量、链表等容器都是顺序容器，而`map`则属于关联容器。关联容器的序列不依赖于插入元素时的顺序，它只依赖于元素本身的值。关联容器的特性可以使我们更快地对特定元素定位。\n\n- `map`容器中存储的是一个`键-值`对\n  - 键：有点类似于顺序容器中的索引，它指向一个存储空间\n  - 值：键所指向的存储空间中存放的内容\n- 声明例：`map<string, int> m;`，该语句声明了一个名为`m`，从字符串到整数的映射表，其键的类型为`string`，值的类型为`int`\n- 关联容器不可以对元素进行手动排序，一般不对关联容器的内容进行修改\n- 只要声明了一个关联容器，如果我们用一个未曾出现过的键作为映射表的索引，这个映射表会自动创建一个具有这个键的元素，且这个元素具有初始化的值，对于内部类型会被初始化为`0`\n- `pair`（数对）类型：该类型提供了访问映射表的键和值的能力，映射表中的每个元素都是一个数对\n  - 数对有两个成员，`first`成员包含了键，`second`成员包含了值\n  - 间接引用映射表迭代器时，获得的就是这个映射表关联的一个数对`pair<const T1, T2>`\n  - 注意，映射表的键是常量\n- `map`的访问方法：`m[key]`，使用键`key`来索引访问映射表并返回一个左值，如果对于这个键没有一个合适的项目，那么则会新建一个元素\n- `map`的另一种访问方法：若`iter`是一个映射表的迭代器，那么`iter -> first`可以得到数对的键，`iter -> second`可以得到数对的值\n- 常量映射表无法使用索引访问\n- `find()`成员函数：参数为需要查找的键，如果查找到了则返回一个指向这个元素的迭代器，否则返回映射表的末尾\n- 一般情况下`map`都是自动排序的，但是在可以通过`map<K, V> m(cmp);`语句在声明时使用`cmp`来人工确定元素的顺序\n\n### 自定义类型\n\n作为核心语言的一部分，`int` 、`char`、`double`等类型都是内部类型；而`vector`、`string`等类型属于标准库的内容，是自定义类型。用户可以自己定义新的类型，自定义其中的数据、函数、访问接口等，以此对数据结构进行封装。\n\n- 自定义类的格式：\n\n```c++\nclass Class_name {\npublic:\n\t//类型提供的接口\nprivate:\n\t//类型的实现\n};\n```\n\n- `public`：保护标识符，它指示类中的共有成员，类的所有用户都可以访问公有成员\n- `private`：保护标识符，它指示类中的私有成员，类的私有成员对用户来说是不可以直接访问的\n- 同样可以用`struct`关键字来自定义类，但是它与`class`有所区别，如：\n\n```c++\n struct Student_info {\n    string name;\n    double midterm, final;\n    unsigned int gender;\n    unsigned int age;\n};\n```\n\n​\t\t这里`Student_info`为一个具有5个数据成员的类型\n\n- 关于`class`和`struct`：`class`关键字声明的类型在第一个`{`和保护标识符之间的所有成员都是私有的，`struct`则相反\n\n- 自定义的类型只能出现一次，它只能出现在一个头文件中\n\n- 在类型内部自定义成员函数时，可以直接访问对象内部的元素\n\n- 如果是在头文件（`.h`）对应的源文件（`.cpp`）中定义的成员函数，函数的名字前必须加上`Class_name::`的作用域限定运算符，以明确函数是`Class_name`的一个成员函数，否则会出现函数未定义的编译错误\n\n- 将成员函数定义在类内部与类外部的区别：在类内部定义的成员函数，实际就是把函数的调用扩展成内联的，这样可以提高程序运行效率\n\n- 成员函数如果不是定义在类内部，**必须在相对应的源文件（`.cpp`）中定义**，否则会产生重复定义的问题（**模板类除外**）\n\n- 如果在自定义类与全局环境中有同名函数，在函数名字前加上`::`（该运算符左侧没有内容）代表使用的是全局韩静中的那个函数\n\n- 如果需要访问一个私有的数据成员，可以定义一个存取器函数（如下），但是它会破坏类的封装性：\n\n  ```c++\n  std::string name() const { return name; }\n  ```\n\n- 对声明为`static`的成员函数，它只能在类中定义\n\n#### 构造函数\n\n构造函数是类的一个特殊的成员函数，它定义了对象的初始化方式。它的名字是类的名字且没有返回值，它会在创建一个自定义类型的对象时被自动调用。\n\n- 如果没有自定义构造函数，那么编译器会为我们自己创建一个\n\n- 构造函数列表：在`public`作用范围内的构造函数的声明\n\n- 构造函数的定义：\n\n  ```c++\n  Student_info::Student_info(double midterm, double final);\n  ```\n\n  上面定义了一个参数为 `midterm`和`final`的构造函数，下面给出声明与初始化例：\n\n  ```c++\n  Student_info::Student_info stu(100, 99);\n  ```\n\n  上面声明并初始化了一个名为`stu`的`Student_info`类型的对象，并设置了其成员数据的值\n\n- 构造函数默认参数：构造函数的参数同样可以给定其默认值，从而可以进行缺省初始化\n\n- 缺省构造函数：不带参数的构造函数，如：\n\n  ```c++\n  Student_info::Student_info(): midterm(0), final(0) {};\n  ```\n\n  使用该方式同样可以进行对象的缺省初始化\n\n- 上面的语句中，`:`与`{`之间的内容为**构造函数初始化程序**，程序会用括号中的值初始化相应的数据成员\n\n- 创建一个对象时的过程：\n\n  1. 分配相对应的内存\n  2. 执行构造函数初始化程序\n  3. 执行构造函数函数体（在上面的例子中，函数体中没有内容）\n\n- 不建议在构造函数的函数体中对对象进行初始化，如果这样那就相当于对对象做了两次初始化\n\n- `explicit`关键字：函数名前添加了此关键字的构造函数只能在被显式调用时才能使用\n\n- \n\n#### 析构函数\n\n析构函数是在一个对象被删除的时候被调用的，它来定义如何删除一个对象的示例。\n\n- 析构函数的函数名是在类的名字前面加上`~`\n- 析构函数不带参数且没有返回值\n- 定义例：`~Student_info() {}`\n\n## 指针\n\n指针是一种随机存取的迭代器。\n\n- 一个指针是一个存放对象地址的值，一个对象是只包含它本身一个元素的容器，那么指针就是指向这个元素的迭代器\n- 对于一个指向对象`x`的指针`p`，有：\n  - `p`：`x`的地址\n  - `*p`：`x`的内容，也即有`*p = x`，这里 `*`是一个间接引用运算符\n  - `&x`：`p`的内容，也即有`p = &x`，这里`&`是一个取地址运算符\n- 一般使用`0`初始化指针变量，空指针的内容就是`0`\n- 指针具有类型，对于一种类型`T`，可以定义一个指向`T`类型的对象的指针：`T* p;`\n- 指针可以通过加减法修改它指向的值\n- 使用`ptrdiff_t`类型来表示两个指针的间距，它在`<cstddef>`头文件中\n- 野指针：指向被释放的内存空间的指针\n- 函数指针：\n  - 一个指针在声明时如果带上参数，那么他就变成了一个函数指针\n  - 示例：`int (*fp)(int);`，调用`fp`时以一个`int`类型的变量作为参数，同时返回一个`int`类型的结果，这意味着`fp`是一个具有一个`int`类型参数并且返回一个`int`类型结果的函数的指针\n  - 如果存在这样的一个函数：`int func(int)`，那么可以用`fp = &func;`或者`fp = func;`来让`fp`指向`func`\n  - 如果`fp`指向`func`，那么可以使用`(*fp)(i)`或者`fp(i)`的方式调用`func`，其中`i`为整型\n  - 如果将一个函数名作为另一个函数的参数，那么编译器会将这个参数转换成一个指向那个函数的指针\n- 使用指针时可能导致问题出现的原因：\n  - 复制一个指针时不会复制指针所指的对象\n  - 删除一个指针不会释放对象所占用的内存\n  - 删除一个对象但是没有删除指向该对象的指针会产生一个空悬指针\n  - 定义了一个指针但是不进行初始化\n  \n\n## 数组\n\n数组是最基础的容器，它是核心语言的一部分。\n\n- 数组元素个数必须在编译时确定，它不能动态增减尺寸\n- 使用`size_t`类型来表示一个数组的大小，它在`<cstddef>`头文件中\n- 对于一个有`n`个元素的数组，只有指向`[0,n)`的指针是合法的\n- 数组支持索引操作\n- 数组定义的两种方法：\n  - 只声明，需要显式地确定元素个数：`int num[5];`\n  - 定义的同时进行初始化，无需显式地确定元素个数：`int num[] = {1, 2, 3, 4, 5} ;`\n- 字符串实际就是一个字符类型的数组，它的最后一个字符为空字符`\\0`，使用`strlen`函数可以确定字符串的大小\n- `sizeof()`：返回一个`size_t`类型的值，其值以`bytes`为单位，如果需要返回数组的元素个数，那么可以用`sizeof()`的返回值除数组中每个元素占用空间的大小\n- 如果数组以指针的方式作为函数的参数，那么它会退化成一个指针，这个时候无法通过`sizeof()`得到指针所指数组的长度，只能得到指针所占空间的大小\n\n## 内存分配\n\n- 一般来说有三种分配内存的方法：\n  - 自动分配：在使用局部变量时就使用了自动分配内存的策略，用时分配，用完释放\n  - 静态分配：使用`static`关键字限定的对象，系统只会对它进行一次内存分配，直到程序结束才释放\n  - 动态分配：使用`new`与`delete`关键字分配的对象\n- `new`与`delete`：使用`new`创建的对象一直存在直到对其使用`delete`或者程序结束\n- 为对象分配或释放内存：\n  - `new T;`：为一个没有名字的`T`类型的对象分配内存\n  - `new T(args);`：与上面类似，但是内存中存有值`args`\n  - `int* p = new int(100);`：将一个`int`类型的指针`p`指向`new`开辟的存有`100`的内存空间\n  - `delete p;`：删除指针`p`并且释放其指向的内存空间\n\n- 为数组分配或释放内存：\n  - `new T[n];`：为一个具有`n`个`T`类型的对象数组分配内存，并且返回一个指向数组首元素的指针，数组中的每一个对象都会被默认初始化\n  - 在上面的表达式中如果`n`为`0`，那么数组中将没有任何元素，并且`new`无法返回一个有意义的指针\n  - `T* p  = new T[n];`：将指针`p`指向新开辟的数组的首地址\n  - `delete[] p;`：从后向前释放指针`p`指向的数组所用的全部内存空间，如果索引运算符内添加了索引，那么只释放索引指定的那个内存空间\n- `malloc()`函数：\n  - 库：`<stdlib>`\n  - 参数：`size_t`类型，为需要分配的内存空间大小\n  - 返回一个`void*` 类型（未知类型）的指针，在使用时需要进行强制类型转换，若失败则返回`NULL`\n  - 使用例：`char* cp = (char*)malloc(10);`\n  - `malloc`不会对分配的空间进行初始化，而`new`会\n- 内存分区：\n  - 堆区：由用户手动申请与释放，若不释放则在程序结束后释放，使用`new`或 `malloc`申请的内存在此区域\n  - 栈区：由系统管理，主要存放函数的参数以及局部变量\n  - 静态存储区：在编译时就已经分配好内存空间并且进行初始化，主要存放静态变量、全局变量以及常量\n  - 代码区：存放程序体的二进制代码\n- 内存分配器`allocator`：\n  - `allocator<T>`是一个类，它定义在`<memory>`头中，使用时需要加上`std::`\n  - 在使用`allocator<T>`类时，需要先将其实例化，如：`std::allocator<T> alloc;`\n  - 在程序中通过调用对象的成员函数来实现内存分配，下面是一些常用的成员函数：\n    - `T* allocate(size_t)`：用于分配一块长度为`size_t`，类型为`T`但并未被初始化的内存块，并返回这块内存的地址\n    - `void deallocate(T*, size_t)`：用于释放未被初始化的内存，第一个参数为`allocate`函数返回的指针，第二个参数为指针指向的内存块的大小\n    - `void construct(T*, T)`：用于对使用`allocate`函数分配的未初始化的内存进行初始化，第一个参数为`allocate`函数返回的指针，第二个参数需要复制的初始值\n    - `void destroy(T*)`：用于删除指针所指的对象，它会调用析构函数\n- 另外两个内存分配中可能有用的库函数：\n  - `T* std::uninitialized_copy(T*, T*, T*)`：用于将前两个参数指针所指的区域中内存的值复制到第三个参数指针指向的目标内存块中，并且返回一个指向被初始化的你内存中的末元素后一个元素的地址\n  - `void std::uninitialized_fill(T*, T*, const T&)`：用于向前两个参数指针所指的区域的内存中复制第三个参数所引用的值\n\n## 泛型函数\n\n- 含义：不知道参数和返回值类型的函数，用于解决一类抽象问题\n- 函数中使用的变量必须支持函数中所进行的操作\n\n### 模板函数\n\n泛型函数的具体实现。模板函数可以让不同的对象享有共同的行为特性，在定义模板函数的时候我们不知道模板参数对应的特定类型。下面给出了定义模板函数的示例：\n\n```c++\ntemplate <class T>\nT function(vector<T> v)\n{\n    //函数内容...\n}\n```\n\n- `template <class T>`定义了一个模板头，它告诉系统环境定义了一个模板函数，而且这个函数有一个类型参数\n- 如果要使用嵌套类型（也即由模板参数定义的类型），那么必须要使用`typename`关键字，如：`typedef typename vector<T>::size_type vec_sz;`，使系统将这个名称当做一个类型处理\n- 模板函数的实例化过程在不同系统下有所不同\n- 模板函数的正确性是由参数之间的正确关系决定的，如果参数之间产生了可能导致歧义和信息丢失的关系，那么这个函数的程序很有可能是有错误的，甚至无法通过编译\n- 在编写模板函数的时候，为了使函数可以处理存储于各种数据结构中的数值，并且能够作用于容器的一部分而非整容器，一般我们使用迭代器参数而不是容器参数\n\n### 迭代器的类型\n\n下面的迭代器每一种都对应了一个特定的迭代器操作集合，每一个迭代器种类还对应了一个访问容器的策略，同时也对应了特定的算法。在编写模板函数时需要注意不同迭代器的选择。\n\n- 输入迭代器`In`：该种迭代器对一个序列提供了**顺序只读访问**的操作，它支持的操作有：`++`、`==`、`!=`、`*(读)`\n- 输出迭代器`Out`：该种迭代器对一个序列提供了**顺序写入**的操作，它要求调用它的程序不可以在对迭代器的两个赋值之间执行超过一次的自增操作，也不能在没有对迭代器递增时对其多次赋值\n- 正向迭代器`For`：该种迭代器对一个序列提供了**顺序读-写访问**的操作，它可以在对一个元素赋值后再读取它的值，因此不需要满足输出迭代器的一次赋值要求，它支持的操作有：`*(读写)`、`++`、`==`、`->`，所有的标准库容器都满足正向迭代器的要求\n- 双向迭代器`Bi`：该迭代器对一个序列提供了**可逆读-写访问**的操作，它不仅有正迭代器的功能，还支持`--`（也即逆序访问）的操作，所有的标准库容器都支持双向迭代器\n- 随机迭代器`Ran`：该迭代器对一个序列提供了**随机访问**的操作，它的行为有点类似索引，不仅有双向迭代器的功能，而且支持算术运算，若`p`和`q`是两个迭代器，那么它们支持：`p + n`、`p - n`、`n + p`、`p - q`（得到的是两个迭代器之间的距离，整型）、`p < q`、`p > q`、`p >= q`，向量和字符串迭代器都是随机访问迭代器，而链表迭代器则是双向迭代器\n\n## 模板类\n\n模板类用于生成一个类，这个类生成的多个对象可以分别存储不同类型的数据。模板类相当于定义了存储自定类型的数据结构的一个容器。\n\n- 声明例：\n\n  ```c++\n  template <class T> class Name {\n  public:\n  \n  private:\n  \n  };\n  ```\n\n- 上面的语句声明了一个名字为`Name`，可以存储并处理`T`类型数据的模板类，这里的`T`类型会在将这个类实例化的时候确定，如`Name<int> N;`使用`Name`模板创建了一个`T`为`int`类型的对象\n\n- **模板类的声明和实现必须全部写在头文件中**\n\n- 模板类的成员函数如果需要在类外部定义，那么为了将函数的作用域明确为在类的内部，需要做以下更改：\n\n  - 在函数的定义前面加上`template <class T>`\n  - 在函数名前面添加`Name::`\n  - 在所有的`Name`后面添加`<T>`\n\n- 自定义模板类的时候一定要全面地考虑其初始化、内存分配、复制的问题，必要时可以自定义这些操作\n\n- 模板类的构造函数例：\n\n  - `Name() {}`：最普通的无参构造函数\n  - `Name(size_type n, const T& val = T()) {}`：该构造函数的参数为一个指定了对象大小的`size_type`类型的参数`n`，以及提供了初始化的默认值的`const T&`的参数，它的缺省值由`T`的构造函数提供\n\n- 可以使用`typedef`关键字来自定义类型名，如：`typedef T* iterator;`\n\n- 运算符重载：在自定义类中可以对内置的运算符进行重载以实现需要的功能，如：\n\n  ```c++\n  T& operator[](size_type i) { return data[i]; }\n  const T& operator[](size_type i) const { return data[i]; }\n  ```\n\n  - 运算符重载的声明有点像定义了一个`operator\"运算符\"`函数\n  - 如果需要使运算符不改变对象的值，那么就在运算符重载的定义前面以及函数体前面加上`const`关键字\n  - 如果某个重载运算符函数是类的一个成员函数：\n    - 它的左操作数（二元运算符）或者唯一的操作数（一元运算符）必须是调用它的对象\n    - 它的左操作数（二元运算符）会以`this`指针的方式默认地传递给这个成员函数\n  - 如果某个重载运算符函数不是类的一个成员函数，那么重载运算符函数的第一个参数是左操作数，第二个参数是右操作数\n\n- `this`指针：`this`关键词只在成员函数内部有效，代表指向函数操作对象的指针，指针的类型由函数的操作对象决定\n\n- 复制控制：\n  - 复制构造函数：用于复制一个已经存在的同类型的对象，以此来初始化一个新的对象，它只带一个与类本身类型相同的参数，并且由于复制不应该改变已有对象的值，因此它的类型应该为常量引用类型\n  - 复制构造函数的函数体应该为自定义的复制操作，如果函数体为空，那么将使用系统默认的方式进行复制\n  - 在复制对象时，由于对象的副本的地址与原对象不同，因此不可以将原对象中指向原对象本身的指针同时复制过去，应当重置这些指针使得它们对新对象有意义\n  \n- 赋值运算符：\n  - 赋值操作函数：把一个对象中已经存在的值**擦除**，然后装入一个新的值\n  - 类中可以重载赋值运算符，如：`Name& operator=(const Name& n) {}`\n  - 这里的参数为右操作数的一个引用\n  - 在函数体内可以通过该语句判断是否是自我赋值：`&n != this`，该语句比较了左右操作数的地址，如果两者相等则为自我赋值\n  - 赋值与复制的区别：复制是将一个值插入一个新的对象，不需要删除操作\n  - 构造函数只控制初始化操作，`operator=`函数只控制赋值操作\n  \n- 在使用`=`为变量赋初始值时调用的是赋值构造函数，在赋值表达式中`=`调用的是赋值操作函数\n\n- 如果一个类没有显式地定义构造函数或者析构函数，那么编译器将自动生成执行这些操作的默认函数\n\n- 默认的析构函数在删除一个指针变量时不会释放该指针指向的对象占用的内存空间\n\n- 三位一体原则：如果类需要一个析构函数，那么它同时有可能需要一个复制构造函数和一个赋值操作函数\n\n- 友元函数：如果一个函数定义在类的声明外部，但是又需要它具有访问`private`成员数据的权限，那么可以在类内部声明这个函数时，前面加上`friend`关键字，将其声明为一个友元函数\n\n- 模板特化：只有当模板类的实际的对象类型`T`为指定类型时，才调用指定类型对应的模板成员函数，声明与定义如下：\n\n  ```c++\n  template<>\n  int function(int var)\n  {\n  \t...\n  }\n  ```\n\n## 对象的初始化\n\n- 初始化与赋值：\n  - 初始化：在创建一个变量时赋予它一个初始值\n  - 赋值：将对象的当前值擦去，并且用一个新值替代\n- 下列情况发生时会进行初始化：\n  - 声明一个变量\n  - 函数入口处用到函数参数\n  - 函数返回处用到函数返回值\n  - 构造初始化\n- 通过显式地调用构造函数进行初始化称为**显式初始化**，否则称为**隐式初始化**\n- 使用`=`初始化一个对象称为**拷贝初始化**，不用等号则是**直接初始化**\n- 如果对象没有进行显式初始化，则会进入**隐式初始化**的**状态**，在**隐式初始化**状态下会进行**缺省初始化**的**过程**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \n- 关于不同种类对象的缺省初始化方式：\n  - 全局或者静态的对象：空串或者`0`\n  - 对象为局部的内部类型：未定义的值\n  - 内部类型作为类的成员：在某些条件下会被数值初始化为`0`\n  - 自定义类型且有构造函数：使用构造函数初始化\n  - 自定义类型且无构造函数：递归地对对象中的每一个数据成员进行相应的数值初始化或者缺省初始化\n\n## 类型转换\n\n- 自动类型转换：\n  - 自动转换的例子很常见，如将`int`类型的右值赋给`double`类型的左值时，该右值就会被自动转换为`double`类型\n  - 自动类型转换分为下面两种情况：\n    - 内置类型向自定义类型转换\n    - 自定义类型向内置类型转换\n  - 内置类型转换为用户自定义类型：需要在自定义类内部编写带单参数的构造函数\n    - 例如：`Name(const char* cp) { //将参数提供的内容存入临时的Name类型的对象中 }`，对`Name`类型，该构造函数会在编译器需要一个`Name`类型的对象却收到了一个`const char*`类型的对象的时候被调用\n  - 用户自定义类型转换为内置类型：需要在自定义类内部编写如下例所示的成员函数\n    - 例如：`operator int() { //将自定义类型转换为int类型 }`，该函数会在显式强制转换或者对象传入的值类型不符时被调用，函数的返回值为由其类型名确定\n- 如果两个类之间彼此定义了向另一个类的转换操作，会导致转换时出现二义性\n- 混合类型表达式：混合类型表达式意为在一个语句中使用运算符同时操作不同类型的对象的表达式，它在实现的过程中会进行多次类型转换，同时产生大量的临时变量，比较浪费内存\n\n## 引用\n\n- 形如`int& i;`的变量即为引用变量，左侧的表达式是对其进行声明的过程\n- 如果存在一个整型变量`temp`，那么令`i = temp;`，则`i`指向的内存位置与`temp`相同，`i`相当于是`temp`的一个别名\n- 引用作函数参数：\n  - 非常量引用：`int function(vector<string>& count);`，形式参数`count`存放的是实际参数的地址（`&`的意思有一些像取地址，但是二者是有区别的），可以直接在函数内更改实际参数的值，而且不需要重新复制一个变量，减少资源消耗\n  - 常量引用：`int function(const vector<string>& count)`，常量引用只能藉由实际参数的地址读取它的内容且无法进行修改，该操作同样不需要重新复制变量\n  - 一般来说，对于`int`或者`double`类型的参数可以不需要引用，因为对它们的复制是非常快的\n- 值类型作函数返回值：\n  - 对于值类型的返回值，编译器会先将这个值复制到一个临时变量内并且返回这个临时变量\n  - 函数调用完成，这个临时变量在被使用一次后（也可能不被使用），它即被销毁\n- 引用作函数返回值：\n  - 引用作函数返回值的时候，不可以引用局部变量，因为函数调用完成后局部变量就被销毁，这个引用就无效了\n  - 当引用作函数返回值时，不需要将变量重新复制一次保存在临时变量中\n  - 引用作返回值时可以作为左值\n\n## 继承\n\n### 基本概念\n\n- 定义：\n\n  ```c++\n  class A {\n  \tpublic:...\n  \tprivate:...\n  };\n  \n  class B: public A {\n  };\n  ```\n\n  - 上面定义了一个类`B`，它是从`A`中继承而来，称`A`是基类（或者父类），`B`是继承类（派生类、子类）\n  - 这里派生类继承了基类的公有部分，也即基类的公有成员才是子类的一部分\n  - 同样可以使用`private`或者`protected`关键字来指定继承的方式\n\n- 继承关系是可以嵌套的\n\n- 基类和继承类的关系：基类就是继承类，继承类不是基类，对于他们的引用或者指针同样有这个关系\n\n- 基类不可以强制转换为派生类\n\n- 关于基类或者继承类作为函数参数：\n\n  - 形式参数与实际参数匹配的情形不讨论\n  - 如果形式参数是基类类型的，传入一个继承类的对象会将其转换为基类\n  - 如果形式参数是继承类型的，那么实际传入的对象只有继承类的部分\n\n- `protected`：保护标识符，它指示类中的保护成员，类的保护成员可以被其继承类访问\n\n- 如果需要显式地表明某些成员是继承来的或者明确指明调用基类或者继承类的成员函数，可以使用范围（作用域）运算符\n\n- 构造初始化器：也即构造函数，在使用构造初始化器时直接将相应的参数填入构造函数中即可，编译器会根据参数的类型匹配相应的构造函数\n\n- 派生类对象构造的步骤：\n\n  - 为整个对象分配内存空间\n  - 隐式（或者显式）调用基类的构造函数来初始化对象中的基类部分数据\n  - 用构造初始化器对派生类部分的数据进行初始化\n  - 如果有的话，执行派生类构造函数的函数体\n  \n- 继承关系中成员函数的覆盖：如果基类与继承类中有两个同名同参同返回值类型的非`const`函数，那么派生类的这个函数会覆盖基类的函数，当基类与继承类的函数都返回指向他们本身类型的指针时除外\n\n### 虚函数\n\n- 定义：在基类中定义成员函数时前面加上`virtual`关键字，在继承类中同名同参函数的`virtual`的特性也会被继承，因此不需要重复加\n- 虚函数必须要有定义，不能只有声明\n- 功能：由于继承类也是基类，因此当以引用或者指针的形式调用成员函数时，程序根据实际的对象类型来在基类与继承类中选择正确的同名成员函数，也即**动态绑定**\n- 静态绑定：在编译时就确定调用的对象的成员函数的种类\n- **多态**：用一个类型表示多种类型的能力，这里动态绑定实现了多态\n- 只有在*以引用或者指针的形式*调用虚拟函数的时候在运行时选择类型才有意义\n- 虚拟析构函数：当使用指针来控制对象时，调用`delete`函数会调用这个虚拟析构函数，一般虚拟析构函数都是空的\n- 如果基类与继承类中有同名不同参的函数，那么他们之间毫无关系，不需要用到需函数的技术\n- 如果在构造函数内部调用虚函数，那么它会静态绑定成正在构造的对象所属于的类中的那个虚函数\n\n### 代理类\n\n- 代理类实际上就是一个普通的用户自定义类，它的成员数据是指向基类的指针\n- 功能：存储和管理基类指针，这个基类指针既可以指向基类对象又可以指向派生类对象，使用代理类可以实现动态绑定，它将基类和派生类中的细节封装起来，提供了一个统一的接口\n- 代理类中一般包含这些实现细节：\n  - 各种构造（析构）函数与复制控制函数：用于提供分配或者销毁内存空间的操作\n  - 基类和继承类中共有的操作：提供操作接口，实现动态绑定的功能\n  - 其他操作\n- 关于代理类的复制操作：需要在它管理的基类和继承类中定义虚拟的复制控制函数，并且在代理类的复制操作中调用它，在复制时有必要判断指向被复制对象的指针是否时空指针\n- 友元类：将一个类声明为另一个类的友元可以使另一个类中的所有成员都成为那个类的友元\n\n## 句柄类\n\n- 功能：上面提到的代理类可以视为一种简单的句柄类，但是它是通过复制对象来实现动态绑定的，句柄类的最主要功能就是实现在不用复制对象的情况下就实现动态绑定并且自动管理内存\n- 一般来说，句柄类是一个模板类，因为它与它操作的模板之间是相互独立的，句柄类具有通用性\n- 与代理类相似，句柄类要将被控制的类的全部接口封装起来\n- 复制操作：在复制时需要将该句柄类的指针当前所指向的对象删除后再重新将指针指向被复制的对象的地址\n- 使用方法：在实际的程序中，通常使用一个接口类来管理基类与继承类，接口类的成员数据是一个句柄类，接口类通过操作句柄类来控制基类与继承类\n- 接口类的构造函数必须对句柄类做初始化\n\n### 计数句柄类\n\n- 相比于一般的句柄类，计数句柄类在复制对象时会有选择的对底层的对象进行复制，这意味着计数句柄在复制时并不总是将底层对象的内容重新拷贝一份，而是让多个复制出来的句柄的指针同时指向同一个底层对象\n- 为了实现上面的功能，需要在句柄类添加一个**引用计数**指针，它用来记录有多少个对象指向底层对象\n- 复制构造函数：计数句柄类的复制构造函数不需要复制底层的对象，它的基本操作如下：\n  - 对右操作数所指向的对象的引用计数指针加一，表示有一个新的计数句柄类指向同一个底层对象\n  - 如果当前左操作数的引用计数指针值为`1`，那么意味着没有其他句柄指向这个底层对象了，复制操作会将左操作数的指针覆盖掉，所以这里将左操作数指向的对象和其计数指针所占的内存空间释放掉\n  - 将右操作数的对象指针和引用技术指针的复制到左操作数中\n- 析构函数：同样要考虑当前的句柄类是不是最后一个指向该对象的句柄，具体操作不再赘述\n- 在修改句柄类指向的对象的值时，亦需要考虑当前的句柄类是不是最后一个指向该对象的句柄，如果是的话，那么直接修改这个指针指向的对象的值即可，否则要先将当前所指向的对象的引用计数减一，然后基于旧对象复制一个新对象并将指针指向它，并将它的引用计数设为一，上述的操作可写为成员函数并在接口类中调用\n\n## 抽象基类\n\n- 概念：抽象基类是一种接口类，它用于提供一类对象的基本特征，然后再通过由其派生初来的派生类来实现可以归入该类对象下的其他特定类型的对象的详细特征\n- 一般来说，抽象基类使用纯虚函数来实现这种特性\n- 抽象基类可以使用句柄类来自动管理内存\n\n### 纯虚函数\n\n- 纯虚函数的函数体为`= 0`，它没有具体的实现，声明例如下：\n\n  ```c++\n  virtual void display() = 0;\n  ```\n\n- *含有纯虚函数的类就是一个抽象基类*，它不能有一个实际的对象\n- 纯虚函数在抽象基类的派生类中得到实现\n- 如果在派生类中继承而来的纯虚函数没有定义，那么它仍然是一个纯虚函数\n\n## 输入与输出\n\n- 标准输出流：\n\n  ```c++\n  std::cout << \"output\" << std::endl;\n  ```\n\n  - 上面的语句中，`std`为命名空间，命名空间是为了区分在不同的库中，两个名字相同但是功能不同的函数\n  - `::`为作用域运算符\n  - `<<`为标准库的输出运算符\n  - `std::cout`为标准输出流\n  - `std::endl`为输出的结束，该**控制器**会刷新输出缓冲区，并且进行换行，如果没有使用此控制器或者人为添加换行符，那么输出内容不会换行\n  - 控制器：在流中的控制器用于控制这个流\n  - 两个以上的字符串如果只是由空格分开，在输出流中它们会自动连接起来\n  - 控制器`setprecision(x)`：用于为后续输出设定`x`位有效位数，一般可以这样使用（使用完后注意重置为默认值）：\n\n    ```c++\n    //先保存初始的输出精度\n    streamsize prec = cout.precision();\n    //在输出流中调整输出精度为x后再调整回默认值\n    cout << setprecision(x) << grade << precision(prec);\n    ```\n\n  - 注意，在输出流中如果存在多个步骤，如输出流中调用了函数，即使程序仍然会按照流的顺序输出内容，但是程序的执行顺序有可能不是按照流的输出顺序执行的，这样有可能造成程序逻辑上的混乱\n\n  - `setw(length)`函数的使用：\n    - 使用例：`cout << setw(10) << name << endl;`\n    - 属于控制器，用于控制输出字段的长度\n    - 当后面紧跟着的输出字段长度小于`length`的时候，在该字段前面用空格补齐，当输出字段长度大于`length`时，全部整体输出\n    - 默认是右对齐，如果需要左对齐，可以在其前面添加`left`控制器\n\n- 标准输入流：\n\n  ```c++\n  std::cin >> name;\n  ```\n\n  - `cin`为标准输入流，`>>`运算符将输入的东西保存到`name`中，直到遇到**空白字符**或者**EOF**标记\n  - 空白字符：空格，制表键，换行符，回退键\n  - EOF：在Windows系统下，EOF为`CTRL+Z`，在Linux或者Unix系统下则为`CTRL+D`\n  - 输入时`cin`会略去首先输入的空白字符\n  - `cin >> a >> b;`等价于`cin >> a; cin >> b;`\n\n- 循环输入：\n\n  ```c++\n  while (cin >> x) {\n  \t//循环内容\n  }\n  ```\n\n  - 原理：输入首先会保存在缓冲区，然后直到按下回车，输入会以空白字符为界，按顺序将一串数据一个一个存储到变量`x`中，并且每存储一次就执行循环中的内容，直到遇到非法输入（类型与`x`不同）或者EOF退出循环\n\n- 缓冲区：输出/输入库会将输出保存在缓冲区中，只有在必要的时候，缓冲区的内容才会被送到输出装置中，从而将多个输出操作合为一个\n\n- 缓冲区刷新的几种情形：\n\n  - 缓冲区满\n  - 程序请求库从标准输入流中读取数据\n  - 手动刷新缓冲区\n  \n- 流迭代器：\n\n  - 在`<iterator>`中定义，使用时必须指明类型\n  - 输入流迭代器`istream_iterator<Type>(cin)`：迭代器的参数是可选的，通常情况下将其与`cin`连接，从这里读值，该迭代器缺省值的性质是，一旦到达了文件末尾或者处于错误状态，那么这个迭代器会与缺省值相等\n  - 输出流迭代器`ostream_iterator<Type>(cout, string)`：迭代器的第一个参数为`cout`，说明迭代器会往`cout`中写内容，第二个参数指定了一个值（一般是字符串），这个值会写在每个元素之后，这个参数也可以缺省\n  - 流迭代器的本质是模板\n\n- 头文件`<cctype>`中的几个有用的函数：它们在字符`c`满足后面的条件时返回`True`\n\n  - `isspace(c)`：空白\n  - `isalpha(c)`：字母\n  - `isdigit(c)`：数字\n  - `isalnum(c)`：数字或者字母\n  - `ispunct(c)`：标点符号\n  - `isupper(c)`：大写字母\n  - `islower(c)`：小写字母\n\n- 标准错误流：\n\n  - `cerr`：即时输出错误信息，保证一旦发生异常就立刻输出信息\n  - `clog`：倾向于生成日志，它具有着与`cout`一样的缓冲特性，平时存储错误信息，在适当的时候输出\n\n- 文件的输入与输出：\n\n  - `ifstream`：是一个用于读取文件内容的对象的类型\n\n  - `ofstream`：是一个用于向一个文件输出内容的对象的类型\n\n  - 上面两个类型定义在`<fstream>`中，使用时需要先将这两个类型的对象实例化，并且将字符串形式的文件名作为参数\n\n  - 在使用这两个类型的对象时有点类似于`istream`和`ostream`\n\n  - 使用例：\n\n    ```c++\n    ifstream infile(\"in\");\t//定义了一个与in文件相关联的文件输入流\n    ofstream outfile(\"out\");\t//定义了一个与out文件相关联的文件输出流\n    string s;\n    while (getline(infile, s)) {\n    \toutfile << s << endl;\n    }\n    ```\n  \n  - 注意：文件的路径如果使用的是相对路径，那么在调试时是工作区的目录的相对路径，在直接运行程序时则是相对于可执行文件所在位置的相对路径\n\n## 流程与异常控制\n\n### 不变式\n\n不变式可以理解为，一个类或者对象在设计的时候，对它的假设条件，在它的整个生命周期内，这些必须恒为真。例如：\n\n```c++\n//这里假设loop已经输出的行数\nint loop = 0;\nwhile (loop != rows) {\n\t//输出一行...\n}\n```\n\n这里`int loop = 0;`就是一个不变式，它在生命周期中，必须时刻等于输出的行数，否则会导致逻辑和程序流程控制的混乱，由于在这里不变式作为循环的一个判断依据，因此也被称为循环不变式\n\n### 异常控制\n\n异常控制用于给程序的使用者给出错误提示，提高程序的鲁棒性。程序抛出异常后，会在抛出异常的地方终止执行并且跳转到程序的另一部分（有点类似于中断），并向该部分提供一个异常对象，异常对象中含有程序可以处理异常信息。例如：\n\n```c++\ntry {\n  //该部分中任何一个语句发生了domain_error异常，都会停止执行下面的其他语句，转到执行catch下的语句\n  //如果没有发生异常，那么将不会执行catch中的语句\n} catch (domain_error e) {\n  //发生异常后执行的语句\n  //创建了一个异常对象e，名为what的成员函数用到了被复制下来的异常参数\n  cout << e.what();\n}\n```\n\n应当在编程时加入判断，是否满足产生异常的条件，如：\n\n```c++\nif (something == 0) {\n    throw domain_error(“Invalid Value!”);\n}\n```\n\n上面的语句意为，当满足条件时，程序会抛出一个`domian_error`，这种错误类型为域错误，即输入在定义域外的情况。C++中还有许多其他的错误类型可供使用，如`logic_error`，`runtime_error`等。\n\n## 多文件编程\n\n- 文件种类：\n\n  - `main.cpp`：主函数所在的文件\n  - `file_x.h`：头文件\n  - `file_x.cpp`：其他源代码文件\n  ......\n\n- 头文件的写法：\n  ```c++\n  #ifndef FILE_X_H\n  #define FILE_X_H\n  \n  //#ifndef必须位于文件的第一行\n  //不要在头文件中使用using声明，为用户保留最大的灵活性\n  //在头文件中包含其对应的源文件中所有需要用到的库\n  //在头文件中声明对应源文件中定义的函数\n  \n  #endif\n  ```\n\n- `#include <系统环境提供的头文件>`，`#include “自己写的头文件.h”`\n\n## 部分库函数\n\n### sort()\n\n- 库：`<algorithm>`\n\n- 参数：\n\n  1. 迭代器，序列的起始\n  2. 迭代器，序列的末尾\n  3. 谓词，可选参数，是自定义的比较方法\n- 功能：用于比较向量中的内容并按顺序存放，在未注明的情况下，对任何待排序的向量元素类型，它都会使用`<`来操作\n- 关于谓词：是一个函数，返回需值是布尔值\n\n### getline()\n\n- 库：`<string>`\n- 参数：\n  1. 输入流，一般为`cin`\n  2. 字符串引用，直接填目标字符串的名字\n- 功能：用于读一行的内容并将这些内容存储到目标字符串中\n- 如果遇到文件结尾或者无效输入，`getline()`的返回值会指示失败\n\n### copy()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示需要复制的元素的开头\n  2. 迭代器，指示需要复制的元素的末尾后一个元素\n  3. 迭代器适配器\n- 功能：将`[b,e)`之间的元素按迭代器适配器指定的方式添加到目标容器的末尾\n\n### equal()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 迭代器，指示第二个序列的开头（或者末尾）\n- 功能：从第二个序列的开头（或者末尾）开始，按顺序一个元素对应一个元素地比较两个序列中的内容，如果相等的话则返回`True`\n\n### find()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 被查找的值\n- 功能：在指定的序列中查找是否存在第三个参数的值，如果找到了，则返回序列中第一次出现这个值的位置，否则返回这个序列的末尾\n\n### find_if()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示被查找的序列的开头\n  2. 迭代器，指示被查找的序列的末尾\n  3. 谓词，检测自己出参数并且返回一个布尔值\n- 功能：对序列中的每个元素都调用谓词，直到谓词产生一个`True`的结果，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器\n\n### search()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示被查找的序列的开头\n  2. 迭代器，指示被查找的序列的末尾\n  3. 迭代器，指示查找的目标序列的开头\n  4. 迭代器，指示查找的目标序列的末尾\n- 功能：查找第一第二个参数所指示的序列中有没有第三第四个参数所指示的序列，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器\n\n### transform()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示待转换序列的开头\n  2. 迭代器，指示待转换序列的末尾\n  3. 迭代器，存放处理后的元素的容器的开头\n  4. 函数，`transform()`将这个函数作用于待转换序列以获得期望得到的元素\n- 功能：对待转换序列中的元素执行指定函数，并将转换后的结果存储于第三个参数指定的序列中\n\n### accumulate()\n\n- 库：`<numeric>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 单一变量\n- 功能：将序列中的元素之和加上变量中的值后再存储到这个变量中\n- 注意，第三个变量中的值类型会影响最终的结果的类型\n\n### remove_if()，remove()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 谓词，返回一个布尔值\n- 功能：排列序列中的内容，它将视那些使得谓词为`True`的元素所在的位置为空闲位置，并将后面那些使谓词为`False`的元素依次放置在空闲位置中，它的返回值是一个迭代器，它指示了那些所有使谓词为`False`的元素的末尾的位置\n- `remove()`的前两个参数含义与`remove_if()`相同，但是第三个参数是一个值，该函数的作用与`remove_if()`相同，不同之处在于是移动了那些等于第三个参数的元素\n\n### partition()，stable_partition()\n\n- 库：`<algorithm>`\n- 参数：\n  1. 迭代器，指示一个序列的开头\n  2. 迭代器，指示一个序列的末尾\n  3. 谓词，返回一个布尔值\n- 功能：两个函数的功能都是将谓词作用于序列中的元素，然后将那些使得谓词为`True`的元素位于序列的头部，返回一个指向第一个使得谓词为`False`的元素的迭代器，它们的区别在于`stable_partition()`会保持元素的顺序不变，而`partiotion()`则有可能导致元素的顺序混乱\n\n### rand()\n\n- 库：`<cstdlib>`\n- 参数：无\n- 功能：在`[0,RAND_MAX)`之间返回一个伪随机数，`RAND_MAX`是一个大整数，它也是在`<cstdlib>`中定义的\n- 如何返回在某个指定范围内的随机整数：基本思想是将可以利用的随机数分为长度相等的存储桶，存储桶的个数就是我们需要的随机数的最大值，然后再计算一个随机数并且返回它所在的桶的编号，程序如下：\n\n```c++\nint nrand(int n)\n{\n\tif (n <= 0 || n > RAND_MAX) {\n\t\tthrow domain_error(\"Argument to nrand is out of range. \");\n\t}\n\t\n\tconst int bucket_size = RAND_MAX / n;\n\tint r;\n\tdo r = rand() / bucket_size;\n\twhile (r >= n);\n\treturn r;\n}\n```\n\n# 编程习惯\n\n该部分的内容很多，涉及范围也很广，因此在这里我只纪录根据我个人实际情况需要注意的要点。更全面和详细的内容可以参考[C++ 风格指南 - 内容目录 — Google 开源项目风格指南 (zh-google-styleguide.readthedocs.io)](https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents/)。\n\n- 在编写运行时间较长的程序时，应当在合适的时刻刷新缓冲区\n- 循环的计数习惯：一般循环中的计数变量（假设为`i`）都从`0`开始，这样它的含义就比较明确，也即，`到目前为止，我们已经操作了i次`，此外这样做还有一个好处，那就是我们可以把循环条件设为`i != expected_loop_times`，这个不等式明确地表明了，当循环退出时，我们已经循环了`expectation_loop_times`次\n- 在定义一个变量来保存特定的数据结构时，应该使用库中为特殊用途而定义的类型，如现在想要顶一个存储字符串长度的变量`length`，那么可以有：`std::string::size_type length;`，另外还可以对库中提供的特殊类型重命名，如：`typedef std::string::size_type str_size;`就是将`std::string::size_type`这一类型在作用域内使用`str_size`来指代\n- 在操作容器中的多个元素时，推荐使用左闭右开的表示方法，这个区间中的元素个数就是上下限之间的差，这个区间的右界被称为越界值，这样做的理由有三个：\n  - 如果区间没有元素，那么找不到一个最后的元素标记终点\n  - 按照上面的方法定义，只要两个迭代器相等，那么立即可以判断区间为空\n  - 该方法提供了一种自然的方式表达“区间之外”\n- 在使用标准库提供的容器的时候，尽量使用对应的迭代器\n- 一般都使用`double`类型来进行浮点数计算\n- 在编写程序时，需要预见一些异常或者无意义的情况，在这种情况下程序最好暂时终止或者退出\n- 函数形式参数的名称最好不要太具体，因为某个函数可以用于多种含义不同的数据（这个思想对编写模板函数很重要）\n- 在输出时如果需要在输出的内容之间插入分隔符（如空格、逗号等），应当对第一个元素做特殊处理，具体思想是：当第一个元素生成（或者确保它已经存在）之后，输出第一个元素，然后再判断之后的元素是否存在，如果存在的话，就将它们与分隔符一起输出\n- 对于不希望改变对象内容的函数，应当将它们声明为`const`类型\n- 如果一个函数会改变一个对象的状态，那么这个函数应该作为对象的成员函数\n- 在设计二元运算符的时候，为了能够让左右操作数都可以进行类型转换以保持操作数的对称性，尽量将二元运算符定义在类的声明之外\n- 对于在创建对象时调用的构造函一般不用声明为`explicit`，而对于用于构造新的对象的构造函数需要声明为`explicit`\n- 不可以让用户用指针直接访问类中的私有成员\n- 使用句柄类时，当成员函数会改变底层对象的值时需要酌情进行复制操作，以保证指针的有效性\n\n","slug":"acc_cpp笔记","published":1,"updated":"2022-03-10T11:22:02.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0300101q39885vhvn6","content":"<blockquote>\n<p>虽然两年前就已经接触过C++，但是之前短暂的学习根本不足以让我系统掌握这门语言的用法。现在由于有项目开发的需求，我决定重新开始较为系统地学习C++。由于有C语言的基础，在入门阶段我使用Accelerated C++这本书来学习。这本书虽然较为老旧，但是内容不多，读起来也比较轻松。这篇文章是对我在看书和编程时遇到的问题和重点的总结备忘，内容比较零碎，还请大家谅解。</p>\n</blockquote>\n<h1 id=\"语言特性\"><a href=\"#语言特性\" class=\"headerlink\" title=\"语言特性\"></a>语言特性</h1><h2 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h2><ul>\n<li><p>声明：告诉编译器有这个对象存在，不需要建立内存</p>\n</li>\n<li><p>定义：需要建立内存的声明，也即实例化一个对象</p>\n</li>\n<li><p><code>main</code>函数返回一个整数类型的值作为结果，<code>0</code>表示成功</p>\n</li>\n<li><p><code>void</code>类型的函数可以不需要<code>return</code>语句，也可以写<code>return;</code></p>\n</li>\n<li><p>变量是一个具有名称的<strong>对象</strong>，对象是计算机中一段具有类型的内存空间（在C++中，一切皆对象）</p>\n</li>\n<li><p>在花括号中定义的变量，作用域只在它所在的花括号中</p>\n</li>\n<li><p>对象类型还有<strong>接口</strong>，接口就是可以对对象进行的操作的集合</p>\n</li>\n<li><p>重载：</p>\n<ul>\n<li>运算符的重载：一个运算符对于不同类型的操作数有不同的含义，如<code>1 + 1</code>与<code>&#39;A&#39; + &#39;B&#39;</code>中的加号具有不同的含义</li>\n<li>函数重载：两个功能不同的函数在具有相同名称时，当它们的参数不同时，会发生重载</li>\n</ul>\n</li>\n<li><p>关于<code>const</code>：</p>\n<ul>\n<li><p><code>const</code>表示该值为常量（只读），必须在定义它时进行初始化，变量也可以对常量进行初始化</p>\n</li>\n<li><p>如果给一个引用常量对象的函数传输一个非常量对象，那么这个对象会被视为常量</p>\n</li>\n<li><p>不可以对常量对象调用非常量函数</p>\n</li>\n<li><p>关于<code>const</code>的位置：</p>\n<ul>\n<li><p>修饰指针变量：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span>* pt = &amp;n;    <span class=\"comment\">//指针所指的数据是常量，但是指针是变量，可以指向其他地址</span></span><br><span class=\"line\"><span class=\"keyword\">int</span>* <span class=\"keyword\">const</span> pt = &amp;n;    <span class=\"comment\">//指针所指的数据是变量，指针是常量，只能指向n的地址</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span>* <span class=\"keyword\">const</span> pt = &amp;n; <span class=\"comment\">//指针和其所指的数据都不可以改变</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修饰函数参数：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">int</span> n)</span> </span>&#123;&#125;; <span class=\"comment\">//函数收到的参数是常量</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修饰成员函数：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> <span class=\"keyword\">const</span> </span>&#123;&#125;; <span class=\"comment\">//成员函数不能修改任何除了mutable修饰的的成员变量</span></span><br><span class=\"line\">                          <span class=\"comment\">//且不可调用非const成员函数</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修饰函数返回值：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;&#125;; <span class=\"comment\">//函数的返回值是常量，一般不需要这样用</span></span><br><span class=\"line\">                          <span class=\"comment\">//除了重载运算符外，一般不要将返回值类型定为对某个对象的const引用</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>关于<code>static</code>：</p>\n<ul>\n<li><code>static</code>表示该变量或函数是静态的，只能声明定义一次</li>\n<li>静态全局变量：具有全局寿命，在程序运行的整个过程中存在，它在进入<code>main()</code>函数初始化，在退出<code>main()</code>函数后被销毁，它只在声明它的文件中可见</li>\n<li>静态局部变量：在函数第一次执行到声明它的语句时进行初始化，它具有全局寿命，但是只在声明它的函数中可见，在单线程时多次调用包含静态局部变量的函数不会导致该静态局部变量被多次定义与初始化</li>\n<li>静态函数：它只在声明它的文件中可见，其他文件中可以声明名字相同的函数而且不会发生冲突</li>\n<li>静态数据成员：可以让该类的所有对象访问，只初始化一次，而且可以实现全局变量做不到的信息隐藏，它需要在类外部进行初始化</li>\n<li>静态成员函数：一般声明和定义都在类中，它只能访问其他静态成员函数和静态数据成员，它没有<code>this</code>指针<ul>\n<li>如果静态成员函数的声明在类中，定义在类外部，那么在外部定义时不能够加<code>static</code>关键字，否则就相当于声明了两次</li>\n<li>静态成员函数没有与其关联的对象，它可以通过类名或者对象名直接访问</li>\n</ul>\n</li>\n<li>使用<code>static</code> 修饰的变量是可以修改的</li>\n</ul>\n</li>\n<li><p>成员函数：某种类型的对象有一个或者多个函数成员，调用这些函数可以获得一个值，如<code>str.size()</code>可以获得字符串<code>str</code>的长度</p>\n</li>\n<li><p><code>using</code>声明：作用域为它所在的花括号内</p>\n<ul>\n<li><code>using namespace std;</code>：程序中默认使用<code>std</code>这个命名空间</li>\n<li><code>using namespace-name::name;</code>：使用<code>name</code>指代<code>namespace-name::name;</code></li>\n<li><code>using std::cout;</code>：使用<code>cout</code>指代<code>std::cout</code>，并且我们不会定义自己的<code>cout</code></li>\n</ul>\n</li>\n<li><p>类型转换的原则：较小的类型转换为较大的类型，有符号的类型会转换为无符号类型，算数值会被转换为布尔值，<code>0</code>可以视为<code>false</code>，而其他值都被视为<code>true</code></p>\n</li>\n<li><p>缺省初始化：一般来说，在对象定义时如果没有初始化，那么它的内容就是其内存单元中的随机内容，但是下面几种情况下，编译器会进行缺省初始化</p>\n<ul>\n<li>全局变量</li>\n<li>自定义类型的对象在没有初始化程序的情况下</li>\n</ul>\n</li>\n<li><p>左值与右值</p>\n<ul>\n<li>左值：位置值，也即内存地址</li>\n<li>右值：地址中存的值</li>\n</ul>\n</li>\n<li><p>增量/减量运算符（按照优先级排序）：</p>\n<ul>\n<li><code>i++</code>：对<code>i</code>加一，并且返回原始值</li>\n<li><code>i--</code>：对<code>i</code>减一，并且返回原始值</li>\n<li><code>++i</code>：对<code>i</code>加一，并且返回相加后的值</li>\n<li><code>--i</code>：对<code>i</code>减一，并且返回相减后的值</li>\n</ul>\n</li>\n<li><p>关于<code>clear()</code>方法：</p>\n<ul>\n<li>对字符串：将字符串的首地址内容存放<code>\\0</code></li>\n<li>对向量：清空向量内容</li>\n<li>对流：清除流内部的错误状态</li>\n</ul>\n</li>\n<li><p>泛型算法：可以用于不同类型的容器和不同的数据类型的算法</p>\n</li>\n<li><p>迭代器适配器：是一个函数，会产生与其参数相关的属性的迭代器以做他用，它会按照它给定的方式来对迭代器进行操作，下面给出了一些例子：</p>\n<ul>\n<li><code>back_inserter(des)</code>：将元素添加到<code>des</code>容器的末尾</li>\n<li><code>front_inserter(des)</code>：将元素添加到<code>des</code>容器的头部（链表支持该种操作，向量和字符串不支持）</li>\n<li><code>inserter(c, it)</code>：在<code>c</code>的迭代器<code>it</code>之前插入元素</li>\n</ul>\n</li>\n<li><p>不要将重载函数作为参数传递给模板函数，否则编译器将不知道需要使用的是重载函数哪个版本</p>\n</li>\n<li><p>将函数作为参数：将函数作为参数时，在声明的时候参数函数的编写形式类似于函数的声明，返回值和参数函数的参数必须与参数函数相一致，但是名称不需要一致</p>\n</li>\n<li><p>函数的缺省参数：在声明一个函数时，如果在参数后写上<code>= x</code>（<code>x</code>为某个值、序列、或者函数），那么这个参数默认值为<code>x</code>，在调用这个函数可以该参数缺省</p>\n</li>\n<li><p>函数的递归调用：在函数内部调用自身</p>\n</li>\n<li><p>内联函数：在函数声明与定义时，于函数名字前添加了<code>inline</code>关键字的函数，在编译时所有调用内联函数的地方都会被替换成函数体的代码以提高运行效率，对一般的函数，只有程序运行到调用函数的那个地方时，函数名才会被替代成相对应的函数代码，内联函数的长度不应超过10行</p>\n</li>\n<li><p><code>main</code>函数：</p>\n<ul>\n<li>完整形式：<code>main(int argc, char** argv)</code></li>\n<li>参数：<ul>\n<li><code>argv</code>：指向一个数组首元素地址的指针，数组中的每一个元素都是都指向一个字符串参数的指针</li>\n<li><code>argc</code>：<code>argv</code>指向的数组中的指针个数</li>\n</ul>\n</li>\n<li><code>argv</code>的第一个元素指向编译出的程序的名字的字符串的首地址</li>\n<li>在程序中可以直接使用这两个对象</li>\n</ul>\n</li>\n<li><p><code>NULL</code>，<code>nullptr</code>，<code>NaN</code>，<code>INF</code></p>\n<ul>\n<li><code>NULL</code>：历史上曾经用来指代空指针，现在已有了替代，值实际上是<code>0</code></li>\n<li><code>nullptr</code>：C++11引入的关键字，指代空指针</li>\n<li><code>NaN</code>：表示<em>Not a Number</em>，无效数字</li>\n<li><code>INF</code>：表示<em>Infinite</em>，无穷大，超出了浮点数的表示范围</li>\n</ul>\n</li>\n<li><p>如果非成员函数的调用位置在定义之前，那么需要先对其进行声明；如果调用位置在定义之后，就不需要声明了</p>\n</li>\n<li><p>前置声明：如果两个类的定义是相互依赖的，那么在定义第一个类前必须先对第二个类进行前置声明，告诉编译器有这个类存在，否则会出现无穷嵌套的问题</p>\n</li>\n</ul>\n<h2 id=\"新类型\"><a href=\"#新类型\" class=\"headerlink\" title=\"新类型\"></a>新类型</h2><h3 id=\"vector（向量）类型\"><a href=\"#vector（向量）类型\" class=\"headerlink\" title=\"vector（向量）类型\"></a>vector（向量）类型</h3><p>向量类型可以理解为大小可以按需要随意增长的数组</p>\n<ul>\n<li>定义：<code>vector&lt;double&gt; grade;</code>，该语句定义了一个类型为<code>double</code>类型的向量<code>grade</code></li>\n<li>一个向量中的所有数值具有相同的类型</li>\n<li>需要使用<code>&lt;vector&gt;</code>头文件</li>\n<li><code>grade.push_back(x)</code>：将<code>x</code>添加到<code>grade</code>向量的末尾</li>\n<li>描述向量长度的数据类型：<code>vector&lt;TYPE&gt;::size_type</code></li>\n<li>访问向量中的指定元素：类似于数组，如<code>grade[i]</code>，若一个向量有<code>grade.size()</code>个元素，那么它的第一个元素为<code>grade[0]</code>或者<code>grade.begin()</code>，最后一个元素为<code>grade[grade.szie() - 1]</code>或者 <code>grade.end()</code></li>\n<li>删除向量中的元素：<ul>\n<li>使用<code>erase()</code>成员函数，如：<code>grade.erase(grade.begin() + i)</code></li>\n<li><code>erase()</code>会在删除掉一个元素的同时，将这个元素后面的元素向前移动一个单位</li>\n<li><code>erase()</code>会返回一个迭代器（见下文），并且指向刚刚被删除的元素后面的那个元素</li>\n</ul>\n</li>\n<li>向量元素的预分配：可以减少重复的内存分配带来的系统开销<ul>\n<li><code>v.reverse(n)</code>：对向量<code>v</code>保留<code>n</code>个元素的内存空间，但不进行初始化，该操作不会改变容器的大小</li>\n<li><code>v.resize(n)</code>：给<code>v</code>一个长为<code>n</code>的新长度<ul>\n<li>新长度小于当前长度：向量位于长度<code>n</code>后的元素会被删除</li>\n<li>新长度大于当前长度：向量当前长度后与长度<code>n</code>前的空余位置会添加上新的元素，并且会进行初始化</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"list（双向链表）类型\"><a href=\"#list（双向链表）类型\" class=\"headerlink\" title=\"list（双向链表）类型\"></a>list（双向链表）类型</h3><p>链表中的每一个元素都有一个指针指向后一个元素，<code>list</code>（双向链表）的每一个元素都有两个指针，一个指向前一个元素，一个指向后一个元素。<code>list</code>的特性决定了我们可以快速地在容器的任何一个位置增删元素。在顺序访问的情况下，<code>list</code>的访问速度比<code>vector</code>差；但是对于大规模随机访问或者增删元素的情况，<code>list</code>的性能远远好于<code>vector</code>。</p>\n<ul>\n<li>定义示例：<code>list&lt;double&gt; grade;</code></li>\n<li>需要使用<code>&lt;list&gt;</code>头文件</li>\n<li><code>list</code>不支持索引</li>\n<li>具有<code>sort()</code>成员函数，它有一个可选的参数<code>compare</code>用于提供排序的比较方法，如果不提供该参数则默认使用<code>&lt;</code>来排序</li>\n</ul>\n<h3 id=\"对string类型的新认识\"><a href=\"#对string类型的新认识\" class=\"headerlink\" title=\"对string类型的新认识\"></a>对string类型的新认识</h3><ul>\n<li><code>string</code>类型可以视为一种特殊的容器，它支持索引操作，也有相对应的迭代器（类似<code>vector</code>）</li>\n<li><code>substr(i, j)</code>成员函数：创建一个新的字符串来保存<code>s</code>在区间<code>[i,i+j)</code>中的索引指示的字符的复制</li>\n</ul>\n<h3 id=\"对容器的一些其他操作\"><a href=\"#对容器的一些其他操作\" class=\"headerlink\" title=\"对容器的一些其他操作\"></a>对容器的一些其他操作</h3><ul>\n<li><code>c.rbegin()</code>：对于允许逆序访问的容器，该语句表示指向容器最后一个元素的迭代器，访问的顺序是逆向的</li>\n<li><code>c.rend()</code>：对于允许逆序访问的容器，该语句表示指向容器第一个元素之前的迭代器</li>\n<li><code>container&lt;Type&gt; c(c1);</code>：若<code>c1</code>存在，那么该语句表示定义一个容器<code>c</code>且其为<code>c1</code>的复制</li>\n<li><code>container&lt;Type&gt; c(n);</code>：定义一个有<code>n</code>个元素的容器<code>c</code>并根据<code>Type</code>对其元素进行初始化</li>\n<li><code>container&lt;Type&gt; c(n, t);</code>：定义一个有<code>n</code>个元素的容器<code>c</code>，<code>c</code>的元素是<code>t</code>的复制</li>\n<li><code>container&lt;Type&gt; c(b, e);</code>：定义一个有<code>n</code>个元素的容器<code>c</code>，<code>c</code>的元素是迭代器<code>[b,e)</code>之间的复制</li>\n<li><code>c.size()</code>：返回<code>c</code>中元素的个数，返回值类型为<code>size_type</code></li>\n<li><code>c.empty()</code>：用于指示<code>c</code>中有无元素，如果没有的话返回<code>True</code></li>\n<li><code>c.insert(d, b, e)</code>：复制<code>[b,e)</code>两个迭代器之间的元素，并将它们插入到<code>c</code>容器的<code>d</code>迭代器所指示的位置之前</li>\n<li><code>c.erase(b, e)</code>：从<code>c</code>中删除<code>[b, e)</code>两个迭代器之间的元素，对于不同的迭代器，该操作的速度有所不同</li>\n</ul>\n<h3 id=\"iterator（迭代器）类型\"><a href=\"#iterator（迭代器）类型\" class=\"headerlink\" title=\"iterator（迭代器）类型\"></a>iterator（迭代器）类型</h3><p>迭代器用于代替索引，以库能控制的方式访问元素。</p>\n<ul>\n<li>每一个标准容器都有两种迭代器类型：<ul>\n<li><code>container-type::const_iterator</code>：使用该迭代器只能读容器中的元素</li>\n<li><code>container-type::iterator</code>：使用该迭代器可以读也可以写容器中的元素</li>\n<li><code>iterator</code>类型可以转换为<code>const_iterator</code>类型，反之不行</li>\n</ul>\n</li>\n<li>使用例：<code>vector&lt;double&gt;::const_iterator iter = grade.begin();</code>，声明了一个名为<code>iter</code>的迭代器，且初始值为<code>grade</code>的第一个元素</li>\n<li>迭代器可以使用增量运算符（重载过）</li>\n<li>迭代器相当于是一个指针，可以使用<code>*</code>运算符间接引用迭代器所指向元素的内容（访问的是左值），在使用时应当注意运算符的优先顺序</li>\n<li>如果要获得迭代器引用的内容的一个元素，可以使用<code>*(iter).element</code>或者<code>iter -&gt; element</code>两种方式访问</li>\n<li>注意，对于不支持随机访问索引操作的容器，<strong>对迭代器的值进行手动更改（如给迭代器加或者减偏移量）将无法通过编译</strong></li>\n<li>删除迭代器当前所指示的元素会使得该迭代器失效</li>\n<li>对<code>vector</code>容器，<code>erase</code>和<code>push_back</code>操作会使得被操作以及之后的元素的迭代器失效，而对<code>list</code>容器则不会</li>\n<li>如果一个容器支持索引，那么它的迭代器也支持索引，如：<code>iter[2]</code>等价于<code>*(iter + 2)</code>，<code>iter[-1]</code>等价于<code>*(iter - 1)</code></li>\n</ul>\n<h3 id=\"map（映射表）类型\"><a href=\"#map（映射表）类型\" class=\"headerlink\" title=\"map（映射表）类型\"></a>map（映射表）类型</h3><p>之前提到的向量、链表等容器都是顺序容器，而<code>map</code>则属于关联容器。关联容器的序列不依赖于插入元素时的顺序，它只依赖于元素本身的值。关联容器的特性可以使我们更快地对特定元素定位。</p>\n<ul>\n<li><code>map</code>容器中存储的是一个<code>键-值</code>对<ul>\n<li>键：有点类似于顺序容器中的索引，它指向一个存储空间</li>\n<li>值：键所指向的存储空间中存放的内容</li>\n</ul>\n</li>\n<li>声明例：<code>map&lt;string, int&gt; m;</code>，该语句声明了一个名为<code>m</code>，从字符串到整数的映射表，其键的类型为<code>string</code>，值的类型为<code>int</code></li>\n<li>关联容器不可以对元素进行手动排序，一般不对关联容器的内容进行修改</li>\n<li>只要声明了一个关联容器，如果我们用一个未曾出现过的键作为映射表的索引，这个映射表会自动创建一个具有这个键的元素，且这个元素具有初始化的值，对于内部类型会被初始化为<code>0</code></li>\n<li><code>pair</code>（数对）类型：该类型提供了访问映射表的键和值的能力，映射表中的每个元素都是一个数对<ul>\n<li>数对有两个成员，<code>first</code>成员包含了键，<code>second</code>成员包含了值</li>\n<li>间接引用映射表迭代器时，获得的就是这个映射表关联的一个数对<code>pair&lt;const T1, T2&gt;</code></li>\n<li>注意，映射表的键是常量</li>\n</ul>\n</li>\n<li><code>map</code>的访问方法：<code>m[key]</code>，使用键<code>key</code>来索引访问映射表并返回一个左值，如果对于这个键没有一个合适的项目，那么则会新建一个元素</li>\n<li><code>map</code>的另一种访问方法：若<code>iter</code>是一个映射表的迭代器，那么<code>iter -&gt; first</code>可以得到数对的键，<code>iter -&gt; second</code>可以得到数对的值</li>\n<li>常量映射表无法使用索引访问</li>\n<li><code>find()</code>成员函数：参数为需要查找的键，如果查找到了则返回一个指向这个元素的迭代器，否则返回映射表的末尾</li>\n<li>一般情况下<code>map</code>都是自动排序的，但是在可以通过<code>map&lt;K, V&gt; m(cmp);</code>语句在声明时使用<code>cmp</code>来人工确定元素的顺序</li>\n</ul>\n<h3 id=\"自定义类型\"><a href=\"#自定义类型\" class=\"headerlink\" title=\"自定义类型\"></a>自定义类型</h3><p>作为核心语言的一部分，<code>int</code> 、<code>char</code>、<code>double</code>等类型都是内部类型；而<code>vector</code>、<code>string</code>等类型属于标准库的内容，是自定义类型。用户可以自己定义新的类型，自定义其中的数据、函数、访问接口等，以此对数据结构进行封装。</p>\n<ul>\n<li>自定义类的格式：</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Class_name</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//类型提供的接口</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"comment\">//类型的实现</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>public</code>：保护标识符，它指示类中的共有成员，类的所有用户都可以访问公有成员</li>\n<li><code>private</code>：保护标识符，它指示类中的私有成员，类的私有成员对用户来说是不可以直接访问的</li>\n<li>同样可以用<code>struct</code>关键字来自定义类，但是它与<code>class</code>有所区别，如：</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Student_info</span> &#123;</span></span><br><span class=\"line\">    string name;</span><br><span class=\"line\">    <span class=\"keyword\">double</span> midterm, <span class=\"keyword\">final</span>;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> gender;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> age;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>​        这里<code>Student_info</code>为一个具有5个数据成员的类型</p>\n<ul>\n<li><p>关于<code>class</code>和<code>struct</code>：<code>class</code>关键字声明的类型在第一个<code>&#123;</code>和保护标识符之间的所有成员都是私有的，<code>struct</code>则相反</p>\n</li>\n<li><p>自定义的类型只能出现一次，它只能出现在一个头文件中</p>\n</li>\n<li><p>在类型内部自定义成员函数时，可以直接访问对象内部的元素</p>\n</li>\n<li><p>如果是在头文件（<code>.h</code>）对应的源文件（<code>.cpp</code>）中定义的成员函数，函数的名字前必须加上<code>Class_name::</code>的作用域限定运算符，以明确函数是<code>Class_name</code>的一个成员函数，否则会出现函数未定义的编译错误</p>\n</li>\n<li><p>将成员函数定义在类内部与类外部的区别：在类内部定义的成员函数，实际就是把函数的调用扩展成内联的，这样可以提高程序运行效率</p>\n</li>\n<li><p>成员函数如果不是定义在类内部，<strong>必须在相对应的源文件（<code>.cpp</code>）中定义</strong>，否则会产生重复定义的问题（<strong>模板类除外</strong>）</p>\n</li>\n<li><p>如果在自定义类与全局环境中有同名函数，在函数名字前加上<code>::</code>（该运算符左侧没有内容）代表使用的是全局韩静中的那个函数</p>\n</li>\n<li><p>如果需要访问一个私有的数据成员，可以定义一个存取器函数（如下），但是它会破坏类的封装性：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">std::string <span class=\"title\">name</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> name; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>对声明为<code>static</code>的成员函数，它只能在类中定义</p>\n</li>\n</ul>\n<h4 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h4><p>构造函数是类的一个特殊的成员函数，它定义了对象的初始化方式。它的名字是类的名字且没有返回值，它会在创建一个自定义类型的对象时被自动调用。</p>\n<ul>\n<li><p>如果没有自定义构造函数，那么编译器会为我们自己创建一个</p>\n</li>\n<li><p>构造函数列表：在<code>public</code>作用范围内的构造函数的声明</p>\n</li>\n<li><p>构造函数的定义：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Student_info::<span class=\"built_in\">Student_info</span>(<span class=\"keyword\">double</span> midterm, <span class=\"keyword\">double</span> <span class=\"keyword\">final</span>);</span><br></pre></td></tr></table></figure>\n\n<p>上面定义了一个参数为 <code>midterm</code>和<code>final</code>的构造函数，下面给出声明与初始化例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">Student_info::Student_info <span class=\"title\">stu</span><span class=\"params\">(<span class=\"number\">100</span>, <span class=\"number\">99</span>)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>上面声明并初始化了一个名为<code>stu</code>的<code>Student_info</code>类型的对象，并设置了其成员数据的值</p>\n</li>\n<li><p>构造函数默认参数：构造函数的参数同样可以给定其默认值，从而可以进行缺省初始化</p>\n</li>\n<li><p>缺省构造函数：不带参数的构造函数，如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Student_info::<span class=\"built_in\">Student_info</span>(): <span class=\"built_in\">midterm</span>(<span class=\"number\">0</span>), <span class=\"built_in\"><span class=\"keyword\">final</span></span>(<span class=\"number\">0</span>) &#123;&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>使用该方式同样可以进行对象的缺省初始化</p>\n</li>\n<li><p>上面的语句中，<code>:</code>与<code>&#123;</code>之间的内容为<strong>构造函数初始化程序</strong>，程序会用括号中的值初始化相应的数据成员</p>\n</li>\n<li><p>创建一个对象时的过程：</p>\n<ol>\n<li>分配相对应的内存</li>\n<li>执行构造函数初始化程序</li>\n<li>执行构造函数函数体（在上面的例子中，函数体中没有内容）</li>\n</ol>\n</li>\n<li><p>不建议在构造函数的函数体中对对象进行初始化，如果这样那就相当于对对象做了两次初始化</p>\n</li>\n<li><p><code>explicit</code>关键字：函数名前添加了此关键字的构造函数只能在被显式调用时才能使用</p>\n</li>\n<li></li>\n</ul>\n<h4 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h4><p>析构函数是在一个对象被删除的时候被调用的，它来定义如何删除一个对象的示例。</p>\n<ul>\n<li>析构函数的函数名是在类的名字前面加上<code>~</code></li>\n<li>析构函数不带参数且没有返回值</li>\n<li>定义例：<code>~Student_info() &#123;&#125;</code></li>\n</ul>\n<h2 id=\"指针\"><a href=\"#指针\" class=\"headerlink\" title=\"指针\"></a>指针</h2><p>指针是一种随机存取的迭代器。</p>\n<ul>\n<li>一个指针是一个存放对象地址的值，一个对象是只包含它本身一个元素的容器，那么指针就是指向这个元素的迭代器</li>\n<li>对于一个指向对象<code>x</code>的指针<code>p</code>，有：<ul>\n<li><code>p</code>：<code>x</code>的地址</li>\n<li><code>*p</code>：<code>x</code>的内容，也即有<code>*p = x</code>，这里 <code>*</code>是一个间接引用运算符</li>\n<li><code>&amp;x</code>：<code>p</code>的内容，也即有<code>p = &amp;x</code>，这里<code>&amp;</code>是一个取地址运算符</li>\n</ul>\n</li>\n<li>一般使用<code>0</code>初始化指针变量，空指针的内容就是<code>0</code></li>\n<li>指针具有类型，对于一种类型<code>T</code>，可以定义一个指向<code>T</code>类型的对象的指针：<code>T* p;</code></li>\n<li>指针可以通过加减法修改它指向的值</li>\n<li>使用<code>ptrdiff_t</code>类型来表示两个指针的间距，它在<code>&lt;cstddef&gt;</code>头文件中</li>\n<li>野指针：指向被释放的内存空间的指针</li>\n<li>函数指针：<ul>\n<li>一个指针在声明时如果带上参数，那么他就变成了一个函数指针</li>\n<li>示例：<code>int (*fp)(int);</code>，调用<code>fp</code>时以一个<code>int</code>类型的变量作为参数，同时返回一个<code>int</code>类型的结果，这意味着<code>fp</code>是一个具有一个<code>int</code>类型参数并且返回一个<code>int</code>类型结果的函数的指针</li>\n<li>如果存在这样的一个函数：<code>int func(int)</code>，那么可以用<code>fp = &amp;func;</code>或者<code>fp = func;</code>来让<code>fp</code>指向<code>func</code></li>\n<li>如果<code>fp</code>指向<code>func</code>，那么可以使用<code>(*fp)(i)</code>或者<code>fp(i)</code>的方式调用<code>func</code>，其中<code>i</code>为整型</li>\n<li>如果将一个函数名作为另一个函数的参数，那么编译器会将这个参数转换成一个指向那个函数的指针</li>\n</ul>\n</li>\n<li>使用指针时可能导致问题出现的原因：<ul>\n<li>复制一个指针时不会复制指针所指的对象</li>\n<li>删除一个指针不会释放对象所占用的内存</li>\n<li>删除一个对象但是没有删除指向该对象的指针会产生一个空悬指针</li>\n<li>定义了一个指针但是不进行初始化</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h2><p>数组是最基础的容器，它是核心语言的一部分。</p>\n<ul>\n<li>数组元素个数必须在编译时确定，它不能动态增减尺寸</li>\n<li>使用<code>size_t</code>类型来表示一个数组的大小，它在<code>&lt;cstddef&gt;</code>头文件中</li>\n<li>对于一个有<code>n</code>个元素的数组，只有指向<code>[0,n)</code>的指针是合法的</li>\n<li>数组支持索引操作</li>\n<li>数组定义的两种方法：<ul>\n<li>只声明，需要显式地确定元素个数：<code>int num[5];</code></li>\n<li>定义的同时进行初始化，无需显式地确定元素个数：<code>int num[] = &#123;1, 2, 3, 4, 5&#125; ;</code></li>\n</ul>\n</li>\n<li>字符串实际就是一个字符类型的数组，它的最后一个字符为空字符<code>\\0</code>，使用<code>strlen</code>函数可以确定字符串的大小</li>\n<li><code>sizeof()</code>：返回一个<code>size_t</code>类型的值，其值以<code>bytes</code>为单位，如果需要返回数组的元素个数，那么可以用<code>sizeof()</code>的返回值除数组中每个元素占用空间的大小</li>\n<li>如果数组以指针的方式作为函数的参数，那么它会退化成一个指针，这个时候无法通过<code>sizeof()</code>得到指针所指数组的长度，只能得到指针所占空间的大小</li>\n</ul>\n<h2 id=\"内存分配\"><a href=\"#内存分配\" class=\"headerlink\" title=\"内存分配\"></a>内存分配</h2><ul>\n<li><p>一般来说有三种分配内存的方法：</p>\n<ul>\n<li>自动分配：在使用局部变量时就使用了自动分配内存的策略，用时分配，用完释放</li>\n<li>静态分配：使用<code>static</code>关键字限定的对象，系统只会对它进行一次内存分配，直到程序结束才释放</li>\n<li>动态分配：使用<code>new</code>与<code>delete</code>关键字分配的对象</li>\n</ul>\n</li>\n<li><p><code>new</code>与<code>delete</code>：使用<code>new</code>创建的对象一直存在直到对其使用<code>delete</code>或者程序结束</p>\n</li>\n<li><p>为对象分配或释放内存：</p>\n<ul>\n<li><code>new T;</code>：为一个没有名字的<code>T</code>类型的对象分配内存</li>\n<li><code>new T(args);</code>：与上面类似，但是内存中存有值<code>args</code></li>\n<li><code>int* p = new int(100);</code>：将一个<code>int</code>类型的指针<code>p</code>指向<code>new</code>开辟的存有<code>100</code>的内存空间</li>\n<li><code>delete p;</code>：删除指针<code>p</code>并且释放其指向的内存空间</li>\n</ul>\n</li>\n<li><p>为数组分配或释放内存：</p>\n<ul>\n<li><code>new T[n];</code>：为一个具有<code>n</code>个<code>T</code>类型的对象数组分配内存，并且返回一个指向数组首元素的指针，数组中的每一个对象都会被默认初始化</li>\n<li>在上面的表达式中如果<code>n</code>为<code>0</code>，那么数组中将没有任何元素，并且<code>new</code>无法返回一个有意义的指针</li>\n<li><code>T* p  = new T[n];</code>：将指针<code>p</code>指向新开辟的数组的首地址</li>\n<li><code>delete[] p;</code>：从后向前释放指针<code>p</code>指向的数组所用的全部内存空间，如果索引运算符内添加了索引，那么只释放索引指定的那个内存空间</li>\n</ul>\n</li>\n<li><p><code>malloc()</code>函数：</p>\n<ul>\n<li>库：<code>&lt;stdlib&gt;</code></li>\n<li>参数：<code>size_t</code>类型，为需要分配的内存空间大小</li>\n<li>返回一个<code>void*</code> 类型（未知类型）的指针，在使用时需要进行强制类型转换，若失败则返回<code>NULL</code></li>\n<li>使用例：<code>char* cp = (char*)malloc(10);</code></li>\n<li><code>malloc</code>不会对分配的空间进行初始化，而<code>new</code>会</li>\n</ul>\n</li>\n<li><p>内存分区：</p>\n<ul>\n<li>堆区：由用户手动申请与释放，若不释放则在程序结束后释放，使用<code>new</code>或 <code>malloc</code>申请的内存在此区域</li>\n<li>栈区：由系统管理，主要存放函数的参数以及局部变量</li>\n<li>静态存储区：在编译时就已经分配好内存空间并且进行初始化，主要存放静态变量、全局变量以及常量</li>\n<li>代码区：存放程序体的二进制代码</li>\n</ul>\n</li>\n<li><p>内存分配器<code>allocator</code>：</p>\n<ul>\n<li><code>allocator&lt;T&gt;</code>是一个类，它定义在<code>&lt;memory&gt;</code>头中，使用时需要加上<code>std::</code></li>\n<li>在使用<code>allocator&lt;T&gt;</code>类时，需要先将其实例化，如：<code>std::allocator&lt;T&gt; alloc;</code></li>\n<li>在程序中通过调用对象的成员函数来实现内存分配，下面是一些常用的成员函数：<ul>\n<li><code>T* allocate(size_t)</code>：用于分配一块长度为<code>size_t</code>，类型为<code>T</code>但并未被初始化的内存块，并返回这块内存的地址</li>\n<li><code>void deallocate(T*, size_t)</code>：用于释放未被初始化的内存，第一个参数为<code>allocate</code>函数返回的指针，第二个参数为指针指向的内存块的大小</li>\n<li><code>void construct(T*, T)</code>：用于对使用<code>allocate</code>函数分配的未初始化的内存进行初始化，第一个参数为<code>allocate</code>函数返回的指针，第二个参数需要复制的初始值</li>\n<li><code>void destroy(T*)</code>：用于删除指针所指的对象，它会调用析构函数</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>另外两个内存分配中可能有用的库函数：</p>\n<ul>\n<li><code>T* std::uninitialized_copy(T*, T*, T*)</code>：用于将前两个参数指针所指的区域中内存的值复制到第三个参数指针指向的目标内存块中，并且返回一个指向被初始化的你内存中的末元素后一个元素的地址</li>\n<li><code>void std::uninitialized_fill(T*, T*, const T&amp;)</code>：用于向前两个参数指针所指的区域的内存中复制第三个参数所引用的值</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"泛型函数\"><a href=\"#泛型函数\" class=\"headerlink\" title=\"泛型函数\"></a>泛型函数</h2><ul>\n<li>含义：不知道参数和返回值类型的函数，用于解决一类抽象问题</li>\n<li>函数中使用的变量必须支持函数中所进行的操作</li>\n</ul>\n<h3 id=\"模板函数\"><a href=\"#模板函数\" class=\"headerlink\" title=\"模板函数\"></a>模板函数</h3><p>泛型函数的具体实现。模板函数可以让不同的对象享有共同的行为特性，在定义模板函数的时候我们不知道模板参数对应的特定类型。下面给出了定义模板函数的示例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;</span></span><br><span class=\"line\"><span class=\"function\">T <span class=\"title\">function</span><span class=\"params\">(vector&lt;T&gt; v)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//函数内容...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>template &lt;class T&gt;</code>定义了一个模板头，它告诉系统环境定义了一个模板函数，而且这个函数有一个类型参数</li>\n<li>如果要使用嵌套类型（也即由模板参数定义的类型），那么必须要使用<code>typename</code>关键字，如：<code>typedef typename vector&lt;T&gt;::size_type vec_sz;</code>，使系统将这个名称当做一个类型处理</li>\n<li>模板函数的实例化过程在不同系统下有所不同</li>\n<li>模板函数的正确性是由参数之间的正确关系决定的，如果参数之间产生了可能导致歧义和信息丢失的关系，那么这个函数的程序很有可能是有错误的，甚至无法通过编译</li>\n<li>在编写模板函数的时候，为了使函数可以处理存储于各种数据结构中的数值，并且能够作用于容器的一部分而非整容器，一般我们使用迭代器参数而不是容器参数</li>\n</ul>\n<h3 id=\"迭代器的类型\"><a href=\"#迭代器的类型\" class=\"headerlink\" title=\"迭代器的类型\"></a>迭代器的类型</h3><p>下面的迭代器每一种都对应了一个特定的迭代器操作集合，每一个迭代器种类还对应了一个访问容器的策略，同时也对应了特定的算法。在编写模板函数时需要注意不同迭代器的选择。</p>\n<ul>\n<li>输入迭代器<code>In</code>：该种迭代器对一个序列提供了<strong>顺序只读访问</strong>的操作，它支持的操作有：<code>++</code>、<code>==</code>、<code>!=</code>、<code>*(读)</code></li>\n<li>输出迭代器<code>Out</code>：该种迭代器对一个序列提供了<strong>顺序写入</strong>的操作，它要求调用它的程序不可以在对迭代器的两个赋值之间执行超过一次的自增操作，也不能在没有对迭代器递增时对其多次赋值</li>\n<li>正向迭代器<code>For</code>：该种迭代器对一个序列提供了<strong>顺序读-写访问</strong>的操作，它可以在对一个元素赋值后再读取它的值，因此不需要满足输出迭代器的一次赋值要求，它支持的操作有：<code>*(读写)</code>、<code>++</code>、<code>==</code>、<code>-&gt;</code>，所有的标准库容器都满足正向迭代器的要求</li>\n<li>双向迭代器<code>Bi</code>：该迭代器对一个序列提供了<strong>可逆读-写访问</strong>的操作，它不仅有正迭代器的功能，还支持<code>--</code>（也即逆序访问）的操作，所有的标准库容器都支持双向迭代器</li>\n<li>随机迭代器<code>Ran</code>：该迭代器对一个序列提供了<strong>随机访问</strong>的操作，它的行为有点类似索引，不仅有双向迭代器的功能，而且支持算术运算，若<code>p</code>和<code>q</code>是两个迭代器，那么它们支持：<code>p + n</code>、<code>p - n</code>、<code>n + p</code>、<code>p - q</code>（得到的是两个迭代器之间的距离，整型）、<code>p &lt; q</code>、<code>p &gt; q</code>、<code>p &gt;= q</code>，向量和字符串迭代器都是随机访问迭代器，而链表迭代器则是双向迭代器</li>\n</ul>\n<h2 id=\"模板类\"><a href=\"#模板类\" class=\"headerlink\" title=\"模板类\"></a>模板类</h2><p>模板类用于生成一个类，这个类生成的多个对象可以分别存储不同类型的数据。模板类相当于定义了存储自定类型的数据结构的一个容器。</p>\n<ul>\n<li><p>声明例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Name</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>上面的语句声明了一个名字为<code>Name</code>，可以存储并处理<code>T</code>类型数据的模板类，这里的<code>T</code>类型会在将这个类实例化的时候确定，如<code>Name&lt;int&gt; N;</code>使用<code>Name</code>模板创建了一个<code>T</code>为<code>int</code>类型的对象</p>\n</li>\n<li><p><strong>模板类的声明和实现必须全部写在头文件中</strong></p>\n</li>\n<li><p>模板类的成员函数如果需要在类外部定义，那么为了将函数的作用域明确为在类的内部，需要做以下更改：</p>\n<ul>\n<li>在函数的定义前面加上<code>template &lt;class T&gt;</code></li>\n<li>在函数名前面添加<code>Name::</code></li>\n<li>在所有的<code>Name</code>后面添加<code>&lt;T&gt;</code></li>\n</ul>\n</li>\n<li><p>自定义模板类的时候一定要全面地考虑其初始化、内存分配、复制的问题，必要时可以自定义这些操作</p>\n</li>\n<li><p>模板类的构造函数例：</p>\n<ul>\n<li><code>Name() &#123;&#125;</code>：最普通的无参构造函数</li>\n<li><code>Name(size_type n, const T&amp; val = T()) &#123;&#125;</code>：该构造函数的参数为一个指定了对象大小的<code>size_type</code>类型的参数<code>n</code>，以及提供了初始化的默认值的<code>const T&amp;</code>的参数，它的缺省值由<code>T</code>的构造函数提供</li>\n</ul>\n</li>\n<li><p>可以使用<code>typedef</code>关键字来自定义类型名，如：<code>typedef T* iterator;</code></p>\n</li>\n<li><p>运算符重载：在自定义类中可以对内置的运算符进行重载以实现需要的功能，如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T&amp; <span class=\"keyword\">operator</span>[](size_type i) &#123; <span class=\"keyword\">return</span> data[i]; &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> T&amp; <span class=\"keyword\">operator</span>[](size_type i) <span class=\"keyword\">const</span> &#123; <span class=\"keyword\">return</span> data[i]; &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>运算符重载的声明有点像定义了一个<code>operator&quot;运算符&quot;</code>函数</li>\n<li>如果需要使运算符不改变对象的值，那么就在运算符重载的定义前面以及函数体前面加上<code>const</code>关键字</li>\n<li>如果某个重载运算符函数是类的一个成员函数：<ul>\n<li>它的左操作数（二元运算符）或者唯一的操作数（一元运算符）必须是调用它的对象</li>\n<li>它的左操作数（二元运算符）会以<code>this</code>指针的方式默认地传递给这个成员函数</li>\n</ul>\n</li>\n<li>如果某个重载运算符函数不是类的一个成员函数，那么重载运算符函数的第一个参数是左操作数，第二个参数是右操作数</li>\n</ul>\n</li>\n<li><p><code>this</code>指针：<code>this</code>关键词只在成员函数内部有效，代表指向函数操作对象的指针，指针的类型由函数的操作对象决定</p>\n</li>\n<li><p>复制控制：</p>\n<ul>\n<li>复制构造函数：用于复制一个已经存在的同类型的对象，以此来初始化一个新的对象，它只带一个与类本身类型相同的参数，并且由于复制不应该改变已有对象的值，因此它的类型应该为常量引用类型</li>\n<li>复制构造函数的函数体应该为自定义的复制操作，如果函数体为空，那么将使用系统默认的方式进行复制</li>\n<li>在复制对象时，由于对象的副本的地址与原对象不同，因此不可以将原对象中指向原对象本身的指针同时复制过去，应当重置这些指针使得它们对新对象有意义</li>\n</ul>\n</li>\n<li><p>赋值运算符：</p>\n<ul>\n<li>赋值操作函数：把一个对象中已经存在的值<strong>擦除</strong>，然后装入一个新的值</li>\n<li>类中可以重载赋值运算符，如：<code>Name&amp; operator=(const Name&amp; n) &#123;&#125;</code></li>\n<li>这里的参数为右操作数的一个引用</li>\n<li>在函数体内可以通过该语句判断是否是自我赋值：<code>&amp;n != this</code>，该语句比较了左右操作数的地址，如果两者相等则为自我赋值</li>\n<li>赋值与复制的区别：复制是将一个值插入一个新的对象，不需要删除操作</li>\n<li>构造函数只控制初始化操作，<code>operator=</code>函数只控制赋值操作</li>\n</ul>\n</li>\n<li><p>在使用<code>=</code>为变量赋初始值时调用的是赋值构造函数，在赋值表达式中<code>=</code>调用的是赋值操作函数</p>\n</li>\n<li><p>如果一个类没有显式地定义构造函数或者析构函数，那么编译器将自动生成执行这些操作的默认函数</p>\n</li>\n<li><p>默认的析构函数在删除一个指针变量时不会释放该指针指向的对象占用的内存空间</p>\n</li>\n<li><p>三位一体原则：如果类需要一个析构函数，那么它同时有可能需要一个复制构造函数和一个赋值操作函数</p>\n</li>\n<li><p>友元函数：如果一个函数定义在类的声明外部，但是又需要它具有访问<code>private</code>成员数据的权限，那么可以在类内部声明这个函数时，前面加上<code>friend</code>关键字，将其声明为一个友元函数</p>\n</li>\n<li><p>模板特化：只有当模板类的实际的对象类型<code>T</code>为指定类型时，才调用指定类型对应的模板成员函数，声明与定义如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">function</span><span class=\"params\">(<span class=\"keyword\">int</span> var)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"对象的初始化\"><a href=\"#对象的初始化\" class=\"headerlink\" title=\"对象的初始化\"></a>对象的初始化</h2><ul>\n<li>初始化与赋值：<ul>\n<li>初始化：在创建一个变量时赋予它一个初始值</li>\n<li>赋值：将对象的当前值擦去，并且用一个新值替代</li>\n</ul>\n</li>\n<li>下列情况发生时会进行初始化：<ul>\n<li>声明一个变量</li>\n<li>函数入口处用到函数参数</li>\n<li>函数返回处用到函数返回值</li>\n<li>构造初始化</li>\n</ul>\n</li>\n<li>通过显式地调用构造函数进行初始化称为<strong>显式初始化</strong>，否则称为<strong>隐式初始化</strong></li>\n<li>使用<code>=</code>初始化一个对象称为<strong>拷贝初始化</strong>，不用等号则是<strong>直接初始化</strong></li>\n<li>如果对象没有进行显式初始化，则会进入<strong>隐式初始化</strong>的<strong>状态</strong>，在<strong>隐式初始化</strong>状态下会进行<strong>缺省初始化</strong>的<strong>过程</strong>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </li>\n<li>关于不同种类对象的缺省初始化方式：<ul>\n<li>全局或者静态的对象：空串或者<code>0</code></li>\n<li>对象为局部的内部类型：未定义的值</li>\n<li>内部类型作为类的成员：在某些条件下会被数值初始化为<code>0</code></li>\n<li>自定义类型且有构造函数：使用构造函数初始化</li>\n<li>自定义类型且无构造函数：递归地对对象中的每一个数据成员进行相应的数值初始化或者缺省初始化</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><ul>\n<li>自动类型转换：<ul>\n<li>自动转换的例子很常见，如将<code>int</code>类型的右值赋给<code>double</code>类型的左值时，该右值就会被自动转换为<code>double</code>类型</li>\n<li>自动类型转换分为下面两种情况：<ul>\n<li>内置类型向自定义类型转换</li>\n<li>自定义类型向内置类型转换</li>\n</ul>\n</li>\n<li>内置类型转换为用户自定义类型：需要在自定义类内部编写带单参数的构造函数<ul>\n<li>例如：<code>Name(const char* cp) &#123; //将参数提供的内容存入临时的Name类型的对象中 &#125;</code>，对<code>Name</code>类型，该构造函数会在编译器需要一个<code>Name</code>类型的对象却收到了一个<code>const char*</code>类型的对象的时候被调用</li>\n</ul>\n</li>\n<li>用户自定义类型转换为内置类型：需要在自定义类内部编写如下例所示的成员函数<ul>\n<li>例如：<code>operator int() &#123; //将自定义类型转换为int类型 &#125;</code>，该函数会在显式强制转换或者对象传入的值类型不符时被调用，函数的返回值为由其类型名确定</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>如果两个类之间彼此定义了向另一个类的转换操作，会导致转换时出现二义性</li>\n<li>混合类型表达式：混合类型表达式意为在一个语句中使用运算符同时操作不同类型的对象的表达式，它在实现的过程中会进行多次类型转换，同时产生大量的临时变量，比较浪费内存</li>\n</ul>\n<h2 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h2><ul>\n<li>形如<code>int&amp; i;</code>的变量即为引用变量，左侧的表达式是对其进行声明的过程</li>\n<li>如果存在一个整型变量<code>temp</code>，那么令<code>i = temp;</code>，则<code>i</code>指向的内存位置与<code>temp</code>相同，<code>i</code>相当于是<code>temp</code>的一个别名</li>\n<li>引用作函数参数：<ul>\n<li>非常量引用：<code>int function(vector&lt;string&gt;&amp; count);</code>，形式参数<code>count</code>存放的是实际参数的地址（<code>&amp;</code>的意思有一些像取地址，但是二者是有区别的），可以直接在函数内更改实际参数的值，而且不需要重新复制一个变量，减少资源消耗</li>\n<li>常量引用：<code>int function(const vector&lt;string&gt;&amp; count)</code>，常量引用只能藉由实际参数的地址读取它的内容且无法进行修改，该操作同样不需要重新复制变量</li>\n<li>一般来说，对于<code>int</code>或者<code>double</code>类型的参数可以不需要引用，因为对它们的复制是非常快的</li>\n</ul>\n</li>\n<li>值类型作函数返回值：<ul>\n<li>对于值类型的返回值，编译器会先将这个值复制到一个临时变量内并且返回这个临时变量</li>\n<li>函数调用完成，这个临时变量在被使用一次后（也可能不被使用），它即被销毁</li>\n</ul>\n</li>\n<li>引用作函数返回值：<ul>\n<li>引用作函数返回值的时候，不可以引用局部变量，因为函数调用完成后局部变量就被销毁，这个引用就无效了</li>\n<li>当引用作函数返回值时，不需要将变量重新复制一次保存在临时变量中</li>\n<li>引用作返回值时可以作为左值</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><ul>\n<li><p>定义：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">A</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span>:...</span><br><span class=\"line\">    <span class=\"keyword\">private</span>:...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span>:</span> <span class=\"keyword\">public</span> A &#123;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>上面定义了一个类<code>B</code>，它是从<code>A</code>中继承而来，称<code>A</code>是基类（或者父类），<code>B</code>是继承类（派生类、子类）</li>\n<li>这里派生类继承了基类的公有部分，也即基类的公有成员才是子类的一部分</li>\n<li>同样可以使用<code>private</code>或者<code>protected</code>关键字来指定继承的方式</li>\n</ul>\n</li>\n<li><p>继承关系是可以嵌套的</p>\n</li>\n<li><p>基类和继承类的关系：基类就是继承类，继承类不是基类，对于他们的引用或者指针同样有这个关系</p>\n</li>\n<li><p>基类不可以强制转换为派生类</p>\n</li>\n<li><p>关于基类或者继承类作为函数参数：</p>\n<ul>\n<li>形式参数与实际参数匹配的情形不讨论</li>\n<li>如果形式参数是基类类型的，传入一个继承类的对象会将其转换为基类</li>\n<li>如果形式参数是继承类型的，那么实际传入的对象只有继承类的部分</li>\n</ul>\n</li>\n<li><p><code>protected</code>：保护标识符，它指示类中的保护成员，类的保护成员可以被其继承类访问</p>\n</li>\n<li><p>如果需要显式地表明某些成员是继承来的或者明确指明调用基类或者继承类的成员函数，可以使用范围（作用域）运算符</p>\n</li>\n<li><p>构造初始化器：也即构造函数，在使用构造初始化器时直接将相应的参数填入构造函数中即可，编译器会根据参数的类型匹配相应的构造函数</p>\n</li>\n<li><p>派生类对象构造的步骤：</p>\n<ul>\n<li>为整个对象分配内存空间</li>\n<li>隐式（或者显式）调用基类的构造函数来初始化对象中的基类部分数据</li>\n<li>用构造初始化器对派生类部分的数据进行初始化</li>\n<li>如果有的话，执行派生类构造函数的函数体</li>\n</ul>\n</li>\n<li><p>继承关系中成员函数的覆盖：如果基类与继承类中有两个同名同参同返回值类型的非<code>const</code>函数，那么派生类的这个函数会覆盖基类的函数，当基类与继承类的函数都返回指向他们本身类型的指针时除外</p>\n</li>\n</ul>\n<h3 id=\"虚函数\"><a href=\"#虚函数\" class=\"headerlink\" title=\"虚函数\"></a>虚函数</h3><ul>\n<li>定义：在基类中定义成员函数时前面加上<code>virtual</code>关键字，在继承类中同名同参函数的<code>virtual</code>的特性也会被继承，因此不需要重复加</li>\n<li>虚函数必须要有定义，不能只有声明</li>\n<li>功能：由于继承类也是基类，因此当以引用或者指针的形式调用成员函数时，程序根据实际的对象类型来在基类与继承类中选择正确的同名成员函数，也即<strong>动态绑定</strong></li>\n<li>静态绑定：在编译时就确定调用的对象的成员函数的种类</li>\n<li><strong>多态</strong>：用一个类型表示多种类型的能力，这里动态绑定实现了多态</li>\n<li>只有在<em>以引用或者指针的形式</em>调用虚拟函数的时候在运行时选择类型才有意义</li>\n<li>虚拟析构函数：当使用指针来控制对象时，调用<code>delete</code>函数会调用这个虚拟析构函数，一般虚拟析构函数都是空的</li>\n<li>如果基类与继承类中有同名不同参的函数，那么他们之间毫无关系，不需要用到需函数的技术</li>\n<li>如果在构造函数内部调用虚函数，那么它会静态绑定成正在构造的对象所属于的类中的那个虚函数</li>\n</ul>\n<h3 id=\"代理类\"><a href=\"#代理类\" class=\"headerlink\" title=\"代理类\"></a>代理类</h3><ul>\n<li>代理类实际上就是一个普通的用户自定义类，它的成员数据是指向基类的指针</li>\n<li>功能：存储和管理基类指针，这个基类指针既可以指向基类对象又可以指向派生类对象，使用代理类可以实现动态绑定，它将基类和派生类中的细节封装起来，提供了一个统一的接口</li>\n<li>代理类中一般包含这些实现细节：<ul>\n<li>各种构造（析构）函数与复制控制函数：用于提供分配或者销毁内存空间的操作</li>\n<li>基类和继承类中共有的操作：提供操作接口，实现动态绑定的功能</li>\n<li>其他操作</li>\n</ul>\n</li>\n<li>关于代理类的复制操作：需要在它管理的基类和继承类中定义虚拟的复制控制函数，并且在代理类的复制操作中调用它，在复制时有必要判断指向被复制对象的指针是否时空指针</li>\n<li>友元类：将一个类声明为另一个类的友元可以使另一个类中的所有成员都成为那个类的友元</li>\n</ul>\n<h2 id=\"句柄类\"><a href=\"#句柄类\" class=\"headerlink\" title=\"句柄类\"></a>句柄类</h2><ul>\n<li>功能：上面提到的代理类可以视为一种简单的句柄类，但是它是通过复制对象来实现动态绑定的，句柄类的最主要功能就是实现在不用复制对象的情况下就实现动态绑定并且自动管理内存</li>\n<li>一般来说，句柄类是一个模板类，因为它与它操作的模板之间是相互独立的，句柄类具有通用性</li>\n<li>与代理类相似，句柄类要将被控制的类的全部接口封装起来</li>\n<li>复制操作：在复制时需要将该句柄类的指针当前所指向的对象删除后再重新将指针指向被复制的对象的地址</li>\n<li>使用方法：在实际的程序中，通常使用一个接口类来管理基类与继承类，接口类的成员数据是一个句柄类，接口类通过操作句柄类来控制基类与继承类</li>\n<li>接口类的构造函数必须对句柄类做初始化</li>\n</ul>\n<h3 id=\"计数句柄类\"><a href=\"#计数句柄类\" class=\"headerlink\" title=\"计数句柄类\"></a>计数句柄类</h3><ul>\n<li>相比于一般的句柄类，计数句柄类在复制对象时会有选择的对底层的对象进行复制，这意味着计数句柄在复制时并不总是将底层对象的内容重新拷贝一份，而是让多个复制出来的句柄的指针同时指向同一个底层对象</li>\n<li>为了实现上面的功能，需要在句柄类添加一个<strong>引用计数</strong>指针，它用来记录有多少个对象指向底层对象</li>\n<li>复制构造函数：计数句柄类的复制构造函数不需要复制底层的对象，它的基本操作如下：<ul>\n<li>对右操作数所指向的对象的引用计数指针加一，表示有一个新的计数句柄类指向同一个底层对象</li>\n<li>如果当前左操作数的引用计数指针值为<code>1</code>，那么意味着没有其他句柄指向这个底层对象了，复制操作会将左操作数的指针覆盖掉，所以这里将左操作数指向的对象和其计数指针所占的内存空间释放掉</li>\n<li>将右操作数的对象指针和引用技术指针的复制到左操作数中</li>\n</ul>\n</li>\n<li>析构函数：同样要考虑当前的句柄类是不是最后一个指向该对象的句柄，具体操作不再赘述</li>\n<li>在修改句柄类指向的对象的值时，亦需要考虑当前的句柄类是不是最后一个指向该对象的句柄，如果是的话，那么直接修改这个指针指向的对象的值即可，否则要先将当前所指向的对象的引用计数减一，然后基于旧对象复制一个新对象并将指针指向它，并将它的引用计数设为一，上述的操作可写为成员函数并在接口类中调用</li>\n</ul>\n<h2 id=\"抽象基类\"><a href=\"#抽象基类\" class=\"headerlink\" title=\"抽象基类\"></a>抽象基类</h2><ul>\n<li>概念：抽象基类是一种接口类，它用于提供一类对象的基本特征，然后再通过由其派生初来的派生类来实现可以归入该类对象下的其他特定类型的对象的详细特征</li>\n<li>一般来说，抽象基类使用纯虚函数来实现这种特性</li>\n<li>抽象基类可以使用句柄类来自动管理内存</li>\n</ul>\n<h3 id=\"纯虚函数\"><a href=\"#纯虚函数\" class=\"headerlink\" title=\"纯虚函数\"></a>纯虚函数</h3><ul>\n<li><p>纯虚函数的函数体为<code>= 0</code>，它没有具体的实现，声明例如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">display</span><span class=\"params\">()</span> </span>= <span class=\"number\">0</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><em>含有纯虚函数的类就是一个抽象基类</em>，它不能有一个实际的对象</p>\n</li>\n<li><p>纯虚函数在抽象基类的派生类中得到实现</p>\n</li>\n<li><p>如果在派生类中继承而来的纯虚函数没有定义，那么它仍然是一个纯虚函数</p>\n</li>\n</ul>\n<h2 id=\"输入与输出\"><a href=\"#输入与输出\" class=\"headerlink\" title=\"输入与输出\"></a>输入与输出</h2><ul>\n<li><p>标准输出流：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">std::cout &lt;&lt; <span class=\"string\">&quot;output&quot;</span> &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>上面的语句中，<code>std</code>为命名空间，命名空间是为了区分在不同的库中，两个名字相同但是功能不同的函数</p>\n</li>\n<li><p><code>::</code>为作用域运算符</p>\n</li>\n<li><p><code>&lt;&lt;</code>为标准库的输出运算符</p>\n</li>\n<li><p><code>std::cout</code>为标准输出流</p>\n</li>\n<li><p><code>std::endl</code>为输出的结束，该<strong>控制器</strong>会刷新输出缓冲区，并且进行换行，如果没有使用此控制器或者人为添加换行符，那么输出内容不会换行</p>\n</li>\n<li><p>控制器：在流中的控制器用于控制这个流</p>\n</li>\n<li><p>两个以上的字符串如果只是由空格分开，在输出流中它们会自动连接起来</p>\n</li>\n<li><p>控制器<code>setprecision(x)</code>：用于为后续输出设定<code>x</code>位有效位数，一般可以这样使用（使用完后注意重置为默认值）：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//先保存初始的输出精度</span></span><br><span class=\"line\">streamsize prec = cout.<span class=\"built_in\">precision</span>();</span><br><span class=\"line\"><span class=\"comment\">//在输出流中调整输出精度为x后再调整回默认值</span></span><br><span class=\"line\">cout &lt;&lt; <span class=\"built_in\">setprecision</span>(x) &lt;&lt; grade &lt;&lt; <span class=\"built_in\">precision</span>(prec);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>注意，在输出流中如果存在多个步骤，如输出流中调用了函数，即使程序仍然会按照流的顺序输出内容，但是程序的执行顺序有可能不是按照流的输出顺序执行的，这样有可能造成程序逻辑上的混乱</p>\n</li>\n<li><p><code>setw(length)</code>函数的使用：</p>\n<ul>\n<li>使用例：<code>cout &lt;&lt; setw(10) &lt;&lt; name &lt;&lt; endl;</code></li>\n<li>属于控制器，用于控制输出字段的长度</li>\n<li>当后面紧跟着的输出字段长度小于<code>length</code>的时候，在该字段前面用空格补齐，当输出字段长度大于<code>length</code>时，全部整体输出</li>\n<li>默认是右对齐，如果需要左对齐，可以在其前面添加<code>left</code>控制器</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>标准输入流：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">std::cin &gt;&gt; name;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>cin</code>为标准输入流，<code>&gt;&gt;</code>运算符将输入的东西保存到<code>name</code>中，直到遇到<strong>空白字符</strong>或者<strong>EOF</strong>标记</li>\n<li>空白字符：空格，制表键，换行符，回退键</li>\n<li>EOF：在Windows系统下，EOF为<code>CTRL+Z</code>，在Linux或者Unix系统下则为<code>CTRL+D</code></li>\n<li>输入时<code>cin</code>会略去首先输入的空白字符</li>\n<li><code>cin &gt;&gt; a &gt;&gt; b;</code>等价于<code>cin &gt;&gt; a; cin &gt;&gt; b;</code></li>\n</ul>\n</li>\n<li><p>循环输入：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> (cin &gt;&gt; x) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//循环内容</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>原理：输入首先会保存在缓冲区，然后直到按下回车，输入会以空白字符为界，按顺序将一串数据一个一个存储到变量<code>x</code>中，并且每存储一次就执行循环中的内容，直到遇到非法输入（类型与<code>x</code>不同）或者EOF退出循环</li>\n</ul>\n</li>\n<li><p>缓冲区：输出/输入库会将输出保存在缓冲区中，只有在必要的时候，缓冲区的内容才会被送到输出装置中，从而将多个输出操作合为一个</p>\n</li>\n<li><p>缓冲区刷新的几种情形：</p>\n<ul>\n<li>缓冲区满</li>\n<li>程序请求库从标准输入流中读取数据</li>\n<li>手动刷新缓冲区</li>\n</ul>\n</li>\n<li><p>流迭代器：</p>\n<ul>\n<li>在<code>&lt;iterator&gt;</code>中定义，使用时必须指明类型</li>\n<li>输入流迭代器<code>istream_iterator&lt;Type&gt;(cin)</code>：迭代器的参数是可选的，通常情况下将其与<code>cin</code>连接，从这里读值，该迭代器缺省值的性质是，一旦到达了文件末尾或者处于错误状态，那么这个迭代器会与缺省值相等</li>\n<li>输出流迭代器<code>ostream_iterator&lt;Type&gt;(cout, string)</code>：迭代器的第一个参数为<code>cout</code>，说明迭代器会往<code>cout</code>中写内容，第二个参数指定了一个值（一般是字符串），这个值会写在每个元素之后，这个参数也可以缺省</li>\n<li>流迭代器的本质是模板</li>\n</ul>\n</li>\n<li><p>头文件<code>&lt;cctype&gt;</code>中的几个有用的函数：它们在字符<code>c</code>满足后面的条件时返回<code>True</code></p>\n<ul>\n<li><code>isspace(c)</code>：空白</li>\n<li><code>isalpha(c)</code>：字母</li>\n<li><code>isdigit(c)</code>：数字</li>\n<li><code>isalnum(c)</code>：数字或者字母</li>\n<li><code>ispunct(c)</code>：标点符号</li>\n<li><code>isupper(c)</code>：大写字母</li>\n<li><code>islower(c)</code>：小写字母</li>\n</ul>\n</li>\n<li><p>标准错误流：</p>\n<ul>\n<li><code>cerr</code>：即时输出错误信息，保证一旦发生异常就立刻输出信息</li>\n<li><code>clog</code>：倾向于生成日志，它具有着与<code>cout</code>一样的缓冲特性，平时存储错误信息，在适当的时候输出</li>\n</ul>\n</li>\n<li><p>文件的输入与输出：</p>\n<ul>\n<li><p><code>ifstream</code>：是一个用于读取文件内容的对象的类型</p>\n</li>\n<li><p><code>ofstream</code>：是一个用于向一个文件输出内容的对象的类型</p>\n</li>\n<li><p>上面两个类型定义在<code>&lt;fstream&gt;</code>中，使用时需要先将这两个类型的对象实例化，并且将字符串形式的文件名作为参数</p>\n</li>\n<li><p>在使用这两个类型的对象时有点类似于<code>istream</code>和<code>ostream</code></p>\n</li>\n<li><p>使用例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">ifstream <span class=\"title\">infile</span><span class=\"params\">(<span class=\"string\">&quot;in&quot;</span>)</span></span>;    <span class=\"comment\">//定义了一个与in文件相关联的文件输入流</span></span><br><span class=\"line\"><span class=\"function\">ofstream <span class=\"title\">outfile</span><span class=\"params\">(<span class=\"string\">&quot;out&quot;</span>)</span></span>;    <span class=\"comment\">//定义了一个与out文件相关联的文件输出流</span></span><br><span class=\"line\">string s;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (<span class=\"built_in\">getline</span>(infile, s)) &#123;</span><br><span class=\"line\">    outfile &lt;&lt; s &lt;&lt; endl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>注意：文件的路径如果使用的是相对路径，那么在调试时是工作区的目录的相对路径，在直接运行程序时则是相对于可执行文件所在位置的相对路径</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"流程与异常控制\"><a href=\"#流程与异常控制\" class=\"headerlink\" title=\"流程与异常控制\"></a>流程与异常控制</h2><h3 id=\"不变式\"><a href=\"#不变式\" class=\"headerlink\" title=\"不变式\"></a>不变式</h3><p>不变式可以理解为，一个类或者对象在设计的时候，对它的假设条件，在它的整个生命周期内，这些必须恒为真。例如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//这里假设loop已经输出的行数</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> loop = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (loop != rows) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//输出一行...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里<code>int loop = 0;</code>就是一个不变式，它在生命周期中，必须时刻等于输出的行数，否则会导致逻辑和程序流程控制的混乱，由于在这里不变式作为循环的一个判断依据，因此也被称为循环不变式</p>\n<h3 id=\"异常控制\"><a href=\"#异常控制\" class=\"headerlink\" title=\"异常控制\"></a>异常控制</h3><p>异常控制用于给程序的使用者给出错误提示，提高程序的鲁棒性。程序抛出异常后，会在抛出异常的地方终止执行并且跳转到程序的另一部分（有点类似于中断），并向该部分提供一个异常对象，异常对象中含有程序可以处理异常信息。例如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">//该部分中任何一个语句发生了domain_error异常，都会停止执行下面的其他语句，转到执行catch下的语句</span></span><br><span class=\"line\">  <span class=\"comment\">//如果没有发生异常，那么将不会执行catch中的语句</span></span><br><span class=\"line\">&#125; <span class=\"built_in\"><span class=\"keyword\">catch</span></span> (domain_error e) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//发生异常后执行的语句</span></span><br><span class=\"line\">  <span class=\"comment\">//创建了一个异常对象e，名为what的成员函数用到了被复制下来的异常参数</span></span><br><span class=\"line\">  cout &lt;&lt; e.<span class=\"built_in\">what</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>应当在编程时加入判断，是否满足产生异常的条件，如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (something == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"built_in\">domain_error</span>(“Invalid Value!”);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面的语句意为，当满足条件时，程序会抛出一个<code>domian_error</code>，这种错误类型为域错误，即输入在定义域外的情况。C++中还有许多其他的错误类型可供使用，如<code>logic_error</code>，<code>runtime_error</code>等。</p>\n<h2 id=\"多文件编程\"><a href=\"#多文件编程\" class=\"headerlink\" title=\"多文件编程\"></a>多文件编程</h2><ul>\n<li><p>文件种类：</p>\n<ul>\n<li><code>main.cpp</code>：主函数所在的文件</li>\n<li><code>file_x.h</code>：头文件</li>\n<li><code>file_x.cpp</code>：其他源代码文件<br>……</li>\n</ul>\n</li>\n<li><p>头文件的写法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> FILE_X_H</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> FILE_X_H</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//#ifndef必须位于文件的第一行</span></span><br><span class=\"line\"><span class=\"comment\">//不要在头文件中使用using声明，为用户保留最大的灵活性</span></span><br><span class=\"line\"><span class=\"comment\">//在头文件中包含其对应的源文件中所有需要用到的库</span></span><br><span class=\"line\"><span class=\"comment\">//在头文件中声明对应源文件中定义的函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>#include &lt;系统环境提供的头文件&gt;</code>，<code>#include “自己写的头文件.h”</code></p>\n</li>\n</ul>\n<h2 id=\"部分库函数\"><a href=\"#部分库函数\" class=\"headerlink\" title=\"部分库函数\"></a>部分库函数</h2><h3 id=\"sort\"><a href=\"#sort\" class=\"headerlink\" title=\"sort()\"></a>sort()</h3><ul>\n<li><p>库：<code>&lt;algorithm&gt;</code></p>\n</li>\n<li><p>参数：</p>\n<ol>\n<li>迭代器，序列的起始</li>\n<li>迭代器，序列的末尾</li>\n<li>谓词，可选参数，是自定义的比较方法</li>\n</ol>\n</li>\n<li><p>功能：用于比较向量中的内容并按顺序存放，在未注明的情况下，对任何待排序的向量元素类型，它都会使用<code>&lt;</code>来操作</p>\n</li>\n<li><p>关于谓词：是一个函数，返回需值是布尔值</p>\n</li>\n</ul>\n<h3 id=\"getline\"><a href=\"#getline\" class=\"headerlink\" title=\"getline()\"></a>getline()</h3><ul>\n<li>库：<code>&lt;string&gt;</code></li>\n<li>参数：<ol>\n<li>输入流，一般为<code>cin</code></li>\n<li>字符串引用，直接填目标字符串的名字</li>\n</ol>\n</li>\n<li>功能：用于读一行的内容并将这些内容存储到目标字符串中</li>\n<li>如果遇到文件结尾或者无效输入，<code>getline()</code>的返回值会指示失败</li>\n</ul>\n<h3 id=\"copy\"><a href=\"#copy\" class=\"headerlink\" title=\"copy()\"></a>copy()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示需要复制的元素的开头</li>\n<li>迭代器，指示需要复制的元素的末尾后一个元素</li>\n<li>迭代器适配器</li>\n</ol>\n</li>\n<li>功能：将<code>[b,e)</code>之间的元素按迭代器适配器指定的方式添加到目标容器的末尾</li>\n</ul>\n<h3 id=\"equal\"><a href=\"#equal\" class=\"headerlink\" title=\"equal()\"></a>equal()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>迭代器，指示第二个序列的开头（或者末尾）</li>\n</ol>\n</li>\n<li>功能：从第二个序列的开头（或者末尾）开始，按顺序一个元素对应一个元素地比较两个序列中的内容，如果相等的话则返回<code>True</code></li>\n</ul>\n<h3 id=\"find\"><a href=\"#find\" class=\"headerlink\" title=\"find()\"></a>find()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>被查找的值</li>\n</ol>\n</li>\n<li>功能：在指定的序列中查找是否存在第三个参数的值，如果找到了，则返回序列中第一次出现这个值的位置，否则返回这个序列的末尾</li>\n</ul>\n<h3 id=\"find-if\"><a href=\"#find-if\" class=\"headerlink\" title=\"find_if()\"></a>find_if()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示被查找的序列的开头</li>\n<li>迭代器，指示被查找的序列的末尾</li>\n<li>谓词，检测自己出参数并且返回一个布尔值</li>\n</ol>\n</li>\n<li>功能：对序列中的每个元素都调用谓词，直到谓词产生一个<code>True</code>的结果，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器</li>\n</ul>\n<h3 id=\"search\"><a href=\"#search\" class=\"headerlink\" title=\"search()\"></a>search()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示被查找的序列的开头</li>\n<li>迭代器，指示被查找的序列的末尾</li>\n<li>迭代器，指示查找的目标序列的开头</li>\n<li>迭代器，指示查找的目标序列的末尾</li>\n</ol>\n</li>\n<li>功能：查找第一第二个参数所指示的序列中有没有第三第四个参数所指示的序列，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器</li>\n</ul>\n<h3 id=\"transform\"><a href=\"#transform\" class=\"headerlink\" title=\"transform()\"></a>transform()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示待转换序列的开头</li>\n<li>迭代器，指示待转换序列的末尾</li>\n<li>迭代器，存放处理后的元素的容器的开头</li>\n<li>函数，<code>transform()</code>将这个函数作用于待转换序列以获得期望得到的元素</li>\n</ol>\n</li>\n<li>功能：对待转换序列中的元素执行指定函数，并将转换后的结果存储于第三个参数指定的序列中</li>\n</ul>\n<h3 id=\"accumulate\"><a href=\"#accumulate\" class=\"headerlink\" title=\"accumulate()\"></a>accumulate()</h3><ul>\n<li>库：<code>&lt;numeric&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>单一变量</li>\n</ol>\n</li>\n<li>功能：将序列中的元素之和加上变量中的值后再存储到这个变量中</li>\n<li>注意，第三个变量中的值类型会影响最终的结果的类型</li>\n</ul>\n<h3 id=\"remove-if-，remove\"><a href=\"#remove-if-，remove\" class=\"headerlink\" title=\"remove_if()，remove()\"></a>remove_if()，remove()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>谓词，返回一个布尔值</li>\n</ol>\n</li>\n<li>功能：排列序列中的内容，它将视那些使得谓词为<code>True</code>的元素所在的位置为空闲位置，并将后面那些使谓词为<code>False</code>的元素依次放置在空闲位置中，它的返回值是一个迭代器，它指示了那些所有使谓词为<code>False</code>的元素的末尾的位置</li>\n<li><code>remove()</code>的前两个参数含义与<code>remove_if()</code>相同，但是第三个参数是一个值，该函数的作用与<code>remove_if()</code>相同，不同之处在于是移动了那些等于第三个参数的元素</li>\n</ul>\n<h3 id=\"partition-，stable-partition\"><a href=\"#partition-，stable-partition\" class=\"headerlink\" title=\"partition()，stable_partition()\"></a>partition()，stable_partition()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>谓词，返回一个布尔值</li>\n</ol>\n</li>\n<li>功能：两个函数的功能都是将谓词作用于序列中的元素，然后将那些使得谓词为<code>True</code>的元素位于序列的头部，返回一个指向第一个使得谓词为<code>False</code>的元素的迭代器，它们的区别在于<code>stable_partition()</code>会保持元素的顺序不变，而<code>partiotion()</code>则有可能导致元素的顺序混乱</li>\n</ul>\n<h3 id=\"rand\"><a href=\"#rand\" class=\"headerlink\" title=\"rand()\"></a>rand()</h3><ul>\n<li>库：<code>&lt;cstdlib&gt;</code></li>\n<li>参数：无</li>\n<li>功能：在<code>[0,RAND_MAX)</code>之间返回一个伪随机数，<code>RAND_MAX</code>是一个大整数，它也是在<code>&lt;cstdlib&gt;</code>中定义的</li>\n<li>如何返回在某个指定范围内的随机整数：基本思想是将可以利用的随机数分为长度相等的存储桶，存储桶的个数就是我们需要的随机数的最大值，然后再计算一个随机数并且返回它所在的桶的编号，程序如下：</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">nrand</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span> || n &gt; RAND_MAX) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"built_in\">domain_error</span>(<span class=\"string\">&quot;Argument to nrand is out of range. &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> bucket_size = RAND_MAX / n;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> r;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> r = <span class=\"built_in\">rand</span>() / bucket_size;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (r &gt;= n);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> r;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"编程习惯\"><a href=\"#编程习惯\" class=\"headerlink\" title=\"编程习惯\"></a>编程习惯</h1><p>该部分的内容很多，涉及范围也很广，因此在这里我只纪录根据我个人实际情况需要注意的要点。更全面和详细的内容可以参考<a href=\"https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents/\">C++ 风格指南 - 内容目录 — Google 开源项目风格指南 (zh-google-styleguide.readthedocs.io)</a>。</p>\n<ul>\n<li>在编写运行时间较长的程序时，应当在合适的时刻刷新缓冲区</li>\n<li>循环的计数习惯：一般循环中的计数变量（假设为<code>i</code>）都从<code>0</code>开始，这样它的含义就比较明确，也即，<code>到目前为止，我们已经操作了i次</code>，此外这样做还有一个好处，那就是我们可以把循环条件设为<code>i != expected_loop_times</code>，这个不等式明确地表明了，当循环退出时，我们已经循环了<code>expectation_loop_times</code>次</li>\n<li>在定义一个变量来保存特定的数据结构时，应该使用库中为特殊用途而定义的类型，如现在想要顶一个存储字符串长度的变量<code>length</code>，那么可以有：<code>std::string::size_type length;</code>，另外还可以对库中提供的特殊类型重命名，如：<code>typedef std::string::size_type str_size;</code>就是将<code>std::string::size_type</code>这一类型在作用域内使用<code>str_size</code>来指代</li>\n<li>在操作容器中的多个元素时，推荐使用左闭右开的表示方法，这个区间中的元素个数就是上下限之间的差，这个区间的右界被称为越界值，这样做的理由有三个：<ul>\n<li>如果区间没有元素，那么找不到一个最后的元素标记终点</li>\n<li>按照上面的方法定义，只要两个迭代器相等，那么立即可以判断区间为空</li>\n<li>该方法提供了一种自然的方式表达“区间之外”</li>\n</ul>\n</li>\n<li>在使用标准库提供的容器的时候，尽量使用对应的迭代器</li>\n<li>一般都使用<code>double</code>类型来进行浮点数计算</li>\n<li>在编写程序时，需要预见一些异常或者无意义的情况，在这种情况下程序最好暂时终止或者退出</li>\n<li>函数形式参数的名称最好不要太具体，因为某个函数可以用于多种含义不同的数据（这个思想对编写模板函数很重要）</li>\n<li>在输出时如果需要在输出的内容之间插入分隔符（如空格、逗号等），应当对第一个元素做特殊处理，具体思想是：当第一个元素生成（或者确保它已经存在）之后，输出第一个元素，然后再判断之后的元素是否存在，如果存在的话，就将它们与分隔符一起输出</li>\n<li>对于不希望改变对象内容的函数，应当将它们声明为<code>const</code>类型</li>\n<li>如果一个函数会改变一个对象的状态，那么这个函数应该作为对象的成员函数</li>\n<li>在设计二元运算符的时候，为了能够让左右操作数都可以进行类型转换以保持操作数的对称性，尽量将二元运算符定义在类的声明之外</li>\n<li>对于在创建对象时调用的构造函一般不用声明为<code>explicit</code>，而对于用于构造新的对象的构造函数需要声明为<code>explicit</code></li>\n<li>不可以让用户用指针直接访问类中的私有成员</li>\n<li>使用句柄类时，当成员函数会改变底层对象的值时需要酌情进行复制操作，以保证指针的有效性</li>\n</ul>\n","site":{"data":{}},"more":"<blockquote>\n<p>虽然两年前就已经接触过C++，但是之前短暂的学习根本不足以让我系统掌握这门语言的用法。现在由于有项目开发的需求，我决定重新开始较为系统地学习C++。由于有C语言的基础，在入门阶段我使用Accelerated C++这本书来学习。这本书虽然较为老旧，但是内容不多，读起来也比较轻松。这篇文章是对我在看书和编程时遇到的问题和重点的总结备忘，内容比较零碎，还请大家谅解。</p>\n</blockquote>\n<h1 id=\"语言特性\"><a href=\"#语言特性\" class=\"headerlink\" title=\"语言特性\"></a>语言特性</h1><h2 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h2><ul>\n<li><p>声明：告诉编译器有这个对象存在，不需要建立内存</p>\n</li>\n<li><p>定义：需要建立内存的声明，也即实例化一个对象</p>\n</li>\n<li><p><code>main</code>函数返回一个整数类型的值作为结果，<code>0</code>表示成功</p>\n</li>\n<li><p><code>void</code>类型的函数可以不需要<code>return</code>语句，也可以写<code>return;</code></p>\n</li>\n<li><p>变量是一个具有名称的<strong>对象</strong>，对象是计算机中一段具有类型的内存空间（在C++中，一切皆对象）</p>\n</li>\n<li><p>在花括号中定义的变量，作用域只在它所在的花括号中</p>\n</li>\n<li><p>对象类型还有<strong>接口</strong>，接口就是可以对对象进行的操作的集合</p>\n</li>\n<li><p>重载：</p>\n<ul>\n<li>运算符的重载：一个运算符对于不同类型的操作数有不同的含义，如<code>1 + 1</code>与<code>&#39;A&#39; + &#39;B&#39;</code>中的加号具有不同的含义</li>\n<li>函数重载：两个功能不同的函数在具有相同名称时，当它们的参数不同时，会发生重载</li>\n</ul>\n</li>\n<li><p>关于<code>const</code>：</p>\n<ul>\n<li><p><code>const</code>表示该值为常量（只读），必须在定义它时进行初始化，变量也可以对常量进行初始化</p>\n</li>\n<li><p>如果给一个引用常量对象的函数传输一个非常量对象，那么这个对象会被视为常量</p>\n</li>\n<li><p>不可以对常量对象调用非常量函数</p>\n</li>\n<li><p>关于<code>const</code>的位置：</p>\n<ul>\n<li><p>修饰指针变量：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span>* pt = &amp;n;    <span class=\"comment\">//指针所指的数据是常量，但是指针是变量，可以指向其他地址</span></span><br><span class=\"line\"><span class=\"keyword\">int</span>* <span class=\"keyword\">const</span> pt = &amp;n;    <span class=\"comment\">//指针所指的数据是变量，指针是常量，只能指向n的地址</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span>* <span class=\"keyword\">const</span> pt = &amp;n; <span class=\"comment\">//指针和其所指的数据都不可以改变</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修饰函数参数：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">int</span> n)</span> </span>&#123;&#125;; <span class=\"comment\">//函数收到的参数是常量</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修饰成员函数：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> <span class=\"keyword\">const</span> </span>&#123;&#125;; <span class=\"comment\">//成员函数不能修改任何除了mutable修饰的的成员变量</span></span><br><span class=\"line\">                          <span class=\"comment\">//且不可调用非const成员函数</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修饰函数返回值：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;&#125;; <span class=\"comment\">//函数的返回值是常量，一般不需要这样用</span></span><br><span class=\"line\">                          <span class=\"comment\">//除了重载运算符外，一般不要将返回值类型定为对某个对象的const引用</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>关于<code>static</code>：</p>\n<ul>\n<li><code>static</code>表示该变量或函数是静态的，只能声明定义一次</li>\n<li>静态全局变量：具有全局寿命，在程序运行的整个过程中存在，它在进入<code>main()</code>函数初始化，在退出<code>main()</code>函数后被销毁，它只在声明它的文件中可见</li>\n<li>静态局部变量：在函数第一次执行到声明它的语句时进行初始化，它具有全局寿命，但是只在声明它的函数中可见，在单线程时多次调用包含静态局部变量的函数不会导致该静态局部变量被多次定义与初始化</li>\n<li>静态函数：它只在声明它的文件中可见，其他文件中可以声明名字相同的函数而且不会发生冲突</li>\n<li>静态数据成员：可以让该类的所有对象访问，只初始化一次，而且可以实现全局变量做不到的信息隐藏，它需要在类外部进行初始化</li>\n<li>静态成员函数：一般声明和定义都在类中，它只能访问其他静态成员函数和静态数据成员，它没有<code>this</code>指针<ul>\n<li>如果静态成员函数的声明在类中，定义在类外部，那么在外部定义时不能够加<code>static</code>关键字，否则就相当于声明了两次</li>\n<li>静态成员函数没有与其关联的对象，它可以通过类名或者对象名直接访问</li>\n</ul>\n</li>\n<li>使用<code>static</code> 修饰的变量是可以修改的</li>\n</ul>\n</li>\n<li><p>成员函数：某种类型的对象有一个或者多个函数成员，调用这些函数可以获得一个值，如<code>str.size()</code>可以获得字符串<code>str</code>的长度</p>\n</li>\n<li><p><code>using</code>声明：作用域为它所在的花括号内</p>\n<ul>\n<li><code>using namespace std;</code>：程序中默认使用<code>std</code>这个命名空间</li>\n<li><code>using namespace-name::name;</code>：使用<code>name</code>指代<code>namespace-name::name;</code></li>\n<li><code>using std::cout;</code>：使用<code>cout</code>指代<code>std::cout</code>，并且我们不会定义自己的<code>cout</code></li>\n</ul>\n</li>\n<li><p>类型转换的原则：较小的类型转换为较大的类型，有符号的类型会转换为无符号类型，算数值会被转换为布尔值，<code>0</code>可以视为<code>false</code>，而其他值都被视为<code>true</code></p>\n</li>\n<li><p>缺省初始化：一般来说，在对象定义时如果没有初始化，那么它的内容就是其内存单元中的随机内容，但是下面几种情况下，编译器会进行缺省初始化</p>\n<ul>\n<li>全局变量</li>\n<li>自定义类型的对象在没有初始化程序的情况下</li>\n</ul>\n</li>\n<li><p>左值与右值</p>\n<ul>\n<li>左值：位置值，也即内存地址</li>\n<li>右值：地址中存的值</li>\n</ul>\n</li>\n<li><p>增量/减量运算符（按照优先级排序）：</p>\n<ul>\n<li><code>i++</code>：对<code>i</code>加一，并且返回原始值</li>\n<li><code>i--</code>：对<code>i</code>减一，并且返回原始值</li>\n<li><code>++i</code>：对<code>i</code>加一，并且返回相加后的值</li>\n<li><code>--i</code>：对<code>i</code>减一，并且返回相减后的值</li>\n</ul>\n</li>\n<li><p>关于<code>clear()</code>方法：</p>\n<ul>\n<li>对字符串：将字符串的首地址内容存放<code>\\0</code></li>\n<li>对向量：清空向量内容</li>\n<li>对流：清除流内部的错误状态</li>\n</ul>\n</li>\n<li><p>泛型算法：可以用于不同类型的容器和不同的数据类型的算法</p>\n</li>\n<li><p>迭代器适配器：是一个函数，会产生与其参数相关的属性的迭代器以做他用，它会按照它给定的方式来对迭代器进行操作，下面给出了一些例子：</p>\n<ul>\n<li><code>back_inserter(des)</code>：将元素添加到<code>des</code>容器的末尾</li>\n<li><code>front_inserter(des)</code>：将元素添加到<code>des</code>容器的头部（链表支持该种操作，向量和字符串不支持）</li>\n<li><code>inserter(c, it)</code>：在<code>c</code>的迭代器<code>it</code>之前插入元素</li>\n</ul>\n</li>\n<li><p>不要将重载函数作为参数传递给模板函数，否则编译器将不知道需要使用的是重载函数哪个版本</p>\n</li>\n<li><p>将函数作为参数：将函数作为参数时，在声明的时候参数函数的编写形式类似于函数的声明，返回值和参数函数的参数必须与参数函数相一致，但是名称不需要一致</p>\n</li>\n<li><p>函数的缺省参数：在声明一个函数时，如果在参数后写上<code>= x</code>（<code>x</code>为某个值、序列、或者函数），那么这个参数默认值为<code>x</code>，在调用这个函数可以该参数缺省</p>\n</li>\n<li><p>函数的递归调用：在函数内部调用自身</p>\n</li>\n<li><p>内联函数：在函数声明与定义时，于函数名字前添加了<code>inline</code>关键字的函数，在编译时所有调用内联函数的地方都会被替换成函数体的代码以提高运行效率，对一般的函数，只有程序运行到调用函数的那个地方时，函数名才会被替代成相对应的函数代码，内联函数的长度不应超过10行</p>\n</li>\n<li><p><code>main</code>函数：</p>\n<ul>\n<li>完整形式：<code>main(int argc, char** argv)</code></li>\n<li>参数：<ul>\n<li><code>argv</code>：指向一个数组首元素地址的指针，数组中的每一个元素都是都指向一个字符串参数的指针</li>\n<li><code>argc</code>：<code>argv</code>指向的数组中的指针个数</li>\n</ul>\n</li>\n<li><code>argv</code>的第一个元素指向编译出的程序的名字的字符串的首地址</li>\n<li>在程序中可以直接使用这两个对象</li>\n</ul>\n</li>\n<li><p><code>NULL</code>，<code>nullptr</code>，<code>NaN</code>，<code>INF</code></p>\n<ul>\n<li><code>NULL</code>：历史上曾经用来指代空指针，现在已有了替代，值实际上是<code>0</code></li>\n<li><code>nullptr</code>：C++11引入的关键字，指代空指针</li>\n<li><code>NaN</code>：表示<em>Not a Number</em>，无效数字</li>\n<li><code>INF</code>：表示<em>Infinite</em>，无穷大，超出了浮点数的表示范围</li>\n</ul>\n</li>\n<li><p>如果非成员函数的调用位置在定义之前，那么需要先对其进行声明；如果调用位置在定义之后，就不需要声明了</p>\n</li>\n<li><p>前置声明：如果两个类的定义是相互依赖的，那么在定义第一个类前必须先对第二个类进行前置声明，告诉编译器有这个类存在，否则会出现无穷嵌套的问题</p>\n</li>\n</ul>\n<h2 id=\"新类型\"><a href=\"#新类型\" class=\"headerlink\" title=\"新类型\"></a>新类型</h2><h3 id=\"vector（向量）类型\"><a href=\"#vector（向量）类型\" class=\"headerlink\" title=\"vector（向量）类型\"></a>vector（向量）类型</h3><p>向量类型可以理解为大小可以按需要随意增长的数组</p>\n<ul>\n<li>定义：<code>vector&lt;double&gt; grade;</code>，该语句定义了一个类型为<code>double</code>类型的向量<code>grade</code></li>\n<li>一个向量中的所有数值具有相同的类型</li>\n<li>需要使用<code>&lt;vector&gt;</code>头文件</li>\n<li><code>grade.push_back(x)</code>：将<code>x</code>添加到<code>grade</code>向量的末尾</li>\n<li>描述向量长度的数据类型：<code>vector&lt;TYPE&gt;::size_type</code></li>\n<li>访问向量中的指定元素：类似于数组，如<code>grade[i]</code>，若一个向量有<code>grade.size()</code>个元素，那么它的第一个元素为<code>grade[0]</code>或者<code>grade.begin()</code>，最后一个元素为<code>grade[grade.szie() - 1]</code>或者 <code>grade.end()</code></li>\n<li>删除向量中的元素：<ul>\n<li>使用<code>erase()</code>成员函数，如：<code>grade.erase(grade.begin() + i)</code></li>\n<li><code>erase()</code>会在删除掉一个元素的同时，将这个元素后面的元素向前移动一个单位</li>\n<li><code>erase()</code>会返回一个迭代器（见下文），并且指向刚刚被删除的元素后面的那个元素</li>\n</ul>\n</li>\n<li>向量元素的预分配：可以减少重复的内存分配带来的系统开销<ul>\n<li><code>v.reverse(n)</code>：对向量<code>v</code>保留<code>n</code>个元素的内存空间，但不进行初始化，该操作不会改变容器的大小</li>\n<li><code>v.resize(n)</code>：给<code>v</code>一个长为<code>n</code>的新长度<ul>\n<li>新长度小于当前长度：向量位于长度<code>n</code>后的元素会被删除</li>\n<li>新长度大于当前长度：向量当前长度后与长度<code>n</code>前的空余位置会添加上新的元素，并且会进行初始化</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"list（双向链表）类型\"><a href=\"#list（双向链表）类型\" class=\"headerlink\" title=\"list（双向链表）类型\"></a>list（双向链表）类型</h3><p>链表中的每一个元素都有一个指针指向后一个元素，<code>list</code>（双向链表）的每一个元素都有两个指针，一个指向前一个元素，一个指向后一个元素。<code>list</code>的特性决定了我们可以快速地在容器的任何一个位置增删元素。在顺序访问的情况下，<code>list</code>的访问速度比<code>vector</code>差；但是对于大规模随机访问或者增删元素的情况，<code>list</code>的性能远远好于<code>vector</code>。</p>\n<ul>\n<li>定义示例：<code>list&lt;double&gt; grade;</code></li>\n<li>需要使用<code>&lt;list&gt;</code>头文件</li>\n<li><code>list</code>不支持索引</li>\n<li>具有<code>sort()</code>成员函数，它有一个可选的参数<code>compare</code>用于提供排序的比较方法，如果不提供该参数则默认使用<code>&lt;</code>来排序</li>\n</ul>\n<h3 id=\"对string类型的新认识\"><a href=\"#对string类型的新认识\" class=\"headerlink\" title=\"对string类型的新认识\"></a>对string类型的新认识</h3><ul>\n<li><code>string</code>类型可以视为一种特殊的容器，它支持索引操作，也有相对应的迭代器（类似<code>vector</code>）</li>\n<li><code>substr(i, j)</code>成员函数：创建一个新的字符串来保存<code>s</code>在区间<code>[i,i+j)</code>中的索引指示的字符的复制</li>\n</ul>\n<h3 id=\"对容器的一些其他操作\"><a href=\"#对容器的一些其他操作\" class=\"headerlink\" title=\"对容器的一些其他操作\"></a>对容器的一些其他操作</h3><ul>\n<li><code>c.rbegin()</code>：对于允许逆序访问的容器，该语句表示指向容器最后一个元素的迭代器，访问的顺序是逆向的</li>\n<li><code>c.rend()</code>：对于允许逆序访问的容器，该语句表示指向容器第一个元素之前的迭代器</li>\n<li><code>container&lt;Type&gt; c(c1);</code>：若<code>c1</code>存在，那么该语句表示定义一个容器<code>c</code>且其为<code>c1</code>的复制</li>\n<li><code>container&lt;Type&gt; c(n);</code>：定义一个有<code>n</code>个元素的容器<code>c</code>并根据<code>Type</code>对其元素进行初始化</li>\n<li><code>container&lt;Type&gt; c(n, t);</code>：定义一个有<code>n</code>个元素的容器<code>c</code>，<code>c</code>的元素是<code>t</code>的复制</li>\n<li><code>container&lt;Type&gt; c(b, e);</code>：定义一个有<code>n</code>个元素的容器<code>c</code>，<code>c</code>的元素是迭代器<code>[b,e)</code>之间的复制</li>\n<li><code>c.size()</code>：返回<code>c</code>中元素的个数，返回值类型为<code>size_type</code></li>\n<li><code>c.empty()</code>：用于指示<code>c</code>中有无元素，如果没有的话返回<code>True</code></li>\n<li><code>c.insert(d, b, e)</code>：复制<code>[b,e)</code>两个迭代器之间的元素，并将它们插入到<code>c</code>容器的<code>d</code>迭代器所指示的位置之前</li>\n<li><code>c.erase(b, e)</code>：从<code>c</code>中删除<code>[b, e)</code>两个迭代器之间的元素，对于不同的迭代器，该操作的速度有所不同</li>\n</ul>\n<h3 id=\"iterator（迭代器）类型\"><a href=\"#iterator（迭代器）类型\" class=\"headerlink\" title=\"iterator（迭代器）类型\"></a>iterator（迭代器）类型</h3><p>迭代器用于代替索引，以库能控制的方式访问元素。</p>\n<ul>\n<li>每一个标准容器都有两种迭代器类型：<ul>\n<li><code>container-type::const_iterator</code>：使用该迭代器只能读容器中的元素</li>\n<li><code>container-type::iterator</code>：使用该迭代器可以读也可以写容器中的元素</li>\n<li><code>iterator</code>类型可以转换为<code>const_iterator</code>类型，反之不行</li>\n</ul>\n</li>\n<li>使用例：<code>vector&lt;double&gt;::const_iterator iter = grade.begin();</code>，声明了一个名为<code>iter</code>的迭代器，且初始值为<code>grade</code>的第一个元素</li>\n<li>迭代器可以使用增量运算符（重载过）</li>\n<li>迭代器相当于是一个指针，可以使用<code>*</code>运算符间接引用迭代器所指向元素的内容（访问的是左值），在使用时应当注意运算符的优先顺序</li>\n<li>如果要获得迭代器引用的内容的一个元素，可以使用<code>*(iter).element</code>或者<code>iter -&gt; element</code>两种方式访问</li>\n<li>注意，对于不支持随机访问索引操作的容器，<strong>对迭代器的值进行手动更改（如给迭代器加或者减偏移量）将无法通过编译</strong></li>\n<li>删除迭代器当前所指示的元素会使得该迭代器失效</li>\n<li>对<code>vector</code>容器，<code>erase</code>和<code>push_back</code>操作会使得被操作以及之后的元素的迭代器失效，而对<code>list</code>容器则不会</li>\n<li>如果一个容器支持索引，那么它的迭代器也支持索引，如：<code>iter[2]</code>等价于<code>*(iter + 2)</code>，<code>iter[-1]</code>等价于<code>*(iter - 1)</code></li>\n</ul>\n<h3 id=\"map（映射表）类型\"><a href=\"#map（映射表）类型\" class=\"headerlink\" title=\"map（映射表）类型\"></a>map（映射表）类型</h3><p>之前提到的向量、链表等容器都是顺序容器，而<code>map</code>则属于关联容器。关联容器的序列不依赖于插入元素时的顺序，它只依赖于元素本身的值。关联容器的特性可以使我们更快地对特定元素定位。</p>\n<ul>\n<li><code>map</code>容器中存储的是一个<code>键-值</code>对<ul>\n<li>键：有点类似于顺序容器中的索引，它指向一个存储空间</li>\n<li>值：键所指向的存储空间中存放的内容</li>\n</ul>\n</li>\n<li>声明例：<code>map&lt;string, int&gt; m;</code>，该语句声明了一个名为<code>m</code>，从字符串到整数的映射表，其键的类型为<code>string</code>，值的类型为<code>int</code></li>\n<li>关联容器不可以对元素进行手动排序，一般不对关联容器的内容进行修改</li>\n<li>只要声明了一个关联容器，如果我们用一个未曾出现过的键作为映射表的索引，这个映射表会自动创建一个具有这个键的元素，且这个元素具有初始化的值，对于内部类型会被初始化为<code>0</code></li>\n<li><code>pair</code>（数对）类型：该类型提供了访问映射表的键和值的能力，映射表中的每个元素都是一个数对<ul>\n<li>数对有两个成员，<code>first</code>成员包含了键，<code>second</code>成员包含了值</li>\n<li>间接引用映射表迭代器时，获得的就是这个映射表关联的一个数对<code>pair&lt;const T1, T2&gt;</code></li>\n<li>注意，映射表的键是常量</li>\n</ul>\n</li>\n<li><code>map</code>的访问方法：<code>m[key]</code>，使用键<code>key</code>来索引访问映射表并返回一个左值，如果对于这个键没有一个合适的项目，那么则会新建一个元素</li>\n<li><code>map</code>的另一种访问方法：若<code>iter</code>是一个映射表的迭代器，那么<code>iter -&gt; first</code>可以得到数对的键，<code>iter -&gt; second</code>可以得到数对的值</li>\n<li>常量映射表无法使用索引访问</li>\n<li><code>find()</code>成员函数：参数为需要查找的键，如果查找到了则返回一个指向这个元素的迭代器，否则返回映射表的末尾</li>\n<li>一般情况下<code>map</code>都是自动排序的，但是在可以通过<code>map&lt;K, V&gt; m(cmp);</code>语句在声明时使用<code>cmp</code>来人工确定元素的顺序</li>\n</ul>\n<h3 id=\"自定义类型\"><a href=\"#自定义类型\" class=\"headerlink\" title=\"自定义类型\"></a>自定义类型</h3><p>作为核心语言的一部分，<code>int</code> 、<code>char</code>、<code>double</code>等类型都是内部类型；而<code>vector</code>、<code>string</code>等类型属于标准库的内容，是自定义类型。用户可以自己定义新的类型，自定义其中的数据、函数、访问接口等，以此对数据结构进行封装。</p>\n<ul>\n<li>自定义类的格式：</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Class_name</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//类型提供的接口</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"comment\">//类型的实现</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>public</code>：保护标识符，它指示类中的共有成员，类的所有用户都可以访问公有成员</li>\n<li><code>private</code>：保护标识符，它指示类中的私有成员，类的私有成员对用户来说是不可以直接访问的</li>\n<li>同样可以用<code>struct</code>关键字来自定义类，但是它与<code>class</code>有所区别，如：</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Student_info</span> &#123;</span></span><br><span class=\"line\">    string name;</span><br><span class=\"line\">    <span class=\"keyword\">double</span> midterm, <span class=\"keyword\">final</span>;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> gender;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> age;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>​        这里<code>Student_info</code>为一个具有5个数据成员的类型</p>\n<ul>\n<li><p>关于<code>class</code>和<code>struct</code>：<code>class</code>关键字声明的类型在第一个<code>&#123;</code>和保护标识符之间的所有成员都是私有的，<code>struct</code>则相反</p>\n</li>\n<li><p>自定义的类型只能出现一次，它只能出现在一个头文件中</p>\n</li>\n<li><p>在类型内部自定义成员函数时，可以直接访问对象内部的元素</p>\n</li>\n<li><p>如果是在头文件（<code>.h</code>）对应的源文件（<code>.cpp</code>）中定义的成员函数，函数的名字前必须加上<code>Class_name::</code>的作用域限定运算符，以明确函数是<code>Class_name</code>的一个成员函数，否则会出现函数未定义的编译错误</p>\n</li>\n<li><p>将成员函数定义在类内部与类外部的区别：在类内部定义的成员函数，实际就是把函数的调用扩展成内联的，这样可以提高程序运行效率</p>\n</li>\n<li><p>成员函数如果不是定义在类内部，<strong>必须在相对应的源文件（<code>.cpp</code>）中定义</strong>，否则会产生重复定义的问题（<strong>模板类除外</strong>）</p>\n</li>\n<li><p>如果在自定义类与全局环境中有同名函数，在函数名字前加上<code>::</code>（该运算符左侧没有内容）代表使用的是全局韩静中的那个函数</p>\n</li>\n<li><p>如果需要访问一个私有的数据成员，可以定义一个存取器函数（如下），但是它会破坏类的封装性：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">std::string <span class=\"title\">name</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> name; &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>对声明为<code>static</code>的成员函数，它只能在类中定义</p>\n</li>\n</ul>\n<h4 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h4><p>构造函数是类的一个特殊的成员函数，它定义了对象的初始化方式。它的名字是类的名字且没有返回值，它会在创建一个自定义类型的对象时被自动调用。</p>\n<ul>\n<li><p>如果没有自定义构造函数，那么编译器会为我们自己创建一个</p>\n</li>\n<li><p>构造函数列表：在<code>public</code>作用范围内的构造函数的声明</p>\n</li>\n<li><p>构造函数的定义：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Student_info::<span class=\"built_in\">Student_info</span>(<span class=\"keyword\">double</span> midterm, <span class=\"keyword\">double</span> <span class=\"keyword\">final</span>);</span><br></pre></td></tr></table></figure>\n\n<p>上面定义了一个参数为 <code>midterm</code>和<code>final</code>的构造函数，下面给出声明与初始化例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">Student_info::Student_info <span class=\"title\">stu</span><span class=\"params\">(<span class=\"number\">100</span>, <span class=\"number\">99</span>)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>上面声明并初始化了一个名为<code>stu</code>的<code>Student_info</code>类型的对象，并设置了其成员数据的值</p>\n</li>\n<li><p>构造函数默认参数：构造函数的参数同样可以给定其默认值，从而可以进行缺省初始化</p>\n</li>\n<li><p>缺省构造函数：不带参数的构造函数，如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Student_info::<span class=\"built_in\">Student_info</span>(): <span class=\"built_in\">midterm</span>(<span class=\"number\">0</span>), <span class=\"built_in\"><span class=\"keyword\">final</span></span>(<span class=\"number\">0</span>) &#123;&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>使用该方式同样可以进行对象的缺省初始化</p>\n</li>\n<li><p>上面的语句中，<code>:</code>与<code>&#123;</code>之间的内容为<strong>构造函数初始化程序</strong>，程序会用括号中的值初始化相应的数据成员</p>\n</li>\n<li><p>创建一个对象时的过程：</p>\n<ol>\n<li>分配相对应的内存</li>\n<li>执行构造函数初始化程序</li>\n<li>执行构造函数函数体（在上面的例子中，函数体中没有内容）</li>\n</ol>\n</li>\n<li><p>不建议在构造函数的函数体中对对象进行初始化，如果这样那就相当于对对象做了两次初始化</p>\n</li>\n<li><p><code>explicit</code>关键字：函数名前添加了此关键字的构造函数只能在被显式调用时才能使用</p>\n</li>\n<li></li>\n</ul>\n<h4 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h4><p>析构函数是在一个对象被删除的时候被调用的，它来定义如何删除一个对象的示例。</p>\n<ul>\n<li>析构函数的函数名是在类的名字前面加上<code>~</code></li>\n<li>析构函数不带参数且没有返回值</li>\n<li>定义例：<code>~Student_info() &#123;&#125;</code></li>\n</ul>\n<h2 id=\"指针\"><a href=\"#指针\" class=\"headerlink\" title=\"指针\"></a>指针</h2><p>指针是一种随机存取的迭代器。</p>\n<ul>\n<li>一个指针是一个存放对象地址的值，一个对象是只包含它本身一个元素的容器，那么指针就是指向这个元素的迭代器</li>\n<li>对于一个指向对象<code>x</code>的指针<code>p</code>，有：<ul>\n<li><code>p</code>：<code>x</code>的地址</li>\n<li><code>*p</code>：<code>x</code>的内容，也即有<code>*p = x</code>，这里 <code>*</code>是一个间接引用运算符</li>\n<li><code>&amp;x</code>：<code>p</code>的内容，也即有<code>p = &amp;x</code>，这里<code>&amp;</code>是一个取地址运算符</li>\n</ul>\n</li>\n<li>一般使用<code>0</code>初始化指针变量，空指针的内容就是<code>0</code></li>\n<li>指针具有类型，对于一种类型<code>T</code>，可以定义一个指向<code>T</code>类型的对象的指针：<code>T* p;</code></li>\n<li>指针可以通过加减法修改它指向的值</li>\n<li>使用<code>ptrdiff_t</code>类型来表示两个指针的间距，它在<code>&lt;cstddef&gt;</code>头文件中</li>\n<li>野指针：指向被释放的内存空间的指针</li>\n<li>函数指针：<ul>\n<li>一个指针在声明时如果带上参数，那么他就变成了一个函数指针</li>\n<li>示例：<code>int (*fp)(int);</code>，调用<code>fp</code>时以一个<code>int</code>类型的变量作为参数，同时返回一个<code>int</code>类型的结果，这意味着<code>fp</code>是一个具有一个<code>int</code>类型参数并且返回一个<code>int</code>类型结果的函数的指针</li>\n<li>如果存在这样的一个函数：<code>int func(int)</code>，那么可以用<code>fp = &amp;func;</code>或者<code>fp = func;</code>来让<code>fp</code>指向<code>func</code></li>\n<li>如果<code>fp</code>指向<code>func</code>，那么可以使用<code>(*fp)(i)</code>或者<code>fp(i)</code>的方式调用<code>func</code>，其中<code>i</code>为整型</li>\n<li>如果将一个函数名作为另一个函数的参数，那么编译器会将这个参数转换成一个指向那个函数的指针</li>\n</ul>\n</li>\n<li>使用指针时可能导致问题出现的原因：<ul>\n<li>复制一个指针时不会复制指针所指的对象</li>\n<li>删除一个指针不会释放对象所占用的内存</li>\n<li>删除一个对象但是没有删除指向该对象的指针会产生一个空悬指针</li>\n<li>定义了一个指针但是不进行初始化</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"数组\"><a href=\"#数组\" class=\"headerlink\" title=\"数组\"></a>数组</h2><p>数组是最基础的容器，它是核心语言的一部分。</p>\n<ul>\n<li>数组元素个数必须在编译时确定，它不能动态增减尺寸</li>\n<li>使用<code>size_t</code>类型来表示一个数组的大小，它在<code>&lt;cstddef&gt;</code>头文件中</li>\n<li>对于一个有<code>n</code>个元素的数组，只有指向<code>[0,n)</code>的指针是合法的</li>\n<li>数组支持索引操作</li>\n<li>数组定义的两种方法：<ul>\n<li>只声明，需要显式地确定元素个数：<code>int num[5];</code></li>\n<li>定义的同时进行初始化，无需显式地确定元素个数：<code>int num[] = &#123;1, 2, 3, 4, 5&#125; ;</code></li>\n</ul>\n</li>\n<li>字符串实际就是一个字符类型的数组，它的最后一个字符为空字符<code>\\0</code>，使用<code>strlen</code>函数可以确定字符串的大小</li>\n<li><code>sizeof()</code>：返回一个<code>size_t</code>类型的值，其值以<code>bytes</code>为单位，如果需要返回数组的元素个数，那么可以用<code>sizeof()</code>的返回值除数组中每个元素占用空间的大小</li>\n<li>如果数组以指针的方式作为函数的参数，那么它会退化成一个指针，这个时候无法通过<code>sizeof()</code>得到指针所指数组的长度，只能得到指针所占空间的大小</li>\n</ul>\n<h2 id=\"内存分配\"><a href=\"#内存分配\" class=\"headerlink\" title=\"内存分配\"></a>内存分配</h2><ul>\n<li><p>一般来说有三种分配内存的方法：</p>\n<ul>\n<li>自动分配：在使用局部变量时就使用了自动分配内存的策略，用时分配，用完释放</li>\n<li>静态分配：使用<code>static</code>关键字限定的对象，系统只会对它进行一次内存分配，直到程序结束才释放</li>\n<li>动态分配：使用<code>new</code>与<code>delete</code>关键字分配的对象</li>\n</ul>\n</li>\n<li><p><code>new</code>与<code>delete</code>：使用<code>new</code>创建的对象一直存在直到对其使用<code>delete</code>或者程序结束</p>\n</li>\n<li><p>为对象分配或释放内存：</p>\n<ul>\n<li><code>new T;</code>：为一个没有名字的<code>T</code>类型的对象分配内存</li>\n<li><code>new T(args);</code>：与上面类似，但是内存中存有值<code>args</code></li>\n<li><code>int* p = new int(100);</code>：将一个<code>int</code>类型的指针<code>p</code>指向<code>new</code>开辟的存有<code>100</code>的内存空间</li>\n<li><code>delete p;</code>：删除指针<code>p</code>并且释放其指向的内存空间</li>\n</ul>\n</li>\n<li><p>为数组分配或释放内存：</p>\n<ul>\n<li><code>new T[n];</code>：为一个具有<code>n</code>个<code>T</code>类型的对象数组分配内存，并且返回一个指向数组首元素的指针，数组中的每一个对象都会被默认初始化</li>\n<li>在上面的表达式中如果<code>n</code>为<code>0</code>，那么数组中将没有任何元素，并且<code>new</code>无法返回一个有意义的指针</li>\n<li><code>T* p  = new T[n];</code>：将指针<code>p</code>指向新开辟的数组的首地址</li>\n<li><code>delete[] p;</code>：从后向前释放指针<code>p</code>指向的数组所用的全部内存空间，如果索引运算符内添加了索引，那么只释放索引指定的那个内存空间</li>\n</ul>\n</li>\n<li><p><code>malloc()</code>函数：</p>\n<ul>\n<li>库：<code>&lt;stdlib&gt;</code></li>\n<li>参数：<code>size_t</code>类型，为需要分配的内存空间大小</li>\n<li>返回一个<code>void*</code> 类型（未知类型）的指针，在使用时需要进行强制类型转换，若失败则返回<code>NULL</code></li>\n<li>使用例：<code>char* cp = (char*)malloc(10);</code></li>\n<li><code>malloc</code>不会对分配的空间进行初始化，而<code>new</code>会</li>\n</ul>\n</li>\n<li><p>内存分区：</p>\n<ul>\n<li>堆区：由用户手动申请与释放，若不释放则在程序结束后释放，使用<code>new</code>或 <code>malloc</code>申请的内存在此区域</li>\n<li>栈区：由系统管理，主要存放函数的参数以及局部变量</li>\n<li>静态存储区：在编译时就已经分配好内存空间并且进行初始化，主要存放静态变量、全局变量以及常量</li>\n<li>代码区：存放程序体的二进制代码</li>\n</ul>\n</li>\n<li><p>内存分配器<code>allocator</code>：</p>\n<ul>\n<li><code>allocator&lt;T&gt;</code>是一个类，它定义在<code>&lt;memory&gt;</code>头中，使用时需要加上<code>std::</code></li>\n<li>在使用<code>allocator&lt;T&gt;</code>类时，需要先将其实例化，如：<code>std::allocator&lt;T&gt; alloc;</code></li>\n<li>在程序中通过调用对象的成员函数来实现内存分配，下面是一些常用的成员函数：<ul>\n<li><code>T* allocate(size_t)</code>：用于分配一块长度为<code>size_t</code>，类型为<code>T</code>但并未被初始化的内存块，并返回这块内存的地址</li>\n<li><code>void deallocate(T*, size_t)</code>：用于释放未被初始化的内存，第一个参数为<code>allocate</code>函数返回的指针，第二个参数为指针指向的内存块的大小</li>\n<li><code>void construct(T*, T)</code>：用于对使用<code>allocate</code>函数分配的未初始化的内存进行初始化，第一个参数为<code>allocate</code>函数返回的指针，第二个参数需要复制的初始值</li>\n<li><code>void destroy(T*)</code>：用于删除指针所指的对象，它会调用析构函数</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>另外两个内存分配中可能有用的库函数：</p>\n<ul>\n<li><code>T* std::uninitialized_copy(T*, T*, T*)</code>：用于将前两个参数指针所指的区域中内存的值复制到第三个参数指针指向的目标内存块中，并且返回一个指向被初始化的你内存中的末元素后一个元素的地址</li>\n<li><code>void std::uninitialized_fill(T*, T*, const T&amp;)</code>：用于向前两个参数指针所指的区域的内存中复制第三个参数所引用的值</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"泛型函数\"><a href=\"#泛型函数\" class=\"headerlink\" title=\"泛型函数\"></a>泛型函数</h2><ul>\n<li>含义：不知道参数和返回值类型的函数，用于解决一类抽象问题</li>\n<li>函数中使用的变量必须支持函数中所进行的操作</li>\n</ul>\n<h3 id=\"模板函数\"><a href=\"#模板函数\" class=\"headerlink\" title=\"模板函数\"></a>模板函数</h3><p>泛型函数的具体实现。模板函数可以让不同的对象享有共同的行为特性，在定义模板函数的时候我们不知道模板参数对应的特定类型。下面给出了定义模板函数的示例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;</span></span><br><span class=\"line\"><span class=\"function\">T <span class=\"title\">function</span><span class=\"params\">(vector&lt;T&gt; v)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//函数内容...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>template &lt;class T&gt;</code>定义了一个模板头，它告诉系统环境定义了一个模板函数，而且这个函数有一个类型参数</li>\n<li>如果要使用嵌套类型（也即由模板参数定义的类型），那么必须要使用<code>typename</code>关键字，如：<code>typedef typename vector&lt;T&gt;::size_type vec_sz;</code>，使系统将这个名称当做一个类型处理</li>\n<li>模板函数的实例化过程在不同系统下有所不同</li>\n<li>模板函数的正确性是由参数之间的正确关系决定的，如果参数之间产生了可能导致歧义和信息丢失的关系，那么这个函数的程序很有可能是有错误的，甚至无法通过编译</li>\n<li>在编写模板函数的时候，为了使函数可以处理存储于各种数据结构中的数值，并且能够作用于容器的一部分而非整容器，一般我们使用迭代器参数而不是容器参数</li>\n</ul>\n<h3 id=\"迭代器的类型\"><a href=\"#迭代器的类型\" class=\"headerlink\" title=\"迭代器的类型\"></a>迭代器的类型</h3><p>下面的迭代器每一种都对应了一个特定的迭代器操作集合，每一个迭代器种类还对应了一个访问容器的策略，同时也对应了特定的算法。在编写模板函数时需要注意不同迭代器的选择。</p>\n<ul>\n<li>输入迭代器<code>In</code>：该种迭代器对一个序列提供了<strong>顺序只读访问</strong>的操作，它支持的操作有：<code>++</code>、<code>==</code>、<code>!=</code>、<code>*(读)</code></li>\n<li>输出迭代器<code>Out</code>：该种迭代器对一个序列提供了<strong>顺序写入</strong>的操作，它要求调用它的程序不可以在对迭代器的两个赋值之间执行超过一次的自增操作，也不能在没有对迭代器递增时对其多次赋值</li>\n<li>正向迭代器<code>For</code>：该种迭代器对一个序列提供了<strong>顺序读-写访问</strong>的操作，它可以在对一个元素赋值后再读取它的值，因此不需要满足输出迭代器的一次赋值要求，它支持的操作有：<code>*(读写)</code>、<code>++</code>、<code>==</code>、<code>-&gt;</code>，所有的标准库容器都满足正向迭代器的要求</li>\n<li>双向迭代器<code>Bi</code>：该迭代器对一个序列提供了<strong>可逆读-写访问</strong>的操作，它不仅有正迭代器的功能，还支持<code>--</code>（也即逆序访问）的操作，所有的标准库容器都支持双向迭代器</li>\n<li>随机迭代器<code>Ran</code>：该迭代器对一个序列提供了<strong>随机访问</strong>的操作，它的行为有点类似索引，不仅有双向迭代器的功能，而且支持算术运算，若<code>p</code>和<code>q</code>是两个迭代器，那么它们支持：<code>p + n</code>、<code>p - n</code>、<code>n + p</code>、<code>p - q</code>（得到的是两个迭代器之间的距离，整型）、<code>p &lt; q</code>、<code>p &gt; q</code>、<code>p &gt;= q</code>，向量和字符串迭代器都是随机访问迭代器，而链表迭代器则是双向迭代器</li>\n</ul>\n<h2 id=\"模板类\"><a href=\"#模板类\" class=\"headerlink\" title=\"模板类\"></a>模板类</h2><p>模板类用于生成一个类，这个类生成的多个对象可以分别存储不同类型的数据。模板类相当于定义了存储自定类型的数据结构的一个容器。</p>\n<ul>\n<li><p>声明例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Name</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>上面的语句声明了一个名字为<code>Name</code>，可以存储并处理<code>T</code>类型数据的模板类，这里的<code>T</code>类型会在将这个类实例化的时候确定，如<code>Name&lt;int&gt; N;</code>使用<code>Name</code>模板创建了一个<code>T</code>为<code>int</code>类型的对象</p>\n</li>\n<li><p><strong>模板类的声明和实现必须全部写在头文件中</strong></p>\n</li>\n<li><p>模板类的成员函数如果需要在类外部定义，那么为了将函数的作用域明确为在类的内部，需要做以下更改：</p>\n<ul>\n<li>在函数的定义前面加上<code>template &lt;class T&gt;</code></li>\n<li>在函数名前面添加<code>Name::</code></li>\n<li>在所有的<code>Name</code>后面添加<code>&lt;T&gt;</code></li>\n</ul>\n</li>\n<li><p>自定义模板类的时候一定要全面地考虑其初始化、内存分配、复制的问题，必要时可以自定义这些操作</p>\n</li>\n<li><p>模板类的构造函数例：</p>\n<ul>\n<li><code>Name() &#123;&#125;</code>：最普通的无参构造函数</li>\n<li><code>Name(size_type n, const T&amp; val = T()) &#123;&#125;</code>：该构造函数的参数为一个指定了对象大小的<code>size_type</code>类型的参数<code>n</code>，以及提供了初始化的默认值的<code>const T&amp;</code>的参数，它的缺省值由<code>T</code>的构造函数提供</li>\n</ul>\n</li>\n<li><p>可以使用<code>typedef</code>关键字来自定义类型名，如：<code>typedef T* iterator;</code></p>\n</li>\n<li><p>运算符重载：在自定义类中可以对内置的运算符进行重载以实现需要的功能，如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T&amp; <span class=\"keyword\">operator</span>[](size_type i) &#123; <span class=\"keyword\">return</span> data[i]; &#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> T&amp; <span class=\"keyword\">operator</span>[](size_type i) <span class=\"keyword\">const</span> &#123; <span class=\"keyword\">return</span> data[i]; &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>运算符重载的声明有点像定义了一个<code>operator&quot;运算符&quot;</code>函数</li>\n<li>如果需要使运算符不改变对象的值，那么就在运算符重载的定义前面以及函数体前面加上<code>const</code>关键字</li>\n<li>如果某个重载运算符函数是类的一个成员函数：<ul>\n<li>它的左操作数（二元运算符）或者唯一的操作数（一元运算符）必须是调用它的对象</li>\n<li>它的左操作数（二元运算符）会以<code>this</code>指针的方式默认地传递给这个成员函数</li>\n</ul>\n</li>\n<li>如果某个重载运算符函数不是类的一个成员函数，那么重载运算符函数的第一个参数是左操作数，第二个参数是右操作数</li>\n</ul>\n</li>\n<li><p><code>this</code>指针：<code>this</code>关键词只在成员函数内部有效，代表指向函数操作对象的指针，指针的类型由函数的操作对象决定</p>\n</li>\n<li><p>复制控制：</p>\n<ul>\n<li>复制构造函数：用于复制一个已经存在的同类型的对象，以此来初始化一个新的对象，它只带一个与类本身类型相同的参数，并且由于复制不应该改变已有对象的值，因此它的类型应该为常量引用类型</li>\n<li>复制构造函数的函数体应该为自定义的复制操作，如果函数体为空，那么将使用系统默认的方式进行复制</li>\n<li>在复制对象时，由于对象的副本的地址与原对象不同，因此不可以将原对象中指向原对象本身的指针同时复制过去，应当重置这些指针使得它们对新对象有意义</li>\n</ul>\n</li>\n<li><p>赋值运算符：</p>\n<ul>\n<li>赋值操作函数：把一个对象中已经存在的值<strong>擦除</strong>，然后装入一个新的值</li>\n<li>类中可以重载赋值运算符，如：<code>Name&amp; operator=(const Name&amp; n) &#123;&#125;</code></li>\n<li>这里的参数为右操作数的一个引用</li>\n<li>在函数体内可以通过该语句判断是否是自我赋值：<code>&amp;n != this</code>，该语句比较了左右操作数的地址，如果两者相等则为自我赋值</li>\n<li>赋值与复制的区别：复制是将一个值插入一个新的对象，不需要删除操作</li>\n<li>构造函数只控制初始化操作，<code>operator=</code>函数只控制赋值操作</li>\n</ul>\n</li>\n<li><p>在使用<code>=</code>为变量赋初始值时调用的是赋值构造函数，在赋值表达式中<code>=</code>调用的是赋值操作函数</p>\n</li>\n<li><p>如果一个类没有显式地定义构造函数或者析构函数，那么编译器将自动生成执行这些操作的默认函数</p>\n</li>\n<li><p>默认的析构函数在删除一个指针变量时不会释放该指针指向的对象占用的内存空间</p>\n</li>\n<li><p>三位一体原则：如果类需要一个析构函数，那么它同时有可能需要一个复制构造函数和一个赋值操作函数</p>\n</li>\n<li><p>友元函数：如果一个函数定义在类的声明外部，但是又需要它具有访问<code>private</code>成员数据的权限，那么可以在类内部声明这个函数时，前面加上<code>friend</code>关键字，将其声明为一个友元函数</p>\n</li>\n<li><p>模板特化：只有当模板类的实际的对象类型<code>T</code>为指定类型时，才调用指定类型对应的模板成员函数，声明与定义如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">function</span><span class=\"params\">(<span class=\"keyword\">int</span> var)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"对象的初始化\"><a href=\"#对象的初始化\" class=\"headerlink\" title=\"对象的初始化\"></a>对象的初始化</h2><ul>\n<li>初始化与赋值：<ul>\n<li>初始化：在创建一个变量时赋予它一个初始值</li>\n<li>赋值：将对象的当前值擦去，并且用一个新值替代</li>\n</ul>\n</li>\n<li>下列情况发生时会进行初始化：<ul>\n<li>声明一个变量</li>\n<li>函数入口处用到函数参数</li>\n<li>函数返回处用到函数返回值</li>\n<li>构造初始化</li>\n</ul>\n</li>\n<li>通过显式地调用构造函数进行初始化称为<strong>显式初始化</strong>，否则称为<strong>隐式初始化</strong></li>\n<li>使用<code>=</code>初始化一个对象称为<strong>拷贝初始化</strong>，不用等号则是<strong>直接初始化</strong></li>\n<li>如果对象没有进行显式初始化，则会进入<strong>隐式初始化</strong>的<strong>状态</strong>，在<strong>隐式初始化</strong>状态下会进行<strong>缺省初始化</strong>的<strong>过程</strong>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </li>\n<li>关于不同种类对象的缺省初始化方式：<ul>\n<li>全局或者静态的对象：空串或者<code>0</code></li>\n<li>对象为局部的内部类型：未定义的值</li>\n<li>内部类型作为类的成员：在某些条件下会被数值初始化为<code>0</code></li>\n<li>自定义类型且有构造函数：使用构造函数初始化</li>\n<li>自定义类型且无构造函数：递归地对对象中的每一个数据成员进行相应的数值初始化或者缺省初始化</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><ul>\n<li>自动类型转换：<ul>\n<li>自动转换的例子很常见，如将<code>int</code>类型的右值赋给<code>double</code>类型的左值时，该右值就会被自动转换为<code>double</code>类型</li>\n<li>自动类型转换分为下面两种情况：<ul>\n<li>内置类型向自定义类型转换</li>\n<li>自定义类型向内置类型转换</li>\n</ul>\n</li>\n<li>内置类型转换为用户自定义类型：需要在自定义类内部编写带单参数的构造函数<ul>\n<li>例如：<code>Name(const char* cp) &#123; //将参数提供的内容存入临时的Name类型的对象中 &#125;</code>，对<code>Name</code>类型，该构造函数会在编译器需要一个<code>Name</code>类型的对象却收到了一个<code>const char*</code>类型的对象的时候被调用</li>\n</ul>\n</li>\n<li>用户自定义类型转换为内置类型：需要在自定义类内部编写如下例所示的成员函数<ul>\n<li>例如：<code>operator int() &#123; //将自定义类型转换为int类型 &#125;</code>，该函数会在显式强制转换或者对象传入的值类型不符时被调用，函数的返回值为由其类型名确定</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>如果两个类之间彼此定义了向另一个类的转换操作，会导致转换时出现二义性</li>\n<li>混合类型表达式：混合类型表达式意为在一个语句中使用运算符同时操作不同类型的对象的表达式，它在实现的过程中会进行多次类型转换，同时产生大量的临时变量，比较浪费内存</li>\n</ul>\n<h2 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h2><ul>\n<li>形如<code>int&amp; i;</code>的变量即为引用变量，左侧的表达式是对其进行声明的过程</li>\n<li>如果存在一个整型变量<code>temp</code>，那么令<code>i = temp;</code>，则<code>i</code>指向的内存位置与<code>temp</code>相同，<code>i</code>相当于是<code>temp</code>的一个别名</li>\n<li>引用作函数参数：<ul>\n<li>非常量引用：<code>int function(vector&lt;string&gt;&amp; count);</code>，形式参数<code>count</code>存放的是实际参数的地址（<code>&amp;</code>的意思有一些像取地址，但是二者是有区别的），可以直接在函数内更改实际参数的值，而且不需要重新复制一个变量，减少资源消耗</li>\n<li>常量引用：<code>int function(const vector&lt;string&gt;&amp; count)</code>，常量引用只能藉由实际参数的地址读取它的内容且无法进行修改，该操作同样不需要重新复制变量</li>\n<li>一般来说，对于<code>int</code>或者<code>double</code>类型的参数可以不需要引用，因为对它们的复制是非常快的</li>\n</ul>\n</li>\n<li>值类型作函数返回值：<ul>\n<li>对于值类型的返回值，编译器会先将这个值复制到一个临时变量内并且返回这个临时变量</li>\n<li>函数调用完成，这个临时变量在被使用一次后（也可能不被使用），它即被销毁</li>\n</ul>\n</li>\n<li>引用作函数返回值：<ul>\n<li>引用作函数返回值的时候，不可以引用局部变量，因为函数调用完成后局部变量就被销毁，这个引用就无效了</li>\n<li>当引用作函数返回值时，不需要将变量重新复制一次保存在临时变量中</li>\n<li>引用作返回值时可以作为左值</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><h3 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h3><ul>\n<li><p>定义：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">A</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span>:...</span><br><span class=\"line\">    <span class=\"keyword\">private</span>:...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span>:</span> <span class=\"keyword\">public</span> A &#123;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>上面定义了一个类<code>B</code>，它是从<code>A</code>中继承而来，称<code>A</code>是基类（或者父类），<code>B</code>是继承类（派生类、子类）</li>\n<li>这里派生类继承了基类的公有部分，也即基类的公有成员才是子类的一部分</li>\n<li>同样可以使用<code>private</code>或者<code>protected</code>关键字来指定继承的方式</li>\n</ul>\n</li>\n<li><p>继承关系是可以嵌套的</p>\n</li>\n<li><p>基类和继承类的关系：基类就是继承类，继承类不是基类，对于他们的引用或者指针同样有这个关系</p>\n</li>\n<li><p>基类不可以强制转换为派生类</p>\n</li>\n<li><p>关于基类或者继承类作为函数参数：</p>\n<ul>\n<li>形式参数与实际参数匹配的情形不讨论</li>\n<li>如果形式参数是基类类型的，传入一个继承类的对象会将其转换为基类</li>\n<li>如果形式参数是继承类型的，那么实际传入的对象只有继承类的部分</li>\n</ul>\n</li>\n<li><p><code>protected</code>：保护标识符，它指示类中的保护成员，类的保护成员可以被其继承类访问</p>\n</li>\n<li><p>如果需要显式地表明某些成员是继承来的或者明确指明调用基类或者继承类的成员函数，可以使用范围（作用域）运算符</p>\n</li>\n<li><p>构造初始化器：也即构造函数，在使用构造初始化器时直接将相应的参数填入构造函数中即可，编译器会根据参数的类型匹配相应的构造函数</p>\n</li>\n<li><p>派生类对象构造的步骤：</p>\n<ul>\n<li>为整个对象分配内存空间</li>\n<li>隐式（或者显式）调用基类的构造函数来初始化对象中的基类部分数据</li>\n<li>用构造初始化器对派生类部分的数据进行初始化</li>\n<li>如果有的话，执行派生类构造函数的函数体</li>\n</ul>\n</li>\n<li><p>继承关系中成员函数的覆盖：如果基类与继承类中有两个同名同参同返回值类型的非<code>const</code>函数，那么派生类的这个函数会覆盖基类的函数，当基类与继承类的函数都返回指向他们本身类型的指针时除外</p>\n</li>\n</ul>\n<h3 id=\"虚函数\"><a href=\"#虚函数\" class=\"headerlink\" title=\"虚函数\"></a>虚函数</h3><ul>\n<li>定义：在基类中定义成员函数时前面加上<code>virtual</code>关键字，在继承类中同名同参函数的<code>virtual</code>的特性也会被继承，因此不需要重复加</li>\n<li>虚函数必须要有定义，不能只有声明</li>\n<li>功能：由于继承类也是基类，因此当以引用或者指针的形式调用成员函数时，程序根据实际的对象类型来在基类与继承类中选择正确的同名成员函数，也即<strong>动态绑定</strong></li>\n<li>静态绑定：在编译时就确定调用的对象的成员函数的种类</li>\n<li><strong>多态</strong>：用一个类型表示多种类型的能力，这里动态绑定实现了多态</li>\n<li>只有在<em>以引用或者指针的形式</em>调用虚拟函数的时候在运行时选择类型才有意义</li>\n<li>虚拟析构函数：当使用指针来控制对象时，调用<code>delete</code>函数会调用这个虚拟析构函数，一般虚拟析构函数都是空的</li>\n<li>如果基类与继承类中有同名不同参的函数，那么他们之间毫无关系，不需要用到需函数的技术</li>\n<li>如果在构造函数内部调用虚函数，那么它会静态绑定成正在构造的对象所属于的类中的那个虚函数</li>\n</ul>\n<h3 id=\"代理类\"><a href=\"#代理类\" class=\"headerlink\" title=\"代理类\"></a>代理类</h3><ul>\n<li>代理类实际上就是一个普通的用户自定义类，它的成员数据是指向基类的指针</li>\n<li>功能：存储和管理基类指针，这个基类指针既可以指向基类对象又可以指向派生类对象，使用代理类可以实现动态绑定，它将基类和派生类中的细节封装起来，提供了一个统一的接口</li>\n<li>代理类中一般包含这些实现细节：<ul>\n<li>各种构造（析构）函数与复制控制函数：用于提供分配或者销毁内存空间的操作</li>\n<li>基类和继承类中共有的操作：提供操作接口，实现动态绑定的功能</li>\n<li>其他操作</li>\n</ul>\n</li>\n<li>关于代理类的复制操作：需要在它管理的基类和继承类中定义虚拟的复制控制函数，并且在代理类的复制操作中调用它，在复制时有必要判断指向被复制对象的指针是否时空指针</li>\n<li>友元类：将一个类声明为另一个类的友元可以使另一个类中的所有成员都成为那个类的友元</li>\n</ul>\n<h2 id=\"句柄类\"><a href=\"#句柄类\" class=\"headerlink\" title=\"句柄类\"></a>句柄类</h2><ul>\n<li>功能：上面提到的代理类可以视为一种简单的句柄类，但是它是通过复制对象来实现动态绑定的，句柄类的最主要功能就是实现在不用复制对象的情况下就实现动态绑定并且自动管理内存</li>\n<li>一般来说，句柄类是一个模板类，因为它与它操作的模板之间是相互独立的，句柄类具有通用性</li>\n<li>与代理类相似，句柄类要将被控制的类的全部接口封装起来</li>\n<li>复制操作：在复制时需要将该句柄类的指针当前所指向的对象删除后再重新将指针指向被复制的对象的地址</li>\n<li>使用方法：在实际的程序中，通常使用一个接口类来管理基类与继承类，接口类的成员数据是一个句柄类，接口类通过操作句柄类来控制基类与继承类</li>\n<li>接口类的构造函数必须对句柄类做初始化</li>\n</ul>\n<h3 id=\"计数句柄类\"><a href=\"#计数句柄类\" class=\"headerlink\" title=\"计数句柄类\"></a>计数句柄类</h3><ul>\n<li>相比于一般的句柄类，计数句柄类在复制对象时会有选择的对底层的对象进行复制，这意味着计数句柄在复制时并不总是将底层对象的内容重新拷贝一份，而是让多个复制出来的句柄的指针同时指向同一个底层对象</li>\n<li>为了实现上面的功能，需要在句柄类添加一个<strong>引用计数</strong>指针，它用来记录有多少个对象指向底层对象</li>\n<li>复制构造函数：计数句柄类的复制构造函数不需要复制底层的对象，它的基本操作如下：<ul>\n<li>对右操作数所指向的对象的引用计数指针加一，表示有一个新的计数句柄类指向同一个底层对象</li>\n<li>如果当前左操作数的引用计数指针值为<code>1</code>，那么意味着没有其他句柄指向这个底层对象了，复制操作会将左操作数的指针覆盖掉，所以这里将左操作数指向的对象和其计数指针所占的内存空间释放掉</li>\n<li>将右操作数的对象指针和引用技术指针的复制到左操作数中</li>\n</ul>\n</li>\n<li>析构函数：同样要考虑当前的句柄类是不是最后一个指向该对象的句柄，具体操作不再赘述</li>\n<li>在修改句柄类指向的对象的值时，亦需要考虑当前的句柄类是不是最后一个指向该对象的句柄，如果是的话，那么直接修改这个指针指向的对象的值即可，否则要先将当前所指向的对象的引用计数减一，然后基于旧对象复制一个新对象并将指针指向它，并将它的引用计数设为一，上述的操作可写为成员函数并在接口类中调用</li>\n</ul>\n<h2 id=\"抽象基类\"><a href=\"#抽象基类\" class=\"headerlink\" title=\"抽象基类\"></a>抽象基类</h2><ul>\n<li>概念：抽象基类是一种接口类，它用于提供一类对象的基本特征，然后再通过由其派生初来的派生类来实现可以归入该类对象下的其他特定类型的对象的详细特征</li>\n<li>一般来说，抽象基类使用纯虚函数来实现这种特性</li>\n<li>抽象基类可以使用句柄类来自动管理内存</li>\n</ul>\n<h3 id=\"纯虚函数\"><a href=\"#纯虚函数\" class=\"headerlink\" title=\"纯虚函数\"></a>纯虚函数</h3><ul>\n<li><p>纯虚函数的函数体为<code>= 0</code>，它没有具体的实现，声明例如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">display</span><span class=\"params\">()</span> </span>= <span class=\"number\">0</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><em>含有纯虚函数的类就是一个抽象基类</em>，它不能有一个实际的对象</p>\n</li>\n<li><p>纯虚函数在抽象基类的派生类中得到实现</p>\n</li>\n<li><p>如果在派生类中继承而来的纯虚函数没有定义，那么它仍然是一个纯虚函数</p>\n</li>\n</ul>\n<h2 id=\"输入与输出\"><a href=\"#输入与输出\" class=\"headerlink\" title=\"输入与输出\"></a>输入与输出</h2><ul>\n<li><p>标准输出流：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">std::cout &lt;&lt; <span class=\"string\">&quot;output&quot;</span> &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>上面的语句中，<code>std</code>为命名空间，命名空间是为了区分在不同的库中，两个名字相同但是功能不同的函数</p>\n</li>\n<li><p><code>::</code>为作用域运算符</p>\n</li>\n<li><p><code>&lt;&lt;</code>为标准库的输出运算符</p>\n</li>\n<li><p><code>std::cout</code>为标准输出流</p>\n</li>\n<li><p><code>std::endl</code>为输出的结束，该<strong>控制器</strong>会刷新输出缓冲区，并且进行换行，如果没有使用此控制器或者人为添加换行符，那么输出内容不会换行</p>\n</li>\n<li><p>控制器：在流中的控制器用于控制这个流</p>\n</li>\n<li><p>两个以上的字符串如果只是由空格分开，在输出流中它们会自动连接起来</p>\n</li>\n<li><p>控制器<code>setprecision(x)</code>：用于为后续输出设定<code>x</code>位有效位数，一般可以这样使用（使用完后注意重置为默认值）：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//先保存初始的输出精度</span></span><br><span class=\"line\">streamsize prec = cout.<span class=\"built_in\">precision</span>();</span><br><span class=\"line\"><span class=\"comment\">//在输出流中调整输出精度为x后再调整回默认值</span></span><br><span class=\"line\">cout &lt;&lt; <span class=\"built_in\">setprecision</span>(x) &lt;&lt; grade &lt;&lt; <span class=\"built_in\">precision</span>(prec);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>注意，在输出流中如果存在多个步骤，如输出流中调用了函数，即使程序仍然会按照流的顺序输出内容，但是程序的执行顺序有可能不是按照流的输出顺序执行的，这样有可能造成程序逻辑上的混乱</p>\n</li>\n<li><p><code>setw(length)</code>函数的使用：</p>\n<ul>\n<li>使用例：<code>cout &lt;&lt; setw(10) &lt;&lt; name &lt;&lt; endl;</code></li>\n<li>属于控制器，用于控制输出字段的长度</li>\n<li>当后面紧跟着的输出字段长度小于<code>length</code>的时候，在该字段前面用空格补齐，当输出字段长度大于<code>length</code>时，全部整体输出</li>\n<li>默认是右对齐，如果需要左对齐，可以在其前面添加<code>left</code>控制器</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>标准输入流：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">std::cin &gt;&gt; name;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>cin</code>为标准输入流，<code>&gt;&gt;</code>运算符将输入的东西保存到<code>name</code>中，直到遇到<strong>空白字符</strong>或者<strong>EOF</strong>标记</li>\n<li>空白字符：空格，制表键，换行符，回退键</li>\n<li>EOF：在Windows系统下，EOF为<code>CTRL+Z</code>，在Linux或者Unix系统下则为<code>CTRL+D</code></li>\n<li>输入时<code>cin</code>会略去首先输入的空白字符</li>\n<li><code>cin &gt;&gt; a &gt;&gt; b;</code>等价于<code>cin &gt;&gt; a; cin &gt;&gt; b;</code></li>\n</ul>\n</li>\n<li><p>循环输入：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> (cin &gt;&gt; x) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//循环内容</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>原理：输入首先会保存在缓冲区，然后直到按下回车，输入会以空白字符为界，按顺序将一串数据一个一个存储到变量<code>x</code>中，并且每存储一次就执行循环中的内容，直到遇到非法输入（类型与<code>x</code>不同）或者EOF退出循环</li>\n</ul>\n</li>\n<li><p>缓冲区：输出/输入库会将输出保存在缓冲区中，只有在必要的时候，缓冲区的内容才会被送到输出装置中，从而将多个输出操作合为一个</p>\n</li>\n<li><p>缓冲区刷新的几种情形：</p>\n<ul>\n<li>缓冲区满</li>\n<li>程序请求库从标准输入流中读取数据</li>\n<li>手动刷新缓冲区</li>\n</ul>\n</li>\n<li><p>流迭代器：</p>\n<ul>\n<li>在<code>&lt;iterator&gt;</code>中定义，使用时必须指明类型</li>\n<li>输入流迭代器<code>istream_iterator&lt;Type&gt;(cin)</code>：迭代器的参数是可选的，通常情况下将其与<code>cin</code>连接，从这里读值，该迭代器缺省值的性质是，一旦到达了文件末尾或者处于错误状态，那么这个迭代器会与缺省值相等</li>\n<li>输出流迭代器<code>ostream_iterator&lt;Type&gt;(cout, string)</code>：迭代器的第一个参数为<code>cout</code>，说明迭代器会往<code>cout</code>中写内容，第二个参数指定了一个值（一般是字符串），这个值会写在每个元素之后，这个参数也可以缺省</li>\n<li>流迭代器的本质是模板</li>\n</ul>\n</li>\n<li><p>头文件<code>&lt;cctype&gt;</code>中的几个有用的函数：它们在字符<code>c</code>满足后面的条件时返回<code>True</code></p>\n<ul>\n<li><code>isspace(c)</code>：空白</li>\n<li><code>isalpha(c)</code>：字母</li>\n<li><code>isdigit(c)</code>：数字</li>\n<li><code>isalnum(c)</code>：数字或者字母</li>\n<li><code>ispunct(c)</code>：标点符号</li>\n<li><code>isupper(c)</code>：大写字母</li>\n<li><code>islower(c)</code>：小写字母</li>\n</ul>\n</li>\n<li><p>标准错误流：</p>\n<ul>\n<li><code>cerr</code>：即时输出错误信息，保证一旦发生异常就立刻输出信息</li>\n<li><code>clog</code>：倾向于生成日志，它具有着与<code>cout</code>一样的缓冲特性，平时存储错误信息，在适当的时候输出</li>\n</ul>\n</li>\n<li><p>文件的输入与输出：</p>\n<ul>\n<li><p><code>ifstream</code>：是一个用于读取文件内容的对象的类型</p>\n</li>\n<li><p><code>ofstream</code>：是一个用于向一个文件输出内容的对象的类型</p>\n</li>\n<li><p>上面两个类型定义在<code>&lt;fstream&gt;</code>中，使用时需要先将这两个类型的对象实例化，并且将字符串形式的文件名作为参数</p>\n</li>\n<li><p>在使用这两个类型的对象时有点类似于<code>istream</code>和<code>ostream</code></p>\n</li>\n<li><p>使用例：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">ifstream <span class=\"title\">infile</span><span class=\"params\">(<span class=\"string\">&quot;in&quot;</span>)</span></span>;    <span class=\"comment\">//定义了一个与in文件相关联的文件输入流</span></span><br><span class=\"line\"><span class=\"function\">ofstream <span class=\"title\">outfile</span><span class=\"params\">(<span class=\"string\">&quot;out&quot;</span>)</span></span>;    <span class=\"comment\">//定义了一个与out文件相关联的文件输出流</span></span><br><span class=\"line\">string s;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (<span class=\"built_in\">getline</span>(infile, s)) &#123;</span><br><span class=\"line\">    outfile &lt;&lt; s &lt;&lt; endl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>注意：文件的路径如果使用的是相对路径，那么在调试时是工作区的目录的相对路径，在直接运行程序时则是相对于可执行文件所在位置的相对路径</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"流程与异常控制\"><a href=\"#流程与异常控制\" class=\"headerlink\" title=\"流程与异常控制\"></a>流程与异常控制</h2><h3 id=\"不变式\"><a href=\"#不变式\" class=\"headerlink\" title=\"不变式\"></a>不变式</h3><p>不变式可以理解为，一个类或者对象在设计的时候，对它的假设条件，在它的整个生命周期内，这些必须恒为真。例如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//这里假设loop已经输出的行数</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> loop = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (loop != rows) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//输出一行...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里<code>int loop = 0;</code>就是一个不变式，它在生命周期中，必须时刻等于输出的行数，否则会导致逻辑和程序流程控制的混乱，由于在这里不变式作为循环的一个判断依据，因此也被称为循环不变式</p>\n<h3 id=\"异常控制\"><a href=\"#异常控制\" class=\"headerlink\" title=\"异常控制\"></a>异常控制</h3><p>异常控制用于给程序的使用者给出错误提示，提高程序的鲁棒性。程序抛出异常后，会在抛出异常的地方终止执行并且跳转到程序的另一部分（有点类似于中断），并向该部分提供一个异常对象，异常对象中含有程序可以处理异常信息。例如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">//该部分中任何一个语句发生了domain_error异常，都会停止执行下面的其他语句，转到执行catch下的语句</span></span><br><span class=\"line\">  <span class=\"comment\">//如果没有发生异常，那么将不会执行catch中的语句</span></span><br><span class=\"line\">&#125; <span class=\"built_in\"><span class=\"keyword\">catch</span></span> (domain_error e) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//发生异常后执行的语句</span></span><br><span class=\"line\">  <span class=\"comment\">//创建了一个异常对象e，名为what的成员函数用到了被复制下来的异常参数</span></span><br><span class=\"line\">  cout &lt;&lt; e.<span class=\"built_in\">what</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>应当在编程时加入判断，是否满足产生异常的条件，如：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (something == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"built_in\">domain_error</span>(“Invalid Value!”);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面的语句意为，当满足条件时，程序会抛出一个<code>domian_error</code>，这种错误类型为域错误，即输入在定义域外的情况。C++中还有许多其他的错误类型可供使用，如<code>logic_error</code>，<code>runtime_error</code>等。</p>\n<h2 id=\"多文件编程\"><a href=\"#多文件编程\" class=\"headerlink\" title=\"多文件编程\"></a>多文件编程</h2><ul>\n<li><p>文件种类：</p>\n<ul>\n<li><code>main.cpp</code>：主函数所在的文件</li>\n<li><code>file_x.h</code>：头文件</li>\n<li><code>file_x.cpp</code>：其他源代码文件<br>……</li>\n</ul>\n</li>\n<li><p>头文件的写法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> FILE_X_H</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> FILE_X_H</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//#ifndef必须位于文件的第一行</span></span><br><span class=\"line\"><span class=\"comment\">//不要在头文件中使用using声明，为用户保留最大的灵活性</span></span><br><span class=\"line\"><span class=\"comment\">//在头文件中包含其对应的源文件中所有需要用到的库</span></span><br><span class=\"line\"><span class=\"comment\">//在头文件中声明对应源文件中定义的函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>#include &lt;系统环境提供的头文件&gt;</code>，<code>#include “自己写的头文件.h”</code></p>\n</li>\n</ul>\n<h2 id=\"部分库函数\"><a href=\"#部分库函数\" class=\"headerlink\" title=\"部分库函数\"></a>部分库函数</h2><h3 id=\"sort\"><a href=\"#sort\" class=\"headerlink\" title=\"sort()\"></a>sort()</h3><ul>\n<li><p>库：<code>&lt;algorithm&gt;</code></p>\n</li>\n<li><p>参数：</p>\n<ol>\n<li>迭代器，序列的起始</li>\n<li>迭代器，序列的末尾</li>\n<li>谓词，可选参数，是自定义的比较方法</li>\n</ol>\n</li>\n<li><p>功能：用于比较向量中的内容并按顺序存放，在未注明的情况下，对任何待排序的向量元素类型，它都会使用<code>&lt;</code>来操作</p>\n</li>\n<li><p>关于谓词：是一个函数，返回需值是布尔值</p>\n</li>\n</ul>\n<h3 id=\"getline\"><a href=\"#getline\" class=\"headerlink\" title=\"getline()\"></a>getline()</h3><ul>\n<li>库：<code>&lt;string&gt;</code></li>\n<li>参数：<ol>\n<li>输入流，一般为<code>cin</code></li>\n<li>字符串引用，直接填目标字符串的名字</li>\n</ol>\n</li>\n<li>功能：用于读一行的内容并将这些内容存储到目标字符串中</li>\n<li>如果遇到文件结尾或者无效输入，<code>getline()</code>的返回值会指示失败</li>\n</ul>\n<h3 id=\"copy\"><a href=\"#copy\" class=\"headerlink\" title=\"copy()\"></a>copy()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示需要复制的元素的开头</li>\n<li>迭代器，指示需要复制的元素的末尾后一个元素</li>\n<li>迭代器适配器</li>\n</ol>\n</li>\n<li>功能：将<code>[b,e)</code>之间的元素按迭代器适配器指定的方式添加到目标容器的末尾</li>\n</ul>\n<h3 id=\"equal\"><a href=\"#equal\" class=\"headerlink\" title=\"equal()\"></a>equal()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>迭代器，指示第二个序列的开头（或者末尾）</li>\n</ol>\n</li>\n<li>功能：从第二个序列的开头（或者末尾）开始，按顺序一个元素对应一个元素地比较两个序列中的内容，如果相等的话则返回<code>True</code></li>\n</ul>\n<h3 id=\"find\"><a href=\"#find\" class=\"headerlink\" title=\"find()\"></a>find()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>被查找的值</li>\n</ol>\n</li>\n<li>功能：在指定的序列中查找是否存在第三个参数的值，如果找到了，则返回序列中第一次出现这个值的位置，否则返回这个序列的末尾</li>\n</ul>\n<h3 id=\"find-if\"><a href=\"#find-if\" class=\"headerlink\" title=\"find_if()\"></a>find_if()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示被查找的序列的开头</li>\n<li>迭代器，指示被查找的序列的末尾</li>\n<li>谓词，检测自己出参数并且返回一个布尔值</li>\n</ol>\n</li>\n<li>功能：对序列中的每个元素都调用谓词，直到谓词产生一个<code>True</code>的结果，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器</li>\n</ul>\n<h3 id=\"search\"><a href=\"#search\" class=\"headerlink\" title=\"search()\"></a>search()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示被查找的序列的开头</li>\n<li>迭代器，指示被查找的序列的末尾</li>\n<li>迭代器，指示查找的目标序列的开头</li>\n<li>迭代器，指示查找的目标序列的末尾</li>\n</ol>\n</li>\n<li>功能：查找第一第二个参数所指示的序列中有没有第三第四个参数所指示的序列，它会返回一个指示被找到的元素的迭代器，如果没有找到，则返回指示被查找序列末尾的迭代器</li>\n</ul>\n<h3 id=\"transform\"><a href=\"#transform\" class=\"headerlink\" title=\"transform()\"></a>transform()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示待转换序列的开头</li>\n<li>迭代器，指示待转换序列的末尾</li>\n<li>迭代器，存放处理后的元素的容器的开头</li>\n<li>函数，<code>transform()</code>将这个函数作用于待转换序列以获得期望得到的元素</li>\n</ol>\n</li>\n<li>功能：对待转换序列中的元素执行指定函数，并将转换后的结果存储于第三个参数指定的序列中</li>\n</ul>\n<h3 id=\"accumulate\"><a href=\"#accumulate\" class=\"headerlink\" title=\"accumulate()\"></a>accumulate()</h3><ul>\n<li>库：<code>&lt;numeric&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>单一变量</li>\n</ol>\n</li>\n<li>功能：将序列中的元素之和加上变量中的值后再存储到这个变量中</li>\n<li>注意，第三个变量中的值类型会影响最终的结果的类型</li>\n</ul>\n<h3 id=\"remove-if-，remove\"><a href=\"#remove-if-，remove\" class=\"headerlink\" title=\"remove_if()，remove()\"></a>remove_if()，remove()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>谓词，返回一个布尔值</li>\n</ol>\n</li>\n<li>功能：排列序列中的内容，它将视那些使得谓词为<code>True</code>的元素所在的位置为空闲位置，并将后面那些使谓词为<code>False</code>的元素依次放置在空闲位置中，它的返回值是一个迭代器，它指示了那些所有使谓词为<code>False</code>的元素的末尾的位置</li>\n<li><code>remove()</code>的前两个参数含义与<code>remove_if()</code>相同，但是第三个参数是一个值，该函数的作用与<code>remove_if()</code>相同，不同之处在于是移动了那些等于第三个参数的元素</li>\n</ul>\n<h3 id=\"partition-，stable-partition\"><a href=\"#partition-，stable-partition\" class=\"headerlink\" title=\"partition()，stable_partition()\"></a>partition()，stable_partition()</h3><ul>\n<li>库：<code>&lt;algorithm&gt;</code></li>\n<li>参数：<ol>\n<li>迭代器，指示一个序列的开头</li>\n<li>迭代器，指示一个序列的末尾</li>\n<li>谓词，返回一个布尔值</li>\n</ol>\n</li>\n<li>功能：两个函数的功能都是将谓词作用于序列中的元素，然后将那些使得谓词为<code>True</code>的元素位于序列的头部，返回一个指向第一个使得谓词为<code>False</code>的元素的迭代器，它们的区别在于<code>stable_partition()</code>会保持元素的顺序不变，而<code>partiotion()</code>则有可能导致元素的顺序混乱</li>\n</ul>\n<h3 id=\"rand\"><a href=\"#rand\" class=\"headerlink\" title=\"rand()\"></a>rand()</h3><ul>\n<li>库：<code>&lt;cstdlib&gt;</code></li>\n<li>参数：无</li>\n<li>功能：在<code>[0,RAND_MAX)</code>之间返回一个伪随机数，<code>RAND_MAX</code>是一个大整数，它也是在<code>&lt;cstdlib&gt;</code>中定义的</li>\n<li>如何返回在某个指定范围内的随机整数：基本思想是将可以利用的随机数分为长度相等的存储桶，存储桶的个数就是我们需要的随机数的最大值，然后再计算一个随机数并且返回它所在的桶的编号，程序如下：</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">nrand</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span> || n &gt; RAND_MAX) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"built_in\">domain_error</span>(<span class=\"string\">&quot;Argument to nrand is out of range. &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> bucket_size = RAND_MAX / n;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> r;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> r = <span class=\"built_in\">rand</span>() / bucket_size;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (r &gt;= n);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> r;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"编程习惯\"><a href=\"#编程习惯\" class=\"headerlink\" title=\"编程习惯\"></a>编程习惯</h1><p>该部分的内容很多，涉及范围也很广，因此在这里我只纪录根据我个人实际情况需要注意的要点。更全面和详细的内容可以参考<a href=\"https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents/\">C++ 风格指南 - 内容目录 — Google 开源项目风格指南 (zh-google-styleguide.readthedocs.io)</a>。</p>\n<ul>\n<li>在编写运行时间较长的程序时，应当在合适的时刻刷新缓冲区</li>\n<li>循环的计数习惯：一般循环中的计数变量（假设为<code>i</code>）都从<code>0</code>开始，这样它的含义就比较明确，也即，<code>到目前为止，我们已经操作了i次</code>，此外这样做还有一个好处，那就是我们可以把循环条件设为<code>i != expected_loop_times</code>，这个不等式明确地表明了，当循环退出时，我们已经循环了<code>expectation_loop_times</code>次</li>\n<li>在定义一个变量来保存特定的数据结构时，应该使用库中为特殊用途而定义的类型，如现在想要顶一个存储字符串长度的变量<code>length</code>，那么可以有：<code>std::string::size_type length;</code>，另外还可以对库中提供的特殊类型重命名，如：<code>typedef std::string::size_type str_size;</code>就是将<code>std::string::size_type</code>这一类型在作用域内使用<code>str_size</code>来指代</li>\n<li>在操作容器中的多个元素时，推荐使用左闭右开的表示方法，这个区间中的元素个数就是上下限之间的差，这个区间的右界被称为越界值，这样做的理由有三个：<ul>\n<li>如果区间没有元素，那么找不到一个最后的元素标记终点</li>\n<li>按照上面的方法定义，只要两个迭代器相等，那么立即可以判断区间为空</li>\n<li>该方法提供了一种自然的方式表达“区间之外”</li>\n</ul>\n</li>\n<li>在使用标准库提供的容器的时候，尽量使用对应的迭代器</li>\n<li>一般都使用<code>double</code>类型来进行浮点数计算</li>\n<li>在编写程序时，需要预见一些异常或者无意义的情况，在这种情况下程序最好暂时终止或者退出</li>\n<li>函数形式参数的名称最好不要太具体，因为某个函数可以用于多种含义不同的数据（这个思想对编写模板函数很重要）</li>\n<li>在输出时如果需要在输出的内容之间插入分隔符（如空格、逗号等），应当对第一个元素做特殊处理，具体思想是：当第一个元素生成（或者确保它已经存在）之后，输出第一个元素，然后再判断之后的元素是否存在，如果存在的话，就将它们与分隔符一起输出</li>\n<li>对于不希望改变对象内容的函数，应当将它们声明为<code>const</code>类型</li>\n<li>如果一个函数会改变一个对象的状态，那么这个函数应该作为对象的成员函数</li>\n<li>在设计二元运算符的时候，为了能够让左右操作数都可以进行类型转换以保持操作数的对称性，尽量将二元运算符定义在类的声明之外</li>\n<li>对于在创建对象时调用的构造函一般不用声明为<code>explicit</code>，而对于用于构造新的对象的构造函数需要声明为<code>explicit</code></li>\n<li>不可以让用户用指针直接访问类中的私有成员</li>\n<li>使用句柄类时，当成员函数会改变底层对象的值时需要酌情进行复制操作，以保证指针的有效性</li>\n</ul>\n"},{"title":"DSA-1：算法的基本概念与复杂度分析","date":"2022-03-10T13:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"新的一年，新的坑。","_content":"\n## 关于算法的基本概念\n\n### 定义\n\n算法是基于特定的计算机模型，旨在解决某一信息处理问题而设计的一个指令序列。\n\n### 基本特性\n\n#### 输入与输出\n\n任何算法都需要通过输入来获得某一问题的实例，并且通过输出来给出问题的解。\n\n#### 基本操作、确定性与可行性\n\n- 基本操作：可以理解为计算机可以执行的，汇编语言中的一条命令，如`MOV`、`SUB`等\n- 确定性与可行性：算法可以描述为由若干语义明确的基本操作组成的指令序列，且每一基本操作在对应的计算模型中均可兑现\n\n#### 有穷性与正确性\n\n- 有穷性：算法在执行有限次基本操作之后会终止并且输出\n- 正确性：算法给出的输出是正确的\n\n##### 如何证明算法的有穷性与正确性\n\n- 问题的有效规模：其定义由问题的具体形式决定，如算法中需要操作的元素个数、需要操作的bit位等\n- 算法的单调性：问题的有效规模会随着算法的推进而递减\n- 算法的不变性：算法在任何时候都满足问题的前提条件，并且当问题的有效规模缩减到0时依旧满足，此时不变性等价于正确性\n- 证明算法有穷性和正确性的一个重要技巧就是从适当的角度审视整个计算过程，找到其中所具有的某种不变性和单调性\n\n#### 退化性和鲁棒性\n\n- 退化性：算法可以处理各种极端的输入个例（退化情况）\n- 鲁棒性：算法能够尽可能充分应对极端输入的情况\n\n#### 重用性\n\n算法的总体框架可以便捷地推广到其他应用场合。\n\n### 算法的效率问题\n\n- 可计算性：算法应当是在有限时间内能给出结果的，应当是必然终止的，也即满足有穷性\n- 难解性：算法满足有穷性但是花费的时间成本太高，这样的算法是难解的\n\n## 算法的复杂度度量\n\n### 时间复杂度\n\n#### 时间复杂度简介\n\n算法的时间复杂度衡量了算法在处理不同规模问题时所需要的时间长短，它是算法执行时间的变化趋势随输入规模变化的一个函数。\n\n对特定算法，其处理问题所需要的时间可以记为$T(n)$。表达式中的$n$即为问题的输入规模，比如对含有$n$个元素的向量进行排序，需要$T(n)$时间。\n\n另外需要注意的是，从保守估计的角度出发，在多个不同的规模为$n$的输入中，$n$为算法执行时间$T(n)$最长的所对应的那个输入的规模，并且以此时的$T(n)$来衡量算法的时间复杂度。\n\n#### 渐进复杂度\n\n渐进复杂度用于考察算法在处理大规模问题时的能力好坏，它注重复杂度的总体变化趋势和增长速度。因此，在衡量算法的复杂度时，其问题规模$n$通常很大。\n\n##### 大$\\mathcal O$记号\n\n出于保守估计，我们一般关心$T(n)$的渐进上界，以“大$\\mathcal{O}$记号”表示：$\\mathcal{O}(n)$。该记号在未来分析算法的复杂度时最为常用。\n\n关于其定义，有：$T(n)\\le c\\cdot f(n) $，即认为在$n$足够大以后，$f(n)$给出了$T(n)$增长速度的一个渐进上界。此时记$T(n) = \\mathcal O (f(n))$。**这里可以将$c$理解为执行基本操作所需要的时间，$f(n)$为对规模为$n$的输入，需要的操作次数。**\n\n大$\\mathcal O$记号有以下性质：\n\n- 对任一常数$c\\gt 0$，有$\\mathcal O (f(n)) = \\mathcal O (c\\cdot f(n))$\n- 对任意常数$a\\gt b\\gt 0$，有$\\mathcal O (n^a + n^b) = \\mathcal O (n^a)$\n\n对于上面的性质，可以理解为：**$c$与$n^b$等项都可以通过$n^a$的形式表示**。\n\n由于在不同的操作系统上，算法中的指令的执行时间不尽相同，因此将$T(n)$定义为算法所执行的基本操作的总次数比较合适。这里的基本操作，在不同的算法下有着不同的内容。\n\n以起泡排序为例，在每一轮内循环中，需要扫描和比较$n-1$对元素，至多需要交换$n-1$对元素，这里的比较和交换都属于基本操作；外循环最多执行$n-1$次，因此总共需要执行的基本操作不会超过$2(n-1)^2$次，有：$T(n) = \\mathcal O (2(n-1)^2)= \\mathcal O (n^2)$。\n\n上面的分析意味着，起泡排序在最坏的情况下，其运行时间不会超过$\\mathcal O (n^2)$。\n\n```c++\nvoid bubblesort1A ( int A[], int n ) { //起泡排序算法（版本1A）：0 <= n\n    bool sorted = false; //整体排序标志，首先假定尚未排序\n    while ( !sorted ) { //在尚未确认已全局排序之前，逐趟进行扫描交换\n       sorted = true; //假定已经排序\n       for ( int i = 1; i < n; i++ ) { //自左向右逐对检查当前范围A[0, n)内的各相邻元素\n          if ( A[i - 1] > A[i] ) { //一旦A[i - 1]与A[i]逆序，则\n             swap ( A[i - 1], A[i] ); //交换之，并\n             sorted = false; //因整体排序不能保证，需要清除排序标志\n          }\n       }\n       n--; //至此末元素必然就位，故可以缩短待排序序列的有效长度\n    }\n } //借助布尔型标志位sorted，可及时提前退出，而不致总是蛮力地做n - 1趟扫描交换\n```\n\n##### 大$\\Omega$记号\n\n大$\\Omega$记号给出了对算法在最好情况下的复杂度，其定义为：若$T(n)\\ge c\\cdot g(n)$，则认为在$n$足够大之后，$g(n)$给出了$T(n)$的一个渐进下界。此时记$T(n)=\\Omega (g(n))$。\n\n对于上面给出的起泡排序算法，假设问题的输入为一个长度为$n$的已经完全排序完成的向量，那么该算法仍然需要进行$n-1$次比较来确定排序已经完成，因此其最好渐进时间复杂度为$\\Omega (n)$。\n\n##### 大$\\Theta$记号\n\n大$\\Theta$记号表示的算法复杂度介于大$\\mathcal O$和大$\\Omega$之间，其定义为：若$c_1\\cdot h(n)\\le T(n) \\le c_2 \\cdot h(n)$，则认为在$n$足够大之后，$h(n)$给出了$T(n)$的一个确界。此时记$T(n) = \\Theta(h(n))$。\n\n$\\Theta (n)$给出了对算法复杂度的准确估计，算法在实际中的运行时间与其同阶。\n\n![三个不同记号之间的关系](https://astrobear.top/resource/astroblog/content/dsa-1-1.png)\n\n### 空间复杂度\n\n空间复杂度衡量了算法所需存储空间（内存）的多少，以上用于衡量时间复杂度的几种渐进记号同样适用于衡量空间复杂度。\n\n对于空间复杂度，一般不算入原始输入本身所占用的空间，只考虑在算法运行过程中需要的空间。此外，一般在评估算法性能时，我们不必考虑空间复杂度。因为就渐进复杂度的意义来说，任一算法的任何一次运行过程中所消耗的存储空间，都不可能超过其执行基本操作的累积次数。**时间复杂度本身就是空间复杂度的一个天然上界。**\n\n## 几种典型的复杂度层次\n\n### 常数$\\mathcal O (1)$\n\n在任何情况下，算法仅含有一次或者常数次基本操作，运行时间都为固定的常数，与算法的输入规模无关。这种算法被称为“常数时间复杂度算法”。\n\n对于仅需要$\\mathcal O (1)$辅助空间的算法，称为“就地算法”。\n\n### 对数$\\mathcal O (logn)$\n\n对数复杂度层次常常出现在每进行一次循环问题的规模就减半的情况下，此时对数的底数为2。一般情况下不会专门给出对数的底数，而只是将其笼统得记为$logn$的形式。\n\n显然，具有对数复杂度的算法肯定包含循环，循环的次数受到问题输入规模的影响，约等于$logn$。在循环之外，算法当然可能包括其他常数次基本操作，但是算法的执行时间还是主要由循环的次数决定。\n\n更一般的，凡是运行时间可以表示和度量为$T(n) = \\mathcal O (log^c n)$（$c$为正的常数）的算法，均统称为“对数多项式时间复杂度的算法”。此类算法的效率相对来说也是比较高效的。\n\n### 线性$\\mathcal O (n)$\n\n线性复杂度的算法同样相当常见。比如求n个数的和——对于大多数其他问题亦是如此——需要对输入的每个单元至少访问一次，因此至少需要n轮循环。该算法的运行时间随问题的输入规模增大而线性增大，其效率也还算令人满意。\n\n### 多项式$\\mathcal O (poly(n))$\n\n该类算法的运行时间可以表示为问题输入规模$n$的多项式形式，如前面提到的起泡排序算法，其复杂度为$\\mathcal O (n^2)$。无论多项式中$n$的最高次幂为多少，只要复杂度符合这种形式的算法都可以归入此类，尽管在考虑幂次后他们的复杂度会有天壤之别。\n\n在实际应用中，具有该复杂度的算法通常是可以忍受的。如果一个问题存在一个复杂度在此范围之内的算法，那么这个问题被称为是*可以有效求解的*或者*易解的*，否则称为*难解的*。\n\n### 指数$\\mathcal O (2^n)$\n\n凡是运行时间可以表示和度量为$T(n) = \\mathcal O (a^n)$ （$a\\gt 1$）形式的算法，均属于指数时间复杂度算法。比如，对于“求一个含有n个元素的集合的所有子集”的问题，它含有$2^n$个子集，因此其复杂度为指数的。\n\n通常认为，指数复杂度的算法无法真正用于实际问题之中。\n\n### 关于输入规模的额外讨论\n\n考察下面的例子：\n\n```c++\n__int64 power2BF_I ( int n ) { //幂函数2^n算法（蛮力迭代版），n >= 0\n   __int64 pow = 1; //O(1)：累积器初始化为2^0\n   while ( 0 < n -- ) //O(n)：迭代n轮，每轮都\n      pow <<= 1; //O(1)：将累积器翻倍\n   return pow; //O(1)：返回累积器\n} //O(n) = O(2^r)，r为输入指数n的比特位数\n```\n\n该算法的功能是在不超过一位的移位运算下对任意非负整数n，计算$2^n$。一般我们将该算法的时间复杂度认为是$\\mathcal O (n)$的，但是如果将输入n的二进制位数$r = 1 + \\lfloor log_2 n\\rfloor$作为输入规模去考虑的话，则其运行时间为$2^r$。\n\n从上面的例子可知，对于算法复杂度的界定，都是相对于问题的输入规模而言的。因此对同一个算法，可能得到不同的复杂度分析的结论。严格来说，待计算问题的输入规模应定义为“用于描述输入所需要的空间规模”，也即问题输入所占的内存空间（个人理解这样定义的原因是计算机的基本操作都是基于二进制位进行的）。\n\n以输入的自然独立体个数n的数值（如待排序元素的个数、待求和的元素个数等）作为基准得出的$\\mathcal O (logn)$与$\\mathcal O (n)$复杂度，被分别称为伪对数的和伪线性的复杂度。**但是一般情况下，我们还是以输入的自然独立体个数n的数值作为分析算法复杂度的基准。**\n","source":"_posts/dsa-1.md","raw":"---\ntitle: DSA-1：算法的基本概念与复杂度分析\ndate: 2022-3-10 21:00:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 新的一年，新的坑。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n## 关于算法的基本概念\n\n### 定义\n\n算法是基于特定的计算机模型，旨在解决某一信息处理问题而设计的一个指令序列。\n\n### 基本特性\n\n#### 输入与输出\n\n任何算法都需要通过输入来获得某一问题的实例，并且通过输出来给出问题的解。\n\n#### 基本操作、确定性与可行性\n\n- 基本操作：可以理解为计算机可以执行的，汇编语言中的一条命令，如`MOV`、`SUB`等\n- 确定性与可行性：算法可以描述为由若干语义明确的基本操作组成的指令序列，且每一基本操作在对应的计算模型中均可兑现\n\n#### 有穷性与正确性\n\n- 有穷性：算法在执行有限次基本操作之后会终止并且输出\n- 正确性：算法给出的输出是正确的\n\n##### 如何证明算法的有穷性与正确性\n\n- 问题的有效规模：其定义由问题的具体形式决定，如算法中需要操作的元素个数、需要操作的bit位等\n- 算法的单调性：问题的有效规模会随着算法的推进而递减\n- 算法的不变性：算法在任何时候都满足问题的前提条件，并且当问题的有效规模缩减到0时依旧满足，此时不变性等价于正确性\n- 证明算法有穷性和正确性的一个重要技巧就是从适当的角度审视整个计算过程，找到其中所具有的某种不变性和单调性\n\n#### 退化性和鲁棒性\n\n- 退化性：算法可以处理各种极端的输入个例（退化情况）\n- 鲁棒性：算法能够尽可能充分应对极端输入的情况\n\n#### 重用性\n\n算法的总体框架可以便捷地推广到其他应用场合。\n\n### 算法的效率问题\n\n- 可计算性：算法应当是在有限时间内能给出结果的，应当是必然终止的，也即满足有穷性\n- 难解性：算法满足有穷性但是花费的时间成本太高，这样的算法是难解的\n\n## 算法的复杂度度量\n\n### 时间复杂度\n\n#### 时间复杂度简介\n\n算法的时间复杂度衡量了算法在处理不同规模问题时所需要的时间长短，它是算法执行时间的变化趋势随输入规模变化的一个函数。\n\n对特定算法，其处理问题所需要的时间可以记为$T(n)$。表达式中的$n$即为问题的输入规模，比如对含有$n$个元素的向量进行排序，需要$T(n)$时间。\n\n另外需要注意的是，从保守估计的角度出发，在多个不同的规模为$n$的输入中，$n$为算法执行时间$T(n)$最长的所对应的那个输入的规模，并且以此时的$T(n)$来衡量算法的时间复杂度。\n\n#### 渐进复杂度\n\n渐进复杂度用于考察算法在处理大规模问题时的能力好坏，它注重复杂度的总体变化趋势和增长速度。因此，在衡量算法的复杂度时，其问题规模$n$通常很大。\n\n##### 大$\\mathcal O$记号\n\n出于保守估计，我们一般关心$T(n)$的渐进上界，以“大$\\mathcal{O}$记号”表示：$\\mathcal{O}(n)$。该记号在未来分析算法的复杂度时最为常用。\n\n关于其定义，有：$T(n)\\le c\\cdot f(n) $，即认为在$n$足够大以后，$f(n)$给出了$T(n)$增长速度的一个渐进上界。此时记$T(n) = \\mathcal O (f(n))$。**这里可以将$c$理解为执行基本操作所需要的时间，$f(n)$为对规模为$n$的输入，需要的操作次数。**\n\n大$\\mathcal O$记号有以下性质：\n\n- 对任一常数$c\\gt 0$，有$\\mathcal O (f(n)) = \\mathcal O (c\\cdot f(n))$\n- 对任意常数$a\\gt b\\gt 0$，有$\\mathcal O (n^a + n^b) = \\mathcal O (n^a)$\n\n对于上面的性质，可以理解为：**$c$与$n^b$等项都可以通过$n^a$的形式表示**。\n\n由于在不同的操作系统上，算法中的指令的执行时间不尽相同，因此将$T(n)$定义为算法所执行的基本操作的总次数比较合适。这里的基本操作，在不同的算法下有着不同的内容。\n\n以起泡排序为例，在每一轮内循环中，需要扫描和比较$n-1$对元素，至多需要交换$n-1$对元素，这里的比较和交换都属于基本操作；外循环最多执行$n-1$次，因此总共需要执行的基本操作不会超过$2(n-1)^2$次，有：$T(n) = \\mathcal O (2(n-1)^2)= \\mathcal O (n^2)$。\n\n上面的分析意味着，起泡排序在最坏的情况下，其运行时间不会超过$\\mathcal O (n^2)$。\n\n```c++\nvoid bubblesort1A ( int A[], int n ) { //起泡排序算法（版本1A）：0 <= n\n    bool sorted = false; //整体排序标志，首先假定尚未排序\n    while ( !sorted ) { //在尚未确认已全局排序之前，逐趟进行扫描交换\n       sorted = true; //假定已经排序\n       for ( int i = 1; i < n; i++ ) { //自左向右逐对检查当前范围A[0, n)内的各相邻元素\n          if ( A[i - 1] > A[i] ) { //一旦A[i - 1]与A[i]逆序，则\n             swap ( A[i - 1], A[i] ); //交换之，并\n             sorted = false; //因整体排序不能保证，需要清除排序标志\n          }\n       }\n       n--; //至此末元素必然就位，故可以缩短待排序序列的有效长度\n    }\n } //借助布尔型标志位sorted，可及时提前退出，而不致总是蛮力地做n - 1趟扫描交换\n```\n\n##### 大$\\Omega$记号\n\n大$\\Omega$记号给出了对算法在最好情况下的复杂度，其定义为：若$T(n)\\ge c\\cdot g(n)$，则认为在$n$足够大之后，$g(n)$给出了$T(n)$的一个渐进下界。此时记$T(n)=\\Omega (g(n))$。\n\n对于上面给出的起泡排序算法，假设问题的输入为一个长度为$n$的已经完全排序完成的向量，那么该算法仍然需要进行$n-1$次比较来确定排序已经完成，因此其最好渐进时间复杂度为$\\Omega (n)$。\n\n##### 大$\\Theta$记号\n\n大$\\Theta$记号表示的算法复杂度介于大$\\mathcal O$和大$\\Omega$之间，其定义为：若$c_1\\cdot h(n)\\le T(n) \\le c_2 \\cdot h(n)$，则认为在$n$足够大之后，$h(n)$给出了$T(n)$的一个确界。此时记$T(n) = \\Theta(h(n))$。\n\n$\\Theta (n)$给出了对算法复杂度的准确估计，算法在实际中的运行时间与其同阶。\n\n![三个不同记号之间的关系](https://astrobear.top/resource/astroblog/content/dsa-1-1.png)\n\n### 空间复杂度\n\n空间复杂度衡量了算法所需存储空间（内存）的多少，以上用于衡量时间复杂度的几种渐进记号同样适用于衡量空间复杂度。\n\n对于空间复杂度，一般不算入原始输入本身所占用的空间，只考虑在算法运行过程中需要的空间。此外，一般在评估算法性能时，我们不必考虑空间复杂度。因为就渐进复杂度的意义来说，任一算法的任何一次运行过程中所消耗的存储空间，都不可能超过其执行基本操作的累积次数。**时间复杂度本身就是空间复杂度的一个天然上界。**\n\n## 几种典型的复杂度层次\n\n### 常数$\\mathcal O (1)$\n\n在任何情况下，算法仅含有一次或者常数次基本操作，运行时间都为固定的常数，与算法的输入规模无关。这种算法被称为“常数时间复杂度算法”。\n\n对于仅需要$\\mathcal O (1)$辅助空间的算法，称为“就地算法”。\n\n### 对数$\\mathcal O (logn)$\n\n对数复杂度层次常常出现在每进行一次循环问题的规模就减半的情况下，此时对数的底数为2。一般情况下不会专门给出对数的底数，而只是将其笼统得记为$logn$的形式。\n\n显然，具有对数复杂度的算法肯定包含循环，循环的次数受到问题输入规模的影响，约等于$logn$。在循环之外，算法当然可能包括其他常数次基本操作，但是算法的执行时间还是主要由循环的次数决定。\n\n更一般的，凡是运行时间可以表示和度量为$T(n) = \\mathcal O (log^c n)$（$c$为正的常数）的算法，均统称为“对数多项式时间复杂度的算法”。此类算法的效率相对来说也是比较高效的。\n\n### 线性$\\mathcal O (n)$\n\n线性复杂度的算法同样相当常见。比如求n个数的和——对于大多数其他问题亦是如此——需要对输入的每个单元至少访问一次，因此至少需要n轮循环。该算法的运行时间随问题的输入规模增大而线性增大，其效率也还算令人满意。\n\n### 多项式$\\mathcal O (poly(n))$\n\n该类算法的运行时间可以表示为问题输入规模$n$的多项式形式，如前面提到的起泡排序算法，其复杂度为$\\mathcal O (n^2)$。无论多项式中$n$的最高次幂为多少，只要复杂度符合这种形式的算法都可以归入此类，尽管在考虑幂次后他们的复杂度会有天壤之别。\n\n在实际应用中，具有该复杂度的算法通常是可以忍受的。如果一个问题存在一个复杂度在此范围之内的算法，那么这个问题被称为是*可以有效求解的*或者*易解的*，否则称为*难解的*。\n\n### 指数$\\mathcal O (2^n)$\n\n凡是运行时间可以表示和度量为$T(n) = \\mathcal O (a^n)$ （$a\\gt 1$）形式的算法，均属于指数时间复杂度算法。比如，对于“求一个含有n个元素的集合的所有子集”的问题，它含有$2^n$个子集，因此其复杂度为指数的。\n\n通常认为，指数复杂度的算法无法真正用于实际问题之中。\n\n### 关于输入规模的额外讨论\n\n考察下面的例子：\n\n```c++\n__int64 power2BF_I ( int n ) { //幂函数2^n算法（蛮力迭代版），n >= 0\n   __int64 pow = 1; //O(1)：累积器初始化为2^0\n   while ( 0 < n -- ) //O(n)：迭代n轮，每轮都\n      pow <<= 1; //O(1)：将累积器翻倍\n   return pow; //O(1)：返回累积器\n} //O(n) = O(2^r)，r为输入指数n的比特位数\n```\n\n该算法的功能是在不超过一位的移位运算下对任意非负整数n，计算$2^n$。一般我们将该算法的时间复杂度认为是$\\mathcal O (n)$的，但是如果将输入n的二进制位数$r = 1 + \\lfloor log_2 n\\rfloor$作为输入规模去考虑的话，则其运行时间为$2^r$。\n\n从上面的例子可知，对于算法复杂度的界定，都是相对于问题的输入规模而言的。因此对同一个算法，可能得到不同的复杂度分析的结论。严格来说，待计算问题的输入规模应定义为“用于描述输入所需要的空间规模”，也即问题输入所占的内存空间（个人理解这样定义的原因是计算机的基本操作都是基于二进制位进行的）。\n\n以输入的自然独立体个数n的数值（如待排序元素的个数、待求和的元素个数等）作为基准得出的$\\mathcal O (logn)$与$\\mathcal O (n)$复杂度，被分别称为伪对数的和伪线性的复杂度。**但是一般情况下，我们还是以输入的自然独立体个数n的数值作为分析算法复杂度的基准。**\n","slug":"dsa-1","published":1,"updated":"2022-03-10T13:59:30.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0400131q39awgs99c3","content":"<h2 id=\"关于算法的基本概念\"><a href=\"#关于算法的基本概念\" class=\"headerlink\" title=\"关于算法的基本概念\"></a>关于算法的基本概念</h2><h3 id=\"定义\"><a href=\"#定义\" class=\"headerlink\" title=\"定义\"></a>定义</h3><p>算法是基于特定的计算机模型，旨在解决某一信息处理问题而设计的一个指令序列。</p>\n<h3 id=\"基本特性\"><a href=\"#基本特性\" class=\"headerlink\" title=\"基本特性\"></a>基本特性</h3><h4 id=\"输入与输出\"><a href=\"#输入与输出\" class=\"headerlink\" title=\"输入与输出\"></a>输入与输出</h4><p>任何算法都需要通过输入来获得某一问题的实例，并且通过输出来给出问题的解。</p>\n<h4 id=\"基本操作、确定性与可行性\"><a href=\"#基本操作、确定性与可行性\" class=\"headerlink\" title=\"基本操作、确定性与可行性\"></a>基本操作、确定性与可行性</h4><ul>\n<li>基本操作：可以理解为计算机可以执行的，汇编语言中的一条命令，如<code>MOV</code>、<code>SUB</code>等</li>\n<li>确定性与可行性：算法可以描述为由若干语义明确的基本操作组成的指令序列，且每一基本操作在对应的计算模型中均可兑现</li>\n</ul>\n<h4 id=\"有穷性与正确性\"><a href=\"#有穷性与正确性\" class=\"headerlink\" title=\"有穷性与正确性\"></a>有穷性与正确性</h4><ul>\n<li>有穷性：算法在执行有限次基本操作之后会终止并且输出</li>\n<li>正确性：算法给出的输出是正确的</li>\n</ul>\n<h5 id=\"如何证明算法的有穷性与正确性\"><a href=\"#如何证明算法的有穷性与正确性\" class=\"headerlink\" title=\"如何证明算法的有穷性与正确性\"></a>如何证明算法的有穷性与正确性</h5><ul>\n<li>问题的有效规模：其定义由问题的具体形式决定，如算法中需要操作的元素个数、需要操作的bit位等</li>\n<li>算法的单调性：问题的有效规模会随着算法的推进而递减</li>\n<li>算法的不变性：算法在任何时候都满足问题的前提条件，并且当问题的有效规模缩减到0时依旧满足，此时不变性等价于正确性</li>\n<li>证明算法有穷性和正确性的一个重要技巧就是从适当的角度审视整个计算过程，找到其中所具有的某种不变性和单调性</li>\n</ul>\n<h4 id=\"退化性和鲁棒性\"><a href=\"#退化性和鲁棒性\" class=\"headerlink\" title=\"退化性和鲁棒性\"></a>退化性和鲁棒性</h4><ul>\n<li>退化性：算法可以处理各种极端的输入个例（退化情况）</li>\n<li>鲁棒性：算法能够尽可能充分应对极端输入的情况</li>\n</ul>\n<h4 id=\"重用性\"><a href=\"#重用性\" class=\"headerlink\" title=\"重用性\"></a>重用性</h4><p>算法的总体框架可以便捷地推广到其他应用场合。</p>\n<h3 id=\"算法的效率问题\"><a href=\"#算法的效率问题\" class=\"headerlink\" title=\"算法的效率问题\"></a>算法的效率问题</h3><ul>\n<li>可计算性：算法应当是在有限时间内能给出结果的，应当是必然终止的，也即满足有穷性</li>\n<li>难解性：算法满足有穷性但是花费的时间成本太高，这样的算法是难解的</li>\n</ul>\n<h2 id=\"算法的复杂度度量\"><a href=\"#算法的复杂度度量\" class=\"headerlink\" title=\"算法的复杂度度量\"></a>算法的复杂度度量</h2><h3 id=\"时间复杂度\"><a href=\"#时间复杂度\" class=\"headerlink\" title=\"时间复杂度\"></a>时间复杂度</h3><h4 id=\"时间复杂度简介\"><a href=\"#时间复杂度简介\" class=\"headerlink\" title=\"时间复杂度简介\"></a>时间复杂度简介</h4><p>算法的时间复杂度衡量了算法在处理不同规模问题时所需要的时间长短，它是算法执行时间的变化趋势随输入规模变化的一个函数。</p>\n<p>对特定算法，其处理问题所需要的时间可以记为$T(n)$。表达式中的$n$即为问题的输入规模，比如对含有$n$个元素的向量进行排序，需要$T(n)$时间。</p>\n<p>另外需要注意的是，从保守估计的角度出发，在多个不同的规模为$n$的输入中，$n$为算法执行时间$T(n)$最长的所对应的那个输入的规模，并且以此时的$T(n)$来衡量算法的时间复杂度。</p>\n<h4 id=\"渐进复杂度\"><a href=\"#渐进复杂度\" class=\"headerlink\" title=\"渐进复杂度\"></a>渐进复杂度</h4><p>渐进复杂度用于考察算法在处理大规模问题时的能力好坏，它注重复杂度的总体变化趋势和增长速度。因此，在衡量算法的复杂度时，其问题规模$n$通常很大。</p>\n<h5 id=\"大-mathcal-O-记号\"><a href=\"#大-mathcal-O-记号\" class=\"headerlink\" title=\"大$\\mathcal O$记号\"></a>大$\\mathcal O$记号</h5><p>出于保守估计，我们一般关心$T(n)$的渐进上界，以“大$\\mathcal{O}$记号”表示：$\\mathcal{O}(n)$。该记号在未来分析算法的复杂度时最为常用。</p>\n<p>关于其定义，有：$T(n)\\le c\\cdot f(n) $，即认为在$n$足够大以后，$f(n)$给出了$T(n)$增长速度的一个渐进上界。此时记$T(n) = \\mathcal O (f(n))$。<strong>这里可以将$c$理解为执行基本操作所需要的时间，$f(n)$为对规模为$n$的输入，需要的操作次数。</strong></p>\n<p>大$\\mathcal O$记号有以下性质：</p>\n<ul>\n<li>对任一常数$c\\gt 0$，有$\\mathcal O (f(n)) = \\mathcal O (c\\cdot f(n))$</li>\n<li>对任意常数$a\\gt b\\gt 0$，有$\\mathcal O (n^a + n^b) = \\mathcal O (n^a)$</li>\n</ul>\n<p>对于上面的性质，可以理解为：<strong>$c$与$n^b$等项都可以通过$n^a$的形式表示</strong>。</p>\n<p>由于在不同的操作系统上，算法中的指令的执行时间不尽相同，因此将$T(n)$定义为算法所执行的基本操作的总次数比较合适。这里的基本操作，在不同的算法下有着不同的内容。</p>\n<p>以起泡排序为例，在每一轮内循环中，需要扫描和比较$n-1$对元素，至多需要交换$n-1$对元素，这里的比较和交换都属于基本操作；外循环最多执行$n-1$次，因此总共需要执行的基本操作不会超过$2(n-1)^2$次，有：$T(n) = \\mathcal O (2(n-1)^2)= \\mathcal O (n^2)$。</p>\n<p>上面的分析意味着，起泡排序在最坏的情况下，其运行时间不会超过$\\mathcal O (n^2)$。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">bubblesort1A</span> <span class=\"params\">( <span class=\"keyword\">int</span> A[], <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//起泡排序算法（版本1A）：0 &lt;= n</span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> sorted = <span class=\"literal\">false</span>; <span class=\"comment\">//整体排序标志，首先假定尚未排序</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ( !sorted ) &#123; <span class=\"comment\">//在尚未确认已全局排序之前，逐趟进行扫描交换</span></span><br><span class=\"line\">       sorted = <span class=\"literal\">true</span>; <span class=\"comment\">//假定已经排序</span></span><br><span class=\"line\">       <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; n; i++ ) &#123; <span class=\"comment\">//自左向右逐对检查当前范围A[0, n)内的各相邻元素</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( A[i - <span class=\"number\">1</span>] &gt; A[i] ) &#123; <span class=\"comment\">//一旦A[i - 1]与A[i]逆序，则</span></span><br><span class=\"line\">             <span class=\"built_in\">swap</span> ( A[i - <span class=\"number\">1</span>], A[i] ); <span class=\"comment\">//交换之，并</span></span><br><span class=\"line\">             sorted = <span class=\"literal\">false</span>; <span class=\"comment\">//因整体排序不能保证，需要清除排序标志</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       n--; <span class=\"comment\">//至此末元素必然就位，故可以缩短待排序序列的有效长度</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> &#125; <span class=\"comment\">//借助布尔型标志位sorted，可及时提前退出，而不致总是蛮力地做n - 1趟扫描交换</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"大-Omega-记号\"><a href=\"#大-Omega-记号\" class=\"headerlink\" title=\"大$\\Omega$记号\"></a>大$\\Omega$记号</h5><p>大$\\Omega$记号给出了对算法在最好情况下的复杂度，其定义为：若$T(n)\\ge c\\cdot g(n)$，则认为在$n$足够大之后，$g(n)$给出了$T(n)$的一个渐进下界。此时记$T(n)=\\Omega (g(n))$。</p>\n<p>对于上面给出的起泡排序算法，假设问题的输入为一个长度为$n$的已经完全排序完成的向量，那么该算法仍然需要进行$n-1$次比较来确定排序已经完成，因此其最好渐进时间复杂度为$\\Omega (n)$。</p>\n<h5 id=\"大-Theta-记号\"><a href=\"#大-Theta-记号\" class=\"headerlink\" title=\"大$\\Theta$记号\"></a>大$\\Theta$记号</h5><p>大$\\Theta$记号表示的算法复杂度介于大$\\mathcal O$和大$\\Omega$之间，其定义为：若$c_1\\cdot h(n)\\le T(n) \\le c_2 \\cdot h(n)$，则认为在$n$足够大之后，$h(n)$给出了$T(n)$的一个确界。此时记$T(n) = \\Theta(h(n))$。</p>\n<p>$\\Theta (n)$给出了对算法复杂度的准确估计，算法在实际中的运行时间与其同阶。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-1-1.png\" alt=\"三个不同记号之间的关系\"></p>\n<h3 id=\"空间复杂度\"><a href=\"#空间复杂度\" class=\"headerlink\" title=\"空间复杂度\"></a>空间复杂度</h3><p>空间复杂度衡量了算法所需存储空间（内存）的多少，以上用于衡量时间复杂度的几种渐进记号同样适用于衡量空间复杂度。</p>\n<p>对于空间复杂度，一般不算入原始输入本身所占用的空间，只考虑在算法运行过程中需要的空间。此外，一般在评估算法性能时，我们不必考虑空间复杂度。因为就渐进复杂度的意义来说，任一算法的任何一次运行过程中所消耗的存储空间，都不可能超过其执行基本操作的累积次数。<strong>时间复杂度本身就是空间复杂度的一个天然上界。</strong></p>\n<h2 id=\"几种典型的复杂度层次\"><a href=\"#几种典型的复杂度层次\" class=\"headerlink\" title=\"几种典型的复杂度层次\"></a>几种典型的复杂度层次</h2><h3 id=\"常数-mathcal-O-1\"><a href=\"#常数-mathcal-O-1\" class=\"headerlink\" title=\"常数$\\mathcal O (1)$\"></a>常数$\\mathcal O (1)$</h3><p>在任何情况下，算法仅含有一次或者常数次基本操作，运行时间都为固定的常数，与算法的输入规模无关。这种算法被称为“常数时间复杂度算法”。</p>\n<p>对于仅需要$\\mathcal O (1)$辅助空间的算法，称为“就地算法”。</p>\n<h3 id=\"对数-mathcal-O-logn\"><a href=\"#对数-mathcal-O-logn\" class=\"headerlink\" title=\"对数$\\mathcal O (logn)$\"></a>对数$\\mathcal O (logn)$</h3><p>对数复杂度层次常常出现在每进行一次循环问题的规模就减半的情况下，此时对数的底数为2。一般情况下不会专门给出对数的底数，而只是将其笼统得记为$logn$的形式。</p>\n<p>显然，具有对数复杂度的算法肯定包含循环，循环的次数受到问题输入规模的影响，约等于$logn$。在循环之外，算法当然可能包括其他常数次基本操作，但是算法的执行时间还是主要由循环的次数决定。</p>\n<p>更一般的，凡是运行时间可以表示和度量为$T(n) = \\mathcal O (log^c n)$（$c$为正的常数）的算法，均统称为“对数多项式时间复杂度的算法”。此类算法的效率相对来说也是比较高效的。</p>\n<h3 id=\"线性-mathcal-O-n\"><a href=\"#线性-mathcal-O-n\" class=\"headerlink\" title=\"线性$\\mathcal O (n)$\"></a>线性$\\mathcal O (n)$</h3><p>线性复杂度的算法同样相当常见。比如求n个数的和——对于大多数其他问题亦是如此——需要对输入的每个单元至少访问一次，因此至少需要n轮循环。该算法的运行时间随问题的输入规模增大而线性增大，其效率也还算令人满意。</p>\n<h3 id=\"多项式-mathcal-O-poly-n\"><a href=\"#多项式-mathcal-O-poly-n\" class=\"headerlink\" title=\"多项式$\\mathcal O (poly(n))$\"></a>多项式$\\mathcal O (poly(n))$</h3><p>该类算法的运行时间可以表示为问题输入规模$n$的多项式形式，如前面提到的起泡排序算法，其复杂度为$\\mathcal O (n^2)$。无论多项式中$n$的最高次幂为多少，只要复杂度符合这种形式的算法都可以归入此类，尽管在考虑幂次后他们的复杂度会有天壤之别。</p>\n<p>在实际应用中，具有该复杂度的算法通常是可以忍受的。如果一个问题存在一个复杂度在此范围之内的算法，那么这个问题被称为是<em>可以有效求解的</em>或者<em>易解的</em>，否则称为<em>难解的</em>。</p>\n<h3 id=\"指数-mathcal-O-2-n\"><a href=\"#指数-mathcal-O-2-n\" class=\"headerlink\" title=\"指数$\\mathcal O (2^n)$\"></a>指数$\\mathcal O (2^n)$</h3><p>凡是运行时间可以表示和度量为$T(n) = \\mathcal O (a^n)$ （$a\\gt 1$）形式的算法，均属于指数时间复杂度算法。比如，对于“求一个含有n个元素的集合的所有子集”的问题，它含有$2^n$个子集，因此其复杂度为指数的。</p>\n<p>通常认为，指数复杂度的算法无法真正用于实际问题之中。</p>\n<h3 id=\"关于输入规模的额外讨论\"><a href=\"#关于输入规模的额外讨论\" class=\"headerlink\" title=\"关于输入规模的额外讨论\"></a>关于输入规模的额外讨论</h3><p>考察下面的例子：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">power2BF_I</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//幂函数2^n算法（蛮力迭代版），n &gt;= 0</span></span><br><span class=\"line\">   __int64 pow = <span class=\"number\">1</span>; <span class=\"comment\">//O(1)：累积器初始化为2^0</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; n -- ) <span class=\"comment\">//O(n)：迭代n轮，每轮都</span></span><br><span class=\"line\">      pow &lt;&lt;= <span class=\"number\">1</span>; <span class=\"comment\">//O(1)：将累积器翻倍</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> pow; <span class=\"comment\">//O(1)：返回累积器</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(n) = O(2^r)，r为输入指数n的比特位数</span></span><br></pre></td></tr></table></figure>\n\n<p>该算法的功能是在不超过一位的移位运算下对任意非负整数n，计算$2^n$。一般我们将该算法的时间复杂度认为是$\\mathcal O (n)$的，但是如果将输入n的二进制位数$r = 1 + \\lfloor log_2 n\\rfloor$作为输入规模去考虑的话，则其运行时间为$2^r$。</p>\n<p>从上面的例子可知，对于算法复杂度的界定，都是相对于问题的输入规模而言的。因此对同一个算法，可能得到不同的复杂度分析的结论。严格来说，待计算问题的输入规模应定义为“用于描述输入所需要的空间规模”，也即问题输入所占的内存空间（个人理解这样定义的原因是计算机的基本操作都是基于二进制位进行的）。</p>\n<p>以输入的自然独立体个数n的数值（如待排序元素的个数、待求和的元素个数等）作为基准得出的$\\mathcal O (logn)$与$\\mathcal O (n)$复杂度，被分别称为伪对数的和伪线性的复杂度。<strong>但是一般情况下，我们还是以输入的自然独立体个数n的数值作为分析算法复杂度的基准。</strong></p>\n","site":{"data":{}},"more":"<h2 id=\"关于算法的基本概念\"><a href=\"#关于算法的基本概念\" class=\"headerlink\" title=\"关于算法的基本概念\"></a>关于算法的基本概念</h2><h3 id=\"定义\"><a href=\"#定义\" class=\"headerlink\" title=\"定义\"></a>定义</h3><p>算法是基于特定的计算机模型，旨在解决某一信息处理问题而设计的一个指令序列。</p>\n<h3 id=\"基本特性\"><a href=\"#基本特性\" class=\"headerlink\" title=\"基本特性\"></a>基本特性</h3><h4 id=\"输入与输出\"><a href=\"#输入与输出\" class=\"headerlink\" title=\"输入与输出\"></a>输入与输出</h4><p>任何算法都需要通过输入来获得某一问题的实例，并且通过输出来给出问题的解。</p>\n<h4 id=\"基本操作、确定性与可行性\"><a href=\"#基本操作、确定性与可行性\" class=\"headerlink\" title=\"基本操作、确定性与可行性\"></a>基本操作、确定性与可行性</h4><ul>\n<li>基本操作：可以理解为计算机可以执行的，汇编语言中的一条命令，如<code>MOV</code>、<code>SUB</code>等</li>\n<li>确定性与可行性：算法可以描述为由若干语义明确的基本操作组成的指令序列，且每一基本操作在对应的计算模型中均可兑现</li>\n</ul>\n<h4 id=\"有穷性与正确性\"><a href=\"#有穷性与正确性\" class=\"headerlink\" title=\"有穷性与正确性\"></a>有穷性与正确性</h4><ul>\n<li>有穷性：算法在执行有限次基本操作之后会终止并且输出</li>\n<li>正确性：算法给出的输出是正确的</li>\n</ul>\n<h5 id=\"如何证明算法的有穷性与正确性\"><a href=\"#如何证明算法的有穷性与正确性\" class=\"headerlink\" title=\"如何证明算法的有穷性与正确性\"></a>如何证明算法的有穷性与正确性</h5><ul>\n<li>问题的有效规模：其定义由问题的具体形式决定，如算法中需要操作的元素个数、需要操作的bit位等</li>\n<li>算法的单调性：问题的有效规模会随着算法的推进而递减</li>\n<li>算法的不变性：算法在任何时候都满足问题的前提条件，并且当问题的有效规模缩减到0时依旧满足，此时不变性等价于正确性</li>\n<li>证明算法有穷性和正确性的一个重要技巧就是从适当的角度审视整个计算过程，找到其中所具有的某种不变性和单调性</li>\n</ul>\n<h4 id=\"退化性和鲁棒性\"><a href=\"#退化性和鲁棒性\" class=\"headerlink\" title=\"退化性和鲁棒性\"></a>退化性和鲁棒性</h4><ul>\n<li>退化性：算法可以处理各种极端的输入个例（退化情况）</li>\n<li>鲁棒性：算法能够尽可能充分应对极端输入的情况</li>\n</ul>\n<h4 id=\"重用性\"><a href=\"#重用性\" class=\"headerlink\" title=\"重用性\"></a>重用性</h4><p>算法的总体框架可以便捷地推广到其他应用场合。</p>\n<h3 id=\"算法的效率问题\"><a href=\"#算法的效率问题\" class=\"headerlink\" title=\"算法的效率问题\"></a>算法的效率问题</h3><ul>\n<li>可计算性：算法应当是在有限时间内能给出结果的，应当是必然终止的，也即满足有穷性</li>\n<li>难解性：算法满足有穷性但是花费的时间成本太高，这样的算法是难解的</li>\n</ul>\n<h2 id=\"算法的复杂度度量\"><a href=\"#算法的复杂度度量\" class=\"headerlink\" title=\"算法的复杂度度量\"></a>算法的复杂度度量</h2><h3 id=\"时间复杂度\"><a href=\"#时间复杂度\" class=\"headerlink\" title=\"时间复杂度\"></a>时间复杂度</h3><h4 id=\"时间复杂度简介\"><a href=\"#时间复杂度简介\" class=\"headerlink\" title=\"时间复杂度简介\"></a>时间复杂度简介</h4><p>算法的时间复杂度衡量了算法在处理不同规模问题时所需要的时间长短，它是算法执行时间的变化趋势随输入规模变化的一个函数。</p>\n<p>对特定算法，其处理问题所需要的时间可以记为$T(n)$。表达式中的$n$即为问题的输入规模，比如对含有$n$个元素的向量进行排序，需要$T(n)$时间。</p>\n<p>另外需要注意的是，从保守估计的角度出发，在多个不同的规模为$n$的输入中，$n$为算法执行时间$T(n)$最长的所对应的那个输入的规模，并且以此时的$T(n)$来衡量算法的时间复杂度。</p>\n<h4 id=\"渐进复杂度\"><a href=\"#渐进复杂度\" class=\"headerlink\" title=\"渐进复杂度\"></a>渐进复杂度</h4><p>渐进复杂度用于考察算法在处理大规模问题时的能力好坏，它注重复杂度的总体变化趋势和增长速度。因此，在衡量算法的复杂度时，其问题规模$n$通常很大。</p>\n<h5 id=\"大-mathcal-O-记号\"><a href=\"#大-mathcal-O-记号\" class=\"headerlink\" title=\"大$\\mathcal O$记号\"></a>大$\\mathcal O$记号</h5><p>出于保守估计，我们一般关心$T(n)$的渐进上界，以“大$\\mathcal{O}$记号”表示：$\\mathcal{O}(n)$。该记号在未来分析算法的复杂度时最为常用。</p>\n<p>关于其定义，有：$T(n)\\le c\\cdot f(n) $，即认为在$n$足够大以后，$f(n)$给出了$T(n)$增长速度的一个渐进上界。此时记$T(n) = \\mathcal O (f(n))$。<strong>这里可以将$c$理解为执行基本操作所需要的时间，$f(n)$为对规模为$n$的输入，需要的操作次数。</strong></p>\n<p>大$\\mathcal O$记号有以下性质：</p>\n<ul>\n<li>对任一常数$c\\gt 0$，有$\\mathcal O (f(n)) = \\mathcal O (c\\cdot f(n))$</li>\n<li>对任意常数$a\\gt b\\gt 0$，有$\\mathcal O (n^a + n^b) = \\mathcal O (n^a)$</li>\n</ul>\n<p>对于上面的性质，可以理解为：<strong>$c$与$n^b$等项都可以通过$n^a$的形式表示</strong>。</p>\n<p>由于在不同的操作系统上，算法中的指令的执行时间不尽相同，因此将$T(n)$定义为算法所执行的基本操作的总次数比较合适。这里的基本操作，在不同的算法下有着不同的内容。</p>\n<p>以起泡排序为例，在每一轮内循环中，需要扫描和比较$n-1$对元素，至多需要交换$n-1$对元素，这里的比较和交换都属于基本操作；外循环最多执行$n-1$次，因此总共需要执行的基本操作不会超过$2(n-1)^2$次，有：$T(n) = \\mathcal O (2(n-1)^2)= \\mathcal O (n^2)$。</p>\n<p>上面的分析意味着，起泡排序在最坏的情况下，其运行时间不会超过$\\mathcal O (n^2)$。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">bubblesort1A</span> <span class=\"params\">( <span class=\"keyword\">int</span> A[], <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//起泡排序算法（版本1A）：0 &lt;= n</span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> sorted = <span class=\"literal\">false</span>; <span class=\"comment\">//整体排序标志，首先假定尚未排序</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ( !sorted ) &#123; <span class=\"comment\">//在尚未确认已全局排序之前，逐趟进行扫描交换</span></span><br><span class=\"line\">       sorted = <span class=\"literal\">true</span>; <span class=\"comment\">//假定已经排序</span></span><br><span class=\"line\">       <span class=\"keyword\">for</span> ( <span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; n; i++ ) &#123; <span class=\"comment\">//自左向右逐对检查当前范围A[0, n)内的各相邻元素</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> ( A[i - <span class=\"number\">1</span>] &gt; A[i] ) &#123; <span class=\"comment\">//一旦A[i - 1]与A[i]逆序，则</span></span><br><span class=\"line\">             <span class=\"built_in\">swap</span> ( A[i - <span class=\"number\">1</span>], A[i] ); <span class=\"comment\">//交换之，并</span></span><br><span class=\"line\">             sorted = <span class=\"literal\">false</span>; <span class=\"comment\">//因整体排序不能保证，需要清除排序标志</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       n--; <span class=\"comment\">//至此末元素必然就位，故可以缩短待排序序列的有效长度</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> &#125; <span class=\"comment\">//借助布尔型标志位sorted，可及时提前退出，而不致总是蛮力地做n - 1趟扫描交换</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"大-Omega-记号\"><a href=\"#大-Omega-记号\" class=\"headerlink\" title=\"大$\\Omega$记号\"></a>大$\\Omega$记号</h5><p>大$\\Omega$记号给出了对算法在最好情况下的复杂度，其定义为：若$T(n)\\ge c\\cdot g(n)$，则认为在$n$足够大之后，$g(n)$给出了$T(n)$的一个渐进下界。此时记$T(n)=\\Omega (g(n))$。</p>\n<p>对于上面给出的起泡排序算法，假设问题的输入为一个长度为$n$的已经完全排序完成的向量，那么该算法仍然需要进行$n-1$次比较来确定排序已经完成，因此其最好渐进时间复杂度为$\\Omega (n)$。</p>\n<h5 id=\"大-Theta-记号\"><a href=\"#大-Theta-记号\" class=\"headerlink\" title=\"大$\\Theta$记号\"></a>大$\\Theta$记号</h5><p>大$\\Theta$记号表示的算法复杂度介于大$\\mathcal O$和大$\\Omega$之间，其定义为：若$c_1\\cdot h(n)\\le T(n) \\le c_2 \\cdot h(n)$，则认为在$n$足够大之后，$h(n)$给出了$T(n)$的一个确界。此时记$T(n) = \\Theta(h(n))$。</p>\n<p>$\\Theta (n)$给出了对算法复杂度的准确估计，算法在实际中的运行时间与其同阶。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-1-1.png\" alt=\"三个不同记号之间的关系\"></p>\n<h3 id=\"空间复杂度\"><a href=\"#空间复杂度\" class=\"headerlink\" title=\"空间复杂度\"></a>空间复杂度</h3><p>空间复杂度衡量了算法所需存储空间（内存）的多少，以上用于衡量时间复杂度的几种渐进记号同样适用于衡量空间复杂度。</p>\n<p>对于空间复杂度，一般不算入原始输入本身所占用的空间，只考虑在算法运行过程中需要的空间。此外，一般在评估算法性能时，我们不必考虑空间复杂度。因为就渐进复杂度的意义来说，任一算法的任何一次运行过程中所消耗的存储空间，都不可能超过其执行基本操作的累积次数。<strong>时间复杂度本身就是空间复杂度的一个天然上界。</strong></p>\n<h2 id=\"几种典型的复杂度层次\"><a href=\"#几种典型的复杂度层次\" class=\"headerlink\" title=\"几种典型的复杂度层次\"></a>几种典型的复杂度层次</h2><h3 id=\"常数-mathcal-O-1\"><a href=\"#常数-mathcal-O-1\" class=\"headerlink\" title=\"常数$\\mathcal O (1)$\"></a>常数$\\mathcal O (1)$</h3><p>在任何情况下，算法仅含有一次或者常数次基本操作，运行时间都为固定的常数，与算法的输入规模无关。这种算法被称为“常数时间复杂度算法”。</p>\n<p>对于仅需要$\\mathcal O (1)$辅助空间的算法，称为“就地算法”。</p>\n<h3 id=\"对数-mathcal-O-logn\"><a href=\"#对数-mathcal-O-logn\" class=\"headerlink\" title=\"对数$\\mathcal O (logn)$\"></a>对数$\\mathcal O (logn)$</h3><p>对数复杂度层次常常出现在每进行一次循环问题的规模就减半的情况下，此时对数的底数为2。一般情况下不会专门给出对数的底数，而只是将其笼统得记为$logn$的形式。</p>\n<p>显然，具有对数复杂度的算法肯定包含循环，循环的次数受到问题输入规模的影响，约等于$logn$。在循环之外，算法当然可能包括其他常数次基本操作，但是算法的执行时间还是主要由循环的次数决定。</p>\n<p>更一般的，凡是运行时间可以表示和度量为$T(n) = \\mathcal O (log^c n)$（$c$为正的常数）的算法，均统称为“对数多项式时间复杂度的算法”。此类算法的效率相对来说也是比较高效的。</p>\n<h3 id=\"线性-mathcal-O-n\"><a href=\"#线性-mathcal-O-n\" class=\"headerlink\" title=\"线性$\\mathcal O (n)$\"></a>线性$\\mathcal O (n)$</h3><p>线性复杂度的算法同样相当常见。比如求n个数的和——对于大多数其他问题亦是如此——需要对输入的每个单元至少访问一次，因此至少需要n轮循环。该算法的运行时间随问题的输入规模增大而线性增大，其效率也还算令人满意。</p>\n<h3 id=\"多项式-mathcal-O-poly-n\"><a href=\"#多项式-mathcal-O-poly-n\" class=\"headerlink\" title=\"多项式$\\mathcal O (poly(n))$\"></a>多项式$\\mathcal O (poly(n))$</h3><p>该类算法的运行时间可以表示为问题输入规模$n$的多项式形式，如前面提到的起泡排序算法，其复杂度为$\\mathcal O (n^2)$。无论多项式中$n$的最高次幂为多少，只要复杂度符合这种形式的算法都可以归入此类，尽管在考虑幂次后他们的复杂度会有天壤之别。</p>\n<p>在实际应用中，具有该复杂度的算法通常是可以忍受的。如果一个问题存在一个复杂度在此范围之内的算法，那么这个问题被称为是<em>可以有效求解的</em>或者<em>易解的</em>，否则称为<em>难解的</em>。</p>\n<h3 id=\"指数-mathcal-O-2-n\"><a href=\"#指数-mathcal-O-2-n\" class=\"headerlink\" title=\"指数$\\mathcal O (2^n)$\"></a>指数$\\mathcal O (2^n)$</h3><p>凡是运行时间可以表示和度量为$T(n) = \\mathcal O (a^n)$ （$a\\gt 1$）形式的算法，均属于指数时间复杂度算法。比如，对于“求一个含有n个元素的集合的所有子集”的问题，它含有$2^n$个子集，因此其复杂度为指数的。</p>\n<p>通常认为，指数复杂度的算法无法真正用于实际问题之中。</p>\n<h3 id=\"关于输入规模的额外讨论\"><a href=\"#关于输入规模的额外讨论\" class=\"headerlink\" title=\"关于输入规模的额外讨论\"></a>关于输入规模的额外讨论</h3><p>考察下面的例子：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">power2BF_I</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//幂函数2^n算法（蛮力迭代版），n &gt;= 0</span></span><br><span class=\"line\">   __int64 pow = <span class=\"number\">1</span>; <span class=\"comment\">//O(1)：累积器初始化为2^0</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; n -- ) <span class=\"comment\">//O(n)：迭代n轮，每轮都</span></span><br><span class=\"line\">      pow &lt;&lt;= <span class=\"number\">1</span>; <span class=\"comment\">//O(1)：将累积器翻倍</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> pow; <span class=\"comment\">//O(1)：返回累积器</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(n) = O(2^r)，r为输入指数n的比特位数</span></span><br></pre></td></tr></table></figure>\n\n<p>该算法的功能是在不超过一位的移位运算下对任意非负整数n，计算$2^n$。一般我们将该算法的时间复杂度认为是$\\mathcal O (n)$的，但是如果将输入n的二进制位数$r = 1 + \\lfloor log_2 n\\rfloor$作为输入规模去考虑的话，则其运行时间为$2^r$。</p>\n<p>从上面的例子可知，对于算法复杂度的界定，都是相对于问题的输入规模而言的。因此对同一个算法，可能得到不同的复杂度分析的结论。严格来说，待计算问题的输入规模应定义为“用于描述输入所需要的空间规模”，也即问题输入所占的内存空间（个人理解这样定义的原因是计算机的基本操作都是基于二进制位进行的）。</p>\n<p>以输入的自然独立体个数n的数值（如待排序元素的个数、待求和的元素个数等）作为基准得出的$\\mathcal O (logn)$与$\\mathcal O (n)$复杂度，被分别称为伪对数的和伪线性的复杂度。<strong>但是一般情况下，我们还是以输入的自然独立体个数n的数值作为分析算法复杂度的基准。</strong></p>\n"},{"title":"DSA-2：递归","date":"2022-03-13T02:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"程序设计的基本知识，众多算法的灵魂。","_content":"\n## 基本概念\n\n递归是函数和过程调用的一种特殊形式，即允许函数进行自我调用。函数的自我（递归）调用过程大致可以概括为：在函数中包含一条或者多条自我调用的语句，待新被调用的函数层层返回后，最终回到起始调用的函数本身。\n\n递归调用相当抽象且简洁，有许多问题都可以准确且简洁地描述为递归形式。比如在操作系统中，文件系统的目录即为递归定义的。具体来说，每个文件系统都有一个顶层目录，其中可以包含若干文件以及下一层的子目录，访问下一层的子目录时就是一个递归的过程。在子目录中还可以有其他子目录，如此递推，直到不含任何下层的子目录。\n\n递归在算法设计中具有重要地位，因此本文将主要介绍递归的不同形式以及递归算法的复杂度分析。\n\n## 线性递归\n\n数组求和问题亦可以使用递归的办法来解。假设有一个数组有n个元素，当n=0时，和为0；否则，和总是为前n-1个元素加上最后一个元素。示例代码如下：\n\n```c++\nint sum ( int A[], int n ) { //数组求和算法（线性递归版）\n   if ( 1 > n ) //平凡情况，递归基\n      return 0; //直接（非递归式）计算\n   else //一般情况\n      return sum ( A, n - 1 ) + A[n - 1]; //递归：前n - 1项之和，再累计第n - 1项\n} //O(1)*递归深度 = O(1)*(n + 1) = O(n)\n```\n\n由之前的分析可以看出，保证递归算法有穷性的基本技巧为：首先判断并处理诸如n=0之类的平凡情况，这种平凡情况被称为**递归基**。\n\n算法`sum()`可能朝着更深一层进行自我调用，且每一递归实例对自身的调用最多一次，因而每一层上最多只有一个实例，各个实例构成一个线性的次序关系，所以称为线性递归。在这种形式中，问题总可以分为两个独立的子问题，其中之一对应于单独的某个元素，故可以直接求解，如代码中的`A[n-1]`；另一个对应于剩余部分且结构与原问题相同，如代码中的`sum(A. n-1)`。\n\n### 减而治之\n\n所谓减而治之的算法策略，就是每进行一次迭代，待求解问题的规模都会缩减一个常数，直到退化为平凡的小问题。减而治之的策略满足有穷性，因为算法迟早将抵达递归基，此时算法的执行终止。线性递归通常都对应于减而治之的算法策略。\n\n### 递归分析\n\n#### 递归跟踪图\n\n递归算法的执行过程可以按如下步骤整理为图的形式：\n\n- 算法的每一个递归实例都表示为一个方框，其中注明了该实例调用的参数\n- 若实例M调用实例N，则在M与N对应的方框之间添加一条有向连线\n\n下图给出了`sum()`算法的执行过程。\n\n![sum(A, n)的递归跟踪图](https://astrobear.top/resource/astroblog/content/dsa-2-1.png)\n\n由图片可看出，算法需要的计算时间等于所有递归实例的创建、执行和销毁所需要的时间总和。递归实例的创建和销毁都由操作系统完成，其时间成本可以近似常数，不会超过递归实例中实质计算步骤所需的时间。将启动递归的语句的执行时间包括进递归实例的创建时间中后，在考虑算法需要的计算时间时只需要统计递归实例中非递归调用所需要的时间。\n\n在`sum()`算法中，共包括判断、返回、累加三个基本操作，并且对于长度为n的输入，其递归深度为n+1（当n=0时还要再进行一次递归调用，抵达递归基）。因此，整个算法的时间复杂度为$\\mathcal O (n)$。\n\n`sum()`算法使用的空间在创建了最后一个递归实例后达到最大，为所有递归实例各自占用空间之和。又因为每个递归实例中只存放常数个数据，因此算法的空间复杂度同样为$\\mathcal O (n)$。\n\n#### 递推方程\n\n递推方程不需要画出具体的调用过程，而是通过对递归模式的数学归纳，导出复杂度定界函数的递推方程（组）及其边界条件，将复杂度分析转化为递归方程（组）的求解。\n\n比如，对于`sum()`来说，其运行时间总是可以表述为：\n\n1. $T(n) = T(n-1) + \\mathcal O (1) = T(n-1) + c_1$，其中$n\\ne 0$且$c_1$为常数\n2. $T(0)=\\mathcal O(1) = c_2$，其中$n = 0$且$c_2$为常数\n\n连立上面两个方程可以解得：$T(n) = c_1 n + c_2 = \\mathcal O (n)$。\n\n### 多递归基\n\n如果某个问题可能出现多种平凡情况，解决该问题对应的递归算法就应当有多个递归基。\n\n#### 隐式递归基\n\n对于有的算法，其递归基不会显式地写在算法中，如下面的算法。它的功能是把数组的元素全部颠倒。\n\n```c++\nvoid reverse ( int* A, int lo, int hi ) { //数组倒置（多递归基递归版）\n   if ( lo < hi ) {\n      swap ( A[lo], A[hi] ); //交换A[lo]和A[hi]\n      reverse ( A, lo + 1, hi - 1 ); //递归倒置A(lo, hi)\n   } //else隐含了两种递归基\n} //O(hi - lo + 1)\n```\n\n在隐式包含的`else`语句中，含有`lo > hi`与`lo = hi`两个递归基，算法运行到此处时便会直接结束。\n\n#### 多向递归\n\n对于有的算法，不但有多个递归基，而且可以有多个递归调用的分支。每一个递归实例虽然可能有多个可能的递归方向，但是只能从中选择其一。因此层次上的递归实例仍然构成一个线性次序关系，依旧属于线性递归。\n\n对于求2的n次幂的问题，一般的方法是要进行n次循环，每循环一次就对待求的数乘2，这种方法的时间复杂度为$\\mathcal O (n)$。\n\n另一种方法是，若n的二进制展开式为$b_1b_2b_3...b_k$，则有：$2^n = (...(((1\\cdot 2^{b_1})^2 \\cdot 2^{b_2})^2 \\cdot 2^{b_3})^2...\\cdot 2^{b_k})$。若n-1的二进制展开式为$b_1b_2b_3...b_{k-1}$，则有：$2^{n_k} = (2^{n_{k-1}})^2 \\cdot 2^{b_k}$。\n\n由此，可以得到：\n\n1. 当$b_k = 1$时，有：$power2(n_k) = (power2(n_{k-1}))^2\\cdot 2$\n2. 当$b_k=0$时，有：$power2(n_k) = (power2(n_{k-1})^2\\cdot 2$\n\n根据上面的递推式，可以得到算法如下：\n\n```c++\ninline __int64 sqr ( __int64 a ) { return a * a; } //平方：若是连续执行，很快就会数值溢出！\n__int64 power2 ( int n ) { //幂函数2^n算法（优化递归版），n >= 0\n   if ( 0 == n ) return 1; //递归基；否则，视n的奇偶分别递归\n   return ( n & 1 ) ? sqr ( power2 ( n >> 1 ) ) << 1 : sqr ( power2 ( n >> 1 ) );\n} //O(logn) = O(r)，r为输入指数n的比特位数\n```\n\n对于输入的参数为奇数或者偶数的两种可能，该算法有两种不同的递归方向。由于递归方向只能二选一，因此仍然属于线性递归。由于输入n的二进制数的位数为$r = 1 + \\lfloor log_2n\\rfloor$，算法最多执行$r + 1$次递归（此时n为奇数），故该算法的时间复杂度为$\\mathcal O (logn) = \\mathcal O (r)$。\n\n### 递归消除\n\n递归调用虽然简洁优雅，但是相比于同一算法的迭代版本，它会因为创建、维护、销毁递归实例而消耗更多的时间和空间。对于某些类型的递归算法，可以将其改写为迭代的形式以提高性能。\n\n#### 尾递归\n\n**在线性递归算法中**，如果递归调用在递归实例中刚好以最后一步操作的形式出现，则称之为尾递归。这种类型的递归算法可以简单地转换为等效的迭代版本。比如对于本文中的`reverse()`算法，就可以将其转换为如下的迭代形式：\n\n```c++\nvoid reverse ( int* A, int lo, int hi ) { //数组倒置（规范整理之后的迭代版）\n   while ( lo < hi ) //用while替换跳转标志和if，完全等效\n      swap ( A[lo++], A[hi--] ); //交换A[lo]和A[hi]，收缩待倒置区间\n} //O(hi - lo + 1)\n```\n\n需要注意的是，递归语句出现在代码的最后一行并不一定就是尾递归。严格来说，只有算法在除递归基外的任一实例都终止于这一调用时，才属于尾递归。换句话说，**算法的最后操作仅为递归调用函数本身，不包括其他操作**。例如，`sum()`算法中的最后一行的代码是递归调用，但是它并不是尾递归。\n\n## 二分递归\n\n### 分而治之\n\n分而治之就是将一个规模较大的问题分解为若干个规模更小的，与原问题本质相同的问题，再利用递归机制分别求解。这种分解过程持续进行，直到问题规模缩减至平凡情况。\n\n### 多路递归与二分递归\n\n在分而治之的策略中，每一个递归实例都有可能做多次递归，因而称为*多路递归*。在多路递归中，通常又是将原问题一分为二，故称之为*二分递归*。\n\n### 数组求和\n\n老生常谈的数组求和问题也可以通过二分递归的模式解决。该算法的思路是：以居中的元素为界将数组一分为二，递归地对子数组分别求和，最后再将子数组之和相加即得到原数组的总和。代码如下：\n\n```c++\nint sum ( int A[], int lo, int hi ) { //数组求和算法（二分递归版，入口为sum(A, 0, n)）\n   if ( hi - lo < 2 ) return A[lo]; //递归基：区间宽度不足2\n   int mi = ( lo + hi ) >> 1; //（否则）均分原区间\n   return sum ( A, lo, mi ) + sum ( A, mi, hi ); //递归求和，然后合计\n} //O(hi - lo)，线性正比于区间的长度\n```\n\n这个算法显然是正确的。下面给出了使用该算法对数组`A`中索引为`[0, 8)`的元素进行求和的递归跟踪图。\n\n![sum(A, 0, 7)的递归跟踪图](https://astrobear.top/resource/astroblog/content/dsa-2-2.png)\n\n由图可知，该算法的递归实例形成了一个二叉树形式的层次结构，沿着这个层次每下降一层，每个递归实例`sum(A, lo, hi)`都分裂为一对更小的实例`sum(A, lo, mi)`与`sum(A, mi+1, hi)`。\n\n为了分析其复杂度，出于方便起见，就考察数组元素$n = 2^m$个时的情形。算法启动后经过$m = \\lceil log_2 n\\rceil$层递归调用，数组区间长度首次缩减为1，到达递归基，在返回后进入另外的一个递归分支。由此可知，该算法的递归深度不会超过$1 + log_2n$（当$n$为二的幂次时，递归深度恰好为$log_2 n$）。由于每个递归实例只需要常数空间，因此除去输入占用的空间外，该算法总共只需要$\\mathcal O (logn)$的附加空间。相比于先前使用线性递归方法的数组求和算法（需要$\\mathcal O (n)$的附加空间），性能有了不小的提升。\n\n在时间复杂度上，由于每个递归实例的计算都需要常数时间，且有$2n - 1$个递归实例，故算法的运行时间为$\\mathcal O (n)$。\n\n### 分而治之的局限性\n\n分而治之策略的消耗主要来自划分子问题与合并子解答两个方面。分治策略的高效性依赖于子问题之间的相互独立。下面给出了一个不宜采用分之策略的反例。\n\n考察求斐波那契数列第`n`项`fib(n)`的问题。斐波那契数列的递归形式的定义为：\n\n- 当$n\\le 1$时，$fib(n) = n$\n- 当$n\\ge 2$时，$fib(n) = fib(n-1) + fib(n-2)$\n\n据此可直接得到求斐波那契数的算法的二分递归版本：\n\n```c++\n__int64 fib ( int n ) { //计算Fibonacci数列的第n项（二分递归版）：O(2^n)\n   return ( 2 > n ) ?\n          ( __int64 ) n //若到达递归基，直接取值\n          : fib ( n - 1 ) + fib ( n - 2 ); //否则，递归计算前两项，其和即为正解\n}\n```\n\n这个算法虽然看上去很美好，实际上它需要运行$\\mathcal O(2^n)$时间才能计算出结果，这是因为在计算过程中出现的递归实例的重复次数过多。\n\n### 消除重复的递归实例\n\n为了消除重复的实例，我们可以用空间换时间：**通过一定的辅助空间，在各子问题求解之后及时记录下其对应的解答**。\n\n具体来说有两种方法：\n\n1. 制表（或记忆）策略：从原问题出发自上而下，每遇到一个子问题就先查验它是否已经计算过，若是则直接提取解答\n2. 动态规划策略：从递归基出发，自下而上递推求出问题的解，最后到达原问题的解\n\n下面的算法使用了制表策略来优化先前求斐波那契数的二分递归算法：\n\n```c++\n__int64 fib ( int n, __int64& prev ) { //计算Fibonacci数列第n项（线性递归版）：入口形式fib(n, prev)\n   if ( 0 == n ) //若到达递归基，则\n      { prev = 1; return 0; } //直接取值：fib(-1) = 1, fib(0) = 0\n   else { //否则\n      __int64 prevPrev; prev = fib ( n - 1, prevPrev ); //递归计算前两项\n      return prevPrev + prev; //其和即为正解\n   }\n} //用辅助变量记录前一项，返回数列的当前项，O(n)\n```\n\n注意`fib()`函数的第二个参数为变量的引用。在到达递归基时，函数的第二行通过引用，将处于递归基的递归实例下一层的递归实例中的`prevPrev`的值设为`1`，该变量即对应的是$fib(-1)$。在其它通常情况下，`prevPrev`对应的即为$fib(n-2)$。该函数在第5行通过引用，在其下一层递归实例中将再下一层的递归实例的返回值传给了当前的递归实例。\n\n该算法结构呈线性递归模式，递归深度正比于输入$n$，共计出现$\\mathcal O (n)$个递归实例（需要$\\mathcal O (n)$的附加空间），累计耗时不超过$\\mathcal O (n)$。\n\n还可以使用动态规划规划算法解决该问题。\n\n在算法抵达递归基之后的返回过程中，每向上返回一层，以下各层解答均不需要继续保留。若将以上逐层返回的过程，等效地视作从递归基出发，按照规模自小到大求解各子问题的过程，即可采用动态规划的策略：\n\n```c++\n__int64 fibI ( int n ) { //计算Fibonacci数列的第n项（迭代版）：O(n)\n   __int64 f = 1, g = 0; //初始化：fib(-1)、fib(0)\n   while ( 0 < n-- ) { g += f; f = g - f; } //依据原始定义，通过n次加法和减法计算fib(n)\n   return g; //返回\n}\n```\n\n该算法使用`f`和`g`保存当前的一对相邻的斐波那契数。代码第三行中`g += f`计算出了$fib(n)$；`f = g - f`计算出了$f(n-1)$，为下一步计算做好了准备。在下一步迭代中，原先的$fib(n)$和$fib(n-1)$分别变成了$fib(n-1)$与$fib(n-2)$，整个算法得以持续进行下去，直到达到问题的原规模（`n`自减至0）。\n\n该算法的时间复杂度为$\\mathcal O (n)$，同时也只需要常数规模的附加空间。\n\n\n\n","source":"_posts/dsa-2.md","raw":"---\ntitle: DSA-2：递归\ndate: 2022-3-13 10:00:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 程序设计的基本知识，众多算法的灵魂。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n## 基本概念\n\n递归是函数和过程调用的一种特殊形式，即允许函数进行自我调用。函数的自我（递归）调用过程大致可以概括为：在函数中包含一条或者多条自我调用的语句，待新被调用的函数层层返回后，最终回到起始调用的函数本身。\n\n递归调用相当抽象且简洁，有许多问题都可以准确且简洁地描述为递归形式。比如在操作系统中，文件系统的目录即为递归定义的。具体来说，每个文件系统都有一个顶层目录，其中可以包含若干文件以及下一层的子目录，访问下一层的子目录时就是一个递归的过程。在子目录中还可以有其他子目录，如此递推，直到不含任何下层的子目录。\n\n递归在算法设计中具有重要地位，因此本文将主要介绍递归的不同形式以及递归算法的复杂度分析。\n\n## 线性递归\n\n数组求和问题亦可以使用递归的办法来解。假设有一个数组有n个元素，当n=0时，和为0；否则，和总是为前n-1个元素加上最后一个元素。示例代码如下：\n\n```c++\nint sum ( int A[], int n ) { //数组求和算法（线性递归版）\n   if ( 1 > n ) //平凡情况，递归基\n      return 0; //直接（非递归式）计算\n   else //一般情况\n      return sum ( A, n - 1 ) + A[n - 1]; //递归：前n - 1项之和，再累计第n - 1项\n} //O(1)*递归深度 = O(1)*(n + 1) = O(n)\n```\n\n由之前的分析可以看出，保证递归算法有穷性的基本技巧为：首先判断并处理诸如n=0之类的平凡情况，这种平凡情况被称为**递归基**。\n\n算法`sum()`可能朝着更深一层进行自我调用，且每一递归实例对自身的调用最多一次，因而每一层上最多只有一个实例，各个实例构成一个线性的次序关系，所以称为线性递归。在这种形式中，问题总可以分为两个独立的子问题，其中之一对应于单独的某个元素，故可以直接求解，如代码中的`A[n-1]`；另一个对应于剩余部分且结构与原问题相同，如代码中的`sum(A. n-1)`。\n\n### 减而治之\n\n所谓减而治之的算法策略，就是每进行一次迭代，待求解问题的规模都会缩减一个常数，直到退化为平凡的小问题。减而治之的策略满足有穷性，因为算法迟早将抵达递归基，此时算法的执行终止。线性递归通常都对应于减而治之的算法策略。\n\n### 递归分析\n\n#### 递归跟踪图\n\n递归算法的执行过程可以按如下步骤整理为图的形式：\n\n- 算法的每一个递归实例都表示为一个方框，其中注明了该实例调用的参数\n- 若实例M调用实例N，则在M与N对应的方框之间添加一条有向连线\n\n下图给出了`sum()`算法的执行过程。\n\n![sum(A, n)的递归跟踪图](https://astrobear.top/resource/astroblog/content/dsa-2-1.png)\n\n由图片可看出，算法需要的计算时间等于所有递归实例的创建、执行和销毁所需要的时间总和。递归实例的创建和销毁都由操作系统完成，其时间成本可以近似常数，不会超过递归实例中实质计算步骤所需的时间。将启动递归的语句的执行时间包括进递归实例的创建时间中后，在考虑算法需要的计算时间时只需要统计递归实例中非递归调用所需要的时间。\n\n在`sum()`算法中，共包括判断、返回、累加三个基本操作，并且对于长度为n的输入，其递归深度为n+1（当n=0时还要再进行一次递归调用，抵达递归基）。因此，整个算法的时间复杂度为$\\mathcal O (n)$。\n\n`sum()`算法使用的空间在创建了最后一个递归实例后达到最大，为所有递归实例各自占用空间之和。又因为每个递归实例中只存放常数个数据，因此算法的空间复杂度同样为$\\mathcal O (n)$。\n\n#### 递推方程\n\n递推方程不需要画出具体的调用过程，而是通过对递归模式的数学归纳，导出复杂度定界函数的递推方程（组）及其边界条件，将复杂度分析转化为递归方程（组）的求解。\n\n比如，对于`sum()`来说，其运行时间总是可以表述为：\n\n1. $T(n) = T(n-1) + \\mathcal O (1) = T(n-1) + c_1$，其中$n\\ne 0$且$c_1$为常数\n2. $T(0)=\\mathcal O(1) = c_2$，其中$n = 0$且$c_2$为常数\n\n连立上面两个方程可以解得：$T(n) = c_1 n + c_2 = \\mathcal O (n)$。\n\n### 多递归基\n\n如果某个问题可能出现多种平凡情况，解决该问题对应的递归算法就应当有多个递归基。\n\n#### 隐式递归基\n\n对于有的算法，其递归基不会显式地写在算法中，如下面的算法。它的功能是把数组的元素全部颠倒。\n\n```c++\nvoid reverse ( int* A, int lo, int hi ) { //数组倒置（多递归基递归版）\n   if ( lo < hi ) {\n      swap ( A[lo], A[hi] ); //交换A[lo]和A[hi]\n      reverse ( A, lo + 1, hi - 1 ); //递归倒置A(lo, hi)\n   } //else隐含了两种递归基\n} //O(hi - lo + 1)\n```\n\n在隐式包含的`else`语句中，含有`lo > hi`与`lo = hi`两个递归基，算法运行到此处时便会直接结束。\n\n#### 多向递归\n\n对于有的算法，不但有多个递归基，而且可以有多个递归调用的分支。每一个递归实例虽然可能有多个可能的递归方向，但是只能从中选择其一。因此层次上的递归实例仍然构成一个线性次序关系，依旧属于线性递归。\n\n对于求2的n次幂的问题，一般的方法是要进行n次循环，每循环一次就对待求的数乘2，这种方法的时间复杂度为$\\mathcal O (n)$。\n\n另一种方法是，若n的二进制展开式为$b_1b_2b_3...b_k$，则有：$2^n = (...(((1\\cdot 2^{b_1})^2 \\cdot 2^{b_2})^2 \\cdot 2^{b_3})^2...\\cdot 2^{b_k})$。若n-1的二进制展开式为$b_1b_2b_3...b_{k-1}$，则有：$2^{n_k} = (2^{n_{k-1}})^2 \\cdot 2^{b_k}$。\n\n由此，可以得到：\n\n1. 当$b_k = 1$时，有：$power2(n_k) = (power2(n_{k-1}))^2\\cdot 2$\n2. 当$b_k=0$时，有：$power2(n_k) = (power2(n_{k-1})^2\\cdot 2$\n\n根据上面的递推式，可以得到算法如下：\n\n```c++\ninline __int64 sqr ( __int64 a ) { return a * a; } //平方：若是连续执行，很快就会数值溢出！\n__int64 power2 ( int n ) { //幂函数2^n算法（优化递归版），n >= 0\n   if ( 0 == n ) return 1; //递归基；否则，视n的奇偶分别递归\n   return ( n & 1 ) ? sqr ( power2 ( n >> 1 ) ) << 1 : sqr ( power2 ( n >> 1 ) );\n} //O(logn) = O(r)，r为输入指数n的比特位数\n```\n\n对于输入的参数为奇数或者偶数的两种可能，该算法有两种不同的递归方向。由于递归方向只能二选一，因此仍然属于线性递归。由于输入n的二进制数的位数为$r = 1 + \\lfloor log_2n\\rfloor$，算法最多执行$r + 1$次递归（此时n为奇数），故该算法的时间复杂度为$\\mathcal O (logn) = \\mathcal O (r)$。\n\n### 递归消除\n\n递归调用虽然简洁优雅，但是相比于同一算法的迭代版本，它会因为创建、维护、销毁递归实例而消耗更多的时间和空间。对于某些类型的递归算法，可以将其改写为迭代的形式以提高性能。\n\n#### 尾递归\n\n**在线性递归算法中**，如果递归调用在递归实例中刚好以最后一步操作的形式出现，则称之为尾递归。这种类型的递归算法可以简单地转换为等效的迭代版本。比如对于本文中的`reverse()`算法，就可以将其转换为如下的迭代形式：\n\n```c++\nvoid reverse ( int* A, int lo, int hi ) { //数组倒置（规范整理之后的迭代版）\n   while ( lo < hi ) //用while替换跳转标志和if，完全等效\n      swap ( A[lo++], A[hi--] ); //交换A[lo]和A[hi]，收缩待倒置区间\n} //O(hi - lo + 1)\n```\n\n需要注意的是，递归语句出现在代码的最后一行并不一定就是尾递归。严格来说，只有算法在除递归基外的任一实例都终止于这一调用时，才属于尾递归。换句话说，**算法的最后操作仅为递归调用函数本身，不包括其他操作**。例如，`sum()`算法中的最后一行的代码是递归调用，但是它并不是尾递归。\n\n## 二分递归\n\n### 分而治之\n\n分而治之就是将一个规模较大的问题分解为若干个规模更小的，与原问题本质相同的问题，再利用递归机制分别求解。这种分解过程持续进行，直到问题规模缩减至平凡情况。\n\n### 多路递归与二分递归\n\n在分而治之的策略中，每一个递归实例都有可能做多次递归，因而称为*多路递归*。在多路递归中，通常又是将原问题一分为二，故称之为*二分递归*。\n\n### 数组求和\n\n老生常谈的数组求和问题也可以通过二分递归的模式解决。该算法的思路是：以居中的元素为界将数组一分为二，递归地对子数组分别求和，最后再将子数组之和相加即得到原数组的总和。代码如下：\n\n```c++\nint sum ( int A[], int lo, int hi ) { //数组求和算法（二分递归版，入口为sum(A, 0, n)）\n   if ( hi - lo < 2 ) return A[lo]; //递归基：区间宽度不足2\n   int mi = ( lo + hi ) >> 1; //（否则）均分原区间\n   return sum ( A, lo, mi ) + sum ( A, mi, hi ); //递归求和，然后合计\n} //O(hi - lo)，线性正比于区间的长度\n```\n\n这个算法显然是正确的。下面给出了使用该算法对数组`A`中索引为`[0, 8)`的元素进行求和的递归跟踪图。\n\n![sum(A, 0, 7)的递归跟踪图](https://astrobear.top/resource/astroblog/content/dsa-2-2.png)\n\n由图可知，该算法的递归实例形成了一个二叉树形式的层次结构，沿着这个层次每下降一层，每个递归实例`sum(A, lo, hi)`都分裂为一对更小的实例`sum(A, lo, mi)`与`sum(A, mi+1, hi)`。\n\n为了分析其复杂度，出于方便起见，就考察数组元素$n = 2^m$个时的情形。算法启动后经过$m = \\lceil log_2 n\\rceil$层递归调用，数组区间长度首次缩减为1，到达递归基，在返回后进入另外的一个递归分支。由此可知，该算法的递归深度不会超过$1 + log_2n$（当$n$为二的幂次时，递归深度恰好为$log_2 n$）。由于每个递归实例只需要常数空间，因此除去输入占用的空间外，该算法总共只需要$\\mathcal O (logn)$的附加空间。相比于先前使用线性递归方法的数组求和算法（需要$\\mathcal O (n)$的附加空间），性能有了不小的提升。\n\n在时间复杂度上，由于每个递归实例的计算都需要常数时间，且有$2n - 1$个递归实例，故算法的运行时间为$\\mathcal O (n)$。\n\n### 分而治之的局限性\n\n分而治之策略的消耗主要来自划分子问题与合并子解答两个方面。分治策略的高效性依赖于子问题之间的相互独立。下面给出了一个不宜采用分之策略的反例。\n\n考察求斐波那契数列第`n`项`fib(n)`的问题。斐波那契数列的递归形式的定义为：\n\n- 当$n\\le 1$时，$fib(n) = n$\n- 当$n\\ge 2$时，$fib(n) = fib(n-1) + fib(n-2)$\n\n据此可直接得到求斐波那契数的算法的二分递归版本：\n\n```c++\n__int64 fib ( int n ) { //计算Fibonacci数列的第n项（二分递归版）：O(2^n)\n   return ( 2 > n ) ?\n          ( __int64 ) n //若到达递归基，直接取值\n          : fib ( n - 1 ) + fib ( n - 2 ); //否则，递归计算前两项，其和即为正解\n}\n```\n\n这个算法虽然看上去很美好，实际上它需要运行$\\mathcal O(2^n)$时间才能计算出结果，这是因为在计算过程中出现的递归实例的重复次数过多。\n\n### 消除重复的递归实例\n\n为了消除重复的实例，我们可以用空间换时间：**通过一定的辅助空间，在各子问题求解之后及时记录下其对应的解答**。\n\n具体来说有两种方法：\n\n1. 制表（或记忆）策略：从原问题出发自上而下，每遇到一个子问题就先查验它是否已经计算过，若是则直接提取解答\n2. 动态规划策略：从递归基出发，自下而上递推求出问题的解，最后到达原问题的解\n\n下面的算法使用了制表策略来优化先前求斐波那契数的二分递归算法：\n\n```c++\n__int64 fib ( int n, __int64& prev ) { //计算Fibonacci数列第n项（线性递归版）：入口形式fib(n, prev)\n   if ( 0 == n ) //若到达递归基，则\n      { prev = 1; return 0; } //直接取值：fib(-1) = 1, fib(0) = 0\n   else { //否则\n      __int64 prevPrev; prev = fib ( n - 1, prevPrev ); //递归计算前两项\n      return prevPrev + prev; //其和即为正解\n   }\n} //用辅助变量记录前一项，返回数列的当前项，O(n)\n```\n\n注意`fib()`函数的第二个参数为变量的引用。在到达递归基时，函数的第二行通过引用，将处于递归基的递归实例下一层的递归实例中的`prevPrev`的值设为`1`，该变量即对应的是$fib(-1)$。在其它通常情况下，`prevPrev`对应的即为$fib(n-2)$。该函数在第5行通过引用，在其下一层递归实例中将再下一层的递归实例的返回值传给了当前的递归实例。\n\n该算法结构呈线性递归模式，递归深度正比于输入$n$，共计出现$\\mathcal O (n)$个递归实例（需要$\\mathcal O (n)$的附加空间），累计耗时不超过$\\mathcal O (n)$。\n\n还可以使用动态规划规划算法解决该问题。\n\n在算法抵达递归基之后的返回过程中，每向上返回一层，以下各层解答均不需要继续保留。若将以上逐层返回的过程，等效地视作从递归基出发，按照规模自小到大求解各子问题的过程，即可采用动态规划的策略：\n\n```c++\n__int64 fibI ( int n ) { //计算Fibonacci数列的第n项（迭代版）：O(n)\n   __int64 f = 1, g = 0; //初始化：fib(-1)、fib(0)\n   while ( 0 < n-- ) { g += f; f = g - f; } //依据原始定义，通过n次加法和减法计算fib(n)\n   return g; //返回\n}\n```\n\n该算法使用`f`和`g`保存当前的一对相邻的斐波那契数。代码第三行中`g += f`计算出了$fib(n)$；`f = g - f`计算出了$f(n-1)$，为下一步计算做好了准备。在下一步迭代中，原先的$fib(n)$和$fib(n-1)$分别变成了$fib(n-1)$与$fib(n-2)$，整个算法得以持续进行下去，直到达到问题的原规模（`n`自减至0）。\n\n该算法的时间复杂度为$\\mathcal O (n)$，同时也只需要常数规模的附加空间。\n\n\n\n","slug":"dsa-2","published":1,"updated":"2022-03-15T16:50:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0500151q397ndt93dj","content":"<h2 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h2><p>递归是函数和过程调用的一种特殊形式，即允许函数进行自我调用。函数的自我（递归）调用过程大致可以概括为：在函数中包含一条或者多条自我调用的语句，待新被调用的函数层层返回后，最终回到起始调用的函数本身。</p>\n<p>递归调用相当抽象且简洁，有许多问题都可以准确且简洁地描述为递归形式。比如在操作系统中，文件系统的目录即为递归定义的。具体来说，每个文件系统都有一个顶层目录，其中可以包含若干文件以及下一层的子目录，访问下一层的子目录时就是一个递归的过程。在子目录中还可以有其他子目录，如此递推，直到不含任何下层的子目录。</p>\n<p>递归在算法设计中具有重要地位，因此本文将主要介绍递归的不同形式以及递归算法的复杂度分析。</p>\n<h2 id=\"线性递归\"><a href=\"#线性递归\" class=\"headerlink\" title=\"线性递归\"></a>线性递归</h2><p>数组求和问题亦可以使用递归的办法来解。假设有一个数组有n个元素，当n=0时，和为0；否则，和总是为前n-1个元素加上最后一个元素。示例代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">sum</span> <span class=\"params\">( <span class=\"keyword\">int</span> A[], <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//数组求和算法（线性递归版）</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( <span class=\"number\">1</span> &gt; n ) <span class=\"comment\">//平凡情况，递归基</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">0</span>; <span class=\"comment\">//直接（非递归式）计算</span></span><br><span class=\"line\">   <span class=\"keyword\">else</span> <span class=\"comment\">//一般情况</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">sum</span> ( A, n - <span class=\"number\">1</span> ) + A[n - <span class=\"number\">1</span>]; <span class=\"comment\">//递归：前n - 1项之和，再累计第n - 1项</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(1)*递归深度 = O(1)*(n + 1) = O(n)</span></span><br></pre></td></tr></table></figure>\n\n<p>由之前的分析可以看出，保证递归算法有穷性的基本技巧为：首先判断并处理诸如n=0之类的平凡情况，这种平凡情况被称为<strong>递归基</strong>。</p>\n<p>算法<code>sum()</code>可能朝着更深一层进行自我调用，且每一递归实例对自身的调用最多一次，因而每一层上最多只有一个实例，各个实例构成一个线性的次序关系，所以称为线性递归。在这种形式中，问题总可以分为两个独立的子问题，其中之一对应于单独的某个元素，故可以直接求解，如代码中的<code>A[n-1]</code>；另一个对应于剩余部分且结构与原问题相同，如代码中的<code>sum(A. n-1)</code>。</p>\n<h3 id=\"减而治之\"><a href=\"#减而治之\" class=\"headerlink\" title=\"减而治之\"></a>减而治之</h3><p>所谓减而治之的算法策略，就是每进行一次迭代，待求解问题的规模都会缩减一个常数，直到退化为平凡的小问题。减而治之的策略满足有穷性，因为算法迟早将抵达递归基，此时算法的执行终止。线性递归通常都对应于减而治之的算法策略。</p>\n<h3 id=\"递归分析\"><a href=\"#递归分析\" class=\"headerlink\" title=\"递归分析\"></a>递归分析</h3><h4 id=\"递归跟踪图\"><a href=\"#递归跟踪图\" class=\"headerlink\" title=\"递归跟踪图\"></a>递归跟踪图</h4><p>递归算法的执行过程可以按如下步骤整理为图的形式：</p>\n<ul>\n<li>算法的每一个递归实例都表示为一个方框，其中注明了该实例调用的参数</li>\n<li>若实例M调用实例N，则在M与N对应的方框之间添加一条有向连线</li>\n</ul>\n<p>下图给出了<code>sum()</code>算法的执行过程。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-2-1.png\" alt=\"sum(A, n)的递归跟踪图\"></p>\n<p>由图片可看出，算法需要的计算时间等于所有递归实例的创建、执行和销毁所需要的时间总和。递归实例的创建和销毁都由操作系统完成，其时间成本可以近似常数，不会超过递归实例中实质计算步骤所需的时间。将启动递归的语句的执行时间包括进递归实例的创建时间中后，在考虑算法需要的计算时间时只需要统计递归实例中非递归调用所需要的时间。</p>\n<p>在<code>sum()</code>算法中，共包括判断、返回、累加三个基本操作，并且对于长度为n的输入，其递归深度为n+1（当n=0时还要再进行一次递归调用，抵达递归基）。因此，整个算法的时间复杂度为$\\mathcal O (n)$。</p>\n<p><code>sum()</code>算法使用的空间在创建了最后一个递归实例后达到最大，为所有递归实例各自占用空间之和。又因为每个递归实例中只存放常数个数据，因此算法的空间复杂度同样为$\\mathcal O (n)$。</p>\n<h4 id=\"递推方程\"><a href=\"#递推方程\" class=\"headerlink\" title=\"递推方程\"></a>递推方程</h4><p>递推方程不需要画出具体的调用过程，而是通过对递归模式的数学归纳，导出复杂度定界函数的递推方程（组）及其边界条件，将复杂度分析转化为递归方程（组）的求解。</p>\n<p>比如，对于<code>sum()</code>来说，其运行时间总是可以表述为：</p>\n<ol>\n<li>$T(n) = T(n-1) + \\mathcal O (1) = T(n-1) + c_1$，其中$n\\ne 0$且$c_1$为常数</li>\n<li>$T(0)=\\mathcal O(1) = c_2$，其中$n = 0$且$c_2$为常数</li>\n</ol>\n<p>连立上面两个方程可以解得：$T(n) = c_1 n + c_2 = \\mathcal O (n)$。</p>\n<h3 id=\"多递归基\"><a href=\"#多递归基\" class=\"headerlink\" title=\"多递归基\"></a>多递归基</h3><p>如果某个问题可能出现多种平凡情况，解决该问题对应的递归算法就应当有多个递归基。</p>\n<h4 id=\"隐式递归基\"><a href=\"#隐式递归基\" class=\"headerlink\" title=\"隐式递归基\"></a>隐式递归基</h4><p>对于有的算法，其递归基不会显式地写在算法中，如下面的算法。它的功能是把数组的元素全部颠倒。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reverse</span> <span class=\"params\">( <span class=\"keyword\">int</span>* A, <span class=\"keyword\">int</span> lo, <span class=\"keyword\">int</span> hi )</span> </span>&#123; <span class=\"comment\">//数组倒置（多递归基递归版）</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( lo &lt; hi ) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">swap</span> ( A[lo], A[hi] ); <span class=\"comment\">//交换A[lo]和A[hi]</span></span><br><span class=\"line\">      <span class=\"built_in\">reverse</span> ( A, lo + <span class=\"number\">1</span>, hi - <span class=\"number\">1</span> ); <span class=\"comment\">//递归倒置A(lo, hi)</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//else隐含了两种递归基</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(hi - lo + 1)</span></span><br></pre></td></tr></table></figure>\n\n<p>在隐式包含的<code>else</code>语句中，含有<code>lo &gt; hi</code>与<code>lo = hi</code>两个递归基，算法运行到此处时便会直接结束。</p>\n<h4 id=\"多向递归\"><a href=\"#多向递归\" class=\"headerlink\" title=\"多向递归\"></a>多向递归</h4><p>对于有的算法，不但有多个递归基，而且可以有多个递归调用的分支。每一个递归实例虽然可能有多个可能的递归方向，但是只能从中选择其一。因此层次上的递归实例仍然构成一个线性次序关系，依旧属于线性递归。</p>\n<p>对于求2的n次幂的问题，一般的方法是要进行n次循环，每循环一次就对待求的数乘2，这种方法的时间复杂度为$\\mathcal O (n)$。</p>\n<p>另一种方法是，若n的二进制展开式为$b_1b_2b_3…b_k$，则有：$2^n = (…(((1\\cdot 2^{b_1})^2 \\cdot 2^{b_2})^2 \\cdot 2^{b_3})^2…\\cdot 2^{b_k})$。若n-1的二进制展开式为$b_1b_2b_3…b_{k-1}$，则有：$2^{n_k} = (2^{n_{k-1}})^2 \\cdot 2^{b_k}$。</p>\n<p>由此，可以得到：</p>\n<ol>\n<li>当$b_k = 1$时，有：$power2(n_k) = (power2(n_{k-1}))^2\\cdot 2$</li>\n<li>当$b_k=0$时，有：$power2(n_k) = (power2(n_{k-1})^2\\cdot 2$</li>\n</ol>\n<p>根据上面的递推式，可以得到算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> __int64 <span class=\"title\">sqr</span> <span class=\"params\">( __int64 a )</span> </span>&#123; <span class=\"keyword\">return</span> a * a; &#125; <span class=\"comment\">//平方：若是连续执行，很快就会数值溢出！</span></span><br><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">power2</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//幂函数2^n算法（优化递归版），n &gt;= 0</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( <span class=\"number\">0</span> == n ) <span class=\"keyword\">return</span> <span class=\"number\">1</span>; <span class=\"comment\">//递归基；否则，视n的奇偶分别递归</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> ( n &amp; <span class=\"number\">1</span> ) ? <span class=\"built_in\">sqr</span> ( <span class=\"built_in\">power2</span> ( n &gt;&gt; <span class=\"number\">1</span> ) ) &lt;&lt; <span class=\"number\">1</span> : <span class=\"built_in\">sqr</span> ( <span class=\"built_in\">power2</span> ( n &gt;&gt; <span class=\"number\">1</span> ) );</span><br><span class=\"line\">&#125; <span class=\"comment\">//O(logn) = O(r)，r为输入指数n的比特位数</span></span><br></pre></td></tr></table></figure>\n\n<p>对于输入的参数为奇数或者偶数的两种可能，该算法有两种不同的递归方向。由于递归方向只能二选一，因此仍然属于线性递归。由于输入n的二进制数的位数为$r = 1 + \\lfloor log_2n\\rfloor$，算法最多执行$r + 1$次递归（此时n为奇数），故该算法的时间复杂度为$\\mathcal O (logn) = \\mathcal O (r)$。</p>\n<h3 id=\"递归消除\"><a href=\"#递归消除\" class=\"headerlink\" title=\"递归消除\"></a>递归消除</h3><p>递归调用虽然简洁优雅，但是相比于同一算法的迭代版本，它会因为创建、维护、销毁递归实例而消耗更多的时间和空间。对于某些类型的递归算法，可以将其改写为迭代的形式以提高性能。</p>\n<h4 id=\"尾递归\"><a href=\"#尾递归\" class=\"headerlink\" title=\"尾递归\"></a>尾递归</h4><p><strong>在线性递归算法中</strong>，如果递归调用在递归实例中刚好以最后一步操作的形式出现，则称之为尾递归。这种类型的递归算法可以简单地转换为等效的迭代版本。比如对于本文中的<code>reverse()</code>算法，就可以将其转换为如下的迭代形式：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reverse</span> <span class=\"params\">( <span class=\"keyword\">int</span>* A, <span class=\"keyword\">int</span> lo, <span class=\"keyword\">int</span> hi )</span> </span>&#123; <span class=\"comment\">//数组倒置（规范整理之后的迭代版）</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( lo &lt; hi ) <span class=\"comment\">//用while替换跳转标志和if，完全等效</span></span><br><span class=\"line\">      <span class=\"built_in\">swap</span> ( A[lo++], A[hi--] ); <span class=\"comment\">//交换A[lo]和A[hi]，收缩待倒置区间</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(hi - lo + 1)</span></span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，递归语句出现在代码的最后一行并不一定就是尾递归。严格来说，只有算法在除递归基外的任一实例都终止于这一调用时，才属于尾递归。换句话说，<strong>算法的最后操作仅为递归调用函数本身，不包括其他操作</strong>。例如，<code>sum()</code>算法中的最后一行的代码是递归调用，但是它并不是尾递归。</p>\n<h2 id=\"二分递归\"><a href=\"#二分递归\" class=\"headerlink\" title=\"二分递归\"></a>二分递归</h2><h3 id=\"分而治之\"><a href=\"#分而治之\" class=\"headerlink\" title=\"分而治之\"></a>分而治之</h3><p>分而治之就是将一个规模较大的问题分解为若干个规模更小的，与原问题本质相同的问题，再利用递归机制分别求解。这种分解过程持续进行，直到问题规模缩减至平凡情况。</p>\n<h3 id=\"多路递归与二分递归\"><a href=\"#多路递归与二分递归\" class=\"headerlink\" title=\"多路递归与二分递归\"></a>多路递归与二分递归</h3><p>在分而治之的策略中，每一个递归实例都有可能做多次递归，因而称为<em>多路递归</em>。在多路递归中，通常又是将原问题一分为二，故称之为<em>二分递归</em>。</p>\n<h3 id=\"数组求和\"><a href=\"#数组求和\" class=\"headerlink\" title=\"数组求和\"></a>数组求和</h3><p>老生常谈的数组求和问题也可以通过二分递归的模式解决。该算法的思路是：以居中的元素为界将数组一分为二，递归地对子数组分别求和，最后再将子数组之和相加即得到原数组的总和。代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">sum</span> <span class=\"params\">( <span class=\"keyword\">int</span> A[], <span class=\"keyword\">int</span> lo, <span class=\"keyword\">int</span> hi )</span> </span>&#123; <span class=\"comment\">//数组求和算法（二分递归版，入口为sum(A, 0, n)）</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( hi - lo &lt; <span class=\"number\">2</span> ) <span class=\"keyword\">return</span> A[lo]; <span class=\"comment\">//递归基：区间宽度不足2</span></span><br><span class=\"line\">   <span class=\"keyword\">int</span> mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//（否则）均分原区间</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"built_in\">sum</span> ( A, lo, mi ) + <span class=\"built_in\">sum</span> ( A, mi, hi ); <span class=\"comment\">//递归求和，然后合计</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(hi - lo)，线性正比于区间的长度</span></span><br></pre></td></tr></table></figure>\n\n<p>这个算法显然是正确的。下面给出了使用该算法对数组<code>A</code>中索引为<code>[0, 8)</code>的元素进行求和的递归跟踪图。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-2-2.png\" alt=\"sum(A, 0, 7)的递归跟踪图\"></p>\n<p>由图可知，该算法的递归实例形成了一个二叉树形式的层次结构，沿着这个层次每下降一层，每个递归实例<code>sum(A, lo, hi)</code>都分裂为一对更小的实例<code>sum(A, lo, mi)</code>与<code>sum(A, mi+1, hi)</code>。</p>\n<p>为了分析其复杂度，出于方便起见，就考察数组元素$n = 2^m$个时的情形。算法启动后经过$m = \\lceil log_2 n\\rceil$层递归调用，数组区间长度首次缩减为1，到达递归基，在返回后进入另外的一个递归分支。由此可知，该算法的递归深度不会超过$1 + log_2n$（当$n$为二的幂次时，递归深度恰好为$log_2 n$）。由于每个递归实例只需要常数空间，因此除去输入占用的空间外，该算法总共只需要$\\mathcal O (logn)$的附加空间。相比于先前使用线性递归方法的数组求和算法（需要$\\mathcal O (n)$的附加空间），性能有了不小的提升。</p>\n<p>在时间复杂度上，由于每个递归实例的计算都需要常数时间，且有$2n - 1$个递归实例，故算法的运行时间为$\\mathcal O (n)$。</p>\n<h3 id=\"分而治之的局限性\"><a href=\"#分而治之的局限性\" class=\"headerlink\" title=\"分而治之的局限性\"></a>分而治之的局限性</h3><p>分而治之策略的消耗主要来自划分子问题与合并子解答两个方面。分治策略的高效性依赖于子问题之间的相互独立。下面给出了一个不宜采用分之策略的反例。</p>\n<p>考察求斐波那契数列第<code>n</code>项<code>fib(n)</code>的问题。斐波那契数列的递归形式的定义为：</p>\n<ul>\n<li>当$n\\le 1$时，$fib(n) = n$</li>\n<li>当$n\\ge 2$时，$fib(n) = fib(n-1) + fib(n-2)$</li>\n</ul>\n<p>据此可直接得到求斐波那契数的算法的二分递归版本：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">fib</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//计算Fibonacci数列的第n项（二分递归版）：O(2^n)</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> ( <span class=\"number\">2</span> &gt; n ) ?</span><br><span class=\"line\">          ( __int64 ) n <span class=\"comment\">//若到达递归基，直接取值</span></span><br><span class=\"line\">          : <span class=\"built_in\">fib</span> ( n - <span class=\"number\">1</span> ) + <span class=\"built_in\">fib</span> ( n - <span class=\"number\">2</span> ); <span class=\"comment\">//否则，递归计算前两项，其和即为正解</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个算法虽然看上去很美好，实际上它需要运行$\\mathcal O(2^n)$时间才能计算出结果，这是因为在计算过程中出现的递归实例的重复次数过多。</p>\n<h3 id=\"消除重复的递归实例\"><a href=\"#消除重复的递归实例\" class=\"headerlink\" title=\"消除重复的递归实例\"></a>消除重复的递归实例</h3><p>为了消除重复的实例，我们可以用空间换时间：<strong>通过一定的辅助空间，在各子问题求解之后及时记录下其对应的解答</strong>。</p>\n<p>具体来说有两种方法：</p>\n<ol>\n<li>制表（或记忆）策略：从原问题出发自上而下，每遇到一个子问题就先查验它是否已经计算过，若是则直接提取解答</li>\n<li>动态规划策略：从递归基出发，自下而上递推求出问题的解，最后到达原问题的解</li>\n</ol>\n<p>下面的算法使用了制表策略来优化先前求斐波那契数的二分递归算法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">fib</span> <span class=\"params\">( <span class=\"keyword\">int</span> n, __int64&amp; prev )</span> </span>&#123; <span class=\"comment\">//计算Fibonacci数列第n项（线性递归版）：入口形式fib(n, prev)</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( <span class=\"number\">0</span> == n ) <span class=\"comment\">//若到达递归基，则</span></span><br><span class=\"line\">      &#123; prev = <span class=\"number\">1</span>; <span class=\"keyword\">return</span> <span class=\"number\">0</span>; &#125; <span class=\"comment\">//直接取值：fib(-1) = 1, fib(0) = 0</span></span><br><span class=\"line\">   <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//否则</span></span><br><span class=\"line\">      __int64 prevPrev; prev = <span class=\"built_in\">fib</span> ( n - <span class=\"number\">1</span>, prevPrev ); <span class=\"comment\">//递归计算前两项</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> prevPrev + prev; <span class=\"comment\">//其和即为正解</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">//用辅助变量记录前一项，返回数列的当前项，O(n)</span></span><br></pre></td></tr></table></figure>\n\n<p>注意<code>fib()</code>函数的第二个参数为变量的引用。在到达递归基时，函数的第二行通过引用，将处于递归基的递归实例下一层的递归实例中的<code>prevPrev</code>的值设为<code>1</code>，该变量即对应的是$fib(-1)$。在其它通常情况下，<code>prevPrev</code>对应的即为$fib(n-2)$。该函数在第5行通过引用，在其下一层递归实例中将再下一层的递归实例的返回值传给了当前的递归实例。</p>\n<p>该算法结构呈线性递归模式，递归深度正比于输入$n$，共计出现$\\mathcal O (n)$个递归实例（需要$\\mathcal O (n)$的附加空间），累计耗时不超过$\\mathcal O (n)$。</p>\n<p>还可以使用动态规划规划算法解决该问题。</p>\n<p>在算法抵达递归基之后的返回过程中，每向上返回一层，以下各层解答均不需要继续保留。若将以上逐层返回的过程，等效地视作从递归基出发，按照规模自小到大求解各子问题的过程，即可采用动态规划的策略：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">fibI</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//计算Fibonacci数列的第n项（迭代版）：O(n)</span></span><br><span class=\"line\">   __int64 f = <span class=\"number\">1</span>, g = <span class=\"number\">0</span>; <span class=\"comment\">//初始化：fib(-1)、fib(0)</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; n-- ) &#123; g += f; f = g - f; &#125; <span class=\"comment\">//依据原始定义，通过n次加法和减法计算fib(n)</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> g; <span class=\"comment\">//返回</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法使用<code>f</code>和<code>g</code>保存当前的一对相邻的斐波那契数。代码第三行中<code>g += f</code>计算出了$fib(n)$；<code>f = g - f</code>计算出了$f(n-1)$，为下一步计算做好了准备。在下一步迭代中，原先的$fib(n)$和$fib(n-1)$分别变成了$fib(n-1)$与$fib(n-2)$，整个算法得以持续进行下去，直到达到问题的原规模（<code>n</code>自减至0）。</p>\n<p>该算法的时间复杂度为$\\mathcal O (n)$，同时也只需要常数规模的附加空间。</p>\n","site":{"data":{}},"more":"<h2 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h2><p>递归是函数和过程调用的一种特殊形式，即允许函数进行自我调用。函数的自我（递归）调用过程大致可以概括为：在函数中包含一条或者多条自我调用的语句，待新被调用的函数层层返回后，最终回到起始调用的函数本身。</p>\n<p>递归调用相当抽象且简洁，有许多问题都可以准确且简洁地描述为递归形式。比如在操作系统中，文件系统的目录即为递归定义的。具体来说，每个文件系统都有一个顶层目录，其中可以包含若干文件以及下一层的子目录，访问下一层的子目录时就是一个递归的过程。在子目录中还可以有其他子目录，如此递推，直到不含任何下层的子目录。</p>\n<p>递归在算法设计中具有重要地位，因此本文将主要介绍递归的不同形式以及递归算法的复杂度分析。</p>\n<h2 id=\"线性递归\"><a href=\"#线性递归\" class=\"headerlink\" title=\"线性递归\"></a>线性递归</h2><p>数组求和问题亦可以使用递归的办法来解。假设有一个数组有n个元素，当n=0时，和为0；否则，和总是为前n-1个元素加上最后一个元素。示例代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">sum</span> <span class=\"params\">( <span class=\"keyword\">int</span> A[], <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//数组求和算法（线性递归版）</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( <span class=\"number\">1</span> &gt; n ) <span class=\"comment\">//平凡情况，递归基</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">0</span>; <span class=\"comment\">//直接（非递归式）计算</span></span><br><span class=\"line\">   <span class=\"keyword\">else</span> <span class=\"comment\">//一般情况</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">sum</span> ( A, n - <span class=\"number\">1</span> ) + A[n - <span class=\"number\">1</span>]; <span class=\"comment\">//递归：前n - 1项之和，再累计第n - 1项</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(1)*递归深度 = O(1)*(n + 1) = O(n)</span></span><br></pre></td></tr></table></figure>\n\n<p>由之前的分析可以看出，保证递归算法有穷性的基本技巧为：首先判断并处理诸如n=0之类的平凡情况，这种平凡情况被称为<strong>递归基</strong>。</p>\n<p>算法<code>sum()</code>可能朝着更深一层进行自我调用，且每一递归实例对自身的调用最多一次，因而每一层上最多只有一个实例，各个实例构成一个线性的次序关系，所以称为线性递归。在这种形式中，问题总可以分为两个独立的子问题，其中之一对应于单独的某个元素，故可以直接求解，如代码中的<code>A[n-1]</code>；另一个对应于剩余部分且结构与原问题相同，如代码中的<code>sum(A. n-1)</code>。</p>\n<h3 id=\"减而治之\"><a href=\"#减而治之\" class=\"headerlink\" title=\"减而治之\"></a>减而治之</h3><p>所谓减而治之的算法策略，就是每进行一次迭代，待求解问题的规模都会缩减一个常数，直到退化为平凡的小问题。减而治之的策略满足有穷性，因为算法迟早将抵达递归基，此时算法的执行终止。线性递归通常都对应于减而治之的算法策略。</p>\n<h3 id=\"递归分析\"><a href=\"#递归分析\" class=\"headerlink\" title=\"递归分析\"></a>递归分析</h3><h4 id=\"递归跟踪图\"><a href=\"#递归跟踪图\" class=\"headerlink\" title=\"递归跟踪图\"></a>递归跟踪图</h4><p>递归算法的执行过程可以按如下步骤整理为图的形式：</p>\n<ul>\n<li>算法的每一个递归实例都表示为一个方框，其中注明了该实例调用的参数</li>\n<li>若实例M调用实例N，则在M与N对应的方框之间添加一条有向连线</li>\n</ul>\n<p>下图给出了<code>sum()</code>算法的执行过程。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-2-1.png\" alt=\"sum(A, n)的递归跟踪图\"></p>\n<p>由图片可看出，算法需要的计算时间等于所有递归实例的创建、执行和销毁所需要的时间总和。递归实例的创建和销毁都由操作系统完成，其时间成本可以近似常数，不会超过递归实例中实质计算步骤所需的时间。将启动递归的语句的执行时间包括进递归实例的创建时间中后，在考虑算法需要的计算时间时只需要统计递归实例中非递归调用所需要的时间。</p>\n<p>在<code>sum()</code>算法中，共包括判断、返回、累加三个基本操作，并且对于长度为n的输入，其递归深度为n+1（当n=0时还要再进行一次递归调用，抵达递归基）。因此，整个算法的时间复杂度为$\\mathcal O (n)$。</p>\n<p><code>sum()</code>算法使用的空间在创建了最后一个递归实例后达到最大，为所有递归实例各自占用空间之和。又因为每个递归实例中只存放常数个数据，因此算法的空间复杂度同样为$\\mathcal O (n)$。</p>\n<h4 id=\"递推方程\"><a href=\"#递推方程\" class=\"headerlink\" title=\"递推方程\"></a>递推方程</h4><p>递推方程不需要画出具体的调用过程，而是通过对递归模式的数学归纳，导出复杂度定界函数的递推方程（组）及其边界条件，将复杂度分析转化为递归方程（组）的求解。</p>\n<p>比如，对于<code>sum()</code>来说，其运行时间总是可以表述为：</p>\n<ol>\n<li>$T(n) = T(n-1) + \\mathcal O (1) = T(n-1) + c_1$，其中$n\\ne 0$且$c_1$为常数</li>\n<li>$T(0)=\\mathcal O(1) = c_2$，其中$n = 0$且$c_2$为常数</li>\n</ol>\n<p>连立上面两个方程可以解得：$T(n) = c_1 n + c_2 = \\mathcal O (n)$。</p>\n<h3 id=\"多递归基\"><a href=\"#多递归基\" class=\"headerlink\" title=\"多递归基\"></a>多递归基</h3><p>如果某个问题可能出现多种平凡情况，解决该问题对应的递归算法就应当有多个递归基。</p>\n<h4 id=\"隐式递归基\"><a href=\"#隐式递归基\" class=\"headerlink\" title=\"隐式递归基\"></a>隐式递归基</h4><p>对于有的算法，其递归基不会显式地写在算法中，如下面的算法。它的功能是把数组的元素全部颠倒。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reverse</span> <span class=\"params\">( <span class=\"keyword\">int</span>* A, <span class=\"keyword\">int</span> lo, <span class=\"keyword\">int</span> hi )</span> </span>&#123; <span class=\"comment\">//数组倒置（多递归基递归版）</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( lo &lt; hi ) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">swap</span> ( A[lo], A[hi] ); <span class=\"comment\">//交换A[lo]和A[hi]</span></span><br><span class=\"line\">      <span class=\"built_in\">reverse</span> ( A, lo + <span class=\"number\">1</span>, hi - <span class=\"number\">1</span> ); <span class=\"comment\">//递归倒置A(lo, hi)</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//else隐含了两种递归基</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(hi - lo + 1)</span></span><br></pre></td></tr></table></figure>\n\n<p>在隐式包含的<code>else</code>语句中，含有<code>lo &gt; hi</code>与<code>lo = hi</code>两个递归基，算法运行到此处时便会直接结束。</p>\n<h4 id=\"多向递归\"><a href=\"#多向递归\" class=\"headerlink\" title=\"多向递归\"></a>多向递归</h4><p>对于有的算法，不但有多个递归基，而且可以有多个递归调用的分支。每一个递归实例虽然可能有多个可能的递归方向，但是只能从中选择其一。因此层次上的递归实例仍然构成一个线性次序关系，依旧属于线性递归。</p>\n<p>对于求2的n次幂的问题，一般的方法是要进行n次循环，每循环一次就对待求的数乘2，这种方法的时间复杂度为$\\mathcal O (n)$。</p>\n<p>另一种方法是，若n的二进制展开式为$b_1b_2b_3…b_k$，则有：$2^n = (…(((1\\cdot 2^{b_1})^2 \\cdot 2^{b_2})^2 \\cdot 2^{b_3})^2…\\cdot 2^{b_k})$。若n-1的二进制展开式为$b_1b_2b_3…b_{k-1}$，则有：$2^{n_k} = (2^{n_{k-1}})^2 \\cdot 2^{b_k}$。</p>\n<p>由此，可以得到：</p>\n<ol>\n<li>当$b_k = 1$时，有：$power2(n_k) = (power2(n_{k-1}))^2\\cdot 2$</li>\n<li>当$b_k=0$时，有：$power2(n_k) = (power2(n_{k-1})^2\\cdot 2$</li>\n</ol>\n<p>根据上面的递推式，可以得到算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> __int64 <span class=\"title\">sqr</span> <span class=\"params\">( __int64 a )</span> </span>&#123; <span class=\"keyword\">return</span> a * a; &#125; <span class=\"comment\">//平方：若是连续执行，很快就会数值溢出！</span></span><br><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">power2</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//幂函数2^n算法（优化递归版），n &gt;= 0</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( <span class=\"number\">0</span> == n ) <span class=\"keyword\">return</span> <span class=\"number\">1</span>; <span class=\"comment\">//递归基；否则，视n的奇偶分别递归</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> ( n &amp; <span class=\"number\">1</span> ) ? <span class=\"built_in\">sqr</span> ( <span class=\"built_in\">power2</span> ( n &gt;&gt; <span class=\"number\">1</span> ) ) &lt;&lt; <span class=\"number\">1</span> : <span class=\"built_in\">sqr</span> ( <span class=\"built_in\">power2</span> ( n &gt;&gt; <span class=\"number\">1</span> ) );</span><br><span class=\"line\">&#125; <span class=\"comment\">//O(logn) = O(r)，r为输入指数n的比特位数</span></span><br></pre></td></tr></table></figure>\n\n<p>对于输入的参数为奇数或者偶数的两种可能，该算法有两种不同的递归方向。由于递归方向只能二选一，因此仍然属于线性递归。由于输入n的二进制数的位数为$r = 1 + \\lfloor log_2n\\rfloor$，算法最多执行$r + 1$次递归（此时n为奇数），故该算法的时间复杂度为$\\mathcal O (logn) = \\mathcal O (r)$。</p>\n<h3 id=\"递归消除\"><a href=\"#递归消除\" class=\"headerlink\" title=\"递归消除\"></a>递归消除</h3><p>递归调用虽然简洁优雅，但是相比于同一算法的迭代版本，它会因为创建、维护、销毁递归实例而消耗更多的时间和空间。对于某些类型的递归算法，可以将其改写为迭代的形式以提高性能。</p>\n<h4 id=\"尾递归\"><a href=\"#尾递归\" class=\"headerlink\" title=\"尾递归\"></a>尾递归</h4><p><strong>在线性递归算法中</strong>，如果递归调用在递归实例中刚好以最后一步操作的形式出现，则称之为尾递归。这种类型的递归算法可以简单地转换为等效的迭代版本。比如对于本文中的<code>reverse()</code>算法，就可以将其转换为如下的迭代形式：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reverse</span> <span class=\"params\">( <span class=\"keyword\">int</span>* A, <span class=\"keyword\">int</span> lo, <span class=\"keyword\">int</span> hi )</span> </span>&#123; <span class=\"comment\">//数组倒置（规范整理之后的迭代版）</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( lo &lt; hi ) <span class=\"comment\">//用while替换跳转标志和if，完全等效</span></span><br><span class=\"line\">      <span class=\"built_in\">swap</span> ( A[lo++], A[hi--] ); <span class=\"comment\">//交换A[lo]和A[hi]，收缩待倒置区间</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(hi - lo + 1)</span></span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，递归语句出现在代码的最后一行并不一定就是尾递归。严格来说，只有算法在除递归基外的任一实例都终止于这一调用时，才属于尾递归。换句话说，<strong>算法的最后操作仅为递归调用函数本身，不包括其他操作</strong>。例如，<code>sum()</code>算法中的最后一行的代码是递归调用，但是它并不是尾递归。</p>\n<h2 id=\"二分递归\"><a href=\"#二分递归\" class=\"headerlink\" title=\"二分递归\"></a>二分递归</h2><h3 id=\"分而治之\"><a href=\"#分而治之\" class=\"headerlink\" title=\"分而治之\"></a>分而治之</h3><p>分而治之就是将一个规模较大的问题分解为若干个规模更小的，与原问题本质相同的问题，再利用递归机制分别求解。这种分解过程持续进行，直到问题规模缩减至平凡情况。</p>\n<h3 id=\"多路递归与二分递归\"><a href=\"#多路递归与二分递归\" class=\"headerlink\" title=\"多路递归与二分递归\"></a>多路递归与二分递归</h3><p>在分而治之的策略中，每一个递归实例都有可能做多次递归，因而称为<em>多路递归</em>。在多路递归中，通常又是将原问题一分为二，故称之为<em>二分递归</em>。</p>\n<h3 id=\"数组求和\"><a href=\"#数组求和\" class=\"headerlink\" title=\"数组求和\"></a>数组求和</h3><p>老生常谈的数组求和问题也可以通过二分递归的模式解决。该算法的思路是：以居中的元素为界将数组一分为二，递归地对子数组分别求和，最后再将子数组之和相加即得到原数组的总和。代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">sum</span> <span class=\"params\">( <span class=\"keyword\">int</span> A[], <span class=\"keyword\">int</span> lo, <span class=\"keyword\">int</span> hi )</span> </span>&#123; <span class=\"comment\">//数组求和算法（二分递归版，入口为sum(A, 0, n)）</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( hi - lo &lt; <span class=\"number\">2</span> ) <span class=\"keyword\">return</span> A[lo]; <span class=\"comment\">//递归基：区间宽度不足2</span></span><br><span class=\"line\">   <span class=\"keyword\">int</span> mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//（否则）均分原区间</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"built_in\">sum</span> ( A, lo, mi ) + <span class=\"built_in\">sum</span> ( A, mi, hi ); <span class=\"comment\">//递归求和，然后合计</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//O(hi - lo)，线性正比于区间的长度</span></span><br></pre></td></tr></table></figure>\n\n<p>这个算法显然是正确的。下面给出了使用该算法对数组<code>A</code>中索引为<code>[0, 8)</code>的元素进行求和的递归跟踪图。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-2-2.png\" alt=\"sum(A, 0, 7)的递归跟踪图\"></p>\n<p>由图可知，该算法的递归实例形成了一个二叉树形式的层次结构，沿着这个层次每下降一层，每个递归实例<code>sum(A, lo, hi)</code>都分裂为一对更小的实例<code>sum(A, lo, mi)</code>与<code>sum(A, mi+1, hi)</code>。</p>\n<p>为了分析其复杂度，出于方便起见，就考察数组元素$n = 2^m$个时的情形。算法启动后经过$m = \\lceil log_2 n\\rceil$层递归调用，数组区间长度首次缩减为1，到达递归基，在返回后进入另外的一个递归分支。由此可知，该算法的递归深度不会超过$1 + log_2n$（当$n$为二的幂次时，递归深度恰好为$log_2 n$）。由于每个递归实例只需要常数空间，因此除去输入占用的空间外，该算法总共只需要$\\mathcal O (logn)$的附加空间。相比于先前使用线性递归方法的数组求和算法（需要$\\mathcal O (n)$的附加空间），性能有了不小的提升。</p>\n<p>在时间复杂度上，由于每个递归实例的计算都需要常数时间，且有$2n - 1$个递归实例，故算法的运行时间为$\\mathcal O (n)$。</p>\n<h3 id=\"分而治之的局限性\"><a href=\"#分而治之的局限性\" class=\"headerlink\" title=\"分而治之的局限性\"></a>分而治之的局限性</h3><p>分而治之策略的消耗主要来自划分子问题与合并子解答两个方面。分治策略的高效性依赖于子问题之间的相互独立。下面给出了一个不宜采用分之策略的反例。</p>\n<p>考察求斐波那契数列第<code>n</code>项<code>fib(n)</code>的问题。斐波那契数列的递归形式的定义为：</p>\n<ul>\n<li>当$n\\le 1$时，$fib(n) = n$</li>\n<li>当$n\\ge 2$时，$fib(n) = fib(n-1) + fib(n-2)$</li>\n</ul>\n<p>据此可直接得到求斐波那契数的算法的二分递归版本：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">fib</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//计算Fibonacci数列的第n项（二分递归版）：O(2^n)</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> ( <span class=\"number\">2</span> &gt; n ) ?</span><br><span class=\"line\">          ( __int64 ) n <span class=\"comment\">//若到达递归基，直接取值</span></span><br><span class=\"line\">          : <span class=\"built_in\">fib</span> ( n - <span class=\"number\">1</span> ) + <span class=\"built_in\">fib</span> ( n - <span class=\"number\">2</span> ); <span class=\"comment\">//否则，递归计算前两项，其和即为正解</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个算法虽然看上去很美好，实际上它需要运行$\\mathcal O(2^n)$时间才能计算出结果，这是因为在计算过程中出现的递归实例的重复次数过多。</p>\n<h3 id=\"消除重复的递归实例\"><a href=\"#消除重复的递归实例\" class=\"headerlink\" title=\"消除重复的递归实例\"></a>消除重复的递归实例</h3><p>为了消除重复的实例，我们可以用空间换时间：<strong>通过一定的辅助空间，在各子问题求解之后及时记录下其对应的解答</strong>。</p>\n<p>具体来说有两种方法：</p>\n<ol>\n<li>制表（或记忆）策略：从原问题出发自上而下，每遇到一个子问题就先查验它是否已经计算过，若是则直接提取解答</li>\n<li>动态规划策略：从递归基出发，自下而上递推求出问题的解，最后到达原问题的解</li>\n</ol>\n<p>下面的算法使用了制表策略来优化先前求斐波那契数的二分递归算法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">fib</span> <span class=\"params\">( <span class=\"keyword\">int</span> n, __int64&amp; prev )</span> </span>&#123; <span class=\"comment\">//计算Fibonacci数列第n项（线性递归版）：入口形式fib(n, prev)</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( <span class=\"number\">0</span> == n ) <span class=\"comment\">//若到达递归基，则</span></span><br><span class=\"line\">      &#123; prev = <span class=\"number\">1</span>; <span class=\"keyword\">return</span> <span class=\"number\">0</span>; &#125; <span class=\"comment\">//直接取值：fib(-1) = 1, fib(0) = 0</span></span><br><span class=\"line\">   <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//否则</span></span><br><span class=\"line\">      __int64 prevPrev; prev = <span class=\"built_in\">fib</span> ( n - <span class=\"number\">1</span>, prevPrev ); <span class=\"comment\">//递归计算前两项</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> prevPrev + prev; <span class=\"comment\">//其和即为正解</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">//用辅助变量记录前一项，返回数列的当前项，O(n)</span></span><br></pre></td></tr></table></figure>\n\n<p>注意<code>fib()</code>函数的第二个参数为变量的引用。在到达递归基时，函数的第二行通过引用，将处于递归基的递归实例下一层的递归实例中的<code>prevPrev</code>的值设为<code>1</code>，该变量即对应的是$fib(-1)$。在其它通常情况下，<code>prevPrev</code>对应的即为$fib(n-2)$。该函数在第5行通过引用，在其下一层递归实例中将再下一层的递归实例的返回值传给了当前的递归实例。</p>\n<p>该算法结构呈线性递归模式，递归深度正比于输入$n$，共计出现$\\mathcal O (n)$个递归实例（需要$\\mathcal O (n)$的附加空间），累计耗时不超过$\\mathcal O (n)$。</p>\n<p>还可以使用动态规划规划算法解决该问题。</p>\n<p>在算法抵达递归基之后的返回过程中，每向上返回一层，以下各层解答均不需要继续保留。若将以上逐层返回的过程，等效地视作从递归基出发，按照规模自小到大求解各子问题的过程，即可采用动态规划的策略：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">__int64 <span class=\"title\">fibI</span> <span class=\"params\">( <span class=\"keyword\">int</span> n )</span> </span>&#123; <span class=\"comment\">//计算Fibonacci数列的第n项（迭代版）：O(n)</span></span><br><span class=\"line\">   __int64 f = <span class=\"number\">1</span>, g = <span class=\"number\">0</span>; <span class=\"comment\">//初始化：fib(-1)、fib(0)</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; n-- ) &#123; g += f; f = g - f; &#125; <span class=\"comment\">//依据原始定义，通过n次加法和减法计算fib(n)</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> g; <span class=\"comment\">//返回</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法使用<code>f</code>和<code>g</code>保存当前的一对相邻的斐波那契数。代码第三行中<code>g += f</code>计算出了$fib(n)$；<code>f = g - f</code>计算出了$f(n-1)$，为下一步计算做好了准备。在下一步迭代中，原先的$fib(n)$和$fib(n-1)$分别变成了$fib(n-1)$与$fib(n-2)$，整个算法得以持续进行下去，直到达到问题的原规模（<code>n</code>自减至0）。</p>\n<p>该算法的时间复杂度为$\\mathcal O (n)$，同时也只需要常数规模的附加空间。</p>\n"},{"title":"DSA-3：向量及其接口设计1","date":"2022-03-17T08:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"正式开始介绍数据结构！","_content":"\n## 数据结构的基本概念\n\n数据结构是数据项的结构化集合，其结构性表现为数据项之间的相互联系及作用，也可以理解为定义于数据项之间的某种逻辑次序。\n\n根据这种逻辑次序的复杂程度，大致可以将各种数据结构划分为*线性结构*、*半线性结构*、*非线性结构*三类。在线性结构中，各个数据项按照一个线性次序构成一个整体。\n\n最基本的线性结构被称为*序列*。根据其中数据项的逻辑次序与其物理存储地址的对应关系不同，又可以将其区分为*向量*和*列表*。向量的所有数据项的物理存放位置与其逻辑次序完全吻合，此时的逻辑次序也被称为*秩*（就是索引或者下标）；而在列表中，逻辑上相邻的数据项在物理上未必相邻，它们的地址只能相互间接确定。\n\n## 从数组到向量\n\n数组是许多元素的一个集合，这些元素具有线性次序。假设它们存放于起始地址为`A`，物理地址连续的一段存储空间，它们的集合就被称作数组`A[]`。数组中的每一个元素都唯一对应一个下标编号，如有`n`个元素的数组，那么它的下标范围是`[0, n)`中的正整数。\n\n### 前驱与后继\n\n对于任何$0\\le i<j<n$，数组`A[]`中的元素`A[i]`都是`A[j]`的*前驱*，`A[j]`都是`A[i]`的*后继*。特别地，对任意$i\\ge 1$，`A[i-1]`都是`A[i]`的*直接前驱*；对任意$i\\le n-2$，`A[i+1]`都是`A[i]`的*直接后继*。\n\n任一元素的所有前驱构成其*前缀*，所有后继构成其*后缀*。\n\n在这一规则下，若数组`A[]`的起始地址为`A`，且每个元素占用`s`个单位的空间，则元素`A[i]`对应的物理地址即为`A + si`。这样的性质可以让我们通过下标这个元素的唯一指代，在常数时间内访问这个元素。\n\n### 向量\n\n向量其实就是数组的一种抽象和泛化，它也是由具有线性次序的一组元素构成的集合，其中的元素分别由秩互相区分。向量中的秩具有与数组中的秩完全一样的特性。例如，若元素`e`的前驱元素共计`r`个，则其秩就是`r`。反过来，通过秩`r`也可以唯一确定元素`e`。这种向量特有的元素访问方式，称作*循秩访问*。\n\n向量的元素与数组中的相比，类型的范围极大地扩大了（即泛化）。向量的元素本身可以是来自于更具一般性的某一类的对象。另外，各个元素也不一定具有数值属性，也即不能保证它们之间能够互相比较大小。\n\n接下来的内容就向量最基本的接口的设计展开讨论，实现了相对应的响亮模板类。此外，下面的章节中通过引入比较器或者重载运算符明确各元素间的大小判断依据，并以此为据认为向量的元素都是可以比较大小的。\n\n## 向量的基本接口\n\n向量对象应该支持如下的操作接口：\n\n|    操作接口    |                           功能                           | 适用对象 |\n| :------------: | :------------------------------------------------------: | :------: |\n|    `size()`    |               报告向量当前规模（元素个数）               |   向量   |\n|    `get(r)`    |                    获取秩为`r`的元素                     |   向量   |\n|   `put(r,e)`   |                用`e`替换秩为`r`的元素的值                |   向量   |\n| `insert(r,e)`  |           把`e`插入秩`r`的位置，原后继依次后移           |   向量   |\n|  `remove(r)`   |       删除秩为`r`的元素，返回该元素中存放的原对象        |   向量   |\n| `disordered()` |             判断所有元素是否已按照非降序排列             |   向量   |\n|    `sort()`    |            调整各元素的位置，使之按非降序排列            |   向量   |\n|   `find(e)`    |                查找等于`e`且秩最大的元素                 |   向量   |\n|  `search(e)`   |       查找目标元素`e`，返回不大于`e`且秩最大的元素       | 有序向量 |\n| `depulicate()` |                       剔除重复元素                       |   向量   |\n|  `uniquify()`  |                       剔除重复元素                       | 有序向量 |\n|  `traverse()`  | 遍历向量并且统一按照给定的函数对象指定的方法处理所有元素 |   向量   |\n\n根据上表的内容，可以设计`Vector`模板类如下所示。\n\n{% codeblock lang:C++ >folded %}\n\nusing Rank = int; //秩\n#define DEFAULT_CAPACITY  3 //默认的初始容量（实际应用中可设置为更大）\n\ntemplate <typename T> class Vector { //向量模板类\nprotected:\n   Rank _size; Rank _capacity;  T* _elem; //规模、容量、数据区\n   void copyFrom ( T const* A, Rank lo, Rank hi ); //复制数组区间A[lo, hi)\n   void expand(); //空间不足时扩容\n   void shrink(); //装填因子过小时压缩\n   bool bubble ( Rank lo, Rank hi ); //扫描交换\n   void bubbleSort ( Rank lo, Rank hi ); //起泡排序算法\n   Rank maxItem ( Rank lo, Rank hi ); //选取最大元素\n   void selectionSort ( Rank lo, Rank hi ); //选择排序算法\n   void merge ( Rank lo, Rank mi, Rank hi ); //归并算法\n   void mergeSort ( Rank lo, Rank hi ); //归并排序算法\n   void heapSort ( Rank lo, Rank hi ); //堆排序（稍后结合完全堆讲解）\n   Rank partition ( Rank lo, Rank hi ); //轴点构造算法\n   void quickSort ( Rank lo, Rank hi ); //快速排序算法\n   void shellSort ( Rank lo, Rank hi ); //希尔排序算法\npublic:\n// 构造函数\n   Vector ( int c = DEFAULT_CAPACITY, Rank s = 0, T v = 0 ) //容量为c、规模为s、所有元素初始为v\n   { _elem = new T[_capacity = c]; for ( _size = 0; _size < s; _elem[_size++] = v ); } //s<=c\n   Vector ( T const* A, Rank n ) { copyFrom ( A, 0, n ); } //数组整体复制\n   Vector ( T const* A, Rank lo, Rank hi ) { copyFrom ( A, lo, hi ); } //区间\n   Vector ( Vector<T> const& V ) { copyFrom ( V._elem, 0, V._size ); } //向量整体复制\n   Vector ( Vector<T> const& V, Rank lo, Rank hi ) { copyFrom ( V._elem, lo, hi ); } //区间\n// 析构函数\n   ~Vector() { delete [] _elem; } //释放内部空间\n// 只读访问接口\n   Rank size() const { return _size; } //规模\n   bool empty() const { return !_size; } //判空\n   Rank find ( T const& e ) const { return find ( e, 0, _size ); } //无序向量整体查找\n   Rank find ( T const& e, Rank lo, Rank hi ) const; //无序向量区间查找\n   Rank search ( T const& e ) const //有序向量整体查找\n   { return ( 0 >= _size ) ? -1 : search ( e, 0, _size ); }\n   Rank search ( T const& e, Rank lo, Rank hi ) const; //有序向量区间查找\n// 可写访问接口\n   T& operator[] ( Rank r ); //重载下标操作符，可以类似于数组形式引用各元素\n   const T& operator[] ( Rank r ) const; //仅限于做右值的重载版本\n   Vector<T> & operator= ( Vector<T> const& ); //重载赋值操作符，以便直接克隆向量\n   T remove ( Rank r ); //删除秩为r的元素\n   int remove ( Rank lo, Rank hi ); //删除秩在区间[lo, hi)之内的元素\n   Rank insert ( Rank r, T const& e ); //插入元素\n   Rank insert ( T const& e ) { return insert ( _size, e ); } //默认作为末元素插入\n   void sort ( Rank lo, Rank hi ); //对[lo, hi)排序\n   void sort() { sort ( 0, _size ); } //整体排序\n   void unsort ( Rank lo, Rank hi ); //对[lo, hi)置乱\n   void unsort() { unsort ( 0, _size ); } //整体置乱\n   Rank deduplicate(); //无序去重\n   Rank uniquify(); //有序去重\n// 遍历\n   void traverse ( void (* ) ( T& ) ); //遍历（使用函数指针，只读或局部性修改）\n   template <typename VST> void traverse ( VST& ); //遍历（使用函数对象，可全局性修改）\n}; //Vector\n\n{% endcodeblock %}\n\n这里使用了模板编程，可以提高向量中元素的数据结构选用的灵活性和运行效率。\n\n## 构造与析构\n\n观察上面的代码可以知道，向量模板类中的私有数组`_elem[]`用来存储向量中实际的元素；其容量（`_elem[]`中元素的个数，其中可能有空元素）由私有变量`_capacity`指示；其有效元素的数量（向量的规模）由`_size`指示。此外规定，向量中秩为`r`的元素，对应于内部数组中的`_elem[r]`，其物理地址为`_elem + r`。\n\n### 默认构造函数\n\n首先根据创建者指定的初始容量`c`向操作系统申请为`_elem[]`分配容量为`c`的空间，如果没有明确指定，则使用`DEFAULT_CAPACITY`。然后，由于新创建的向量中不包含任何元素，所以在未明确指定的情形下，把向量的规模`_size`设为0。最后，对`_elem[]`中的元素用`v`进行初始化。\n\n### 复制构造函数\n\n复制构造方法以某个已有的向量或数组作为蓝本，进行局部或者整体的克隆。在向量接口类中，有四个复制构造函数，它们均使用了`copyForm()`方法。[该函数](https://dsa.cs.tsinghua.edu.cn/~deng/ds/src_link/vector/vector_constructor_by_copying.h.htm)首先根据待复制区间的边界计算出新向量的初始规模，再以初始规模的两倍为`_elem[]`申请空间。最后通过一趟迭代将源向量（数组）中指定范围内的各个元素复制到新向量中。\n\n注意，由于向量中的元素可能不是内置类型，因此这里有必要重载`operator=`操作符以适应自定义类型可能需要进行的赋值操作。重载的`operator=`操作符应当返回对当前（接受赋值）的对象的引用，以便于链式赋值。\n\n复制构造函数的运行时间正比于区间的宽度，其时间复杂度为$\\mathcal O (\\rm{\\underline{ } size})$。\n\n### 析构函数\n\n向量对象的析构函数只需要释放`_elem[]`的空间即可，因为只有它是由`new`申请出来的。\n\n## 动态空间管理\n\n使用数组来存储向量的元素有一个缺点：向量内部数组的容量是固定的，如果在数组填满之后向量还需要插入元素，那么就会造成溢出（上溢）。因此，可以考虑根据向量的规模动态地调整其容量。这里引入*装填因子*的概念：向量实际规模与其内部数组容量的比值，也即`_size/_capacity`，它是衡量向量空间利用率的重要指标。\n\n为了实现动态空间管理，需要保证**向量的装填因子既不超过1，又不太接近于0**。\n\n### 可扩充向量\n\n扩充向量的原理很简单：如果内部仍有空余，那么插入操作可以正常进行，经过一次插入（删除）操作之后，可用空间都会减少（增加）一个单元。一旦可用空间耗尽，就动态地扩大内部数组的容量。\n\n具体到操作方法上，由于数组的大小在初始化时就已经确定并且之后不可以进行更改，所以我们在扩充向量时需要重新申请一个容量更大的数组，并将原数组中的成员集体搬迁至新的空间，然后再将原数组释放掉。\n\n基于以上策略，可以设计算法`expand()`。在调用`insert()`接口插入新元素之前，都要先调用该算法来检查内部数组的可用容量。一旦`_size == _capacity`，就将原数组替换为一个更大的数组。\n\n```c++\ntemplate <typename T> void Vector<T>::expand() { //向量空间不足时扩容\n   if ( _size < _capacity ) return; //尚未满员时，不必扩容\n   if ( _capacity < DEFAULT_CAPACITY ) _capacity = DEFAULT_CAPACITY; //不低于最小容量\n   T* oldElem = _elem;  _elem = new T[_capacity <<= 1]; //容量加倍\n   for ( Rank i = 0; i < _size; i++ )\n      _elem[i] = oldElem[i]; //复制原向量内容（T为基本类型，或已重载赋值操作符'='）\n   delete [] oldElem; //释放原空间\n}\n```\n\n#### 复杂度分析\n\n向量每次由`n`扩容至`2n`，都需要花费$\\mathcal O (n)$时间。在扩容后，至少还需要`n`次插入操作才需要再次扩容。也就是说，随着向量规模的不断扩大，在执行插入操作之前需要扩容的概率也会迅速降低。因此就某种平均意义来说，用于扩容的时间成本不至于很高。\n\n考查对向量足够多次的连续操作，将其所消耗的时间分摊至所有的操作上，这样分摊平均至单次操作的时间成本被称为*分摊运行时间*。\n\n*平均运行时间*的概念看似与分摊运行时间一样，实则有很大区别。平均运行时间是按照某种假定的概率分布，对各种（输入）情况下所需要的执行时间的加权平均，因此亦称作期望运行时间。而对于分摊运行时间来说，参与分摊的操作应当来自一个真实可行的、足够长的确定的操作序列。\n\n接下来使用分摊分析的方法来分析向量插入操作的复杂度。\n\n假定的`_elem[]`的初始容量和初始规模均为某一常数`N`。假设在此后需要连续进行`n`次操作，并且`n`远大于`N`。因此，在连续插入`n`个元素后，向量的规模`_size`应该变成`n + N`。根据向量扩充的策略，装填因子绝对不会超过100%，同时也不会低于50%。因此，在连续插入`n`个元素后，有下面的关系$\\rm{\\underline{ }size}\\le\\rm{\\underline{ } capacity}<2\\cdot\\rm{\\underline{ } size}$。\n\n于是有：$\\rm{\\underline{ } capacity} = \\Theta(\\rm{\\underline{ } size}) = \\Theta(n + N) = \\Theta(n)$。\n\n向量的容量以2为比例按指数速度增长，在容量到达`_capacity`前，共做过$\\Theta(\\log_2n)$次扩容，每次扩容所需要的时间正比于向量当时的规模，并且同样以2为比例按指数速度增长。因此消耗于扩容的时间为：$\\rm T(n)=2N + 4N + ... + \\underline{ } capacity < 2\\cdot \\underline{ } capacity = \\Theta(n)$。分摊到每次操作上，单次操作所需要的运行时间应为$\\mathcal O (1)$。\n\n### 向量的缩容\n\n除了插入操作之外，影响向量的装填因子的另一因素就是删除操作。如果向量中的删除操作远多于插入操作，那么向量的装填因子很有可能远低于100%。当装填因子小于某个阈值时，称数组发生了*下溢*。\n\n尽管下溢不是必须要解决的问题，但是它对空间利用率还是有着负面的影响。下面的代码给出了向量的动态缩容算法：\n\n```c++\ntemplate <typename T> void Vector<T>::shrink() { //装填因子过小时压缩向量所占空间\n   if ( _capacity < DEFAULT_CAPACITY << 1 ) return; //不致收缩到DEFAULT_CAPACITY以下\n   if ( _size << 2 > _capacity ) return; //以25%为界\n   T* oldElem = _elem;  _elem = new T[_capacity >>= 1]; //容量减半\n   for ( Rank i = 0; i < _size; i++ ) _elem[i] = oldElem[i]; //复制原向量内容\n   delete [] oldElem; //释放原空间\n}\n```\n\n缩容算法的策略很简单：每次进行删除操作以后，如果算法的空间利用率降低到25%以下，就将容量减半。缩容算法的分摊复杂度同样为$\\mathcal O (1)$。\n\n在实际应用中，为了避免出现频繁交替扩容和缩容的情况，可以选择更低的阈值，或者直接禁止缩容。\n\n尽管在分摊意义上向量的扩容和缩容操作效率很高，但是对某次具体的扩容或者缩容操作来说，其需要的时间的确会高达$\\Omega (n)$。因此，在对单次操作速度及其敏感的应用场合上不能继续沿用上面的策略。\n","source":"_posts/dsa-3.md","raw":"---\ntitle: DSA-3：向量及其接口设计1\ndate: 2022-03-17 16:00:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 正式开始介绍数据结构！\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n## 数据结构的基本概念\n\n数据结构是数据项的结构化集合，其结构性表现为数据项之间的相互联系及作用，也可以理解为定义于数据项之间的某种逻辑次序。\n\n根据这种逻辑次序的复杂程度，大致可以将各种数据结构划分为*线性结构*、*半线性结构*、*非线性结构*三类。在线性结构中，各个数据项按照一个线性次序构成一个整体。\n\n最基本的线性结构被称为*序列*。根据其中数据项的逻辑次序与其物理存储地址的对应关系不同，又可以将其区分为*向量*和*列表*。向量的所有数据项的物理存放位置与其逻辑次序完全吻合，此时的逻辑次序也被称为*秩*（就是索引或者下标）；而在列表中，逻辑上相邻的数据项在物理上未必相邻，它们的地址只能相互间接确定。\n\n## 从数组到向量\n\n数组是许多元素的一个集合，这些元素具有线性次序。假设它们存放于起始地址为`A`，物理地址连续的一段存储空间，它们的集合就被称作数组`A[]`。数组中的每一个元素都唯一对应一个下标编号，如有`n`个元素的数组，那么它的下标范围是`[0, n)`中的正整数。\n\n### 前驱与后继\n\n对于任何$0\\le i<j<n$，数组`A[]`中的元素`A[i]`都是`A[j]`的*前驱*，`A[j]`都是`A[i]`的*后继*。特别地，对任意$i\\ge 1$，`A[i-1]`都是`A[i]`的*直接前驱*；对任意$i\\le n-2$，`A[i+1]`都是`A[i]`的*直接后继*。\n\n任一元素的所有前驱构成其*前缀*，所有后继构成其*后缀*。\n\n在这一规则下，若数组`A[]`的起始地址为`A`，且每个元素占用`s`个单位的空间，则元素`A[i]`对应的物理地址即为`A + si`。这样的性质可以让我们通过下标这个元素的唯一指代，在常数时间内访问这个元素。\n\n### 向量\n\n向量其实就是数组的一种抽象和泛化，它也是由具有线性次序的一组元素构成的集合，其中的元素分别由秩互相区分。向量中的秩具有与数组中的秩完全一样的特性。例如，若元素`e`的前驱元素共计`r`个，则其秩就是`r`。反过来，通过秩`r`也可以唯一确定元素`e`。这种向量特有的元素访问方式，称作*循秩访问*。\n\n向量的元素与数组中的相比，类型的范围极大地扩大了（即泛化）。向量的元素本身可以是来自于更具一般性的某一类的对象。另外，各个元素也不一定具有数值属性，也即不能保证它们之间能够互相比较大小。\n\n接下来的内容就向量最基本的接口的设计展开讨论，实现了相对应的响亮模板类。此外，下面的章节中通过引入比较器或者重载运算符明确各元素间的大小判断依据，并以此为据认为向量的元素都是可以比较大小的。\n\n## 向量的基本接口\n\n向量对象应该支持如下的操作接口：\n\n|    操作接口    |                           功能                           | 适用对象 |\n| :------------: | :------------------------------------------------------: | :------: |\n|    `size()`    |               报告向量当前规模（元素个数）               |   向量   |\n|    `get(r)`    |                    获取秩为`r`的元素                     |   向量   |\n|   `put(r,e)`   |                用`e`替换秩为`r`的元素的值                |   向量   |\n| `insert(r,e)`  |           把`e`插入秩`r`的位置，原后继依次后移           |   向量   |\n|  `remove(r)`   |       删除秩为`r`的元素，返回该元素中存放的原对象        |   向量   |\n| `disordered()` |             判断所有元素是否已按照非降序排列             |   向量   |\n|    `sort()`    |            调整各元素的位置，使之按非降序排列            |   向量   |\n|   `find(e)`    |                查找等于`e`且秩最大的元素                 |   向量   |\n|  `search(e)`   |       查找目标元素`e`，返回不大于`e`且秩最大的元素       | 有序向量 |\n| `depulicate()` |                       剔除重复元素                       |   向量   |\n|  `uniquify()`  |                       剔除重复元素                       | 有序向量 |\n|  `traverse()`  | 遍历向量并且统一按照给定的函数对象指定的方法处理所有元素 |   向量   |\n\n根据上表的内容，可以设计`Vector`模板类如下所示。\n\n{% codeblock lang:C++ >folded %}\n\nusing Rank = int; //秩\n#define DEFAULT_CAPACITY  3 //默认的初始容量（实际应用中可设置为更大）\n\ntemplate <typename T> class Vector { //向量模板类\nprotected:\n   Rank _size; Rank _capacity;  T* _elem; //规模、容量、数据区\n   void copyFrom ( T const* A, Rank lo, Rank hi ); //复制数组区间A[lo, hi)\n   void expand(); //空间不足时扩容\n   void shrink(); //装填因子过小时压缩\n   bool bubble ( Rank lo, Rank hi ); //扫描交换\n   void bubbleSort ( Rank lo, Rank hi ); //起泡排序算法\n   Rank maxItem ( Rank lo, Rank hi ); //选取最大元素\n   void selectionSort ( Rank lo, Rank hi ); //选择排序算法\n   void merge ( Rank lo, Rank mi, Rank hi ); //归并算法\n   void mergeSort ( Rank lo, Rank hi ); //归并排序算法\n   void heapSort ( Rank lo, Rank hi ); //堆排序（稍后结合完全堆讲解）\n   Rank partition ( Rank lo, Rank hi ); //轴点构造算法\n   void quickSort ( Rank lo, Rank hi ); //快速排序算法\n   void shellSort ( Rank lo, Rank hi ); //希尔排序算法\npublic:\n// 构造函数\n   Vector ( int c = DEFAULT_CAPACITY, Rank s = 0, T v = 0 ) //容量为c、规模为s、所有元素初始为v\n   { _elem = new T[_capacity = c]; for ( _size = 0; _size < s; _elem[_size++] = v ); } //s<=c\n   Vector ( T const* A, Rank n ) { copyFrom ( A, 0, n ); } //数组整体复制\n   Vector ( T const* A, Rank lo, Rank hi ) { copyFrom ( A, lo, hi ); } //区间\n   Vector ( Vector<T> const& V ) { copyFrom ( V._elem, 0, V._size ); } //向量整体复制\n   Vector ( Vector<T> const& V, Rank lo, Rank hi ) { copyFrom ( V._elem, lo, hi ); } //区间\n// 析构函数\n   ~Vector() { delete [] _elem; } //释放内部空间\n// 只读访问接口\n   Rank size() const { return _size; } //规模\n   bool empty() const { return !_size; } //判空\n   Rank find ( T const& e ) const { return find ( e, 0, _size ); } //无序向量整体查找\n   Rank find ( T const& e, Rank lo, Rank hi ) const; //无序向量区间查找\n   Rank search ( T const& e ) const //有序向量整体查找\n   { return ( 0 >= _size ) ? -1 : search ( e, 0, _size ); }\n   Rank search ( T const& e, Rank lo, Rank hi ) const; //有序向量区间查找\n// 可写访问接口\n   T& operator[] ( Rank r ); //重载下标操作符，可以类似于数组形式引用各元素\n   const T& operator[] ( Rank r ) const; //仅限于做右值的重载版本\n   Vector<T> & operator= ( Vector<T> const& ); //重载赋值操作符，以便直接克隆向量\n   T remove ( Rank r ); //删除秩为r的元素\n   int remove ( Rank lo, Rank hi ); //删除秩在区间[lo, hi)之内的元素\n   Rank insert ( Rank r, T const& e ); //插入元素\n   Rank insert ( T const& e ) { return insert ( _size, e ); } //默认作为末元素插入\n   void sort ( Rank lo, Rank hi ); //对[lo, hi)排序\n   void sort() { sort ( 0, _size ); } //整体排序\n   void unsort ( Rank lo, Rank hi ); //对[lo, hi)置乱\n   void unsort() { unsort ( 0, _size ); } //整体置乱\n   Rank deduplicate(); //无序去重\n   Rank uniquify(); //有序去重\n// 遍历\n   void traverse ( void (* ) ( T& ) ); //遍历（使用函数指针，只读或局部性修改）\n   template <typename VST> void traverse ( VST& ); //遍历（使用函数对象，可全局性修改）\n}; //Vector\n\n{% endcodeblock %}\n\n这里使用了模板编程，可以提高向量中元素的数据结构选用的灵活性和运行效率。\n\n## 构造与析构\n\n观察上面的代码可以知道，向量模板类中的私有数组`_elem[]`用来存储向量中实际的元素；其容量（`_elem[]`中元素的个数，其中可能有空元素）由私有变量`_capacity`指示；其有效元素的数量（向量的规模）由`_size`指示。此外规定，向量中秩为`r`的元素，对应于内部数组中的`_elem[r]`，其物理地址为`_elem + r`。\n\n### 默认构造函数\n\n首先根据创建者指定的初始容量`c`向操作系统申请为`_elem[]`分配容量为`c`的空间，如果没有明确指定，则使用`DEFAULT_CAPACITY`。然后，由于新创建的向量中不包含任何元素，所以在未明确指定的情形下，把向量的规模`_size`设为0。最后，对`_elem[]`中的元素用`v`进行初始化。\n\n### 复制构造函数\n\n复制构造方法以某个已有的向量或数组作为蓝本，进行局部或者整体的克隆。在向量接口类中，有四个复制构造函数，它们均使用了`copyForm()`方法。[该函数](https://dsa.cs.tsinghua.edu.cn/~deng/ds/src_link/vector/vector_constructor_by_copying.h.htm)首先根据待复制区间的边界计算出新向量的初始规模，再以初始规模的两倍为`_elem[]`申请空间。最后通过一趟迭代将源向量（数组）中指定范围内的各个元素复制到新向量中。\n\n注意，由于向量中的元素可能不是内置类型，因此这里有必要重载`operator=`操作符以适应自定义类型可能需要进行的赋值操作。重载的`operator=`操作符应当返回对当前（接受赋值）的对象的引用，以便于链式赋值。\n\n复制构造函数的运行时间正比于区间的宽度，其时间复杂度为$\\mathcal O (\\rm{\\underline{ } size})$。\n\n### 析构函数\n\n向量对象的析构函数只需要释放`_elem[]`的空间即可，因为只有它是由`new`申请出来的。\n\n## 动态空间管理\n\n使用数组来存储向量的元素有一个缺点：向量内部数组的容量是固定的，如果在数组填满之后向量还需要插入元素，那么就会造成溢出（上溢）。因此，可以考虑根据向量的规模动态地调整其容量。这里引入*装填因子*的概念：向量实际规模与其内部数组容量的比值，也即`_size/_capacity`，它是衡量向量空间利用率的重要指标。\n\n为了实现动态空间管理，需要保证**向量的装填因子既不超过1，又不太接近于0**。\n\n### 可扩充向量\n\n扩充向量的原理很简单：如果内部仍有空余，那么插入操作可以正常进行，经过一次插入（删除）操作之后，可用空间都会减少（增加）一个单元。一旦可用空间耗尽，就动态地扩大内部数组的容量。\n\n具体到操作方法上，由于数组的大小在初始化时就已经确定并且之后不可以进行更改，所以我们在扩充向量时需要重新申请一个容量更大的数组，并将原数组中的成员集体搬迁至新的空间，然后再将原数组释放掉。\n\n基于以上策略，可以设计算法`expand()`。在调用`insert()`接口插入新元素之前，都要先调用该算法来检查内部数组的可用容量。一旦`_size == _capacity`，就将原数组替换为一个更大的数组。\n\n```c++\ntemplate <typename T> void Vector<T>::expand() { //向量空间不足时扩容\n   if ( _size < _capacity ) return; //尚未满员时，不必扩容\n   if ( _capacity < DEFAULT_CAPACITY ) _capacity = DEFAULT_CAPACITY; //不低于最小容量\n   T* oldElem = _elem;  _elem = new T[_capacity <<= 1]; //容量加倍\n   for ( Rank i = 0; i < _size; i++ )\n      _elem[i] = oldElem[i]; //复制原向量内容（T为基本类型，或已重载赋值操作符'='）\n   delete [] oldElem; //释放原空间\n}\n```\n\n#### 复杂度分析\n\n向量每次由`n`扩容至`2n`，都需要花费$\\mathcal O (n)$时间。在扩容后，至少还需要`n`次插入操作才需要再次扩容。也就是说，随着向量规模的不断扩大，在执行插入操作之前需要扩容的概率也会迅速降低。因此就某种平均意义来说，用于扩容的时间成本不至于很高。\n\n考查对向量足够多次的连续操作，将其所消耗的时间分摊至所有的操作上，这样分摊平均至单次操作的时间成本被称为*分摊运行时间*。\n\n*平均运行时间*的概念看似与分摊运行时间一样，实则有很大区别。平均运行时间是按照某种假定的概率分布，对各种（输入）情况下所需要的执行时间的加权平均，因此亦称作期望运行时间。而对于分摊运行时间来说，参与分摊的操作应当来自一个真实可行的、足够长的确定的操作序列。\n\n接下来使用分摊分析的方法来分析向量插入操作的复杂度。\n\n假定的`_elem[]`的初始容量和初始规模均为某一常数`N`。假设在此后需要连续进行`n`次操作，并且`n`远大于`N`。因此，在连续插入`n`个元素后，向量的规模`_size`应该变成`n + N`。根据向量扩充的策略，装填因子绝对不会超过100%，同时也不会低于50%。因此，在连续插入`n`个元素后，有下面的关系$\\rm{\\underline{ }size}\\le\\rm{\\underline{ } capacity}<2\\cdot\\rm{\\underline{ } size}$。\n\n于是有：$\\rm{\\underline{ } capacity} = \\Theta(\\rm{\\underline{ } size}) = \\Theta(n + N) = \\Theta(n)$。\n\n向量的容量以2为比例按指数速度增长，在容量到达`_capacity`前，共做过$\\Theta(\\log_2n)$次扩容，每次扩容所需要的时间正比于向量当时的规模，并且同样以2为比例按指数速度增长。因此消耗于扩容的时间为：$\\rm T(n)=2N + 4N + ... + \\underline{ } capacity < 2\\cdot \\underline{ } capacity = \\Theta(n)$。分摊到每次操作上，单次操作所需要的运行时间应为$\\mathcal O (1)$。\n\n### 向量的缩容\n\n除了插入操作之外，影响向量的装填因子的另一因素就是删除操作。如果向量中的删除操作远多于插入操作，那么向量的装填因子很有可能远低于100%。当装填因子小于某个阈值时，称数组发生了*下溢*。\n\n尽管下溢不是必须要解决的问题，但是它对空间利用率还是有着负面的影响。下面的代码给出了向量的动态缩容算法：\n\n```c++\ntemplate <typename T> void Vector<T>::shrink() { //装填因子过小时压缩向量所占空间\n   if ( _capacity < DEFAULT_CAPACITY << 1 ) return; //不致收缩到DEFAULT_CAPACITY以下\n   if ( _size << 2 > _capacity ) return; //以25%为界\n   T* oldElem = _elem;  _elem = new T[_capacity >>= 1]; //容量减半\n   for ( Rank i = 0; i < _size; i++ ) _elem[i] = oldElem[i]; //复制原向量内容\n   delete [] oldElem; //释放原空间\n}\n```\n\n缩容算法的策略很简单：每次进行删除操作以后，如果算法的空间利用率降低到25%以下，就将容量减半。缩容算法的分摊复杂度同样为$\\mathcal O (1)$。\n\n在实际应用中，为了避免出现频繁交替扩容和缩容的情况，可以选择更低的阈值，或者直接禁止缩容。\n\n尽管在分摊意义上向量的扩容和缩容操作效率很高，但是对某次具体的扩容或者缩容操作来说，其需要的时间的确会高达$\\Omega (n)$。因此，在对单次操作速度及其敏感的应用场合上不能继续沿用上面的策略。\n","slug":"dsa-3","published":1,"updated":"2022-03-19T10:23:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0600181q39gybv6j8h","content":"<h2 id=\"数据结构的基本概念\"><a href=\"#数据结构的基本概念\" class=\"headerlink\" title=\"数据结构的基本概念\"></a>数据结构的基本概念</h2><p>数据结构是数据项的结构化集合，其结构性表现为数据项之间的相互联系及作用，也可以理解为定义于数据项之间的某种逻辑次序。</p>\n<p>根据这种逻辑次序的复杂程度，大致可以将各种数据结构划分为<em>线性结构</em>、<em>半线性结构</em>、<em>非线性结构</em>三类。在线性结构中，各个数据项按照一个线性次序构成一个整体。</p>\n<p>最基本的线性结构被称为<em>序列</em>。根据其中数据项的逻辑次序与其物理存储地址的对应关系不同，又可以将其区分为<em>向量</em>和<em>列表</em>。向量的所有数据项的物理存放位置与其逻辑次序完全吻合，此时的逻辑次序也被称为<em>秩</em>（就是索引或者下标）；而在列表中，逻辑上相邻的数据项在物理上未必相邻，它们的地址只能相互间接确定。</p>\n<h2 id=\"从数组到向量\"><a href=\"#从数组到向量\" class=\"headerlink\" title=\"从数组到向量\"></a>从数组到向量</h2><p>数组是许多元素的一个集合，这些元素具有线性次序。假设它们存放于起始地址为<code>A</code>，物理地址连续的一段存储空间，它们的集合就被称作数组<code>A[]</code>。数组中的每一个元素都唯一对应一个下标编号，如有<code>n</code>个元素的数组，那么它的下标范围是<code>[0, n)</code>中的正整数。</p>\n<h3 id=\"前驱与后继\"><a href=\"#前驱与后继\" class=\"headerlink\" title=\"前驱与后继\"></a>前驱与后继</h3><p>对于任何$0\\le i&lt;j&lt;n$，数组<code>A[]</code>中的元素<code>A[i]</code>都是<code>A[j]</code>的<em>前驱</em>，<code>A[j]</code>都是<code>A[i]</code>的<em>后继</em>。特别地，对任意$i\\ge 1$，<code>A[i-1]</code>都是<code>A[i]</code>的<em>直接前驱</em>；对任意$i\\le n-2$，<code>A[i+1]</code>都是<code>A[i]</code>的<em>直接后继</em>。</p>\n<p>任一元素的所有前驱构成其<em>前缀</em>，所有后继构成其<em>后缀</em>。</p>\n<p>在这一规则下，若数组<code>A[]</code>的起始地址为<code>A</code>，且每个元素占用<code>s</code>个单位的空间，则元素<code>A[i]</code>对应的物理地址即为<code>A + si</code>。这样的性质可以让我们通过下标这个元素的唯一指代，在常数时间内访问这个元素。</p>\n<h3 id=\"向量\"><a href=\"#向量\" class=\"headerlink\" title=\"向量\"></a>向量</h3><p>向量其实就是数组的一种抽象和泛化，它也是由具有线性次序的一组元素构成的集合，其中的元素分别由秩互相区分。向量中的秩具有与数组中的秩完全一样的特性。例如，若元素<code>e</code>的前驱元素共计<code>r</code>个，则其秩就是<code>r</code>。反过来，通过秩<code>r</code>也可以唯一确定元素<code>e</code>。这种向量特有的元素访问方式，称作<em>循秩访问</em>。</p>\n<p>向量的元素与数组中的相比，类型的范围极大地扩大了（即泛化）。向量的元素本身可以是来自于更具一般性的某一类的对象。另外，各个元素也不一定具有数值属性，也即不能保证它们之间能够互相比较大小。</p>\n<p>接下来的内容就向量最基本的接口的设计展开讨论，实现了相对应的响亮模板类。此外，下面的章节中通过引入比较器或者重载运算符明确各元素间的大小判断依据，并以此为据认为向量的元素都是可以比较大小的。</p>\n<h2 id=\"向量的基本接口\"><a href=\"#向量的基本接口\" class=\"headerlink\" title=\"向量的基本接口\"></a>向量的基本接口</h2><p>向量对象应该支持如下的操作接口：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">操作接口</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">适用对象</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>size()</code></td>\n<td align=\"center\">报告向量当前规模（元素个数）</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>get(r)</code></td>\n<td align=\"center\">获取秩为<code>r</code>的元素</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>put(r,e)</code></td>\n<td align=\"center\">用<code>e</code>替换秩为<code>r</code>的元素的值</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insert(r,e)</code></td>\n<td align=\"center\">把<code>e</code>插入秩<code>r</code>的位置，原后继依次后移</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>remove(r)</code></td>\n<td align=\"center\">删除秩为<code>r</code>的元素，返回该元素中存放的原对象</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>disordered()</code></td>\n<td align=\"center\">判断所有元素是否已按照非降序排列</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>sort()</code></td>\n<td align=\"center\">调整各元素的位置，使之按非降序排列</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>find(e)</code></td>\n<td align=\"center\">查找等于<code>e</code>且秩最大的元素</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>search(e)</code></td>\n<td align=\"center\">查找目标元素<code>e</code>，返回不大于<code>e</code>且秩最大的元素</td>\n<td align=\"center\">有序向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>depulicate()</code></td>\n<td align=\"center\">剔除重复元素</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>uniquify()</code></td>\n<td align=\"center\">剔除重复元素</td>\n<td align=\"center\">有序向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>traverse()</code></td>\n<td align=\"center\">遍历向量并且统一按照给定的函数对象指定的方法处理所有元素</td>\n<td align=\"center\">向量</td>\n</tr>\n</tbody></table>\n<p>根据上表的内容，可以设计<code>Vector</code>模板类如下所示。</p>\n<figure class=\"highlight c++\"><figcaption><span>>folded</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> Rank = <span class=\"keyword\">int</span>; <span class=\"comment\">//秩</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> DEFAULT_CAPACITY  3 <span class=\"comment\">//默认的初始容量（实际应用中可设置为更大）</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Vector</span> &#123;</span> <span class=\"comment\">//向量模板类</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">   Rank _size; Rank _capacity;  T* _elem; <span class=\"comment\">//规模、容量、数据区</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">copyFrom</span> <span class=\"params\">( T <span class=\"keyword\">const</span>* A, Rank lo, Rank hi )</span></span>; <span class=\"comment\">//复制数组区间A[lo, hi)</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">expand</span><span class=\"params\">()</span></span>; <span class=\"comment\">//空间不足时扩容</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">shrink</span><span class=\"params\">()</span></span>; <span class=\"comment\">//装填因子过小时压缩</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">bubble</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//扫描交换</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">bubbleSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//起泡排序算法</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">maxItem</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//选取最大元素</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">selectionSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//选择排序算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">merge</span> <span class=\"params\">( Rank lo, Rank mi, Rank hi )</span></span>; <span class=\"comment\">//归并算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">mergeSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//归并排序算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">heapSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//堆排序（稍后结合完全堆讲解）</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">partition</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//轴点构造算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">quickSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//快速排序算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">shellSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//希尔排序算法</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"><span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( <span class=\"keyword\">int</span> c = DEFAULT_CAPACITY, Rank s = <span class=\"number\">0</span>, T v = <span class=\"number\">0</span> ) <span class=\"comment\">//容量为c、规模为s、所有元素初始为v</span></span><br><span class=\"line\">   &#123; _elem = <span class=\"keyword\">new</span> T[_capacity = c]; <span class=\"keyword\">for</span> ( _size = <span class=\"number\">0</span>; _size &lt; s; _elem[_size++] = v ); &#125; <span class=\"comment\">//s&lt;=c</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( T <span class=\"keyword\">const</span>* A, Rank n ) &#123; <span class=\"built_in\">copyFrom</span> ( A, <span class=\"number\">0</span>, n ); &#125; <span class=\"comment\">//数组整体复制</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( T <span class=\"keyword\">const</span>* A, Rank lo, Rank hi ) &#123; <span class=\"built_in\">copyFrom</span> ( A, lo, hi ); &#125; <span class=\"comment\">//区间</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( Vector&lt;T&gt; <span class=\"keyword\">const</span>&amp; V ) &#123; <span class=\"built_in\">copyFrom</span> ( V._elem, <span class=\"number\">0</span>, V._size ); &#125; <span class=\"comment\">//向量整体复制</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( Vector&lt;T&gt; <span class=\"keyword\">const</span>&amp; V, Rank lo, Rank hi ) &#123; <span class=\"built_in\">copyFrom</span> ( V._elem, lo, hi ); &#125; <span class=\"comment\">//区间</span></span><br><span class=\"line\"><span class=\"comment\">// 析构函数</span></span><br><span class=\"line\">   ~<span class=\"built_in\">Vector</span>() &#123; <span class=\"keyword\">delete</span> [] _elem; &#125; <span class=\"comment\">//释放内部空间</span></span><br><span class=\"line\"><span class=\"comment\">// 只读访问接口</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">size</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> _size; &#125; <span class=\"comment\">//规模</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">empty</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> !_size; &#125; <span class=\"comment\">//判空</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">find</span> ( e, <span class=\"number\">0</span>, _size ); &#125; <span class=\"comment\">//无序向量整体查找</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//无序向量区间查找</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> <span class=\"comment\">//有序向量整体查找</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> ( <span class=\"number\">0</span> &gt;= _size ) ? <span class=\"number\">-1</span> : <span class=\"built_in\">search</span> ( e, <span class=\"number\">0</span>, _size ); &#125;</span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//有序向量区间查找</span></span><br><span class=\"line\"><span class=\"comment\">// 可写访问接口</span></span><br><span class=\"line\">   T&amp; <span class=\"keyword\">operator</span>[] ( Rank r ); <span class=\"comment\">//重载下标操作符，可以类似于数组形式引用各元素</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> T&amp; <span class=\"keyword\">operator</span>[] ( Rank r ) <span class=\"keyword\">const</span>; <span class=\"comment\">//仅限于做右值的重载版本</span></span><br><span class=\"line\">   Vector&lt;T&gt; &amp; <span class=\"keyword\">operator</span>= ( Vector&lt;T&gt; <span class=\"keyword\">const</span>&amp; ); <span class=\"comment\">//重载赋值操作符，以便直接克隆向量</span></span><br><span class=\"line\">   <span class=\"function\">T <span class=\"title\">remove</span> <span class=\"params\">( Rank r )</span></span>; <span class=\"comment\">//删除秩为r的元素</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">remove</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//删除秩在区间[lo, hi)之内的元素</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">insert</span> <span class=\"params\">( Rank r, T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//插入元素</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">insert</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">insert</span> ( _size, e ); &#125; <span class=\"comment\">//默认作为末元素插入</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//对[lo, hi)排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span><span class=\"params\">()</span> </span>&#123; <span class=\"built_in\">sort</span> ( <span class=\"number\">0</span>, _size ); &#125; <span class=\"comment\">//整体排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unsort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//对[lo, hi)置乱</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unsort</span><span class=\"params\">()</span> </span>&#123; <span class=\"built_in\">unsort</span> ( <span class=\"number\">0</span>, _size ); &#125; <span class=\"comment\">//整体置乱</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">deduplicate</span><span class=\"params\">()</span></span>; <span class=\"comment\">//无序去重</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">uniquify</span><span class=\"params\">()</span></span>; <span class=\"comment\">//有序去重</span></span><br><span class=\"line\"><span class=\"comment\">// 遍历</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( <span class=\"keyword\">void</span> (* ) ( T&amp; ) )</span></span>; <span class=\"comment\">//遍历（使用函数指针，只读或局部性修改）</span></span><br><span class=\"line\">   <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( VST&amp; )</span></span>; <span class=\"comment\">//遍历（使用函数对象，可全局性修改）</span></span><br><span class=\"line\">&#125;; <span class=\"comment\">//Vector</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>这里使用了模板编程，可以提高向量中元素的数据结构选用的灵活性和运行效率。</p>\n<h2 id=\"构造与析构\"><a href=\"#构造与析构\" class=\"headerlink\" title=\"构造与析构\"></a>构造与析构</h2><p>观察上面的代码可以知道，向量模板类中的私有数组<code>_elem[]</code>用来存储向量中实际的元素；其容量（<code>_elem[]</code>中元素的个数，其中可能有空元素）由私有变量<code>_capacity</code>指示；其有效元素的数量（向量的规模）由<code>_size</code>指示。此外规定，向量中秩为<code>r</code>的元素，对应于内部数组中的<code>_elem[r]</code>，其物理地址为<code>_elem + r</code>。</p>\n<h3 id=\"默认构造函数\"><a href=\"#默认构造函数\" class=\"headerlink\" title=\"默认构造函数\"></a>默认构造函数</h3><p>首先根据创建者指定的初始容量<code>c</code>向操作系统申请为<code>_elem[]</code>分配容量为<code>c</code>的空间，如果没有明确指定，则使用<code>DEFAULT_CAPACITY</code>。然后，由于新创建的向量中不包含任何元素，所以在未明确指定的情形下，把向量的规模<code>_size</code>设为0。最后，对<code>_elem[]</code>中的元素用<code>v</code>进行初始化。</p>\n<h3 id=\"复制构造函数\"><a href=\"#复制构造函数\" class=\"headerlink\" title=\"复制构造函数\"></a>复制构造函数</h3><p>复制构造方法以某个已有的向量或数组作为蓝本，进行局部或者整体的克隆。在向量接口类中，有四个复制构造函数，它们均使用了<code>copyForm()</code>方法。<a href=\"https://dsa.cs.tsinghua.edu.cn/~deng/ds/src_link/vector/vector_constructor_by_copying.h.htm\">该函数</a>首先根据待复制区间的边界计算出新向量的初始规模，再以初始规模的两倍为<code>_elem[]</code>申请空间。最后通过一趟迭代将源向量（数组）中指定范围内的各个元素复制到新向量中。</p>\n<p>注意，由于向量中的元素可能不是内置类型，因此这里有必要重载<code>operator=</code>操作符以适应自定义类型可能需要进行的赋值操作。重载的<code>operator=</code>操作符应当返回对当前（接受赋值）的对象的引用，以便于链式赋值。</p>\n<p>复制构造函数的运行时间正比于区间的宽度，其时间复杂度为$\\mathcal O (\\rm{\\underline{ } size})$。</p>\n<h3 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h3><p>向量对象的析构函数只需要释放<code>_elem[]</code>的空间即可，因为只有它是由<code>new</code>申请出来的。</p>\n<h2 id=\"动态空间管理\"><a href=\"#动态空间管理\" class=\"headerlink\" title=\"动态空间管理\"></a>动态空间管理</h2><p>使用数组来存储向量的元素有一个缺点：向量内部数组的容量是固定的，如果在数组填满之后向量还需要插入元素，那么就会造成溢出（上溢）。因此，可以考虑根据向量的规模动态地调整其容量。这里引入<em>装填因子</em>的概念：向量实际规模与其内部数组容量的比值，也即<code>_size/_capacity</code>，它是衡量向量空间利用率的重要指标。</p>\n<p>为了实现动态空间管理，需要保证<strong>向量的装填因子既不超过1，又不太接近于0</strong>。</p>\n<h3 id=\"可扩充向量\"><a href=\"#可扩充向量\" class=\"headerlink\" title=\"可扩充向量\"></a>可扩充向量</h3><p>扩充向量的原理很简单：如果内部仍有空余，那么插入操作可以正常进行，经过一次插入（删除）操作之后，可用空间都会减少（增加）一个单元。一旦可用空间耗尽，就动态地扩大内部数组的容量。</p>\n<p>具体到操作方法上，由于数组的大小在初始化时就已经确定并且之后不可以进行更改，所以我们在扩充向量时需要重新申请一个容量更大的数组，并将原数组中的成员集体搬迁至新的空间，然后再将原数组释放掉。</p>\n<p>基于以上策略，可以设计算法<code>expand()</code>。在调用<code>insert()</code>接口插入新元素之前，都要先调用该算法来检查内部数组的可用容量。一旦<code>_size == _capacity</code>，就将原数组替换为一个更大的数组。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">expand</span>() &#123; <span class=\"comment\">//向量空间不足时扩容</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _size &lt; _capacity ) <span class=\"keyword\">return</span>; <span class=\"comment\">//尚未满员时，不必扩容</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _capacity &lt; DEFAULT_CAPACITY ) _capacity = DEFAULT_CAPACITY; <span class=\"comment\">//不低于最小容量</span></span><br><span class=\"line\">   T* oldElem = _elem;  _elem = <span class=\"keyword\">new</span> T[_capacity &lt;&lt;= <span class=\"number\">1</span>]; <span class=\"comment\">//容量加倍</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ )</span><br><span class=\"line\">      _elem[i] = oldElem[i]; <span class=\"comment\">//复制原向量内容（T为基本类型，或已重载赋值操作符&#x27;=&#x27;）</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> [] oldElem; <span class=\"comment\">//释放原空间</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"复杂度分析\"><a href=\"#复杂度分析\" class=\"headerlink\" title=\"复杂度分析\"></a>复杂度分析</h4><p>向量每次由<code>n</code>扩容至<code>2n</code>，都需要花费$\\mathcal O (n)$时间。在扩容后，至少还需要<code>n</code>次插入操作才需要再次扩容。也就是说，随着向量规模的不断扩大，在执行插入操作之前需要扩容的概率也会迅速降低。因此就某种平均意义来说，用于扩容的时间成本不至于很高。</p>\n<p>考查对向量足够多次的连续操作，将其所消耗的时间分摊至所有的操作上，这样分摊平均至单次操作的时间成本被称为<em>分摊运行时间</em>。</p>\n<p><em>平均运行时间</em>的概念看似与分摊运行时间一样，实则有很大区别。平均运行时间是按照某种假定的概率分布，对各种（输入）情况下所需要的执行时间的加权平均，因此亦称作期望运行时间。而对于分摊运行时间来说，参与分摊的操作应当来自一个真实可行的、足够长的确定的操作序列。</p>\n<p>接下来使用分摊分析的方法来分析向量插入操作的复杂度。</p>\n<p>假定的<code>_elem[]</code>的初始容量和初始规模均为某一常数<code>N</code>。假设在此后需要连续进行<code>n</code>次操作，并且<code>n</code>远大于<code>N</code>。因此，在连续插入<code>n</code>个元素后，向量的规模<code>_size</code>应该变成<code>n + N</code>。根据向量扩充的策略，装填因子绝对不会超过100%，同时也不会低于50%。因此，在连续插入<code>n</code>个元素后，有下面的关系$\\rm{\\underline{ }size}\\le\\rm{\\underline{ } capacity}&lt;2\\cdot\\rm{\\underline{ } size}$。</p>\n<p>于是有：$\\rm{\\underline{ } capacity} = \\Theta(\\rm{\\underline{ } size}) = \\Theta(n + N) = \\Theta(n)$。</p>\n<p>向量的容量以2为比例按指数速度增长，在容量到达<code>_capacity</code>前，共做过$\\Theta(\\log_2n)$次扩容，每次扩容所需要的时间正比于向量当时的规模，并且同样以2为比例按指数速度增长。因此消耗于扩容的时间为：$\\rm T(n)=2N + 4N + … + \\underline{ } capacity &lt; 2\\cdot \\underline{ } capacity = \\Theta(n)$。分摊到每次操作上，单次操作所需要的运行时间应为$\\mathcal O (1)$。</p>\n<h3 id=\"向量的缩容\"><a href=\"#向量的缩容\" class=\"headerlink\" title=\"向量的缩容\"></a>向量的缩容</h3><p>除了插入操作之外，影响向量的装填因子的另一因素就是删除操作。如果向量中的删除操作远多于插入操作，那么向量的装填因子很有可能远低于100%。当装填因子小于某个阈值时，称数组发生了<em>下溢</em>。</p>\n<p>尽管下溢不是必须要解决的问题，但是它对空间利用率还是有着负面的影响。下面的代码给出了向量的动态缩容算法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">shrink</span>() &#123; <span class=\"comment\">//装填因子过小时压缩向量所占空间</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _capacity &lt; DEFAULT_CAPACITY &lt;&lt; <span class=\"number\">1</span> ) <span class=\"keyword\">return</span>; <span class=\"comment\">//不致收缩到DEFAULT_CAPACITY以下</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _size &lt;&lt; <span class=\"number\">2</span> &gt; _capacity ) <span class=\"keyword\">return</span>; <span class=\"comment\">//以25%为界</span></span><br><span class=\"line\">   T* oldElem = _elem;  _elem = <span class=\"keyword\">new</span> T[_capacity &gt;&gt;= <span class=\"number\">1</span>]; <span class=\"comment\">//容量减半</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ ) _elem[i] = oldElem[i]; <span class=\"comment\">//复制原向量内容</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> [] oldElem; <span class=\"comment\">//释放原空间</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>缩容算法的策略很简单：每次进行删除操作以后，如果算法的空间利用率降低到25%以下，就将容量减半。缩容算法的分摊复杂度同样为$\\mathcal O (1)$。</p>\n<p>在实际应用中，为了避免出现频繁交替扩容和缩容的情况，可以选择更低的阈值，或者直接禁止缩容。</p>\n<p>尽管在分摊意义上向量的扩容和缩容操作效率很高，但是对某次具体的扩容或者缩容操作来说，其需要的时间的确会高达$\\Omega (n)$。因此，在对单次操作速度及其敏感的应用场合上不能继续沿用上面的策略。</p>\n","site":{"data":{}},"more":"<h2 id=\"数据结构的基本概念\"><a href=\"#数据结构的基本概念\" class=\"headerlink\" title=\"数据结构的基本概念\"></a>数据结构的基本概念</h2><p>数据结构是数据项的结构化集合，其结构性表现为数据项之间的相互联系及作用，也可以理解为定义于数据项之间的某种逻辑次序。</p>\n<p>根据这种逻辑次序的复杂程度，大致可以将各种数据结构划分为<em>线性结构</em>、<em>半线性结构</em>、<em>非线性结构</em>三类。在线性结构中，各个数据项按照一个线性次序构成一个整体。</p>\n<p>最基本的线性结构被称为<em>序列</em>。根据其中数据项的逻辑次序与其物理存储地址的对应关系不同，又可以将其区分为<em>向量</em>和<em>列表</em>。向量的所有数据项的物理存放位置与其逻辑次序完全吻合，此时的逻辑次序也被称为<em>秩</em>（就是索引或者下标）；而在列表中，逻辑上相邻的数据项在物理上未必相邻，它们的地址只能相互间接确定。</p>\n<h2 id=\"从数组到向量\"><a href=\"#从数组到向量\" class=\"headerlink\" title=\"从数组到向量\"></a>从数组到向量</h2><p>数组是许多元素的一个集合，这些元素具有线性次序。假设它们存放于起始地址为<code>A</code>，物理地址连续的一段存储空间，它们的集合就被称作数组<code>A[]</code>。数组中的每一个元素都唯一对应一个下标编号，如有<code>n</code>个元素的数组，那么它的下标范围是<code>[0, n)</code>中的正整数。</p>\n<h3 id=\"前驱与后继\"><a href=\"#前驱与后继\" class=\"headerlink\" title=\"前驱与后继\"></a>前驱与后继</h3><p>对于任何$0\\le i&lt;j&lt;n$，数组<code>A[]</code>中的元素<code>A[i]</code>都是<code>A[j]</code>的<em>前驱</em>，<code>A[j]</code>都是<code>A[i]</code>的<em>后继</em>。特别地，对任意$i\\ge 1$，<code>A[i-1]</code>都是<code>A[i]</code>的<em>直接前驱</em>；对任意$i\\le n-2$，<code>A[i+1]</code>都是<code>A[i]</code>的<em>直接后继</em>。</p>\n<p>任一元素的所有前驱构成其<em>前缀</em>，所有后继构成其<em>后缀</em>。</p>\n<p>在这一规则下，若数组<code>A[]</code>的起始地址为<code>A</code>，且每个元素占用<code>s</code>个单位的空间，则元素<code>A[i]</code>对应的物理地址即为<code>A + si</code>。这样的性质可以让我们通过下标这个元素的唯一指代，在常数时间内访问这个元素。</p>\n<h3 id=\"向量\"><a href=\"#向量\" class=\"headerlink\" title=\"向量\"></a>向量</h3><p>向量其实就是数组的一种抽象和泛化，它也是由具有线性次序的一组元素构成的集合，其中的元素分别由秩互相区分。向量中的秩具有与数组中的秩完全一样的特性。例如，若元素<code>e</code>的前驱元素共计<code>r</code>个，则其秩就是<code>r</code>。反过来，通过秩<code>r</code>也可以唯一确定元素<code>e</code>。这种向量特有的元素访问方式，称作<em>循秩访问</em>。</p>\n<p>向量的元素与数组中的相比，类型的范围极大地扩大了（即泛化）。向量的元素本身可以是来自于更具一般性的某一类的对象。另外，各个元素也不一定具有数值属性，也即不能保证它们之间能够互相比较大小。</p>\n<p>接下来的内容就向量最基本的接口的设计展开讨论，实现了相对应的响亮模板类。此外，下面的章节中通过引入比较器或者重载运算符明确各元素间的大小判断依据，并以此为据认为向量的元素都是可以比较大小的。</p>\n<h2 id=\"向量的基本接口\"><a href=\"#向量的基本接口\" class=\"headerlink\" title=\"向量的基本接口\"></a>向量的基本接口</h2><p>向量对象应该支持如下的操作接口：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">操作接口</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">适用对象</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>size()</code></td>\n<td align=\"center\">报告向量当前规模（元素个数）</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>get(r)</code></td>\n<td align=\"center\">获取秩为<code>r</code>的元素</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>put(r,e)</code></td>\n<td align=\"center\">用<code>e</code>替换秩为<code>r</code>的元素的值</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insert(r,e)</code></td>\n<td align=\"center\">把<code>e</code>插入秩<code>r</code>的位置，原后继依次后移</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>remove(r)</code></td>\n<td align=\"center\">删除秩为<code>r</code>的元素，返回该元素中存放的原对象</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>disordered()</code></td>\n<td align=\"center\">判断所有元素是否已按照非降序排列</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>sort()</code></td>\n<td align=\"center\">调整各元素的位置，使之按非降序排列</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>find(e)</code></td>\n<td align=\"center\">查找等于<code>e</code>且秩最大的元素</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>search(e)</code></td>\n<td align=\"center\">查找目标元素<code>e</code>，返回不大于<code>e</code>且秩最大的元素</td>\n<td align=\"center\">有序向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>depulicate()</code></td>\n<td align=\"center\">剔除重复元素</td>\n<td align=\"center\">向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>uniquify()</code></td>\n<td align=\"center\">剔除重复元素</td>\n<td align=\"center\">有序向量</td>\n</tr>\n<tr>\n<td align=\"center\"><code>traverse()</code></td>\n<td align=\"center\">遍历向量并且统一按照给定的函数对象指定的方法处理所有元素</td>\n<td align=\"center\">向量</td>\n</tr>\n</tbody></table>\n<p>根据上表的内容，可以设计<code>Vector</code>模板类如下所示。</p>\n<figure class=\"highlight c++\"><figcaption><span>>folded</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> Rank = <span class=\"keyword\">int</span>; <span class=\"comment\">//秩</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> DEFAULT_CAPACITY  3 <span class=\"comment\">//默认的初始容量（实际应用中可设置为更大）</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Vector</span> &#123;</span> <span class=\"comment\">//向量模板类</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">   Rank _size; Rank _capacity;  T* _elem; <span class=\"comment\">//规模、容量、数据区</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">copyFrom</span> <span class=\"params\">( T <span class=\"keyword\">const</span>* A, Rank lo, Rank hi )</span></span>; <span class=\"comment\">//复制数组区间A[lo, hi)</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">expand</span><span class=\"params\">()</span></span>; <span class=\"comment\">//空间不足时扩容</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">shrink</span><span class=\"params\">()</span></span>; <span class=\"comment\">//装填因子过小时压缩</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">bubble</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//扫描交换</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">bubbleSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//起泡排序算法</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">maxItem</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//选取最大元素</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">selectionSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//选择排序算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">merge</span> <span class=\"params\">( Rank lo, Rank mi, Rank hi )</span></span>; <span class=\"comment\">//归并算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">mergeSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//归并排序算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">heapSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//堆排序（稍后结合完全堆讲解）</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">partition</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//轴点构造算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">quickSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//快速排序算法</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">shellSort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//希尔排序算法</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"><span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( <span class=\"keyword\">int</span> c = DEFAULT_CAPACITY, Rank s = <span class=\"number\">0</span>, T v = <span class=\"number\">0</span> ) <span class=\"comment\">//容量为c、规模为s、所有元素初始为v</span></span><br><span class=\"line\">   &#123; _elem = <span class=\"keyword\">new</span> T[_capacity = c]; <span class=\"keyword\">for</span> ( _size = <span class=\"number\">0</span>; _size &lt; s; _elem[_size++] = v ); &#125; <span class=\"comment\">//s&lt;=c</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( T <span class=\"keyword\">const</span>* A, Rank n ) &#123; <span class=\"built_in\">copyFrom</span> ( A, <span class=\"number\">0</span>, n ); &#125; <span class=\"comment\">//数组整体复制</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( T <span class=\"keyword\">const</span>* A, Rank lo, Rank hi ) &#123; <span class=\"built_in\">copyFrom</span> ( A, lo, hi ); &#125; <span class=\"comment\">//区间</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( Vector&lt;T&gt; <span class=\"keyword\">const</span>&amp; V ) &#123; <span class=\"built_in\">copyFrom</span> ( V._elem, <span class=\"number\">0</span>, V._size ); &#125; <span class=\"comment\">//向量整体复制</span></span><br><span class=\"line\">   <span class=\"built_in\">Vector</span> ( Vector&lt;T&gt; <span class=\"keyword\">const</span>&amp; V, Rank lo, Rank hi ) &#123; <span class=\"built_in\">copyFrom</span> ( V._elem, lo, hi ); &#125; <span class=\"comment\">//区间</span></span><br><span class=\"line\"><span class=\"comment\">// 析构函数</span></span><br><span class=\"line\">   ~<span class=\"built_in\">Vector</span>() &#123; <span class=\"keyword\">delete</span> [] _elem; &#125; <span class=\"comment\">//释放内部空间</span></span><br><span class=\"line\"><span class=\"comment\">// 只读访问接口</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">size</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> _size; &#125; <span class=\"comment\">//规模</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">empty</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> !_size; &#125; <span class=\"comment\">//判空</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">find</span> ( e, <span class=\"number\">0</span>, _size ); &#125; <span class=\"comment\">//无序向量整体查找</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//无序向量区间查找</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> <span class=\"comment\">//有序向量整体查找</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> ( <span class=\"number\">0</span> &gt;= _size ) ? <span class=\"number\">-1</span> : <span class=\"built_in\">search</span> ( e, <span class=\"number\">0</span>, _size ); &#125;</span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//有序向量区间查找</span></span><br><span class=\"line\"><span class=\"comment\">// 可写访问接口</span></span><br><span class=\"line\">   T&amp; <span class=\"keyword\">operator</span>[] ( Rank r ); <span class=\"comment\">//重载下标操作符，可以类似于数组形式引用各元素</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> T&amp; <span class=\"keyword\">operator</span>[] ( Rank r ) <span class=\"keyword\">const</span>; <span class=\"comment\">//仅限于做右值的重载版本</span></span><br><span class=\"line\">   Vector&lt;T&gt; &amp; <span class=\"keyword\">operator</span>= ( Vector&lt;T&gt; <span class=\"keyword\">const</span>&amp; ); <span class=\"comment\">//重载赋值操作符，以便直接克隆向量</span></span><br><span class=\"line\">   <span class=\"function\">T <span class=\"title\">remove</span> <span class=\"params\">( Rank r )</span></span>; <span class=\"comment\">//删除秩为r的元素</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">remove</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//删除秩在区间[lo, hi)之内的元素</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">insert</span> <span class=\"params\">( Rank r, T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//插入元素</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">insert</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">insert</span> ( _size, e ); &#125; <span class=\"comment\">//默认作为末元素插入</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//对[lo, hi)排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span><span class=\"params\">()</span> </span>&#123; <span class=\"built_in\">sort</span> ( <span class=\"number\">0</span>, _size ); &#125; <span class=\"comment\">//整体排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unsort</span> <span class=\"params\">( Rank lo, Rank hi )</span></span>; <span class=\"comment\">//对[lo, hi)置乱</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">unsort</span><span class=\"params\">()</span> </span>&#123; <span class=\"built_in\">unsort</span> ( <span class=\"number\">0</span>, _size ); &#125; <span class=\"comment\">//整体置乱</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">deduplicate</span><span class=\"params\">()</span></span>; <span class=\"comment\">//无序去重</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">uniquify</span><span class=\"params\">()</span></span>; <span class=\"comment\">//有序去重</span></span><br><span class=\"line\"><span class=\"comment\">// 遍历</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( <span class=\"keyword\">void</span> (* ) ( T&amp; ) )</span></span>; <span class=\"comment\">//遍历（使用函数指针，只读或局部性修改）</span></span><br><span class=\"line\">   <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( VST&amp; )</span></span>; <span class=\"comment\">//遍历（使用函数对象，可全局性修改）</span></span><br><span class=\"line\">&#125;; <span class=\"comment\">//Vector</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>这里使用了模板编程，可以提高向量中元素的数据结构选用的灵活性和运行效率。</p>\n<h2 id=\"构造与析构\"><a href=\"#构造与析构\" class=\"headerlink\" title=\"构造与析构\"></a>构造与析构</h2><p>观察上面的代码可以知道，向量模板类中的私有数组<code>_elem[]</code>用来存储向量中实际的元素；其容量（<code>_elem[]</code>中元素的个数，其中可能有空元素）由私有变量<code>_capacity</code>指示；其有效元素的数量（向量的规模）由<code>_size</code>指示。此外规定，向量中秩为<code>r</code>的元素，对应于内部数组中的<code>_elem[r]</code>，其物理地址为<code>_elem + r</code>。</p>\n<h3 id=\"默认构造函数\"><a href=\"#默认构造函数\" class=\"headerlink\" title=\"默认构造函数\"></a>默认构造函数</h3><p>首先根据创建者指定的初始容量<code>c</code>向操作系统申请为<code>_elem[]</code>分配容量为<code>c</code>的空间，如果没有明确指定，则使用<code>DEFAULT_CAPACITY</code>。然后，由于新创建的向量中不包含任何元素，所以在未明确指定的情形下，把向量的规模<code>_size</code>设为0。最后，对<code>_elem[]</code>中的元素用<code>v</code>进行初始化。</p>\n<h3 id=\"复制构造函数\"><a href=\"#复制构造函数\" class=\"headerlink\" title=\"复制构造函数\"></a>复制构造函数</h3><p>复制构造方法以某个已有的向量或数组作为蓝本，进行局部或者整体的克隆。在向量接口类中，有四个复制构造函数，它们均使用了<code>copyForm()</code>方法。<a href=\"https://dsa.cs.tsinghua.edu.cn/~deng/ds/src_link/vector/vector_constructor_by_copying.h.htm\">该函数</a>首先根据待复制区间的边界计算出新向量的初始规模，再以初始规模的两倍为<code>_elem[]</code>申请空间。最后通过一趟迭代将源向量（数组）中指定范围内的各个元素复制到新向量中。</p>\n<p>注意，由于向量中的元素可能不是内置类型，因此这里有必要重载<code>operator=</code>操作符以适应自定义类型可能需要进行的赋值操作。重载的<code>operator=</code>操作符应当返回对当前（接受赋值）的对象的引用，以便于链式赋值。</p>\n<p>复制构造函数的运行时间正比于区间的宽度，其时间复杂度为$\\mathcal O (\\rm{\\underline{ } size})$。</p>\n<h3 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h3><p>向量对象的析构函数只需要释放<code>_elem[]</code>的空间即可，因为只有它是由<code>new</code>申请出来的。</p>\n<h2 id=\"动态空间管理\"><a href=\"#动态空间管理\" class=\"headerlink\" title=\"动态空间管理\"></a>动态空间管理</h2><p>使用数组来存储向量的元素有一个缺点：向量内部数组的容量是固定的，如果在数组填满之后向量还需要插入元素，那么就会造成溢出（上溢）。因此，可以考虑根据向量的规模动态地调整其容量。这里引入<em>装填因子</em>的概念：向量实际规模与其内部数组容量的比值，也即<code>_size/_capacity</code>，它是衡量向量空间利用率的重要指标。</p>\n<p>为了实现动态空间管理，需要保证<strong>向量的装填因子既不超过1，又不太接近于0</strong>。</p>\n<h3 id=\"可扩充向量\"><a href=\"#可扩充向量\" class=\"headerlink\" title=\"可扩充向量\"></a>可扩充向量</h3><p>扩充向量的原理很简单：如果内部仍有空余，那么插入操作可以正常进行，经过一次插入（删除）操作之后，可用空间都会减少（增加）一个单元。一旦可用空间耗尽，就动态地扩大内部数组的容量。</p>\n<p>具体到操作方法上，由于数组的大小在初始化时就已经确定并且之后不可以进行更改，所以我们在扩充向量时需要重新申请一个容量更大的数组，并将原数组中的成员集体搬迁至新的空间，然后再将原数组释放掉。</p>\n<p>基于以上策略，可以设计算法<code>expand()</code>。在调用<code>insert()</code>接口插入新元素之前，都要先调用该算法来检查内部数组的可用容量。一旦<code>_size == _capacity</code>，就将原数组替换为一个更大的数组。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">expand</span>() &#123; <span class=\"comment\">//向量空间不足时扩容</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _size &lt; _capacity ) <span class=\"keyword\">return</span>; <span class=\"comment\">//尚未满员时，不必扩容</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _capacity &lt; DEFAULT_CAPACITY ) _capacity = DEFAULT_CAPACITY; <span class=\"comment\">//不低于最小容量</span></span><br><span class=\"line\">   T* oldElem = _elem;  _elem = <span class=\"keyword\">new</span> T[_capacity &lt;&lt;= <span class=\"number\">1</span>]; <span class=\"comment\">//容量加倍</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ )</span><br><span class=\"line\">      _elem[i] = oldElem[i]; <span class=\"comment\">//复制原向量内容（T为基本类型，或已重载赋值操作符&#x27;=&#x27;）</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> [] oldElem; <span class=\"comment\">//释放原空间</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"复杂度分析\"><a href=\"#复杂度分析\" class=\"headerlink\" title=\"复杂度分析\"></a>复杂度分析</h4><p>向量每次由<code>n</code>扩容至<code>2n</code>，都需要花费$\\mathcal O (n)$时间。在扩容后，至少还需要<code>n</code>次插入操作才需要再次扩容。也就是说，随着向量规模的不断扩大，在执行插入操作之前需要扩容的概率也会迅速降低。因此就某种平均意义来说，用于扩容的时间成本不至于很高。</p>\n<p>考查对向量足够多次的连续操作，将其所消耗的时间分摊至所有的操作上，这样分摊平均至单次操作的时间成本被称为<em>分摊运行时间</em>。</p>\n<p><em>平均运行时间</em>的概念看似与分摊运行时间一样，实则有很大区别。平均运行时间是按照某种假定的概率分布，对各种（输入）情况下所需要的执行时间的加权平均，因此亦称作期望运行时间。而对于分摊运行时间来说，参与分摊的操作应当来自一个真实可行的、足够长的确定的操作序列。</p>\n<p>接下来使用分摊分析的方法来分析向量插入操作的复杂度。</p>\n<p>假定的<code>_elem[]</code>的初始容量和初始规模均为某一常数<code>N</code>。假设在此后需要连续进行<code>n</code>次操作，并且<code>n</code>远大于<code>N</code>。因此，在连续插入<code>n</code>个元素后，向量的规模<code>_size</code>应该变成<code>n + N</code>。根据向量扩充的策略，装填因子绝对不会超过100%，同时也不会低于50%。因此，在连续插入<code>n</code>个元素后，有下面的关系$\\rm{\\underline{ }size}\\le\\rm{\\underline{ } capacity}&lt;2\\cdot\\rm{\\underline{ } size}$。</p>\n<p>于是有：$\\rm{\\underline{ } capacity} = \\Theta(\\rm{\\underline{ } size}) = \\Theta(n + N) = \\Theta(n)$。</p>\n<p>向量的容量以2为比例按指数速度增长，在容量到达<code>_capacity</code>前，共做过$\\Theta(\\log_2n)$次扩容，每次扩容所需要的时间正比于向量当时的规模，并且同样以2为比例按指数速度增长。因此消耗于扩容的时间为：$\\rm T(n)=2N + 4N + … + \\underline{ } capacity &lt; 2\\cdot \\underline{ } capacity = \\Theta(n)$。分摊到每次操作上，单次操作所需要的运行时间应为$\\mathcal O (1)$。</p>\n<h3 id=\"向量的缩容\"><a href=\"#向量的缩容\" class=\"headerlink\" title=\"向量的缩容\"></a>向量的缩容</h3><p>除了插入操作之外，影响向量的装填因子的另一因素就是删除操作。如果向量中的删除操作远多于插入操作，那么向量的装填因子很有可能远低于100%。当装填因子小于某个阈值时，称数组发生了<em>下溢</em>。</p>\n<p>尽管下溢不是必须要解决的问题，但是它对空间利用率还是有着负面的影响。下面的代码给出了向量的动态缩容算法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">shrink</span>() &#123; <span class=\"comment\">//装填因子过小时压缩向量所占空间</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _capacity &lt; DEFAULT_CAPACITY &lt;&lt; <span class=\"number\">1</span> ) <span class=\"keyword\">return</span>; <span class=\"comment\">//不致收缩到DEFAULT_CAPACITY以下</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _size &lt;&lt; <span class=\"number\">2</span> &gt; _capacity ) <span class=\"keyword\">return</span>; <span class=\"comment\">//以25%为界</span></span><br><span class=\"line\">   T* oldElem = _elem;  _elem = <span class=\"keyword\">new</span> T[_capacity &gt;&gt;= <span class=\"number\">1</span>]; <span class=\"comment\">//容量减半</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ ) _elem[i] = oldElem[i]; <span class=\"comment\">//复制原向量内容</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> [] oldElem; <span class=\"comment\">//释放原空间</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>缩容算法的策略很简单：每次进行删除操作以后，如果算法的空间利用率降低到25%以下，就将容量减半。缩容算法的分摊复杂度同样为$\\mathcal O (1)$。</p>\n<p>在实际应用中，为了避免出现频繁交替扩容和缩容的情况，可以选择更低的阈值，或者直接禁止缩容。</p>\n<p>尽管在分摊意义上向量的扩容和缩容操作效率很高，但是对某次具体的扩容或者缩容操作来说，其需要的时间的确会高达$\\Omega (n)$。因此，在对单次操作速度及其敏感的应用场合上不能继续沿用上面的策略。</p>\n"},{"title":"DSA-4：向量及其接口设计2","date":"2022-03-22T08:20:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"向量接口的实现。","_content":"\n## 向量的基本接口\n\n### 引用元素\n\n在向量类中，元素的访问方式就是通过下标。因此，可以在向量类中重载操作符`[]`来实现这个功能。向量的索引也就是其内部私有数组`_elem[]`的索引。该算法实现起来没有难度，但是要注意在重载的时候需要合理使用`const`修饰符来控制被访问元素的可更改性。\n\n### 置乱器\n\n在软件测试、仿真模拟等应用中，经常需要使用到随机向量。随机向量随机性的高低直接影响到测试的覆盖面大小与仿真结果的优劣。\n\n向量中的置乱器`unsort()`就提供了生成随机向量的功能。该算法从待置乱区间的末元素开始，逆序地向前逐一处理各个元素。对每一个当前元素，都与随机生成的第`rand() % i`个不超过`i`的元素进行交换。经过每一步这样的处理，置乱区间就会向前拓展一个单元。经$\\mathcal O (n)$次迭代后，实现整个向量的置乱。算法实现如下：\n\n```C++\ntemplate <typename T> void Vector<T>::unsort ( Rank lo, Rank hi ) { //等概率随机置乱区间[lo, hi)\n   T* V = _elem + lo; //将子向量_elem[lo, hi)视作另一向量V[0, hi - lo)\n   for ( Rank i = hi - lo; i > 0; i-- ) //自后向前\n      swap ( V[i - 1], V[rand() % i] ); //将V[i - 1]与V[0, i)中某一元素随机交换\n}\n```\n\n### 判等器与比较器\n\n首先要分清两个概念：\n\n- 判等：判断两个对象是否相等，亦被称为比对\n- 比较：判断两个对象的相对大小\n\n在[上一篇文章](https://astrobear.top/2022/03/17/dsa-3/)中我们说过，在设计向量类时假设其中的元素都是可以互相比较大小的。因此对于向量中可能存储的元素类型`T`，我们需要针对其设计判等器与比较器。有两种方法可以用来实现判等器与比较器：\n\n- 使用函数封装\n- 重载关系比较操作符\n\n判等器和比较器对有序向量来说至关重要，*有序向量*中的元素必须存在某种可以比较相对大小的关系才能称之为有序。\n\n关于有序向量，我们约定其中的元素**自前向后（秩由小到大）的元素构成一个非降序列**。即对一向量$S[0, n)$，若有任意的秩$i, j$满足$0 \\le i < j < n$，有$S[i] \\le S[j]$。\n\n### 插入\n\n插入函数需要首先调用`expand()`函数检查`_elem[]`是否即将溢出，在必要时对向量进行扩容。然后，为了保证向量（数组）元素的物理地址连续，需要将插入元素所在位置的后缀整体后移一个单元。在这之后，才能在目标位置置入对象并更新向量规模。算法实现如下：\n\n```c++\ntemplate <typename T> //将e作为秩为r元素插入\nRank Vector<T>::insert ( Rank r, T const& e ) { //assert: 0 <= r <= size\n   expand(); //若有必要，扩容\n   for ( Rank i = _size; r < i; i-- ) //自后向前，后继元素\n      _elem[i] = _elem[i-1]; //顺次后移一个单元\n   _elem[r] = e; _size++; //置入新元素并更新容量\n   return r; //返回秩\n}\n```\n\n插入算法的时间消耗主要来源于后缀的后移，线性正比于后缀长度，因此其时间复杂度为$\\mathcal O (\\underline{}size - r +1)$。时间复杂度里的`+ 1`可以理解为插入元素操作需要的时间，其中包括置入元素与更新向量规模。当`r = _size`时为最好情况，需要$\\mathcal O (1)$时间；`r = 0`时为最坏情况，需要$\\mathcal O (\\underline{} size)$时间。一般来说，若插入位置等概率分布，那么平均运行时间为$\\mathcal O (\\underline{}size) = \\mathcal O (n)$。\n\n### 删除\n\n删除操作有两个接口：`remove(lo, hi)`用于删除区间`[lo, hi)`中的元素，`remove(r)`用于删除秩为`r`的单个元素。为了减少元素移动的次数，应当将删除单个元素的情形作为删除多个元素的情形的特例，基于后者来实现前者。\n\n下面先给出了区间删除的代码：\n\n```c++\ntemplate <typename T> int Vector<T>::remove ( Rank lo, Rank hi ) { //删除区间[lo, hi)\n   if ( lo == hi ) return 0; //出于效率考虑，单独处理退化情况，比如remove(0, 0)\n   while ( hi < _size ) //区间[hi, _size)\n      _elem[lo++] = _elem[hi++]; //顺次前移hi - lo个单元\n   _size = lo; //更新规模，直接丢弃尾部[lo, _size = hi)区间\n   shrink(); //若有必要，则缩容\n   return hi - lo; //返回被删除元素的数目\n}\n```\n\n上面的代码无非就是将被删除区间直接使用其后缀覆盖，然后通过调整`_size`的值直接丢弃尾部长为`hi - lo`的空间。最后调用`shrink()`，在一定条件下进行缩容。\n\n实现了区间删除后再实现单元素删除就很简单了，只需要在`remove(r)`中调用`remove(r, r+1)`即可。\n\n与插入类似，删除算法的时间消耗主要来自于后缀的前移，线性正比于后缀长度，总体不超过$\\mathcal O (\\underline{}size - hi + 1)$时间。时间复杂度里的`+ 1`可以理解为删除元素操作需要的时间，这里为更新向量规模。由此可知，区间删除操作需要的时间仅仅取决于后缀中元素的数目，与被删除区间本身的宽度无关。\n\n### 查找\n\n根据向量的类型，查找的算法有所区别。由于无序向量中没有更多的信息可以借助，在最坏的情况下，只有在访问完所有的元素之后才能得出查找结论。\n\n这里介绍针对无序向量的查找算法：算法从末元素出发，自后向前逐一取出各个元素并与目标元素进行比对，直到发现与之相等者。这种逐个比对的查找方式称作顺序查找。算法如下：\n\n```c++\ntemplate <typename T> //无序向量的顺序查找：返回最后一个元素e的位置；失败时，返回lo - 1\nRank Vector<T>::find ( T const& e, Rank lo, Rank hi ) const { //assert: 0 <= lo < hi <= _size\n   while ( ( lo < hi-- ) && ( e != _elem[hi] ) ); //从后向前，顺序查找\n   return hi; //若hi < lo，则意味着失败；否则hi即命中元素的秩\n}\n```\n\n该算法在有多个元素命中时，会返回其中秩最大的元素。另外，查找失败时统一返回`lo - 1`。当`lo`为`0`时，查找失败也不至于导致`_elem[]`数组越界。因为在第三行中一旦出现`lo < hi--`，后面的语句也不会执行。\n\n由于该算法是按顺序线性查找的，因此在最坏的情况下查找终止于首元素`_elem[lo]`，运行时间为$\\mathcal O (n)$。在最好的情况下，查找命中于末元素`_elem[hi - 1]`，仅需要$\\mathcal O (1))$时间。总而言之，该算法的运行时间取决于雷同元素的前缀长度。\n\n对于规模相同、内部组成不同的输入，算法的渐进运行时间却有本质区别，因此此类算法也称作输入敏感的算法。\n\n### 遍历\n\n遍历算法可以与其他函数联合使用，对向量中对所有元素实施某种统一的操作。针对此类操作，设计接口`traverse()`如下：\n\n```c++\ntemplate <typename T> void Vector<T>::traverse ( void ( *visit ) ( T& ) ) //借助函数指针机制\n{ for ( Rank i = 0; i < _size; i++ ) visit ( _elem[i] ); } //遍历向量\n\ntemplate <typename T> template <typename VST> //元素类型、操作器\nvoid Vector<T>::traverse ( VST& visit ) //借助函数对象机制\n{ for ( Rank i = 0; i < _size; i++ ) visit ( _elem[i] ); } //遍历向量\n```\n\n该算法设计了两个不同的接口。第一个接口接受一个函数指针，该函数指针指向的函数只有类型为`T&`的一个参数，将向量中的元素传递给该函数，然后进行进一步的操作。\n\n第二个接口通过函数对象的形式指定具体的遍历操作。所谓函数对象，就是在某个类中重载`()`操作符，在重载操作符的函数中实现其他复杂操作。这类对象在形式上等效于一个函数接口。\n\n显然，遍历算法的总体时间复杂度为$\\mathcal O (n)$。\n\n### 有序性甄别\n\n在有序向量中，向量的元素按顺序排列，这为许多操作提供了额外的信息，可以简化算法。在考虑是否要使用有序向量的简化算法时，需要首先判断一个向量是否有序。\n\n判断向量有序的方法很简单，也就是顺序扫描整个向量，逐一比较每一对相邻元素。如果两相邻元素出现了逆序的情形，那么向量就是无序的。这个思想与起泡排序中的相同。\n\n### 唯一化\n\n很多应用中，在进一步处理之前都需要容器中的元素互异。例如，搜索引擎就要求搜索结果中没有重复的条目。向量的唯一化处理，就是剔除向量中的重复元素。\n\n#### 无序向量\n\n```c++\ntemplate <typename T> Rank Vector<T>::deduplicate() { //删除无序向量中重复元素（高效版）\n   Rank oldSize = _size; //记录原规模\n   for ( Rank i = 1; i < _size; ) //自前向后逐个考查_elem[1,_size)\n      if ( find(_elem[i], 0, i) < 0 ) //在前缀[0,i)中寻找与之雷同者（至多一个）\n         i++; //若无雷同则继续考查其后继\n      else\n         remove(i); //否则删除当前元素\n   return oldSize - _size; //被删除元素总数\n}\n```\n\n该算法的执行思路很简单。在循环的整个过程中，前缀`_elem[0, i)`中的所有元素均彼此互异。如果在某一步循环中没有找到雷同元素，那么在`i++`后前缀中依旧没有重复的元素；如果找到了雷同的元素，那么将其删除之后前缀将仍然没有重复的元素。所以当`i = _size`时，其所有前缀都将不含有重复的元素，也即向量中所有的元素都不重复。\n\n每一步迭代之后，算法中当前元素`_elem[i]`的后缀都会持续减少。每一步迭代需要的时间主要消耗于`find()`和`remove()`两个函数，其中`find()`需要的时间取决于前缀的长度，`remove()`需要的时间取决于后缀的长度。因此，每一步迭代需要的时间不会超过$\\mathcal O (n)$。又因为该算法经过$\\mathcal O (n)$次迭代之后必然终止，因此其总体复杂度为$\\mathcal O (n^2)$。\n\n#### 有序向量\n\n为了清除有序向量中的重复元素，可以仿照无序向量的清楚重复元素的算法。对于有序向量的不同之处在于，它内部的重复元素必然前后紧邻。于是我们便不需要像在无序向量中一样调用`find()`函数，而只需要自前向后地逐一检查各个相邻元素，如果二者雷同则调用`remove()`函数删除后者，否则转向下一对相邻元素。\n\n该算法运行时间主要消耗于循环部分，一共需要迭代`n - 1`步。在最坏的情况下，每次都要执行一次`remove()`操作。又因为`remove()`操作的复杂度线性正比于被删除元素的后缀长度，因此在最坏情况下有$(n - 2) + (n - 3) + ... + 2 + 1 = \\mathcal O (n^2)$次操作，与无序向量去重的复杂度相同！完全没有体现有序向量的优势。\n\n上述算法复杂度过高的根源来自于，在对`remove()`的各次调用中，同一元素可能作为后继多次向前移动，且每次仅移动一个单元。对此的解决办法是，如果有多个雷同的元素，那么就将它们一次性删除好了，这样后缀就可以大跨度地前移。算法实现如下：\n\n```c++\ntemplate <typename T> Rank Vector<T>::uniquify() { //有序向量重复元素剔除算法（高效版）\n   Rank i = 0, j = 0; //各对互异“相邻”元素的秩\n   while ( ++j < _size ) //逐一扫描，直至末元素\n      if ( _elem[i] != _elem[j] ) //跳过雷同者\n         _elem[++i] = _elem[j]; //发现不同元素时，向前移至紧邻于前者右侧\n   _size = ++i; shrink(); //直接截除尾部多余元素\n   return j - i; //向量规模变化量，即被删除元素总数\n}\n```\n\n该算法的核心思想就在于：既然各组重复元素必然彼此相邻地构成一个子区间，因此只需要依次保留各个区间的起始元素。从原始向量的角度来看（假设这个算法不进行实际的删除操作），算法中的`i`与`j`指向的都是下一对相邻区间的首元素；从修改后的向量的角度来看，`i`和`j`分别指向已去重的序列的末尾和即将加入去重序列的新的最后一个元素。下图给出了该算法运行的一个实例：\n\n![有序向量唯一化算法实例](https://astrobear.top/resource/astroblog/content/dsa-4-1.png)\n\n该算法同样直接通过改变`_size`的值，将尾部多余的元素截除了。`i`为已去重序列的的最后一个元素的索引，将其加一即可得到去重向量的规模。\n\n上面的算法每经过一次迭代`j`就加一，直到达到向量的规模`n`，总共需要迭代`n`次，时间复杂度为$\\mathcal O (n)$。\n","source":"_posts/dsa-4.md","raw":"---\ntitle: DSA-4：向量及其接口设计2\ndate: 2022-03-22 16:20:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 向量接口的实现。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n## 向量的基本接口\n\n### 引用元素\n\n在向量类中，元素的访问方式就是通过下标。因此，可以在向量类中重载操作符`[]`来实现这个功能。向量的索引也就是其内部私有数组`_elem[]`的索引。该算法实现起来没有难度，但是要注意在重载的时候需要合理使用`const`修饰符来控制被访问元素的可更改性。\n\n### 置乱器\n\n在软件测试、仿真模拟等应用中，经常需要使用到随机向量。随机向量随机性的高低直接影响到测试的覆盖面大小与仿真结果的优劣。\n\n向量中的置乱器`unsort()`就提供了生成随机向量的功能。该算法从待置乱区间的末元素开始，逆序地向前逐一处理各个元素。对每一个当前元素，都与随机生成的第`rand() % i`个不超过`i`的元素进行交换。经过每一步这样的处理，置乱区间就会向前拓展一个单元。经$\\mathcal O (n)$次迭代后，实现整个向量的置乱。算法实现如下：\n\n```C++\ntemplate <typename T> void Vector<T>::unsort ( Rank lo, Rank hi ) { //等概率随机置乱区间[lo, hi)\n   T* V = _elem + lo; //将子向量_elem[lo, hi)视作另一向量V[0, hi - lo)\n   for ( Rank i = hi - lo; i > 0; i-- ) //自后向前\n      swap ( V[i - 1], V[rand() % i] ); //将V[i - 1]与V[0, i)中某一元素随机交换\n}\n```\n\n### 判等器与比较器\n\n首先要分清两个概念：\n\n- 判等：判断两个对象是否相等，亦被称为比对\n- 比较：判断两个对象的相对大小\n\n在[上一篇文章](https://astrobear.top/2022/03/17/dsa-3/)中我们说过，在设计向量类时假设其中的元素都是可以互相比较大小的。因此对于向量中可能存储的元素类型`T`，我们需要针对其设计判等器与比较器。有两种方法可以用来实现判等器与比较器：\n\n- 使用函数封装\n- 重载关系比较操作符\n\n判等器和比较器对有序向量来说至关重要，*有序向量*中的元素必须存在某种可以比较相对大小的关系才能称之为有序。\n\n关于有序向量，我们约定其中的元素**自前向后（秩由小到大）的元素构成一个非降序列**。即对一向量$S[0, n)$，若有任意的秩$i, j$满足$0 \\le i < j < n$，有$S[i] \\le S[j]$。\n\n### 插入\n\n插入函数需要首先调用`expand()`函数检查`_elem[]`是否即将溢出，在必要时对向量进行扩容。然后，为了保证向量（数组）元素的物理地址连续，需要将插入元素所在位置的后缀整体后移一个单元。在这之后，才能在目标位置置入对象并更新向量规模。算法实现如下：\n\n```c++\ntemplate <typename T> //将e作为秩为r元素插入\nRank Vector<T>::insert ( Rank r, T const& e ) { //assert: 0 <= r <= size\n   expand(); //若有必要，扩容\n   for ( Rank i = _size; r < i; i-- ) //自后向前，后继元素\n      _elem[i] = _elem[i-1]; //顺次后移一个单元\n   _elem[r] = e; _size++; //置入新元素并更新容量\n   return r; //返回秩\n}\n```\n\n插入算法的时间消耗主要来源于后缀的后移，线性正比于后缀长度，因此其时间复杂度为$\\mathcal O (\\underline{}size - r +1)$。时间复杂度里的`+ 1`可以理解为插入元素操作需要的时间，其中包括置入元素与更新向量规模。当`r = _size`时为最好情况，需要$\\mathcal O (1)$时间；`r = 0`时为最坏情况，需要$\\mathcal O (\\underline{} size)$时间。一般来说，若插入位置等概率分布，那么平均运行时间为$\\mathcal O (\\underline{}size) = \\mathcal O (n)$。\n\n### 删除\n\n删除操作有两个接口：`remove(lo, hi)`用于删除区间`[lo, hi)`中的元素，`remove(r)`用于删除秩为`r`的单个元素。为了减少元素移动的次数，应当将删除单个元素的情形作为删除多个元素的情形的特例，基于后者来实现前者。\n\n下面先给出了区间删除的代码：\n\n```c++\ntemplate <typename T> int Vector<T>::remove ( Rank lo, Rank hi ) { //删除区间[lo, hi)\n   if ( lo == hi ) return 0; //出于效率考虑，单独处理退化情况，比如remove(0, 0)\n   while ( hi < _size ) //区间[hi, _size)\n      _elem[lo++] = _elem[hi++]; //顺次前移hi - lo个单元\n   _size = lo; //更新规模，直接丢弃尾部[lo, _size = hi)区间\n   shrink(); //若有必要，则缩容\n   return hi - lo; //返回被删除元素的数目\n}\n```\n\n上面的代码无非就是将被删除区间直接使用其后缀覆盖，然后通过调整`_size`的值直接丢弃尾部长为`hi - lo`的空间。最后调用`shrink()`，在一定条件下进行缩容。\n\n实现了区间删除后再实现单元素删除就很简单了，只需要在`remove(r)`中调用`remove(r, r+1)`即可。\n\n与插入类似，删除算法的时间消耗主要来自于后缀的前移，线性正比于后缀长度，总体不超过$\\mathcal O (\\underline{}size - hi + 1)$时间。时间复杂度里的`+ 1`可以理解为删除元素操作需要的时间，这里为更新向量规模。由此可知，区间删除操作需要的时间仅仅取决于后缀中元素的数目，与被删除区间本身的宽度无关。\n\n### 查找\n\n根据向量的类型，查找的算法有所区别。由于无序向量中没有更多的信息可以借助，在最坏的情况下，只有在访问完所有的元素之后才能得出查找结论。\n\n这里介绍针对无序向量的查找算法：算法从末元素出发，自后向前逐一取出各个元素并与目标元素进行比对，直到发现与之相等者。这种逐个比对的查找方式称作顺序查找。算法如下：\n\n```c++\ntemplate <typename T> //无序向量的顺序查找：返回最后一个元素e的位置；失败时，返回lo - 1\nRank Vector<T>::find ( T const& e, Rank lo, Rank hi ) const { //assert: 0 <= lo < hi <= _size\n   while ( ( lo < hi-- ) && ( e != _elem[hi] ) ); //从后向前，顺序查找\n   return hi; //若hi < lo，则意味着失败；否则hi即命中元素的秩\n}\n```\n\n该算法在有多个元素命中时，会返回其中秩最大的元素。另外，查找失败时统一返回`lo - 1`。当`lo`为`0`时，查找失败也不至于导致`_elem[]`数组越界。因为在第三行中一旦出现`lo < hi--`，后面的语句也不会执行。\n\n由于该算法是按顺序线性查找的，因此在最坏的情况下查找终止于首元素`_elem[lo]`，运行时间为$\\mathcal O (n)$。在最好的情况下，查找命中于末元素`_elem[hi - 1]`，仅需要$\\mathcal O (1))$时间。总而言之，该算法的运行时间取决于雷同元素的前缀长度。\n\n对于规模相同、内部组成不同的输入，算法的渐进运行时间却有本质区别，因此此类算法也称作输入敏感的算法。\n\n### 遍历\n\n遍历算法可以与其他函数联合使用，对向量中对所有元素实施某种统一的操作。针对此类操作，设计接口`traverse()`如下：\n\n```c++\ntemplate <typename T> void Vector<T>::traverse ( void ( *visit ) ( T& ) ) //借助函数指针机制\n{ for ( Rank i = 0; i < _size; i++ ) visit ( _elem[i] ); } //遍历向量\n\ntemplate <typename T> template <typename VST> //元素类型、操作器\nvoid Vector<T>::traverse ( VST& visit ) //借助函数对象机制\n{ for ( Rank i = 0; i < _size; i++ ) visit ( _elem[i] ); } //遍历向量\n```\n\n该算法设计了两个不同的接口。第一个接口接受一个函数指针，该函数指针指向的函数只有类型为`T&`的一个参数，将向量中的元素传递给该函数，然后进行进一步的操作。\n\n第二个接口通过函数对象的形式指定具体的遍历操作。所谓函数对象，就是在某个类中重载`()`操作符，在重载操作符的函数中实现其他复杂操作。这类对象在形式上等效于一个函数接口。\n\n显然，遍历算法的总体时间复杂度为$\\mathcal O (n)$。\n\n### 有序性甄别\n\n在有序向量中，向量的元素按顺序排列，这为许多操作提供了额外的信息，可以简化算法。在考虑是否要使用有序向量的简化算法时，需要首先判断一个向量是否有序。\n\n判断向量有序的方法很简单，也就是顺序扫描整个向量，逐一比较每一对相邻元素。如果两相邻元素出现了逆序的情形，那么向量就是无序的。这个思想与起泡排序中的相同。\n\n### 唯一化\n\n很多应用中，在进一步处理之前都需要容器中的元素互异。例如，搜索引擎就要求搜索结果中没有重复的条目。向量的唯一化处理，就是剔除向量中的重复元素。\n\n#### 无序向量\n\n```c++\ntemplate <typename T> Rank Vector<T>::deduplicate() { //删除无序向量中重复元素（高效版）\n   Rank oldSize = _size; //记录原规模\n   for ( Rank i = 1; i < _size; ) //自前向后逐个考查_elem[1,_size)\n      if ( find(_elem[i], 0, i) < 0 ) //在前缀[0,i)中寻找与之雷同者（至多一个）\n         i++; //若无雷同则继续考查其后继\n      else\n         remove(i); //否则删除当前元素\n   return oldSize - _size; //被删除元素总数\n}\n```\n\n该算法的执行思路很简单。在循环的整个过程中，前缀`_elem[0, i)`中的所有元素均彼此互异。如果在某一步循环中没有找到雷同元素，那么在`i++`后前缀中依旧没有重复的元素；如果找到了雷同的元素，那么将其删除之后前缀将仍然没有重复的元素。所以当`i = _size`时，其所有前缀都将不含有重复的元素，也即向量中所有的元素都不重复。\n\n每一步迭代之后，算法中当前元素`_elem[i]`的后缀都会持续减少。每一步迭代需要的时间主要消耗于`find()`和`remove()`两个函数，其中`find()`需要的时间取决于前缀的长度，`remove()`需要的时间取决于后缀的长度。因此，每一步迭代需要的时间不会超过$\\mathcal O (n)$。又因为该算法经过$\\mathcal O (n)$次迭代之后必然终止，因此其总体复杂度为$\\mathcal O (n^2)$。\n\n#### 有序向量\n\n为了清除有序向量中的重复元素，可以仿照无序向量的清楚重复元素的算法。对于有序向量的不同之处在于，它内部的重复元素必然前后紧邻。于是我们便不需要像在无序向量中一样调用`find()`函数，而只需要自前向后地逐一检查各个相邻元素，如果二者雷同则调用`remove()`函数删除后者，否则转向下一对相邻元素。\n\n该算法运行时间主要消耗于循环部分，一共需要迭代`n - 1`步。在最坏的情况下，每次都要执行一次`remove()`操作。又因为`remove()`操作的复杂度线性正比于被删除元素的后缀长度，因此在最坏情况下有$(n - 2) + (n - 3) + ... + 2 + 1 = \\mathcal O (n^2)$次操作，与无序向量去重的复杂度相同！完全没有体现有序向量的优势。\n\n上述算法复杂度过高的根源来自于，在对`remove()`的各次调用中，同一元素可能作为后继多次向前移动，且每次仅移动一个单元。对此的解决办法是，如果有多个雷同的元素，那么就将它们一次性删除好了，这样后缀就可以大跨度地前移。算法实现如下：\n\n```c++\ntemplate <typename T> Rank Vector<T>::uniquify() { //有序向量重复元素剔除算法（高效版）\n   Rank i = 0, j = 0; //各对互异“相邻”元素的秩\n   while ( ++j < _size ) //逐一扫描，直至末元素\n      if ( _elem[i] != _elem[j] ) //跳过雷同者\n         _elem[++i] = _elem[j]; //发现不同元素时，向前移至紧邻于前者右侧\n   _size = ++i; shrink(); //直接截除尾部多余元素\n   return j - i; //向量规模变化量，即被删除元素总数\n}\n```\n\n该算法的核心思想就在于：既然各组重复元素必然彼此相邻地构成一个子区间，因此只需要依次保留各个区间的起始元素。从原始向量的角度来看（假设这个算法不进行实际的删除操作），算法中的`i`与`j`指向的都是下一对相邻区间的首元素；从修改后的向量的角度来看，`i`和`j`分别指向已去重的序列的末尾和即将加入去重序列的新的最后一个元素。下图给出了该算法运行的一个实例：\n\n![有序向量唯一化算法实例](https://astrobear.top/resource/astroblog/content/dsa-4-1.png)\n\n该算法同样直接通过改变`_size`的值，将尾部多余的元素截除了。`i`为已去重序列的的最后一个元素的索引，将其加一即可得到去重向量的规模。\n\n上面的算法每经过一次迭代`j`就加一，直到达到向量的规模`n`，总共需要迭代`n`次，时间复杂度为$\\mathcal O (n)$。\n","slug":"dsa-4","published":1,"updated":"2022-03-23T13:56:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz07001a1q39627y9jcu","content":"<h2 id=\"向量的基本接口\"><a href=\"#向量的基本接口\" class=\"headerlink\" title=\"向量的基本接口\"></a>向量的基本接口</h2><h3 id=\"引用元素\"><a href=\"#引用元素\" class=\"headerlink\" title=\"引用元素\"></a>引用元素</h3><p>在向量类中，元素的访问方式就是通过下标。因此，可以在向量类中重载操作符<code>[]</code>来实现这个功能。向量的索引也就是其内部私有数组<code>_elem[]</code>的索引。该算法实现起来没有难度，但是要注意在重载的时候需要合理使用<code>const</code>修饰符来控制被访问元素的可更改性。</p>\n<h3 id=\"置乱器\"><a href=\"#置乱器\" class=\"headerlink\" title=\"置乱器\"></a>置乱器</h3><p>在软件测试、仿真模拟等应用中，经常需要使用到随机向量。随机向量随机性的高低直接影响到测试的覆盖面大小与仿真结果的优劣。</p>\n<p>向量中的置乱器<code>unsort()</code>就提供了生成随机向量的功能。该算法从待置乱区间的末元素开始，逆序地向前逐一处理各个元素。对每一个当前元素，都与随机生成的第<code>rand() % i</code>个不超过<code>i</code>的元素进行交换。经过每一步这样的处理，置乱区间就会向前拓展一个单元。经$\\mathcal O (n)$次迭代后，实现整个向量的置乱。算法实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">unsort</span> ( Rank lo, Rank hi ) &#123; <span class=\"comment\">//等概率随机置乱区间[lo, hi)</span></span><br><span class=\"line\">   T* V = _elem + lo; <span class=\"comment\">//将子向量_elem[lo, hi)视作另一向量V[0, hi - lo)</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = hi - lo; i &gt; <span class=\"number\">0</span>; i-- ) <span class=\"comment\">//自后向前</span></span><br><span class=\"line\">      <span class=\"built_in\">swap</span> ( V[i - <span class=\"number\">1</span>], V[<span class=\"built_in\">rand</span>() % i] ); <span class=\"comment\">//将V[i - 1]与V[0, i)中某一元素随机交换</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"判等器与比较器\"><a href=\"#判等器与比较器\" class=\"headerlink\" title=\"判等器与比较器\"></a>判等器与比较器</h3><p>首先要分清两个概念：</p>\n<ul>\n<li>判等：判断两个对象是否相等，亦被称为比对</li>\n<li>比较：判断两个对象的相对大小</li>\n</ul>\n<p>在<a href=\"https://astrobear.top/2022/03/17/dsa-3/\">上一篇文章</a>中我们说过，在设计向量类时假设其中的元素都是可以互相比较大小的。因此对于向量中可能存储的元素类型<code>T</code>，我们需要针对其设计判等器与比较器。有两种方法可以用来实现判等器与比较器：</p>\n<ul>\n<li>使用函数封装</li>\n<li>重载关系比较操作符</li>\n</ul>\n<p>判等器和比较器对有序向量来说至关重要，<em>有序向量</em>中的元素必须存在某种可以比较相对大小的关系才能称之为有序。</p>\n<p>关于有序向量，我们约定其中的元素<strong>自前向后（秩由小到大）的元素构成一个非降序列</strong>。即对一向量$S[0, n)$，若有任意的秩$i, j$满足$0 \\le i &lt; j &lt; n$，有$S[i] \\le S[j]$。</p>\n<h3 id=\"插入\"><a href=\"#插入\" class=\"headerlink\" title=\"插入\"></a>插入</h3><p>插入函数需要首先调用<code>expand()</code>函数检查<code>_elem[]</code>是否即将溢出，在必要时对向量进行扩容。然后，为了保证向量（数组）元素的物理地址连续，需要将插入元素所在位置的后缀整体后移一个单元。在这之后，才能在目标位置置入对象并更新向量规模。算法实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//将e作为秩为r元素插入</span></span><br><span class=\"line\">Rank Vector&lt;T&gt;::<span class=\"built_in\">insert</span> ( Rank r, T <span class=\"keyword\">const</span>&amp; e ) &#123; <span class=\"comment\">//assert: 0 &lt;= r &lt;= size</span></span><br><span class=\"line\">   <span class=\"built_in\">expand</span>(); <span class=\"comment\">//若有必要，扩容</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = _size; r &lt; i; i-- ) <span class=\"comment\">//自后向前，后继元素</span></span><br><span class=\"line\">      _elem[i] = _elem[i<span class=\"number\">-1</span>]; <span class=\"comment\">//顺次后移一个单元</span></span><br><span class=\"line\">   _elem[r] = e; _size++; <span class=\"comment\">//置入新元素并更新容量</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> r; <span class=\"comment\">//返回秩</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>插入算法的时间消耗主要来源于后缀的后移，线性正比于后缀长度，因此其时间复杂度为$\\mathcal O (\\underline{}size - r +1)$。时间复杂度里的<code>+ 1</code>可以理解为插入元素操作需要的时间，其中包括置入元素与更新向量规模。当<code>r = _size</code>时为最好情况，需要$\\mathcal O (1)$时间；<code>r = 0</code>时为最坏情况，需要$\\mathcal O (\\underline{} size)$时间。一般来说，若插入位置等概率分布，那么平均运行时间为$\\mathcal O (\\underline{}size) = \\mathcal O (n)$。</p>\n<h3 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h3><p>删除操作有两个接口：<code>remove(lo, hi)</code>用于删除区间<code>[lo, hi)</code>中的元素，<code>remove(r)</code>用于删除秩为<code>r</code>的单个元素。为了减少元素移动的次数，应当将删除单个元素的情形作为删除多个元素的情形的特例，基于后者来实现前者。</p>\n<p>下面先给出了区间删除的代码：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">int</span> Vector&lt;T&gt;::<span class=\"built_in\">remove</span> ( Rank lo, Rank hi ) &#123; <span class=\"comment\">//删除区间[lo, hi)</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( lo == hi ) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; <span class=\"comment\">//出于效率考虑，单独处理退化情况，比如remove(0, 0)</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( hi &lt; _size ) <span class=\"comment\">//区间[hi, _size)</span></span><br><span class=\"line\">      _elem[lo++] = _elem[hi++]; <span class=\"comment\">//顺次前移hi - lo个单元</span></span><br><span class=\"line\">   _size = lo; <span class=\"comment\">//更新规模，直接丢弃尾部[lo, _size = hi)区间</span></span><br><span class=\"line\">   <span class=\"built_in\">shrink</span>(); <span class=\"comment\">//若有必要，则缩容</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> hi - lo; <span class=\"comment\">//返回被删除元素的数目</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码无非就是将被删除区间直接使用其后缀覆盖，然后通过调整<code>_size</code>的值直接丢弃尾部长为<code>hi - lo</code>的空间。最后调用<code>shrink()</code>，在一定条件下进行缩容。</p>\n<p>实现了区间删除后再实现单元素删除就很简单了，只需要在<code>remove(r)</code>中调用<code>remove(r, r+1)</code>即可。</p>\n<p>与插入类似，删除算法的时间消耗主要来自于后缀的前移，线性正比于后缀长度，总体不超过$\\mathcal O (\\underline{}size - hi + 1)$时间。时间复杂度里的<code>+ 1</code>可以理解为删除元素操作需要的时间，这里为更新向量规模。由此可知，区间删除操作需要的时间仅仅取决于后缀中元素的数目，与被删除区间本身的宽度无关。</p>\n<h3 id=\"查找\"><a href=\"#查找\" class=\"headerlink\" title=\"查找\"></a>查找</h3><p>根据向量的类型，查找的算法有所区别。由于无序向量中没有更多的信息可以借助，在最坏的情况下，只有在访问完所有的元素之后才能得出查找结论。</p>\n<p>这里介绍针对无序向量的查找算法：算法从末元素出发，自后向前逐一取出各个元素并与目标元素进行比对，直到发现与之相等者。这种逐个比对的查找方式称作顺序查找。算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//无序向量的顺序查找：返回最后一个元素e的位置；失败时，返回lo - 1</span></span><br><span class=\"line\">Rank Vector&lt;T&gt;::<span class=\"built_in\">find</span> ( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi ) <span class=\"keyword\">const</span> &#123; <span class=\"comment\">//assert: 0 &lt;= lo &lt; hi &lt;= _size</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( ( lo &lt; hi-- ) &amp;&amp; ( e != _elem[hi] ) ); <span class=\"comment\">//从后向前，顺序查找</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> hi; <span class=\"comment\">//若hi &lt; lo，则意味着失败；否则hi即命中元素的秩</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法在有多个元素命中时，会返回其中秩最大的元素。另外，查找失败时统一返回<code>lo - 1</code>。当<code>lo</code>为<code>0</code>时，查找失败也不至于导致<code>_elem[]</code>数组越界。因为在第三行中一旦出现<code>lo &lt; hi--</code>，后面的语句也不会执行。</p>\n<p>由于该算法是按顺序线性查找的，因此在最坏的情况下查找终止于首元素<code>_elem[lo]</code>，运行时间为$\\mathcal O (n)$。在最好的情况下，查找命中于末元素<code>_elem[hi - 1]</code>，仅需要$\\mathcal O (1))$时间。总而言之，该算法的运行时间取决于雷同元素的前缀长度。</p>\n<p>对于规模相同、内部组成不同的输入，算法的渐进运行时间却有本质区别，因此此类算法也称作输入敏感的算法。</p>\n<h3 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h3><p>遍历算法可以与其他函数联合使用，对向量中对所有元素实施某种统一的操作。针对此类操作，设计接口<code>traverse()</code>如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">traverse</span> ( <span class=\"built_in\"><span class=\"keyword\">void</span></span> ( *visit ) ( T&amp; ) ) <span class=\"comment\">//借助函数指针机制</span></span><br><span class=\"line\">&#123; <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ ) <span class=\"built_in\">visit</span> ( _elem[i] ); &#125; <span class=\"comment\">//遍历向量</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"comment\">//元素类型、操作器</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">traverse</span> ( VST&amp; visit ) <span class=\"comment\">//借助函数对象机制</span></span><br><span class=\"line\">&#123; <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ ) <span class=\"built_in\">visit</span> ( _elem[i] ); &#125; <span class=\"comment\">//遍历向量</span></span><br></pre></td></tr></table></figure>\n\n<p>该算法设计了两个不同的接口。第一个接口接受一个函数指针，该函数指针指向的函数只有类型为<code>T&amp;</code>的一个参数，将向量中的元素传递给该函数，然后进行进一步的操作。</p>\n<p>第二个接口通过函数对象的形式指定具体的遍历操作。所谓函数对象，就是在某个类中重载<code>()</code>操作符，在重载操作符的函数中实现其他复杂操作。这类对象在形式上等效于一个函数接口。</p>\n<p>显然，遍历算法的总体时间复杂度为$\\mathcal O (n)$。</p>\n<h3 id=\"有序性甄别\"><a href=\"#有序性甄别\" class=\"headerlink\" title=\"有序性甄别\"></a>有序性甄别</h3><p>在有序向量中，向量的元素按顺序排列，这为许多操作提供了额外的信息，可以简化算法。在考虑是否要使用有序向量的简化算法时，需要首先判断一个向量是否有序。</p>\n<p>判断向量有序的方法很简单，也就是顺序扫描整个向量，逐一比较每一对相邻元素。如果两相邻元素出现了逆序的情形，那么向量就是无序的。这个思想与起泡排序中的相同。</p>\n<h3 id=\"唯一化\"><a href=\"#唯一化\" class=\"headerlink\" title=\"唯一化\"></a>唯一化</h3><p>很多应用中，在进一步处理之前都需要容器中的元素互异。例如，搜索引擎就要求搜索结果中没有重复的条目。向量的唯一化处理，就是剔除向量中的重复元素。</p>\n<h4 id=\"无序向量\"><a href=\"#无序向量\" class=\"headerlink\" title=\"无序向量\"></a>无序向量</h4><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; Rank Vector&lt;T&gt;::<span class=\"built_in\">deduplicate</span>() &#123; <span class=\"comment\">//删除无序向量中重复元素（高效版）</span></span><br><span class=\"line\">   Rank oldSize = _size; <span class=\"comment\">//记录原规模</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">1</span>; i &lt; _size; ) <span class=\"comment\">//自前向后逐个考查_elem[1,_size)</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( <span class=\"built_in\">find</span>(_elem[i], <span class=\"number\">0</span>, i) &lt; <span class=\"number\">0</span> ) <span class=\"comment\">//在前缀[0,i)中寻找与之雷同者（至多一个）</span></span><br><span class=\"line\">         i++; <span class=\"comment\">//若无雷同则继续考查其后继</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">         <span class=\"built_in\">remove</span>(i); <span class=\"comment\">//否则删除当前元素</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> oldSize - _size; <span class=\"comment\">//被删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法的执行思路很简单。在循环的整个过程中，前缀<code>_elem[0, i)</code>中的所有元素均彼此互异。如果在某一步循环中没有找到雷同元素，那么在<code>i++</code>后前缀中依旧没有重复的元素；如果找到了雷同的元素，那么将其删除之后前缀将仍然没有重复的元素。所以当<code>i = _size</code>时，其所有前缀都将不含有重复的元素，也即向量中所有的元素都不重复。</p>\n<p>每一步迭代之后，算法中当前元素<code>_elem[i]</code>的后缀都会持续减少。每一步迭代需要的时间主要消耗于<code>find()</code>和<code>remove()</code>两个函数，其中<code>find()</code>需要的时间取决于前缀的长度，<code>remove()</code>需要的时间取决于后缀的长度。因此，每一步迭代需要的时间不会超过$\\mathcal O (n)$。又因为该算法经过$\\mathcal O (n)$次迭代之后必然终止，因此其总体复杂度为$\\mathcal O (n^2)$。</p>\n<h4 id=\"有序向量\"><a href=\"#有序向量\" class=\"headerlink\" title=\"有序向量\"></a>有序向量</h4><p>为了清除有序向量中的重复元素，可以仿照无序向量的清楚重复元素的算法。对于有序向量的不同之处在于，它内部的重复元素必然前后紧邻。于是我们便不需要像在无序向量中一样调用<code>find()</code>函数，而只需要自前向后地逐一检查各个相邻元素，如果二者雷同则调用<code>remove()</code>函数删除后者，否则转向下一对相邻元素。</p>\n<p>该算法运行时间主要消耗于循环部分，一共需要迭代<code>n - 1</code>步。在最坏的情况下，每次都要执行一次<code>remove()</code>操作。又因为<code>remove()</code>操作的复杂度线性正比于被删除元素的后缀长度，因此在最坏情况下有$(n - 2) + (n - 3) + … + 2 + 1 = \\mathcal O (n^2)$次操作，与无序向量去重的复杂度相同！完全没有体现有序向量的优势。</p>\n<p>上述算法复杂度过高的根源来自于，在对<code>remove()</code>的各次调用中，同一元素可能作为后继多次向前移动，且每次仅移动一个单元。对此的解决办法是，如果有多个雷同的元素，那么就将它们一次性删除好了，这样后缀就可以大跨度地前移。算法实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; Rank Vector&lt;T&gt;::<span class=\"built_in\">uniquify</span>() &#123; <span class=\"comment\">//有序向量重复元素剔除算法（高效版）</span></span><br><span class=\"line\">   Rank i = <span class=\"number\">0</span>, j = <span class=\"number\">0</span>; <span class=\"comment\">//各对互异“相邻”元素的秩</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( ++j &lt; _size ) <span class=\"comment\">//逐一扫描，直至末元素</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( _elem[i] != _elem[j] ) <span class=\"comment\">//跳过雷同者</span></span><br><span class=\"line\">         _elem[++i] = _elem[j]; <span class=\"comment\">//发现不同元素时，向前移至紧邻于前者右侧</span></span><br><span class=\"line\">   _size = ++i; <span class=\"built_in\">shrink</span>(); <span class=\"comment\">//直接截除尾部多余元素</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> j - i; <span class=\"comment\">//向量规模变化量，即被删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法的核心思想就在于：既然各组重复元素必然彼此相邻地构成一个子区间，因此只需要依次保留各个区间的起始元素。从原始向量的角度来看（假设这个算法不进行实际的删除操作），算法中的<code>i</code>与<code>j</code>指向的都是下一对相邻区间的首元素；从修改后的向量的角度来看，<code>i</code>和<code>j</code>分别指向已去重的序列的末尾和即将加入去重序列的新的最后一个元素。下图给出了该算法运行的一个实例：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-4-1.png\" alt=\"有序向量唯一化算法实例\"></p>\n<p>该算法同样直接通过改变<code>_size</code>的值，将尾部多余的元素截除了。<code>i</code>为已去重序列的的最后一个元素的索引，将其加一即可得到去重向量的规模。</p>\n<p>上面的算法每经过一次迭代<code>j</code>就加一，直到达到向量的规模<code>n</code>，总共需要迭代<code>n</code>次，时间复杂度为$\\mathcal O (n)$。</p>\n","site":{"data":{}},"more":"<h2 id=\"向量的基本接口\"><a href=\"#向量的基本接口\" class=\"headerlink\" title=\"向量的基本接口\"></a>向量的基本接口</h2><h3 id=\"引用元素\"><a href=\"#引用元素\" class=\"headerlink\" title=\"引用元素\"></a>引用元素</h3><p>在向量类中，元素的访问方式就是通过下标。因此，可以在向量类中重载操作符<code>[]</code>来实现这个功能。向量的索引也就是其内部私有数组<code>_elem[]</code>的索引。该算法实现起来没有难度，但是要注意在重载的时候需要合理使用<code>const</code>修饰符来控制被访问元素的可更改性。</p>\n<h3 id=\"置乱器\"><a href=\"#置乱器\" class=\"headerlink\" title=\"置乱器\"></a>置乱器</h3><p>在软件测试、仿真模拟等应用中，经常需要使用到随机向量。随机向量随机性的高低直接影响到测试的覆盖面大小与仿真结果的优劣。</p>\n<p>向量中的置乱器<code>unsort()</code>就提供了生成随机向量的功能。该算法从待置乱区间的末元素开始，逆序地向前逐一处理各个元素。对每一个当前元素，都与随机生成的第<code>rand() % i</code>个不超过<code>i</code>的元素进行交换。经过每一步这样的处理，置乱区间就会向前拓展一个单元。经$\\mathcal O (n)$次迭代后，实现整个向量的置乱。算法实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">unsort</span> ( Rank lo, Rank hi ) &#123; <span class=\"comment\">//等概率随机置乱区间[lo, hi)</span></span><br><span class=\"line\">   T* V = _elem + lo; <span class=\"comment\">//将子向量_elem[lo, hi)视作另一向量V[0, hi - lo)</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = hi - lo; i &gt; <span class=\"number\">0</span>; i-- ) <span class=\"comment\">//自后向前</span></span><br><span class=\"line\">      <span class=\"built_in\">swap</span> ( V[i - <span class=\"number\">1</span>], V[<span class=\"built_in\">rand</span>() % i] ); <span class=\"comment\">//将V[i - 1]与V[0, i)中某一元素随机交换</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"判等器与比较器\"><a href=\"#判等器与比较器\" class=\"headerlink\" title=\"判等器与比较器\"></a>判等器与比较器</h3><p>首先要分清两个概念：</p>\n<ul>\n<li>判等：判断两个对象是否相等，亦被称为比对</li>\n<li>比较：判断两个对象的相对大小</li>\n</ul>\n<p>在<a href=\"https://astrobear.top/2022/03/17/dsa-3/\">上一篇文章</a>中我们说过，在设计向量类时假设其中的元素都是可以互相比较大小的。因此对于向量中可能存储的元素类型<code>T</code>，我们需要针对其设计判等器与比较器。有两种方法可以用来实现判等器与比较器：</p>\n<ul>\n<li>使用函数封装</li>\n<li>重载关系比较操作符</li>\n</ul>\n<p>判等器和比较器对有序向量来说至关重要，<em>有序向量</em>中的元素必须存在某种可以比较相对大小的关系才能称之为有序。</p>\n<p>关于有序向量，我们约定其中的元素<strong>自前向后（秩由小到大）的元素构成一个非降序列</strong>。即对一向量$S[0, n)$，若有任意的秩$i, j$满足$0 \\le i &lt; j &lt; n$，有$S[i] \\le S[j]$。</p>\n<h3 id=\"插入\"><a href=\"#插入\" class=\"headerlink\" title=\"插入\"></a>插入</h3><p>插入函数需要首先调用<code>expand()</code>函数检查<code>_elem[]</code>是否即将溢出，在必要时对向量进行扩容。然后，为了保证向量（数组）元素的物理地址连续，需要将插入元素所在位置的后缀整体后移一个单元。在这之后，才能在目标位置置入对象并更新向量规模。算法实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//将e作为秩为r元素插入</span></span><br><span class=\"line\">Rank Vector&lt;T&gt;::<span class=\"built_in\">insert</span> ( Rank r, T <span class=\"keyword\">const</span>&amp; e ) &#123; <span class=\"comment\">//assert: 0 &lt;= r &lt;= size</span></span><br><span class=\"line\">   <span class=\"built_in\">expand</span>(); <span class=\"comment\">//若有必要，扩容</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = _size; r &lt; i; i-- ) <span class=\"comment\">//自后向前，后继元素</span></span><br><span class=\"line\">      _elem[i] = _elem[i<span class=\"number\">-1</span>]; <span class=\"comment\">//顺次后移一个单元</span></span><br><span class=\"line\">   _elem[r] = e; _size++; <span class=\"comment\">//置入新元素并更新容量</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> r; <span class=\"comment\">//返回秩</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>插入算法的时间消耗主要来源于后缀的后移，线性正比于后缀长度，因此其时间复杂度为$\\mathcal O (\\underline{}size - r +1)$。时间复杂度里的<code>+ 1</code>可以理解为插入元素操作需要的时间，其中包括置入元素与更新向量规模。当<code>r = _size</code>时为最好情况，需要$\\mathcal O (1)$时间；<code>r = 0</code>时为最坏情况，需要$\\mathcal O (\\underline{} size)$时间。一般来说，若插入位置等概率分布，那么平均运行时间为$\\mathcal O (\\underline{}size) = \\mathcal O (n)$。</p>\n<h3 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h3><p>删除操作有两个接口：<code>remove(lo, hi)</code>用于删除区间<code>[lo, hi)</code>中的元素，<code>remove(r)</code>用于删除秩为<code>r</code>的单个元素。为了减少元素移动的次数，应当将删除单个元素的情形作为删除多个元素的情形的特例，基于后者来实现前者。</p>\n<p>下面先给出了区间删除的代码：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">int</span> Vector&lt;T&gt;::<span class=\"built_in\">remove</span> ( Rank lo, Rank hi ) &#123; <span class=\"comment\">//删除区间[lo, hi)</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( lo == hi ) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; <span class=\"comment\">//出于效率考虑，单独处理退化情况，比如remove(0, 0)</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( hi &lt; _size ) <span class=\"comment\">//区间[hi, _size)</span></span><br><span class=\"line\">      _elem[lo++] = _elem[hi++]; <span class=\"comment\">//顺次前移hi - lo个单元</span></span><br><span class=\"line\">   _size = lo; <span class=\"comment\">//更新规模，直接丢弃尾部[lo, _size = hi)区间</span></span><br><span class=\"line\">   <span class=\"built_in\">shrink</span>(); <span class=\"comment\">//若有必要，则缩容</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> hi - lo; <span class=\"comment\">//返回被删除元素的数目</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面的代码无非就是将被删除区间直接使用其后缀覆盖，然后通过调整<code>_size</code>的值直接丢弃尾部长为<code>hi - lo</code>的空间。最后调用<code>shrink()</code>，在一定条件下进行缩容。</p>\n<p>实现了区间删除后再实现单元素删除就很简单了，只需要在<code>remove(r)</code>中调用<code>remove(r, r+1)</code>即可。</p>\n<p>与插入类似，删除算法的时间消耗主要来自于后缀的前移，线性正比于后缀长度，总体不超过$\\mathcal O (\\underline{}size - hi + 1)$时间。时间复杂度里的<code>+ 1</code>可以理解为删除元素操作需要的时间，这里为更新向量规模。由此可知，区间删除操作需要的时间仅仅取决于后缀中元素的数目，与被删除区间本身的宽度无关。</p>\n<h3 id=\"查找\"><a href=\"#查找\" class=\"headerlink\" title=\"查找\"></a>查找</h3><p>根据向量的类型，查找的算法有所区别。由于无序向量中没有更多的信息可以借助，在最坏的情况下，只有在访问完所有的元素之后才能得出查找结论。</p>\n<p>这里介绍针对无序向量的查找算法：算法从末元素出发，自后向前逐一取出各个元素并与目标元素进行比对，直到发现与之相等者。这种逐个比对的查找方式称作顺序查找。算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//无序向量的顺序查找：返回最后一个元素e的位置；失败时，返回lo - 1</span></span><br><span class=\"line\">Rank Vector&lt;T&gt;::<span class=\"built_in\">find</span> ( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi ) <span class=\"keyword\">const</span> &#123; <span class=\"comment\">//assert: 0 &lt;= lo &lt; hi &lt;= _size</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( ( lo &lt; hi-- ) &amp;&amp; ( e != _elem[hi] ) ); <span class=\"comment\">//从后向前，顺序查找</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> hi; <span class=\"comment\">//若hi &lt; lo，则意味着失败；否则hi即命中元素的秩</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法在有多个元素命中时，会返回其中秩最大的元素。另外，查找失败时统一返回<code>lo - 1</code>。当<code>lo</code>为<code>0</code>时，查找失败也不至于导致<code>_elem[]</code>数组越界。因为在第三行中一旦出现<code>lo &lt; hi--</code>，后面的语句也不会执行。</p>\n<p>由于该算法是按顺序线性查找的，因此在最坏的情况下查找终止于首元素<code>_elem[lo]</code>，运行时间为$\\mathcal O (n)$。在最好的情况下，查找命中于末元素<code>_elem[hi - 1]</code>，仅需要$\\mathcal O (1))$时间。总而言之，该算法的运行时间取决于雷同元素的前缀长度。</p>\n<p>对于规模相同、内部组成不同的输入，算法的渐进运行时间却有本质区别，因此此类算法也称作输入敏感的算法。</p>\n<h3 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h3><p>遍历算法可以与其他函数联合使用，对向量中对所有元素实施某种统一的操作。针对此类操作，设计接口<code>traverse()</code>如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">traverse</span> ( <span class=\"built_in\"><span class=\"keyword\">void</span></span> ( *visit ) ( T&amp; ) ) <span class=\"comment\">//借助函数指针机制</span></span><br><span class=\"line\">&#123; <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ ) <span class=\"built_in\">visit</span> ( _elem[i] ); &#125; <span class=\"comment\">//遍历向量</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"comment\">//元素类型、操作器</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">traverse</span> ( VST&amp; visit ) <span class=\"comment\">//借助函数对象机制</span></span><br><span class=\"line\">&#123; <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; _size; i++ ) <span class=\"built_in\">visit</span> ( _elem[i] ); &#125; <span class=\"comment\">//遍历向量</span></span><br></pre></td></tr></table></figure>\n\n<p>该算法设计了两个不同的接口。第一个接口接受一个函数指针，该函数指针指向的函数只有类型为<code>T&amp;</code>的一个参数，将向量中的元素传递给该函数，然后进行进一步的操作。</p>\n<p>第二个接口通过函数对象的形式指定具体的遍历操作。所谓函数对象，就是在某个类中重载<code>()</code>操作符，在重载操作符的函数中实现其他复杂操作。这类对象在形式上等效于一个函数接口。</p>\n<p>显然，遍历算法的总体时间复杂度为$\\mathcal O (n)$。</p>\n<h3 id=\"有序性甄别\"><a href=\"#有序性甄别\" class=\"headerlink\" title=\"有序性甄别\"></a>有序性甄别</h3><p>在有序向量中，向量的元素按顺序排列，这为许多操作提供了额外的信息，可以简化算法。在考虑是否要使用有序向量的简化算法时，需要首先判断一个向量是否有序。</p>\n<p>判断向量有序的方法很简单，也就是顺序扫描整个向量，逐一比较每一对相邻元素。如果两相邻元素出现了逆序的情形，那么向量就是无序的。这个思想与起泡排序中的相同。</p>\n<h3 id=\"唯一化\"><a href=\"#唯一化\" class=\"headerlink\" title=\"唯一化\"></a>唯一化</h3><p>很多应用中，在进一步处理之前都需要容器中的元素互异。例如，搜索引擎就要求搜索结果中没有重复的条目。向量的唯一化处理，就是剔除向量中的重复元素。</p>\n<h4 id=\"无序向量\"><a href=\"#无序向量\" class=\"headerlink\" title=\"无序向量\"></a>无序向量</h4><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; Rank Vector&lt;T&gt;::<span class=\"built_in\">deduplicate</span>() &#123; <span class=\"comment\">//删除无序向量中重复元素（高效版）</span></span><br><span class=\"line\">   Rank oldSize = _size; <span class=\"comment\">//记录原规模</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">1</span>; i &lt; _size; ) <span class=\"comment\">//自前向后逐个考查_elem[1,_size)</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( <span class=\"built_in\">find</span>(_elem[i], <span class=\"number\">0</span>, i) &lt; <span class=\"number\">0</span> ) <span class=\"comment\">//在前缀[0,i)中寻找与之雷同者（至多一个）</span></span><br><span class=\"line\">         i++; <span class=\"comment\">//若无雷同则继续考查其后继</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">         <span class=\"built_in\">remove</span>(i); <span class=\"comment\">//否则删除当前元素</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> oldSize - _size; <span class=\"comment\">//被删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法的执行思路很简单。在循环的整个过程中，前缀<code>_elem[0, i)</code>中的所有元素均彼此互异。如果在某一步循环中没有找到雷同元素，那么在<code>i++</code>后前缀中依旧没有重复的元素；如果找到了雷同的元素，那么将其删除之后前缀将仍然没有重复的元素。所以当<code>i = _size</code>时，其所有前缀都将不含有重复的元素，也即向量中所有的元素都不重复。</p>\n<p>每一步迭代之后，算法中当前元素<code>_elem[i]</code>的后缀都会持续减少。每一步迭代需要的时间主要消耗于<code>find()</code>和<code>remove()</code>两个函数，其中<code>find()</code>需要的时间取决于前缀的长度，<code>remove()</code>需要的时间取决于后缀的长度。因此，每一步迭代需要的时间不会超过$\\mathcal O (n)$。又因为该算法经过$\\mathcal O (n)$次迭代之后必然终止，因此其总体复杂度为$\\mathcal O (n^2)$。</p>\n<h4 id=\"有序向量\"><a href=\"#有序向量\" class=\"headerlink\" title=\"有序向量\"></a>有序向量</h4><p>为了清除有序向量中的重复元素，可以仿照无序向量的清楚重复元素的算法。对于有序向量的不同之处在于，它内部的重复元素必然前后紧邻。于是我们便不需要像在无序向量中一样调用<code>find()</code>函数，而只需要自前向后地逐一检查各个相邻元素，如果二者雷同则调用<code>remove()</code>函数删除后者，否则转向下一对相邻元素。</p>\n<p>该算法运行时间主要消耗于循环部分，一共需要迭代<code>n - 1</code>步。在最坏的情况下，每次都要执行一次<code>remove()</code>操作。又因为<code>remove()</code>操作的复杂度线性正比于被删除元素的后缀长度，因此在最坏情况下有$(n - 2) + (n - 3) + … + 2 + 1 = \\mathcal O (n^2)$次操作，与无序向量去重的复杂度相同！完全没有体现有序向量的优势。</p>\n<p>上述算法复杂度过高的根源来自于，在对<code>remove()</code>的各次调用中，同一元素可能作为后继多次向前移动，且每次仅移动一个单元。对此的解决办法是，如果有多个雷同的元素，那么就将它们一次性删除好了，这样后缀就可以大跨度地前移。算法实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; Rank Vector&lt;T&gt;::<span class=\"built_in\">uniquify</span>() &#123; <span class=\"comment\">//有序向量重复元素剔除算法（高效版）</span></span><br><span class=\"line\">   Rank i = <span class=\"number\">0</span>, j = <span class=\"number\">0</span>; <span class=\"comment\">//各对互异“相邻”元素的秩</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( ++j &lt; _size ) <span class=\"comment\">//逐一扫描，直至末元素</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( _elem[i] != _elem[j] ) <span class=\"comment\">//跳过雷同者</span></span><br><span class=\"line\">         _elem[++i] = _elem[j]; <span class=\"comment\">//发现不同元素时，向前移至紧邻于前者右侧</span></span><br><span class=\"line\">   _size = ++i; <span class=\"built_in\">shrink</span>(); <span class=\"comment\">//直接截除尾部多余元素</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> j - i; <span class=\"comment\">//向量规模变化量，即被删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法的核心思想就在于：既然各组重复元素必然彼此相邻地构成一个子区间，因此只需要依次保留各个区间的起始元素。从原始向量的角度来看（假设这个算法不进行实际的删除操作），算法中的<code>i</code>与<code>j</code>指向的都是下一对相邻区间的首元素；从修改后的向量的角度来看，<code>i</code>和<code>j</code>分别指向已去重的序列的末尾和即将加入去重序列的新的最后一个元素。下图给出了该算法运行的一个实例：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-4-1.png\" alt=\"有序向量唯一化算法实例\"></p>\n<p>该算法同样直接通过改变<code>_size</code>的值，将尾部多余的元素截除了。<code>i</code>为已去重序列的的最后一个元素的索引，将其加一即可得到去重向量的规模。</p>\n<p>上面的算法每经过一次迭代<code>j</code>就加一，直到达到向量的规模<code>n</code>，总共需要迭代<code>n</code>次，时间复杂度为$\\mathcal O (n)$。</p>\n"},{"title":"DSA-5：查找算法之向量实现","date":"2022-03-25T13:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"主要就是二分查找。","_content":"\n[上一篇文章](https://astrobear.top/2022/03/22/dsa-4/)中介绍了向量的一般接口，这些接口大部分是为无序向量设计的。而这篇文章要讨论的的查找算法全都是为有序向量设计的。可以看到，对有序向量而言，因为多包含了“有序性”这一重要信息，向量中某一元素的查找操作的效率可以提高很多。\n\n## 二分查找\n\n对于一个有序向量，以任一一个元素`S[mi] = x`为界，都可以将区间分为三个部分。并且由于向量是有序的，必然有：$\\rm{S[lo, mi) \\le S[mi] \\le S(mi, hi)}$。于是，只需要将目标元$\\rm e$与$\\rm x$做一次比较，便可以视比较结果分为三种情况进一步处理：\n\n1. 若$\\rm e < x$，则若$\\rm e$存在，那么它必属于左侧子区间$\\rm S[lo, mi)$，故可深入其中继续查找\n2. 若$\\rm e > x$，则若$\\rm e$存在，那么它必属于右侧子区间$\\rm S(mi, hi)$，故也可深入其中继续查找\n3. 若$\\rm e = x$，那么就找到了目标元素，查找终止\n\n下面的图片展示了这个算法的基本思路：\n\n![二分查找基本思路](https://astrobear.top/resource/astroblog/content/dsa-5-1.png)\n\n经过至多两次比较操作，我们要么已经找到了目标元素，要么可以将原问题简化为一个规模更小的同类的新问题。看到这里，你应当很自然地想到使用递归的方法了。接下来要介绍的几个查找算法的不同点仅在于切分点`mi`的策略，以及每次深入递归之前所做的比较操作的次数。\n\n为了便于使用，现为向量类设计了一个统一的查找算法的接口。在这个接口中，它会随机地调用不同的查找算法的函数。\n\n```c++\ntemplate <typename T> //在有序向量的区间[lo, hi)内，确定不大于e的最后一个节点的秩\nRank Vector<T>::search ( T const& e, Rank lo, Rank hi ) const { //assert: 0 <= lo < hi <= _size\n   return ( rand() % 2 ) ? //按各50%的概率随机使用二分查找或Fibonacci查找\n          binSearch ( _elem, e, lo, hi ) : fibSearch ( _elem, e, lo, hi );\n}\n```\n\n## 二分查找（实现1）\n\n### 实现\n\n```c++\ntemplate <typename T> static Rank binSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n   while ( lo < hi ) { //每步迭代可能要做两次比较判断，有三个分支\n      Rank mi = ( lo + hi ) >> 1; //以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）\n      if      ( e < S[mi] ) hi = mi; //深入前半段[lo, mi)继续查找\n      else if ( S[mi] < e ) lo = mi + 1; //深入后半段(mi, hi)继续查找\n      else                  return mi; //在mi处命中\n   } //成功查找可以提前终止\n   return -1; //查找失败\n} //有多个命中元素时，不能保证返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置\n```\n\n该算法以中点为界，将有序向量区间大致平均地分为前后两个子向量。另外，该算法使用了迭代的方法实现。（如果是以递归形式实现的话就是尾递归，可以改为迭代法实现。）\n\n下图给出了上面的算法的一个实例，左边的子图为`search(8, 0 ,7)`右边的子图为`search(3, 0, 7)`。左子图查找成功，右子图查找失败。\n\n![二分查找（实现1）的实例](https://astrobear.top/resource/astroblog/content/dsa-5-2.png)\n\n### 复杂度\n\n上面算法的实现策略可以概括为：以当前区间的居中元素作为目标元素的试探对象，因此每一步迭代之后无论沿着哪一个方向深入，新问题的规模都会减小一半。随着迭代的不断深入，目标查找区间的宽度以`0.5`的比例按几何级数的速度递减。于是经过至多$\\log_2(\\rm{hi - lo})$步迭代后，算法必然终止。又因为每一步迭代只需要常数时间，因此总体的时间复杂度为$\\mathcal O(n)$。\n\n### 查找长度\n\n*查找长度*为查找算法中进行比较操作的次数。在查找算法中，每步迭代中的操作可以分为两种：元素的大小比较、秩的算数运算及其赋值。由于向量中存储的元素类型可能十分复杂，其比较操作可能会花费大量时间。因此在向量的查找算法中，元素的比较次数——也就是查找长素——是衡量算法性能的重要指标。\n\n### 成功查找长度\n\n对于长度为$\\rm n$的向量，共有种$\\rm n$可能的查找。这些查找的种类分别对应于某一个元素。实际上，每一种成功查找所对应的查找长度，仅对应于$\\rm n$与目标元素的秩（该元素在向量中的位置），而与向量中元素的值无关。下面的图片给出了当$\\rm n = 7$时向量各种情况下对应的查找长度。图中红色节点代表查找成功，紫色节点代表查找失败，每个节点中的数字表示该情况下的查找长度。\n\n![二分查找（实现1）在长度为7的向量中各种元素的查找长度](https://astrobear.top/resource/astroblog/content/dsa-5-3.png) \n\n由图可知，假设待查找的目标元素等概率分布，平均成功查找长度为$(4 + 3 + 5 + 2 + 5 + 4 + 6) / 7 =4.14$。\n\n为了估计出一般情况下的成功查找长度，仍在等概率条件下考察长度为$\\rm{n = 2^k - 1}$的有序向量，所有元素对应的查找长素总和记为$\\rm{C(k)}$，平均查找长度记为$c_{ave}$。\n\n当$\\rm k = 1$时，$\\rm C(k) = 1$。当长度为$\\rm 2^k - 1$时，有$\\rm C(k) = [C(k - 1) + (2^{k-1} - 1)] + 2 + [C(k - 1) + 2(2^{k-1} - 1)] = 2C(k - 1) + 3\\cdot 2^{k - 1} - 1$。\n\n上面的公式中，左侧中括号内的$\\rm C(k-1)$代表经过一次成功的比较（`if(e < A[mi])`）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，前缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在前缀中，那么无论在前缀中的哪个位置，他都已经经过一次比较了，之后要找到它至少也需要一次比较，这就是左侧中括号内$\\rm 2^{k-1} - 1$的含义。\n\n公式中，右侧中括号内的$\\rm C(k-1)$代表经过一次失败的比较（`if(e < A[mi])`）与一次成功的比较（`else if (A[mi < e])`）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，后缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在后缀中，那么无论在后缀中的哪个位置，他都已经经过两次比较了，之后要找到它至少也需要两次比较，这就是左侧中括号内$\\rm 2(2^{k-1} - 1)$的含义。\n\n公式中的$2$很好理解，就是如果目标元素匹配了，就经过了两次失败的比较。\n\n经过一系列的变换和推导，可以得出$\\rm C(k) = (3k/2 - 1)\\cdot (2^k - 1) + 3k/2$，进而得到$\\rm c_{ave} = 3k/2 - 1 + 3k/(2\\cdot (2^k - 1))$。\n\n忽略$\\rm c_{ave}$尾部的波动项，平均查找长度为$\\mathcal O (1.5\\rm{k}) = \\mathcal O (1.5\\cdot \\log_2\\rm n)$。\n\n### 失败查找长度\n\n失败查找长度不同于成功查找长度，只有在区间宽度缩减为0时，查找才失败。因此，失败查找的时间复杂度应该为$\\Theta (logn)$。这里使用$\\Theta$符号的原因是：失败查找的时间几乎是确定的，它不存在最坏和最好的情况，总是在$\\log_2 n$附近。\n\n不难发现，失败查找的可能情况总是比成功查找的可能情况多出一种。以上一小节给出的长度为7的向量为例，其失败查找长度为4.5。\n\n仿照对平均成功查找长度的分析方法可以得出，一般情况下的平均失败查找长度也是$\\mathcal O (1.5\\cdot \\log_2n)$。这里就不再分析了。\n\n## 斐波那契查找\n\n上述二分查找算法尽管在最坏情况下的效率可以达到$\\mathcal O (logn)$，但是它还是存在着一些问题。以成功查找为例，即使是迭代（循环）次数相同的情况，各个元素对应的查找长度也不尽相同。这是因为在迭代中为了确定左右分支的方向，需要做1次到2次比较，从而造成不同情况下对应查找长度的不均衡，其中最短和最长分支所对应的查找长度相差约两倍。\n\n为了解决上面的问题，有两种思路可以考虑：\n\n1. 调整前、后区域的宽度，适当加长前子向量并缩短后子向量\n2. 统一往两个方向深入所需要执行的比较次数\n\n这里先考虑第一个解决思路。减而治之策略并不要求向量的切分点`mi`必须居中，在这里可以考虑按照黄金分割比例来确定`mi`。不妨假设向量的长度$\\rm n = fib(k) - 1$，于是斐波那契查找算法可以用`mi = fib(k - 1) - 1`作为前、后子向量的切分点。这样一来，前后子向量的长度分别为$\\rm fib(k - 1) - 1$与$\\rm fib(k - 2) - 1 = (fib(k) - 1) - (fib(k - 1) - 1) - 1$。由此，无论朝哪个方向深入，新向量的长度从形式上都依然是某个斐波那契数减1，就像下图一样：\n\n![斐波那契查找算法原理](https://astrobear.top/resource/astroblog/content/dsa-5-4.png)\n\n### 实现\n\n```c++\n#include \"fibonacci/Fib.h\" //引入Fib数列类\n// Fibonacci查找算法（版本A）：在有序向量的区间[lo, hi)内查找元素e，0 <= lo <= hi <= _size\ntemplate <typename T> static Rank fibSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n    //用O(log_phi(n = hi - lo)时间创建Fib数列\n   for ( Fib fib ( hi - lo ); lo < hi; ) {  //Fib数列制表备查；此后每步迭代仅一次比较、两个分支\n      while ( hi - lo < fib.get() ) fib.prev(); //自后向前顺序查找（分摊O(1)）\n      Rank mi = lo + fib.get() - 1; //确定形如Fib(k) - 1的轴点\n      if      ( e < S[mi] ) hi = mi; //深入前半段[lo, mi)继续查找\n      else if ( S[mi] < e ) lo = mi + 1; //深入后半段(mi, hi)继续查找\n      else                  return mi; //在mi处命中\n   } //成功查找可以提前终止\n   return -1; //查找失败\n} //有多个命中元素时，不能保证返回秩最大者；失败时，简单地返回-1，而不能指示失败的位置\n```\n\n斐波那契查找算法的主体框架与二分查找大致相同。主要区别在于使用黄金分割点取代中点作为切分点。为此需要借助`Fib`对象来获取斐波那契数列，这里获取的`fib(hi - lo)`为大小不小于向量中元素个数的斐波那契数。代码第6行的作用是根据`fib(k)`找到`fib(k - 1)`。如果`hi - lo`小于`fib`当前指向的值，则将`fib`前移一个，直到`fib`指向的值在$\\rm [lo , hi)$之间。\n\n### 性能分析\n\n斐波那契查找倾向于适当加长需要1次比较方可确定的前端子向量，缩短需要2次比较方可以确定的后端子向量。通过这种方式来减小不同元素查找长度的差异。\n\n![斐波那契查找在长度为7的向量中各种元素的查找长度](https://astrobear.top/resource/astroblog/content/dsa-5-5.png)\n\n以上图为例，在假定各元素出现概率相等时，则平均成功查找长度为4，平均失败查找长度为4.38。相比于二分查找（实现1）中的平均查找长度的确有所改进。可以证明，斐波那契查找的平均查找长度为$\\mathcal O (1.44\\log_2n)$。\n\n## 二分查找（实现2）\n\n现在来讨论第二种缩小前后查找长度不均衡的策略：统一往两个方向深入所需要执行的比较次数。在这个版本的二分查找算法中，无论朝哪个方向的子向量深入查找，都只需要做1次元素的大小比较。具体过程如下图所示：\n\n![二分查找算法（实现2）的基本思路](https://astrobear.top/resource/astroblog/content/dsa-5-6.png)\n\n如图所示，该算法在每个切分点`A[mi]`处仅做一次比较。若目标元素小于`A[mi]`，则深入前端子向量`A[lo, mi)`中继续查找；否则深入后端子向量`A[mi, hi)`中继续查找。\n\n### 实现\n\n```c++\n// 二分查找算法（版本B）：在有序向量的区间[lo, hi)内查找元素e，0 <= lo < hi <= _size\ntemplate <typename T> static Rank binSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n   while ( 1 < hi - lo ) { //每步迭代仅需做一次比较判断，有两个分支；成功查找不能提前终止\n      Rank mi = ( lo + hi ) >> 1; //以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）\n      ( e < S[mi] ) ? hi = mi : lo = mi; //经比较后确定深入[lo, mi)或[mi, hi)\n   } //出口时hi = lo + 1，查找区间仅含一个元素A[lo]\n   return e < S[lo] ? lo - 1 : lo; //返回位置，总是不超过e的最大者\n} //有多个命中元素时，返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置\n```\n\n该版本的二分查找算法只有等到区间的宽度缩小为1（只剩最后一个元素）时迭代才会终止。哪怕在第一步迭代中就已经匹配到了目标元素，也得继续进行迭代，调整区间端点，直到区间中只剩一个元素。最后，再对这剩下的最后一个元素进行一次比较来判断查找是否成功。\n\n### 性能分析\n\n显然，该算法的渐进复杂度为$\\mathcal O (logn)$。由于无论如何只有在区间中只有一个元素时迭代才会停止，因此最好情况下的效率会有所倒退。但是作为补偿，最坏情况下的效率也会有所提高（最长的查找长度相比于“实现1”中缩短1倍）。无论是成功查找还是失败查找，该版本的二分查找算法中各分支的查找长度都更加接近，故整体性能更加稳定。\n\n## 二分查找（实现3）\n\n二分查找（实现2）仍有可以改进之处：比如它在返回匹配成功的元素时，若有重复的多个匹配元素，它只能在这些元素中“随机”地报告其中一个（并不是真的随机，这个跟`mi`的选取方法有关）；此外，在查找失败的时候，该算法也只能简单地返回一个`-1`。\n\n对二分查找（实现2）的代码进行一些改进便可改进上述缺点。\n\n### 实现\n\n```c++\n// 二分查找算法（版本C）：在有序向量的区间[lo, hi)内查找元素e，0 <= lo <= hi <= _size\ntemplate <typename T> static Rank binSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n   while ( lo < hi ) { //每步迭代仅需做一次比较判断，有两个分支\n      Rank mi = ( lo + hi ) >> 1; //以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）\n      ( e < S[mi] ) ? hi = mi : lo = mi + 1; //经比较后确定深入[lo, mi)或(mi, hi)\n   } //成功查找不能提前终止\n   return lo - 1; //循环结束时，lo为大于e的元素的最小秩，故lo - 1即不大于e的元素的最大秩\n} //有多个命中元素时，返回秩最大者；查找失败时，能够返回失败的位置\n```\n\n这个版本的二分查找算法是在当区间的长度缩减为0时才停止迭代，此外在每次转入后端分支时，子向量的左边界取作`mi + 1`而不是`mi`。这样做的理由是：**$\\rm A[0, lo)$中的元素小于等于$\\rm e$，$\\rm A[hi, n)$中的元素均大于$\\rm e$**。使用数学归纳法可以证明该命题。\n\n首次迭代时，`lo = 0`，`hi = n`，因此$\\rm A[0, lo)$与$\\rm A[hi, n)$均为空，命题成立。\n\n考察在某次迭代中的情况。如果$\\rm e < A[mi]$，则令`hi = mi`，这使得$\\rm A[hi, n)$向左扩展，该区间内的元素仍然都大于$\\rm e$。如果$\\rm e \\ge A[mi]$，则令`lo = mi + 1`，这使得$\\rm A[0, lo)$向右扩展，该区间内的元素仍然小于等于$\\rm e$。在循环终止时有`lo = hi`，考察`A[lo - 1]`和`A[lo]`：作为$\\rm A[0, lo)$中的最后一个元素，`A[lo - 1]`必然不大于$\\rm e$；作为$\\rm A[hi, n)$中的第一个元素，`A[lo]`一定大于$\\rm e$。所以此时`A[lo - 1]`就是原向量中不大于$\\rm e$的最后一个元素，因此算法只用返回`lo - 1`。\n\n下面的图片解释了该算法的思路：\n\n![二分查找算法（实现3）的基本思路](https://astrobear.top/resource/astroblog/content/dsa-5-7.png)\n\n可见，这个版本的二分查找算法在查找成功时，（若有多个匹配元素）会返回众多匹配元素的最后一个；在查找失败时，会返回向量中小于目标元素的各元素中的最大者。\n","source":"_posts/dsa-5.md","raw":"---\ntitle: DSA-5：查找算法之向量实现\ndate: 2022-03-25 21:00:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 主要就是二分查找。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n[上一篇文章](https://astrobear.top/2022/03/22/dsa-4/)中介绍了向量的一般接口，这些接口大部分是为无序向量设计的。而这篇文章要讨论的的查找算法全都是为有序向量设计的。可以看到，对有序向量而言，因为多包含了“有序性”这一重要信息，向量中某一元素的查找操作的效率可以提高很多。\n\n## 二分查找\n\n对于一个有序向量，以任一一个元素`S[mi] = x`为界，都可以将区间分为三个部分。并且由于向量是有序的，必然有：$\\rm{S[lo, mi) \\le S[mi] \\le S(mi, hi)}$。于是，只需要将目标元$\\rm e$与$\\rm x$做一次比较，便可以视比较结果分为三种情况进一步处理：\n\n1. 若$\\rm e < x$，则若$\\rm e$存在，那么它必属于左侧子区间$\\rm S[lo, mi)$，故可深入其中继续查找\n2. 若$\\rm e > x$，则若$\\rm e$存在，那么它必属于右侧子区间$\\rm S(mi, hi)$，故也可深入其中继续查找\n3. 若$\\rm e = x$，那么就找到了目标元素，查找终止\n\n下面的图片展示了这个算法的基本思路：\n\n![二分查找基本思路](https://astrobear.top/resource/astroblog/content/dsa-5-1.png)\n\n经过至多两次比较操作，我们要么已经找到了目标元素，要么可以将原问题简化为一个规模更小的同类的新问题。看到这里，你应当很自然地想到使用递归的方法了。接下来要介绍的几个查找算法的不同点仅在于切分点`mi`的策略，以及每次深入递归之前所做的比较操作的次数。\n\n为了便于使用，现为向量类设计了一个统一的查找算法的接口。在这个接口中，它会随机地调用不同的查找算法的函数。\n\n```c++\ntemplate <typename T> //在有序向量的区间[lo, hi)内，确定不大于e的最后一个节点的秩\nRank Vector<T>::search ( T const& e, Rank lo, Rank hi ) const { //assert: 0 <= lo < hi <= _size\n   return ( rand() % 2 ) ? //按各50%的概率随机使用二分查找或Fibonacci查找\n          binSearch ( _elem, e, lo, hi ) : fibSearch ( _elem, e, lo, hi );\n}\n```\n\n## 二分查找（实现1）\n\n### 实现\n\n```c++\ntemplate <typename T> static Rank binSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n   while ( lo < hi ) { //每步迭代可能要做两次比较判断，有三个分支\n      Rank mi = ( lo + hi ) >> 1; //以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）\n      if      ( e < S[mi] ) hi = mi; //深入前半段[lo, mi)继续查找\n      else if ( S[mi] < e ) lo = mi + 1; //深入后半段(mi, hi)继续查找\n      else                  return mi; //在mi处命中\n   } //成功查找可以提前终止\n   return -1; //查找失败\n} //有多个命中元素时，不能保证返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置\n```\n\n该算法以中点为界，将有序向量区间大致平均地分为前后两个子向量。另外，该算法使用了迭代的方法实现。（如果是以递归形式实现的话就是尾递归，可以改为迭代法实现。）\n\n下图给出了上面的算法的一个实例，左边的子图为`search(8, 0 ,7)`右边的子图为`search(3, 0, 7)`。左子图查找成功，右子图查找失败。\n\n![二分查找（实现1）的实例](https://astrobear.top/resource/astroblog/content/dsa-5-2.png)\n\n### 复杂度\n\n上面算法的实现策略可以概括为：以当前区间的居中元素作为目标元素的试探对象，因此每一步迭代之后无论沿着哪一个方向深入，新问题的规模都会减小一半。随着迭代的不断深入，目标查找区间的宽度以`0.5`的比例按几何级数的速度递减。于是经过至多$\\log_2(\\rm{hi - lo})$步迭代后，算法必然终止。又因为每一步迭代只需要常数时间，因此总体的时间复杂度为$\\mathcal O(n)$。\n\n### 查找长度\n\n*查找长度*为查找算法中进行比较操作的次数。在查找算法中，每步迭代中的操作可以分为两种：元素的大小比较、秩的算数运算及其赋值。由于向量中存储的元素类型可能十分复杂，其比较操作可能会花费大量时间。因此在向量的查找算法中，元素的比较次数——也就是查找长素——是衡量算法性能的重要指标。\n\n### 成功查找长度\n\n对于长度为$\\rm n$的向量，共有种$\\rm n$可能的查找。这些查找的种类分别对应于某一个元素。实际上，每一种成功查找所对应的查找长度，仅对应于$\\rm n$与目标元素的秩（该元素在向量中的位置），而与向量中元素的值无关。下面的图片给出了当$\\rm n = 7$时向量各种情况下对应的查找长度。图中红色节点代表查找成功，紫色节点代表查找失败，每个节点中的数字表示该情况下的查找长度。\n\n![二分查找（实现1）在长度为7的向量中各种元素的查找长度](https://astrobear.top/resource/astroblog/content/dsa-5-3.png) \n\n由图可知，假设待查找的目标元素等概率分布，平均成功查找长度为$(4 + 3 + 5 + 2 + 5 + 4 + 6) / 7 =4.14$。\n\n为了估计出一般情况下的成功查找长度，仍在等概率条件下考察长度为$\\rm{n = 2^k - 1}$的有序向量，所有元素对应的查找长素总和记为$\\rm{C(k)}$，平均查找长度记为$c_{ave}$。\n\n当$\\rm k = 1$时，$\\rm C(k) = 1$。当长度为$\\rm 2^k - 1$时，有$\\rm C(k) = [C(k - 1) + (2^{k-1} - 1)] + 2 + [C(k - 1) + 2(2^{k-1} - 1)] = 2C(k - 1) + 3\\cdot 2^{k - 1} - 1$。\n\n上面的公式中，左侧中括号内的$\\rm C(k-1)$代表经过一次成功的比较（`if(e < A[mi])`）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，前缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在前缀中，那么无论在前缀中的哪个位置，他都已经经过一次比较了，之后要找到它至少也需要一次比较，这就是左侧中括号内$\\rm 2^{k-1} - 1$的含义。\n\n公式中，右侧中括号内的$\\rm C(k-1)$代表经过一次失败的比较（`if(e < A[mi])`）与一次成功的比较（`else if (A[mi < e])`）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，后缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在后缀中，那么无论在后缀中的哪个位置，他都已经经过两次比较了，之后要找到它至少也需要两次比较，这就是左侧中括号内$\\rm 2(2^{k-1} - 1)$的含义。\n\n公式中的$2$很好理解，就是如果目标元素匹配了，就经过了两次失败的比较。\n\n经过一系列的变换和推导，可以得出$\\rm C(k) = (3k/2 - 1)\\cdot (2^k - 1) + 3k/2$，进而得到$\\rm c_{ave} = 3k/2 - 1 + 3k/(2\\cdot (2^k - 1))$。\n\n忽略$\\rm c_{ave}$尾部的波动项，平均查找长度为$\\mathcal O (1.5\\rm{k}) = \\mathcal O (1.5\\cdot \\log_2\\rm n)$。\n\n### 失败查找长度\n\n失败查找长度不同于成功查找长度，只有在区间宽度缩减为0时，查找才失败。因此，失败查找的时间复杂度应该为$\\Theta (logn)$。这里使用$\\Theta$符号的原因是：失败查找的时间几乎是确定的，它不存在最坏和最好的情况，总是在$\\log_2 n$附近。\n\n不难发现，失败查找的可能情况总是比成功查找的可能情况多出一种。以上一小节给出的长度为7的向量为例，其失败查找长度为4.5。\n\n仿照对平均成功查找长度的分析方法可以得出，一般情况下的平均失败查找长度也是$\\mathcal O (1.5\\cdot \\log_2n)$。这里就不再分析了。\n\n## 斐波那契查找\n\n上述二分查找算法尽管在最坏情况下的效率可以达到$\\mathcal O (logn)$，但是它还是存在着一些问题。以成功查找为例，即使是迭代（循环）次数相同的情况，各个元素对应的查找长度也不尽相同。这是因为在迭代中为了确定左右分支的方向，需要做1次到2次比较，从而造成不同情况下对应查找长度的不均衡，其中最短和最长分支所对应的查找长度相差约两倍。\n\n为了解决上面的问题，有两种思路可以考虑：\n\n1. 调整前、后区域的宽度，适当加长前子向量并缩短后子向量\n2. 统一往两个方向深入所需要执行的比较次数\n\n这里先考虑第一个解决思路。减而治之策略并不要求向量的切分点`mi`必须居中，在这里可以考虑按照黄金分割比例来确定`mi`。不妨假设向量的长度$\\rm n = fib(k) - 1$，于是斐波那契查找算法可以用`mi = fib(k - 1) - 1`作为前、后子向量的切分点。这样一来，前后子向量的长度分别为$\\rm fib(k - 1) - 1$与$\\rm fib(k - 2) - 1 = (fib(k) - 1) - (fib(k - 1) - 1) - 1$。由此，无论朝哪个方向深入，新向量的长度从形式上都依然是某个斐波那契数减1，就像下图一样：\n\n![斐波那契查找算法原理](https://astrobear.top/resource/astroblog/content/dsa-5-4.png)\n\n### 实现\n\n```c++\n#include \"fibonacci/Fib.h\" //引入Fib数列类\n// Fibonacci查找算法（版本A）：在有序向量的区间[lo, hi)内查找元素e，0 <= lo <= hi <= _size\ntemplate <typename T> static Rank fibSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n    //用O(log_phi(n = hi - lo)时间创建Fib数列\n   for ( Fib fib ( hi - lo ); lo < hi; ) {  //Fib数列制表备查；此后每步迭代仅一次比较、两个分支\n      while ( hi - lo < fib.get() ) fib.prev(); //自后向前顺序查找（分摊O(1)）\n      Rank mi = lo + fib.get() - 1; //确定形如Fib(k) - 1的轴点\n      if      ( e < S[mi] ) hi = mi; //深入前半段[lo, mi)继续查找\n      else if ( S[mi] < e ) lo = mi + 1; //深入后半段(mi, hi)继续查找\n      else                  return mi; //在mi处命中\n   } //成功查找可以提前终止\n   return -1; //查找失败\n} //有多个命中元素时，不能保证返回秩最大者；失败时，简单地返回-1，而不能指示失败的位置\n```\n\n斐波那契查找算法的主体框架与二分查找大致相同。主要区别在于使用黄金分割点取代中点作为切分点。为此需要借助`Fib`对象来获取斐波那契数列，这里获取的`fib(hi - lo)`为大小不小于向量中元素个数的斐波那契数。代码第6行的作用是根据`fib(k)`找到`fib(k - 1)`。如果`hi - lo`小于`fib`当前指向的值，则将`fib`前移一个，直到`fib`指向的值在$\\rm [lo , hi)$之间。\n\n### 性能分析\n\n斐波那契查找倾向于适当加长需要1次比较方可确定的前端子向量，缩短需要2次比较方可以确定的后端子向量。通过这种方式来减小不同元素查找长度的差异。\n\n![斐波那契查找在长度为7的向量中各种元素的查找长度](https://astrobear.top/resource/astroblog/content/dsa-5-5.png)\n\n以上图为例，在假定各元素出现概率相等时，则平均成功查找长度为4，平均失败查找长度为4.38。相比于二分查找（实现1）中的平均查找长度的确有所改进。可以证明，斐波那契查找的平均查找长度为$\\mathcal O (1.44\\log_2n)$。\n\n## 二分查找（实现2）\n\n现在来讨论第二种缩小前后查找长度不均衡的策略：统一往两个方向深入所需要执行的比较次数。在这个版本的二分查找算法中，无论朝哪个方向的子向量深入查找，都只需要做1次元素的大小比较。具体过程如下图所示：\n\n![二分查找算法（实现2）的基本思路](https://astrobear.top/resource/astroblog/content/dsa-5-6.png)\n\n如图所示，该算法在每个切分点`A[mi]`处仅做一次比较。若目标元素小于`A[mi]`，则深入前端子向量`A[lo, mi)`中继续查找；否则深入后端子向量`A[mi, hi)`中继续查找。\n\n### 实现\n\n```c++\n// 二分查找算法（版本B）：在有序向量的区间[lo, hi)内查找元素e，0 <= lo < hi <= _size\ntemplate <typename T> static Rank binSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n   while ( 1 < hi - lo ) { //每步迭代仅需做一次比较判断，有两个分支；成功查找不能提前终止\n      Rank mi = ( lo + hi ) >> 1; //以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）\n      ( e < S[mi] ) ? hi = mi : lo = mi; //经比较后确定深入[lo, mi)或[mi, hi)\n   } //出口时hi = lo + 1，查找区间仅含一个元素A[lo]\n   return e < S[lo] ? lo - 1 : lo; //返回位置，总是不超过e的最大者\n} //有多个命中元素时，返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置\n```\n\n该版本的二分查找算法只有等到区间的宽度缩小为1（只剩最后一个元素）时迭代才会终止。哪怕在第一步迭代中就已经匹配到了目标元素，也得继续进行迭代，调整区间端点，直到区间中只剩一个元素。最后，再对这剩下的最后一个元素进行一次比较来判断查找是否成功。\n\n### 性能分析\n\n显然，该算法的渐进复杂度为$\\mathcal O (logn)$。由于无论如何只有在区间中只有一个元素时迭代才会停止，因此最好情况下的效率会有所倒退。但是作为补偿，最坏情况下的效率也会有所提高（最长的查找长度相比于“实现1”中缩短1倍）。无论是成功查找还是失败查找，该版本的二分查找算法中各分支的查找长度都更加接近，故整体性能更加稳定。\n\n## 二分查找（实现3）\n\n二分查找（实现2）仍有可以改进之处：比如它在返回匹配成功的元素时，若有重复的多个匹配元素，它只能在这些元素中“随机”地报告其中一个（并不是真的随机，这个跟`mi`的选取方法有关）；此外，在查找失败的时候，该算法也只能简单地返回一个`-1`。\n\n对二分查找（实现2）的代码进行一些改进便可改进上述缺点。\n\n### 实现\n\n```c++\n// 二分查找算法（版本C）：在有序向量的区间[lo, hi)内查找元素e，0 <= lo <= hi <= _size\ntemplate <typename T> static Rank binSearch ( T* S, T const& e, Rank lo, Rank hi ) {\n   while ( lo < hi ) { //每步迭代仅需做一次比较判断，有两个分支\n      Rank mi = ( lo + hi ) >> 1; //以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）\n      ( e < S[mi] ) ? hi = mi : lo = mi + 1; //经比较后确定深入[lo, mi)或(mi, hi)\n   } //成功查找不能提前终止\n   return lo - 1; //循环结束时，lo为大于e的元素的最小秩，故lo - 1即不大于e的元素的最大秩\n} //有多个命中元素时，返回秩最大者；查找失败时，能够返回失败的位置\n```\n\n这个版本的二分查找算法是在当区间的长度缩减为0时才停止迭代，此外在每次转入后端分支时，子向量的左边界取作`mi + 1`而不是`mi`。这样做的理由是：**$\\rm A[0, lo)$中的元素小于等于$\\rm e$，$\\rm A[hi, n)$中的元素均大于$\\rm e$**。使用数学归纳法可以证明该命题。\n\n首次迭代时，`lo = 0`，`hi = n`，因此$\\rm A[0, lo)$与$\\rm A[hi, n)$均为空，命题成立。\n\n考察在某次迭代中的情况。如果$\\rm e < A[mi]$，则令`hi = mi`，这使得$\\rm A[hi, n)$向左扩展，该区间内的元素仍然都大于$\\rm e$。如果$\\rm e \\ge A[mi]$，则令`lo = mi + 1`，这使得$\\rm A[0, lo)$向右扩展，该区间内的元素仍然小于等于$\\rm e$。在循环终止时有`lo = hi`，考察`A[lo - 1]`和`A[lo]`：作为$\\rm A[0, lo)$中的最后一个元素，`A[lo - 1]`必然不大于$\\rm e$；作为$\\rm A[hi, n)$中的第一个元素，`A[lo]`一定大于$\\rm e$。所以此时`A[lo - 1]`就是原向量中不大于$\\rm e$的最后一个元素，因此算法只用返回`lo - 1`。\n\n下面的图片解释了该算法的思路：\n\n![二分查找算法（实现3）的基本思路](https://astrobear.top/resource/astroblog/content/dsa-5-7.png)\n\n可见，这个版本的二分查找算法在查找成功时，（若有多个匹配元素）会返回众多匹配元素的最后一个；在查找失败时，会返回向量中小于目标元素的各元素中的最大者。\n","slug":"dsa-5","published":1,"updated":"2022-03-26T13:36:48.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz08001d1q397nos3ajy","content":"<p><a href=\"https://astrobear.top/2022/03/22/dsa-4/\">上一篇文章</a>中介绍了向量的一般接口，这些接口大部分是为无序向量设计的。而这篇文章要讨论的的查找算法全都是为有序向量设计的。可以看到，对有序向量而言，因为多包含了“有序性”这一重要信息，向量中某一元素的查找操作的效率可以提高很多。</p>\n<h2 id=\"二分查找\"><a href=\"#二分查找\" class=\"headerlink\" title=\"二分查找\"></a>二分查找</h2><p>对于一个有序向量，以任一一个元素<code>S[mi] = x</code>为界，都可以将区间分为三个部分。并且由于向量是有序的，必然有：$\\rm{S[lo, mi) \\le S[mi] \\le S(mi, hi)}$。于是，只需要将目标元$\\rm e$与$\\rm x$做一次比较，便可以视比较结果分为三种情况进一步处理：</p>\n<ol>\n<li>若$\\rm e &lt; x$，则若$\\rm e$存在，那么它必属于左侧子区间$\\rm S[lo, mi)$，故可深入其中继续查找</li>\n<li>若$\\rm e &gt; x$，则若$\\rm e$存在，那么它必属于右侧子区间$\\rm S(mi, hi)$，故也可深入其中继续查找</li>\n<li>若$\\rm e = x$，那么就找到了目标元素，查找终止</li>\n</ol>\n<p>下面的图片展示了这个算法的基本思路：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-1.png\" alt=\"二分查找基本思路\"></p>\n<p>经过至多两次比较操作，我们要么已经找到了目标元素，要么可以将原问题简化为一个规模更小的同类的新问题。看到这里，你应当很自然地想到使用递归的方法了。接下来要介绍的几个查找算法的不同点仅在于切分点<code>mi</code>的策略，以及每次深入递归之前所做的比较操作的次数。</p>\n<p>为了便于使用，现为向量类设计了一个统一的查找算法的接口。在这个接口中，它会随机地调用不同的查找算法的函数。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//在有序向量的区间[lo, hi)内，确定不大于e的最后一个节点的秩</span></span><br><span class=\"line\">Rank Vector&lt;T&gt;::<span class=\"built_in\">search</span> ( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi ) <span class=\"keyword\">const</span> &#123; <span class=\"comment\">//assert: 0 &lt;= lo &lt; hi &lt;= _size</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> ( <span class=\"built_in\">rand</span>() % <span class=\"number\">2</span> ) ? <span class=\"comment\">//按各50%的概率随机使用二分查找或Fibonacci查找</span></span><br><span class=\"line\">          <span class=\"built_in\">binSearch</span> ( _elem, e, lo, hi ) : <span class=\"built_in\">fibSearch</span> ( _elem, e, lo, hi );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二分查找（实现1）\"><a href=\"#二分查找（实现1）\" class=\"headerlink\" title=\"二分查找（实现1）\"></a>二分查找（实现1）</h2><h3 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">binSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( lo &lt; hi ) &#123; <span class=\"comment\">//每步迭代可能要做两次比较判断，有三个分支</span></span><br><span class=\"line\">      Rank mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>      ( e &lt; S[mi] ) hi = mi; <span class=\"comment\">//深入前半段[lo, mi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( S[mi] &lt; e ) lo = mi + <span class=\"number\">1</span>; <span class=\"comment\">//深入后半段(mi, hi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span>                  <span class=\"keyword\">return</span> mi; <span class=\"comment\">//在mi处命中</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//成功查找可以提前终止</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"number\">-1</span>; <span class=\"comment\">//查找失败</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，不能保证返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>该算法以中点为界，将有序向量区间大致平均地分为前后两个子向量。另外，该算法使用了迭代的方法实现。（如果是以递归形式实现的话就是尾递归，可以改为迭代法实现。）</p>\n<p>下图给出了上面的算法的一个实例，左边的子图为<code>search(8, 0 ,7)</code>右边的子图为<code>search(3, 0, 7)</code>。左子图查找成功，右子图查找失败。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-2.png\" alt=\"二分查找（实现1）的实例\"></p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>上面算法的实现策略可以概括为：以当前区间的居中元素作为目标元素的试探对象，因此每一步迭代之后无论沿着哪一个方向深入，新问题的规模都会减小一半。随着迭代的不断深入，目标查找区间的宽度以<code>0.5</code>的比例按几何级数的速度递减。于是经过至多$\\log_2(\\rm{hi - lo})$步迭代后，算法必然终止。又因为每一步迭代只需要常数时间，因此总体的时间复杂度为$\\mathcal O(n)$。</p>\n<h3 id=\"查找长度\"><a href=\"#查找长度\" class=\"headerlink\" title=\"查找长度\"></a>查找长度</h3><p><em>查找长度</em>为查找算法中进行比较操作的次数。在查找算法中，每步迭代中的操作可以分为两种：元素的大小比较、秩的算数运算及其赋值。由于向量中存储的元素类型可能十分复杂，其比较操作可能会花费大量时间。因此在向量的查找算法中，元素的比较次数——也就是查找长素——是衡量算法性能的重要指标。</p>\n<h3 id=\"成功查找长度\"><a href=\"#成功查找长度\" class=\"headerlink\" title=\"成功查找长度\"></a>成功查找长度</h3><p>对于长度为$\\rm n$的向量，共有种$\\rm n$可能的查找。这些查找的种类分别对应于某一个元素。实际上，每一种成功查找所对应的查找长度，仅对应于$\\rm n$与目标元素的秩（该元素在向量中的位置），而与向量中元素的值无关。下面的图片给出了当$\\rm n = 7$时向量各种情况下对应的查找长度。图中红色节点代表查找成功，紫色节点代表查找失败，每个节点中的数字表示该情况下的查找长度。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-3.png\" alt=\"二分查找（实现1）在长度为7的向量中各种元素的查找长度\"> </p>\n<p>由图可知，假设待查找的目标元素等概率分布，平均成功查找长度为$(4 + 3 + 5 + 2 + 5 + 4 + 6) / 7 =4.14$。</p>\n<p>为了估计出一般情况下的成功查找长度，仍在等概率条件下考察长度为$\\rm{n = 2^k - 1}$的有序向量，所有元素对应的查找长素总和记为$\\rm{C(k)}$，平均查找长度记为$c_{ave}$。</p>\n<p>当$\\rm k = 1$时，$\\rm C(k) = 1$。当长度为$\\rm 2^k - 1$时，有$\\rm C(k) = [C(k - 1) + (2^{k-1} - 1)] + 2 + [C(k - 1) + 2(2^{k-1} - 1)] = 2C(k - 1) + 3\\cdot 2^{k - 1} - 1$。</p>\n<p>上面的公式中，左侧中括号内的$\\rm C(k-1)$代表经过一次成功的比较（<code>if(e &lt; A[mi])</code>）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，前缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在前缀中，那么无论在前缀中的哪个位置，他都已经经过一次比较了，之后要找到它至少也需要一次比较，这就是左侧中括号内$\\rm 2^{k-1} - 1$的含义。</p>\n<p>公式中，右侧中括号内的$\\rm C(k-1)$代表经过一次失败的比较（<code>if(e &lt; A[mi])</code>）与一次成功的比较（<code>else if (A[mi &lt; e])</code>）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，后缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在后缀中，那么无论在后缀中的哪个位置，他都已经经过两次比较了，之后要找到它至少也需要两次比较，这就是左侧中括号内$\\rm 2(2^{k-1} - 1)$的含义。</p>\n<p>公式中的$2$很好理解，就是如果目标元素匹配了，就经过了两次失败的比较。</p>\n<p>经过一系列的变换和推导，可以得出$\\rm C(k) = (3k/2 - 1)\\cdot (2^k - 1) + 3k/2$，进而得到$\\rm c_{ave} = 3k/2 - 1 + 3k/(2\\cdot (2^k - 1))$。</p>\n<p>忽略$\\rm c_{ave}$尾部的波动项，平均查找长度为$\\mathcal O (1.5\\rm{k}) = \\mathcal O (1.5\\cdot \\log_2\\rm n)$。</p>\n<h3 id=\"失败查找长度\"><a href=\"#失败查找长度\" class=\"headerlink\" title=\"失败查找长度\"></a>失败查找长度</h3><p>失败查找长度不同于成功查找长度，只有在区间宽度缩减为0时，查找才失败。因此，失败查找的时间复杂度应该为$\\Theta (logn)$。这里使用$\\Theta$符号的原因是：失败查找的时间几乎是确定的，它不存在最坏和最好的情况，总是在$\\log_2 n$附近。</p>\n<p>不难发现，失败查找的可能情况总是比成功查找的可能情况多出一种。以上一小节给出的长度为7的向量为例，其失败查找长度为4.5。</p>\n<p>仿照对平均成功查找长度的分析方法可以得出，一般情况下的平均失败查找长度也是$\\mathcal O (1.5\\cdot \\log_2n)$。这里就不再分析了。</p>\n<h2 id=\"斐波那契查找\"><a href=\"#斐波那契查找\" class=\"headerlink\" title=\"斐波那契查找\"></a>斐波那契查找</h2><p>上述二分查找算法尽管在最坏情况下的效率可以达到$\\mathcal O (logn)$，但是它还是存在着一些问题。以成功查找为例，即使是迭代（循环）次数相同的情况，各个元素对应的查找长度也不尽相同。这是因为在迭代中为了确定左右分支的方向，需要做1次到2次比较，从而造成不同情况下对应查找长度的不均衡，其中最短和最长分支所对应的查找长度相差约两倍。</p>\n<p>为了解决上面的问题，有两种思路可以考虑：</p>\n<ol>\n<li>调整前、后区域的宽度，适当加长前子向量并缩短后子向量</li>\n<li>统一往两个方向深入所需要执行的比较次数</li>\n</ol>\n<p>这里先考虑第一个解决思路。减而治之策略并不要求向量的切分点<code>mi</code>必须居中，在这里可以考虑按照黄金分割比例来确定<code>mi</code>。不妨假设向量的长度$\\rm n = fib(k) - 1$，于是斐波那契查找算法可以用<code>mi = fib(k - 1) - 1</code>作为前、后子向量的切分点。这样一来，前后子向量的长度分别为$\\rm fib(k - 1) - 1$与$\\rm fib(k - 2) - 1 = (fib(k) - 1) - (fib(k - 1) - 1) - 1$。由此，无论朝哪个方向深入，新向量的长度从形式上都依然是某个斐波那契数减1，就像下图一样：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-4.png\" alt=\"斐波那契查找算法原理\"></p>\n<h3 id=\"实现-1\"><a href=\"#实现-1\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;fibonacci/Fib.h&quot;</span> <span class=\"comment\">//引入Fib数列类</span></span></span><br><span class=\"line\"><span class=\"comment\">// Fibonacci查找算法（版本A）：在有序向量的区间[lo, hi)内查找元素e，0 &lt;= lo &lt;= hi &lt;= _size</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">fibSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//用O(log_phi(n = hi - lo)时间创建Fib数列</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Fib <span class=\"built_in\">fib</span> ( hi - lo ); lo &lt; hi; ) &#123;  <span class=\"comment\">//Fib数列制表备查；此后每步迭代仅一次比较、两个分支</span></span><br><span class=\"line\">      <span class=\"keyword\">while</span> ( hi - lo &lt; fib.<span class=\"built_in\">get</span>() ) fib.<span class=\"built_in\">prev</span>(); <span class=\"comment\">//自后向前顺序查找（分摊O(1)）</span></span><br><span class=\"line\">      Rank mi = lo + fib.<span class=\"built_in\">get</span>() - <span class=\"number\">1</span>; <span class=\"comment\">//确定形如Fib(k) - 1的轴点</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>      ( e &lt; S[mi] ) hi = mi; <span class=\"comment\">//深入前半段[lo, mi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( S[mi] &lt; e ) lo = mi + <span class=\"number\">1</span>; <span class=\"comment\">//深入后半段(mi, hi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span>                  <span class=\"keyword\">return</span> mi; <span class=\"comment\">//在mi处命中</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//成功查找可以提前终止</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"number\">-1</span>; <span class=\"comment\">//查找失败</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，不能保证返回秩最大者；失败时，简单地返回-1，而不能指示失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>斐波那契查找算法的主体框架与二分查找大致相同。主要区别在于使用黄金分割点取代中点作为切分点。为此需要借助<code>Fib</code>对象来获取斐波那契数列，这里获取的<code>fib(hi - lo)</code>为大小不小于向量中元素个数的斐波那契数。代码第6行的作用是根据<code>fib(k)</code>找到<code>fib(k - 1)</code>。如果<code>hi - lo</code>小于<code>fib</code>当前指向的值，则将<code>fib</code>前移一个，直到<code>fib</code>指向的值在$\\rm [lo , hi)$之间。</p>\n<h3 id=\"性能分析\"><a href=\"#性能分析\" class=\"headerlink\" title=\"性能分析\"></a>性能分析</h3><p>斐波那契查找倾向于适当加长需要1次比较方可确定的前端子向量，缩短需要2次比较方可以确定的后端子向量。通过这种方式来减小不同元素查找长度的差异。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-5.png\" alt=\"斐波那契查找在长度为7的向量中各种元素的查找长度\"></p>\n<p>以上图为例，在假定各元素出现概率相等时，则平均成功查找长度为4，平均失败查找长度为4.38。相比于二分查找（实现1）中的平均查找长度的确有所改进。可以证明，斐波那契查找的平均查找长度为$\\mathcal O (1.44\\log_2n)$。</p>\n<h2 id=\"二分查找（实现2）\"><a href=\"#二分查找（实现2）\" class=\"headerlink\" title=\"二分查找（实现2）\"></a>二分查找（实现2）</h2><p>现在来讨论第二种缩小前后查找长度不均衡的策略：统一往两个方向深入所需要执行的比较次数。在这个版本的二分查找算法中，无论朝哪个方向的子向量深入查找，都只需要做1次元素的大小比较。具体过程如下图所示：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-6.png\" alt=\"二分查找算法（实现2）的基本思路\"></p>\n<p>如图所示，该算法在每个切分点<code>A[mi]</code>处仅做一次比较。若目标元素小于<code>A[mi]</code>，则深入前端子向量<code>A[lo, mi)</code>中继续查找；否则深入后端子向量<code>A[mi, hi)</code>中继续查找。</p>\n<h3 id=\"实现-2\"><a href=\"#实现-2\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 二分查找算法（版本B）：在有序向量的区间[lo, hi)内查找元素e，0 &lt;= lo &lt; hi &lt;= _size</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">binSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">1</span> &lt; hi - lo ) &#123; <span class=\"comment\">//每步迭代仅需做一次比较判断，有两个分支；成功查找不能提前终止</span></span><br><span class=\"line\">      Rank mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）</span></span><br><span class=\"line\">      ( e &lt; S[mi] ) ? hi = mi : lo = mi; <span class=\"comment\">//经比较后确定深入[lo, mi)或[mi, hi)</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//出口时hi = lo + 1，查找区间仅含一个元素A[lo]</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> e &lt; S[lo] ? lo - <span class=\"number\">1</span> : lo; <span class=\"comment\">//返回位置，总是不超过e的最大者</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>该版本的二分查找算法只有等到区间的宽度缩小为1（只剩最后一个元素）时迭代才会终止。哪怕在第一步迭代中就已经匹配到了目标元素，也得继续进行迭代，调整区间端点，直到区间中只剩一个元素。最后，再对这剩下的最后一个元素进行一次比较来判断查找是否成功。</p>\n<h3 id=\"性能分析-1\"><a href=\"#性能分析-1\" class=\"headerlink\" title=\"性能分析\"></a>性能分析</h3><p>显然，该算法的渐进复杂度为$\\mathcal O (logn)$。由于无论如何只有在区间中只有一个元素时迭代才会停止，因此最好情况下的效率会有所倒退。但是作为补偿，最坏情况下的效率也会有所提高（最长的查找长度相比于“实现1”中缩短1倍）。无论是成功查找还是失败查找，该版本的二分查找算法中各分支的查找长度都更加接近，故整体性能更加稳定。</p>\n<h2 id=\"二分查找（实现3）\"><a href=\"#二分查找（实现3）\" class=\"headerlink\" title=\"二分查找（实现3）\"></a>二分查找（实现3）</h2><p>二分查找（实现2）仍有可以改进之处：比如它在返回匹配成功的元素时，若有重复的多个匹配元素，它只能在这些元素中“随机”地报告其中一个（并不是真的随机，这个跟<code>mi</code>的选取方法有关）；此外，在查找失败的时候，该算法也只能简单地返回一个<code>-1</code>。</p>\n<p>对二分查找（实现2）的代码进行一些改进便可改进上述缺点。</p>\n<h3 id=\"实现-3\"><a href=\"#实现-3\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 二分查找算法（版本C）：在有序向量的区间[lo, hi)内查找元素e，0 &lt;= lo &lt;= hi &lt;= _size</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">binSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( lo &lt; hi ) &#123; <span class=\"comment\">//每步迭代仅需做一次比较判断，有两个分支</span></span><br><span class=\"line\">      Rank mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）</span></span><br><span class=\"line\">      ( e &lt; S[mi] ) ? hi = mi : lo = mi + <span class=\"number\">1</span>; <span class=\"comment\">//经比较后确定深入[lo, mi)或(mi, hi)</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//成功查找不能提前终止</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> lo - <span class=\"number\">1</span>; <span class=\"comment\">//循环结束时，lo为大于e的元素的最小秩，故lo - 1即不大于e的元素的最大秩</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，返回秩最大者；查找失败时，能够返回失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>这个版本的二分查找算法是在当区间的长度缩减为0时才停止迭代，此外在每次转入后端分支时，子向量的左边界取作<code>mi + 1</code>而不是<code>mi</code>。这样做的理由是：<strong>$\\rm A[0, lo)$中的元素小于等于$\\rm e$，$\\rm A[hi, n)$中的元素均大于$\\rm e$</strong>。使用数学归纳法可以证明该命题。</p>\n<p>首次迭代时，<code>lo = 0</code>，<code>hi = n</code>，因此$\\rm A[0, lo)$与$\\rm A[hi, n)$均为空，命题成立。</p>\n<p>考察在某次迭代中的情况。如果$\\rm e &lt; A[mi]$，则令<code>hi = mi</code>，这使得$\\rm A[hi, n)$向左扩展，该区间内的元素仍然都大于$\\rm e$。如果$\\rm e \\ge A[mi]$，则令<code>lo = mi + 1</code>，这使得$\\rm A[0, lo)$向右扩展，该区间内的元素仍然小于等于$\\rm e$。在循环终止时有<code>lo = hi</code>，考察<code>A[lo - 1]</code>和<code>A[lo]</code>：作为$\\rm A[0, lo)$中的最后一个元素，<code>A[lo - 1]</code>必然不大于$\\rm e$；作为$\\rm A[hi, n)$中的第一个元素，<code>A[lo]</code>一定大于$\\rm e$。所以此时<code>A[lo - 1]</code>就是原向量中不大于$\\rm e$的最后一个元素，因此算法只用返回<code>lo - 1</code>。</p>\n<p>下面的图片解释了该算法的思路：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-7.png\" alt=\"二分查找算法（实现3）的基本思路\"></p>\n<p>可见，这个版本的二分查找算法在查找成功时，（若有多个匹配元素）会返回众多匹配元素的最后一个；在查找失败时，会返回向量中小于目标元素的各元素中的最大者。</p>\n","site":{"data":{}},"more":"<p><a href=\"https://astrobear.top/2022/03/22/dsa-4/\">上一篇文章</a>中介绍了向量的一般接口，这些接口大部分是为无序向量设计的。而这篇文章要讨论的的查找算法全都是为有序向量设计的。可以看到，对有序向量而言，因为多包含了“有序性”这一重要信息，向量中某一元素的查找操作的效率可以提高很多。</p>\n<h2 id=\"二分查找\"><a href=\"#二分查找\" class=\"headerlink\" title=\"二分查找\"></a>二分查找</h2><p>对于一个有序向量，以任一一个元素<code>S[mi] = x</code>为界，都可以将区间分为三个部分。并且由于向量是有序的，必然有：$\\rm{S[lo, mi) \\le S[mi] \\le S(mi, hi)}$。于是，只需要将目标元$\\rm e$与$\\rm x$做一次比较，便可以视比较结果分为三种情况进一步处理：</p>\n<ol>\n<li>若$\\rm e &lt; x$，则若$\\rm e$存在，那么它必属于左侧子区间$\\rm S[lo, mi)$，故可深入其中继续查找</li>\n<li>若$\\rm e &gt; x$，则若$\\rm e$存在，那么它必属于右侧子区间$\\rm S(mi, hi)$，故也可深入其中继续查找</li>\n<li>若$\\rm e = x$，那么就找到了目标元素，查找终止</li>\n</ol>\n<p>下面的图片展示了这个算法的基本思路：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-1.png\" alt=\"二分查找基本思路\"></p>\n<p>经过至多两次比较操作，我们要么已经找到了目标元素，要么可以将原问题简化为一个规模更小的同类的新问题。看到这里，你应当很自然地想到使用递归的方法了。接下来要介绍的几个查找算法的不同点仅在于切分点<code>mi</code>的策略，以及每次深入递归之前所做的比较操作的次数。</p>\n<p>为了便于使用，现为向量类设计了一个统一的查找算法的接口。在这个接口中，它会随机地调用不同的查找算法的函数。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//在有序向量的区间[lo, hi)内，确定不大于e的最后一个节点的秩</span></span><br><span class=\"line\">Rank Vector&lt;T&gt;::<span class=\"built_in\">search</span> ( T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi ) <span class=\"keyword\">const</span> &#123; <span class=\"comment\">//assert: 0 &lt;= lo &lt; hi &lt;= _size</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> ( <span class=\"built_in\">rand</span>() % <span class=\"number\">2</span> ) ? <span class=\"comment\">//按各50%的概率随机使用二分查找或Fibonacci查找</span></span><br><span class=\"line\">          <span class=\"built_in\">binSearch</span> ( _elem, e, lo, hi ) : <span class=\"built_in\">fibSearch</span> ( _elem, e, lo, hi );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"二分查找（实现1）\"><a href=\"#二分查找（实现1）\" class=\"headerlink\" title=\"二分查找（实现1）\"></a>二分查找（实现1）</h2><h3 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">binSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( lo &lt; hi ) &#123; <span class=\"comment\">//每步迭代可能要做两次比较判断，有三个分支</span></span><br><span class=\"line\">      Rank mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>      ( e &lt; S[mi] ) hi = mi; <span class=\"comment\">//深入前半段[lo, mi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( S[mi] &lt; e ) lo = mi + <span class=\"number\">1</span>; <span class=\"comment\">//深入后半段(mi, hi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span>                  <span class=\"keyword\">return</span> mi; <span class=\"comment\">//在mi处命中</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//成功查找可以提前终止</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"number\">-1</span>; <span class=\"comment\">//查找失败</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，不能保证返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>该算法以中点为界，将有序向量区间大致平均地分为前后两个子向量。另外，该算法使用了迭代的方法实现。（如果是以递归形式实现的话就是尾递归，可以改为迭代法实现。）</p>\n<p>下图给出了上面的算法的一个实例，左边的子图为<code>search(8, 0 ,7)</code>右边的子图为<code>search(3, 0, 7)</code>。左子图查找成功，右子图查找失败。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-2.png\" alt=\"二分查找（实现1）的实例\"></p>\n<h3 id=\"复杂度\"><a href=\"#复杂度\" class=\"headerlink\" title=\"复杂度\"></a>复杂度</h3><p>上面算法的实现策略可以概括为：以当前区间的居中元素作为目标元素的试探对象，因此每一步迭代之后无论沿着哪一个方向深入，新问题的规模都会减小一半。随着迭代的不断深入，目标查找区间的宽度以<code>0.5</code>的比例按几何级数的速度递减。于是经过至多$\\log_2(\\rm{hi - lo})$步迭代后，算法必然终止。又因为每一步迭代只需要常数时间，因此总体的时间复杂度为$\\mathcal O(n)$。</p>\n<h3 id=\"查找长度\"><a href=\"#查找长度\" class=\"headerlink\" title=\"查找长度\"></a>查找长度</h3><p><em>查找长度</em>为查找算法中进行比较操作的次数。在查找算法中，每步迭代中的操作可以分为两种：元素的大小比较、秩的算数运算及其赋值。由于向量中存储的元素类型可能十分复杂，其比较操作可能会花费大量时间。因此在向量的查找算法中，元素的比较次数——也就是查找长素——是衡量算法性能的重要指标。</p>\n<h3 id=\"成功查找长度\"><a href=\"#成功查找长度\" class=\"headerlink\" title=\"成功查找长度\"></a>成功查找长度</h3><p>对于长度为$\\rm n$的向量，共有种$\\rm n$可能的查找。这些查找的种类分别对应于某一个元素。实际上，每一种成功查找所对应的查找长度，仅对应于$\\rm n$与目标元素的秩（该元素在向量中的位置），而与向量中元素的值无关。下面的图片给出了当$\\rm n = 7$时向量各种情况下对应的查找长度。图中红色节点代表查找成功，紫色节点代表查找失败，每个节点中的数字表示该情况下的查找长度。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-3.png\" alt=\"二分查找（实现1）在长度为7的向量中各种元素的查找长度\"> </p>\n<p>由图可知，假设待查找的目标元素等概率分布，平均成功查找长度为$(4 + 3 + 5 + 2 + 5 + 4 + 6) / 7 =4.14$。</p>\n<p>为了估计出一般情况下的成功查找长度，仍在等概率条件下考察长度为$\\rm{n = 2^k - 1}$的有序向量，所有元素对应的查找长素总和记为$\\rm{C(k)}$，平均查找长度记为$c_{ave}$。</p>\n<p>当$\\rm k = 1$时，$\\rm C(k) = 1$。当长度为$\\rm 2^k - 1$时，有$\\rm C(k) = [C(k - 1) + (2^{k-1} - 1)] + 2 + [C(k - 1) + 2(2^{k-1} - 1)] = 2C(k - 1) + 3\\cdot 2^{k - 1} - 1$。</p>\n<p>上面的公式中，左侧中括号内的$\\rm C(k-1)$代表经过一次成功的比较（<code>if(e &lt; A[mi])</code>）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，前缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在前缀中，那么无论在前缀中的哪个位置，他都已经经过一次比较了，之后要找到它至少也需要一次比较，这就是左侧中括号内$\\rm 2^{k-1} - 1$的含义。</p>\n<p>公式中，右侧中括号内的$\\rm C(k-1)$代表经过一次失败的比较（<code>if(e &lt; A[mi])</code>）与一次成功的比较（<code>else if (A[mi &lt; e])</code>）后，问题规模缩减为$\\rm 2^{k - 1} - 1$。当向量规模为$\\rm n = 2^k - 1$时，后缀中一共有$\\rm 2^{k - 1} - 1$个元素。此时若目标元素在后缀中，那么无论在后缀中的哪个位置，他都已经经过两次比较了，之后要找到它至少也需要两次比较，这就是左侧中括号内$\\rm 2(2^{k-1} - 1)$的含义。</p>\n<p>公式中的$2$很好理解，就是如果目标元素匹配了，就经过了两次失败的比较。</p>\n<p>经过一系列的变换和推导，可以得出$\\rm C(k) = (3k/2 - 1)\\cdot (2^k - 1) + 3k/2$，进而得到$\\rm c_{ave} = 3k/2 - 1 + 3k/(2\\cdot (2^k - 1))$。</p>\n<p>忽略$\\rm c_{ave}$尾部的波动项，平均查找长度为$\\mathcal O (1.5\\rm{k}) = \\mathcal O (1.5\\cdot \\log_2\\rm n)$。</p>\n<h3 id=\"失败查找长度\"><a href=\"#失败查找长度\" class=\"headerlink\" title=\"失败查找长度\"></a>失败查找长度</h3><p>失败查找长度不同于成功查找长度，只有在区间宽度缩减为0时，查找才失败。因此，失败查找的时间复杂度应该为$\\Theta (logn)$。这里使用$\\Theta$符号的原因是：失败查找的时间几乎是确定的，它不存在最坏和最好的情况，总是在$\\log_2 n$附近。</p>\n<p>不难发现，失败查找的可能情况总是比成功查找的可能情况多出一种。以上一小节给出的长度为7的向量为例，其失败查找长度为4.5。</p>\n<p>仿照对平均成功查找长度的分析方法可以得出，一般情况下的平均失败查找长度也是$\\mathcal O (1.5\\cdot \\log_2n)$。这里就不再分析了。</p>\n<h2 id=\"斐波那契查找\"><a href=\"#斐波那契查找\" class=\"headerlink\" title=\"斐波那契查找\"></a>斐波那契查找</h2><p>上述二分查找算法尽管在最坏情况下的效率可以达到$\\mathcal O (logn)$，但是它还是存在着一些问题。以成功查找为例，即使是迭代（循环）次数相同的情况，各个元素对应的查找长度也不尽相同。这是因为在迭代中为了确定左右分支的方向，需要做1次到2次比较，从而造成不同情况下对应查找长度的不均衡，其中最短和最长分支所对应的查找长度相差约两倍。</p>\n<p>为了解决上面的问题，有两种思路可以考虑：</p>\n<ol>\n<li>调整前、后区域的宽度，适当加长前子向量并缩短后子向量</li>\n<li>统一往两个方向深入所需要执行的比较次数</li>\n</ol>\n<p>这里先考虑第一个解决思路。减而治之策略并不要求向量的切分点<code>mi</code>必须居中，在这里可以考虑按照黄金分割比例来确定<code>mi</code>。不妨假设向量的长度$\\rm n = fib(k) - 1$，于是斐波那契查找算法可以用<code>mi = fib(k - 1) - 1</code>作为前、后子向量的切分点。这样一来，前后子向量的长度分别为$\\rm fib(k - 1) - 1$与$\\rm fib(k - 2) - 1 = (fib(k) - 1) - (fib(k - 1) - 1) - 1$。由此，无论朝哪个方向深入，新向量的长度从形式上都依然是某个斐波那契数减1，就像下图一样：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-4.png\" alt=\"斐波那契查找算法原理\"></p>\n<h3 id=\"实现-1\"><a href=\"#实现-1\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;fibonacci/Fib.h&quot;</span> <span class=\"comment\">//引入Fib数列类</span></span></span><br><span class=\"line\"><span class=\"comment\">// Fibonacci查找算法（版本A）：在有序向量的区间[lo, hi)内查找元素e，0 &lt;= lo &lt;= hi &lt;= _size</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">fibSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//用O(log_phi(n = hi - lo)时间创建Fib数列</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Fib <span class=\"built_in\">fib</span> ( hi - lo ); lo &lt; hi; ) &#123;  <span class=\"comment\">//Fib数列制表备查；此后每步迭代仅一次比较、两个分支</span></span><br><span class=\"line\">      <span class=\"keyword\">while</span> ( hi - lo &lt; fib.<span class=\"built_in\">get</span>() ) fib.<span class=\"built_in\">prev</span>(); <span class=\"comment\">//自后向前顺序查找（分摊O(1)）</span></span><br><span class=\"line\">      Rank mi = lo + fib.<span class=\"built_in\">get</span>() - <span class=\"number\">1</span>; <span class=\"comment\">//确定形如Fib(k) - 1的轴点</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>      ( e &lt; S[mi] ) hi = mi; <span class=\"comment\">//深入前半段[lo, mi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ( S[mi] &lt; e ) lo = mi + <span class=\"number\">1</span>; <span class=\"comment\">//深入后半段(mi, hi)继续查找</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span>                  <span class=\"keyword\">return</span> mi; <span class=\"comment\">//在mi处命中</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//成功查找可以提前终止</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"number\">-1</span>; <span class=\"comment\">//查找失败</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，不能保证返回秩最大者；失败时，简单地返回-1，而不能指示失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>斐波那契查找算法的主体框架与二分查找大致相同。主要区别在于使用黄金分割点取代中点作为切分点。为此需要借助<code>Fib</code>对象来获取斐波那契数列，这里获取的<code>fib(hi - lo)</code>为大小不小于向量中元素个数的斐波那契数。代码第6行的作用是根据<code>fib(k)</code>找到<code>fib(k - 1)</code>。如果<code>hi - lo</code>小于<code>fib</code>当前指向的值，则将<code>fib</code>前移一个，直到<code>fib</code>指向的值在$\\rm [lo , hi)$之间。</p>\n<h3 id=\"性能分析\"><a href=\"#性能分析\" class=\"headerlink\" title=\"性能分析\"></a>性能分析</h3><p>斐波那契查找倾向于适当加长需要1次比较方可确定的前端子向量，缩短需要2次比较方可以确定的后端子向量。通过这种方式来减小不同元素查找长度的差异。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-5.png\" alt=\"斐波那契查找在长度为7的向量中各种元素的查找长度\"></p>\n<p>以上图为例，在假定各元素出现概率相等时，则平均成功查找长度为4，平均失败查找长度为4.38。相比于二分查找（实现1）中的平均查找长度的确有所改进。可以证明，斐波那契查找的平均查找长度为$\\mathcal O (1.44\\log_2n)$。</p>\n<h2 id=\"二分查找（实现2）\"><a href=\"#二分查找（实现2）\" class=\"headerlink\" title=\"二分查找（实现2）\"></a>二分查找（实现2）</h2><p>现在来讨论第二种缩小前后查找长度不均衡的策略：统一往两个方向深入所需要执行的比较次数。在这个版本的二分查找算法中，无论朝哪个方向的子向量深入查找，都只需要做1次元素的大小比较。具体过程如下图所示：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-6.png\" alt=\"二分查找算法（实现2）的基本思路\"></p>\n<p>如图所示，该算法在每个切分点<code>A[mi]</code>处仅做一次比较。若目标元素小于<code>A[mi]</code>，则深入前端子向量<code>A[lo, mi)</code>中继续查找；否则深入后端子向量<code>A[mi, hi)</code>中继续查找。</p>\n<h3 id=\"实现-2\"><a href=\"#实现-2\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 二分查找算法（版本B）：在有序向量的区间[lo, hi)内查找元素e，0 &lt;= lo &lt; hi &lt;= _size</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">binSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">1</span> &lt; hi - lo ) &#123; <span class=\"comment\">//每步迭代仅需做一次比较判断，有两个分支；成功查找不能提前终止</span></span><br><span class=\"line\">      Rank mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）</span></span><br><span class=\"line\">      ( e &lt; S[mi] ) ? hi = mi : lo = mi; <span class=\"comment\">//经比较后确定深入[lo, mi)或[mi, hi)</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//出口时hi = lo + 1，查找区间仅含一个元素A[lo]</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> e &lt; S[lo] ? lo - <span class=\"number\">1</span> : lo; <span class=\"comment\">//返回位置，总是不超过e的最大者</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，返回秩最大者；查找失败时，简单地返回-1，而不能指示失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>该版本的二分查找算法只有等到区间的宽度缩小为1（只剩最后一个元素）时迭代才会终止。哪怕在第一步迭代中就已经匹配到了目标元素，也得继续进行迭代，调整区间端点，直到区间中只剩一个元素。最后，再对这剩下的最后一个元素进行一次比较来判断查找是否成功。</p>\n<h3 id=\"性能分析-1\"><a href=\"#性能分析-1\" class=\"headerlink\" title=\"性能分析\"></a>性能分析</h3><p>显然，该算法的渐进复杂度为$\\mathcal O (logn)$。由于无论如何只有在区间中只有一个元素时迭代才会停止，因此最好情况下的效率会有所倒退。但是作为补偿，最坏情况下的效率也会有所提高（最长的查找长度相比于“实现1”中缩短1倍）。无论是成功查找还是失败查找，该版本的二分查找算法中各分支的查找长度都更加接近，故整体性能更加稳定。</p>\n<h2 id=\"二分查找（实现3）\"><a href=\"#二分查找（实现3）\" class=\"headerlink\" title=\"二分查找（实现3）\"></a>二分查找（实现3）</h2><p>二分查找（实现2）仍有可以改进之处：比如它在返回匹配成功的元素时，若有重复的多个匹配元素，它只能在这些元素中“随机”地报告其中一个（并不是真的随机，这个跟<code>mi</code>的选取方法有关）；此外，在查找失败的时候，该算法也只能简单地返回一个<code>-1</code>。</p>\n<p>对二分查找（实现2）的代码进行一些改进便可改进上述缺点。</p>\n<h3 id=\"实现-3\"><a href=\"#实现-3\" class=\"headerlink\" title=\"实现\"></a>实现</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 二分查找算法（版本C）：在有序向量的区间[lo, hi)内查找元素e，0 &lt;= lo &lt;= hi &lt;= _size</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"function\"><span class=\"keyword\">static</span> Rank <span class=\"title\">binSearch</span> <span class=\"params\">( T* S, T <span class=\"keyword\">const</span>&amp; e, Rank lo, Rank hi )</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( lo &lt; hi ) &#123; <span class=\"comment\">//每步迭代仅需做一次比较判断，有两个分支</span></span><br><span class=\"line\">      Rank mi = ( lo + hi ) &gt;&gt; <span class=\"number\">1</span>; <span class=\"comment\">//以中点为轴点（区间宽度的折半，等效于宽度之数值表示的右移）</span></span><br><span class=\"line\">      ( e &lt; S[mi] ) ? hi = mi : lo = mi + <span class=\"number\">1</span>; <span class=\"comment\">//经比较后确定深入[lo, mi)或(mi, hi)</span></span><br><span class=\"line\">   &#125; <span class=\"comment\">//成功查找不能提前终止</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> lo - <span class=\"number\">1</span>; <span class=\"comment\">//循环结束时，lo为大于e的元素的最小秩，故lo - 1即不大于e的元素的最大秩</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//有多个命中元素时，返回秩最大者；查找失败时，能够返回失败的位置</span></span><br></pre></td></tr></table></figure>\n\n<p>这个版本的二分查找算法是在当区间的长度缩减为0时才停止迭代，此外在每次转入后端分支时，子向量的左边界取作<code>mi + 1</code>而不是<code>mi</code>。这样做的理由是：<strong>$\\rm A[0, lo)$中的元素小于等于$\\rm e$，$\\rm A[hi, n)$中的元素均大于$\\rm e$</strong>。使用数学归纳法可以证明该命题。</p>\n<p>首次迭代时，<code>lo = 0</code>，<code>hi = n</code>，因此$\\rm A[0, lo)$与$\\rm A[hi, n)$均为空，命题成立。</p>\n<p>考察在某次迭代中的情况。如果$\\rm e &lt; A[mi]$，则令<code>hi = mi</code>，这使得$\\rm A[hi, n)$向左扩展，该区间内的元素仍然都大于$\\rm e$。如果$\\rm e \\ge A[mi]$，则令<code>lo = mi + 1</code>，这使得$\\rm A[0, lo)$向右扩展，该区间内的元素仍然小于等于$\\rm e$。在循环终止时有<code>lo = hi</code>，考察<code>A[lo - 1]</code>和<code>A[lo]</code>：作为$\\rm A[0, lo)$中的最后一个元素，<code>A[lo - 1]</code>必然不大于$\\rm e$；作为$\\rm A[hi, n)$中的第一个元素，<code>A[lo]</code>一定大于$\\rm e$。所以此时<code>A[lo - 1]</code>就是原向量中不大于$\\rm e$的最后一个元素，因此算法只用返回<code>lo - 1</code>。</p>\n<p>下面的图片解释了该算法的思路：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-5-7.png\" alt=\"二分查找算法（实现3）的基本思路\"></p>\n<p>可见，这个版本的二分查找算法在查找成功时，（若有多个匹配元素）会返回众多匹配元素的最后一个；在查找失败时，会返回向量中小于目标元素的各元素中的最大者。</p>\n"},{"title":"DSA-6：排序算法之向量实现","date":"2022-04-09T07:50:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"刚刚接触归并排序的时候想了好久都没想明白代码的运行过程......","_content":"\n之前的文章已经说过，有序性在很多场合都可以极大地提高计算的效率。想要向量有序，必须借助排序算法。本文就将从向量这一数据结构切入，介绍一下排序算法。\n\n## 排序与下界\n\n### 排序算法\n\n排序算法的种类繁多，根据其处理数据的规模和存储的特点不同，可以分为内部排序算法和外部排序算法。内部排序算法处理的数据规模相对不大，内存足以容纳；外部排序算法处理的数据规模很大，必须借助外部甚至分布式存储器，在排序计算的过程中，内存只能容纳一小部分数据。\n\n根据排序算法输入形式的不同，排序算法又可以分为离线算法和在线算法。离线算法将待排序的数据以批处理的形式整体给出；在线算法中待排序的数据需要实时生成，算法启动后数据陆续到达。\n\n此外还可以根据依赖的体系结构不同，将排序算法分为串行和并行两类；还可以根据排序算法是否采用随机策略，将其分为确定式和随机式。\n\n在这一系列的文章中，主要讨论确定式串行离线的内部排序算法。\n\n### 下界\n\n对于任意特定的应用问题，随着算法的改进，其效率的提高必定有一极限，因为不可能不劳而获。这一极限必然存在，其具体数值取决于应用问题本身以及其所采用的计算模型。\n\n一般的，任一问题在最坏情况下的最低计算成本，即为该问题的*复杂度下界*。一旦某一算法的性能达到这一下界，就意味着它已经式最坏情况下最优的算法了。\n\n注意，不要将问题的复杂度下界与算法的最优复杂度混淆。复杂度下界是针对**特定问题**而言的，处理这个问题的算法可以有很多，但是一定有一个简单到不能再简单的算法。算法的复杂度是针对**特定的算法**，在不同输入下，算法处理这些输入所需要的时间或者空间。\n\n对于排序算法，可以用比较树来辅助我们确定它的复杂度下界。\n\n比较树有点像一棵二叉树，它具有如下的性质：\n\n- 每一内部节点各对应于一次比对操作\n- 内部节点的左、右分之，分别对应于在两种比对结果下的执行方向\n- 叶节点（或根节点到叶节点的路径）对应于算法某次执行的完整过程及输出\n- 反过来，算法每一次运行的过程都对应于从根到某一叶节点的路径\n\n将比较树推广到其他类型的算法上，只要其中的分支都完全取决于不同变量或常量的比对或比较结果，则该算法的所有可能执行过程都可以表示和概括为一棵比较树。反之，凡是可以如此描述的算法，都称作基于比较式的算法，简称*CBA算法*。\n\n### 使用比较树估计下界\n\n考察任一CBA式算法，设$CT(A)$为与之对应的一棵比较树。由此，算法A在最坏的情况下的运行时间，将取决于比较树中所有的叶节点的最大深度（称作该树的高度，记为$h(CT(A))$）。因此就渐进的意义来说，算法A的时间复杂度不低于$\\Omega(h(CT(A)))$。由于算法A处理该问题的时间复杂度是确定的，那么对于其他问题，该算法处理那些问题的时间复杂度也在$\\Omega(h(CT(A)))$附近。因此，这里使用了大$\\Omega$记号。\n\n任一CBA式算法都对应于某棵比较树，该问题的复杂度下界就应等于这些比较树的最小高度，而这可以通过考察树中所含的叶节点数目确定。具体的，在一棵高度为$h$的二叉树中，叶姐带你的数目不可能多于$2^h$。因此反过来，如果某一问题的输出结果不少于$N$种，则比较树中叶节点也不可能少于$N$个，树高不可能低于$\\log_2N$。\n\n考虑CBA式排序算法，就$n$个元素的排序算法而言，可能的输出共有$N = n!$种。此时，待排序的元素之间不仅可以判等还可以比较大小，因此此时的比较树应为三叉树，也即每个非叶节点都有三个分支。仿照上面的思路，任一CBA式排序算法所对应的比较树高度应为：$h\\ge \\lceil\\log_3(n!)\\rceil = \\lceil\\log_3e\\cdot\\ln(n!)=\\Omega(n\\log n)$。\n\n可见，最坏情况下CBA式排序算法至少需要$\\Omega(n\\log n)$的时间，其中$n$为待排序元素数目。\n\n### 排序算法的稳定性\n\n在将无序向量`A`转换为有序向量`S`之后，设`A[i]`对应于`S[ki]`。若对于`A`中每一对重复元素`A[i] = A[j]`，相应的有`S[ki] = S[kj]`，都有`i`小于`j`当且仅当`ki`小于`kj`，那么称该排序算法是*稳定算法*。简而言之，稳定算法的特点是，重复元素之间的相对次序在排序前后保持一致，反之则称为不稳定算法。\n\n在之前的文章中我们介绍过起泡排序，该算法中重复元素不会进行交换。因此，气泡排序属于稳定算法。\n\n稳定的排序算法可以用来实现同时对多个关键码按照字典顺序的排序。\n\n## 归并排序\n\n归并排序是第一个可以在最坏情况下依然保持$\\mathcal O (n\\log n)$运行时间的确定性排序算法。\n\n### 二路归并\n\n归并排序可以理解为通过反复调用所谓二路归并算法实现的。所谓二路归并，指的是将两个有序序列合并称为一个有序序列。这里的有序序列既可以是向量，也可以是列表。在这里我们只考虑向量的情况。\n\n二路归并属于迭代式算法。每步迭代中，只需要比较两个待归并有序向量的首元素，将小者取出并追加到输出向量的末尾，该元素在原向量中的后继则成为新的首元素。如此往复，直到某一向量为空。最后，将另一非空的有序输入向量整体接至输出向量的末尾。下图给出了有序向量的二路归并实例。\n\n![有序向量的二路归并实例](https://astrobear.top/resource/astroblog/content/dsa-6-1.png)\n\n由此可知，二路归并算法在任何时刻都只需要载入两个向量的首元素，故除了归并输出的向量外，仅需要常数规模的辅助空间。另外该算法始终严格地按照顺序处理输入和输出向量，故特别适用于使用磁带机等顺序存储器的场合。\n\n### 归并排序的实现\n\n下面给出了归并排序算法的实现代码。\n\n```c++\ntemplate <typename T> //向量归并排序\nvoid Vector<T>::mergeSort ( Rank lo, Rank hi ) { //0 <= lo < hi <= size\n   if ( hi - lo < 2 ) return; //单元素区间自然有序，否则...\n   Rank mi = ( lo + hi ) / 2; //以中点为界\n   mergeSort ( lo, mi ); mergeSort ( mi, hi ); //分别排序\n   merge ( lo, mi, hi ); //归并\n}\n```\n\n归并排序算法属于典型的采用了分治策略的算法。上面的代码以递归的方式实现了归并排序。\n\n该算法将向量均匀地分为两个子向量，将这两个子向量递归地转换为有序向量后，再进行二路归并，即可将整个向量转化为有序向量。这里的递归终止条件是当前向量长度$\\rm{n = hi - lo =1}$：只有一个元素的向量天然就是有序的，因此可以将这一分支作为递归基。注意，二路归并是归并排序算法的一部分，受到归并算法的调用。\n\n下图给出了归并排序算法的一个完整实例。由图可以清晰地看出，含8个元素的向量在递归过程中不断被均分，直到到达只有一个元素的向量的递归基。然后各子向量开始层层返回，每返回一次就进行一次二路归并。最后递归返回结束，得到整体有序的向量。\n\n![归并排序实例](https://astrobear.top/resource/astroblog/content/dsa-6-2.png)\n\n### 二路归并的实现\n\n下面给出了二路归并算法的代码。\n\n```c++\ntemplate <typename T> //有序向量（区间）的归并\nvoid Vector<T>::merge ( Rank lo, Rank mi, Rank hi ) { //[lo, mi)和[mi, hi)各自有序，lo < mi < hi\n   Rank i = 0; T* A = _elem + lo; //合并后的有序向量A[0, hi - lo) = _elem[lo, hi)，就地\n   Rank j = 0, lb = mi - lo; T* B = new T[lb]; //前子向量B[0, lb) <-- _elem[lo, mi)\n   for ( Rank i = 0; i < lb; i++ ) B[i] = A[i]; //复制自A的前缀\n   Rank k = 0, lc = hi - mi; T* C = _elem + mi; //后子向量C[0, lc) = _elem[mi, hi)，就地\n   while ( ( j < lb ) && ( k < lc ) ) //反复地比较B、C的首元素\n      A[i++] = ( B[j] <= C[k] ) ? B[j++] : C[k++]; //将更小者归入A中\n   while ( j < lb ) //若C先耗尽，则\n      A[i++] = B[j++]; //将B残余的后缀归入A中\n   delete [] B; //释放临时空间\n}\n```\n\n第7行代码中，循环在前向量`B`首元素的下标`j`和后向量`C`首元素的下标`k`都不越界时，持续向前进行，反复比较`B`和`C`的首元素。在第9行代码中，如果`C`的首元素下标先越界，那么就将`B`的残余后缀归入`A`中。如果是`B`的首元素下标先越界，那么理论上就要将`C`的残余后缀归入`A`中。但是这里`C`本身就在`A`中，因此不需要额外的移动操作了。\n\n### 复杂度分析\n\n归并排序算法的时间成本主要取决于二路归并算法。\n\n二路归并算法`merge()`的时间成本取决于其中循环迭代的总次数，其迭代的次数永远不会超过输入向量的长度，也即$\\mathcal O (\\rm{hi - mi}) = \\mathcal O (n)$。另外，无论子向量的内部元素组成及其相对大小如何，只有前后两个输入向量都归入输出向量后，迭代才能终止。因此该算法在最好的情况下仍然需要$\\Omega (n)$时间。综上，二路归并算法需要的时间为$\\Theta (n)$。即使两个子向量在物理上并非前后衔接，且长度相差悬殊，二路归并算法依然可行并且只需要线性时间。\n\n前面说过，对某个特定的排序问题，无论使用何种CBA排序算法，它的复杂度下界都是$\\Omega(n\\log n)$，这并不与二路归并算法的时间复杂度为$\\Omega (n)$矛盾。因为二路归并算法的输入并不是完全随机的无序向量，实际上它的输入已经具有相当的有序性。\n\n基于以上分析，可以得到归并排序算法的时间复杂度。\n\n将归并算法处理长度为$n$的向量所需要的时间记为$T(n)$。归并算法需要递归地对长度各为$n/2$的两个子向量做归并排序，然后再花费$\\mathcal O (n)$时间做一次二路归并。由此可以得到：$T(n) = 2T(n/2) + \\mathcal O (n)$。特别的，在递归基处有$T(1) = \\mathcal O (1)$。由以上递推公式可以得到$T(n) = \\mathcal O (n\\log n)$。由于二路归并算法的效率稳定在$\\Theta (n)$，因此更准确地讲，归并排序算法的时间复杂度应为$\\Theta (n\\log n)$。\n\n归并排序算法的复杂度也可通过下面的方式分析出来。归并排序算法讲向量层层均分为子向量后，形成了一个像二叉树一样的结构。由于这个类二叉树状的结构中每层里的每个递归实例中的二路归并算法只需要线性时间，因此一层中所有递归实例消耗时间之和也是线性的$\\Theta (n)$。又由于这个类二叉树状的结构一共有$\\Theta \\log_2n$层，因此整个归并排序算法总计需要$\\Theta (n\\log n)$时间。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/dsa-6.md","raw":"---\ntitle: DSA-6：排序算法之向量实现\ndate: 2022-04-09 15:50:00\ncategories: \n\t#- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 刚刚接触归并排序的时候想了好久都没想明白代码的运行过程......\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n之前的文章已经说过，有序性在很多场合都可以极大地提高计算的效率。想要向量有序，必须借助排序算法。本文就将从向量这一数据结构切入，介绍一下排序算法。\n\n## 排序与下界\n\n### 排序算法\n\n排序算法的种类繁多，根据其处理数据的规模和存储的特点不同，可以分为内部排序算法和外部排序算法。内部排序算法处理的数据规模相对不大，内存足以容纳；外部排序算法处理的数据规模很大，必须借助外部甚至分布式存储器，在排序计算的过程中，内存只能容纳一小部分数据。\n\n根据排序算法输入形式的不同，排序算法又可以分为离线算法和在线算法。离线算法将待排序的数据以批处理的形式整体给出；在线算法中待排序的数据需要实时生成，算法启动后数据陆续到达。\n\n此外还可以根据依赖的体系结构不同，将排序算法分为串行和并行两类；还可以根据排序算法是否采用随机策略，将其分为确定式和随机式。\n\n在这一系列的文章中，主要讨论确定式串行离线的内部排序算法。\n\n### 下界\n\n对于任意特定的应用问题，随着算法的改进，其效率的提高必定有一极限，因为不可能不劳而获。这一极限必然存在，其具体数值取决于应用问题本身以及其所采用的计算模型。\n\n一般的，任一问题在最坏情况下的最低计算成本，即为该问题的*复杂度下界*。一旦某一算法的性能达到这一下界，就意味着它已经式最坏情况下最优的算法了。\n\n注意，不要将问题的复杂度下界与算法的最优复杂度混淆。复杂度下界是针对**特定问题**而言的，处理这个问题的算法可以有很多，但是一定有一个简单到不能再简单的算法。算法的复杂度是针对**特定的算法**，在不同输入下，算法处理这些输入所需要的时间或者空间。\n\n对于排序算法，可以用比较树来辅助我们确定它的复杂度下界。\n\n比较树有点像一棵二叉树，它具有如下的性质：\n\n- 每一内部节点各对应于一次比对操作\n- 内部节点的左、右分之，分别对应于在两种比对结果下的执行方向\n- 叶节点（或根节点到叶节点的路径）对应于算法某次执行的完整过程及输出\n- 反过来，算法每一次运行的过程都对应于从根到某一叶节点的路径\n\n将比较树推广到其他类型的算法上，只要其中的分支都完全取决于不同变量或常量的比对或比较结果，则该算法的所有可能执行过程都可以表示和概括为一棵比较树。反之，凡是可以如此描述的算法，都称作基于比较式的算法，简称*CBA算法*。\n\n### 使用比较树估计下界\n\n考察任一CBA式算法，设$CT(A)$为与之对应的一棵比较树。由此，算法A在最坏的情况下的运行时间，将取决于比较树中所有的叶节点的最大深度（称作该树的高度，记为$h(CT(A))$）。因此就渐进的意义来说，算法A的时间复杂度不低于$\\Omega(h(CT(A)))$。由于算法A处理该问题的时间复杂度是确定的，那么对于其他问题，该算法处理那些问题的时间复杂度也在$\\Omega(h(CT(A)))$附近。因此，这里使用了大$\\Omega$记号。\n\n任一CBA式算法都对应于某棵比较树，该问题的复杂度下界就应等于这些比较树的最小高度，而这可以通过考察树中所含的叶节点数目确定。具体的，在一棵高度为$h$的二叉树中，叶姐带你的数目不可能多于$2^h$。因此反过来，如果某一问题的输出结果不少于$N$种，则比较树中叶节点也不可能少于$N$个，树高不可能低于$\\log_2N$。\n\n考虑CBA式排序算法，就$n$个元素的排序算法而言，可能的输出共有$N = n!$种。此时，待排序的元素之间不仅可以判等还可以比较大小，因此此时的比较树应为三叉树，也即每个非叶节点都有三个分支。仿照上面的思路，任一CBA式排序算法所对应的比较树高度应为：$h\\ge \\lceil\\log_3(n!)\\rceil = \\lceil\\log_3e\\cdot\\ln(n!)=\\Omega(n\\log n)$。\n\n可见，最坏情况下CBA式排序算法至少需要$\\Omega(n\\log n)$的时间，其中$n$为待排序元素数目。\n\n### 排序算法的稳定性\n\n在将无序向量`A`转换为有序向量`S`之后，设`A[i]`对应于`S[ki]`。若对于`A`中每一对重复元素`A[i] = A[j]`，相应的有`S[ki] = S[kj]`，都有`i`小于`j`当且仅当`ki`小于`kj`，那么称该排序算法是*稳定算法*。简而言之，稳定算法的特点是，重复元素之间的相对次序在排序前后保持一致，反之则称为不稳定算法。\n\n在之前的文章中我们介绍过起泡排序，该算法中重复元素不会进行交换。因此，气泡排序属于稳定算法。\n\n稳定的排序算法可以用来实现同时对多个关键码按照字典顺序的排序。\n\n## 归并排序\n\n归并排序是第一个可以在最坏情况下依然保持$\\mathcal O (n\\log n)$运行时间的确定性排序算法。\n\n### 二路归并\n\n归并排序可以理解为通过反复调用所谓二路归并算法实现的。所谓二路归并，指的是将两个有序序列合并称为一个有序序列。这里的有序序列既可以是向量，也可以是列表。在这里我们只考虑向量的情况。\n\n二路归并属于迭代式算法。每步迭代中，只需要比较两个待归并有序向量的首元素，将小者取出并追加到输出向量的末尾，该元素在原向量中的后继则成为新的首元素。如此往复，直到某一向量为空。最后，将另一非空的有序输入向量整体接至输出向量的末尾。下图给出了有序向量的二路归并实例。\n\n![有序向量的二路归并实例](https://astrobear.top/resource/astroblog/content/dsa-6-1.png)\n\n由此可知，二路归并算法在任何时刻都只需要载入两个向量的首元素，故除了归并输出的向量外，仅需要常数规模的辅助空间。另外该算法始终严格地按照顺序处理输入和输出向量，故特别适用于使用磁带机等顺序存储器的场合。\n\n### 归并排序的实现\n\n下面给出了归并排序算法的实现代码。\n\n```c++\ntemplate <typename T> //向量归并排序\nvoid Vector<T>::mergeSort ( Rank lo, Rank hi ) { //0 <= lo < hi <= size\n   if ( hi - lo < 2 ) return; //单元素区间自然有序，否则...\n   Rank mi = ( lo + hi ) / 2; //以中点为界\n   mergeSort ( lo, mi ); mergeSort ( mi, hi ); //分别排序\n   merge ( lo, mi, hi ); //归并\n}\n```\n\n归并排序算法属于典型的采用了分治策略的算法。上面的代码以递归的方式实现了归并排序。\n\n该算法将向量均匀地分为两个子向量，将这两个子向量递归地转换为有序向量后，再进行二路归并，即可将整个向量转化为有序向量。这里的递归终止条件是当前向量长度$\\rm{n = hi - lo =1}$：只有一个元素的向量天然就是有序的，因此可以将这一分支作为递归基。注意，二路归并是归并排序算法的一部分，受到归并算法的调用。\n\n下图给出了归并排序算法的一个完整实例。由图可以清晰地看出，含8个元素的向量在递归过程中不断被均分，直到到达只有一个元素的向量的递归基。然后各子向量开始层层返回，每返回一次就进行一次二路归并。最后递归返回结束，得到整体有序的向量。\n\n![归并排序实例](https://astrobear.top/resource/astroblog/content/dsa-6-2.png)\n\n### 二路归并的实现\n\n下面给出了二路归并算法的代码。\n\n```c++\ntemplate <typename T> //有序向量（区间）的归并\nvoid Vector<T>::merge ( Rank lo, Rank mi, Rank hi ) { //[lo, mi)和[mi, hi)各自有序，lo < mi < hi\n   Rank i = 0; T* A = _elem + lo; //合并后的有序向量A[0, hi - lo) = _elem[lo, hi)，就地\n   Rank j = 0, lb = mi - lo; T* B = new T[lb]; //前子向量B[0, lb) <-- _elem[lo, mi)\n   for ( Rank i = 0; i < lb; i++ ) B[i] = A[i]; //复制自A的前缀\n   Rank k = 0, lc = hi - mi; T* C = _elem + mi; //后子向量C[0, lc) = _elem[mi, hi)，就地\n   while ( ( j < lb ) && ( k < lc ) ) //反复地比较B、C的首元素\n      A[i++] = ( B[j] <= C[k] ) ? B[j++] : C[k++]; //将更小者归入A中\n   while ( j < lb ) //若C先耗尽，则\n      A[i++] = B[j++]; //将B残余的后缀归入A中\n   delete [] B; //释放临时空间\n}\n```\n\n第7行代码中，循环在前向量`B`首元素的下标`j`和后向量`C`首元素的下标`k`都不越界时，持续向前进行，反复比较`B`和`C`的首元素。在第9行代码中，如果`C`的首元素下标先越界，那么就将`B`的残余后缀归入`A`中。如果是`B`的首元素下标先越界，那么理论上就要将`C`的残余后缀归入`A`中。但是这里`C`本身就在`A`中，因此不需要额外的移动操作了。\n\n### 复杂度分析\n\n归并排序算法的时间成本主要取决于二路归并算法。\n\n二路归并算法`merge()`的时间成本取决于其中循环迭代的总次数，其迭代的次数永远不会超过输入向量的长度，也即$\\mathcal O (\\rm{hi - mi}) = \\mathcal O (n)$。另外，无论子向量的内部元素组成及其相对大小如何，只有前后两个输入向量都归入输出向量后，迭代才能终止。因此该算法在最好的情况下仍然需要$\\Omega (n)$时间。综上，二路归并算法需要的时间为$\\Theta (n)$。即使两个子向量在物理上并非前后衔接，且长度相差悬殊，二路归并算法依然可行并且只需要线性时间。\n\n前面说过，对某个特定的排序问题，无论使用何种CBA排序算法，它的复杂度下界都是$\\Omega(n\\log n)$，这并不与二路归并算法的时间复杂度为$\\Omega (n)$矛盾。因为二路归并算法的输入并不是完全随机的无序向量，实际上它的输入已经具有相当的有序性。\n\n基于以上分析，可以得到归并排序算法的时间复杂度。\n\n将归并算法处理长度为$n$的向量所需要的时间记为$T(n)$。归并算法需要递归地对长度各为$n/2$的两个子向量做归并排序，然后再花费$\\mathcal O (n)$时间做一次二路归并。由此可以得到：$T(n) = 2T(n/2) + \\mathcal O (n)$。特别的，在递归基处有$T(1) = \\mathcal O (1)$。由以上递推公式可以得到$T(n) = \\mathcal O (n\\log n)$。由于二路归并算法的效率稳定在$\\Theta (n)$，因此更准确地讲，归并排序算法的时间复杂度应为$\\Theta (n\\log n)$。\n\n归并排序算法的复杂度也可通过下面的方式分析出来。归并排序算法讲向量层层均分为子向量后，形成了一个像二叉树一样的结构。由于这个类二叉树状的结构中每层里的每个递归实例中的二路归并算法只需要线性时间，因此一层中所有递归实例消耗时间之和也是线性的$\\Theta (n)$。又由于这个类二叉树状的结构一共有$\\Theta \\log_2n$层，因此整个归并排序算法总计需要$\\Theta (n\\log n)$时间。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"dsa-6","published":1,"updated":"2022-04-10T14:10:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz08001g1q390ucv5bqb","content":"<p>之前的文章已经说过，有序性在很多场合都可以极大地提高计算的效率。想要向量有序，必须借助排序算法。本文就将从向量这一数据结构切入，介绍一下排序算法。</p>\n<h2 id=\"排序与下界\"><a href=\"#排序与下界\" class=\"headerlink\" title=\"排序与下界\"></a>排序与下界</h2><h3 id=\"排序算法\"><a href=\"#排序算法\" class=\"headerlink\" title=\"排序算法\"></a>排序算法</h3><p>排序算法的种类繁多，根据其处理数据的规模和存储的特点不同，可以分为内部排序算法和外部排序算法。内部排序算法处理的数据规模相对不大，内存足以容纳；外部排序算法处理的数据规模很大，必须借助外部甚至分布式存储器，在排序计算的过程中，内存只能容纳一小部分数据。</p>\n<p>根据排序算法输入形式的不同，排序算法又可以分为离线算法和在线算法。离线算法将待排序的数据以批处理的形式整体给出；在线算法中待排序的数据需要实时生成，算法启动后数据陆续到达。</p>\n<p>此外还可以根据依赖的体系结构不同，将排序算法分为串行和并行两类；还可以根据排序算法是否采用随机策略，将其分为确定式和随机式。</p>\n<p>在这一系列的文章中，主要讨论确定式串行离线的内部排序算法。</p>\n<h3 id=\"下界\"><a href=\"#下界\" class=\"headerlink\" title=\"下界\"></a>下界</h3><p>对于任意特定的应用问题，随着算法的改进，其效率的提高必定有一极限，因为不可能不劳而获。这一极限必然存在，其具体数值取决于应用问题本身以及其所采用的计算模型。</p>\n<p>一般的，任一问题在最坏情况下的最低计算成本，即为该问题的<em>复杂度下界</em>。一旦某一算法的性能达到这一下界，就意味着它已经式最坏情况下最优的算法了。</p>\n<p>注意，不要将问题的复杂度下界与算法的最优复杂度混淆。复杂度下界是针对<strong>特定问题</strong>而言的，处理这个问题的算法可以有很多，但是一定有一个简单到不能再简单的算法。算法的复杂度是针对<strong>特定的算法</strong>，在不同输入下，算法处理这些输入所需要的时间或者空间。</p>\n<p>对于排序算法，可以用比较树来辅助我们确定它的复杂度下界。</p>\n<p>比较树有点像一棵二叉树，它具有如下的性质：</p>\n<ul>\n<li>每一内部节点各对应于一次比对操作</li>\n<li>内部节点的左、右分之，分别对应于在两种比对结果下的执行方向</li>\n<li>叶节点（或根节点到叶节点的路径）对应于算法某次执行的完整过程及输出</li>\n<li>反过来，算法每一次运行的过程都对应于从根到某一叶节点的路径</li>\n</ul>\n<p>将比较树推广到其他类型的算法上，只要其中的分支都完全取决于不同变量或常量的比对或比较结果，则该算法的所有可能执行过程都可以表示和概括为一棵比较树。反之，凡是可以如此描述的算法，都称作基于比较式的算法，简称<em>CBA算法</em>。</p>\n<h3 id=\"使用比较树估计下界\"><a href=\"#使用比较树估计下界\" class=\"headerlink\" title=\"使用比较树估计下界\"></a>使用比较树估计下界</h3><p>考察任一CBA式算法，设$CT(A)$为与之对应的一棵比较树。由此，算法A在最坏的情况下的运行时间，将取决于比较树中所有的叶节点的最大深度（称作该树的高度，记为$h(CT(A))$）。因此就渐进的意义来说，算法A的时间复杂度不低于$\\Omega(h(CT(A)))$。由于算法A处理该问题的时间复杂度是确定的，那么对于其他问题，该算法处理那些问题的时间复杂度也在$\\Omega(h(CT(A)))$附近。因此，这里使用了大$\\Omega$记号。</p>\n<p>任一CBA式算法都对应于某棵比较树，该问题的复杂度下界就应等于这些比较树的最小高度，而这可以通过考察树中所含的叶节点数目确定。具体的，在一棵高度为$h$的二叉树中，叶姐带你的数目不可能多于$2^h$。因此反过来，如果某一问题的输出结果不少于$N$种，则比较树中叶节点也不可能少于$N$个，树高不可能低于$\\log_2N$。</p>\n<p>考虑CBA式排序算法，就$n$个元素的排序算法而言，可能的输出共有$N = n!$种。此时，待排序的元素之间不仅可以判等还可以比较大小，因此此时的比较树应为三叉树，也即每个非叶节点都有三个分支。仿照上面的思路，任一CBA式排序算法所对应的比较树高度应为：$h\\ge \\lceil\\log_3(n!)\\rceil = \\lceil\\log_3e\\cdot\\ln(n!)=\\Omega(n\\log n)$。</p>\n<p>可见，最坏情况下CBA式排序算法至少需要$\\Omega(n\\log n)$的时间，其中$n$为待排序元素数目。</p>\n<h3 id=\"排序算法的稳定性\"><a href=\"#排序算法的稳定性\" class=\"headerlink\" title=\"排序算法的稳定性\"></a>排序算法的稳定性</h3><p>在将无序向量<code>A</code>转换为有序向量<code>S</code>之后，设<code>A[i]</code>对应于<code>S[ki]</code>。若对于<code>A</code>中每一对重复元素<code>A[i] = A[j]</code>，相应的有<code>S[ki] = S[kj]</code>，都有<code>i</code>小于<code>j</code>当且仅当<code>ki</code>小于<code>kj</code>，那么称该排序算法是<em>稳定算法</em>。简而言之，稳定算法的特点是，重复元素之间的相对次序在排序前后保持一致，反之则称为不稳定算法。</p>\n<p>在之前的文章中我们介绍过起泡排序，该算法中重复元素不会进行交换。因此，气泡排序属于稳定算法。</p>\n<p>稳定的排序算法可以用来实现同时对多个关键码按照字典顺序的排序。</p>\n<h2 id=\"归并排序\"><a href=\"#归并排序\" class=\"headerlink\" title=\"归并排序\"></a>归并排序</h2><p>归并排序是第一个可以在最坏情况下依然保持$\\mathcal O (n\\log n)$运行时间的确定性排序算法。</p>\n<h3 id=\"二路归并\"><a href=\"#二路归并\" class=\"headerlink\" title=\"二路归并\"></a>二路归并</h3><p>归并排序可以理解为通过反复调用所谓二路归并算法实现的。所谓二路归并，指的是将两个有序序列合并称为一个有序序列。这里的有序序列既可以是向量，也可以是列表。在这里我们只考虑向量的情况。</p>\n<p>二路归并属于迭代式算法。每步迭代中，只需要比较两个待归并有序向量的首元素，将小者取出并追加到输出向量的末尾，该元素在原向量中的后继则成为新的首元素。如此往复，直到某一向量为空。最后，将另一非空的有序输入向量整体接至输出向量的末尾。下图给出了有序向量的二路归并实例。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-6-1.png\" alt=\"有序向量的二路归并实例\"></p>\n<p>由此可知，二路归并算法在任何时刻都只需要载入两个向量的首元素，故除了归并输出的向量外，仅需要常数规模的辅助空间。另外该算法始终严格地按照顺序处理输入和输出向量，故特别适用于使用磁带机等顺序存储器的场合。</p>\n<h3 id=\"归并排序的实现\"><a href=\"#归并排序的实现\" class=\"headerlink\" title=\"归并排序的实现\"></a>归并排序的实现</h3><p>下面给出了归并排序算法的实现代码。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//向量归并排序</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">mergeSort</span> ( Rank lo, Rank hi ) &#123; <span class=\"comment\">//0 &lt;= lo &lt; hi &lt;= size</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( hi - lo &lt; <span class=\"number\">2</span> ) <span class=\"keyword\">return</span>; <span class=\"comment\">//单元素区间自然有序，否则...</span></span><br><span class=\"line\">   Rank mi = ( lo + hi ) / <span class=\"number\">2</span>; <span class=\"comment\">//以中点为界</span></span><br><span class=\"line\">   <span class=\"built_in\">mergeSort</span> ( lo, mi ); <span class=\"built_in\">mergeSort</span> ( mi, hi ); <span class=\"comment\">//分别排序</span></span><br><span class=\"line\">   <span class=\"built_in\">merge</span> ( lo, mi, hi ); <span class=\"comment\">//归并</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>归并排序算法属于典型的采用了分治策略的算法。上面的代码以递归的方式实现了归并排序。</p>\n<p>该算法将向量均匀地分为两个子向量，将这两个子向量递归地转换为有序向量后，再进行二路归并，即可将整个向量转化为有序向量。这里的递归终止条件是当前向量长度$\\rm{n = hi - lo =1}$：只有一个元素的向量天然就是有序的，因此可以将这一分支作为递归基。注意，二路归并是归并排序算法的一部分，受到归并算法的调用。</p>\n<p>下图给出了归并排序算法的一个完整实例。由图可以清晰地看出，含8个元素的向量在递归过程中不断被均分，直到到达只有一个元素的向量的递归基。然后各子向量开始层层返回，每返回一次就进行一次二路归并。最后递归返回结束，得到整体有序的向量。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-6-2.png\" alt=\"归并排序实例\"></p>\n<h3 id=\"二路归并的实现\"><a href=\"#二路归并的实现\" class=\"headerlink\" title=\"二路归并的实现\"></a>二路归并的实现</h3><p>下面给出了二路归并算法的代码。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//有序向量（区间）的归并</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">merge</span> ( Rank lo, Rank mi, Rank hi ) &#123; <span class=\"comment\">//[lo, mi)和[mi, hi)各自有序，lo &lt; mi &lt; hi</span></span><br><span class=\"line\">   Rank i = <span class=\"number\">0</span>; T* A = _elem + lo; <span class=\"comment\">//合并后的有序向量A[0, hi - lo) = _elem[lo, hi)，就地</span></span><br><span class=\"line\">   Rank j = <span class=\"number\">0</span>, lb = mi - lo; T* B = <span class=\"keyword\">new</span> T[lb]; <span class=\"comment\">//前子向量B[0, lb) &lt;-- _elem[lo, mi)</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; lb; i++ ) B[i] = A[i]; <span class=\"comment\">//复制自A的前缀</span></span><br><span class=\"line\">   Rank k = <span class=\"number\">0</span>, lc = hi - mi; T* C = _elem + mi; <span class=\"comment\">//后子向量C[0, lc) = _elem[mi, hi)，就地</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( ( j &lt; lb ) &amp;&amp; ( k &lt; lc ) ) <span class=\"comment\">//反复地比较B、C的首元素</span></span><br><span class=\"line\">      A[i++] = ( B[j] &lt;= C[k] ) ? B[j++] : C[k++]; <span class=\"comment\">//将更小者归入A中</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( j &lt; lb ) <span class=\"comment\">//若C先耗尽，则</span></span><br><span class=\"line\">      A[i++] = B[j++]; <span class=\"comment\">//将B残余的后缀归入A中</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> [] B; <span class=\"comment\">//释放临时空间</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>第7行代码中，循环在前向量<code>B</code>首元素的下标<code>j</code>和后向量<code>C</code>首元素的下标<code>k</code>都不越界时，持续向前进行，反复比较<code>B</code>和<code>C</code>的首元素。在第9行代码中，如果<code>C</code>的首元素下标先越界，那么就将<code>B</code>的残余后缀归入<code>A</code>中。如果是<code>B</code>的首元素下标先越界，那么理论上就要将<code>C</code>的残余后缀归入<code>A</code>中。但是这里<code>C</code>本身就在<code>A</code>中，因此不需要额外的移动操作了。</p>\n<h3 id=\"复杂度分析\"><a href=\"#复杂度分析\" class=\"headerlink\" title=\"复杂度分析\"></a>复杂度分析</h3><p>归并排序算法的时间成本主要取决于二路归并算法。</p>\n<p>二路归并算法<code>merge()</code>的时间成本取决于其中循环迭代的总次数，其迭代的次数永远不会超过输入向量的长度，也即$\\mathcal O (\\rm{hi - mi}) = \\mathcal O (n)$。另外，无论子向量的内部元素组成及其相对大小如何，只有前后两个输入向量都归入输出向量后，迭代才能终止。因此该算法在最好的情况下仍然需要$\\Omega (n)$时间。综上，二路归并算法需要的时间为$\\Theta (n)$。即使两个子向量在物理上并非前后衔接，且长度相差悬殊，二路归并算法依然可行并且只需要线性时间。</p>\n<p>前面说过，对某个特定的排序问题，无论使用何种CBA排序算法，它的复杂度下界都是$\\Omega(n\\log n)$，这并不与二路归并算法的时间复杂度为$\\Omega (n)$矛盾。因为二路归并算法的输入并不是完全随机的无序向量，实际上它的输入已经具有相当的有序性。</p>\n<p>基于以上分析，可以得到归并排序算法的时间复杂度。</p>\n<p>将归并算法处理长度为$n$的向量所需要的时间记为$T(n)$。归并算法需要递归地对长度各为$n/2$的两个子向量做归并排序，然后再花费$\\mathcal O (n)$时间做一次二路归并。由此可以得到：$T(n) = 2T(n/2) + \\mathcal O (n)$。特别的，在递归基处有$T(1) = \\mathcal O (1)$。由以上递推公式可以得到$T(n) = \\mathcal O (n\\log n)$。由于二路归并算法的效率稳定在$\\Theta (n)$，因此更准确地讲，归并排序算法的时间复杂度应为$\\Theta (n\\log n)$。</p>\n<p>归并排序算法的复杂度也可通过下面的方式分析出来。归并排序算法讲向量层层均分为子向量后，形成了一个像二叉树一样的结构。由于这个类二叉树状的结构中每层里的每个递归实例中的二路归并算法只需要线性时间，因此一层中所有递归实例消耗时间之和也是线性的$\\Theta (n)$。又由于这个类二叉树状的结构一共有$\\Theta \\log_2n$层，因此整个归并排序算法总计需要$\\Theta (n\\log n)$时间。</p>\n","site":{"data":{}},"more":"<p>之前的文章已经说过，有序性在很多场合都可以极大地提高计算的效率。想要向量有序，必须借助排序算法。本文就将从向量这一数据结构切入，介绍一下排序算法。</p>\n<h2 id=\"排序与下界\"><a href=\"#排序与下界\" class=\"headerlink\" title=\"排序与下界\"></a>排序与下界</h2><h3 id=\"排序算法\"><a href=\"#排序算法\" class=\"headerlink\" title=\"排序算法\"></a>排序算法</h3><p>排序算法的种类繁多，根据其处理数据的规模和存储的特点不同，可以分为内部排序算法和外部排序算法。内部排序算法处理的数据规模相对不大，内存足以容纳；外部排序算法处理的数据规模很大，必须借助外部甚至分布式存储器，在排序计算的过程中，内存只能容纳一小部分数据。</p>\n<p>根据排序算法输入形式的不同，排序算法又可以分为离线算法和在线算法。离线算法将待排序的数据以批处理的形式整体给出；在线算法中待排序的数据需要实时生成，算法启动后数据陆续到达。</p>\n<p>此外还可以根据依赖的体系结构不同，将排序算法分为串行和并行两类；还可以根据排序算法是否采用随机策略，将其分为确定式和随机式。</p>\n<p>在这一系列的文章中，主要讨论确定式串行离线的内部排序算法。</p>\n<h3 id=\"下界\"><a href=\"#下界\" class=\"headerlink\" title=\"下界\"></a>下界</h3><p>对于任意特定的应用问题，随着算法的改进，其效率的提高必定有一极限，因为不可能不劳而获。这一极限必然存在，其具体数值取决于应用问题本身以及其所采用的计算模型。</p>\n<p>一般的，任一问题在最坏情况下的最低计算成本，即为该问题的<em>复杂度下界</em>。一旦某一算法的性能达到这一下界，就意味着它已经式最坏情况下最优的算法了。</p>\n<p>注意，不要将问题的复杂度下界与算法的最优复杂度混淆。复杂度下界是针对<strong>特定问题</strong>而言的，处理这个问题的算法可以有很多，但是一定有一个简单到不能再简单的算法。算法的复杂度是针对<strong>特定的算法</strong>，在不同输入下，算法处理这些输入所需要的时间或者空间。</p>\n<p>对于排序算法，可以用比较树来辅助我们确定它的复杂度下界。</p>\n<p>比较树有点像一棵二叉树，它具有如下的性质：</p>\n<ul>\n<li>每一内部节点各对应于一次比对操作</li>\n<li>内部节点的左、右分之，分别对应于在两种比对结果下的执行方向</li>\n<li>叶节点（或根节点到叶节点的路径）对应于算法某次执行的完整过程及输出</li>\n<li>反过来，算法每一次运行的过程都对应于从根到某一叶节点的路径</li>\n</ul>\n<p>将比较树推广到其他类型的算法上，只要其中的分支都完全取决于不同变量或常量的比对或比较结果，则该算法的所有可能执行过程都可以表示和概括为一棵比较树。反之，凡是可以如此描述的算法，都称作基于比较式的算法，简称<em>CBA算法</em>。</p>\n<h3 id=\"使用比较树估计下界\"><a href=\"#使用比较树估计下界\" class=\"headerlink\" title=\"使用比较树估计下界\"></a>使用比较树估计下界</h3><p>考察任一CBA式算法，设$CT(A)$为与之对应的一棵比较树。由此，算法A在最坏的情况下的运行时间，将取决于比较树中所有的叶节点的最大深度（称作该树的高度，记为$h(CT(A))$）。因此就渐进的意义来说，算法A的时间复杂度不低于$\\Omega(h(CT(A)))$。由于算法A处理该问题的时间复杂度是确定的，那么对于其他问题，该算法处理那些问题的时间复杂度也在$\\Omega(h(CT(A)))$附近。因此，这里使用了大$\\Omega$记号。</p>\n<p>任一CBA式算法都对应于某棵比较树，该问题的复杂度下界就应等于这些比较树的最小高度，而这可以通过考察树中所含的叶节点数目确定。具体的，在一棵高度为$h$的二叉树中，叶姐带你的数目不可能多于$2^h$。因此反过来，如果某一问题的输出结果不少于$N$种，则比较树中叶节点也不可能少于$N$个，树高不可能低于$\\log_2N$。</p>\n<p>考虑CBA式排序算法，就$n$个元素的排序算法而言，可能的输出共有$N = n!$种。此时，待排序的元素之间不仅可以判等还可以比较大小，因此此时的比较树应为三叉树，也即每个非叶节点都有三个分支。仿照上面的思路，任一CBA式排序算法所对应的比较树高度应为：$h\\ge \\lceil\\log_3(n!)\\rceil = \\lceil\\log_3e\\cdot\\ln(n!)=\\Omega(n\\log n)$。</p>\n<p>可见，最坏情况下CBA式排序算法至少需要$\\Omega(n\\log n)$的时间，其中$n$为待排序元素数目。</p>\n<h3 id=\"排序算法的稳定性\"><a href=\"#排序算法的稳定性\" class=\"headerlink\" title=\"排序算法的稳定性\"></a>排序算法的稳定性</h3><p>在将无序向量<code>A</code>转换为有序向量<code>S</code>之后，设<code>A[i]</code>对应于<code>S[ki]</code>。若对于<code>A</code>中每一对重复元素<code>A[i] = A[j]</code>，相应的有<code>S[ki] = S[kj]</code>，都有<code>i</code>小于<code>j</code>当且仅当<code>ki</code>小于<code>kj</code>，那么称该排序算法是<em>稳定算法</em>。简而言之，稳定算法的特点是，重复元素之间的相对次序在排序前后保持一致，反之则称为不稳定算法。</p>\n<p>在之前的文章中我们介绍过起泡排序，该算法中重复元素不会进行交换。因此，气泡排序属于稳定算法。</p>\n<p>稳定的排序算法可以用来实现同时对多个关键码按照字典顺序的排序。</p>\n<h2 id=\"归并排序\"><a href=\"#归并排序\" class=\"headerlink\" title=\"归并排序\"></a>归并排序</h2><p>归并排序是第一个可以在最坏情况下依然保持$\\mathcal O (n\\log n)$运行时间的确定性排序算法。</p>\n<h3 id=\"二路归并\"><a href=\"#二路归并\" class=\"headerlink\" title=\"二路归并\"></a>二路归并</h3><p>归并排序可以理解为通过反复调用所谓二路归并算法实现的。所谓二路归并，指的是将两个有序序列合并称为一个有序序列。这里的有序序列既可以是向量，也可以是列表。在这里我们只考虑向量的情况。</p>\n<p>二路归并属于迭代式算法。每步迭代中，只需要比较两个待归并有序向量的首元素，将小者取出并追加到输出向量的末尾，该元素在原向量中的后继则成为新的首元素。如此往复，直到某一向量为空。最后，将另一非空的有序输入向量整体接至输出向量的末尾。下图给出了有序向量的二路归并实例。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-6-1.png\" alt=\"有序向量的二路归并实例\"></p>\n<p>由此可知，二路归并算法在任何时刻都只需要载入两个向量的首元素，故除了归并输出的向量外，仅需要常数规模的辅助空间。另外该算法始终严格地按照顺序处理输入和输出向量，故特别适用于使用磁带机等顺序存储器的场合。</p>\n<h3 id=\"归并排序的实现\"><a href=\"#归并排序的实现\" class=\"headerlink\" title=\"归并排序的实现\"></a>归并排序的实现</h3><p>下面给出了归并排序算法的实现代码。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//向量归并排序</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">mergeSort</span> ( Rank lo, Rank hi ) &#123; <span class=\"comment\">//0 &lt;= lo &lt; hi &lt;= size</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( hi - lo &lt; <span class=\"number\">2</span> ) <span class=\"keyword\">return</span>; <span class=\"comment\">//单元素区间自然有序，否则...</span></span><br><span class=\"line\">   Rank mi = ( lo + hi ) / <span class=\"number\">2</span>; <span class=\"comment\">//以中点为界</span></span><br><span class=\"line\">   <span class=\"built_in\">mergeSort</span> ( lo, mi ); <span class=\"built_in\">mergeSort</span> ( mi, hi ); <span class=\"comment\">//分别排序</span></span><br><span class=\"line\">   <span class=\"built_in\">merge</span> ( lo, mi, hi ); <span class=\"comment\">//归并</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>归并排序算法属于典型的采用了分治策略的算法。上面的代码以递归的方式实现了归并排序。</p>\n<p>该算法将向量均匀地分为两个子向量，将这两个子向量递归地转换为有序向量后，再进行二路归并，即可将整个向量转化为有序向量。这里的递归终止条件是当前向量长度$\\rm{n = hi - lo =1}$：只有一个元素的向量天然就是有序的，因此可以将这一分支作为递归基。注意，二路归并是归并排序算法的一部分，受到归并算法的调用。</p>\n<p>下图给出了归并排序算法的一个完整实例。由图可以清晰地看出，含8个元素的向量在递归过程中不断被均分，直到到达只有一个元素的向量的递归基。然后各子向量开始层层返回，每返回一次就进行一次二路归并。最后递归返回结束，得到整体有序的向量。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-6-2.png\" alt=\"归并排序实例\"></p>\n<h3 id=\"二路归并的实现\"><a href=\"#二路归并的实现\" class=\"headerlink\" title=\"二路归并的实现\"></a>二路归并的实现</h3><p>下面给出了二路归并算法的代码。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//有序向量（区间）的归并</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">merge</span> ( Rank lo, Rank mi, Rank hi ) &#123; <span class=\"comment\">//[lo, mi)和[mi, hi)各自有序，lo &lt; mi &lt; hi</span></span><br><span class=\"line\">   Rank i = <span class=\"number\">0</span>; T* A = _elem + lo; <span class=\"comment\">//合并后的有序向量A[0, hi - lo) = _elem[lo, hi)，就地</span></span><br><span class=\"line\">   Rank j = <span class=\"number\">0</span>, lb = mi - lo; T* B = <span class=\"keyword\">new</span> T[lb]; <span class=\"comment\">//前子向量B[0, lb) &lt;-- _elem[lo, mi)</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank i = <span class=\"number\">0</span>; i &lt; lb; i++ ) B[i] = A[i]; <span class=\"comment\">//复制自A的前缀</span></span><br><span class=\"line\">   Rank k = <span class=\"number\">0</span>, lc = hi - mi; T* C = _elem + mi; <span class=\"comment\">//后子向量C[0, lc) = _elem[mi, hi)，就地</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( ( j &lt; lb ) &amp;&amp; ( k &lt; lc ) ) <span class=\"comment\">//反复地比较B、C的首元素</span></span><br><span class=\"line\">      A[i++] = ( B[j] &lt;= C[k] ) ? B[j++] : C[k++]; <span class=\"comment\">//将更小者归入A中</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( j &lt; lb ) <span class=\"comment\">//若C先耗尽，则</span></span><br><span class=\"line\">      A[i++] = B[j++]; <span class=\"comment\">//将B残余的后缀归入A中</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> [] B; <span class=\"comment\">//释放临时空间</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>第7行代码中，循环在前向量<code>B</code>首元素的下标<code>j</code>和后向量<code>C</code>首元素的下标<code>k</code>都不越界时，持续向前进行，反复比较<code>B</code>和<code>C</code>的首元素。在第9行代码中，如果<code>C</code>的首元素下标先越界，那么就将<code>B</code>的残余后缀归入<code>A</code>中。如果是<code>B</code>的首元素下标先越界，那么理论上就要将<code>C</code>的残余后缀归入<code>A</code>中。但是这里<code>C</code>本身就在<code>A</code>中，因此不需要额外的移动操作了。</p>\n<h3 id=\"复杂度分析\"><a href=\"#复杂度分析\" class=\"headerlink\" title=\"复杂度分析\"></a>复杂度分析</h3><p>归并排序算法的时间成本主要取决于二路归并算法。</p>\n<p>二路归并算法<code>merge()</code>的时间成本取决于其中循环迭代的总次数，其迭代的次数永远不会超过输入向量的长度，也即$\\mathcal O (\\rm{hi - mi}) = \\mathcal O (n)$。另外，无论子向量的内部元素组成及其相对大小如何，只有前后两个输入向量都归入输出向量后，迭代才能终止。因此该算法在最好的情况下仍然需要$\\Omega (n)$时间。综上，二路归并算法需要的时间为$\\Theta (n)$。即使两个子向量在物理上并非前后衔接，且长度相差悬殊，二路归并算法依然可行并且只需要线性时间。</p>\n<p>前面说过，对某个特定的排序问题，无论使用何种CBA排序算法，它的复杂度下界都是$\\Omega(n\\log n)$，这并不与二路归并算法的时间复杂度为$\\Omega (n)$矛盾。因为二路归并算法的输入并不是完全随机的无序向量，实际上它的输入已经具有相当的有序性。</p>\n<p>基于以上分析，可以得到归并排序算法的时间复杂度。</p>\n<p>将归并算法处理长度为$n$的向量所需要的时间记为$T(n)$。归并算法需要递归地对长度各为$n/2$的两个子向量做归并排序，然后再花费$\\mathcal O (n)$时间做一次二路归并。由此可以得到：$T(n) = 2T(n/2) + \\mathcal O (n)$。特别的，在递归基处有$T(1) = \\mathcal O (1)$。由以上递推公式可以得到$T(n) = \\mathcal O (n\\log n)$。由于二路归并算法的效率稳定在$\\Theta (n)$，因此更准确地讲，归并排序算法的时间复杂度应为$\\Theta (n\\log n)$。</p>\n<p>归并排序算法的复杂度也可通过下面的方式分析出来。归并排序算法讲向量层层均分为子向量后，形成了一个像二叉树一样的结构。由于这个类二叉树状的结构中每层里的每个递归实例中的二路归并算法只需要线性时间，因此一层中所有递归实例消耗时间之和也是线性的$\\Theta (n)$。又由于这个类二叉树状的结构一共有$\\Theta \\log_2n$层，因此整个归并排序算法总计需要$\\Theta (n\\log n)$时间。</p>\n"},{"title":"DSA-7：列表及其接口设计1","date":"2022-04-12T13:50:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"列表就是链表。","_content":"\n## 从向量到列表\n\n向量采用“循秩访问”的方式，可以通过秩直接访问对应元素。列表与向量同属于序列结构的范畴，其中的元素也构成一个线性逻辑次序。但是与向量极为不同的是，列表中元素的物理地址可以是任意的。\n\n为了保证对列表元素访问的可行性，逻辑上互为前驱和后继的元素之间，应当维护某种索引关系。这种索引索引关系，可以抽象地理解为被索引元素的位置。因此列表元素是“循位置访问”。索引还可以理解为通往被索引元素的链接，因此也可以被称作是“循链接访问”。\n\n列表结构相比于向量，在解决某些问题时有其独有的优势，可以弥补向量结构在功能和性能方面的不足。\n\n### 从静态到动态\n\n数据结构支持静态和动态两种操作，静态操作仅从中获取信息，后者则会修改数据结构的局部甚至整体。\n\n向量采用的就是静态的存储策略，可以在$\\mathcal O(1)$时间内由秩确定向量元素的物理地址，但是在添加或者删除元素时，会伴随着$\\mathcal O(n)$元素的移动。\n\n列表结构要求元素在逻辑上具有线性次序，但是对其物理地址并未作任何限制——这就是采用了“动态存储”的策略。在生命周期内，动态存储的数据结构将随着内部数据的需要，相应地分配或回收局部的数据空间。为了实现这一功能，该类结构需要使用指针或者引用的方法，来确定各个元素实际的物理地址。\n\n采用动态存储的策略可以大大降低动态操作的成本。\n\n### 由秩到位置\n\n相对应的，采用动态存储的策略时，静态操作的性能会有所下降。\n\n以列表为例，为了访问秩为`r`的元素，我们只能顺着相邻元素之间的指针，从某一端出发逐个扫描各个元素，经过`r`步迭代之后才能确定该元素的物理存储位置。这意味着，原先只需要$\\mathcal O(1)$时间的静态操作，此时的复杂度也将线性正比于被访问元素的秩，在最坏情况下等于元素总数`n`。即使在各个元素被访问概率相等的情况下，平均而言也需要$\\mathcal O(n)$时间。\n\n对于采用动态存储策略的数据结构，应该通过位置而非秩来指代并访问其中的数据元素。列表中的位置是指代各数据元素的一个标识性指标，借助它可以便捷地得到元素的物理存储地址。各个元素的位置，通常可以表示和实现为联结与元素之间的指针和引用。\n\n### 列表\n\n与向量一样，列表也是由线性逻辑次序的一组元素构成的集合：\n\n$L = \\{ a_0, a_1, ..., a_{n-1} \\}$\n\n列表是链表结构的一般化推广，其中的元素称作节点，分别由特定的位置或者链接指代。与向量一样，在元素之间也可以定义前驱、直接前驱、后继、直接后继。相对于任意元素，也有定义对应的前缀、后缀等子集。\n\n## 列表的基本接口\n\n由上面的叙述可知，列表节点除了需要保存对应的数据项，还需要记录其前驱和后继的位置。因此这里首先设计列表节点对象，然后通过基本的节点去构建列表。\n\n### 列表节点\n\n列表节点对象应该支持下面的操作接口：\n\n|     操作接口      |                      功能                       |\n| :---------------: | :---------------------------------------------: |\n|      `data`       |            当前节点所存储的数据对象             |\n|      `pred`       |             当前节点前驱节点的位置              |\n|      `succ`       |             当前节点后继节点的位置              |\n| `insertAsPred(e)` | 插入前驱节点，存入被引用对象`e`，返回新节点位置 |\n| `insertAsSucc(e)` | 插入后继节点，存入被引用对象`e`，返回新节点位置 |\n\n根据上表的内容，可以设计`ListNode`模板类如下：\n\n```c++\nusing Rank = int; //秩\ntemplate <typename T> struct ListNode;\ntemplate <typename T> using ListNodePosi = ListNode<T>*; //列表节点位置\ntemplate <typename T> struct ListNode { //列表节点模板类（以双向链表形式实现）\n// 成员\n   T data; ListNodePosi<T> pred; ListNodePosi<T> succ; //数值、前驱、后继\n// 构造函数\n   ListNode() {} //针对header和trailer的构造\n   ListNode ( T e, ListNodePosi<T> p = NULL, ListNodePosi<T> s = NULL )\n      : data ( e ), pred ( p ), succ ( s ) {} //默认构造器\n// 操作接口\n   ListNodePosi<T> insertAsPred ( T const& e ); //紧靠当前节点之前插入新节点\n   ListNodePosi<T> insertAsSucc ( T const& e ); //紧随当前节点之后插入新节点\n};\n```\n\n### 列表\n\n列表对象应该支持下面的操作接口：\n\n|               操作接口                |                      功能                      | 适用对象 |\n| :-----------------------------------: | :--------------------------------------------: | :------: |\n|               `size()`                |         报告列表当前的规模（节点总数）         |   列表   |\n|          `first()`、`last()`          |              返回首、末节点的位置              |   列表   |\n| `insertAsFirst(e)`、`insertAsLast(e)` |            将`e`当作首、末节点插入             |   列表   |\n|   `insertA(p, e)`、`insertB(p, e)`    |      将`e`当作节点`p`的直接后继、前驱插入      |   列表   |\n|              `remove(p)`              |        删除位置`p`处的节点，返回其数值         |   列表   |\n|            `disordered()`             |         判断所有节点是否已按非降序排列         |   列表   |\n|               `sort()`                |       调整各节点的位置，使之按非降序排列       |   列表   |\n|               `find(e)`               |       查找目标元素`e`，失败时返回`NULL`        |   列表   |\n|              `search(e)`              |  查找目标元素`e`，返回不大于`e`且秩最大的节点  | 有序列表 |\n|            `deduplicate()`            |                  剔除重复节点                  |   列表   |\n|             `uniquify()`              |                  剔除重复节点                  | 有序列表 |\n|             `traverse()`              | 遍历并统一处理所有节点，处理方法由函数对象决定 |   列表   |\n\n根据上表的内容，可以设计`List`模板类如下：\n\n{% codeblock lang:C++ >folded %}\n\ntemplate <typename T> class List { //列表模板类\n\nprivate:\n   int _size; ListNodePosi<T> header; ListNodePosi<T> trailer; //规模、头哨兵、尾哨兵\n\nprotected:\n   void init(); //列表创建时的初始化\n   int clear(); //清除所有节点\n   void copyNodes ( ListNodePosi<T>, int ); //复制列表中自位置p起的n项\n   ListNodePosi<T> merge ( ListNodePosi<T>, int, List<T> &, ListNodePosi<T>, int ); //归并\n   void mergeSort ( ListNodePosi<T> &, int ); //对从p开始连续的n个节点归并排序\n   void selectionSort ( ListNodePosi<T>, int ); //对从p开始连续的n个节点选择排序\n   void insertionSort ( ListNodePosi<T>, int ); //对从p开始连续的n个节点插入排序\n   void radixSort(ListNodePosi<T>, int); //对从p开始连续的n个节点基数排序\n\npublic:\n// 构造函数\n   List() { init(); } //默认\n   List ( List<T> const& L ); //整体复制列表L\n   List ( List<T> const& L, Rank r, int n ); //复制列表L中自第r项起的n项\n   List ( ListNodePosi<T> p, int n ); //复制列表中自位置p起的n项\n// 析构函数\n   ~List(); //释放（包含头、尾哨兵在内的）所有节点\n// 只读访问接口\n   Rank size() const { return _size; } //规模\n   bool empty() const { return _size <= 0; } //判空\n   T& operator[] ( Rank r ) const; //重载，支持循秩访问（效率低）\n   ListNodePosi<T> first() const { return header->succ; } //首节点位置\n   ListNodePosi<T> last() const { return trailer->pred; } //末节点位置\n   bool valid ( ListNodePosi<T> p ) //判断位置p是否对外合法\n   { return p && ( trailer != p ) && ( header != p ); } //将头、尾节点等同于NULL\n   ListNodePosi<T> find ( T const& e ) const //无序列表查找\n   { return find ( e, _size, trailer ); }\n   ListNodePosi<T> find ( T const& e, int n, ListNodePosi<T> p ) const; //无序区间查找\n   ListNodePosi<T> search ( T const& e ) const //有序列表查找\n   { return search ( e, _size, trailer ); }\n   ListNodePosi<T> search ( T const& e, int n, ListNodePosi<T> p ) const; //有序区间查找\n   ListNodePosi<T> selectMax ( ListNodePosi<T> p, int n ); //在p及其n-1个后继中选出最大者\n   ListNodePosi<T> selectMax() { return selectMax ( header->succ, _size ); } //整体最大者\n// 可写访问接口\n   ListNodePosi<T> insertAsFirst ( T const& e ); //将e当作首节点插入\n   ListNodePosi<T> insertAsLast ( T const& e ); //将e当作末节点插入\n   ListNodePosi<T> insert ( ListNodePosi<T> p, T const& e ); //将e当作p的后继插入\n   ListNodePosi<T> insert ( T const& e, ListNodePosi<T> p ); //将e当作p的前驱插入\n   T remove ( ListNodePosi<T> p ); //删除合法位置p处的节点,返回被删除节点\n   void merge ( List<T> & L ) { merge ( header->succ, _size, L, L.header->succ, L._size ); } //全列表归并\n   void sort ( ListNodePosi<T> p, int n ); //列表区间排序\n   void sort() { sort ( first(), _size ); } //列表整体排序\n   int deduplicate(); //无序去重\n   int uniquify(); //有序去重\n   void reverse(); //前后倒置（习题）\n// 遍历\n   void traverse ( void (* ) ( T& ) ); //遍历，依次实施visit操作（函数指针，只读或局部性修改）\n   template <typename VST> //操作器\n   void traverse ( VST& ); //遍历，依次实施visit操作（函数对象，可全局性修改）\n}; //List\n\n{% endcodeblock %}\n\n## 列表的基本接口（其一）\n\n### 头、尾节点\n\n列表中存在有头节点和尾节点，它们是私有的，对外界不可见。如果存在对外部可见的数据节点，则其中的第一个和最后一个节点分别称作首节点和末节点。列表对象内部的组成及逻辑结构如下图所示：\n\n![列表的结构](https://astrobear.top/resource/astroblog/content/dsa-7-1.png)\n\n就内部结构而言，头节点紧邻于首节点之前，尾节点紧邻于末节点之后。这类封装之后从外部不可见的节点，称作哨兵节点。此处的两个哨兵节点被等效地视作`NULL`。\n\n设置了哨兵节点之后，对于从外部可见的任一节点而言，其前驱和后继在列表内部都必然存在。这使得相关算法不必再对各种边界退化情况做专门的处理，从而避免了出错的可能，还带来了许多的便利。\n\n### 默认构造方法\n\n创建`List`对象时，默认构造方法将调用下面的统一初始化过程`init()`。该函数完成了以下工作：\n\n- 在列表内部创建了头、尾哨兵节点\n- 将头哨兵节点的前驱设为`NULL`，后继设为尾哨兵节点\n- 将尾哨兵节点的后继设为`NULL`，前驱设为头哨兵节点\n- 将列表规模置零\n\n新创建出来的`List`对象如下图所示，其对外的有效部分初始为空，哨兵节点对外不可见，此后插入的新节点都将在两哨兵节点之间。\n\n![新创建的列表的结构](https://astrobear.top/resource/astroblog/content/dsa-7-2.png)\n\n`init()`函数也会在列表的其他构造方法中被调用。该函数只需运行常数时间。\n\n列表的析构函数由于需要调用类中其他的接口，所以将在下一篇博客中给出。\n\n### 由秩到位置\n\n列表偶尔可能需要使用秩来指定列表节点，因此这里通过重载操作符`[]`的方式设计一个转换接口。\n\n```c++\ntemplate <typename T> //重载下标操作符，以通过秩直接访问列表节点（虽方便，效率低，需慎用）\nT& List<T>::operator[] ( Rank r ) const { //assert: 0 <= r < size\n   ListNodePosi<T> p = first(); //从首节点出发\n   while ( 0 < r-- ) p = p->succ; //顺数第r个节点即是\n   return p->data; //目标节点，返回其中所存元素\n}\n```\n\n这段代码的功能非常明显：要确定秩为`r`的元素的位置，只需要从首节点出发顺着后继指针向后移动`r`步即可。由此，该算法的时间复杂度为$\\mathcal O (\\rm r)$。可以看出，相比于向量的同类接口，列表在使用秩访问指定元素时时效率十分低下。\n\n当$\\rm{r > n/2}$时，从尾哨兵节点出发沿前驱指针向前查找可以在一定程度上减少查找次数。但是就总的平均效率而言，这一改进并无实质性意义。\n\n### 查找\n\n列表中有两个查找接口，分别是`find(e)`和`find(e, n, p)`。前者为整体查找，后者为区间查找。前者作为后者的特例，可以直接调用后者，因此这里考虑后者的实现。代码如下：\n\n```c++\ntemplate <typename T> //在无序列表内节点p（可能是trailer）的n个（真）前驱中，找到等于e的最后者\nListNodePosi<T> List<T>::find ( T const& e, int n, ListNodePosi<T> p ) const {\n   while ( 0 < n-- ) //（0 <= n <= rank(p) < _size）对于p的最近的n个前驱，从右向左\n      if ( e == ( p = p->pred )->data ) return p; //逐个比对，直至命中或范围越界\n   return NULL; //p越出左边界意味着区间内不含e，查找失败\n} //失败时，返回NULL\n```\n\n该查找算法是顺序查找方法，时间复杂度应是$\\mathcal O (\\rm n)$，线性正比于查找区间的宽度。\n\n\n\n","source":"_posts/dsa-7.md","raw":"---\ntitle: DSA-7：列表及其接口设计1\ndate: 2022-4-12 21:50:00\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail:  https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 列表就是链表。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n## 从向量到列表\n\n向量采用“循秩访问”的方式，可以通过秩直接访问对应元素。列表与向量同属于序列结构的范畴，其中的元素也构成一个线性逻辑次序。但是与向量极为不同的是，列表中元素的物理地址可以是任意的。\n\n为了保证对列表元素访问的可行性，逻辑上互为前驱和后继的元素之间，应当维护某种索引关系。这种索引索引关系，可以抽象地理解为被索引元素的位置。因此列表元素是“循位置访问”。索引还可以理解为通往被索引元素的链接，因此也可以被称作是“循链接访问”。\n\n列表结构相比于向量，在解决某些问题时有其独有的优势，可以弥补向量结构在功能和性能方面的不足。\n\n### 从静态到动态\n\n数据结构支持静态和动态两种操作，静态操作仅从中获取信息，后者则会修改数据结构的局部甚至整体。\n\n向量采用的就是静态的存储策略，可以在$\\mathcal O(1)$时间内由秩确定向量元素的物理地址，但是在添加或者删除元素时，会伴随着$\\mathcal O(n)$元素的移动。\n\n列表结构要求元素在逻辑上具有线性次序，但是对其物理地址并未作任何限制——这就是采用了“动态存储”的策略。在生命周期内，动态存储的数据结构将随着内部数据的需要，相应地分配或回收局部的数据空间。为了实现这一功能，该类结构需要使用指针或者引用的方法，来确定各个元素实际的物理地址。\n\n采用动态存储的策略可以大大降低动态操作的成本。\n\n### 由秩到位置\n\n相对应的，采用动态存储的策略时，静态操作的性能会有所下降。\n\n以列表为例，为了访问秩为`r`的元素，我们只能顺着相邻元素之间的指针，从某一端出发逐个扫描各个元素，经过`r`步迭代之后才能确定该元素的物理存储位置。这意味着，原先只需要$\\mathcal O(1)$时间的静态操作，此时的复杂度也将线性正比于被访问元素的秩，在最坏情况下等于元素总数`n`。即使在各个元素被访问概率相等的情况下，平均而言也需要$\\mathcal O(n)$时间。\n\n对于采用动态存储策略的数据结构，应该通过位置而非秩来指代并访问其中的数据元素。列表中的位置是指代各数据元素的一个标识性指标，借助它可以便捷地得到元素的物理存储地址。各个元素的位置，通常可以表示和实现为联结与元素之间的指针和引用。\n\n### 列表\n\n与向量一样，列表也是由线性逻辑次序的一组元素构成的集合：\n\n$L = \\{ a_0, a_1, ..., a_{n-1} \\}$\n\n列表是链表结构的一般化推广，其中的元素称作节点，分别由特定的位置或者链接指代。与向量一样，在元素之间也可以定义前驱、直接前驱、后继、直接后继。相对于任意元素，也有定义对应的前缀、后缀等子集。\n\n## 列表的基本接口\n\n由上面的叙述可知，列表节点除了需要保存对应的数据项，还需要记录其前驱和后继的位置。因此这里首先设计列表节点对象，然后通过基本的节点去构建列表。\n\n### 列表节点\n\n列表节点对象应该支持下面的操作接口：\n\n|     操作接口      |                      功能                       |\n| :---------------: | :---------------------------------------------: |\n|      `data`       |            当前节点所存储的数据对象             |\n|      `pred`       |             当前节点前驱节点的位置              |\n|      `succ`       |             当前节点后继节点的位置              |\n| `insertAsPred(e)` | 插入前驱节点，存入被引用对象`e`，返回新节点位置 |\n| `insertAsSucc(e)` | 插入后继节点，存入被引用对象`e`，返回新节点位置 |\n\n根据上表的内容，可以设计`ListNode`模板类如下：\n\n```c++\nusing Rank = int; //秩\ntemplate <typename T> struct ListNode;\ntemplate <typename T> using ListNodePosi = ListNode<T>*; //列表节点位置\ntemplate <typename T> struct ListNode { //列表节点模板类（以双向链表形式实现）\n// 成员\n   T data; ListNodePosi<T> pred; ListNodePosi<T> succ; //数值、前驱、后继\n// 构造函数\n   ListNode() {} //针对header和trailer的构造\n   ListNode ( T e, ListNodePosi<T> p = NULL, ListNodePosi<T> s = NULL )\n      : data ( e ), pred ( p ), succ ( s ) {} //默认构造器\n// 操作接口\n   ListNodePosi<T> insertAsPred ( T const& e ); //紧靠当前节点之前插入新节点\n   ListNodePosi<T> insertAsSucc ( T const& e ); //紧随当前节点之后插入新节点\n};\n```\n\n### 列表\n\n列表对象应该支持下面的操作接口：\n\n|               操作接口                |                      功能                      | 适用对象 |\n| :-----------------------------------: | :--------------------------------------------: | :------: |\n|               `size()`                |         报告列表当前的规模（节点总数）         |   列表   |\n|          `first()`、`last()`          |              返回首、末节点的位置              |   列表   |\n| `insertAsFirst(e)`、`insertAsLast(e)` |            将`e`当作首、末节点插入             |   列表   |\n|   `insertA(p, e)`、`insertB(p, e)`    |      将`e`当作节点`p`的直接后继、前驱插入      |   列表   |\n|              `remove(p)`              |        删除位置`p`处的节点，返回其数值         |   列表   |\n|            `disordered()`             |         判断所有节点是否已按非降序排列         |   列表   |\n|               `sort()`                |       调整各节点的位置，使之按非降序排列       |   列表   |\n|               `find(e)`               |       查找目标元素`e`，失败时返回`NULL`        |   列表   |\n|              `search(e)`              |  查找目标元素`e`，返回不大于`e`且秩最大的节点  | 有序列表 |\n|            `deduplicate()`            |                  剔除重复节点                  |   列表   |\n|             `uniquify()`              |                  剔除重复节点                  | 有序列表 |\n|             `traverse()`              | 遍历并统一处理所有节点，处理方法由函数对象决定 |   列表   |\n\n根据上表的内容，可以设计`List`模板类如下：\n\n{% codeblock lang:C++ >folded %}\n\ntemplate <typename T> class List { //列表模板类\n\nprivate:\n   int _size; ListNodePosi<T> header; ListNodePosi<T> trailer; //规模、头哨兵、尾哨兵\n\nprotected:\n   void init(); //列表创建时的初始化\n   int clear(); //清除所有节点\n   void copyNodes ( ListNodePosi<T>, int ); //复制列表中自位置p起的n项\n   ListNodePosi<T> merge ( ListNodePosi<T>, int, List<T> &, ListNodePosi<T>, int ); //归并\n   void mergeSort ( ListNodePosi<T> &, int ); //对从p开始连续的n个节点归并排序\n   void selectionSort ( ListNodePosi<T>, int ); //对从p开始连续的n个节点选择排序\n   void insertionSort ( ListNodePosi<T>, int ); //对从p开始连续的n个节点插入排序\n   void radixSort(ListNodePosi<T>, int); //对从p开始连续的n个节点基数排序\n\npublic:\n// 构造函数\n   List() { init(); } //默认\n   List ( List<T> const& L ); //整体复制列表L\n   List ( List<T> const& L, Rank r, int n ); //复制列表L中自第r项起的n项\n   List ( ListNodePosi<T> p, int n ); //复制列表中自位置p起的n项\n// 析构函数\n   ~List(); //释放（包含头、尾哨兵在内的）所有节点\n// 只读访问接口\n   Rank size() const { return _size; } //规模\n   bool empty() const { return _size <= 0; } //判空\n   T& operator[] ( Rank r ) const; //重载，支持循秩访问（效率低）\n   ListNodePosi<T> first() const { return header->succ; } //首节点位置\n   ListNodePosi<T> last() const { return trailer->pred; } //末节点位置\n   bool valid ( ListNodePosi<T> p ) //判断位置p是否对外合法\n   { return p && ( trailer != p ) && ( header != p ); } //将头、尾节点等同于NULL\n   ListNodePosi<T> find ( T const& e ) const //无序列表查找\n   { return find ( e, _size, trailer ); }\n   ListNodePosi<T> find ( T const& e, int n, ListNodePosi<T> p ) const; //无序区间查找\n   ListNodePosi<T> search ( T const& e ) const //有序列表查找\n   { return search ( e, _size, trailer ); }\n   ListNodePosi<T> search ( T const& e, int n, ListNodePosi<T> p ) const; //有序区间查找\n   ListNodePosi<T> selectMax ( ListNodePosi<T> p, int n ); //在p及其n-1个后继中选出最大者\n   ListNodePosi<T> selectMax() { return selectMax ( header->succ, _size ); } //整体最大者\n// 可写访问接口\n   ListNodePosi<T> insertAsFirst ( T const& e ); //将e当作首节点插入\n   ListNodePosi<T> insertAsLast ( T const& e ); //将e当作末节点插入\n   ListNodePosi<T> insert ( ListNodePosi<T> p, T const& e ); //将e当作p的后继插入\n   ListNodePosi<T> insert ( T const& e, ListNodePosi<T> p ); //将e当作p的前驱插入\n   T remove ( ListNodePosi<T> p ); //删除合法位置p处的节点,返回被删除节点\n   void merge ( List<T> & L ) { merge ( header->succ, _size, L, L.header->succ, L._size ); } //全列表归并\n   void sort ( ListNodePosi<T> p, int n ); //列表区间排序\n   void sort() { sort ( first(), _size ); } //列表整体排序\n   int deduplicate(); //无序去重\n   int uniquify(); //有序去重\n   void reverse(); //前后倒置（习题）\n// 遍历\n   void traverse ( void (* ) ( T& ) ); //遍历，依次实施visit操作（函数指针，只读或局部性修改）\n   template <typename VST> //操作器\n   void traverse ( VST& ); //遍历，依次实施visit操作（函数对象，可全局性修改）\n}; //List\n\n{% endcodeblock %}\n\n## 列表的基本接口（其一）\n\n### 头、尾节点\n\n列表中存在有头节点和尾节点，它们是私有的，对外界不可见。如果存在对外部可见的数据节点，则其中的第一个和最后一个节点分别称作首节点和末节点。列表对象内部的组成及逻辑结构如下图所示：\n\n![列表的结构](https://astrobear.top/resource/astroblog/content/dsa-7-1.png)\n\n就内部结构而言，头节点紧邻于首节点之前，尾节点紧邻于末节点之后。这类封装之后从外部不可见的节点，称作哨兵节点。此处的两个哨兵节点被等效地视作`NULL`。\n\n设置了哨兵节点之后，对于从外部可见的任一节点而言，其前驱和后继在列表内部都必然存在。这使得相关算法不必再对各种边界退化情况做专门的处理，从而避免了出错的可能，还带来了许多的便利。\n\n### 默认构造方法\n\n创建`List`对象时，默认构造方法将调用下面的统一初始化过程`init()`。该函数完成了以下工作：\n\n- 在列表内部创建了头、尾哨兵节点\n- 将头哨兵节点的前驱设为`NULL`，后继设为尾哨兵节点\n- 将尾哨兵节点的后继设为`NULL`，前驱设为头哨兵节点\n- 将列表规模置零\n\n新创建出来的`List`对象如下图所示，其对外的有效部分初始为空，哨兵节点对外不可见，此后插入的新节点都将在两哨兵节点之间。\n\n![新创建的列表的结构](https://astrobear.top/resource/astroblog/content/dsa-7-2.png)\n\n`init()`函数也会在列表的其他构造方法中被调用。该函数只需运行常数时间。\n\n列表的析构函数由于需要调用类中其他的接口，所以将在下一篇博客中给出。\n\n### 由秩到位置\n\n列表偶尔可能需要使用秩来指定列表节点，因此这里通过重载操作符`[]`的方式设计一个转换接口。\n\n```c++\ntemplate <typename T> //重载下标操作符，以通过秩直接访问列表节点（虽方便，效率低，需慎用）\nT& List<T>::operator[] ( Rank r ) const { //assert: 0 <= r < size\n   ListNodePosi<T> p = first(); //从首节点出发\n   while ( 0 < r-- ) p = p->succ; //顺数第r个节点即是\n   return p->data; //目标节点，返回其中所存元素\n}\n```\n\n这段代码的功能非常明显：要确定秩为`r`的元素的位置，只需要从首节点出发顺着后继指针向后移动`r`步即可。由此，该算法的时间复杂度为$\\mathcal O (\\rm r)$。可以看出，相比于向量的同类接口，列表在使用秩访问指定元素时时效率十分低下。\n\n当$\\rm{r > n/2}$时，从尾哨兵节点出发沿前驱指针向前查找可以在一定程度上减少查找次数。但是就总的平均效率而言，这一改进并无实质性意义。\n\n### 查找\n\n列表中有两个查找接口，分别是`find(e)`和`find(e, n, p)`。前者为整体查找，后者为区间查找。前者作为后者的特例，可以直接调用后者，因此这里考虑后者的实现。代码如下：\n\n```c++\ntemplate <typename T> //在无序列表内节点p（可能是trailer）的n个（真）前驱中，找到等于e的最后者\nListNodePosi<T> List<T>::find ( T const& e, int n, ListNodePosi<T> p ) const {\n   while ( 0 < n-- ) //（0 <= n <= rank(p) < _size）对于p的最近的n个前驱，从右向左\n      if ( e == ( p = p->pred )->data ) return p; //逐个比对，直至命中或范围越界\n   return NULL; //p越出左边界意味着区间内不含e，查找失败\n} //失败时，返回NULL\n```\n\n该查找算法是顺序查找方法，时间复杂度应是$\\mathcal O (\\rm n)$，线性正比于查找区间的宽度。\n\n\n\n","slug":"dsa-7","published":1,"updated":"2022-04-15T15:47:52.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz09001j1q395i7n56zg","content":"<h2 id=\"从向量到列表\"><a href=\"#从向量到列表\" class=\"headerlink\" title=\"从向量到列表\"></a>从向量到列表</h2><p>向量采用“循秩访问”的方式，可以通过秩直接访问对应元素。列表与向量同属于序列结构的范畴，其中的元素也构成一个线性逻辑次序。但是与向量极为不同的是，列表中元素的物理地址可以是任意的。</p>\n<p>为了保证对列表元素访问的可行性，逻辑上互为前驱和后继的元素之间，应当维护某种索引关系。这种索引索引关系，可以抽象地理解为被索引元素的位置。因此列表元素是“循位置访问”。索引还可以理解为通往被索引元素的链接，因此也可以被称作是“循链接访问”。</p>\n<p>列表结构相比于向量，在解决某些问题时有其独有的优势，可以弥补向量结构在功能和性能方面的不足。</p>\n<h3 id=\"从静态到动态\"><a href=\"#从静态到动态\" class=\"headerlink\" title=\"从静态到动态\"></a>从静态到动态</h3><p>数据结构支持静态和动态两种操作，静态操作仅从中获取信息，后者则会修改数据结构的局部甚至整体。</p>\n<p>向量采用的就是静态的存储策略，可以在$\\mathcal O(1)$时间内由秩确定向量元素的物理地址，但是在添加或者删除元素时，会伴随着$\\mathcal O(n)$元素的移动。</p>\n<p>列表结构要求元素在逻辑上具有线性次序，但是对其物理地址并未作任何限制——这就是采用了“动态存储”的策略。在生命周期内，动态存储的数据结构将随着内部数据的需要，相应地分配或回收局部的数据空间。为了实现这一功能，该类结构需要使用指针或者引用的方法，来确定各个元素实际的物理地址。</p>\n<p>采用动态存储的策略可以大大降低动态操作的成本。</p>\n<h3 id=\"由秩到位置\"><a href=\"#由秩到位置\" class=\"headerlink\" title=\"由秩到位置\"></a>由秩到位置</h3><p>相对应的，采用动态存储的策略时，静态操作的性能会有所下降。</p>\n<p>以列表为例，为了访问秩为<code>r</code>的元素，我们只能顺着相邻元素之间的指针，从某一端出发逐个扫描各个元素，经过<code>r</code>步迭代之后才能确定该元素的物理存储位置。这意味着，原先只需要$\\mathcal O(1)$时间的静态操作，此时的复杂度也将线性正比于被访问元素的秩，在最坏情况下等于元素总数<code>n</code>。即使在各个元素被访问概率相等的情况下，平均而言也需要$\\mathcal O(n)$时间。</p>\n<p>对于采用动态存储策略的数据结构，应该通过位置而非秩来指代并访问其中的数据元素。列表中的位置是指代各数据元素的一个标识性指标，借助它可以便捷地得到元素的物理存储地址。各个元素的位置，通常可以表示和实现为联结与元素之间的指针和引用。</p>\n<h3 id=\"列表\"><a href=\"#列表\" class=\"headerlink\" title=\"列表\"></a>列表</h3><p>与向量一样，列表也是由线性逻辑次序的一组元素构成的集合：</p>\n<p>$L = { a_0, a_1, …, a_{n-1} }$</p>\n<p>列表是链表结构的一般化推广，其中的元素称作节点，分别由特定的位置或者链接指代。与向量一样，在元素之间也可以定义前驱、直接前驱、后继、直接后继。相对于任意元素，也有定义对应的前缀、后缀等子集。</p>\n<h2 id=\"列表的基本接口\"><a href=\"#列表的基本接口\" class=\"headerlink\" title=\"列表的基本接口\"></a>列表的基本接口</h2><p>由上面的叙述可知，列表节点除了需要保存对应的数据项，还需要记录其前驱和后继的位置。因此这里首先设计列表节点对象，然后通过基本的节点去构建列表。</p>\n<h3 id=\"列表节点\"><a href=\"#列表节点\" class=\"headerlink\" title=\"列表节点\"></a>列表节点</h3><p>列表节点对象应该支持下面的操作接口：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">操作接口</th>\n<th align=\"center\">功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>data</code></td>\n<td align=\"center\">当前节点所存储的数据对象</td>\n</tr>\n<tr>\n<td align=\"center\"><code>pred</code></td>\n<td align=\"center\">当前节点前驱节点的位置</td>\n</tr>\n<tr>\n<td align=\"center\"><code>succ</code></td>\n<td align=\"center\">当前节点后继节点的位置</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertAsPred(e)</code></td>\n<td align=\"center\">插入前驱节点，存入被引用对象<code>e</code>，返回新节点位置</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertAsSucc(e)</code></td>\n<td align=\"center\">插入后继节点，存入被引用对象<code>e</code>，返回新节点位置</td>\n</tr>\n</tbody></table>\n<p>根据上表的内容，可以设计<code>ListNode</code>模板类如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> Rank = <span class=\"keyword\">int</span>; <span class=\"comment\">//秩</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">ListNode</span>;</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">using</span> ListNodePosi = ListNode&lt;T&gt;*; <span class=\"comment\">//列表节点位置</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">ListNode</span> &#123;</span> <span class=\"comment\">//列表节点模板类（以双向链表形式实现）</span></span><br><span class=\"line\"><span class=\"comment\">// 成员</span></span><br><span class=\"line\">   T data; ListNodePosi&lt;T&gt; pred; ListNodePosi&lt;T&gt; succ; <span class=\"comment\">//数值、前驱、后继</span></span><br><span class=\"line\"><span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">   <span class=\"built_in\">ListNode</span>() &#123;&#125; <span class=\"comment\">//针对header和trailer的构造</span></span><br><span class=\"line\">   <span class=\"built_in\">ListNode</span> ( T e, ListNodePosi&lt;T&gt; p = <span class=\"literal\">NULL</span>, ListNodePosi&lt;T&gt; s = <span class=\"literal\">NULL</span> )</span><br><span class=\"line\">      : <span class=\"built_in\">data</span> ( e ), <span class=\"built_in\">pred</span> ( p ), <span class=\"built_in\">succ</span> ( s ) &#123;&#125; <span class=\"comment\">//默认构造器</span></span><br><span class=\"line\"><span class=\"comment\">// 操作接口</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsPred</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//紧靠当前节点之前插入新节点</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsSucc</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//紧随当前节点之后插入新节点</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"列表-1\"><a href=\"#列表-1\" class=\"headerlink\" title=\"列表\"></a>列表</h3><p>列表对象应该支持下面的操作接口：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">操作接口</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">适用对象</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>size()</code></td>\n<td align=\"center\">报告列表当前的规模（节点总数）</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>first()</code>、<code>last()</code></td>\n<td align=\"center\">返回首、末节点的位置</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertAsFirst(e)</code>、<code>insertAsLast(e)</code></td>\n<td align=\"center\">将<code>e</code>当作首、末节点插入</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertA(p, e)</code>、<code>insertB(p, e)</code></td>\n<td align=\"center\">将<code>e</code>当作节点<code>p</code>的直接后继、前驱插入</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>remove(p)</code></td>\n<td align=\"center\">删除位置<code>p</code>处的节点，返回其数值</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>disordered()</code></td>\n<td align=\"center\">判断所有节点是否已按非降序排列</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>sort()</code></td>\n<td align=\"center\">调整各节点的位置，使之按非降序排列</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>find(e)</code></td>\n<td align=\"center\">查找目标元素<code>e</code>，失败时返回<code>NULL</code></td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>search(e)</code></td>\n<td align=\"center\">查找目标元素<code>e</code>，返回不大于<code>e</code>且秩最大的节点</td>\n<td align=\"center\">有序列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>deduplicate()</code></td>\n<td align=\"center\">剔除重复节点</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>uniquify()</code></td>\n<td align=\"center\">剔除重复节点</td>\n<td align=\"center\">有序列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>traverse()</code></td>\n<td align=\"center\">遍历并统一处理所有节点，处理方法由函数对象决定</td>\n<td align=\"center\">列表</td>\n</tr>\n</tbody></table>\n<p>根据上表的内容，可以设计<code>List</code>模板类如下：</p>\n<figure class=\"highlight c++\"><figcaption><span>>folded</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">List</span> &#123;</span> <span class=\"comment\">//列表模板类</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">   <span class=\"keyword\">int</span> _size; ListNodePosi&lt;T&gt; header; ListNodePosi&lt;T&gt; trailer; <span class=\"comment\">//规模、头哨兵、尾哨兵</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span></span>; <span class=\"comment\">//列表创建时的初始化</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">clear</span><span class=\"params\">()</span></span>; <span class=\"comment\">//清除所有节点</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">copyNodes</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//复制列表中自位置p起的n项</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">merge</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span>, List&lt;T&gt; &amp;, ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//归并</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">mergeSort</span> <span class=\"params\">( ListNodePosi&lt;T&gt; &amp;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//对从p开始连续的n个节点归并排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">selectionSort</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//对从p开始连续的n个节点选择排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">insertionSort</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//对从p开始连续的n个节点插入排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">radixSort</span><span class=\"params\">(ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span>)</span></span>; <span class=\"comment\">//对从p开始连续的n个节点基数排序</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"><span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span>() &#123; <span class=\"built_in\">init</span>(); &#125; <span class=\"comment\">//默认</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span> ( List&lt;T&gt; <span class=\"keyword\">const</span>&amp; L ); <span class=\"comment\">//整体复制列表L</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span> ( List&lt;T&gt; <span class=\"keyword\">const</span>&amp; L, Rank r, <span class=\"keyword\">int</span> n ); <span class=\"comment\">//复制列表L中自第r项起的n项</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span> ( ListNodePosi&lt;T&gt; p, <span class=\"keyword\">int</span> n ); <span class=\"comment\">//复制列表中自位置p起的n项</span></span><br><span class=\"line\"><span class=\"comment\">// 析构函数</span></span><br><span class=\"line\">   ~<span class=\"built_in\">List</span>(); <span class=\"comment\">//释放（包含头、尾哨兵在内的）所有节点</span></span><br><span class=\"line\"><span class=\"comment\">// 只读访问接口</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">size</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> _size; &#125; <span class=\"comment\">//规模</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">empty</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> _size &lt;= <span class=\"number\">0</span>; &#125; <span class=\"comment\">//判空</span></span><br><span class=\"line\">   T&amp; <span class=\"keyword\">operator</span>[] ( Rank r ) <span class=\"keyword\">const</span>; <span class=\"comment\">//重载，支持循秩访问（效率低）</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">first</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> header-&gt;succ; &#125; <span class=\"comment\">//首节点位置</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">last</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> trailer-&gt;pred; &#125; <span class=\"comment\">//末节点位置</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">valid</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p )</span> <span class=\"comment\">//判断位置p是否对外合法</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> p &amp;&amp; ( trailer != p ) &amp;&amp; ( header != p ); &#125; <span class=\"comment\">//将头、尾节点等同于NULL</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> <span class=\"comment\">//无序列表查找</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">find</span> ( e, _size, trailer ); &#125;</span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//无序区间查找</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> <span class=\"comment\">//有序列表查找</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">search</span> ( e, _size, trailer ); &#125;</span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//有序区间查找</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">selectMax</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p, <span class=\"keyword\">int</span> n )</span></span>; <span class=\"comment\">//在p及其n-1个后继中选出最大者</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">selectMax</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">selectMax</span> ( header-&gt;succ, _size ); &#125; <span class=\"comment\">//整体最大者</span></span><br><span class=\"line\"><span class=\"comment\">// 可写访问接口</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsFirst</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//将e当作首节点插入</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsLast</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//将e当作末节点插入</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insert</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p, T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//将e当作p的后继插入</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insert</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, ListNodePosi&lt;T&gt; p )</span></span>; <span class=\"comment\">//将e当作p的前驱插入</span></span><br><span class=\"line\">   <span class=\"function\">T <span class=\"title\">remove</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p )</span></span>; <span class=\"comment\">//删除合法位置p处的节点,返回被删除节点</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">merge</span> <span class=\"params\">( List&lt;T&gt; &amp; L )</span> </span>&#123; <span class=\"built_in\">merge</span> ( header-&gt;succ, _size, L, L.header-&gt;succ, L._size ); &#125; <span class=\"comment\">//全列表归并</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p, <span class=\"keyword\">int</span> n )</span></span>; <span class=\"comment\">//列表区间排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span><span class=\"params\">()</span> </span>&#123; <span class=\"built_in\">sort</span> ( <span class=\"built_in\">first</span>(), _size ); &#125; <span class=\"comment\">//列表整体排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">deduplicate</span><span class=\"params\">()</span></span>; <span class=\"comment\">//无序去重</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uniquify</span><span class=\"params\">()</span></span>; <span class=\"comment\">//有序去重</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reverse</span><span class=\"params\">()</span></span>; <span class=\"comment\">//前后倒置（习题）</span></span><br><span class=\"line\"><span class=\"comment\">// 遍历</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( <span class=\"keyword\">void</span> (* ) ( T&amp; ) )</span></span>; <span class=\"comment\">//遍历，依次实施visit操作（函数指针，只读或局部性修改）</span></span><br><span class=\"line\">   <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"comment\">//操作器</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( VST&amp; )</span></span>; <span class=\"comment\">//遍历，依次实施visit操作（函数对象，可全局性修改）</span></span><br><span class=\"line\">&#125;; <span class=\"comment\">//List</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"列表的基本接口（其一）\"><a href=\"#列表的基本接口（其一）\" class=\"headerlink\" title=\"列表的基本接口（其一）\"></a>列表的基本接口（其一）</h2><h3 id=\"头、尾节点\"><a href=\"#头、尾节点\" class=\"headerlink\" title=\"头、尾节点\"></a>头、尾节点</h3><p>列表中存在有头节点和尾节点，它们是私有的，对外界不可见。如果存在对外部可见的数据节点，则其中的第一个和最后一个节点分别称作首节点和末节点。列表对象内部的组成及逻辑结构如下图所示：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-7-1.png\" alt=\"列表的结构\"></p>\n<p>就内部结构而言，头节点紧邻于首节点之前，尾节点紧邻于末节点之后。这类封装之后从外部不可见的节点，称作哨兵节点。此处的两个哨兵节点被等效地视作<code>NULL</code>。</p>\n<p>设置了哨兵节点之后，对于从外部可见的任一节点而言，其前驱和后继在列表内部都必然存在。这使得相关算法不必再对各种边界退化情况做专门的处理，从而避免了出错的可能，还带来了许多的便利。</p>\n<h3 id=\"默认构造方法\"><a href=\"#默认构造方法\" class=\"headerlink\" title=\"默认构造方法\"></a>默认构造方法</h3><p>创建<code>List</code>对象时，默认构造方法将调用下面的统一初始化过程<code>init()</code>。该函数完成了以下工作：</p>\n<ul>\n<li>在列表内部创建了头、尾哨兵节点</li>\n<li>将头哨兵节点的前驱设为<code>NULL</code>，后继设为尾哨兵节点</li>\n<li>将尾哨兵节点的后继设为<code>NULL</code>，前驱设为头哨兵节点</li>\n<li>将列表规模置零</li>\n</ul>\n<p>新创建出来的<code>List</code>对象如下图所示，其对外的有效部分初始为空，哨兵节点对外不可见，此后插入的新节点都将在两哨兵节点之间。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-7-2.png\" alt=\"新创建的列表的结构\"></p>\n<p><code>init()</code>函数也会在列表的其他构造方法中被调用。该函数只需运行常数时间。</p>\n<p>列表的析构函数由于需要调用类中其他的接口，所以将在下一篇博客中给出。</p>\n<h3 id=\"由秩到位置-1\"><a href=\"#由秩到位置-1\" class=\"headerlink\" title=\"由秩到位置\"></a>由秩到位置</h3><p>列表偶尔可能需要使用秩来指定列表节点，因此这里通过重载操作符<code>[]</code>的方式设计一个转换接口。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//重载下标操作符，以通过秩直接访问列表节点（虽方便，效率低，需慎用）</span></span><br><span class=\"line\">T&amp; List&lt;T&gt;::<span class=\"keyword\">operator</span>[] ( Rank r ) <span class=\"keyword\">const</span> &#123; <span class=\"comment\">//assert: 0 &lt;= r &lt; size</span></span><br><span class=\"line\">   ListNodePosi&lt;T&gt; p = <span class=\"built_in\">first</span>(); <span class=\"comment\">//从首节点出发</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; r-- ) p = p-&gt;succ; <span class=\"comment\">//顺数第r个节点即是</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> p-&gt;data; <span class=\"comment\">//目标节点，返回其中所存元素</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这段代码的功能非常明显：要确定秩为<code>r</code>的元素的位置，只需要从首节点出发顺着后继指针向后移动<code>r</code>步即可。由此，该算法的时间复杂度为$\\mathcal O (\\rm r)$。可以看出，相比于向量的同类接口，列表在使用秩访问指定元素时时效率十分低下。</p>\n<p>当$\\rm{r &gt; n/2}$时，从尾哨兵节点出发沿前驱指针向前查找可以在一定程度上减少查找次数。但是就总的平均效率而言，这一改进并无实质性意义。</p>\n<h3 id=\"查找\"><a href=\"#查找\" class=\"headerlink\" title=\"查找\"></a>查找</h3><p>列表中有两个查找接口，分别是<code>find(e)</code>和<code>find(e, n, p)</code>。前者为整体查找，后者为区间查找。前者作为后者的特例，可以直接调用后者，因此这里考虑后者的实现。代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//在无序列表内节点p（可能是trailer）的n个（真）前驱中，找到等于e的最后者</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; List&lt;T&gt;::<span class=\"built_in\">find</span> ( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p ) <span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; n-- ) <span class=\"comment\">//（0 &lt;= n &lt;= rank(p) &lt; _size）对于p的最近的n个前驱，从右向左</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( e == ( p = p-&gt;pred )-&gt;data ) <span class=\"keyword\">return</span> p; <span class=\"comment\">//逐个比对，直至命中或范围越界</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>; <span class=\"comment\">//p越出左边界意味着区间内不含e，查找失败</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//失败时，返回NULL</span></span><br></pre></td></tr></table></figure>\n\n<p>该查找算法是顺序查找方法，时间复杂度应是$\\mathcal O (\\rm n)$，线性正比于查找区间的宽度。</p>\n","site":{"data":{}},"more":"<h2 id=\"从向量到列表\"><a href=\"#从向量到列表\" class=\"headerlink\" title=\"从向量到列表\"></a>从向量到列表</h2><p>向量采用“循秩访问”的方式，可以通过秩直接访问对应元素。列表与向量同属于序列结构的范畴，其中的元素也构成一个线性逻辑次序。但是与向量极为不同的是，列表中元素的物理地址可以是任意的。</p>\n<p>为了保证对列表元素访问的可行性，逻辑上互为前驱和后继的元素之间，应当维护某种索引关系。这种索引索引关系，可以抽象地理解为被索引元素的位置。因此列表元素是“循位置访问”。索引还可以理解为通往被索引元素的链接，因此也可以被称作是“循链接访问”。</p>\n<p>列表结构相比于向量，在解决某些问题时有其独有的优势，可以弥补向量结构在功能和性能方面的不足。</p>\n<h3 id=\"从静态到动态\"><a href=\"#从静态到动态\" class=\"headerlink\" title=\"从静态到动态\"></a>从静态到动态</h3><p>数据结构支持静态和动态两种操作，静态操作仅从中获取信息，后者则会修改数据结构的局部甚至整体。</p>\n<p>向量采用的就是静态的存储策略，可以在$\\mathcal O(1)$时间内由秩确定向量元素的物理地址，但是在添加或者删除元素时，会伴随着$\\mathcal O(n)$元素的移动。</p>\n<p>列表结构要求元素在逻辑上具有线性次序，但是对其物理地址并未作任何限制——这就是采用了“动态存储”的策略。在生命周期内，动态存储的数据结构将随着内部数据的需要，相应地分配或回收局部的数据空间。为了实现这一功能，该类结构需要使用指针或者引用的方法，来确定各个元素实际的物理地址。</p>\n<p>采用动态存储的策略可以大大降低动态操作的成本。</p>\n<h3 id=\"由秩到位置\"><a href=\"#由秩到位置\" class=\"headerlink\" title=\"由秩到位置\"></a>由秩到位置</h3><p>相对应的，采用动态存储的策略时，静态操作的性能会有所下降。</p>\n<p>以列表为例，为了访问秩为<code>r</code>的元素，我们只能顺着相邻元素之间的指针，从某一端出发逐个扫描各个元素，经过<code>r</code>步迭代之后才能确定该元素的物理存储位置。这意味着，原先只需要$\\mathcal O(1)$时间的静态操作，此时的复杂度也将线性正比于被访问元素的秩，在最坏情况下等于元素总数<code>n</code>。即使在各个元素被访问概率相等的情况下，平均而言也需要$\\mathcal O(n)$时间。</p>\n<p>对于采用动态存储策略的数据结构，应该通过位置而非秩来指代并访问其中的数据元素。列表中的位置是指代各数据元素的一个标识性指标，借助它可以便捷地得到元素的物理存储地址。各个元素的位置，通常可以表示和实现为联结与元素之间的指针和引用。</p>\n<h3 id=\"列表\"><a href=\"#列表\" class=\"headerlink\" title=\"列表\"></a>列表</h3><p>与向量一样，列表也是由线性逻辑次序的一组元素构成的集合：</p>\n<p>$L = { a_0, a_1, …, a_{n-1} }$</p>\n<p>列表是链表结构的一般化推广，其中的元素称作节点，分别由特定的位置或者链接指代。与向量一样，在元素之间也可以定义前驱、直接前驱、后继、直接后继。相对于任意元素，也有定义对应的前缀、后缀等子集。</p>\n<h2 id=\"列表的基本接口\"><a href=\"#列表的基本接口\" class=\"headerlink\" title=\"列表的基本接口\"></a>列表的基本接口</h2><p>由上面的叙述可知，列表节点除了需要保存对应的数据项，还需要记录其前驱和后继的位置。因此这里首先设计列表节点对象，然后通过基本的节点去构建列表。</p>\n<h3 id=\"列表节点\"><a href=\"#列表节点\" class=\"headerlink\" title=\"列表节点\"></a>列表节点</h3><p>列表节点对象应该支持下面的操作接口：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">操作接口</th>\n<th align=\"center\">功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>data</code></td>\n<td align=\"center\">当前节点所存储的数据对象</td>\n</tr>\n<tr>\n<td align=\"center\"><code>pred</code></td>\n<td align=\"center\">当前节点前驱节点的位置</td>\n</tr>\n<tr>\n<td align=\"center\"><code>succ</code></td>\n<td align=\"center\">当前节点后继节点的位置</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertAsPred(e)</code></td>\n<td align=\"center\">插入前驱节点，存入被引用对象<code>e</code>，返回新节点位置</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertAsSucc(e)</code></td>\n<td align=\"center\">插入后继节点，存入被引用对象<code>e</code>，返回新节点位置</td>\n</tr>\n</tbody></table>\n<p>根据上表的内容，可以设计<code>ListNode</code>模板类如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> Rank = <span class=\"keyword\">int</span>; <span class=\"comment\">//秩</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">ListNode</span>;</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">using</span> ListNodePosi = ListNode&lt;T&gt;*; <span class=\"comment\">//列表节点位置</span></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">ListNode</span> &#123;</span> <span class=\"comment\">//列表节点模板类（以双向链表形式实现）</span></span><br><span class=\"line\"><span class=\"comment\">// 成员</span></span><br><span class=\"line\">   T data; ListNodePosi&lt;T&gt; pred; ListNodePosi&lt;T&gt; succ; <span class=\"comment\">//数值、前驱、后继</span></span><br><span class=\"line\"><span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">   <span class=\"built_in\">ListNode</span>() &#123;&#125; <span class=\"comment\">//针对header和trailer的构造</span></span><br><span class=\"line\">   <span class=\"built_in\">ListNode</span> ( T e, ListNodePosi&lt;T&gt; p = <span class=\"literal\">NULL</span>, ListNodePosi&lt;T&gt; s = <span class=\"literal\">NULL</span> )</span><br><span class=\"line\">      : <span class=\"built_in\">data</span> ( e ), <span class=\"built_in\">pred</span> ( p ), <span class=\"built_in\">succ</span> ( s ) &#123;&#125; <span class=\"comment\">//默认构造器</span></span><br><span class=\"line\"><span class=\"comment\">// 操作接口</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsPred</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//紧靠当前节点之前插入新节点</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsSucc</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//紧随当前节点之后插入新节点</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"列表-1\"><a href=\"#列表-1\" class=\"headerlink\" title=\"列表\"></a>列表</h3><p>列表对象应该支持下面的操作接口：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">操作接口</th>\n<th align=\"center\">功能</th>\n<th align=\"center\">适用对象</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><code>size()</code></td>\n<td align=\"center\">报告列表当前的规模（节点总数）</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>first()</code>、<code>last()</code></td>\n<td align=\"center\">返回首、末节点的位置</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertAsFirst(e)</code>、<code>insertAsLast(e)</code></td>\n<td align=\"center\">将<code>e</code>当作首、末节点插入</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>insertA(p, e)</code>、<code>insertB(p, e)</code></td>\n<td align=\"center\">将<code>e</code>当作节点<code>p</code>的直接后继、前驱插入</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>remove(p)</code></td>\n<td align=\"center\">删除位置<code>p</code>处的节点，返回其数值</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>disordered()</code></td>\n<td align=\"center\">判断所有节点是否已按非降序排列</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>sort()</code></td>\n<td align=\"center\">调整各节点的位置，使之按非降序排列</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>find(e)</code></td>\n<td align=\"center\">查找目标元素<code>e</code>，失败时返回<code>NULL</code></td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>search(e)</code></td>\n<td align=\"center\">查找目标元素<code>e</code>，返回不大于<code>e</code>且秩最大的节点</td>\n<td align=\"center\">有序列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>deduplicate()</code></td>\n<td align=\"center\">剔除重复节点</td>\n<td align=\"center\">列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>uniquify()</code></td>\n<td align=\"center\">剔除重复节点</td>\n<td align=\"center\">有序列表</td>\n</tr>\n<tr>\n<td align=\"center\"><code>traverse()</code></td>\n<td align=\"center\">遍历并统一处理所有节点，处理方法由函数对象决定</td>\n<td align=\"center\">列表</td>\n</tr>\n</tbody></table>\n<p>根据上表的内容，可以设计<code>List</code>模板类如下：</p>\n<figure class=\"highlight c++\"><figcaption><span>>folded</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">List</span> &#123;</span> <span class=\"comment\">//列表模板类</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">   <span class=\"keyword\">int</span> _size; ListNodePosi&lt;T&gt; header; ListNodePosi&lt;T&gt; trailer; <span class=\"comment\">//规模、头哨兵、尾哨兵</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">protected</span>:</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span></span>; <span class=\"comment\">//列表创建时的初始化</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">clear</span><span class=\"params\">()</span></span>; <span class=\"comment\">//清除所有节点</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">copyNodes</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//复制列表中自位置p起的n项</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">merge</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span>, List&lt;T&gt; &amp;, ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//归并</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">mergeSort</span> <span class=\"params\">( ListNodePosi&lt;T&gt; &amp;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//对从p开始连续的n个节点归并排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">selectionSort</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//对从p开始连续的n个节点选择排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">insertionSort</span> <span class=\"params\">( ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span> )</span></span>; <span class=\"comment\">//对从p开始连续的n个节点插入排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">radixSort</span><span class=\"params\">(ListNodePosi&lt;T&gt;, <span class=\"keyword\">int</span>)</span></span>; <span class=\"comment\">//对从p开始连续的n个节点基数排序</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"><span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span>() &#123; <span class=\"built_in\">init</span>(); &#125; <span class=\"comment\">//默认</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span> ( List&lt;T&gt; <span class=\"keyword\">const</span>&amp; L ); <span class=\"comment\">//整体复制列表L</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span> ( List&lt;T&gt; <span class=\"keyword\">const</span>&amp; L, Rank r, <span class=\"keyword\">int</span> n ); <span class=\"comment\">//复制列表L中自第r项起的n项</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span> ( ListNodePosi&lt;T&gt; p, <span class=\"keyword\">int</span> n ); <span class=\"comment\">//复制列表中自位置p起的n项</span></span><br><span class=\"line\"><span class=\"comment\">// 析构函数</span></span><br><span class=\"line\">   ~<span class=\"built_in\">List</span>(); <span class=\"comment\">//释放（包含头、尾哨兵在内的）所有节点</span></span><br><span class=\"line\"><span class=\"comment\">// 只读访问接口</span></span><br><span class=\"line\">   <span class=\"function\">Rank <span class=\"title\">size</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> _size; &#125; <span class=\"comment\">//规模</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">empty</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> _size &lt;= <span class=\"number\">0</span>; &#125; <span class=\"comment\">//判空</span></span><br><span class=\"line\">   T&amp; <span class=\"keyword\">operator</span>[] ( Rank r ) <span class=\"keyword\">const</span>; <span class=\"comment\">//重载，支持循秩访问（效率低）</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">first</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> header-&gt;succ; &#125; <span class=\"comment\">//首节点位置</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">last</span><span class=\"params\">()</span> <span class=\"keyword\">const</span> </span>&#123; <span class=\"keyword\">return</span> trailer-&gt;pred; &#125; <span class=\"comment\">//末节点位置</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">valid</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p )</span> <span class=\"comment\">//判断位置p是否对外合法</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> p &amp;&amp; ( trailer != p ) &amp;&amp; ( header != p ); &#125; <span class=\"comment\">//将头、尾节点等同于NULL</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> <span class=\"comment\">//无序列表查找</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">find</span> ( e, _size, trailer ); &#125;</span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">find</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//无序区间查找</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span> <span class=\"keyword\">const</span> <span class=\"comment\">//有序列表查找</span></span></span><br><span class=\"line\"><span class=\"function\">   </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">search</span> ( e, _size, trailer ); &#125;</span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">search</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p )</span> <span class=\"keyword\">const</span></span>; <span class=\"comment\">//有序区间查找</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">selectMax</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p, <span class=\"keyword\">int</span> n )</span></span>; <span class=\"comment\">//在p及其n-1个后继中选出最大者</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">selectMax</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> <span class=\"built_in\">selectMax</span> ( header-&gt;succ, _size ); &#125; <span class=\"comment\">//整体最大者</span></span><br><span class=\"line\"><span class=\"comment\">// 可写访问接口</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsFirst</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//将e当作首节点插入</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insertAsLast</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//将e当作末节点插入</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insert</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p, T <span class=\"keyword\">const</span>&amp; e )</span></span>; <span class=\"comment\">//将e当作p的后继插入</span></span><br><span class=\"line\">   <span class=\"function\">ListNodePosi&lt;T&gt; <span class=\"title\">insert</span> <span class=\"params\">( T <span class=\"keyword\">const</span>&amp; e, ListNodePosi&lt;T&gt; p )</span></span>; <span class=\"comment\">//将e当作p的前驱插入</span></span><br><span class=\"line\">   <span class=\"function\">T <span class=\"title\">remove</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p )</span></span>; <span class=\"comment\">//删除合法位置p处的节点,返回被删除节点</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">merge</span> <span class=\"params\">( List&lt;T&gt; &amp; L )</span> </span>&#123; <span class=\"built_in\">merge</span> ( header-&gt;succ, _size, L, L.header-&gt;succ, L._size ); &#125; <span class=\"comment\">//全列表归并</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span> <span class=\"params\">( ListNodePosi&lt;T&gt; p, <span class=\"keyword\">int</span> n )</span></span>; <span class=\"comment\">//列表区间排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">sort</span><span class=\"params\">()</span> </span>&#123; <span class=\"built_in\">sort</span> ( <span class=\"built_in\">first</span>(), _size ); &#125; <span class=\"comment\">//列表整体排序</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">deduplicate</span><span class=\"params\">()</span></span>; <span class=\"comment\">//无序去重</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uniquify</span><span class=\"params\">()</span></span>; <span class=\"comment\">//有序去重</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">reverse</span><span class=\"params\">()</span></span>; <span class=\"comment\">//前后倒置（习题）</span></span><br><span class=\"line\"><span class=\"comment\">// 遍历</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( <span class=\"keyword\">void</span> (* ) ( T&amp; ) )</span></span>; <span class=\"comment\">//遍历，依次实施visit操作（函数指针，只读或局部性修改）</span></span><br><span class=\"line\">   <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"comment\">//操作器</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">traverse</span> <span class=\"params\">( VST&amp; )</span></span>; <span class=\"comment\">//遍历，依次实施visit操作（函数对象，可全局性修改）</span></span><br><span class=\"line\">&#125;; <span class=\"comment\">//List</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"列表的基本接口（其一）\"><a href=\"#列表的基本接口（其一）\" class=\"headerlink\" title=\"列表的基本接口（其一）\"></a>列表的基本接口（其一）</h2><h3 id=\"头、尾节点\"><a href=\"#头、尾节点\" class=\"headerlink\" title=\"头、尾节点\"></a>头、尾节点</h3><p>列表中存在有头节点和尾节点，它们是私有的，对外界不可见。如果存在对外部可见的数据节点，则其中的第一个和最后一个节点分别称作首节点和末节点。列表对象内部的组成及逻辑结构如下图所示：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-7-1.png\" alt=\"列表的结构\"></p>\n<p>就内部结构而言，头节点紧邻于首节点之前，尾节点紧邻于末节点之后。这类封装之后从外部不可见的节点，称作哨兵节点。此处的两个哨兵节点被等效地视作<code>NULL</code>。</p>\n<p>设置了哨兵节点之后，对于从外部可见的任一节点而言，其前驱和后继在列表内部都必然存在。这使得相关算法不必再对各种边界退化情况做专门的处理，从而避免了出错的可能，还带来了许多的便利。</p>\n<h3 id=\"默认构造方法\"><a href=\"#默认构造方法\" class=\"headerlink\" title=\"默认构造方法\"></a>默认构造方法</h3><p>创建<code>List</code>对象时，默认构造方法将调用下面的统一初始化过程<code>init()</code>。该函数完成了以下工作：</p>\n<ul>\n<li>在列表内部创建了头、尾哨兵节点</li>\n<li>将头哨兵节点的前驱设为<code>NULL</code>，后继设为尾哨兵节点</li>\n<li>将尾哨兵节点的后继设为<code>NULL</code>，前驱设为头哨兵节点</li>\n<li>将列表规模置零</li>\n</ul>\n<p>新创建出来的<code>List</code>对象如下图所示，其对外的有效部分初始为空，哨兵节点对外不可见，此后插入的新节点都将在两哨兵节点之间。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-7-2.png\" alt=\"新创建的列表的结构\"></p>\n<p><code>init()</code>函数也会在列表的其他构造方法中被调用。该函数只需运行常数时间。</p>\n<p>列表的析构函数由于需要调用类中其他的接口，所以将在下一篇博客中给出。</p>\n<h3 id=\"由秩到位置-1\"><a href=\"#由秩到位置-1\" class=\"headerlink\" title=\"由秩到位置\"></a>由秩到位置</h3><p>列表偶尔可能需要使用秩来指定列表节点，因此这里通过重载操作符<code>[]</code>的方式设计一个转换接口。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//重载下标操作符，以通过秩直接访问列表节点（虽方便，效率低，需慎用）</span></span><br><span class=\"line\">T&amp; List&lt;T&gt;::<span class=\"keyword\">operator</span>[] ( Rank r ) <span class=\"keyword\">const</span> &#123; <span class=\"comment\">//assert: 0 &lt;= r &lt; size</span></span><br><span class=\"line\">   ListNodePosi&lt;T&gt; p = <span class=\"built_in\">first</span>(); <span class=\"comment\">//从首节点出发</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; r-- ) p = p-&gt;succ; <span class=\"comment\">//顺数第r个节点即是</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> p-&gt;data; <span class=\"comment\">//目标节点，返回其中所存元素</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这段代码的功能非常明显：要确定秩为<code>r</code>的元素的位置，只需要从首节点出发顺着后继指针向后移动<code>r</code>步即可。由此，该算法的时间复杂度为$\\mathcal O (\\rm r)$。可以看出，相比于向量的同类接口，列表在使用秩访问指定元素时时效率十分低下。</p>\n<p>当$\\rm{r &gt; n/2}$时，从尾哨兵节点出发沿前驱指针向前查找可以在一定程度上减少查找次数。但是就总的平均效率而言，这一改进并无实质性意义。</p>\n<h3 id=\"查找\"><a href=\"#查找\" class=\"headerlink\" title=\"查找\"></a>查找</h3><p>列表中有两个查找接口，分别是<code>find(e)</code>和<code>find(e, n, p)</code>。前者为整体查找，后者为区间查找。前者作为后者的特例，可以直接调用后者，因此这里考虑后者的实现。代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//在无序列表内节点p（可能是trailer）的n个（真）前驱中，找到等于e的最后者</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; List&lt;T&gt;::<span class=\"built_in\">find</span> ( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p ) <span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( <span class=\"number\">0</span> &lt; n-- ) <span class=\"comment\">//（0 &lt;= n &lt;= rank(p) &lt; _size）对于p的最近的n个前驱，从右向左</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( e == ( p = p-&gt;pred )-&gt;data ) <span class=\"keyword\">return</span> p; <span class=\"comment\">//逐个比对，直至命中或范围越界</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>; <span class=\"comment\">//p越出左边界意味着区间内不含e，查找失败</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//失败时，返回NULL</span></span><br></pre></td></tr></table></figure>\n\n<p>该查找算法是顺序查找方法，时间复杂度应是$\\mathcal O (\\rm n)$，线性正比于查找区间的宽度。</p>\n"},{"title":"DSA-8：列表及其接口设计2","date":"2022-05-08T03:30:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg","excerpt":"由于列表与向量都是线性的数据结构，因此其接口有不少相似之处。","_content":"\n## 列表的基本接口（其二）\n\n### 插入\n\n列表的插入操作有以下四种形式：\n\n- 将元素作为首节点插入\n- 将元素作为末节点插入\n- 将元素作为某节点的后继插入\n- 将元素作为某节点的前驱插入\n\n上述操作都可以使用列表节点对象的前插入或后插入方法实现。**注意，在插入元素后不要忘了更新列表的规模`_size`**。\n\n#### 前插入\n\n列表的前插入是将某个元素作为某节点的前驱插入列表的过程，其代码如下：\n\n```c++\ntemplate <typename T> //将e紧靠当前节点之前插入于当前节点所属列表（设有哨兵头节点header）\nListNodePosi<T> ListNode<T>::insertAsPred ( T const& e ) {\n   ListNodePosi<T> x = new ListNode ( e, pred, this ); //创建新节点\n   pred->succ = x; pred = x; //设置正向链接\n   return x; //返回新节点的位置\n}\n```\n\n上述代码第3行中`ListNode`构造函数中的参数`this`指代的是当前节点。\n\n该算法首先创建了一个新的节点`new`，并且`ListNode`的构造函数将其内容设为`e`，将新节点`new`的后继的`succ`指针指向当前节点`this`，令新节点`new`的`pred`指针指向当前节点`this`的前驱节点。然后，需要将当前节点`this`的前驱的`succ`指针指向新节点`new`，将当前节点`this`的`pred`指针指向新节点`new`。注意，代码第4行中调整前驱和后继指针的顺序不可以颠倒，否则会使新节点的`succ`指针指向它本身。\n\n前插入的算法可以用下图表示：\n\n![列表前插入算法的执行过程](https://astrobear.top/resource/astroblog/content/dsa-8-1.png)\n\n如果需要将元素作为某节点的前驱插入，只需要调用该节点的前插入成员函数`insertAsPred()`即可。如果需要将元素作为列表的首节点插入，同样只需要调用列表头哨兵中的前插入函数即可。\n\n#### 后插入\n\n后插入的操作过程与最终效果同前插入完全对称，这里仅给出算法的代码，不再过多解释。\n\n```c++\ntemplate <typename T> //将e紧随当前节点之后插入于当前节点所属列表（设有哨兵尾节点trailer）\nListNodePosi<T> ListNode<T>::insertAsSucc ( T const& e ) {\n   ListNodePosi<T> x = new ListNode ( e, this, succ ); //创建新节点\n   succ->pred = x; succ = x; //设置逆向链接\n   return x; //返回新节点的位置\n}\n```\n\n上述插入的操作过程都可以在常数时间内完成。\n\n### 基于复制的构造函数\n\n对列表各种不同的复制操作都可以使用”复制列表中自位置`p`起的`n`个节点“的底层操作实现。该底层操作首先要对新构造出来的列表创建其头、尾哨兵节点并做初始化，然后再将待复制列表自`p`起的`n`个节点都作为末节点插入到新列表中即可。该底层算法的总体运行时间为$\\mathcal O(\\rm n + 1)$。\n\n使用上面给出的底层算法，可以实现下面的构造操作：\n\n- 复制列表中自位置`p`起的`n`个元素\n- 整体复制列表\n- 复制列表中自第`r`项元素起的`n`个元素\n\n注意上面的最后一个操作，首先其需要花费$\\mathcal O(\\rm r +1)$的时间找到`r`的位置，然后再花$\\mathcal O (\\rm n)$的时间进行复制，因此器总体时间复杂度为$\\mathcal O (\\rm r+n+1)$。\n\n### 删除\n\n删除列表中指定节点`p`的算法如下：\n\n```c++\ntemplate <typename T> T List<T>::remove ( ListNodePosi<T> p ) { //删除合法节点p，返回其数值\n   T e = p->data; //备份待删除节点的数值（假定T类型可直接赋值）\n   p->pred->succ = p->succ; p->succ->pred = p->pred; //后继、前驱\n   delete p; _size--; //释放节点，更新规模\n   return e; //返回备份的数值\n}\n```\n\n在删除节点之前，首先要令被删除节点的前驱和后继相互链接，然后将孤立出来的节点删除，最后再更新列表的规模。\n\n该算法可以在常数时间内完成。\n\n### 析构\n\n列表在析构时，需要清空列表中的各个节点，然后再释放头、尾哨兵节点。可以通过“反复调用删除首节点（`header -> suuc`），直到列表规模变为0”的方法实现对列表中各个节点的清除。析构方法的运行时间为$\\mathcal O (\\rm n)$，线性正比于列表原先的规模。\n\n### 唯一化\n\n列表的唯一化算法与向量的类似。代码如下：\n\n```c++\ntemplate <typename T> int List<T>::deduplicate() {\n   int oldSize = _size; ListNodePosi<T> p = first();\n   for ( Rank r = 0; p != trailer; p = p->succ ) //O(n)\n      if ( ListNodePosi<T> q = find(p->data, r, p) )\n         remove(q); //此时q与p雷同，但删除前者更为简明\n      else r++; //r为无重前缀的长度\n   return oldSize - _size; //删除元素总数\n}\n```\n\n该算法总共需要进行$\\rm n$步迭代，每一步迭代中`find()`操作所需要的时间线性正比于查找区间的宽度，节点每次的`remove()`操作仅需要线性时间，因此总体执行时间应该为：$1 + 2 + 3 + ... + \\rm{n} = \\mathcal O(\\rm n^2) $。\n\n### 遍历\n\n列表的遍历接口也与向量相似，其实现如下：\n\n```c++\ntemplate <typename T> void List<T>::traverse ( void ( *visit ) ( T& ) ) //借助函数指针机制遍历\n{  for ( ListNodePosi<T> p = header->succ; p != trailer; p = p->succ ) visit ( p->data );  }\n\ntemplate <typename T> template <typename VST> //元素类型、操作器\nvoid List<T>::traverse ( VST& visit ) //借助函数对象机制遍历\n{  for ( ListNodePosi<T> p = header->succ; p != trailer; p = p->succ ) visit ( p->data );  }\n```\n\n## 有序列表的基本接口\n\n若列表中所有节点的逻辑次序与其大小次序完全一致，则称作有序列表。这里约定采用非降次序，并且假设列表中的元素类型`T`直接支持大小比较，或已重载相关操作符。\n\n### 唯一化\n\n在有序列表中，雷同的节点也必然在逻辑上彼此紧邻。因此可以实现重复节点删除算法：\n\n```c++\ntemplate <typename T> int List<T>::uniquify() { //成批剔除重复元素，效率更高\n   if ( _size < 2 ) return 0; //平凡列表自然无重复\n   int oldSize = _size; //记录原规模\n   ListNodePosi<T> p = first(); ListNodePosi<T> q; //p为各区段起点，q为其后继\n   while ( trailer != ( q = p->succ ) ) //反复考查紧邻的节点对(p, q)\n      if ( p->data != q->data ) p = q; //若互异，则转向下一区段\n      else remove ( q ); //否则（雷同），删除后者\n   return oldSize - _size; //列表规模变化量，即被删除元素总数\n}\n```\n\n算法中，位置指针`p`和`q`分别指向每一对相邻的节点，若两者雷同则删除`q`，否则指向下一对相邻节点。\n\n该算法的运行时间为$\\mathcal O(\\rm \\_size) = \\mathcal O(\\rm n)$，线性正比于原列表的规模。\n\n### 查找\n\n有序列表的查找算法如下：\n\n```c++\ntemplate <typename T> //在有序列表内节点p（可能是trailer）的n个（真）前驱中，找到不大于e的最后者\nListNodePosi<T> List<T>::search ( T const& e, int n, ListNodePosi<T> p ) const {\n// assert: 0 <= n <= rank(p) < _size\n   do {\n      p = p->pred; n--;  //从右向左\n   } while ( ( -1 < n ) && ( e < p->data ) ); //逐个比较，直至命中或越界\n   return p; //返回查找终止的位置\n} //失败时，返回区间左边界的前驱（可能是header）——调用者可通过valid()判断成功与否\n```\n\n有序列表的查找算法与有序向量完全不同。这是因为尽管有序列表中的节点在逻辑上按照次序单调排列，但是这些节点的物理地址与逻辑次序毫无关系，故无法像有序向量那样应用减治策略（因为没办法快速确定分割点），从而不得不使用无序列表的顺序查找策略。\n\n与无序列表的查找算法同理，该算法在最好的情况下运行时间为$\\mathcal O(1)$，最坏情况下为$\\mathcal O (\\rm n)$。在等概率的前提下，平均运行时间也是$\\mathcal O (\\rm n)$。\n\n","source":"_posts/dsa-8.md","raw":"---\ntitle: DSA-8：列表及其接口设计2\ndate: 2022-5-8 11:30\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Data Structure\n\t- Algorithm\n\t- C++\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/dsa.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 由于列表与向量都是线性的数据结构，因此其接口有不少相似之处。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n## 列表的基本接口（其二）\n\n### 插入\n\n列表的插入操作有以下四种形式：\n\n- 将元素作为首节点插入\n- 将元素作为末节点插入\n- 将元素作为某节点的后继插入\n- 将元素作为某节点的前驱插入\n\n上述操作都可以使用列表节点对象的前插入或后插入方法实现。**注意，在插入元素后不要忘了更新列表的规模`_size`**。\n\n#### 前插入\n\n列表的前插入是将某个元素作为某节点的前驱插入列表的过程，其代码如下：\n\n```c++\ntemplate <typename T> //将e紧靠当前节点之前插入于当前节点所属列表（设有哨兵头节点header）\nListNodePosi<T> ListNode<T>::insertAsPred ( T const& e ) {\n   ListNodePosi<T> x = new ListNode ( e, pred, this ); //创建新节点\n   pred->succ = x; pred = x; //设置正向链接\n   return x; //返回新节点的位置\n}\n```\n\n上述代码第3行中`ListNode`构造函数中的参数`this`指代的是当前节点。\n\n该算法首先创建了一个新的节点`new`，并且`ListNode`的构造函数将其内容设为`e`，将新节点`new`的后继的`succ`指针指向当前节点`this`，令新节点`new`的`pred`指针指向当前节点`this`的前驱节点。然后，需要将当前节点`this`的前驱的`succ`指针指向新节点`new`，将当前节点`this`的`pred`指针指向新节点`new`。注意，代码第4行中调整前驱和后继指针的顺序不可以颠倒，否则会使新节点的`succ`指针指向它本身。\n\n前插入的算法可以用下图表示：\n\n![列表前插入算法的执行过程](https://astrobear.top/resource/astroblog/content/dsa-8-1.png)\n\n如果需要将元素作为某节点的前驱插入，只需要调用该节点的前插入成员函数`insertAsPred()`即可。如果需要将元素作为列表的首节点插入，同样只需要调用列表头哨兵中的前插入函数即可。\n\n#### 后插入\n\n后插入的操作过程与最终效果同前插入完全对称，这里仅给出算法的代码，不再过多解释。\n\n```c++\ntemplate <typename T> //将e紧随当前节点之后插入于当前节点所属列表（设有哨兵尾节点trailer）\nListNodePosi<T> ListNode<T>::insertAsSucc ( T const& e ) {\n   ListNodePosi<T> x = new ListNode ( e, this, succ ); //创建新节点\n   succ->pred = x; succ = x; //设置逆向链接\n   return x; //返回新节点的位置\n}\n```\n\n上述插入的操作过程都可以在常数时间内完成。\n\n### 基于复制的构造函数\n\n对列表各种不同的复制操作都可以使用”复制列表中自位置`p`起的`n`个节点“的底层操作实现。该底层操作首先要对新构造出来的列表创建其头、尾哨兵节点并做初始化，然后再将待复制列表自`p`起的`n`个节点都作为末节点插入到新列表中即可。该底层算法的总体运行时间为$\\mathcal O(\\rm n + 1)$。\n\n使用上面给出的底层算法，可以实现下面的构造操作：\n\n- 复制列表中自位置`p`起的`n`个元素\n- 整体复制列表\n- 复制列表中自第`r`项元素起的`n`个元素\n\n注意上面的最后一个操作，首先其需要花费$\\mathcal O(\\rm r +1)$的时间找到`r`的位置，然后再花$\\mathcal O (\\rm n)$的时间进行复制，因此器总体时间复杂度为$\\mathcal O (\\rm r+n+1)$。\n\n### 删除\n\n删除列表中指定节点`p`的算法如下：\n\n```c++\ntemplate <typename T> T List<T>::remove ( ListNodePosi<T> p ) { //删除合法节点p，返回其数值\n   T e = p->data; //备份待删除节点的数值（假定T类型可直接赋值）\n   p->pred->succ = p->succ; p->succ->pred = p->pred; //后继、前驱\n   delete p; _size--; //释放节点，更新规模\n   return e; //返回备份的数值\n}\n```\n\n在删除节点之前，首先要令被删除节点的前驱和后继相互链接，然后将孤立出来的节点删除，最后再更新列表的规模。\n\n该算法可以在常数时间内完成。\n\n### 析构\n\n列表在析构时，需要清空列表中的各个节点，然后再释放头、尾哨兵节点。可以通过“反复调用删除首节点（`header -> suuc`），直到列表规模变为0”的方法实现对列表中各个节点的清除。析构方法的运行时间为$\\mathcal O (\\rm n)$，线性正比于列表原先的规模。\n\n### 唯一化\n\n列表的唯一化算法与向量的类似。代码如下：\n\n```c++\ntemplate <typename T> int List<T>::deduplicate() {\n   int oldSize = _size; ListNodePosi<T> p = first();\n   for ( Rank r = 0; p != trailer; p = p->succ ) //O(n)\n      if ( ListNodePosi<T> q = find(p->data, r, p) )\n         remove(q); //此时q与p雷同，但删除前者更为简明\n      else r++; //r为无重前缀的长度\n   return oldSize - _size; //删除元素总数\n}\n```\n\n该算法总共需要进行$\\rm n$步迭代，每一步迭代中`find()`操作所需要的时间线性正比于查找区间的宽度，节点每次的`remove()`操作仅需要线性时间，因此总体执行时间应该为：$1 + 2 + 3 + ... + \\rm{n} = \\mathcal O(\\rm n^2) $。\n\n### 遍历\n\n列表的遍历接口也与向量相似，其实现如下：\n\n```c++\ntemplate <typename T> void List<T>::traverse ( void ( *visit ) ( T& ) ) //借助函数指针机制遍历\n{  for ( ListNodePosi<T> p = header->succ; p != trailer; p = p->succ ) visit ( p->data );  }\n\ntemplate <typename T> template <typename VST> //元素类型、操作器\nvoid List<T>::traverse ( VST& visit ) //借助函数对象机制遍历\n{  for ( ListNodePosi<T> p = header->succ; p != trailer; p = p->succ ) visit ( p->data );  }\n```\n\n## 有序列表的基本接口\n\n若列表中所有节点的逻辑次序与其大小次序完全一致，则称作有序列表。这里约定采用非降次序，并且假设列表中的元素类型`T`直接支持大小比较，或已重载相关操作符。\n\n### 唯一化\n\n在有序列表中，雷同的节点也必然在逻辑上彼此紧邻。因此可以实现重复节点删除算法：\n\n```c++\ntemplate <typename T> int List<T>::uniquify() { //成批剔除重复元素，效率更高\n   if ( _size < 2 ) return 0; //平凡列表自然无重复\n   int oldSize = _size; //记录原规模\n   ListNodePosi<T> p = first(); ListNodePosi<T> q; //p为各区段起点，q为其后继\n   while ( trailer != ( q = p->succ ) ) //反复考查紧邻的节点对(p, q)\n      if ( p->data != q->data ) p = q; //若互异，则转向下一区段\n      else remove ( q ); //否则（雷同），删除后者\n   return oldSize - _size; //列表规模变化量，即被删除元素总数\n}\n```\n\n算法中，位置指针`p`和`q`分别指向每一对相邻的节点，若两者雷同则删除`q`，否则指向下一对相邻节点。\n\n该算法的运行时间为$\\mathcal O(\\rm \\_size) = \\mathcal O(\\rm n)$，线性正比于原列表的规模。\n\n### 查找\n\n有序列表的查找算法如下：\n\n```c++\ntemplate <typename T> //在有序列表内节点p（可能是trailer）的n个（真）前驱中，找到不大于e的最后者\nListNodePosi<T> List<T>::search ( T const& e, int n, ListNodePosi<T> p ) const {\n// assert: 0 <= n <= rank(p) < _size\n   do {\n      p = p->pred; n--;  //从右向左\n   } while ( ( -1 < n ) && ( e < p->data ) ); //逐个比较，直至命中或越界\n   return p; //返回查找终止的位置\n} //失败时，返回区间左边界的前驱（可能是header）——调用者可通过valid()判断成功与否\n```\n\n有序列表的查找算法与有序向量完全不同。这是因为尽管有序列表中的节点在逻辑上按照次序单调排列，但是这些节点的物理地址与逻辑次序毫无关系，故无法像有序向量那样应用减治策略（因为没办法快速确定分割点），从而不得不使用无序列表的顺序查找策略。\n\n与无序列表的查找算法同理，该算法在最好的情况下运行时间为$\\mathcal O(1)$，最坏情况下为$\\mathcal O (\\rm n)$。在等概率的前提下，平均运行时间也是$\\mathcal O (\\rm n)$。\n\n","slug":"dsa-8","published":1,"updated":"2022-05-08T05:15:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0a001n1q3944n40isw","content":"<h2 id=\"列表的基本接口（其二）\"><a href=\"#列表的基本接口（其二）\" class=\"headerlink\" title=\"列表的基本接口（其二）\"></a>列表的基本接口（其二）</h2><h3 id=\"插入\"><a href=\"#插入\" class=\"headerlink\" title=\"插入\"></a>插入</h3><p>列表的插入操作有以下四种形式：</p>\n<ul>\n<li>将元素作为首节点插入</li>\n<li>将元素作为末节点插入</li>\n<li>将元素作为某节点的后继插入</li>\n<li>将元素作为某节点的前驱插入</li>\n</ul>\n<p>上述操作都可以使用列表节点对象的前插入或后插入方法实现。<strong>注意，在插入元素后不要忘了更新列表的规模<code>_size</code></strong>。</p>\n<h4 id=\"前插入\"><a href=\"#前插入\" class=\"headerlink\" title=\"前插入\"></a>前插入</h4><p>列表的前插入是将某个元素作为某节点的前驱插入列表的过程，其代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//将e紧靠当前节点之前插入于当前节点所属列表（设有哨兵头节点header）</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; ListNode&lt;T&gt;::<span class=\"built_in\">insertAsPred</span> ( T <span class=\"keyword\">const</span>&amp; e ) &#123;</span><br><span class=\"line\">   ListNodePosi&lt;T&gt; x = <span class=\"keyword\">new</span> <span class=\"built_in\">ListNode</span> ( e, pred, <span class=\"keyword\">this</span> ); <span class=\"comment\">//创建新节点</span></span><br><span class=\"line\">   pred-&gt;succ = x; pred = x; <span class=\"comment\">//设置正向链接</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> x; <span class=\"comment\">//返回新节点的位置</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述代码第3行中<code>ListNode</code>构造函数中的参数<code>this</code>指代的是当前节点。</p>\n<p>该算法首先创建了一个新的节点<code>new</code>，并且<code>ListNode</code>的构造函数将其内容设为<code>e</code>，将新节点<code>new</code>的后继的<code>succ</code>指针指向当前节点<code>this</code>，令新节点<code>new</code>的<code>pred</code>指针指向当前节点<code>this</code>的前驱节点。然后，需要将当前节点<code>this</code>的前驱的<code>succ</code>指针指向新节点<code>new</code>，将当前节点<code>this</code>的<code>pred</code>指针指向新节点<code>new</code>。注意，代码第4行中调整前驱和后继指针的顺序不可以颠倒，否则会使新节点的<code>succ</code>指针指向它本身。</p>\n<p>前插入的算法可以用下图表示：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-8-1.png\" alt=\"列表前插入算法的执行过程\"></p>\n<p>如果需要将元素作为某节点的前驱插入，只需要调用该节点的前插入成员函数<code>insertAsPred()</code>即可。如果需要将元素作为列表的首节点插入，同样只需要调用列表头哨兵中的前插入函数即可。</p>\n<h4 id=\"后插入\"><a href=\"#后插入\" class=\"headerlink\" title=\"后插入\"></a>后插入</h4><p>后插入的操作过程与最终效果同前插入完全对称，这里仅给出算法的代码，不再过多解释。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//将e紧随当前节点之后插入于当前节点所属列表（设有哨兵尾节点trailer）</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; ListNode&lt;T&gt;::<span class=\"built_in\">insertAsSucc</span> ( T <span class=\"keyword\">const</span>&amp; e ) &#123;</span><br><span class=\"line\">   ListNodePosi&lt;T&gt; x = <span class=\"keyword\">new</span> <span class=\"built_in\">ListNode</span> ( e, <span class=\"keyword\">this</span>, succ ); <span class=\"comment\">//创建新节点</span></span><br><span class=\"line\">   succ-&gt;pred = x; succ = x; <span class=\"comment\">//设置逆向链接</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> x; <span class=\"comment\">//返回新节点的位置</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述插入的操作过程都可以在常数时间内完成。</p>\n<h3 id=\"基于复制的构造函数\"><a href=\"#基于复制的构造函数\" class=\"headerlink\" title=\"基于复制的构造函数\"></a>基于复制的构造函数</h3><p>对列表各种不同的复制操作都可以使用”复制列表中自位置<code>p</code>起的<code>n</code>个节点“的底层操作实现。该底层操作首先要对新构造出来的列表创建其头、尾哨兵节点并做初始化，然后再将待复制列表自<code>p</code>起的<code>n</code>个节点都作为末节点插入到新列表中即可。该底层算法的总体运行时间为$\\mathcal O(\\rm n + 1)$。</p>\n<p>使用上面给出的底层算法，可以实现下面的构造操作：</p>\n<ul>\n<li>复制列表中自位置<code>p</code>起的<code>n</code>个元素</li>\n<li>整体复制列表</li>\n<li>复制列表中自第<code>r</code>项元素起的<code>n</code>个元素</li>\n</ul>\n<p>注意上面的最后一个操作，首先其需要花费$\\mathcal O(\\rm r +1)$的时间找到<code>r</code>的位置，然后再花$\\mathcal O (\\rm n)$的时间进行复制，因此器总体时间复杂度为$\\mathcal O (\\rm r+n+1)$。</p>\n<h3 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h3><p>删除列表中指定节点<code>p</code>的算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; T List&lt;T&gt;::<span class=\"built_in\">remove</span> ( ListNodePosi&lt;T&gt; p ) &#123; <span class=\"comment\">//删除合法节点p，返回其数值</span></span><br><span class=\"line\">   T e = p-&gt;data; <span class=\"comment\">//备份待删除节点的数值（假定T类型可直接赋值）</span></span><br><span class=\"line\">   p-&gt;pred-&gt;succ = p-&gt;succ; p-&gt;succ-&gt;pred = p-&gt;pred; <span class=\"comment\">//后继、前驱</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> p; _size--; <span class=\"comment\">//释放节点，更新规模</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> e; <span class=\"comment\">//返回备份的数值</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在删除节点之前，首先要令被删除节点的前驱和后继相互链接，然后将孤立出来的节点删除，最后再更新列表的规模。</p>\n<p>该算法可以在常数时间内完成。</p>\n<h3 id=\"析构\"><a href=\"#析构\" class=\"headerlink\" title=\"析构\"></a>析构</h3><p>列表在析构时，需要清空列表中的各个节点，然后再释放头、尾哨兵节点。可以通过“反复调用删除首节点（<code>header -&gt; suuc</code>），直到列表规模变为0”的方法实现对列表中各个节点的清除。析构方法的运行时间为$\\mathcal O (\\rm n)$，线性正比于列表原先的规模。</p>\n<h3 id=\"唯一化\"><a href=\"#唯一化\" class=\"headerlink\" title=\"唯一化\"></a>唯一化</h3><p>列表的唯一化算法与向量的类似。代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">int</span> List&lt;T&gt;::<span class=\"built_in\">deduplicate</span>() &#123;</span><br><span class=\"line\">   <span class=\"keyword\">int</span> oldSize = _size; ListNodePosi&lt;T&gt; p = <span class=\"built_in\">first</span>();</span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank r = <span class=\"number\">0</span>; p != trailer; p = p-&gt;succ ) <span class=\"comment\">//O(n)</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( ListNodePosi&lt;T&gt; q = <span class=\"built_in\">find</span>(p-&gt;data, r, p) )</span><br><span class=\"line\">         <span class=\"built_in\">remove</span>(q); <span class=\"comment\">//此时q与p雷同，但删除前者更为简明</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> r++; <span class=\"comment\">//r为无重前缀的长度</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> oldSize - _size; <span class=\"comment\">//删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法总共需要进行$\\rm n$步迭代，每一步迭代中<code>find()</code>操作所需要的时间线性正比于查找区间的宽度，节点每次的<code>remove()</code>操作仅需要线性时间，因此总体执行时间应该为：$1 + 2 + 3 + … + \\rm{n} = \\mathcal O(\\rm n^2) $。</p>\n<h3 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h3><p>列表的遍历接口也与向量相似，其实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> List&lt;T&gt;::<span class=\"built_in\">traverse</span> ( <span class=\"built_in\"><span class=\"keyword\">void</span></span> ( *visit ) ( T&amp; ) ) <span class=\"comment\">//借助函数指针机制遍历</span></span><br><span class=\"line\">&#123;  <span class=\"keyword\">for</span> ( ListNodePosi&lt;T&gt; p = header-&gt;succ; p != trailer; p = p-&gt;succ ) <span class=\"built_in\">visit</span> ( p-&gt;data );  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"comment\">//元素类型、操作器</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> List&lt;T&gt;::<span class=\"built_in\">traverse</span> ( VST&amp; visit ) <span class=\"comment\">//借助函数对象机制遍历</span></span><br><span class=\"line\">&#123;  <span class=\"keyword\">for</span> ( ListNodePosi&lt;T&gt; p = header-&gt;succ; p != trailer; p = p-&gt;succ ) <span class=\"built_in\">visit</span> ( p-&gt;data );  &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"有序列表的基本接口\"><a href=\"#有序列表的基本接口\" class=\"headerlink\" title=\"有序列表的基本接口\"></a>有序列表的基本接口</h2><p>若列表中所有节点的逻辑次序与其大小次序完全一致，则称作有序列表。这里约定采用非降次序，并且假设列表中的元素类型<code>T</code>直接支持大小比较，或已重载相关操作符。</p>\n<h3 id=\"唯一化-1\"><a href=\"#唯一化-1\" class=\"headerlink\" title=\"唯一化\"></a>唯一化</h3><p>在有序列表中，雷同的节点也必然在逻辑上彼此紧邻。因此可以实现重复节点删除算法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">int</span> List&lt;T&gt;::<span class=\"built_in\">uniquify</span>() &#123; <span class=\"comment\">//成批剔除重复元素，效率更高</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _size &lt; <span class=\"number\">2</span> ) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; <span class=\"comment\">//平凡列表自然无重复</span></span><br><span class=\"line\">   <span class=\"keyword\">int</span> oldSize = _size; <span class=\"comment\">//记录原规模</span></span><br><span class=\"line\">   ListNodePosi&lt;T&gt; p = <span class=\"built_in\">first</span>(); ListNodePosi&lt;T&gt; q; <span class=\"comment\">//p为各区段起点，q为其后继</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( trailer != ( q = p-&gt;succ ) ) <span class=\"comment\">//反复考查紧邻的节点对(p, q)</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( p-&gt;data != q-&gt;data ) p = q; <span class=\"comment\">//若互异，则转向下一区段</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> <span class=\"built_in\">remove</span> ( q ); <span class=\"comment\">//否则（雷同），删除后者</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> oldSize - _size; <span class=\"comment\">//列表规模变化量，即被删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>算法中，位置指针<code>p</code>和<code>q</code>分别指向每一对相邻的节点，若两者雷同则删除<code>q</code>，否则指向下一对相邻节点。</p>\n<p>该算法的运行时间为$\\mathcal O(\\rm _size) = \\mathcal O(\\rm n)$，线性正比于原列表的规模。</p>\n<h3 id=\"查找\"><a href=\"#查找\" class=\"headerlink\" title=\"查找\"></a>查找</h3><p>有序列表的查找算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//在有序列表内节点p（可能是trailer）的n个（真）前驱中，找到不大于e的最后者</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; List&lt;T&gt;::<span class=\"built_in\">search</span> ( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p ) <span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">// assert: 0 &lt;= n &lt;= rank(p) &lt; _size</span></span><br><span class=\"line\">   <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">      p = p-&gt;pred; n--;  <span class=\"comment\">//从右向左</span></span><br><span class=\"line\">   &#125; <span class=\"keyword\">while</span> ( ( <span class=\"number\">-1</span> &lt; n ) &amp;&amp; ( e &lt; p-&gt;data ) ); <span class=\"comment\">//逐个比较，直至命中或越界</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> p; <span class=\"comment\">//返回查找终止的位置</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//失败时，返回区间左边界的前驱（可能是header）——调用者可通过valid()判断成功与否</span></span><br></pre></td></tr></table></figure>\n\n<p>有序列表的查找算法与有序向量完全不同。这是因为尽管有序列表中的节点在逻辑上按照次序单调排列，但是这些节点的物理地址与逻辑次序毫无关系，故无法像有序向量那样应用减治策略（因为没办法快速确定分割点），从而不得不使用无序列表的顺序查找策略。</p>\n<p>与无序列表的查找算法同理，该算法在最好的情况下运行时间为$\\mathcal O(1)$，最坏情况下为$\\mathcal O (\\rm n)$。在等概率的前提下，平均运行时间也是$\\mathcal O (\\rm n)$。</p>\n","site":{"data":{}},"more":"<h2 id=\"列表的基本接口（其二）\"><a href=\"#列表的基本接口（其二）\" class=\"headerlink\" title=\"列表的基本接口（其二）\"></a>列表的基本接口（其二）</h2><h3 id=\"插入\"><a href=\"#插入\" class=\"headerlink\" title=\"插入\"></a>插入</h3><p>列表的插入操作有以下四种形式：</p>\n<ul>\n<li>将元素作为首节点插入</li>\n<li>将元素作为末节点插入</li>\n<li>将元素作为某节点的后继插入</li>\n<li>将元素作为某节点的前驱插入</li>\n</ul>\n<p>上述操作都可以使用列表节点对象的前插入或后插入方法实现。<strong>注意，在插入元素后不要忘了更新列表的规模<code>_size</code></strong>。</p>\n<h4 id=\"前插入\"><a href=\"#前插入\" class=\"headerlink\" title=\"前插入\"></a>前插入</h4><p>列表的前插入是将某个元素作为某节点的前驱插入列表的过程，其代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//将e紧靠当前节点之前插入于当前节点所属列表（设有哨兵头节点header）</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; ListNode&lt;T&gt;::<span class=\"built_in\">insertAsPred</span> ( T <span class=\"keyword\">const</span>&amp; e ) &#123;</span><br><span class=\"line\">   ListNodePosi&lt;T&gt; x = <span class=\"keyword\">new</span> <span class=\"built_in\">ListNode</span> ( e, pred, <span class=\"keyword\">this</span> ); <span class=\"comment\">//创建新节点</span></span><br><span class=\"line\">   pred-&gt;succ = x; pred = x; <span class=\"comment\">//设置正向链接</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> x; <span class=\"comment\">//返回新节点的位置</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述代码第3行中<code>ListNode</code>构造函数中的参数<code>this</code>指代的是当前节点。</p>\n<p>该算法首先创建了一个新的节点<code>new</code>，并且<code>ListNode</code>的构造函数将其内容设为<code>e</code>，将新节点<code>new</code>的后继的<code>succ</code>指针指向当前节点<code>this</code>，令新节点<code>new</code>的<code>pred</code>指针指向当前节点<code>this</code>的前驱节点。然后，需要将当前节点<code>this</code>的前驱的<code>succ</code>指针指向新节点<code>new</code>，将当前节点<code>this</code>的<code>pred</code>指针指向新节点<code>new</code>。注意，代码第4行中调整前驱和后继指针的顺序不可以颠倒，否则会使新节点的<code>succ</code>指针指向它本身。</p>\n<p>前插入的算法可以用下图表示：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/dsa-8-1.png\" alt=\"列表前插入算法的执行过程\"></p>\n<p>如果需要将元素作为某节点的前驱插入，只需要调用该节点的前插入成员函数<code>insertAsPred()</code>即可。如果需要将元素作为列表的首节点插入，同样只需要调用列表头哨兵中的前插入函数即可。</p>\n<h4 id=\"后插入\"><a href=\"#后插入\" class=\"headerlink\" title=\"后插入\"></a>后插入</h4><p>后插入的操作过程与最终效果同前插入完全对称，这里仅给出算法的代码，不再过多解释。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//将e紧随当前节点之后插入于当前节点所属列表（设有哨兵尾节点trailer）</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; ListNode&lt;T&gt;::<span class=\"built_in\">insertAsSucc</span> ( T <span class=\"keyword\">const</span>&amp; e ) &#123;</span><br><span class=\"line\">   ListNodePosi&lt;T&gt; x = <span class=\"keyword\">new</span> <span class=\"built_in\">ListNode</span> ( e, <span class=\"keyword\">this</span>, succ ); <span class=\"comment\">//创建新节点</span></span><br><span class=\"line\">   succ-&gt;pred = x; succ = x; <span class=\"comment\">//设置逆向链接</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> x; <span class=\"comment\">//返回新节点的位置</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上述插入的操作过程都可以在常数时间内完成。</p>\n<h3 id=\"基于复制的构造函数\"><a href=\"#基于复制的构造函数\" class=\"headerlink\" title=\"基于复制的构造函数\"></a>基于复制的构造函数</h3><p>对列表各种不同的复制操作都可以使用”复制列表中自位置<code>p</code>起的<code>n</code>个节点“的底层操作实现。该底层操作首先要对新构造出来的列表创建其头、尾哨兵节点并做初始化，然后再将待复制列表自<code>p</code>起的<code>n</code>个节点都作为末节点插入到新列表中即可。该底层算法的总体运行时间为$\\mathcal O(\\rm n + 1)$。</p>\n<p>使用上面给出的底层算法，可以实现下面的构造操作：</p>\n<ul>\n<li>复制列表中自位置<code>p</code>起的<code>n</code>个元素</li>\n<li>整体复制列表</li>\n<li>复制列表中自第<code>r</code>项元素起的<code>n</code>个元素</li>\n</ul>\n<p>注意上面的最后一个操作，首先其需要花费$\\mathcal O(\\rm r +1)$的时间找到<code>r</code>的位置，然后再花$\\mathcal O (\\rm n)$的时间进行复制，因此器总体时间复杂度为$\\mathcal O (\\rm r+n+1)$。</p>\n<h3 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h3><p>删除列表中指定节点<code>p</code>的算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; T List&lt;T&gt;::<span class=\"built_in\">remove</span> ( ListNodePosi&lt;T&gt; p ) &#123; <span class=\"comment\">//删除合法节点p，返回其数值</span></span><br><span class=\"line\">   T e = p-&gt;data; <span class=\"comment\">//备份待删除节点的数值（假定T类型可直接赋值）</span></span><br><span class=\"line\">   p-&gt;pred-&gt;succ = p-&gt;succ; p-&gt;succ-&gt;pred = p-&gt;pred; <span class=\"comment\">//后继、前驱</span></span><br><span class=\"line\">   <span class=\"keyword\">delete</span> p; _size--; <span class=\"comment\">//释放节点，更新规模</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> e; <span class=\"comment\">//返回备份的数值</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在删除节点之前，首先要令被删除节点的前驱和后继相互链接，然后将孤立出来的节点删除，最后再更新列表的规模。</p>\n<p>该算法可以在常数时间内完成。</p>\n<h3 id=\"析构\"><a href=\"#析构\" class=\"headerlink\" title=\"析构\"></a>析构</h3><p>列表在析构时，需要清空列表中的各个节点，然后再释放头、尾哨兵节点。可以通过“反复调用删除首节点（<code>header -&gt; suuc</code>），直到列表规模变为0”的方法实现对列表中各个节点的清除。析构方法的运行时间为$\\mathcal O (\\rm n)$，线性正比于列表原先的规模。</p>\n<h3 id=\"唯一化\"><a href=\"#唯一化\" class=\"headerlink\" title=\"唯一化\"></a>唯一化</h3><p>列表的唯一化算法与向量的类似。代码如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">int</span> List&lt;T&gt;::<span class=\"built_in\">deduplicate</span>() &#123;</span><br><span class=\"line\">   <span class=\"keyword\">int</span> oldSize = _size; ListNodePosi&lt;T&gt; p = <span class=\"built_in\">first</span>();</span><br><span class=\"line\">   <span class=\"keyword\">for</span> ( Rank r = <span class=\"number\">0</span>; p != trailer; p = p-&gt;succ ) <span class=\"comment\">//O(n)</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( ListNodePosi&lt;T&gt; q = <span class=\"built_in\">find</span>(p-&gt;data, r, p) )</span><br><span class=\"line\">         <span class=\"built_in\">remove</span>(q); <span class=\"comment\">//此时q与p雷同，但删除前者更为简明</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> r++; <span class=\"comment\">//r为无重前缀的长度</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> oldSize - _size; <span class=\"comment\">//删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该算法总共需要进行$\\rm n$步迭代，每一步迭代中<code>find()</code>操作所需要的时间线性正比于查找区间的宽度，节点每次的<code>remove()</code>操作仅需要线性时间，因此总体执行时间应该为：$1 + 2 + 3 + … + \\rm{n} = \\mathcal O(\\rm n^2) $。</p>\n<h3 id=\"遍历\"><a href=\"#遍历\" class=\"headerlink\" title=\"遍历\"></a>遍历</h3><p>列表的遍历接口也与向量相似，其实现如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">void</span> List&lt;T&gt;::<span class=\"built_in\">traverse</span> ( <span class=\"built_in\"><span class=\"keyword\">void</span></span> ( *visit ) ( T&amp; ) ) <span class=\"comment\">//借助函数指针机制遍历</span></span><br><span class=\"line\">&#123;  <span class=\"keyword\">for</span> ( ListNodePosi&lt;T&gt; p = header-&gt;succ; p != trailer; p = p-&gt;succ ) <span class=\"built_in\">visit</span> ( p-&gt;data );  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> VST&gt; <span class=\"comment\">//元素类型、操作器</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> List&lt;T&gt;::<span class=\"built_in\">traverse</span> ( VST&amp; visit ) <span class=\"comment\">//借助函数对象机制遍历</span></span><br><span class=\"line\">&#123;  <span class=\"keyword\">for</span> ( ListNodePosi&lt;T&gt; p = header-&gt;succ; p != trailer; p = p-&gt;succ ) <span class=\"built_in\">visit</span> ( p-&gt;data );  &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"有序列表的基本接口\"><a href=\"#有序列表的基本接口\" class=\"headerlink\" title=\"有序列表的基本接口\"></a>有序列表的基本接口</h2><p>若列表中所有节点的逻辑次序与其大小次序完全一致，则称作有序列表。这里约定采用非降次序，并且假设列表中的元素类型<code>T</code>直接支持大小比较，或已重载相关操作符。</p>\n<h3 id=\"唯一化-1\"><a href=\"#唯一化-1\" class=\"headerlink\" title=\"唯一化\"></a>唯一化</h3><p>在有序列表中，雷同的节点也必然在逻辑上彼此紧邻。因此可以实现重复节点删除算法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"keyword\">int</span> List&lt;T&gt;::<span class=\"built_in\">uniquify</span>() &#123; <span class=\"comment\">//成批剔除重复元素，效率更高</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> ( _size &lt; <span class=\"number\">2</span> ) <span class=\"keyword\">return</span> <span class=\"number\">0</span>; <span class=\"comment\">//平凡列表自然无重复</span></span><br><span class=\"line\">   <span class=\"keyword\">int</span> oldSize = _size; <span class=\"comment\">//记录原规模</span></span><br><span class=\"line\">   ListNodePosi&lt;T&gt; p = <span class=\"built_in\">first</span>(); ListNodePosi&lt;T&gt; q; <span class=\"comment\">//p为各区段起点，q为其后继</span></span><br><span class=\"line\">   <span class=\"keyword\">while</span> ( trailer != ( q = p-&gt;succ ) ) <span class=\"comment\">//反复考查紧邻的节点对(p, q)</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( p-&gt;data != q-&gt;data ) p = q; <span class=\"comment\">//若互异，则转向下一区段</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span> <span class=\"built_in\">remove</span> ( q ); <span class=\"comment\">//否则（雷同），删除后者</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> oldSize - _size; <span class=\"comment\">//列表规模变化量，即被删除元素总数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>算法中，位置指针<code>p</code>和<code>q</code>分别指向每一对相邻的节点，若两者雷同则删除<code>q</code>，否则指向下一对相邻节点。</p>\n<p>该算法的运行时间为$\\mathcal O(\\rm _size) = \\mathcal O(\\rm n)$，线性正比于原列表的规模。</p>\n<h3 id=\"查找\"><a href=\"#查找\" class=\"headerlink\" title=\"查找\"></a>查找</h3><p>有序列表的查找算法如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt; <span class=\"comment\">//在有序列表内节点p（可能是trailer）的n个（真）前驱中，找到不大于e的最后者</span></span><br><span class=\"line\">ListNodePosi&lt;T&gt; List&lt;T&gt;::<span class=\"built_in\">search</span> ( T <span class=\"keyword\">const</span>&amp; e, <span class=\"keyword\">int</span> n, ListNodePosi&lt;T&gt; p ) <span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">// assert: 0 &lt;= n &lt;= rank(p) &lt; _size</span></span><br><span class=\"line\">   <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">      p = p-&gt;pred; n--;  <span class=\"comment\">//从右向左</span></span><br><span class=\"line\">   &#125; <span class=\"keyword\">while</span> ( ( <span class=\"number\">-1</span> &lt; n ) &amp;&amp; ( e &lt; p-&gt;data ) ); <span class=\"comment\">//逐个比较，直至命中或越界</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> p; <span class=\"comment\">//返回查找终止的位置</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//失败时，返回区间左边界的前驱（可能是header）——调用者可通过valid()判断成功与否</span></span><br></pre></td></tr></table></figure>\n\n<p>有序列表的查找算法与有序向量完全不同。这是因为尽管有序列表中的节点在逻辑上按照次序单调排列，但是这些节点的物理地址与逻辑次序毫无关系，故无法像有序向量那样应用减治策略（因为没办法快速确定分割点），从而不得不使用无序列表的顺序查找策略。</p>\n<p>与无序列表的查找算法同理，该算法在最好的情况下运行时间为$\\mathcal O(1)$，最坏情况下为$\\mathcal O (\\rm n)$。在等概率的前提下，平均运行时间也是$\\mathcal O (\\rm n)$。</p>\n"},{"title":"华为云+nginx服务器搭建总结","date":"2020-01-08T02:29:00.000Z","cover":"https://kinsta.com/wp-content/uploads/2018/03/what-is-nginx.png","thumbnail":"https://kinsta.com/wp-content/uploads/2018/03/what-is-nginx.png","excerpt":"搭建自己的服务器并不难，只是过程较为复杂。","_content":"\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第一篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n\n- “建站搭博客”系列之二：[Hexo博客的安装和自动部署](https://astrobear.top/2021/08/16/Hexo的安装和自动部署/)\n- “建站搭博客”系列之三：[Hexo主题Icarus的自定义](https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/)\n\n> 由于自己是去年七月配置好的服务器，有一些细节或者遇到的问题已经记不太清，故本文可能会有不完整的地方，遇到问题请善用搜索引擎，而且服务器的配置方法也不只有这一种。本文主要用作对自己操作步骤和方法的一个总结，以便于日后查阅。\n\n### 购买服务器\n\n首先去[华为云官网](https://www.huaweicloud.com/?locale=zh-cn)注册一个账号。如果是学生，可以搜索“学生”，并进行学生认证。学生认证的步骤参见[学生认证流程](https://support.huaweicloud.com/usermanual-account/zh-cn_topic_0069253575.html)。进行身份验证后可以购买学生优惠套餐，云服务器价格只要99元/年，比阿里云和腾讯云的都要便宜一些。\n\n![华为云学生优惠](https://astrobear.top/resource/astroblog/content/hwcloud_discount.png)\n\n购买完成后，你可以在控制台看到自己现有的资源以及运行情况。\n\n![控制台](https://astrobear.top/resource/astroblog/content/console.png)\n\n### 配置安全组\n\n> 安全组是一个逻辑上的分组，为具有相同安全保护需求并相互信任的云服务器提供访问策略。安全组创建后，用户可以在安全组中定义各种访问规则，当云服务器加入该安全组后，即受到这些访问规则的保护。\n>\n> 系统会为每个用户默认创建一个默认安全组，默认安全组的规则是在出方向上的数据报文全部放行，入方向访问受限，安全组内的云服务器无需添加规则即可互相访问。默认安全组可以直接使用。\n>\n> 安全组创建后，你可以在安全组中设置出方向、入方向规则，这些规则会对安全组内部的云服务器出入方向网络流量进行访问控制，当云服务器加入该安全组后，即受到这些访问规则的保护。[^1]\n\n在控制台点击“弹性云服务器ECS”，在这里你可看到你的服务器的公网IP，请记下这个IP地址。然后点击在列表中点击你的服务器的名称。\n\n![选择服务器](https://astrobear.top/resource/astroblog/content/security_groups.png)\n\n进入云服务器管理页面后，点击“安全组”。再点击“Sys-default”可以看到默认安全组。然后下面给出的图片是我目前的安全组设置，仅供参考。选择“入/出方向方向规则”，再点击“添加规则“即可手动添加规则。一般来说，配置的都是入方向的安全组，并且源地址（访问服务器的设备的IP地址）都为“0.0.0.0/0”（所有IP地址）。\n\n通常需要配置如下几个功能：\n\n- SSH远程连接Linux弹性云服务器（协议：SSH，端口：22）\n- 公网“ping”ECS弹性云服务器（协议：ICMP，端口：全部）\n- 弹性云服务器作Web服务器\n  - 协议：http，端口：80\n  - 协议：https，端口：433\n\n详细配置请参考[安全组配置示例](https://support.huaweicloud.com/usermanual-ecs/zh-cn_topic_0140323152.html)。\n\n![安全组设置](https://astrobear.top/resource/astroblog/content/sg_settings.png)\n\n![安全组设置](https://astrobear.top/resource/astroblog/content/sg_settings1.png)\n\n配置完成后，可以打开电脑上的终端，用下面的语句测试一下：\n\n`ping 你的公网IP`\n\n出现类似下面的内容就代表成功了：\n\n![ping测试](https://astrobear.top/resource/astroblog/content/ping_test.png)\n\n你可以按下`Ctrl+C`来结束`ping`这个进程。\n\n然后在终端里输入：\n\n`ssh 你的公网IP`\n\n如果你的安全组配置正确的话，会让你输入服务器的登录密码。输入密码（注意：密码是不会显示的）后回车，应该可以看到这样的输出：\n\n![ssh登录](https://astrobear.top/resource/astroblog/content/ssh_login.png)\n\n这个时候，你的终端就已经连接上了服务器的系统了，你在终端里的一切操作都是作用在服务器上的。\n\n### 在服务器上安装nginx\n\n首先请在终端使用ssh登录你的服务器，然后按照下面给出的顺序输入命令。\n\n```shell\nyum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel #安装编译工具及库文件\ncd /usr/local/ #切换到目标安装文件夹\nwget http://nginx.org/download/nginx-1.16.1.tar.gz #下载最新版本的Nginx\ntar -zxvf nginx-1.16.1.tar.gz #解压文件\ncd nginx-1.16.1 #进入解压的文件夹\n./configure #执行程序\nmake #编译\nmake install #安装\ncd /usr/local/nginx/sbin #进入Nginx安装目录\n./nginx #运行Nginx\n```\n\n此时，安装应该已经完成了。打开浏览器，在地址栏中输入你的公网ip。如果看到下图所示内容，就代表安装成功了。\n\n![nginx安装成功](https://astrobear.top/resource/astroblog/content/nginx_install.png)\n\n### 创建属于你自己的域名\n\n在拥有了自己的服务器以后，就可以做很多事情了。但是现在你只能通过IP地址访问自己的服务器，看起来总是有点别扭。另外，如果你想要网站有一定的影响力的话，仅有IP地址会让人几乎找不到你的网站，而且也不符合国家法律规定。所以还是建议大家弄一个自己的域名。\n\n现在市面上的云服务器提供商也都提供域名注册的服务，直接在你的服务提供商的平台上面注册即可。下面我继续用华为云的平台演示。\n\n首先在华为云网站页面的导航栏的搜索框内搜索“域名”，打开第一个链接“域名注册服务”。也可以直接点击这里：[域名注册服务_华为云](https://www.huaweicloud.com/product/domain.html)。\n\n然后你可以在网页中选择你的域名，常见的如`.com`，`.cn`，`.net`等。这些域名会相对比较贵。作为学生党，我选择一个最便宜的域名`.top`，只需要9元/年。\n\n点击你想要的域名后，会跳转到一个新的页面。接下来再次选择你要的域名，并且在“查域名”的搜索框内输入你想要的域名，看看是否已经被占用，如果被占用了就换一个。若显示“域名可注册”，就点击“立即购买”。\n\n![域名购买](https://astrobear.top/resource/astroblog/content/buy_domain.png)\n\n购买完成后，你就拥有了自己域名了！\n\n### 备案\n\n> 备案是中国大陆的一项法规，使用大陆节点服务器提供互联网信息服务的用户，需要在服务器提供商处提交备案申请。\n>\n> 根据工信部《互联网信息服务管理办法》(国务院292号令)和工信部令第33号《非经营性互联网信息服务备案管理办法》规定，国家对经营性互联网信息服务实行许可制度，对非经营性互联网信息服务实行备案制度。未取得许可或者未履行备案手续的，不得从事互联网信息服务，否则属违法行为。通俗来讲，要开办网站必须先办理网站备案，备案成功并获取通信管理局下发的ICP备案号后才能开通访问。[^2]\n\n这一步不多说了，具体步骤比较繁琐，花费的时间也比较长，需要一两周。网站上有很清晰的[操作方法](https://support.huaweicloud.com/pi-icp/zh-cn_topic_0115820080.html)，请自行查阅，根据步骤操作即可。需要注意一点的是，在审核过程中可能会接到服务提供商打来的电话，不要漏接。\n\n需要注意的是，上面的备案操作是在工信部备案的。完成了在工信部的备案以后还需要公安备案。具体[操作方法](http://www.beian.gov.cn/portal/downloadFile?token=596b0ddf-6c81-40bf-babd-65147ee8120c&id=29&token=596b0ddf-6c81-40bf-babd-65147ee8120c)也请自行查阅。\n\n### 域名解析\n\n在完成一系列繁琐的备案流程以后，你的网站还不可以通过域名访问。只有把你的域名跟服务器的IP地址绑定在一起之后，并且在服务器上修改了配置文件之后才可以。\n\n首先打开管理控制台，在控制台中选择“域名注册”。然后在下面的页面中点击“解析”。\n\n![域名注册](https://astrobear.top/resource/astroblog/content/domain.png)\n\n点击你的域名，显示如下页面。这里显示的是你域名的记录集，前两个记录集应该是预置设置，不可暂停服务。<span id=\"1\">你可以在这基础上添加自己的记录集。</span>\n\n![记录集](https://astrobear.top/resource/astroblog/content/record.png)\n\n点击页面右上角红色按钮以添加记录集。添加记录集的配置如下图所示。下图中给出的例子是添加的“A”型记录集，也即通过`example.com`访问网站。若需要通过`www.example.com`访问网站，则需要为`example.com`的子域名添加“A”型记录集。具体配置参见：[配置网站解析_华为云](https://support.huaweicloud.com/qs-dns/dns_qs_0002.html#section1)。点击“确定”，完成添加。你可以通过`ping 你的域名`来测试你添加的记录集是否生效了。\n\n![添加记录集](https://support.huaweicloud.com/qs-dns/zh-cn_image_0200891923.png)\n\n### 配置nginx\n\n<span id=\"2\">打开</span>你电脑上的终端，输入命令：`ssh 你的IP地址`，输入你的服务器的密码。\n\n进入你的nginx的安装目录：`cd /usr/local/nginx/`。\n\n使用vim打开nginx的配置文件：`vim ./conf/nginx.conf`。\n\n按`I`开始输入。\n\n在最后一个大括号前插入以下内容：\n\n```nginx\nserver {\n\t    listen   80; #监听端口设为 80\n\t    server_name  example.com; #绑定您的域名\n\t    index index.htm index.html; #指定默认文件\n\t    root html; #指定网站根目录\n}\n```\n\n然后按`esc`退出编辑，再按`Shift+zz`保存。\n\n输入：`cd ./sbin`，切换文件夹。\n\n执行命令：`nginx -s relod`，重启nginx服务。\n\n这时候再尝试用浏览器访问你的域名，应该会显示之前出现过的“Welcome to nginx ”的页面了！\n\n### 申请SSL证书\n\nSSL证书可以在数据传输的过程中对其进行加密和隐藏，可以极大地提高数据传输的安全性。拥有SSL证书的网站的请求头都是`https`，并且在链接旁边会出现一把小锁。但是，SSL证书并不是所有网站都必须的，这视你的需要而定。比如，微信小程序的服务器就必须要有域名和SSL证书。另外，出于信息传输的安全性方面的考虑，有SSL证书还是显得更为妥当和专业一点。\n\n现在市面上各大云服务器提供商也都提供配套的SSL证书申请服务，一般都是提供企业级的证书，价格比较昂贵。但是同时网络上也有一些免费的SSL证书服务可以选择。下面还是以华为云的平台为例，简单说明一下如何申请SSL证书。\n\n首先在华为云页面的导航栏的搜索框内搜索“免费证书“，然后点击[亚洲诚信域名型DV单域名SSL证书--免费证书](https://marketplace.huaweicloud.com/product/00301-315148-0--0)，可以看到证书的价格是0.00元。点击“立即购买”。\n\n![购买SSL证书](https://astrobear.top/resource/astroblog/content/buy_ssl.png)\n\n完成购买后请不要立即关闭页面，页面中的订单号在之后还需要用到。尔后，系统会发送”HuaweiCloud账户申请”邮件至用户邮箱，即你在华为云的注册邮箱。\n\n![HuaweiCloud账户申请](https://astrobear.top/resource/astroblog/content/request_account.png)\n\n点击邮件中的登录地址进入系统，并使用邮件提供的账号和初始密码进行登录。登入系统后请修改你的初始密码，然后请根据华为云中给你提供的订单号在该系统中查询你的订单。查询到你的订单以后，需要你补充一些信息，请如实填写。系统会要你填写公司信息，如果只是个人网站，那么公司名称直接填写你的名字即可，公司地址就填写你的住址。\n\n填写完成后会进入审核阶段，系统会给你发送一封邮件。\n\n![证书审核](https://astrobear.top/resource/astroblog/content/check.png)\n\n根据邮件的提示，需要在记录集中添加新的内容。请根据[前文](#1)所述方法，将邮件中的内容添加至新的记录集。填写方法如下图所示。\n\n![填写记录集](https://astrobear.top/resource/astroblog/content/modify_record.png)\n\n填写完成后，可以在本地电脑的终端里输入`nslookup -querytype=txt 你的域名`来测试记录集是否生效。\n\n![测试记录集](https://astrobear.top/resource/astroblog/content/test_record.png)\n\n一般来说，记录集生效后10分钟以内证书就会颁发了。\n\n![证书颁发](https://astrobear.top/resource/astroblog/content/issue.png)\n\n### SSL证书部署\n\n接下来我们要把SSL证书部署到我们的服务器上。\n\n在收到的“证书颁发”的邮件的底部有一条链接，点击这条链接，进入证书管理系统。登录系统，在左侧导航栏中点击“SSL证书”，再点击“预览”，再在右侧的“信息预览”中点击“下载最新证书“。\n\n![下载证书](https://astrobear.top/resource/astroblog/content/download_cert.png)\n\n在弹出的对话框内，选择证书格式为“PEM(适用于Nginx,SLB)”，输入你的订单密码。证书密码可以留空。\n\n![下载证书](https://astrobear.top/resource/astroblog/content/download_cert1.png)\n\n下载完成后，解压下载的压缩包，需要输入你的订单密码（如果你没有设置证书密码）。解压以后可以得到下图两个文件。\n\n![解压缩](https://astrobear.top/resource/astroblog/content/unzip_cert.png)\n\n接下来，打开你的终端，按顺序输入下列命令：\n\n```shell\nssh 你的公网IP #ssh登录，输入你的密码\ncd /usr/local/nginx #切换到nginx的安装目录\nmkdir ./cert #创建一个新文件夹cert用于存放你的证书\nexit #断开与服务器的连接\nscp 文件的路径/你的域名.key 你的服务器用户名@你的服务器IP地址:./cert #将.key文件上传到你的服务器的指定目录下\nscp 文件的路径/你的域名.crt 你的服务器用户名@你的服务器IP地址:./cert #将.crt文件上传到你的服务器的指定目录下\n```\n\n接下来我们需要修改nginx的配置文件。参考[前文](#2)所述方法打开nginx的配置文件。先将你之前插入的内容删除或者使用`#`注释掉，然后在最后一个大括号前插入以下内容：\n\n```nginx\nserver {\n         listen       443 ssl;\n         server_name  example.com; #你证书绑定的域名;\n\n        ssl_certificate      /usr/local/nginx/cert/你的域名.crt;\n        ssl_certificate_key  /usr/local/nginx/cert/你的域名.key;\n\n        ssl_session_cache    shared:SSL:1m;\n        ssl_session_timeout  5m;\n\n        ssl_ciphers  HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers  on;\n        \n        location / {\n            index index.htm index.html; #指定默认文件。\n\t    \t\t\troot html; #指定网站根目录。\n        }\n}\nserver { #将你的80端口重定向至433端口，即强制使用https访问\n  \t\t\tlisten 80;\n  \t\t\tserver_name; example.com; #你的域名\n\t\t\t\trewrite ^/(.*)$ https://example.com:443/$1 permanent;\n}\n```\n\n将文件保存以后重启nginx服务。\n\n重启以后你可能会遇到这样的问题：`**unknown directive “ssl” in /usr/local/nginx/conf/nginx.conf:121**`，这是因为你在安装nginx时，没有编译SSL模块。你可以在终端里按照下述步骤解决[^ 3]：\n\n```shell\ncd ../nginx-1.16.1 #进入到nginx的源码包的目录下\n./configure --with-http_ssl_module #带参数执行程序\nmake #编译\ncp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx_bak #备份旧的nginx\ncp ./objs/nginx /usr/local/nginx/sbin/ #然后将新的nginx的程序复制一份\ncd /usr/local/nginx/sbin/ #切换到sbin目录\n./nginx -s reload #重启nginx服务\n```\n\n如果重启成功的话，打开浏览器访问你的域名，这时候应该可以在链接旁边看到一个小锁了！\n\n[^1]:https://support.huaweicloud.com/usermanual-vpc/zh-cn_topic_0073379079.html\n\n[^2]: https://support.huaweicloud.com/icprb-icp/zh-cn_topic_0115815923.html\n[^ 3]: https://blog.csdn.net/qq_26369317/article/details/102863613\n\n","source":"_posts/华为云+nginx服务器搭建总结.md","raw":"---\ntitle: 华为云+nginx服务器搭建总结\ndate: 2020-1-8 10:29\ncategories: \n\t- [CS]\n\t#- [cate2]\n\t#...\ntags: \n\t- Nginx\n\t- Server\n\t- Blog\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://kinsta.com/wp-content/uploads/2018/03/what-is-nginx.png\n\nthumbnail: https://kinsta.com/wp-content/uploads/2018/03/what-is-nginx.png\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 搭建自己的服务器并不难，只是过程较为复杂。\n\n#You can begin to input your article below now.\n---\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第一篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n\n- “建站搭博客”系列之二：[Hexo博客的安装和自动部署](https://astrobear.top/2021/08/16/Hexo的安装和自动部署/)\n- “建站搭博客”系列之三：[Hexo主题Icarus的自定义](https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/)\n\n> 由于自己是去年七月配置好的服务器，有一些细节或者遇到的问题已经记不太清，故本文可能会有不完整的地方，遇到问题请善用搜索引擎，而且服务器的配置方法也不只有这一种。本文主要用作对自己操作步骤和方法的一个总结，以便于日后查阅。\n\n### 购买服务器\n\n首先去[华为云官网](https://www.huaweicloud.com/?locale=zh-cn)注册一个账号。如果是学生，可以搜索“学生”，并进行学生认证。学生认证的步骤参见[学生认证流程](https://support.huaweicloud.com/usermanual-account/zh-cn_topic_0069253575.html)。进行身份验证后可以购买学生优惠套餐，云服务器价格只要99元/年，比阿里云和腾讯云的都要便宜一些。\n\n![华为云学生优惠](https://astrobear.top/resource/astroblog/content/hwcloud_discount.png)\n\n购买完成后，你可以在控制台看到自己现有的资源以及运行情况。\n\n![控制台](https://astrobear.top/resource/astroblog/content/console.png)\n\n### 配置安全组\n\n> 安全组是一个逻辑上的分组，为具有相同安全保护需求并相互信任的云服务器提供访问策略。安全组创建后，用户可以在安全组中定义各种访问规则，当云服务器加入该安全组后，即受到这些访问规则的保护。\n>\n> 系统会为每个用户默认创建一个默认安全组，默认安全组的规则是在出方向上的数据报文全部放行，入方向访问受限，安全组内的云服务器无需添加规则即可互相访问。默认安全组可以直接使用。\n>\n> 安全组创建后，你可以在安全组中设置出方向、入方向规则，这些规则会对安全组内部的云服务器出入方向网络流量进行访问控制，当云服务器加入该安全组后，即受到这些访问规则的保护。[^1]\n\n在控制台点击“弹性云服务器ECS”，在这里你可看到你的服务器的公网IP，请记下这个IP地址。然后点击在列表中点击你的服务器的名称。\n\n![选择服务器](https://astrobear.top/resource/astroblog/content/security_groups.png)\n\n进入云服务器管理页面后，点击“安全组”。再点击“Sys-default”可以看到默认安全组。然后下面给出的图片是我目前的安全组设置，仅供参考。选择“入/出方向方向规则”，再点击“添加规则“即可手动添加规则。一般来说，配置的都是入方向的安全组，并且源地址（访问服务器的设备的IP地址）都为“0.0.0.0/0”（所有IP地址）。\n\n通常需要配置如下几个功能：\n\n- SSH远程连接Linux弹性云服务器（协议：SSH，端口：22）\n- 公网“ping”ECS弹性云服务器（协议：ICMP，端口：全部）\n- 弹性云服务器作Web服务器\n  - 协议：http，端口：80\n  - 协议：https，端口：433\n\n详细配置请参考[安全组配置示例](https://support.huaweicloud.com/usermanual-ecs/zh-cn_topic_0140323152.html)。\n\n![安全组设置](https://astrobear.top/resource/astroblog/content/sg_settings.png)\n\n![安全组设置](https://astrobear.top/resource/astroblog/content/sg_settings1.png)\n\n配置完成后，可以打开电脑上的终端，用下面的语句测试一下：\n\n`ping 你的公网IP`\n\n出现类似下面的内容就代表成功了：\n\n![ping测试](https://astrobear.top/resource/astroblog/content/ping_test.png)\n\n你可以按下`Ctrl+C`来结束`ping`这个进程。\n\n然后在终端里输入：\n\n`ssh 你的公网IP`\n\n如果你的安全组配置正确的话，会让你输入服务器的登录密码。输入密码（注意：密码是不会显示的）后回车，应该可以看到这样的输出：\n\n![ssh登录](https://astrobear.top/resource/astroblog/content/ssh_login.png)\n\n这个时候，你的终端就已经连接上了服务器的系统了，你在终端里的一切操作都是作用在服务器上的。\n\n### 在服务器上安装nginx\n\n首先请在终端使用ssh登录你的服务器，然后按照下面给出的顺序输入命令。\n\n```shell\nyum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel #安装编译工具及库文件\ncd /usr/local/ #切换到目标安装文件夹\nwget http://nginx.org/download/nginx-1.16.1.tar.gz #下载最新版本的Nginx\ntar -zxvf nginx-1.16.1.tar.gz #解压文件\ncd nginx-1.16.1 #进入解压的文件夹\n./configure #执行程序\nmake #编译\nmake install #安装\ncd /usr/local/nginx/sbin #进入Nginx安装目录\n./nginx #运行Nginx\n```\n\n此时，安装应该已经完成了。打开浏览器，在地址栏中输入你的公网ip。如果看到下图所示内容，就代表安装成功了。\n\n![nginx安装成功](https://astrobear.top/resource/astroblog/content/nginx_install.png)\n\n### 创建属于你自己的域名\n\n在拥有了自己的服务器以后，就可以做很多事情了。但是现在你只能通过IP地址访问自己的服务器，看起来总是有点别扭。另外，如果你想要网站有一定的影响力的话，仅有IP地址会让人几乎找不到你的网站，而且也不符合国家法律规定。所以还是建议大家弄一个自己的域名。\n\n现在市面上的云服务器提供商也都提供域名注册的服务，直接在你的服务提供商的平台上面注册即可。下面我继续用华为云的平台演示。\n\n首先在华为云网站页面的导航栏的搜索框内搜索“域名”，打开第一个链接“域名注册服务”。也可以直接点击这里：[域名注册服务_华为云](https://www.huaweicloud.com/product/domain.html)。\n\n然后你可以在网页中选择你的域名，常见的如`.com`，`.cn`，`.net`等。这些域名会相对比较贵。作为学生党，我选择一个最便宜的域名`.top`，只需要9元/年。\n\n点击你想要的域名后，会跳转到一个新的页面。接下来再次选择你要的域名，并且在“查域名”的搜索框内输入你想要的域名，看看是否已经被占用，如果被占用了就换一个。若显示“域名可注册”，就点击“立即购买”。\n\n![域名购买](https://astrobear.top/resource/astroblog/content/buy_domain.png)\n\n购买完成后，你就拥有了自己域名了！\n\n### 备案\n\n> 备案是中国大陆的一项法规，使用大陆节点服务器提供互联网信息服务的用户，需要在服务器提供商处提交备案申请。\n>\n> 根据工信部《互联网信息服务管理办法》(国务院292号令)和工信部令第33号《非经营性互联网信息服务备案管理办法》规定，国家对经营性互联网信息服务实行许可制度，对非经营性互联网信息服务实行备案制度。未取得许可或者未履行备案手续的，不得从事互联网信息服务，否则属违法行为。通俗来讲，要开办网站必须先办理网站备案，备案成功并获取通信管理局下发的ICP备案号后才能开通访问。[^2]\n\n这一步不多说了，具体步骤比较繁琐，花费的时间也比较长，需要一两周。网站上有很清晰的[操作方法](https://support.huaweicloud.com/pi-icp/zh-cn_topic_0115820080.html)，请自行查阅，根据步骤操作即可。需要注意一点的是，在审核过程中可能会接到服务提供商打来的电话，不要漏接。\n\n需要注意的是，上面的备案操作是在工信部备案的。完成了在工信部的备案以后还需要公安备案。具体[操作方法](http://www.beian.gov.cn/portal/downloadFile?token=596b0ddf-6c81-40bf-babd-65147ee8120c&id=29&token=596b0ddf-6c81-40bf-babd-65147ee8120c)也请自行查阅。\n\n### 域名解析\n\n在完成一系列繁琐的备案流程以后，你的网站还不可以通过域名访问。只有把你的域名跟服务器的IP地址绑定在一起之后，并且在服务器上修改了配置文件之后才可以。\n\n首先打开管理控制台，在控制台中选择“域名注册”。然后在下面的页面中点击“解析”。\n\n![域名注册](https://astrobear.top/resource/astroblog/content/domain.png)\n\n点击你的域名，显示如下页面。这里显示的是你域名的记录集，前两个记录集应该是预置设置，不可暂停服务。<span id=\"1\">你可以在这基础上添加自己的记录集。</span>\n\n![记录集](https://astrobear.top/resource/astroblog/content/record.png)\n\n点击页面右上角红色按钮以添加记录集。添加记录集的配置如下图所示。下图中给出的例子是添加的“A”型记录集，也即通过`example.com`访问网站。若需要通过`www.example.com`访问网站，则需要为`example.com`的子域名添加“A”型记录集。具体配置参见：[配置网站解析_华为云](https://support.huaweicloud.com/qs-dns/dns_qs_0002.html#section1)。点击“确定”，完成添加。你可以通过`ping 你的域名`来测试你添加的记录集是否生效了。\n\n![添加记录集](https://support.huaweicloud.com/qs-dns/zh-cn_image_0200891923.png)\n\n### 配置nginx\n\n<span id=\"2\">打开</span>你电脑上的终端，输入命令：`ssh 你的IP地址`，输入你的服务器的密码。\n\n进入你的nginx的安装目录：`cd /usr/local/nginx/`。\n\n使用vim打开nginx的配置文件：`vim ./conf/nginx.conf`。\n\n按`I`开始输入。\n\n在最后一个大括号前插入以下内容：\n\n```nginx\nserver {\n\t    listen   80; #监听端口设为 80\n\t    server_name  example.com; #绑定您的域名\n\t    index index.htm index.html; #指定默认文件\n\t    root html; #指定网站根目录\n}\n```\n\n然后按`esc`退出编辑，再按`Shift+zz`保存。\n\n输入：`cd ./sbin`，切换文件夹。\n\n执行命令：`nginx -s relod`，重启nginx服务。\n\n这时候再尝试用浏览器访问你的域名，应该会显示之前出现过的“Welcome to nginx ”的页面了！\n\n### 申请SSL证书\n\nSSL证书可以在数据传输的过程中对其进行加密和隐藏，可以极大地提高数据传输的安全性。拥有SSL证书的网站的请求头都是`https`，并且在链接旁边会出现一把小锁。但是，SSL证书并不是所有网站都必须的，这视你的需要而定。比如，微信小程序的服务器就必须要有域名和SSL证书。另外，出于信息传输的安全性方面的考虑，有SSL证书还是显得更为妥当和专业一点。\n\n现在市面上各大云服务器提供商也都提供配套的SSL证书申请服务，一般都是提供企业级的证书，价格比较昂贵。但是同时网络上也有一些免费的SSL证书服务可以选择。下面还是以华为云的平台为例，简单说明一下如何申请SSL证书。\n\n首先在华为云页面的导航栏的搜索框内搜索“免费证书“，然后点击[亚洲诚信域名型DV单域名SSL证书--免费证书](https://marketplace.huaweicloud.com/product/00301-315148-0--0)，可以看到证书的价格是0.00元。点击“立即购买”。\n\n![购买SSL证书](https://astrobear.top/resource/astroblog/content/buy_ssl.png)\n\n完成购买后请不要立即关闭页面，页面中的订单号在之后还需要用到。尔后，系统会发送”HuaweiCloud账户申请”邮件至用户邮箱，即你在华为云的注册邮箱。\n\n![HuaweiCloud账户申请](https://astrobear.top/resource/astroblog/content/request_account.png)\n\n点击邮件中的登录地址进入系统，并使用邮件提供的账号和初始密码进行登录。登入系统后请修改你的初始密码，然后请根据华为云中给你提供的订单号在该系统中查询你的订单。查询到你的订单以后，需要你补充一些信息，请如实填写。系统会要你填写公司信息，如果只是个人网站，那么公司名称直接填写你的名字即可，公司地址就填写你的住址。\n\n填写完成后会进入审核阶段，系统会给你发送一封邮件。\n\n![证书审核](https://astrobear.top/resource/astroblog/content/check.png)\n\n根据邮件的提示，需要在记录集中添加新的内容。请根据[前文](#1)所述方法，将邮件中的内容添加至新的记录集。填写方法如下图所示。\n\n![填写记录集](https://astrobear.top/resource/astroblog/content/modify_record.png)\n\n填写完成后，可以在本地电脑的终端里输入`nslookup -querytype=txt 你的域名`来测试记录集是否生效。\n\n![测试记录集](https://astrobear.top/resource/astroblog/content/test_record.png)\n\n一般来说，记录集生效后10分钟以内证书就会颁发了。\n\n![证书颁发](https://astrobear.top/resource/astroblog/content/issue.png)\n\n### SSL证书部署\n\n接下来我们要把SSL证书部署到我们的服务器上。\n\n在收到的“证书颁发”的邮件的底部有一条链接，点击这条链接，进入证书管理系统。登录系统，在左侧导航栏中点击“SSL证书”，再点击“预览”，再在右侧的“信息预览”中点击“下载最新证书“。\n\n![下载证书](https://astrobear.top/resource/astroblog/content/download_cert.png)\n\n在弹出的对话框内，选择证书格式为“PEM(适用于Nginx,SLB)”，输入你的订单密码。证书密码可以留空。\n\n![下载证书](https://astrobear.top/resource/astroblog/content/download_cert1.png)\n\n下载完成后，解压下载的压缩包，需要输入你的订单密码（如果你没有设置证书密码）。解压以后可以得到下图两个文件。\n\n![解压缩](https://astrobear.top/resource/astroblog/content/unzip_cert.png)\n\n接下来，打开你的终端，按顺序输入下列命令：\n\n```shell\nssh 你的公网IP #ssh登录，输入你的密码\ncd /usr/local/nginx #切换到nginx的安装目录\nmkdir ./cert #创建一个新文件夹cert用于存放你的证书\nexit #断开与服务器的连接\nscp 文件的路径/你的域名.key 你的服务器用户名@你的服务器IP地址:./cert #将.key文件上传到你的服务器的指定目录下\nscp 文件的路径/你的域名.crt 你的服务器用户名@你的服务器IP地址:./cert #将.crt文件上传到你的服务器的指定目录下\n```\n\n接下来我们需要修改nginx的配置文件。参考[前文](#2)所述方法打开nginx的配置文件。先将你之前插入的内容删除或者使用`#`注释掉，然后在最后一个大括号前插入以下内容：\n\n```nginx\nserver {\n         listen       443 ssl;\n         server_name  example.com; #你证书绑定的域名;\n\n        ssl_certificate      /usr/local/nginx/cert/你的域名.crt;\n        ssl_certificate_key  /usr/local/nginx/cert/你的域名.key;\n\n        ssl_session_cache    shared:SSL:1m;\n        ssl_session_timeout  5m;\n\n        ssl_ciphers  HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers  on;\n        \n        location / {\n            index index.htm index.html; #指定默认文件。\n\t    \t\t\troot html; #指定网站根目录。\n        }\n}\nserver { #将你的80端口重定向至433端口，即强制使用https访问\n  \t\t\tlisten 80;\n  \t\t\tserver_name; example.com; #你的域名\n\t\t\t\trewrite ^/(.*)$ https://example.com:443/$1 permanent;\n}\n```\n\n将文件保存以后重启nginx服务。\n\n重启以后你可能会遇到这样的问题：`**unknown directive “ssl” in /usr/local/nginx/conf/nginx.conf:121**`，这是因为你在安装nginx时，没有编译SSL模块。你可以在终端里按照下述步骤解决[^ 3]：\n\n```shell\ncd ../nginx-1.16.1 #进入到nginx的源码包的目录下\n./configure --with-http_ssl_module #带参数执行程序\nmake #编译\ncp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx_bak #备份旧的nginx\ncp ./objs/nginx /usr/local/nginx/sbin/ #然后将新的nginx的程序复制一份\ncd /usr/local/nginx/sbin/ #切换到sbin目录\n./nginx -s reload #重启nginx服务\n```\n\n如果重启成功的话，打开浏览器访问你的域名，这时候应该可以在链接旁边看到一个小锁了！\n\n[^1]:https://support.huaweicloud.com/usermanual-vpc/zh-cn_topic_0073379079.html\n\n[^2]: https://support.huaweicloud.com/icprb-icp/zh-cn_topic_0115815923.html\n[^ 3]: https://blog.csdn.net/qq_26369317/article/details/102863613\n\n","slug":"华为云+nginx服务器搭建总结","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0a001q1q397ocd9pax","content":"<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第一篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n\n<ul>\n<li>“建站搭博客”系列之二：<a href=\"https://astrobear.top/2021/08/16/Hexo的安装和自动部署/\">Hexo博客的安装和自动部署</a></li>\n<li>“建站搭博客”系列之三：<a href=\"https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/\">Hexo主题Icarus的自定义</a></li>\n</ul>\n<blockquote>\n<p>由于自己是去年七月配置好的服务器，有一些细节或者遇到的问题已经记不太清，故本文可能会有不完整的地方，遇到问题请善用搜索引擎，而且服务器的配置方法也不只有这一种。本文主要用作对自己操作步骤和方法的一个总结，以便于日后查阅。</p>\n</blockquote>\n<h3 id=\"购买服务器\"><a href=\"#购买服务器\" class=\"headerlink\" title=\"购买服务器\"></a>购买服务器</h3><p>首先去<a href=\"https://www.huaweicloud.com/?locale=zh-cn\">华为云官网</a>注册一个账号。如果是学生，可以搜索“学生”，并进行学生认证。学生认证的步骤参见<a href=\"https://support.huaweicloud.com/usermanual-account/zh-cn_topic_0069253575.html\">学生认证流程</a>。进行身份验证后可以购买学生优惠套餐，云服务器价格只要99元/年，比阿里云和腾讯云的都要便宜一些。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hwcloud_discount.png\" alt=\"华为云学生优惠\"></p>\n<p>购买完成后，你可以在控制台看到自己现有的资源以及运行情况。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/console.png\" alt=\"控制台\"></p>\n<h3 id=\"配置安全组\"><a href=\"#配置安全组\" class=\"headerlink\" title=\"配置安全组\"></a>配置安全组</h3><blockquote>\n<p>安全组是一个逻辑上的分组，为具有相同安全保护需求并相互信任的云服务器提供访问策略。安全组创建后，用户可以在安全组中定义各种访问规则，当云服务器加入该安全组后，即受到这些访问规则的保护。</p>\n<p>系统会为每个用户默认创建一个默认安全组，默认安全组的规则是在出方向上的数据报文全部放行，入方向访问受限，安全组内的云服务器无需添加规则即可互相访问。默认安全组可以直接使用。</p>\n<p>安全组创建后，你可以在安全组中设置出方向、入方向规则，这些规则会对安全组内部的云服务器出入方向网络流量进行访问控制，当云服务器加入该安全组后，即受到这些访问规则的保护。<a href=\"https://support.huaweicloud.com/usermanual-vpc/zh-cn_topic_0073379079.html\">^1</a></p>\n</blockquote>\n<p>在控制台点击“弹性云服务器ECS”，在这里你可看到你的服务器的公网IP，请记下这个IP地址。然后点击在列表中点击你的服务器的名称。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/security_groups.png\" alt=\"选择服务器\"></p>\n<p>进入云服务器管理页面后，点击“安全组”。再点击“Sys-default”可以看到默认安全组。然后下面给出的图片是我目前的安全组设置，仅供参考。选择“入/出方向方向规则”，再点击“添加规则“即可手动添加规则。一般来说，配置的都是入方向的安全组，并且源地址（访问服务器的设备的IP地址）都为“0.0.0.0/0”（所有IP地址）。</p>\n<p>通常需要配置如下几个功能：</p>\n<ul>\n<li>SSH远程连接Linux弹性云服务器（协议：SSH，端口：22）</li>\n<li>公网“ping”ECS弹性云服务器（协议：ICMP，端口：全部）</li>\n<li>弹性云服务器作Web服务器<ul>\n<li>协议：http，端口：80</li>\n<li>协议：https，端口：433</li>\n</ul>\n</li>\n</ul>\n<p>详细配置请参考<a href=\"https://support.huaweicloud.com/usermanual-ecs/zh-cn_topic_0140323152.html\">安全组配置示例</a>。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sg_settings.png\" alt=\"安全组设置\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sg_settings1.png\" alt=\"安全组设置\"></p>\n<p>配置完成后，可以打开电脑上的终端，用下面的语句测试一下：</p>\n<p><code>ping 你的公网IP</code></p>\n<p>出现类似下面的内容就代表成功了：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/ping_test.png\" alt=\"ping测试\"></p>\n<p>你可以按下<code>Ctrl+C</code>来结束<code>ping</code>这个进程。</p>\n<p>然后在终端里输入：</p>\n<p><code>ssh 你的公网IP</code></p>\n<p>如果你的安全组配置正确的话，会让你输入服务器的登录密码。输入密码（注意：密码是不会显示的）后回车，应该可以看到这样的输出：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/ssh_login.png\" alt=\"ssh登录\"></p>\n<p>这个时候，你的终端就已经连接上了服务器的系统了，你在终端里的一切操作都是作用在服务器上的。</p>\n<h3 id=\"在服务器上安装nginx\"><a href=\"#在服务器上安装nginx\" class=\"headerlink\" title=\"在服务器上安装nginx\"></a>在服务器上安装nginx</h3><p>首先请在终端使用ssh登录你的服务器，然后按照下面给出的顺序输入命令。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel #安装编译工具及库文件</span><br><span class=\"line\">cd /usr/local/ #切换到目标安装文件夹</span><br><span class=\"line\">wget http://nginx.org/download/nginx-1.16.1.tar.gz #下载最新版本的Nginx</span><br><span class=\"line\">tar -zxvf nginx-1.16.1.tar.gz #解压文件</span><br><span class=\"line\">cd nginx-1.16.1 #进入解压的文件夹</span><br><span class=\"line\">./configure #执行程序</span><br><span class=\"line\">make #编译</span><br><span class=\"line\">make install #安装</span><br><span class=\"line\">cd /usr/local/nginx/sbin #进入Nginx安装目录</span><br><span class=\"line\">./nginx #运行Nginx</span><br></pre></td></tr></table></figure>\n\n<p>此时，安装应该已经完成了。打开浏览器，在地址栏中输入你的公网ip。如果看到下图所示内容，就代表安装成功了。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/nginx_install.png\" alt=\"nginx安装成功\"></p>\n<h3 id=\"创建属于你自己的域名\"><a href=\"#创建属于你自己的域名\" class=\"headerlink\" title=\"创建属于你自己的域名\"></a>创建属于你自己的域名</h3><p>在拥有了自己的服务器以后，就可以做很多事情了。但是现在你只能通过IP地址访问自己的服务器，看起来总是有点别扭。另外，如果你想要网站有一定的影响力的话，仅有IP地址会让人几乎找不到你的网站，而且也不符合国家法律规定。所以还是建议大家弄一个自己的域名。</p>\n<p>现在市面上的云服务器提供商也都提供域名注册的服务，直接在你的服务提供商的平台上面注册即可。下面我继续用华为云的平台演示。</p>\n<p>首先在华为云网站页面的导航栏的搜索框内搜索“域名”，打开第一个链接“域名注册服务”。也可以直接点击这里：<a href=\"https://www.huaweicloud.com/product/domain.html\">域名注册服务_华为云</a>。</p>\n<p>然后你可以在网页中选择你的域名，常见的如<code>.com</code>，<code>.cn</code>，<code>.net</code>等。这些域名会相对比较贵。作为学生党，我选择一个最便宜的域名<code>.top</code>，只需要9元/年。</p>\n<p>点击你想要的域名后，会跳转到一个新的页面。接下来再次选择你要的域名，并且在“查域名”的搜索框内输入你想要的域名，看看是否已经被占用，如果被占用了就换一个。若显示“域名可注册”，就点击“立即购买”。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/buy_domain.png\" alt=\"域名购买\"></p>\n<p>购买完成后，你就拥有了自己域名了！</p>\n<h3 id=\"备案\"><a href=\"#备案\" class=\"headerlink\" title=\"备案\"></a>备案</h3><blockquote>\n<p>备案是中国大陆的一项法规，使用大陆节点服务器提供互联网信息服务的用户，需要在服务器提供商处提交备案申请。</p>\n<p>根据工信部《互联网信息服务管理办法》(国务院292号令)和工信部令第33号《非经营性互联网信息服务备案管理办法》规定，国家对经营性互联网信息服务实行许可制度，对非经营性互联网信息服务实行备案制度。未取得许可或者未履行备案手续的，不得从事互联网信息服务，否则属违法行为。通俗来讲，要开办网站必须先办理网站备案，备案成功并获取通信管理局下发的ICP备案号后才能开通访问。<a href=\"https://support.huaweicloud.com/icprb-icp/zh-cn_topic_0115815923.html\">^2</a></p>\n</blockquote>\n<p>这一步不多说了，具体步骤比较繁琐，花费的时间也比较长，需要一两周。网站上有很清晰的<a href=\"https://support.huaweicloud.com/pi-icp/zh-cn_topic_0115820080.html\">操作方法</a>，请自行查阅，根据步骤操作即可。需要注意一点的是，在审核过程中可能会接到服务提供商打来的电话，不要漏接。</p>\n<p>需要注意的是，上面的备案操作是在工信部备案的。完成了在工信部的备案以后还需要公安备案。具体<a href=\"http://www.beian.gov.cn/portal/downloadFile?token=596b0ddf-6c81-40bf-babd-65147ee8120c&id=29&token=596b0ddf-6c81-40bf-babd-65147ee8120c\">操作方法</a>也请自行查阅。</p>\n<h3 id=\"域名解析\"><a href=\"#域名解析\" class=\"headerlink\" title=\"域名解析\"></a>域名解析</h3><p>在完成一系列繁琐的备案流程以后，你的网站还不可以通过域名访问。只有把你的域名跟服务器的IP地址绑定在一起之后，并且在服务器上修改了配置文件之后才可以。</p>\n<p>首先打开管理控制台，在控制台中选择“域名注册”。然后在下面的页面中点击“解析”。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/domain.png\" alt=\"域名注册\"></p>\n<p>点击你的域名，显示如下页面。这里显示的是你域名的记录集，前两个记录集应该是预置设置，不可暂停服务。<span id=\"1\">你可以在这基础上添加自己的记录集。</span></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/record.png\" alt=\"记录集\"></p>\n<p>点击页面右上角红色按钮以添加记录集。添加记录集的配置如下图所示。下图中给出的例子是添加的“A”型记录集，也即通过<code>example.com</code>访问网站。若需要通过<code>www.example.com</code>访问网站，则需要为<code>example.com</code>的子域名添加“A”型记录集。具体配置参见：<a href=\"https://support.huaweicloud.com/qs-dns/dns_qs_0002.html#section1\">配置网站解析_华为云</a>。点击“确定”，完成添加。你可以通过<code>ping 你的域名</code>来测试你添加的记录集是否生效了。</p>\n<p><img src=\"https://support.huaweicloud.com/qs-dns/zh-cn_image_0200891923.png\" alt=\"添加记录集\"></p>\n<h3 id=\"配置nginx\"><a href=\"#配置nginx\" class=\"headerlink\" title=\"配置nginx\"></a>配置nginx</h3><p><span id=\"2\">打开</span>你电脑上的终端，输入命令：<code>ssh 你的IP地址</code>，输入你的服务器的密码。</p>\n<p>进入你的nginx的安装目录：<code>cd /usr/local/nginx/</code>。</p>\n<p>使用vim打开nginx的配置文件：<code>vim ./conf/nginx.conf</code>。</p>\n<p>按<code>I</code>开始输入。</p>\n<p>在最后一个大括号前插入以下内容：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">listen</span>   <span class=\"number\">80</span>; <span class=\"comment\">#监听端口设为 80</span></span><br><span class=\"line\">        <span class=\"attribute\">server_name</span>  example.com; <span class=\"comment\">#绑定您的域名</span></span><br><span class=\"line\">        <span class=\"attribute\">index</span> index.htm index.html; <span class=\"comment\">#指定默认文件</span></span><br><span class=\"line\">        <span class=\"attribute\">root</span> html; <span class=\"comment\">#指定网站根目录</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后按<code>esc</code>退出编辑，再按<code>Shift+zz</code>保存。</p>\n<p>输入：<code>cd ./sbin</code>，切换文件夹。</p>\n<p>执行命令：<code>nginx -s relod</code>，重启nginx服务。</p>\n<p>这时候再尝试用浏览器访问你的域名，应该会显示之前出现过的“Welcome to nginx ”的页面了！</p>\n<h3 id=\"申请SSL证书\"><a href=\"#申请SSL证书\" class=\"headerlink\" title=\"申请SSL证书\"></a>申请SSL证书</h3><p>SSL证书可以在数据传输的过程中对其进行加密和隐藏，可以极大地提高数据传输的安全性。拥有SSL证书的网站的请求头都是<code>https</code>，并且在链接旁边会出现一把小锁。但是，SSL证书并不是所有网站都必须的，这视你的需要而定。比如，微信小程序的服务器就必须要有域名和SSL证书。另外，出于信息传输的安全性方面的考虑，有SSL证书还是显得更为妥当和专业一点。</p>\n<p>现在市面上各大云服务器提供商也都提供配套的SSL证书申请服务，一般都是提供企业级的证书，价格比较昂贵。但是同时网络上也有一些免费的SSL证书服务可以选择。下面还是以华为云的平台为例，简单说明一下如何申请SSL证书。</p>\n<p>首先在华为云页面的导航栏的搜索框内搜索“免费证书“，然后点击<a href=\"https://marketplace.huaweicloud.com/product/00301-315148-0--0\">亚洲诚信域名型DV单域名SSL证书–免费证书</a>，可以看到证书的价格是0.00元。点击“立即购买”。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/buy_ssl.png\" alt=\"购买SSL证书\"></p>\n<p>完成购买后请不要立即关闭页面，页面中的订单号在之后还需要用到。尔后，系统会发送”HuaweiCloud账户申请”邮件至用户邮箱，即你在华为云的注册邮箱。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/request_account.png\" alt=\"HuaweiCloud账户申请\"></p>\n<p>点击邮件中的登录地址进入系统，并使用邮件提供的账号和初始密码进行登录。登入系统后请修改你的初始密码，然后请根据华为云中给你提供的订单号在该系统中查询你的订单。查询到你的订单以后，需要你补充一些信息，请如实填写。系统会要你填写公司信息，如果只是个人网站，那么公司名称直接填写你的名字即可，公司地址就填写你的住址。</p>\n<p>填写完成后会进入审核阶段，系统会给你发送一封邮件。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/check.png\" alt=\"证书审核\"></p>\n<p>根据邮件的提示，需要在记录集中添加新的内容。请根据<a href=\"#1\">前文</a>所述方法，将邮件中的内容添加至新的记录集。填写方法如下图所示。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/modify_record.png\" alt=\"填写记录集\"></p>\n<p>填写完成后，可以在本地电脑的终端里输入<code>nslookup -querytype=txt 你的域名</code>来测试记录集是否生效。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/test_record.png\" alt=\"测试记录集\"></p>\n<p>一般来说，记录集生效后10分钟以内证书就会颁发了。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/issue.png\" alt=\"证书颁发\"></p>\n<h3 id=\"SSL证书部署\"><a href=\"#SSL证书部署\" class=\"headerlink\" title=\"SSL证书部署\"></a>SSL证书部署</h3><p>接下来我们要把SSL证书部署到我们的服务器上。</p>\n<p>在收到的“证书颁发”的邮件的底部有一条链接，点击这条链接，进入证书管理系统。登录系统，在左侧导航栏中点击“SSL证书”，再点击“预览”，再在右侧的“信息预览”中点击“下载最新证书“。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/download_cert.png\" alt=\"下载证书\"></p>\n<p>在弹出的对话框内，选择证书格式为“PEM(适用于Nginx,SLB)”，输入你的订单密码。证书密码可以留空。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/download_cert1.png\" alt=\"下载证书\"></p>\n<p>下载完成后，解压下载的压缩包，需要输入你的订单密码（如果你没有设置证书密码）。解压以后可以得到下图两个文件。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/unzip_cert.png\" alt=\"解压缩\"></p>\n<p>接下来，打开你的终端，按顺序输入下列命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh 你的公网IP #ssh登录，输入你的密码</span><br><span class=\"line\">cd /usr/local/nginx #切换到nginx的安装目录</span><br><span class=\"line\">mkdir ./cert #创建一个新文件夹cert用于存放你的证书</span><br><span class=\"line\">exit #断开与服务器的连接</span><br><span class=\"line\">scp 文件的路径/你的域名.key 你的服务器用户名@你的服务器IP地址:./cert #将.key文件上传到你的服务器的指定目录下</span><br><span class=\"line\">scp 文件的路径/你的域名.crt 你的服务器用户名@你的服务器IP地址:./cert #将.crt文件上传到你的服务器的指定目录下</span><br></pre></td></tr></table></figure>\n\n<p>接下来我们需要修改nginx的配置文件。参考<a href=\"#2\">前文</a>所述方法打开nginx的配置文件。先将你之前插入的内容删除或者使用<code>#</code>注释掉，然后在最后一个大括号前插入以下内容：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">         <span class=\"attribute\">listen</span>       <span class=\"number\">443</span> ssl;</span><br><span class=\"line\">         <span class=\"attribute\">server_name</span>  example.com; <span class=\"comment\">#你证书绑定的域名;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">ssl_certificate</span>      /usr/local/nginx/cert/你的域名.crt;</span><br><span class=\"line\">        <span class=\"attribute\">ssl_certificate_key</span>  /usr/local/nginx/cert/你的域名.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">ssl_session_cache</span>    shared:SSL:<span class=\"number\">1m</span>;</span><br><span class=\"line\">        <span class=\"attribute\">ssl_session_timeout</span>  <span class=\"number\">5m</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">ssl_ciphers</span>  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">        <span class=\"attribute\">ssl_prefer_server_ciphers</span>  <span class=\"literal\">on</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">            <span class=\"attribute\">index</span> index.htm index.html; <span class=\"comment\">#指定默认文件。</span></span><br><span class=\"line\">                    <span class=\"attribute\">root</span> html; <span class=\"comment\">#指定网站根目录。</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"section\">server</span> &#123; <span class=\"comment\">#将你的80端口重定向至433端口，即强制使用https访问</span></span><br><span class=\"line\">              <span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">              server_name; example.com; <span class=\"comment\">#你的域名</span></span><br><span class=\"line\">                <span class=\"attribute\">rewrite</span><span class=\"regexp\"> ^/(.*)$</span> https://example.com:443/<span class=\"variable\">$1</span> <span class=\"literal\">permanent</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将文件保存以后重启nginx服务。</p>\n<p>重启以后你可能会遇到这样的问题：<code>**unknown directive “ssl” in /usr/local/nginx/conf/nginx.conf:121**</code>，这是因为你在安装nginx时，没有编译SSL模块。你可以在终端里按照下述步骤解决<a href=\"https://blog.csdn.net/qq_26369317/article/details/102863613\">^ 3</a>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ../nginx-1.16.1 #进入到nginx的源码包的目录下</span><br><span class=\"line\">./configure --with-http_ssl_module #带参数执行程序</span><br><span class=\"line\">make #编译</span><br><span class=\"line\">cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx_bak #备份旧的nginx</span><br><span class=\"line\">cp ./objs/nginx /usr/local/nginx/sbin/ #然后将新的nginx的程序复制一份</span><br><span class=\"line\">cd /usr/local/nginx/sbin/ #切换到sbin目录</span><br><span class=\"line\">./nginx -s reload #重启nginx服务</span><br></pre></td></tr></table></figure>\n\n<p>如果重启成功的话，打开浏览器访问你的域名，这时候应该可以在链接旁边看到一个小锁了！</p>\n","site":{"data":{}},"more":"<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n这是Astrobear“建站搭博客”系列的第一篇文章，你可以点击下方链接查看该系列其他文章。\n</div>\n</article>\n\n\n<ul>\n<li>“建站搭博客”系列之二：<a href=\"https://astrobear.top/2021/08/16/Hexo的安装和自动部署/\">Hexo博客的安装和自动部署</a></li>\n<li>“建站搭博客”系列之三：<a href=\"https://astrobear.top/2021/08/23/Hexo主题Icarus的自定义/\">Hexo主题Icarus的自定义</a></li>\n</ul>\n<blockquote>\n<p>由于自己是去年七月配置好的服务器，有一些细节或者遇到的问题已经记不太清，故本文可能会有不完整的地方，遇到问题请善用搜索引擎，而且服务器的配置方法也不只有这一种。本文主要用作对自己操作步骤和方法的一个总结，以便于日后查阅。</p>\n</blockquote>\n<h3 id=\"购买服务器\"><a href=\"#购买服务器\" class=\"headerlink\" title=\"购买服务器\"></a>购买服务器</h3><p>首先去<a href=\"https://www.huaweicloud.com/?locale=zh-cn\">华为云官网</a>注册一个账号。如果是学生，可以搜索“学生”，并进行学生认证。学生认证的步骤参见<a href=\"https://support.huaweicloud.com/usermanual-account/zh-cn_topic_0069253575.html\">学生认证流程</a>。进行身份验证后可以购买学生优惠套餐，云服务器价格只要99元/年，比阿里云和腾讯云的都要便宜一些。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/hwcloud_discount.png\" alt=\"华为云学生优惠\"></p>\n<p>购买完成后，你可以在控制台看到自己现有的资源以及运行情况。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/console.png\" alt=\"控制台\"></p>\n<h3 id=\"配置安全组\"><a href=\"#配置安全组\" class=\"headerlink\" title=\"配置安全组\"></a>配置安全组</h3><blockquote>\n<p>安全组是一个逻辑上的分组，为具有相同安全保护需求并相互信任的云服务器提供访问策略。安全组创建后，用户可以在安全组中定义各种访问规则，当云服务器加入该安全组后，即受到这些访问规则的保护。</p>\n<p>系统会为每个用户默认创建一个默认安全组，默认安全组的规则是在出方向上的数据报文全部放行，入方向访问受限，安全组内的云服务器无需添加规则即可互相访问。默认安全组可以直接使用。</p>\n<p>安全组创建后，你可以在安全组中设置出方向、入方向规则，这些规则会对安全组内部的云服务器出入方向网络流量进行访问控制，当云服务器加入该安全组后，即受到这些访问规则的保护。<a href=\"https://support.huaweicloud.com/usermanual-vpc/zh-cn_topic_0073379079.html\">^1</a></p>\n</blockquote>\n<p>在控制台点击“弹性云服务器ECS”，在这里你可看到你的服务器的公网IP，请记下这个IP地址。然后点击在列表中点击你的服务器的名称。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/security_groups.png\" alt=\"选择服务器\"></p>\n<p>进入云服务器管理页面后，点击“安全组”。再点击“Sys-default”可以看到默认安全组。然后下面给出的图片是我目前的安全组设置，仅供参考。选择“入/出方向方向规则”，再点击“添加规则“即可手动添加规则。一般来说，配置的都是入方向的安全组，并且源地址（访问服务器的设备的IP地址）都为“0.0.0.0/0”（所有IP地址）。</p>\n<p>通常需要配置如下几个功能：</p>\n<ul>\n<li>SSH远程连接Linux弹性云服务器（协议：SSH，端口：22）</li>\n<li>公网“ping”ECS弹性云服务器（协议：ICMP，端口：全部）</li>\n<li>弹性云服务器作Web服务器<ul>\n<li>协议：http，端口：80</li>\n<li>协议：https，端口：433</li>\n</ul>\n</li>\n</ul>\n<p>详细配置请参考<a href=\"https://support.huaweicloud.com/usermanual-ecs/zh-cn_topic_0140323152.html\">安全组配置示例</a>。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sg_settings.png\" alt=\"安全组设置\"></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sg_settings1.png\" alt=\"安全组设置\"></p>\n<p>配置完成后，可以打开电脑上的终端，用下面的语句测试一下：</p>\n<p><code>ping 你的公网IP</code></p>\n<p>出现类似下面的内容就代表成功了：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/ping_test.png\" alt=\"ping测试\"></p>\n<p>你可以按下<code>Ctrl+C</code>来结束<code>ping</code>这个进程。</p>\n<p>然后在终端里输入：</p>\n<p><code>ssh 你的公网IP</code></p>\n<p>如果你的安全组配置正确的话，会让你输入服务器的登录密码。输入密码（注意：密码是不会显示的）后回车，应该可以看到这样的输出：</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/ssh_login.png\" alt=\"ssh登录\"></p>\n<p>这个时候，你的终端就已经连接上了服务器的系统了，你在终端里的一切操作都是作用在服务器上的。</p>\n<h3 id=\"在服务器上安装nginx\"><a href=\"#在服务器上安装nginx\" class=\"headerlink\" title=\"在服务器上安装nginx\"></a>在服务器上安装nginx</h3><p>首先请在终端使用ssh登录你的服务器，然后按照下面给出的顺序输入命令。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel #安装编译工具及库文件</span><br><span class=\"line\">cd /usr/local/ #切换到目标安装文件夹</span><br><span class=\"line\">wget http://nginx.org/download/nginx-1.16.1.tar.gz #下载最新版本的Nginx</span><br><span class=\"line\">tar -zxvf nginx-1.16.1.tar.gz #解压文件</span><br><span class=\"line\">cd nginx-1.16.1 #进入解压的文件夹</span><br><span class=\"line\">./configure #执行程序</span><br><span class=\"line\">make #编译</span><br><span class=\"line\">make install #安装</span><br><span class=\"line\">cd /usr/local/nginx/sbin #进入Nginx安装目录</span><br><span class=\"line\">./nginx #运行Nginx</span><br></pre></td></tr></table></figure>\n\n<p>此时，安装应该已经完成了。打开浏览器，在地址栏中输入你的公网ip。如果看到下图所示内容，就代表安装成功了。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/nginx_install.png\" alt=\"nginx安装成功\"></p>\n<h3 id=\"创建属于你自己的域名\"><a href=\"#创建属于你自己的域名\" class=\"headerlink\" title=\"创建属于你自己的域名\"></a>创建属于你自己的域名</h3><p>在拥有了自己的服务器以后，就可以做很多事情了。但是现在你只能通过IP地址访问自己的服务器，看起来总是有点别扭。另外，如果你想要网站有一定的影响力的话，仅有IP地址会让人几乎找不到你的网站，而且也不符合国家法律规定。所以还是建议大家弄一个自己的域名。</p>\n<p>现在市面上的云服务器提供商也都提供域名注册的服务，直接在你的服务提供商的平台上面注册即可。下面我继续用华为云的平台演示。</p>\n<p>首先在华为云网站页面的导航栏的搜索框内搜索“域名”，打开第一个链接“域名注册服务”。也可以直接点击这里：<a href=\"https://www.huaweicloud.com/product/domain.html\">域名注册服务_华为云</a>。</p>\n<p>然后你可以在网页中选择你的域名，常见的如<code>.com</code>，<code>.cn</code>，<code>.net</code>等。这些域名会相对比较贵。作为学生党，我选择一个最便宜的域名<code>.top</code>，只需要9元/年。</p>\n<p>点击你想要的域名后，会跳转到一个新的页面。接下来再次选择你要的域名，并且在“查域名”的搜索框内输入你想要的域名，看看是否已经被占用，如果被占用了就换一个。若显示“域名可注册”，就点击“立即购买”。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/buy_domain.png\" alt=\"域名购买\"></p>\n<p>购买完成后，你就拥有了自己域名了！</p>\n<h3 id=\"备案\"><a href=\"#备案\" class=\"headerlink\" title=\"备案\"></a>备案</h3><blockquote>\n<p>备案是中国大陆的一项法规，使用大陆节点服务器提供互联网信息服务的用户，需要在服务器提供商处提交备案申请。</p>\n<p>根据工信部《互联网信息服务管理办法》(国务院292号令)和工信部令第33号《非经营性互联网信息服务备案管理办法》规定，国家对经营性互联网信息服务实行许可制度，对非经营性互联网信息服务实行备案制度。未取得许可或者未履行备案手续的，不得从事互联网信息服务，否则属违法行为。通俗来讲，要开办网站必须先办理网站备案，备案成功并获取通信管理局下发的ICP备案号后才能开通访问。<a href=\"https://support.huaweicloud.com/icprb-icp/zh-cn_topic_0115815923.html\">^2</a></p>\n</blockquote>\n<p>这一步不多说了，具体步骤比较繁琐，花费的时间也比较长，需要一两周。网站上有很清晰的<a href=\"https://support.huaweicloud.com/pi-icp/zh-cn_topic_0115820080.html\">操作方法</a>，请自行查阅，根据步骤操作即可。需要注意一点的是，在审核过程中可能会接到服务提供商打来的电话，不要漏接。</p>\n<p>需要注意的是，上面的备案操作是在工信部备案的。完成了在工信部的备案以后还需要公安备案。具体<a href=\"http://www.beian.gov.cn/portal/downloadFile?token=596b0ddf-6c81-40bf-babd-65147ee8120c&id=29&token=596b0ddf-6c81-40bf-babd-65147ee8120c\">操作方法</a>也请自行查阅。</p>\n<h3 id=\"域名解析\"><a href=\"#域名解析\" class=\"headerlink\" title=\"域名解析\"></a>域名解析</h3><p>在完成一系列繁琐的备案流程以后，你的网站还不可以通过域名访问。只有把你的域名跟服务器的IP地址绑定在一起之后，并且在服务器上修改了配置文件之后才可以。</p>\n<p>首先打开管理控制台，在控制台中选择“域名注册”。然后在下面的页面中点击“解析”。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/domain.png\" alt=\"域名注册\"></p>\n<p>点击你的域名，显示如下页面。这里显示的是你域名的记录集，前两个记录集应该是预置设置，不可暂停服务。<span id=\"1\">你可以在这基础上添加自己的记录集。</span></p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/record.png\" alt=\"记录集\"></p>\n<p>点击页面右上角红色按钮以添加记录集。添加记录集的配置如下图所示。下图中给出的例子是添加的“A”型记录集，也即通过<code>example.com</code>访问网站。若需要通过<code>www.example.com</code>访问网站，则需要为<code>example.com</code>的子域名添加“A”型记录集。具体配置参见：<a href=\"https://support.huaweicloud.com/qs-dns/dns_qs_0002.html#section1\">配置网站解析_华为云</a>。点击“确定”，完成添加。你可以通过<code>ping 你的域名</code>来测试你添加的记录集是否生效了。</p>\n<p><img src=\"https://support.huaweicloud.com/qs-dns/zh-cn_image_0200891923.png\" alt=\"添加记录集\"></p>\n<h3 id=\"配置nginx\"><a href=\"#配置nginx\" class=\"headerlink\" title=\"配置nginx\"></a>配置nginx</h3><p><span id=\"2\">打开</span>你电脑上的终端，输入命令：<code>ssh 你的IP地址</code>，输入你的服务器的密码。</p>\n<p>进入你的nginx的安装目录：<code>cd /usr/local/nginx/</code>。</p>\n<p>使用vim打开nginx的配置文件：<code>vim ./conf/nginx.conf</code>。</p>\n<p>按<code>I</code>开始输入。</p>\n<p>在最后一个大括号前插入以下内容：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">listen</span>   <span class=\"number\">80</span>; <span class=\"comment\">#监听端口设为 80</span></span><br><span class=\"line\">        <span class=\"attribute\">server_name</span>  example.com; <span class=\"comment\">#绑定您的域名</span></span><br><span class=\"line\">        <span class=\"attribute\">index</span> index.htm index.html; <span class=\"comment\">#指定默认文件</span></span><br><span class=\"line\">        <span class=\"attribute\">root</span> html; <span class=\"comment\">#指定网站根目录</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后按<code>esc</code>退出编辑，再按<code>Shift+zz</code>保存。</p>\n<p>输入：<code>cd ./sbin</code>，切换文件夹。</p>\n<p>执行命令：<code>nginx -s relod</code>，重启nginx服务。</p>\n<p>这时候再尝试用浏览器访问你的域名，应该会显示之前出现过的“Welcome to nginx ”的页面了！</p>\n<h3 id=\"申请SSL证书\"><a href=\"#申请SSL证书\" class=\"headerlink\" title=\"申请SSL证书\"></a>申请SSL证书</h3><p>SSL证书可以在数据传输的过程中对其进行加密和隐藏，可以极大地提高数据传输的安全性。拥有SSL证书的网站的请求头都是<code>https</code>，并且在链接旁边会出现一把小锁。但是，SSL证书并不是所有网站都必须的，这视你的需要而定。比如，微信小程序的服务器就必须要有域名和SSL证书。另外，出于信息传输的安全性方面的考虑，有SSL证书还是显得更为妥当和专业一点。</p>\n<p>现在市面上各大云服务器提供商也都提供配套的SSL证书申请服务，一般都是提供企业级的证书，价格比较昂贵。但是同时网络上也有一些免费的SSL证书服务可以选择。下面还是以华为云的平台为例，简单说明一下如何申请SSL证书。</p>\n<p>首先在华为云页面的导航栏的搜索框内搜索“免费证书“，然后点击<a href=\"https://marketplace.huaweicloud.com/product/00301-315148-0--0\">亚洲诚信域名型DV单域名SSL证书–免费证书</a>，可以看到证书的价格是0.00元。点击“立即购买”。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/buy_ssl.png\" alt=\"购买SSL证书\"></p>\n<p>完成购买后请不要立即关闭页面，页面中的订单号在之后还需要用到。尔后，系统会发送”HuaweiCloud账户申请”邮件至用户邮箱，即你在华为云的注册邮箱。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/request_account.png\" alt=\"HuaweiCloud账户申请\"></p>\n<p>点击邮件中的登录地址进入系统，并使用邮件提供的账号和初始密码进行登录。登入系统后请修改你的初始密码，然后请根据华为云中给你提供的订单号在该系统中查询你的订单。查询到你的订单以后，需要你补充一些信息，请如实填写。系统会要你填写公司信息，如果只是个人网站，那么公司名称直接填写你的名字即可，公司地址就填写你的住址。</p>\n<p>填写完成后会进入审核阶段，系统会给你发送一封邮件。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/check.png\" alt=\"证书审核\"></p>\n<p>根据邮件的提示，需要在记录集中添加新的内容。请根据<a href=\"#1\">前文</a>所述方法，将邮件中的内容添加至新的记录集。填写方法如下图所示。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/modify_record.png\" alt=\"填写记录集\"></p>\n<p>填写完成后，可以在本地电脑的终端里输入<code>nslookup -querytype=txt 你的域名</code>来测试记录集是否生效。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/test_record.png\" alt=\"测试记录集\"></p>\n<p>一般来说，记录集生效后10分钟以内证书就会颁发了。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/issue.png\" alt=\"证书颁发\"></p>\n<h3 id=\"SSL证书部署\"><a href=\"#SSL证书部署\" class=\"headerlink\" title=\"SSL证书部署\"></a>SSL证书部署</h3><p>接下来我们要把SSL证书部署到我们的服务器上。</p>\n<p>在收到的“证书颁发”的邮件的底部有一条链接，点击这条链接，进入证书管理系统。登录系统，在左侧导航栏中点击“SSL证书”，再点击“预览”，再在右侧的“信息预览”中点击“下载最新证书“。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/download_cert.png\" alt=\"下载证书\"></p>\n<p>在弹出的对话框内，选择证书格式为“PEM(适用于Nginx,SLB)”，输入你的订单密码。证书密码可以留空。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/download_cert1.png\" alt=\"下载证书\"></p>\n<p>下载完成后，解压下载的压缩包，需要输入你的订单密码（如果你没有设置证书密码）。解压以后可以得到下图两个文件。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/unzip_cert.png\" alt=\"解压缩\"></p>\n<p>接下来，打开你的终端，按顺序输入下列命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh 你的公网IP #ssh登录，输入你的密码</span><br><span class=\"line\">cd /usr/local/nginx #切换到nginx的安装目录</span><br><span class=\"line\">mkdir ./cert #创建一个新文件夹cert用于存放你的证书</span><br><span class=\"line\">exit #断开与服务器的连接</span><br><span class=\"line\">scp 文件的路径/你的域名.key 你的服务器用户名@你的服务器IP地址:./cert #将.key文件上传到你的服务器的指定目录下</span><br><span class=\"line\">scp 文件的路径/你的域名.crt 你的服务器用户名@你的服务器IP地址:./cert #将.crt文件上传到你的服务器的指定目录下</span><br></pre></td></tr></table></figure>\n\n<p>接下来我们需要修改nginx的配置文件。参考<a href=\"#2\">前文</a>所述方法打开nginx的配置文件。先将你之前插入的内容删除或者使用<code>#</code>注释掉，然后在最后一个大括号前插入以下内容：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">         <span class=\"attribute\">listen</span>       <span class=\"number\">443</span> ssl;</span><br><span class=\"line\">         <span class=\"attribute\">server_name</span>  example.com; <span class=\"comment\">#你证书绑定的域名;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">ssl_certificate</span>      /usr/local/nginx/cert/你的域名.crt;</span><br><span class=\"line\">        <span class=\"attribute\">ssl_certificate_key</span>  /usr/local/nginx/cert/你的域名.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">ssl_session_cache</span>    shared:SSL:<span class=\"number\">1m</span>;</span><br><span class=\"line\">        <span class=\"attribute\">ssl_session_timeout</span>  <span class=\"number\">5m</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">ssl_ciphers</span>  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">        <span class=\"attribute\">ssl_prefer_server_ciphers</span>  <span class=\"literal\">on</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">            <span class=\"attribute\">index</span> index.htm index.html; <span class=\"comment\">#指定默认文件。</span></span><br><span class=\"line\">                    <span class=\"attribute\">root</span> html; <span class=\"comment\">#指定网站根目录。</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"section\">server</span> &#123; <span class=\"comment\">#将你的80端口重定向至433端口，即强制使用https访问</span></span><br><span class=\"line\">              <span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">              server_name; example.com; <span class=\"comment\">#你的域名</span></span><br><span class=\"line\">                <span class=\"attribute\">rewrite</span><span class=\"regexp\"> ^/(.*)$</span> https://example.com:443/<span class=\"variable\">$1</span> <span class=\"literal\">permanent</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将文件保存以后重启nginx服务。</p>\n<p>重启以后你可能会遇到这样的问题：<code>**unknown directive “ssl” in /usr/local/nginx/conf/nginx.conf:121**</code>，这是因为你在安装nginx时，没有编译SSL模块。你可以在终端里按照下述步骤解决<a href=\"https://blog.csdn.net/qq_26369317/article/details/102863613\">^ 3</a>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ../nginx-1.16.1 #进入到nginx的源码包的目录下</span><br><span class=\"line\">./configure --with-http_ssl_module #带参数执行程序</span><br><span class=\"line\">make #编译</span><br><span class=\"line\">cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx_bak #备份旧的nginx</span><br><span class=\"line\">cp ./objs/nginx /usr/local/nginx/sbin/ #然后将新的nginx的程序复制一份</span><br><span class=\"line\">cd /usr/local/nginx/sbin/ #切换到sbin目录</span><br><span class=\"line\">./nginx -s reload #重启nginx服务</span><br></pre></td></tr></table></figure>\n\n<p>如果重启成功的话，打开浏览器访问你的域名，这时候应该可以在链接旁边看到一个小锁了！</p>\n"},{"title":"瘦子增重教程","date":"2021-08-27T02:50:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/saitama.jpeg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/saitama.jpeg","excerpt":"整理自B站UP卓叔增重。","_content":"\n<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n下面的内容整理自B站UP<a href=\"https://space.bilibili.com/22423090/channel/detail?cid=111163\">卓叔增重</a>。\n</div>\n</article>\n\n# 基础知识\n\n## 为什么吃不胖？\n\n### 原因\n\n- 基因问题：\n  - 骨架小，基础体型就显瘦\n  - 激素分泌，使得代谢大于吸收\n- 饮食习惯导致的胃口小，挑食\n- 身体不需要太多的能量，于是多余的营养便通过代谢消耗\n\n### 关于吸收问题\n\n如果没有肠胃疾病，一般来说吸收都不会有问题，也不需要用中药调理。\n\n## 力量训练的重要性\n\n### 光吃不练可行吗？\n\n人类的脂肪倾向于堆积在腹部和臀部，如果光吃不练，可能会形成四肢瘦、肚子圆的体型。脂肪的增长位置不可控，而肌肉的增长位置是可控的。肌肉的增长需要力量训练来刺激。\n\n### 可以做有氧运动吗？\n\n跑步、游泳等有氧运动，长时间下对身体能量的消耗很大。瘦子本身就缺乏能量，做有氧运动很可能得不偿失。\n\n## 增肌原理与原则\n\n### 肌肉的超量恢复\n\n力量训练的时候会撕裂肌纤维，这是微小的损伤，不必担心。撕裂的肌纤维在休息时会自动修复，它不但会恢复到原来的水平，还会在原基础上有所增加。所以，需要通过力量训练来不断刺激肌肉生长。\n\n### 练大肌群\n\n- 大肌群指胸背臀腿这些区域的肌肉，覆盖面大且肌肉量占比大，新手练习这些区域容易出效果。此外，肩部的三角肌虽然属于小肌群，但是由于它生长在身体两侧，对肩宽有着显著影响，同样有必要练习。\n- 大肌群的训练会带动小肌群的增长\n\n### 上大重量\n\n肌纤维分为红肌纤维和白肌纤维，两者的区别如下表所示：\n\n| 肌肉类型 |                  特点                  |\n| :------: | :------------------------------------: |\n| 红肌纤维 | 力量小、耐力强、体积小、体积增长潜力小 |\n| 白肌纤维 | 力量大、耐力差、体积大、体积增长潜力大 |\n\n瘦子增肌需要通过力量训练把白肌纤维练大，多次重复小重量的训练无法刺激到白肌纤维。\n\n### 做复合动作\n\n- 复合动作：使用多块肌肉，多个关节才能完成的动作，如卧推、推举、俯卧撑、引体向上、划船、深蹲、硬拉等\n- 孤立动作：单关节，单肌肉就能完成的动作，如哑铃弯举，侧平举等\n\n复合动作是大肌群带动小肌群的动作，适合大重量训练，练习效率高，增肌效果好。但是孤立动作同样重要，可以精准覆盖复合动作照顾不到的部位。\n\n### 自由重量\n\n新手建议使用自由重量（哑铃、杠铃等），而少使用固定器械。理由如下：\n\n- 灵活性：固定器械轨迹固定，而自由重量可以微调角度，增强刺激，效果更好\n- 安全性：可以锻炼肌肉的稳定性和控制力，从最轻的自由重量开始即可，循序渐进增强肌肉的稳定性，防止受伤\n\n# 训练计划参考\n\n## 装备\n\n- 建议穿硬底鞋，如训练鞋、板鞋，或者赤足也可以\n- 可以购入手套防止疼痛\n- 耳机（可选）\n\n## 热身\n\n模仿体育课上课前的动作，慢跑5到10分钟，做一下准备运动，活动开筋骨。\n\n## 双分化双循环训练\n\n将身体分为躯干和四肢，一周四练，躯干和四肢分别练两天。可以参考下面的计划：\n\n|   周一   |   周二   | 周三 |   周四   |   周五   | 周六 | 周日 |\n| :------: | :------: | :--: | :------: | :------: | :--: | :--: |\n| 躯干训练 | 四肢训练 | 休息 | 躯干训练 | 四肢训练 | 休息 | 休息 |\n\n其中，躯干训练包含的内容如下：\n\n- 胸大肌\n- 背部肌群\n\n四肢训练包含的内容如下：\n\n- 臀腿肌群\n- 三角肌中后\n- 肱二头肌\n\n## 胸背训练动作\n\n### 哑铃卧推（胸）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             8              |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n使用自由重量。收紧肩胛骨，仰躺在卧推椅上，稍微收下肩部。抓住哑铃，手臂伸直垂直举向上。然后让哑铃缓慢下降，再用力往上推。可以想象手肘把两臂往中间推，重点感受胸部的挤压感。如力量足够，可以考虑上更大重量或使用杠铃卧推。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n### 引体向上（背）\n\n| 要点 |            |\n| :--: | :--------: |\n| 组数 |    不限    |\n| 次数 |     30     |\n| 间歇 | 歇够了再拉 |\n| 练法 |     无     |\n\n双手比肩略宽抓握吊杆，身体挺直，下压肩胛骨，然后用力将身体拉上去，再缓慢放下。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n勿耸肩伸头，勿后仰太多，勿只做半程。\n</div>\n</article>\n\n### 高位下拉（背）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             12             |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n该动作为引体向上的简单版，若引体向上难以完成可以选择该动作。动作要点与引体向上接近。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n### 上斜卧推（胸）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             8              |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n可以使用杠铃或者哑铃，也可以使用史密斯机。先收紧肩胛骨，仰躺在斜放的卧推椅上。双手抓住哑铃垂直上举，然后有控制地缓慢下放，然后再缓慢往上推。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n### 坐姿划船（背）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             12             |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n坐在凳子上，双脚踩实地面，挺直腰背，核心收紧。双手后拉，然后缓慢有控制地向下放。身体可以小幅度摆动。在后拉的过程中，后背要使劲夹住，这样才能练出感觉。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n身体不要大幅度晃动。\n</div>\n</article>\n\n> 如果你的体力充足，可以继续完成下面的两个孤立动作。\n\n### 绳索夹胸（胸）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |          15~20           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n可以使用龙门架或者夹胸器械完成该动作。该动作可以帮助新手快速找到胸部发力的感觉，而且不会使得手臂疲劳。注意肩胛骨保持收紧，想象把手臂往中间夹。\n\n### 单臂哑铃划船（背）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |          12~15           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n一只脚踩在地面上，另一腿跪在凳子上。在跪着的腿同侧的手向身体另一侧前伸并抓住凳子边沿，另一只手抓住哑铃向上反复拉动。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要左右晃动。</div></article>\n\n训练完要进行放松。\n\n## 四肢训练动作\n\n### 深蹲（腿）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             8              |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n新手可以从高脚杯深蹲开始。双手将哑铃的一片托举在胸前，双脚略宽于肩站立，可以由轻微外八。臀部后推，膝盖往两边打开，膝盖往脚尖方向微微滑动，顺势蹲下。然后大腿和臀部发力，用力站起来。如果有能力可以上哑铃或者杠铃。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>重心放在足弓处，腰背挺成一直线，膝盖朝向同脚尖，膝盖略微超脚尖。</div></article>\n\n### 半程硬拉（腿）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             12             |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n双手握住杠铃或者哑铃自然垂下，挺直腰背，核心收紧。然后缓缓向前俯身放下，再用力地把杠铃拉起来。拉起的过程中用臀部发力，腰腹核心需要收紧。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>屈髋俯身而不要弯腰。</div></article>\n\n### 侧平举（肩）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            4             |\n| 次数 |         15~20次          |\n| 间歇 |         30~45秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n双手握住哑铃在身体两侧，身体站直，把哑铃往两边抬起直到与肩部平齐，然后便可以有控制地缓慢下放。动作做得越稳越好，一开始可以用最轻的重量。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要前后晃动。</div></article>\n\n### 面拉（肩）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            4             |\n| 次数 |         12~15次          |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n把手上的绳索以往后拉，往外旋的方式拉近自己的脸部，\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>手肘不要低于肩，双手不要低于手肘。</div></article>\n\n### 杠铃弯举（手臂）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |           12次           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n站稳后手臂不要乱摆，反复弯举即可。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>动作一定要做完全程。</div></article>\n\n### 锤式弯举（手臂）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |           12次           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n双手拿着哑铃，左右交替将哑铃弯举到胸前。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要晃动。</div></article>\n\n训练完要进行放松。 \n\n## 如何判断训练是否有效\n\n### 力竭\n\n首先是看是否力竭，也就是同组中做一个动作直到完全没有力气。孤立动作可以做到力竭，但是一些大肌群的复合动作，如深蹲、硬拉、划船等，就不建议做到每组力竭 。如果目标肌肉酸痛的话，那么训练是有效果的。\n\n### 负荷渐进\n\n其次就是负荷渐进。如果一次训练中的某组动作可以高质量完成，下一次的训练中就可以增加重量，或者略微增加每组中的次数（二者选其一）。\n\n# 增重饮食\n\n## 增重饮食的原理与原则\n\n### 饮食对增重的重要性\n\n根据肌肉超量恢复的原理，肌肉在训练轻微损伤后会变弱。如果没有给肌肉提供修复增长的养料，那么肌肉只会越变越弱，人会越来越瘦。所谓**三分练，七分吃**。\n\n### 饮食中的关键成分\n\n#### 蛋白质\n\n蛋白质是肌肉生长的原料。在训练强度足够的情况下，建议每天每公斤体重摄入1.5~2g蛋白质，可以折中取1.8g。\n\n肉、蛋、奶、豆类中含有的蛋白质比较丰富。增肌推荐食用动物蛋白。\n\n#### 碳水化合物\n\n碳水是肌肉生长的燃料，为肌肉生长提供能量。对基础代谢高的瘦子，增重更需要摄入足够的碳水化合物。建议每天每公斤体重摄入6g碳水化合物。但是这个值不是固定的，如果消耗比较大，那么可能需要每天每公斤摄入8g或以上的碳水化合物，体重才有可能增加。\n\n增肌粉中含有不少的碳水化合物，对于瘦子来说比蛋白粉更加友好。\n\n主食类（米、面），淀粉作物（土豆、红薯、香蕉）中含有较多的碳水化合物。\n\n#### 脂肪\n\n脂肪不需要额外补充。建议多摄入不饱和脂肪酸，这些不饱和脂肪酸可以通过坚果、鱼油等摄入。\n\n## 饮食计划\n\n### 精确记录营养摄入\n\n饮食不能凭感觉，必须通过计算来判断吃得够不够。可以通过估算食物重量，再使用APP查询的方式来大致计算营养物质的摄入量。在熟练后只通过估算就可以知道营养的摄入量。\n\n### 饮食计划参考\n\n仅仅靠一日三餐是无法满足上面所要求的营养摄入量的，因此需要加餐。\n\n饮食计划的原则是：**每三小时左右吃一顿**。一般来说，早饭与午饭、午饭与晚饭之间可以进行加餐，晚上睡前两到三个小时可以吃宵夜。\n\n按照上面的计划，每天一共吃六餐饭。即便六餐饭每餐都吃六到七分饱，也会比一日三顿饭吃撑吃得要多。等体重增长后胃口变大，就不需要再一日吃六餐饭来维持身材了。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>饮食计划一定要根据自身条件来制定，遵循循序渐进的原则，一点点加量。</div></article>\n\n#### 早餐\n\n早餐是最重要的一餐，**增重必须要吃早餐**。早餐的碳水和蛋白质要管够，而且量要足够大。鸡蛋是最好的补充蛋白质的食物。\n\n#### 午餐与晚餐\n\n可以考虑以两份肉菜，一份青菜，两碗饭的量来吃。肉类主要补充蛋白质，青菜主要补充膳食纤维，米饭补充碳水。\n\n#### 加餐\n\n加餐的食物多样，面包，鸡蛋，香蕉等均可作为加餐食物。\n\n### 判断营养摄入是否充足的办法\n\n可以通过观察自己的体重来判断。如果体重是在逐步上升的，那么就说明你的碳水摄入是基本合理的。但是无论如何，蛋白质的摄入量一定要足够。\n\n### 关于补剂\n\n补剂的作用是补充蛋白质（或者蛋白质+碳水）。如果每天正常吃饭已经达到了要求的营养物质摄入量，那么就不需要喝补剂。\n\n# 休息与恢复\n\n## 休息的重要性\n\n根据肌肉超量恢复的原理，可以在肌肉基本恢复后的上升期安排下一次的训练。如果肌肉还没有完全恢复就又开始训练，那么只会加重肌肉的损伤，导致越练越差。\n\n## 休息恢复的安排\n\n### 短期\n\n短期的休息恢复要遵循下面两个原则：\n\n- 连续训练两到三天，要彻底休息一天\n- 同一块肌肉不要连续安排两天训练\n\n### 长期\n\n长期训练会导致疲劳积累，因此每两到三个月可以安排一个恢复周。在恢复周中，可以完全不练，也可以训练量减半。\n\n### 睡眠\n\n熬夜会导致皮质醇分泌紊乱，甚至会导致内分泌失调。增肌过程中万万不可以熬夜。\n\n如果因为运动导致睡不着，可以尝试将训练时间提前。睡前可以做一些放松神经的事情，建议不要玩手机。\n","source":"_posts/瘦子增重教程.md","raw":"---\ntitle: 瘦子增重教程\ndate: 2021-08-27 10:50:00\ncategories: \n\t- [Others]\n\t#- [cate2]\n\t#...\ntags: \n\t- Life\n\t- Exercise\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/saitama.jpeg\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/saitama.jpeg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 整理自B站UP卓叔增重。\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n下面的内容整理自B站UP<a href=\"https://space.bilibili.com/22423090/channel/detail?cid=111163\">卓叔增重</a>。\n</div>\n</article>\n\n# 基础知识\n\n## 为什么吃不胖？\n\n### 原因\n\n- 基因问题：\n  - 骨架小，基础体型就显瘦\n  - 激素分泌，使得代谢大于吸收\n- 饮食习惯导致的胃口小，挑食\n- 身体不需要太多的能量，于是多余的营养便通过代谢消耗\n\n### 关于吸收问题\n\n如果没有肠胃疾病，一般来说吸收都不会有问题，也不需要用中药调理。\n\n## 力量训练的重要性\n\n### 光吃不练可行吗？\n\n人类的脂肪倾向于堆积在腹部和臀部，如果光吃不练，可能会形成四肢瘦、肚子圆的体型。脂肪的增长位置不可控，而肌肉的增长位置是可控的。肌肉的增长需要力量训练来刺激。\n\n### 可以做有氧运动吗？\n\n跑步、游泳等有氧运动，长时间下对身体能量的消耗很大。瘦子本身就缺乏能量，做有氧运动很可能得不偿失。\n\n## 增肌原理与原则\n\n### 肌肉的超量恢复\n\n力量训练的时候会撕裂肌纤维，这是微小的损伤，不必担心。撕裂的肌纤维在休息时会自动修复，它不但会恢复到原来的水平，还会在原基础上有所增加。所以，需要通过力量训练来不断刺激肌肉生长。\n\n### 练大肌群\n\n- 大肌群指胸背臀腿这些区域的肌肉，覆盖面大且肌肉量占比大，新手练习这些区域容易出效果。此外，肩部的三角肌虽然属于小肌群，但是由于它生长在身体两侧，对肩宽有着显著影响，同样有必要练习。\n- 大肌群的训练会带动小肌群的增长\n\n### 上大重量\n\n肌纤维分为红肌纤维和白肌纤维，两者的区别如下表所示：\n\n| 肌肉类型 |                  特点                  |\n| :------: | :------------------------------------: |\n| 红肌纤维 | 力量小、耐力强、体积小、体积增长潜力小 |\n| 白肌纤维 | 力量大、耐力差、体积大、体积增长潜力大 |\n\n瘦子增肌需要通过力量训练把白肌纤维练大，多次重复小重量的训练无法刺激到白肌纤维。\n\n### 做复合动作\n\n- 复合动作：使用多块肌肉，多个关节才能完成的动作，如卧推、推举、俯卧撑、引体向上、划船、深蹲、硬拉等\n- 孤立动作：单关节，单肌肉就能完成的动作，如哑铃弯举，侧平举等\n\n复合动作是大肌群带动小肌群的动作，适合大重量训练，练习效率高，增肌效果好。但是孤立动作同样重要，可以精准覆盖复合动作照顾不到的部位。\n\n### 自由重量\n\n新手建议使用自由重量（哑铃、杠铃等），而少使用固定器械。理由如下：\n\n- 灵活性：固定器械轨迹固定，而自由重量可以微调角度，增强刺激，效果更好\n- 安全性：可以锻炼肌肉的稳定性和控制力，从最轻的自由重量开始即可，循序渐进增强肌肉的稳定性，防止受伤\n\n# 训练计划参考\n\n## 装备\n\n- 建议穿硬底鞋，如训练鞋、板鞋，或者赤足也可以\n- 可以购入手套防止疼痛\n- 耳机（可选）\n\n## 热身\n\n模仿体育课上课前的动作，慢跑5到10分钟，做一下准备运动，活动开筋骨。\n\n## 双分化双循环训练\n\n将身体分为躯干和四肢，一周四练，躯干和四肢分别练两天。可以参考下面的计划：\n\n|   周一   |   周二   | 周三 |   周四   |   周五   | 周六 | 周日 |\n| :------: | :------: | :--: | :------: | :------: | :--: | :--: |\n| 躯干训练 | 四肢训练 | 休息 | 躯干训练 | 四肢训练 | 休息 | 休息 |\n\n其中，躯干训练包含的内容如下：\n\n- 胸大肌\n- 背部肌群\n\n四肢训练包含的内容如下：\n\n- 臀腿肌群\n- 三角肌中后\n- 肱二头肌\n\n## 胸背训练动作\n\n### 哑铃卧推（胸）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             8              |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n使用自由重量。收紧肩胛骨，仰躺在卧推椅上，稍微收下肩部。抓住哑铃，手臂伸直垂直举向上。然后让哑铃缓慢下降，再用力往上推。可以想象手肘把两臂往中间推，重点感受胸部的挤压感。如力量足够，可以考虑上更大重量或使用杠铃卧推。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n### 引体向上（背）\n\n| 要点 |            |\n| :--: | :--------: |\n| 组数 |    不限    |\n| 次数 |     30     |\n| 间歇 | 歇够了再拉 |\n| 练法 |     无     |\n\n双手比肩略宽抓握吊杆，身体挺直，下压肩胛骨，然后用力将身体拉上去，再缓慢放下。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n勿耸肩伸头，勿后仰太多，勿只做半程。\n</div>\n</article>\n\n### 高位下拉（背）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             12             |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n该动作为引体向上的简单版，若引体向上难以完成可以选择该动作。动作要点与引体向上接近。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n### 上斜卧推（胸）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             8              |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n可以使用杠铃或者哑铃，也可以使用史密斯机。先收紧肩胛骨，仰躺在斜放的卧推椅上。双手抓住哑铃垂直上举，然后有控制地缓慢下放，然后再缓慢往上推。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n### 坐姿划船（背）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             12             |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n坐在凳子上，双脚踩实地面，挺直腰背，核心收紧。双手后拉，然后缓慢有控制地向下放。身体可以小幅度摆动。在后拉的过程中，后背要使劲夹住，这样才能练出感觉。\n\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n身体不要大幅度晃动。\n</div>\n</article>\n\n> 如果你的体力充足，可以继续完成下面的两个孤立动作。\n\n### 绳索夹胸（胸）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |          15~20           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n可以使用龙门架或者夹胸器械完成该动作。该动作可以帮助新手快速找到胸部发力的感觉，而且不会使得手臂疲劳。注意肩胛骨保持收紧，想象把手臂往中间夹。\n\n### 单臂哑铃划船（背）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |          12~15           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n一只脚踩在地面上，另一腿跪在凳子上。在跪着的腿同侧的手向身体另一侧前伸并抓住凳子边沿，另一只手抓住哑铃向上反复拉动。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要左右晃动。</div></article>\n\n训练完要进行放松。\n\n## 四肢训练动作\n\n### 深蹲（腿）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             8              |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n新手可以从高脚杯深蹲开始。双手将哑铃的一片托举在胸前，双脚略宽于肩站立，可以由轻微外八。臀部后推，膝盖往两边打开，膝盖往脚尖方向微微滑动，顺势蹲下。然后大腿和臀部发力，用力站起来。如果有能力可以上哑铃或者杠铃。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>重心放在足弓处，腰背挺成一直线，膝盖朝向同脚尖，膝盖略微超脚尖。</div></article>\n\n### 半程硬拉（腿）\n\n| 要点 |                            |\n| :--: | :------------------------: |\n| 组数 |             4              |\n| 次数 |             12             |\n| 间歇 |          1~2分钟           |\n| 练法 | 重量选择要求在最后一组力竭 |\n\n双手握住杠铃或者哑铃自然垂下，挺直腰背，核心收紧。然后缓缓向前俯身放下，再用力地把杠铃拉起来。拉起的过程中用臀部发力，腰腹核心需要收紧。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>屈髋俯身而不要弯腰。</div></article>\n\n### 侧平举（肩）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            4             |\n| 次数 |         15~20次          |\n| 间歇 |         30~45秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n双手握住哑铃在身体两侧，身体站直，把哑铃往两边抬起直到与肩部平齐，然后便可以有控制地缓慢下放。动作做得越稳越好，一开始可以用最轻的重量。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要前后晃动。</div></article>\n\n### 面拉（肩）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            4             |\n| 次数 |         12~15次          |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n把手上的绳索以往后拉，往外旋的方式拉近自己的脸部，\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>手肘不要低于肩，双手不要低于手肘。</div></article>\n\n### 杠铃弯举（手臂）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |           12次           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n站稳后手臂不要乱摆，反复弯举即可。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>动作一定要做完全程。</div></article>\n\n### 锤式弯举（手臂）\n\n| 要点 |                          |\n| :--: | :----------------------: |\n| 组数 |            3             |\n| 次数 |           12次           |\n| 间歇 |         45~60秒          |\n| 练法 | 重量选择要求在每一组力竭 |\n\n双手拿着哑铃，左右交替将哑铃弯举到胸前。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要晃动。</div></article>\n\n训练完要进行放松。 \n\n## 如何判断训练是否有效\n\n### 力竭\n\n首先是看是否力竭，也就是同组中做一个动作直到完全没有力气。孤立动作可以做到力竭，但是一些大肌群的复合动作，如深蹲、硬拉、划船等，就不建议做到每组力竭 。如果目标肌肉酸痛的话，那么训练是有效果的。\n\n### 负荷渐进\n\n其次就是负荷渐进。如果一次训练中的某组动作可以高质量完成，下一次的训练中就可以增加重量，或者略微增加每组中的次数（二者选其一）。\n\n# 增重饮食\n\n## 增重饮食的原理与原则\n\n### 饮食对增重的重要性\n\n根据肌肉超量恢复的原理，肌肉在训练轻微损伤后会变弱。如果没有给肌肉提供修复增长的养料，那么肌肉只会越变越弱，人会越来越瘦。所谓**三分练，七分吃**。\n\n### 饮食中的关键成分\n\n#### 蛋白质\n\n蛋白质是肌肉生长的原料。在训练强度足够的情况下，建议每天每公斤体重摄入1.5~2g蛋白质，可以折中取1.8g。\n\n肉、蛋、奶、豆类中含有的蛋白质比较丰富。增肌推荐食用动物蛋白。\n\n#### 碳水化合物\n\n碳水是肌肉生长的燃料，为肌肉生长提供能量。对基础代谢高的瘦子，增重更需要摄入足够的碳水化合物。建议每天每公斤体重摄入6g碳水化合物。但是这个值不是固定的，如果消耗比较大，那么可能需要每天每公斤摄入8g或以上的碳水化合物，体重才有可能增加。\n\n增肌粉中含有不少的碳水化合物，对于瘦子来说比蛋白粉更加友好。\n\n主食类（米、面），淀粉作物（土豆、红薯、香蕉）中含有较多的碳水化合物。\n\n#### 脂肪\n\n脂肪不需要额外补充。建议多摄入不饱和脂肪酸，这些不饱和脂肪酸可以通过坚果、鱼油等摄入。\n\n## 饮食计划\n\n### 精确记录营养摄入\n\n饮食不能凭感觉，必须通过计算来判断吃得够不够。可以通过估算食物重量，再使用APP查询的方式来大致计算营养物质的摄入量。在熟练后只通过估算就可以知道营养的摄入量。\n\n### 饮食计划参考\n\n仅仅靠一日三餐是无法满足上面所要求的营养摄入量的，因此需要加餐。\n\n饮食计划的原则是：**每三小时左右吃一顿**。一般来说，早饭与午饭、午饭与晚饭之间可以进行加餐，晚上睡前两到三个小时可以吃宵夜。\n\n按照上面的计划，每天一共吃六餐饭。即便六餐饭每餐都吃六到七分饱，也会比一日三顿饭吃撑吃得要多。等体重增长后胃口变大，就不需要再一日吃六餐饭来维持身材了。\n\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>饮食计划一定要根据自身条件来制定，遵循循序渐进的原则，一点点加量。</div></article>\n\n#### 早餐\n\n早餐是最重要的一餐，**增重必须要吃早餐**。早餐的碳水和蛋白质要管够，而且量要足够大。鸡蛋是最好的补充蛋白质的食物。\n\n#### 午餐与晚餐\n\n可以考虑以两份肉菜，一份青菜，两碗饭的量来吃。肉类主要补充蛋白质，青菜主要补充膳食纤维，米饭补充碳水。\n\n#### 加餐\n\n加餐的食物多样，面包，鸡蛋，香蕉等均可作为加餐食物。\n\n### 判断营养摄入是否充足的办法\n\n可以通过观察自己的体重来判断。如果体重是在逐步上升的，那么就说明你的碳水摄入是基本合理的。但是无论如何，蛋白质的摄入量一定要足够。\n\n### 关于补剂\n\n补剂的作用是补充蛋白质（或者蛋白质+碳水）。如果每天正常吃饭已经达到了要求的营养物质摄入量，那么就不需要喝补剂。\n\n# 休息与恢复\n\n## 休息的重要性\n\n根据肌肉超量恢复的原理，可以在肌肉基本恢复后的上升期安排下一次的训练。如果肌肉还没有完全恢复就又开始训练，那么只会加重肌肉的损伤，导致越练越差。\n\n## 休息恢复的安排\n\n### 短期\n\n短期的休息恢复要遵循下面两个原则：\n\n- 连续训练两到三天，要彻底休息一天\n- 同一块肌肉不要连续安排两天训练\n\n### 长期\n\n长期训练会导致疲劳积累，因此每两到三个月可以安排一个恢复周。在恢复周中，可以完全不练，也可以训练量减半。\n\n### 睡眠\n\n熬夜会导致皮质醇分泌紊乱，甚至会导致内分泌失调。增肌过程中万万不可以熬夜。\n\n如果因为运动导致睡不着，可以尝试将训练时间提前。睡前可以做一些放松神经的事情，建议不要玩手机。\n","slug":"瘦子增重教程","published":1,"updated":"2021-11-29T12:31:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0b001u1q394vbe1cjm","content":"<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n下面的内容整理自B站UP<a href=\"https://space.bilibili.com/22423090/channel/detail?cid=111163\">卓叔增重</a>。\n</div>\n</article>\n\n<h1 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h1><h2 id=\"为什么吃不胖？\"><a href=\"#为什么吃不胖？\" class=\"headerlink\" title=\"为什么吃不胖？\"></a>为什么吃不胖？</h2><h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h3><ul>\n<li>基因问题：<ul>\n<li>骨架小，基础体型就显瘦</li>\n<li>激素分泌，使得代谢大于吸收</li>\n</ul>\n</li>\n<li>饮食习惯导致的胃口小，挑食</li>\n<li>身体不需要太多的能量，于是多余的营养便通过代谢消耗</li>\n</ul>\n<h3 id=\"关于吸收问题\"><a href=\"#关于吸收问题\" class=\"headerlink\" title=\"关于吸收问题\"></a>关于吸收问题</h3><p>如果没有肠胃疾病，一般来说吸收都不会有问题，也不需要用中药调理。</p>\n<h2 id=\"力量训练的重要性\"><a href=\"#力量训练的重要性\" class=\"headerlink\" title=\"力量训练的重要性\"></a>力量训练的重要性</h2><h3 id=\"光吃不练可行吗？\"><a href=\"#光吃不练可行吗？\" class=\"headerlink\" title=\"光吃不练可行吗？\"></a>光吃不练可行吗？</h3><p>人类的脂肪倾向于堆积在腹部和臀部，如果光吃不练，可能会形成四肢瘦、肚子圆的体型。脂肪的增长位置不可控，而肌肉的增长位置是可控的。肌肉的增长需要力量训练来刺激。</p>\n<h3 id=\"可以做有氧运动吗？\"><a href=\"#可以做有氧运动吗？\" class=\"headerlink\" title=\"可以做有氧运动吗？\"></a>可以做有氧运动吗？</h3><p>跑步、游泳等有氧运动，长时间下对身体能量的消耗很大。瘦子本身就缺乏能量，做有氧运动很可能得不偿失。</p>\n<h2 id=\"增肌原理与原则\"><a href=\"#增肌原理与原则\" class=\"headerlink\" title=\"增肌原理与原则\"></a>增肌原理与原则</h2><h3 id=\"肌肉的超量恢复\"><a href=\"#肌肉的超量恢复\" class=\"headerlink\" title=\"肌肉的超量恢复\"></a>肌肉的超量恢复</h3><p>力量训练的时候会撕裂肌纤维，这是微小的损伤，不必担心。撕裂的肌纤维在休息时会自动修复，它不但会恢复到原来的水平，还会在原基础上有所增加。所以，需要通过力量训练来不断刺激肌肉生长。</p>\n<h3 id=\"练大肌群\"><a href=\"#练大肌群\" class=\"headerlink\" title=\"练大肌群\"></a>练大肌群</h3><ul>\n<li>大肌群指胸背臀腿这些区域的肌肉，覆盖面大且肌肉量占比大，新手练习这些区域容易出效果。此外，肩部的三角肌虽然属于小肌群，但是由于它生长在身体两侧，对肩宽有着显著影响，同样有必要练习。</li>\n<li>大肌群的训练会带动小肌群的增长</li>\n</ul>\n<h3 id=\"上大重量\"><a href=\"#上大重量\" class=\"headerlink\" title=\"上大重量\"></a>上大重量</h3><p>肌纤维分为红肌纤维和白肌纤维，两者的区别如下表所示：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">肌肉类型</th>\n<th align=\"center\">特点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">红肌纤维</td>\n<td align=\"center\">力量小、耐力强、体积小、体积增长潜力小</td>\n</tr>\n<tr>\n<td align=\"center\">白肌纤维</td>\n<td align=\"center\">力量大、耐力差、体积大、体积增长潜力大</td>\n</tr>\n</tbody></table>\n<p>瘦子增肌需要通过力量训练把白肌纤维练大，多次重复小重量的训练无法刺激到白肌纤维。</p>\n<h3 id=\"做复合动作\"><a href=\"#做复合动作\" class=\"headerlink\" title=\"做复合动作\"></a>做复合动作</h3><ul>\n<li>复合动作：使用多块肌肉，多个关节才能完成的动作，如卧推、推举、俯卧撑、引体向上、划船、深蹲、硬拉等</li>\n<li>孤立动作：单关节，单肌肉就能完成的动作，如哑铃弯举，侧平举等</li>\n</ul>\n<p>复合动作是大肌群带动小肌群的动作，适合大重量训练，练习效率高，增肌效果好。但是孤立动作同样重要，可以精准覆盖复合动作照顾不到的部位。</p>\n<h3 id=\"自由重量\"><a href=\"#自由重量\" class=\"headerlink\" title=\"自由重量\"></a>自由重量</h3><p>新手建议使用自由重量（哑铃、杠铃等），而少使用固定器械。理由如下：</p>\n<ul>\n<li>灵活性：固定器械轨迹固定，而自由重量可以微调角度，增强刺激，效果更好</li>\n<li>安全性：可以锻炼肌肉的稳定性和控制力，从最轻的自由重量开始即可，循序渐进增强肌肉的稳定性，防止受伤</li>\n</ul>\n<h1 id=\"训练计划参考\"><a href=\"#训练计划参考\" class=\"headerlink\" title=\"训练计划参考\"></a>训练计划参考</h1><h2 id=\"装备\"><a href=\"#装备\" class=\"headerlink\" title=\"装备\"></a>装备</h2><ul>\n<li>建议穿硬底鞋，如训练鞋、板鞋，或者赤足也可以</li>\n<li>可以购入手套防止疼痛</li>\n<li>耳机（可选）</li>\n</ul>\n<h2 id=\"热身\"><a href=\"#热身\" class=\"headerlink\" title=\"热身\"></a>热身</h2><p>模仿体育课上课前的动作，慢跑5到10分钟，做一下准备运动，活动开筋骨。</p>\n<h2 id=\"双分化双循环训练\"><a href=\"#双分化双循环训练\" class=\"headerlink\" title=\"双分化双循环训练\"></a>双分化双循环训练</h2><p>将身体分为躯干和四肢，一周四练，躯干和四肢分别练两天。可以参考下面的计划：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">周一</th>\n<th align=\"center\">周二</th>\n<th align=\"center\">周三</th>\n<th align=\"center\">周四</th>\n<th align=\"center\">周五</th>\n<th align=\"center\">周六</th>\n<th align=\"center\">周日</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">躯干训练</td>\n<td align=\"center\">四肢训练</td>\n<td align=\"center\">休息</td>\n<td align=\"center\">躯干训练</td>\n<td align=\"center\">四肢训练</td>\n<td align=\"center\">休息</td>\n<td align=\"center\">休息</td>\n</tr>\n</tbody></table>\n<p>其中，躯干训练包含的内容如下：</p>\n<ul>\n<li>胸大肌</li>\n<li>背部肌群</li>\n</ul>\n<p>四肢训练包含的内容如下：</p>\n<ul>\n<li>臀腿肌群</li>\n<li>三角肌中后</li>\n<li>肱二头肌</li>\n</ul>\n<h2 id=\"胸背训练动作\"><a href=\"#胸背训练动作\" class=\"headerlink\" title=\"胸背训练动作\"></a>胸背训练动作</h2><h3 id=\"哑铃卧推（胸）\"><a href=\"#哑铃卧推（胸）\" class=\"headerlink\" title=\"哑铃卧推（胸）\"></a>哑铃卧推（胸）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>使用自由重量。收紧肩胛骨，仰躺在卧推椅上，稍微收下肩部。抓住哑铃，手臂伸直垂直举向上。然后让哑铃缓慢下降，再用力往上推。可以想象手肘把两臂往中间推，重点感受胸部的挤压感。如力量足够，可以考虑上更大重量或使用杠铃卧推。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n<h3 id=\"引体向上（背）\"><a href=\"#引体向上（背）\" class=\"headerlink\" title=\"引体向上（背）\"></a>引体向上（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">不限</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">30</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">歇够了再拉</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">无</td>\n</tr>\n</tbody></table>\n<p>双手比肩略宽抓握吊杆，身体挺直，下压肩胛骨，然后用力将身体拉上去，再缓慢放下。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n勿耸肩伸头，勿后仰太多，勿只做半程。\n</div>\n</article>\n\n<h3 id=\"高位下拉（背）\"><a href=\"#高位下拉（背）\" class=\"headerlink\" title=\"高位下拉（背）\"></a>高位下拉（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>该动作为引体向上的简单版，若引体向上难以完成可以选择该动作。动作要点与引体向上接近。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n<h3 id=\"上斜卧推（胸）\"><a href=\"#上斜卧推（胸）\" class=\"headerlink\" title=\"上斜卧推（胸）\"></a>上斜卧推（胸）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>可以使用杠铃或者哑铃，也可以使用史密斯机。先收紧肩胛骨，仰躺在斜放的卧推椅上。双手抓住哑铃垂直上举，然后有控制地缓慢下放，然后再缓慢往上推。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n<h3 id=\"坐姿划船（背）\"><a href=\"#坐姿划船（背）\" class=\"headerlink\" title=\"坐姿划船（背）\"></a>坐姿划船（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>坐在凳子上，双脚踩实地面，挺直腰背，核心收紧。双手后拉，然后缓慢有控制地向下放。身体可以小幅度摆动。在后拉的过程中，后背要使劲夹住，这样才能练出感觉。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n身体不要大幅度晃动。\n</div>\n</article>\n\n<blockquote>\n<p>如果你的体力充足，可以继续完成下面的两个孤立动作。</p>\n</blockquote>\n<h3 id=\"绳索夹胸（胸）\"><a href=\"#绳索夹胸（胸）\" class=\"headerlink\" title=\"绳索夹胸（胸）\"></a>绳索夹胸（胸）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">15~20</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>可以使用龙门架或者夹胸器械完成该动作。该动作可以帮助新手快速找到胸部发力的感觉，而且不会使得手臂疲劳。注意肩胛骨保持收紧，想象把手臂往中间夹。</p>\n<h3 id=\"单臂哑铃划船（背）\"><a href=\"#单臂哑铃划船（背）\" class=\"headerlink\" title=\"单臂哑铃划船（背）\"></a>单臂哑铃划船（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12~15</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>一只脚踩在地面上，另一腿跪在凳子上。在跪着的腿同侧的手向身体另一侧前伸并抓住凳子边沿，另一只手抓住哑铃向上反复拉动。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要左右晃动。</div></article>\n\n<p>训练完要进行放松。</p>\n<h2 id=\"四肢训练动作\"><a href=\"#四肢训练动作\" class=\"headerlink\" title=\"四肢训练动作\"></a>四肢训练动作</h2><h3 id=\"深蹲（腿）\"><a href=\"#深蹲（腿）\" class=\"headerlink\" title=\"深蹲（腿）\"></a>深蹲（腿）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>新手可以从高脚杯深蹲开始。双手将哑铃的一片托举在胸前，双脚略宽于肩站立，可以由轻微外八。臀部后推，膝盖往两边打开，膝盖往脚尖方向微微滑动，顺势蹲下。然后大腿和臀部发力，用力站起来。如果有能力可以上哑铃或者杠铃。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>重心放在足弓处，腰背挺成一直线，膝盖朝向同脚尖，膝盖略微超脚尖。</div></article>\n\n<h3 id=\"半程硬拉（腿）\"><a href=\"#半程硬拉（腿）\" class=\"headerlink\" title=\"半程硬拉（腿）\"></a>半程硬拉（腿）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>双手握住杠铃或者哑铃自然垂下，挺直腰背，核心收紧。然后缓缓向前俯身放下，再用力地把杠铃拉起来。拉起的过程中用臀部发力，腰腹核心需要收紧。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>屈髋俯身而不要弯腰。</div></article>\n\n<h3 id=\"侧平举（肩）\"><a href=\"#侧平举（肩）\" class=\"headerlink\" title=\"侧平举（肩）\"></a>侧平举（肩）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">15~20次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">30~45秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>双手握住哑铃在身体两侧，身体站直，把哑铃往两边抬起直到与肩部平齐，然后便可以有控制地缓慢下放。动作做得越稳越好，一开始可以用最轻的重量。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要前后晃动。</div></article>\n\n<h3 id=\"面拉（肩）\"><a href=\"#面拉（肩）\" class=\"headerlink\" title=\"面拉（肩）\"></a>面拉（肩）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12~15次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>把手上的绳索以往后拉，往外旋的方式拉近自己的脸部，</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>手肘不要低于肩，双手不要低于手肘。</div></article>\n\n<h3 id=\"杠铃弯举（手臂）\"><a href=\"#杠铃弯举（手臂）\" class=\"headerlink\" title=\"杠铃弯举（手臂）\"></a>杠铃弯举（手臂）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>站稳后手臂不要乱摆，反复弯举即可。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>动作一定要做完全程。</div></article>\n\n<h3 id=\"锤式弯举（手臂）\"><a href=\"#锤式弯举（手臂）\" class=\"headerlink\" title=\"锤式弯举（手臂）\"></a>锤式弯举（手臂）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>双手拿着哑铃，左右交替将哑铃弯举到胸前。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要晃动。</div></article>\n\n<p>训练完要进行放松。 </p>\n<h2 id=\"如何判断训练是否有效\"><a href=\"#如何判断训练是否有效\" class=\"headerlink\" title=\"如何判断训练是否有效\"></a>如何判断训练是否有效</h2><h3 id=\"力竭\"><a href=\"#力竭\" class=\"headerlink\" title=\"力竭\"></a>力竭</h3><p>首先是看是否力竭，也就是同组中做一个动作直到完全没有力气。孤立动作可以做到力竭，但是一些大肌群的复合动作，如深蹲、硬拉、划船等，就不建议做到每组力竭 。如果目标肌肉酸痛的话，那么训练是有效果的。</p>\n<h3 id=\"负荷渐进\"><a href=\"#负荷渐进\" class=\"headerlink\" title=\"负荷渐进\"></a>负荷渐进</h3><p>其次就是负荷渐进。如果一次训练中的某组动作可以高质量完成，下一次的训练中就可以增加重量，或者略微增加每组中的次数（二者选其一）。</p>\n<h1 id=\"增重饮食\"><a href=\"#增重饮食\" class=\"headerlink\" title=\"增重饮食\"></a>增重饮食</h1><h2 id=\"增重饮食的原理与原则\"><a href=\"#增重饮食的原理与原则\" class=\"headerlink\" title=\"增重饮食的原理与原则\"></a>增重饮食的原理与原则</h2><h3 id=\"饮食对增重的重要性\"><a href=\"#饮食对增重的重要性\" class=\"headerlink\" title=\"饮食对增重的重要性\"></a>饮食对增重的重要性</h3><p>根据肌肉超量恢复的原理，肌肉在训练轻微损伤后会变弱。如果没有给肌肉提供修复增长的养料，那么肌肉只会越变越弱，人会越来越瘦。所谓<strong>三分练，七分吃</strong>。</p>\n<h3 id=\"饮食中的关键成分\"><a href=\"#饮食中的关键成分\" class=\"headerlink\" title=\"饮食中的关键成分\"></a>饮食中的关键成分</h3><h4 id=\"蛋白质\"><a href=\"#蛋白质\" class=\"headerlink\" title=\"蛋白质\"></a>蛋白质</h4><p>蛋白质是肌肉生长的原料。在训练强度足够的情况下，建议每天每公斤体重摄入1.5~2g蛋白质，可以折中取1.8g。</p>\n<p>肉、蛋、奶、豆类中含有的蛋白质比较丰富。增肌推荐食用动物蛋白。</p>\n<h4 id=\"碳水化合物\"><a href=\"#碳水化合物\" class=\"headerlink\" title=\"碳水化合物\"></a>碳水化合物</h4><p>碳水是肌肉生长的燃料，为肌肉生长提供能量。对基础代谢高的瘦子，增重更需要摄入足够的碳水化合物。建议每天每公斤体重摄入6g碳水化合物。但是这个值不是固定的，如果消耗比较大，那么可能需要每天每公斤摄入8g或以上的碳水化合物，体重才有可能增加。</p>\n<p>增肌粉中含有不少的碳水化合物，对于瘦子来说比蛋白粉更加友好。</p>\n<p>主食类（米、面），淀粉作物（土豆、红薯、香蕉）中含有较多的碳水化合物。</p>\n<h4 id=\"脂肪\"><a href=\"#脂肪\" class=\"headerlink\" title=\"脂肪\"></a>脂肪</h4><p>脂肪不需要额外补充。建议多摄入不饱和脂肪酸，这些不饱和脂肪酸可以通过坚果、鱼油等摄入。</p>\n<h2 id=\"饮食计划\"><a href=\"#饮食计划\" class=\"headerlink\" title=\"饮食计划\"></a>饮食计划</h2><h3 id=\"精确记录营养摄入\"><a href=\"#精确记录营养摄入\" class=\"headerlink\" title=\"精确记录营养摄入\"></a>精确记录营养摄入</h3><p>饮食不能凭感觉，必须通过计算来判断吃得够不够。可以通过估算食物重量，再使用APP查询的方式来大致计算营养物质的摄入量。在熟练后只通过估算就可以知道营养的摄入量。</p>\n<h3 id=\"饮食计划参考\"><a href=\"#饮食计划参考\" class=\"headerlink\" title=\"饮食计划参考\"></a>饮食计划参考</h3><p>仅仅靠一日三餐是无法满足上面所要求的营养摄入量的，因此需要加餐。</p>\n<p>饮食计划的原则是：<strong>每三小时左右吃一顿</strong>。一般来说，早饭与午饭、午饭与晚饭之间可以进行加餐，晚上睡前两到三个小时可以吃宵夜。</p>\n<p>按照上面的计划，每天一共吃六餐饭。即便六餐饭每餐都吃六到七分饱，也会比一日三顿饭吃撑吃得要多。等体重增长后胃口变大，就不需要再一日吃六餐饭来维持身材了。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>饮食计划一定要根据自身条件来制定，遵循循序渐进的原则，一点点加量。</div></article>\n\n<h4 id=\"早餐\"><a href=\"#早餐\" class=\"headerlink\" title=\"早餐\"></a>早餐</h4><p>早餐是最重要的一餐，<strong>增重必须要吃早餐</strong>。早餐的碳水和蛋白质要管够，而且量要足够大。鸡蛋是最好的补充蛋白质的食物。</p>\n<h4 id=\"午餐与晚餐\"><a href=\"#午餐与晚餐\" class=\"headerlink\" title=\"午餐与晚餐\"></a>午餐与晚餐</h4><p>可以考虑以两份肉菜，一份青菜，两碗饭的量来吃。肉类主要补充蛋白质，青菜主要补充膳食纤维，米饭补充碳水。</p>\n<h4 id=\"加餐\"><a href=\"#加餐\" class=\"headerlink\" title=\"加餐\"></a>加餐</h4><p>加餐的食物多样，面包，鸡蛋，香蕉等均可作为加餐食物。</p>\n<h3 id=\"判断营养摄入是否充足的办法\"><a href=\"#判断营养摄入是否充足的办法\" class=\"headerlink\" title=\"判断营养摄入是否充足的办法\"></a>判断营养摄入是否充足的办法</h3><p>可以通过观察自己的体重来判断。如果体重是在逐步上升的，那么就说明你的碳水摄入是基本合理的。但是无论如何，蛋白质的摄入量一定要足够。</p>\n<h3 id=\"关于补剂\"><a href=\"#关于补剂\" class=\"headerlink\" title=\"关于补剂\"></a>关于补剂</h3><p>补剂的作用是补充蛋白质（或者蛋白质+碳水）。如果每天正常吃饭已经达到了要求的营养物质摄入量，那么就不需要喝补剂。</p>\n<h1 id=\"休息与恢复\"><a href=\"#休息与恢复\" class=\"headerlink\" title=\"休息与恢复\"></a>休息与恢复</h1><h2 id=\"休息的重要性\"><a href=\"#休息的重要性\" class=\"headerlink\" title=\"休息的重要性\"></a>休息的重要性</h2><p>根据肌肉超量恢复的原理，可以在肌肉基本恢复后的上升期安排下一次的训练。如果肌肉还没有完全恢复就又开始训练，那么只会加重肌肉的损伤，导致越练越差。</p>\n<h2 id=\"休息恢复的安排\"><a href=\"#休息恢复的安排\" class=\"headerlink\" title=\"休息恢复的安排\"></a>休息恢复的安排</h2><h3 id=\"短期\"><a href=\"#短期\" class=\"headerlink\" title=\"短期\"></a>短期</h3><p>短期的休息恢复要遵循下面两个原则：</p>\n<ul>\n<li>连续训练两到三天，要彻底休息一天</li>\n<li>同一块肌肉不要连续安排两天训练</li>\n</ul>\n<h3 id=\"长期\"><a href=\"#长期\" class=\"headerlink\" title=\"长期\"></a>长期</h3><p>长期训练会导致疲劳积累，因此每两到三个月可以安排一个恢复周。在恢复周中，可以完全不练，也可以训练量减半。</p>\n<h3 id=\"睡眠\"><a href=\"#睡眠\" class=\"headerlink\" title=\"睡眠\"></a>睡眠</h3><p>熬夜会导致皮质醇分泌紊乱，甚至会导致内分泌失调。增肌过程中万万不可以熬夜。</p>\n<p>如果因为运动导致睡不着，可以尝试将训练时间提前。睡前可以做一些放松神经的事情，建议不要玩手机。</p>\n","site":{"data":{}},"more":"<article class=\"message message-immersive is-link\">\n<div class=\"message-body\">\n<i class=\"fas fa-link mr-2\"></i>\n下面的内容整理自B站UP<a href=\"https://space.bilibili.com/22423090/channel/detail?cid=111163\">卓叔增重</a>。\n</div>\n</article>\n\n<h1 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h1><h2 id=\"为什么吃不胖？\"><a href=\"#为什么吃不胖？\" class=\"headerlink\" title=\"为什么吃不胖？\"></a>为什么吃不胖？</h2><h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h3><ul>\n<li>基因问题：<ul>\n<li>骨架小，基础体型就显瘦</li>\n<li>激素分泌，使得代谢大于吸收</li>\n</ul>\n</li>\n<li>饮食习惯导致的胃口小，挑食</li>\n<li>身体不需要太多的能量，于是多余的营养便通过代谢消耗</li>\n</ul>\n<h3 id=\"关于吸收问题\"><a href=\"#关于吸收问题\" class=\"headerlink\" title=\"关于吸收问题\"></a>关于吸收问题</h3><p>如果没有肠胃疾病，一般来说吸收都不会有问题，也不需要用中药调理。</p>\n<h2 id=\"力量训练的重要性\"><a href=\"#力量训练的重要性\" class=\"headerlink\" title=\"力量训练的重要性\"></a>力量训练的重要性</h2><h3 id=\"光吃不练可行吗？\"><a href=\"#光吃不练可行吗？\" class=\"headerlink\" title=\"光吃不练可行吗？\"></a>光吃不练可行吗？</h3><p>人类的脂肪倾向于堆积在腹部和臀部，如果光吃不练，可能会形成四肢瘦、肚子圆的体型。脂肪的增长位置不可控，而肌肉的增长位置是可控的。肌肉的增长需要力量训练来刺激。</p>\n<h3 id=\"可以做有氧运动吗？\"><a href=\"#可以做有氧运动吗？\" class=\"headerlink\" title=\"可以做有氧运动吗？\"></a>可以做有氧运动吗？</h3><p>跑步、游泳等有氧运动，长时间下对身体能量的消耗很大。瘦子本身就缺乏能量，做有氧运动很可能得不偿失。</p>\n<h2 id=\"增肌原理与原则\"><a href=\"#增肌原理与原则\" class=\"headerlink\" title=\"增肌原理与原则\"></a>增肌原理与原则</h2><h3 id=\"肌肉的超量恢复\"><a href=\"#肌肉的超量恢复\" class=\"headerlink\" title=\"肌肉的超量恢复\"></a>肌肉的超量恢复</h3><p>力量训练的时候会撕裂肌纤维，这是微小的损伤，不必担心。撕裂的肌纤维在休息时会自动修复，它不但会恢复到原来的水平，还会在原基础上有所增加。所以，需要通过力量训练来不断刺激肌肉生长。</p>\n<h3 id=\"练大肌群\"><a href=\"#练大肌群\" class=\"headerlink\" title=\"练大肌群\"></a>练大肌群</h3><ul>\n<li>大肌群指胸背臀腿这些区域的肌肉，覆盖面大且肌肉量占比大，新手练习这些区域容易出效果。此外，肩部的三角肌虽然属于小肌群，但是由于它生长在身体两侧，对肩宽有着显著影响，同样有必要练习。</li>\n<li>大肌群的训练会带动小肌群的增长</li>\n</ul>\n<h3 id=\"上大重量\"><a href=\"#上大重量\" class=\"headerlink\" title=\"上大重量\"></a>上大重量</h3><p>肌纤维分为红肌纤维和白肌纤维，两者的区别如下表所示：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">肌肉类型</th>\n<th align=\"center\">特点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">红肌纤维</td>\n<td align=\"center\">力量小、耐力强、体积小、体积增长潜力小</td>\n</tr>\n<tr>\n<td align=\"center\">白肌纤维</td>\n<td align=\"center\">力量大、耐力差、体积大、体积增长潜力大</td>\n</tr>\n</tbody></table>\n<p>瘦子增肌需要通过力量训练把白肌纤维练大，多次重复小重量的训练无法刺激到白肌纤维。</p>\n<h3 id=\"做复合动作\"><a href=\"#做复合动作\" class=\"headerlink\" title=\"做复合动作\"></a>做复合动作</h3><ul>\n<li>复合动作：使用多块肌肉，多个关节才能完成的动作，如卧推、推举、俯卧撑、引体向上、划船、深蹲、硬拉等</li>\n<li>孤立动作：单关节，单肌肉就能完成的动作，如哑铃弯举，侧平举等</li>\n</ul>\n<p>复合动作是大肌群带动小肌群的动作，适合大重量训练，练习效率高，增肌效果好。但是孤立动作同样重要，可以精准覆盖复合动作照顾不到的部位。</p>\n<h3 id=\"自由重量\"><a href=\"#自由重量\" class=\"headerlink\" title=\"自由重量\"></a>自由重量</h3><p>新手建议使用自由重量（哑铃、杠铃等），而少使用固定器械。理由如下：</p>\n<ul>\n<li>灵活性：固定器械轨迹固定，而自由重量可以微调角度，增强刺激，效果更好</li>\n<li>安全性：可以锻炼肌肉的稳定性和控制力，从最轻的自由重量开始即可，循序渐进增强肌肉的稳定性，防止受伤</li>\n</ul>\n<h1 id=\"训练计划参考\"><a href=\"#训练计划参考\" class=\"headerlink\" title=\"训练计划参考\"></a>训练计划参考</h1><h2 id=\"装备\"><a href=\"#装备\" class=\"headerlink\" title=\"装备\"></a>装备</h2><ul>\n<li>建议穿硬底鞋，如训练鞋、板鞋，或者赤足也可以</li>\n<li>可以购入手套防止疼痛</li>\n<li>耳机（可选）</li>\n</ul>\n<h2 id=\"热身\"><a href=\"#热身\" class=\"headerlink\" title=\"热身\"></a>热身</h2><p>模仿体育课上课前的动作，慢跑5到10分钟，做一下准备运动，活动开筋骨。</p>\n<h2 id=\"双分化双循环训练\"><a href=\"#双分化双循环训练\" class=\"headerlink\" title=\"双分化双循环训练\"></a>双分化双循环训练</h2><p>将身体分为躯干和四肢，一周四练，躯干和四肢分别练两天。可以参考下面的计划：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">周一</th>\n<th align=\"center\">周二</th>\n<th align=\"center\">周三</th>\n<th align=\"center\">周四</th>\n<th align=\"center\">周五</th>\n<th align=\"center\">周六</th>\n<th align=\"center\">周日</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">躯干训练</td>\n<td align=\"center\">四肢训练</td>\n<td align=\"center\">休息</td>\n<td align=\"center\">躯干训练</td>\n<td align=\"center\">四肢训练</td>\n<td align=\"center\">休息</td>\n<td align=\"center\">休息</td>\n</tr>\n</tbody></table>\n<p>其中，躯干训练包含的内容如下：</p>\n<ul>\n<li>胸大肌</li>\n<li>背部肌群</li>\n</ul>\n<p>四肢训练包含的内容如下：</p>\n<ul>\n<li>臀腿肌群</li>\n<li>三角肌中后</li>\n<li>肱二头肌</li>\n</ul>\n<h2 id=\"胸背训练动作\"><a href=\"#胸背训练动作\" class=\"headerlink\" title=\"胸背训练动作\"></a>胸背训练动作</h2><h3 id=\"哑铃卧推（胸）\"><a href=\"#哑铃卧推（胸）\" class=\"headerlink\" title=\"哑铃卧推（胸）\"></a>哑铃卧推（胸）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>使用自由重量。收紧肩胛骨，仰躺在卧推椅上，稍微收下肩部。抓住哑铃，手臂伸直垂直举向上。然后让哑铃缓慢下降，再用力往上推。可以想象手肘把两臂往中间推，重点感受胸部的挤压感。如力量足够，可以考虑上更大重量或使用杠铃卧推。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n<h3 id=\"引体向上（背）\"><a href=\"#引体向上（背）\" class=\"headerlink\" title=\"引体向上（背）\"></a>引体向上（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">不限</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">30</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">歇够了再拉</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">无</td>\n</tr>\n</tbody></table>\n<p>双手比肩略宽抓握吊杆，身体挺直，下压肩胛骨，然后用力将身体拉上去，再缓慢放下。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n勿耸肩伸头，勿后仰太多，勿只做半程。\n</div>\n</article>\n\n<h3 id=\"高位下拉（背）\"><a href=\"#高位下拉（背）\" class=\"headerlink\" title=\"高位下拉（背）\"></a>高位下拉（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>该动作为引体向上的简单版，若引体向上难以完成可以选择该动作。动作要点与引体向上接近。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n<h3 id=\"上斜卧推（胸）\"><a href=\"#上斜卧推（胸）\" class=\"headerlink\" title=\"上斜卧推（胸）\"></a>上斜卧推（胸）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>可以使用杠铃或者哑铃，也可以使用史密斯机。先收紧肩胛骨，仰躺在斜放的卧推椅上。双手抓住哑铃垂直上举，然后有控制地缓慢下放，然后再缓慢往上推。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n小臂应当时刻垂直垂直于地面。\n</div>\n</article>\n\n<h3 id=\"坐姿划船（背）\"><a href=\"#坐姿划船（背）\" class=\"headerlink\" title=\"坐姿划船（背）\"></a>坐姿划船（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>坐在凳子上，双脚踩实地面，挺直腰背，核心收紧。双手后拉，然后缓慢有控制地向下放。身体可以小幅度摆动。在后拉的过程中，后背要使劲夹住，这样才能练出感觉。</p>\n<article class=\"message message-immersive is-info\">\n<div class=\"message-body\">\n<i class=\"fas fa-info-circle mr-2\"></i>\n身体不要大幅度晃动。\n</div>\n</article>\n\n<blockquote>\n<p>如果你的体力充足，可以继续完成下面的两个孤立动作。</p>\n</blockquote>\n<h3 id=\"绳索夹胸（胸）\"><a href=\"#绳索夹胸（胸）\" class=\"headerlink\" title=\"绳索夹胸（胸）\"></a>绳索夹胸（胸）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">15~20</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>可以使用龙门架或者夹胸器械完成该动作。该动作可以帮助新手快速找到胸部发力的感觉，而且不会使得手臂疲劳。注意肩胛骨保持收紧，想象把手臂往中间夹。</p>\n<h3 id=\"单臂哑铃划船（背）\"><a href=\"#单臂哑铃划船（背）\" class=\"headerlink\" title=\"单臂哑铃划船（背）\"></a>单臂哑铃划船（背）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12~15</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>一只脚踩在地面上，另一腿跪在凳子上。在跪着的腿同侧的手向身体另一侧前伸并抓住凳子边沿，另一只手抓住哑铃向上反复拉动。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要左右晃动。</div></article>\n\n<p>训练完要进行放松。</p>\n<h2 id=\"四肢训练动作\"><a href=\"#四肢训练动作\" class=\"headerlink\" title=\"四肢训练动作\"></a>四肢训练动作</h2><h3 id=\"深蹲（腿）\"><a href=\"#深蹲（腿）\" class=\"headerlink\" title=\"深蹲（腿）\"></a>深蹲（腿）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">8</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>新手可以从高脚杯深蹲开始。双手将哑铃的一片托举在胸前，双脚略宽于肩站立，可以由轻微外八。臀部后推，膝盖往两边打开，膝盖往脚尖方向微微滑动，顺势蹲下。然后大腿和臀部发力，用力站起来。如果有能力可以上哑铃或者杠铃。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>重心放在足弓处，腰背挺成一直线，膝盖朝向同脚尖，膝盖略微超脚尖。</div></article>\n\n<h3 id=\"半程硬拉（腿）\"><a href=\"#半程硬拉（腿）\" class=\"headerlink\" title=\"半程硬拉（腿）\"></a>半程硬拉（腿）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">1~2分钟</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在最后一组力竭</td>\n</tr>\n</tbody></table>\n<p>双手握住杠铃或者哑铃自然垂下，挺直腰背，核心收紧。然后缓缓向前俯身放下，再用力地把杠铃拉起来。拉起的过程中用臀部发力，腰腹核心需要收紧。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>屈髋俯身而不要弯腰。</div></article>\n\n<h3 id=\"侧平举（肩）\"><a href=\"#侧平举（肩）\" class=\"headerlink\" title=\"侧平举（肩）\"></a>侧平举（肩）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">15~20次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">30~45秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>双手握住哑铃在身体两侧，身体站直，把哑铃往两边抬起直到与肩部平齐，然后便可以有控制地缓慢下放。动作做得越稳越好，一开始可以用最轻的重量。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要前后晃动。</div></article>\n\n<h3 id=\"面拉（肩）\"><a href=\"#面拉（肩）\" class=\"headerlink\" title=\"面拉（肩）\"></a>面拉（肩）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">4</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12~15次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>把手上的绳索以往后拉，往外旋的方式拉近自己的脸部，</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>手肘不要低于肩，双手不要低于手肘。</div></article>\n\n<h3 id=\"杠铃弯举（手臂）\"><a href=\"#杠铃弯举（手臂）\" class=\"headerlink\" title=\"杠铃弯举（手臂）\"></a>杠铃弯举（手臂）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>站稳后手臂不要乱摆，反复弯举即可。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>动作一定要做完全程。</div></article>\n\n<h3 id=\"锤式弯举（手臂）\"><a href=\"#锤式弯举（手臂）\" class=\"headerlink\" title=\"锤式弯举（手臂）\"></a>锤式弯举（手臂）</h3><table>\n<thead>\n<tr>\n<th align=\"center\">要点</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">组数</td>\n<td align=\"center\">3</td>\n</tr>\n<tr>\n<td align=\"center\">次数</td>\n<td align=\"center\">12次</td>\n</tr>\n<tr>\n<td align=\"center\">间歇</td>\n<td align=\"center\">45~60秒</td>\n</tr>\n<tr>\n<td align=\"center\">练法</td>\n<td align=\"center\">重量选择要求在每一组力竭</td>\n</tr>\n</tbody></table>\n<p>双手拿着哑铃，左右交替将哑铃弯举到胸前。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>身体不要晃动。</div></article>\n\n<p>训练完要进行放松。 </p>\n<h2 id=\"如何判断训练是否有效\"><a href=\"#如何判断训练是否有效\" class=\"headerlink\" title=\"如何判断训练是否有效\"></a>如何判断训练是否有效</h2><h3 id=\"力竭\"><a href=\"#力竭\" class=\"headerlink\" title=\"力竭\"></a>力竭</h3><p>首先是看是否力竭，也就是同组中做一个动作直到完全没有力气。孤立动作可以做到力竭，但是一些大肌群的复合动作，如深蹲、硬拉、划船等，就不建议做到每组力竭 。如果目标肌肉酸痛的话，那么训练是有效果的。</p>\n<h3 id=\"负荷渐进\"><a href=\"#负荷渐进\" class=\"headerlink\" title=\"负荷渐进\"></a>负荷渐进</h3><p>其次就是负荷渐进。如果一次训练中的某组动作可以高质量完成，下一次的训练中就可以增加重量，或者略微增加每组中的次数（二者选其一）。</p>\n<h1 id=\"增重饮食\"><a href=\"#增重饮食\" class=\"headerlink\" title=\"增重饮食\"></a>增重饮食</h1><h2 id=\"增重饮食的原理与原则\"><a href=\"#增重饮食的原理与原则\" class=\"headerlink\" title=\"增重饮食的原理与原则\"></a>增重饮食的原理与原则</h2><h3 id=\"饮食对增重的重要性\"><a href=\"#饮食对增重的重要性\" class=\"headerlink\" title=\"饮食对增重的重要性\"></a>饮食对增重的重要性</h3><p>根据肌肉超量恢复的原理，肌肉在训练轻微损伤后会变弱。如果没有给肌肉提供修复增长的养料，那么肌肉只会越变越弱，人会越来越瘦。所谓<strong>三分练，七分吃</strong>。</p>\n<h3 id=\"饮食中的关键成分\"><a href=\"#饮食中的关键成分\" class=\"headerlink\" title=\"饮食中的关键成分\"></a>饮食中的关键成分</h3><h4 id=\"蛋白质\"><a href=\"#蛋白质\" class=\"headerlink\" title=\"蛋白质\"></a>蛋白质</h4><p>蛋白质是肌肉生长的原料。在训练强度足够的情况下，建议每天每公斤体重摄入1.5~2g蛋白质，可以折中取1.8g。</p>\n<p>肉、蛋、奶、豆类中含有的蛋白质比较丰富。增肌推荐食用动物蛋白。</p>\n<h4 id=\"碳水化合物\"><a href=\"#碳水化合物\" class=\"headerlink\" title=\"碳水化合物\"></a>碳水化合物</h4><p>碳水是肌肉生长的燃料，为肌肉生长提供能量。对基础代谢高的瘦子，增重更需要摄入足够的碳水化合物。建议每天每公斤体重摄入6g碳水化合物。但是这个值不是固定的，如果消耗比较大，那么可能需要每天每公斤摄入8g或以上的碳水化合物，体重才有可能增加。</p>\n<p>增肌粉中含有不少的碳水化合物，对于瘦子来说比蛋白粉更加友好。</p>\n<p>主食类（米、面），淀粉作物（土豆、红薯、香蕉）中含有较多的碳水化合物。</p>\n<h4 id=\"脂肪\"><a href=\"#脂肪\" class=\"headerlink\" title=\"脂肪\"></a>脂肪</h4><p>脂肪不需要额外补充。建议多摄入不饱和脂肪酸，这些不饱和脂肪酸可以通过坚果、鱼油等摄入。</p>\n<h2 id=\"饮食计划\"><a href=\"#饮食计划\" class=\"headerlink\" title=\"饮食计划\"></a>饮食计划</h2><h3 id=\"精确记录营养摄入\"><a href=\"#精确记录营养摄入\" class=\"headerlink\" title=\"精确记录营养摄入\"></a>精确记录营养摄入</h3><p>饮食不能凭感觉，必须通过计算来判断吃得够不够。可以通过估算食物重量，再使用APP查询的方式来大致计算营养物质的摄入量。在熟练后只通过估算就可以知道营养的摄入量。</p>\n<h3 id=\"饮食计划参考\"><a href=\"#饮食计划参考\" class=\"headerlink\" title=\"饮食计划参考\"></a>饮食计划参考</h3><p>仅仅靠一日三餐是无法满足上面所要求的营养摄入量的，因此需要加餐。</p>\n<p>饮食计划的原则是：<strong>每三小时左右吃一顿</strong>。一般来说，早饭与午饭、午饭与晚饭之间可以进行加餐，晚上睡前两到三个小时可以吃宵夜。</p>\n<p>按照上面的计划，每天一共吃六餐饭。即便六餐饭每餐都吃六到七分饱，也会比一日三顿饭吃撑吃得要多。等体重增长后胃口变大，就不需要再一日吃六餐饭来维持身材了。</p>\n<article class=\"message message-immersive is-info\"><div class=\"message-body\"><i class=\"fas fa-info-circle mr-2\"></i>饮食计划一定要根据自身条件来制定，遵循循序渐进的原则，一点点加量。</div></article>\n\n<h4 id=\"早餐\"><a href=\"#早餐\" class=\"headerlink\" title=\"早餐\"></a>早餐</h4><p>早餐是最重要的一餐，<strong>增重必须要吃早餐</strong>。早餐的碳水和蛋白质要管够，而且量要足够大。鸡蛋是最好的补充蛋白质的食物。</p>\n<h4 id=\"午餐与晚餐\"><a href=\"#午餐与晚餐\" class=\"headerlink\" title=\"午餐与晚餐\"></a>午餐与晚餐</h4><p>可以考虑以两份肉菜，一份青菜，两碗饭的量来吃。肉类主要补充蛋白质，青菜主要补充膳食纤维，米饭补充碳水。</p>\n<h4 id=\"加餐\"><a href=\"#加餐\" class=\"headerlink\" title=\"加餐\"></a>加餐</h4><p>加餐的食物多样，面包，鸡蛋，香蕉等均可作为加餐食物。</p>\n<h3 id=\"判断营养摄入是否充足的办法\"><a href=\"#判断营养摄入是否充足的办法\" class=\"headerlink\" title=\"判断营养摄入是否充足的办法\"></a>判断营养摄入是否充足的办法</h3><p>可以通过观察自己的体重来判断。如果体重是在逐步上升的，那么就说明你的碳水摄入是基本合理的。但是无论如何，蛋白质的摄入量一定要足够。</p>\n<h3 id=\"关于补剂\"><a href=\"#关于补剂\" class=\"headerlink\" title=\"关于补剂\"></a>关于补剂</h3><p>补剂的作用是补充蛋白质（或者蛋白质+碳水）。如果每天正常吃饭已经达到了要求的营养物质摄入量，那么就不需要喝补剂。</p>\n<h1 id=\"休息与恢复\"><a href=\"#休息与恢复\" class=\"headerlink\" title=\"休息与恢复\"></a>休息与恢复</h1><h2 id=\"休息的重要性\"><a href=\"#休息的重要性\" class=\"headerlink\" title=\"休息的重要性\"></a>休息的重要性</h2><p>根据肌肉超量恢复的原理，可以在肌肉基本恢复后的上升期安排下一次的训练。如果肌肉还没有完全恢复就又开始训练，那么只会加重肌肉的损伤，导致越练越差。</p>\n<h2 id=\"休息恢复的安排\"><a href=\"#休息恢复的安排\" class=\"headerlink\" title=\"休息恢复的安排\"></a>休息恢复的安排</h2><h3 id=\"短期\"><a href=\"#短期\" class=\"headerlink\" title=\"短期\"></a>短期</h3><p>短期的休息恢复要遵循下面两个原则：</p>\n<ul>\n<li>连续训练两到三天，要彻底休息一天</li>\n<li>同一块肌肉不要连续安排两天训练</li>\n</ul>\n<h3 id=\"长期\"><a href=\"#长期\" class=\"headerlink\" title=\"长期\"></a>长期</h3><p>长期训练会导致疲劳积累，因此每两到三个月可以安排一个恢复周。在恢复周中，可以完全不练，也可以训练量减半。</p>\n<h3 id=\"睡眠\"><a href=\"#睡眠\" class=\"headerlink\" title=\"睡眠\"></a>睡眠</h3><p>熬夜会导致皮质醇分泌紊乱，甚至会导致内分泌失调。增肌过程中万万不可以熬夜。</p>\n<p>如果因为运动导致睡不着，可以尝试将训练时间提前。睡前可以做一些放松神经的事情，建议不要玩手机。</p>\n"},{"title":"解决幻16睡眠自动唤醒问题与电源管理解锁","date":"2021-08-19T09:00:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/zephyrus16.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/zephyrus16.jpg","excerpt":"怀念macOS...","_content":"\n# 简单聊聊幻16\n\n最近换了一台ROG的幻16，我对这台电脑各方面都还比较满意。最开始我是想买xps17的，但是xps9710今年的更新只把显卡升级到了3060（60W丐中丐），然后可选配置砍了好多，同配置9710比9700还贵了1k+。可能戴尔这定价策略就是普确信吧😅。把xps17从选择中一脚踹走之后，我把幻16、灵越16plus、Thinkbook 16p、灵刃15纳入了考虑范围。但是灵越16plus散热拉胯，Thinkbook 16p实在太丑，于是也被排除。决赛圈是幻16和灵刃15。灵刃15的外观和性能都相当吸引人，但是对于我这种重度办公用户，它败就败在没有16:10的屏幕。最终我还是选择了幻16。\n\n幻16综合来说是一台素质非常不错的电脑（所谓“创意设计笔记本”）。相比于游戏本它的外观比较低调（虽然我觉得A面的彩虹亮片装饰还是有些张扬），然后键盘也没有花里胡哨的RGB灯。这种简洁的外观设计对办公人士是相当友好的。\n\n其次，幻16没有数字小键盘是另一个吸引我的设计。我个人还是比较喜欢Macbook上那种键盘布局的，数字小键盘对于我来说没多大用处而且占C面空间。取消小键盘带来的额外空间被用于布置扬声器。幻16上配置有6单元的扬声器，其音响效果非常不错，这是让我感到比较惊艳的一点。此外C面还安装有一块硕大的玻璃触控板，手感亦是上佳（虽然仍然比不上Macbook）。幻16的开机键集成了指纹解锁功能，免除了输入密码的烦恼，相当方便。\n\n这台电脑的屏幕素质亦是相当优秀：2K分辨率、16:10的比例、P3色域、165Hz刷新率、以及极高的屏占比。在日常使用中，我几乎不会感知到像素点。由于是IPS屏幕，因此其或多或少有点漏光。这块屏幕的素质足够胜任一般的图像处理与视频剪辑工作了。\n\n我入手的这台低配幻16的硬件属于标准的创意设计笔记本的配置：11代Intel酷睿i7，RTX3060（80W，6G显存），板载内存8G+一个最高可以扩展到32G的内存插槽（DDR4，3200MHz），标配三星512G的硬盘（PCIE-4）以及一个PCIE-3的M.2硬盘插槽。如果是高配版则有RTX3070（8G显存）以及16G板载内存。\n\n幻16的接口还是比较丰富的。它有一个雷电4口（USB Type-C）、三个USB3接口（1个USB Type-C，2个USB A）、RJ45网线接口、HDMI接口、3,5mm耳机/麦克风接口、DC电源接口。另外，幻16还配有一个读卡器，不过比较尴尬的是它是一个TF卡的读卡器......\n\n下面讲讲我觉得这台电脑存在的不足之处：\n\n- 品控不稳定：光这个点就可以说好多好多......\n\n  根据网友反映，这台电脑存在品控问题有：\n\n  - 屏幕弯曲（通病）\n\n  - 按压屏幕上缘摄像头周围会出现松动异响（通病）\n\n  - 屏幕漏光严重（部分出现）\n\n  - 电流声、电容高频啸叫（通病）\n\n  - 键盘按键喷漆不均匀，打开键盘背光漏光（本人独一家，目前网上还没有类似情况，已换）\n\n    ![奥创中心与禁用麦克风的按键上缘漏光](https://astrobear.top/resource/astroblog/content/rog_key_painting_issue.jpeg)\n\n  - 键盘按键（B、N键）不平（通病）\n\n- C面上缘的指示灯太亮了，屏幕会反射灯光，有点影响体验，目前我把三个灯用黑胶布贴上了\n\n- 在高负载时，风扇噪音实在太吵，在风扇转速最高时，我测得的人位噪声有50dB，另外即便如此C面还是很烫\n\n- C面的类肤质材料不易清洁\n\n如果上面的几个问题可以解决，那么这台电脑就是我心目中的完美最强六边形战士笔记本了（可惜解决不了，解决了也不会是现在这个价格）。目前最接近我心目中的完美笔记本应该就是今年的Thinkpad X1 Extreme了，静待发售之后的测评吧！\n\n# 解决幻16睡眠自动唤醒问题\n\n之前说过，幻16是一台好机器，但也不完全是一台好机器。除了硬件上的一些瑕疵，软件上也有一些问题。这些软件上的问题，很多都是由Win10带来的😐。最大的一个问题就是它会在睡眠的时候自动唤醒。下面讲讲我解决这个问题的坑爹过程。\n\n某天在我睡觉时，原本在睡眠状态的电脑屏幕突然亮起，照亮了整个房间。过了一小会儿后屏幕又自动熄灭，电脑继续进入睡眠状态。见到如此情形，我顿时睡意全无，强迫症患者表示无法忍受。遂起身下床打开搜索引擎准备修bug。没想到这个bug一修就是将近3天。\n\n首先在事件查看器中看看引起睡眠唤醒的原因。检查我在睡觉的时间内记录的系统日志，这个时候电脑应该都在睡眠状态（包括开盖和合盖时睡眠的情况）。经过我的总结，导致电脑自动唤醒的原因有下面几个：\n\n- Input Mouse\n- Input Keyboard\n- 50（未知原因）\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_event_viewer.png)\n\n首先解决Input Mouse/Keyboard的问题。经过一番查询，网络提供的解决办法为：在设备管理器中展开`鼠标和其他指针设备`，右键点击设备打开`属性`，在`电源管理`一栏中取消勾选`允许此设备唤醒计算机`。由于我是用的是无线鼠标，因此还需要在`键盘`选项中对`HID Keyboard Device`执行相同的操作。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_mouse.png)\n\n设置完成以后按`WIN+L`锁屏进入闲置状态进行测试，电脑仍然出现了自动唤醒的问题。多次复现问题后查看系统日志，发现自动唤醒的原因仍然有Input Mouse/Keyboard。于是关闭鼠标电源，再次测试，问题依旧。怒，直接拔掉鼠标接收器，睡眠得以正常。但是如果要每次离开电脑的时候都拔掉鼠标接收器，不但很麻烦，而且容易把接收器弄丢。网友分析出现这种状况有可能是Win10离开模式的锅。\n\n右击电池图标进入`电源选项`，点击窗口右侧`更改计划设置`后再点击`更改高级电源设置`，在它的`睡眠`选项中竟然没有`允许离开模式策略`这个项设置。对比其他人的高级电源管理，我的电源管理中的可设置项只有寥寥几个。于是又是一番搜索，发现需要改注册表。于是按照方法修改注册表，解锁了大部分隐藏的设置（下一节会介绍）。关闭了离开模式以后再次进行测试，发现在锁屏状态下进入睡眠后仍然会有几率自动唤醒，无语。由电脑的电源指示灯我发现，锁定后电脑黑屏一段时间以后，指示灯才开始进行规律的闪烁，这标志着电脑真正进入睡眠状态了。而指示灯常亮且电脑黑屏时，电脑应该只是处于离开模式。于是我干脆把电脑在闲置状态下进入睡眠的时间缩短到5分钟，让鼠标在唤醒电脑之前直接让电脑从离开模式进入睡眠状态。至此，鼠标在无操作状态下唤醒电脑的问题得到了基本解决。\n\n为了解决鼠标自动唤醒电脑的这个问题，我还尝试过在终端中通过命令的形式来修改设置以解决问题，但是同样也没有效果，遂放弃。可以说这个问题没有得到根本的解决，只是通过缩短进入睡眠的时间将它掩盖了。\n\n本来以为问题已经解决了，但是！在晚上睡觉的时候，电脑屏幕又双叒亮了！暴起，合上屏幕继续睡觉、第二天起床查看系统日志，发现即使在合盖情况下，电脑仍会被唤醒，只是屏幕不会点亮而已。同时我还发现，电脑每隔一小时就会被唤醒一下，并且每次唤醒后系统日志的格式均如下所示：\n\n- 系统正在退出连接待机状态，原因: 50\n- 系统正在进入连接待机状态，原因: 50\n- 进程 C:\\Program Files\\ASUS\\ARMOURY CRATE Service\\ArmouryCrate.UserSessionHelper.exe (进程 ID: 9384)将策略方案从 {381b4222-f694-41f0-9685-ff5bb260df2e} 重置为 {381b4222-f694-41f0-9685-ff5bb260df2e}\n\n看样子这是奥创中心的服务，于是我去任务计划程序看看有什么程序是定时启动的。\n\n在任务计划程序中左侧一栏中展开`任务计划程序库`，选择`ASUS`一栏。比对我的电脑睡眠自动唤醒的时间，我发现了其中一个程序的触发时间匹配上了唤醒时间，而且被设定为每小时触发一次。我将触发条件更改为`当任何用户登录时`后再进行测试，结果发现问题依旧......\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_planned_mission.png)\n\n在走投无路的情况下，我直接把奥创中心卸载了，重启之后发现键盘背光没法亮了😑，只好又把奥创中心重新装了回去。突然我想到，如果不能删除奥创中心，我能不能只删除掉`ArmouryCrate.UserSessionHelper.exe `这个服务呢？\n\n打开任务管理器，找到`ArmouryCrate.UserSessionHelper.exe `，右键打开菜单并点击`打开文件所在位置`。尝试删除这个程序，提示程序正在运行中无法删除。尝试通过剪切将程序移出当前文件夹，成功！然后在任务管理器中结束`ARMOURY CRATE Service`，可以发现任务管理器中`ArmouryCrate.UserSessionHelper.exe `没有再自动启动。\n\n重启电脑后，经测试键盘背光灯可以正常工作。移除该服务后，奥创中心的功能会缺失不少，键盘上的奥创中心按键也无法再使用，但是核心功能——切换情景模式还是可以使用的。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_armoury_crate.png)\n\n再次进行睡眠测试，电脑终于不会再自动唤醒了！而且，电脑睡眠时不再烫手，风扇也不会再转了！\n\n**罪魁祸首就是奥创中心！**\n\n奥创中心将游戏本的性能和散热策略直接放在幻16上，只会让它又热又吵而且耗电还快。但其实把所有的锅都推给奥创中心是不太合理的，虽然这个软件确实垃圾。\n\n实际上**最坑最坑的还是Windows 10强行推出的现代睡眠模式（S0睡眠）。**这个睡眠模式不同于以往的S3睡眠，S0睡眠下电脑除屏幕外其他设备都是供电的，相当于手机的熄屏状态。此外，由于微软一意孤行推广S0睡眠，这种睡眠模式还无法更改，甚至bios里都没有更改睡眠模式的选项。像我之前的电脑能设置S3睡眠，就没这么多屁事。\n\n# 电源管理解锁\n\n在折腾幻16的睡眠问题的时候我发现，机器上Win10的高级电源管理与其他人相比少了很多设置项。经过一番搜索之后，发现要通过修改注册表的方式来解锁这些设置。下面讲讲具体方法。\n\n首先打开注册表编辑器，在左侧的资源管理器中找到这个文件夹：`计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power`。\n\n在这个文件夹下，`PowerSettings`文件夹中的项目为高级电源管理的所有设置项，`\\User\\PowerSchemes`文件夹中的项目为所有的电源计划。\n\n首先我们来解锁隐藏的电源计划。\n\n在`\\User\\PowerSchemes`的目录下随便点开一个文件夹，这里以`27fa6203-3987-4dcc-918d-748559d549ec`为例。选中该文件夹之后，在右侧的项目中有一项名称为`FriendlyName`，这个项目的数据（值）为`Performance`。因此，该文件夹中的内容为`性能`模式的设置项。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings1.png)\n\n展开该文件夹，选中`245d8541-3943-4422-b025-13a784f679b7`这个文件夹，可以看到如下图所示的设置项。其中，`ACSettingIndex`和`DCSettingIndex`分别为该电源计划在交流供电和电池供电的情况下的可用性。如果值为`0`，则在该情况下不可用。因此，为了解锁这个隐藏的电源计划，我们要将这个两个设置项的值都设为`1`。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings2.png)\n\n鼠标右键点击设置项，选择`修改`。在修改它的值之后点击确定，会出现错误提示：`无法编辑xxx。编辑该值时出错。`，这是因为你没有权限修改这个值。\n\n在左侧的资源管理器中右击当前文件夹，选择`权限`。\n\n1. 在弹出的窗口中点击`高级`按钮\n2. 在高级安全设置的窗口中，点击上方`所有者`右侧的蓝色`更改`选项\n3. 然后还是在弹出的窗口中点击`高级`按钮\n4. 在新的弹窗右侧点击`立即查找`\n5. 在窗口下方找到你的用户名后选中\n6. 点击`确定`\n7. 点击`确定`\n8. 你可以看到`所有者`变为自己的账户名\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings3.png)\n\n执行完上面的步骤，你现在只是有了修改**修改注册表的权限**的权限，你还要执行下面的步骤以获得**修改注册表**的权限。\n\n1. 在设置权限的窗口中点击`添加`\n2. 在弹出的窗口中点击`高级`\n3. 在新的弹窗右侧点击`立即查找`\n4. 在窗口下方找到你的用户名后选中\n5. 点击`确定`\n6. 点击`确定`\n7. 在`权限`一栏中的`完全控制`项中勾选`允许`\n8. 点击`应用`\n9. 你可以在`组或用户名`中看到自己的账户名\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings4.png)\n\n点击`确定`关闭窗口，现在你应该可以修改该文件夹下注册表的值以解锁隐藏的电源计划了。修改完成后，在`电源选项`窗口中你可以发现，原本隐藏的电源计划出现了。\n\n对于其他隐藏的电源计划，依照上面的方法举一反三同样可以解锁。区别仅仅在于需要选择不同电源计划的文件夹。而不同电源计划的设置项：`ACSettingIndex`和`DCSettingIndex`所在的文件夹都是电源计划的文件夹下名为`245d8541-3943-4422-b025-13a784f679b7`的文件夹。\n\n然后来讲一下如何解锁高级电源管理的隐藏设置项。\n\n解锁高级电源管理的隐藏设置项不需要更改权限，所以操作起来相对简单。在`计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power\\PowerSettings`的路径下随便选择一个文件夹，这里以`238C9FA8-0AAD-41ED-83F4-97BE242C8F20`文件夹为例。选中之后，右侧`FriendlyName`项的值有`Sleep transition settings`，这指明了该文件夹下的设置项均为睡眠相关设置。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings5.png)\n\n点击该文件夹下的第二个文件夹`25DFA149-5DD1-4736-B5AB-E8A37B5B8187`，其右侧`FriendlyName`项的值有`Allow Away Mode Policy`。因此我们可以知道该项是用来设置离开模式的。对于任何一个设置项，只有`Attributes`的值为`2`时它才会在高级电源管理中显示，我们只需要右键`Attributes`并点击`修改`，将它的值改为`2`即可。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings6.png)\n\n对于其他隐藏的高级电源管理设置项，仿照上面的方法同样可以解锁。这里不再赘述。\n\n\n\n\n\n","source":"_posts/解决幻16睡眠自动唤醒问题与电源管理配置.md","raw":"---\ntitle: 解决幻16睡眠自动唤醒问题与电源管理解锁\ndate: 2021-08-19 17:00:00\ncategories: \n\t- [Others]\n\t#...\ntags: \n\t- Windows 10\n\t- ROG\n\t- Others\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/zephyrus16.jpg\n\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/zephyrus16.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: 怀念macOS...\n\n#If you don't want to show the ToC (Table of Content) at sidebar, delete the well number below. \n\n#toc: false\n\n#You can begin to input your article below now.\n\n---\n\n# 简单聊聊幻16\n\n最近换了一台ROG的幻16，我对这台电脑各方面都还比较满意。最开始我是想买xps17的，但是xps9710今年的更新只把显卡升级到了3060（60W丐中丐），然后可选配置砍了好多，同配置9710比9700还贵了1k+。可能戴尔这定价策略就是普确信吧😅。把xps17从选择中一脚踹走之后，我把幻16、灵越16plus、Thinkbook 16p、灵刃15纳入了考虑范围。但是灵越16plus散热拉胯，Thinkbook 16p实在太丑，于是也被排除。决赛圈是幻16和灵刃15。灵刃15的外观和性能都相当吸引人，但是对于我这种重度办公用户，它败就败在没有16:10的屏幕。最终我还是选择了幻16。\n\n幻16综合来说是一台素质非常不错的电脑（所谓“创意设计笔记本”）。相比于游戏本它的外观比较低调（虽然我觉得A面的彩虹亮片装饰还是有些张扬），然后键盘也没有花里胡哨的RGB灯。这种简洁的外观设计对办公人士是相当友好的。\n\n其次，幻16没有数字小键盘是另一个吸引我的设计。我个人还是比较喜欢Macbook上那种键盘布局的，数字小键盘对于我来说没多大用处而且占C面空间。取消小键盘带来的额外空间被用于布置扬声器。幻16上配置有6单元的扬声器，其音响效果非常不错，这是让我感到比较惊艳的一点。此外C面还安装有一块硕大的玻璃触控板，手感亦是上佳（虽然仍然比不上Macbook）。幻16的开机键集成了指纹解锁功能，免除了输入密码的烦恼，相当方便。\n\n这台电脑的屏幕素质亦是相当优秀：2K分辨率、16:10的比例、P3色域、165Hz刷新率、以及极高的屏占比。在日常使用中，我几乎不会感知到像素点。由于是IPS屏幕，因此其或多或少有点漏光。这块屏幕的素质足够胜任一般的图像处理与视频剪辑工作了。\n\n我入手的这台低配幻16的硬件属于标准的创意设计笔记本的配置：11代Intel酷睿i7，RTX3060（80W，6G显存），板载内存8G+一个最高可以扩展到32G的内存插槽（DDR4，3200MHz），标配三星512G的硬盘（PCIE-4）以及一个PCIE-3的M.2硬盘插槽。如果是高配版则有RTX3070（8G显存）以及16G板载内存。\n\n幻16的接口还是比较丰富的。它有一个雷电4口（USB Type-C）、三个USB3接口（1个USB Type-C，2个USB A）、RJ45网线接口、HDMI接口、3,5mm耳机/麦克风接口、DC电源接口。另外，幻16还配有一个读卡器，不过比较尴尬的是它是一个TF卡的读卡器......\n\n下面讲讲我觉得这台电脑存在的不足之处：\n\n- 品控不稳定：光这个点就可以说好多好多......\n\n  根据网友反映，这台电脑存在品控问题有：\n\n  - 屏幕弯曲（通病）\n\n  - 按压屏幕上缘摄像头周围会出现松动异响（通病）\n\n  - 屏幕漏光严重（部分出现）\n\n  - 电流声、电容高频啸叫（通病）\n\n  - 键盘按键喷漆不均匀，打开键盘背光漏光（本人独一家，目前网上还没有类似情况，已换）\n\n    ![奥创中心与禁用麦克风的按键上缘漏光](https://astrobear.top/resource/astroblog/content/rog_key_painting_issue.jpeg)\n\n  - 键盘按键（B、N键）不平（通病）\n\n- C面上缘的指示灯太亮了，屏幕会反射灯光，有点影响体验，目前我把三个灯用黑胶布贴上了\n\n- 在高负载时，风扇噪音实在太吵，在风扇转速最高时，我测得的人位噪声有50dB，另外即便如此C面还是很烫\n\n- C面的类肤质材料不易清洁\n\n如果上面的几个问题可以解决，那么这台电脑就是我心目中的完美最强六边形战士笔记本了（可惜解决不了，解决了也不会是现在这个价格）。目前最接近我心目中的完美笔记本应该就是今年的Thinkpad X1 Extreme了，静待发售之后的测评吧！\n\n# 解决幻16睡眠自动唤醒问题\n\n之前说过，幻16是一台好机器，但也不完全是一台好机器。除了硬件上的一些瑕疵，软件上也有一些问题。这些软件上的问题，很多都是由Win10带来的😐。最大的一个问题就是它会在睡眠的时候自动唤醒。下面讲讲我解决这个问题的坑爹过程。\n\n某天在我睡觉时，原本在睡眠状态的电脑屏幕突然亮起，照亮了整个房间。过了一小会儿后屏幕又自动熄灭，电脑继续进入睡眠状态。见到如此情形，我顿时睡意全无，强迫症患者表示无法忍受。遂起身下床打开搜索引擎准备修bug。没想到这个bug一修就是将近3天。\n\n首先在事件查看器中看看引起睡眠唤醒的原因。检查我在睡觉的时间内记录的系统日志，这个时候电脑应该都在睡眠状态（包括开盖和合盖时睡眠的情况）。经过我的总结，导致电脑自动唤醒的原因有下面几个：\n\n- Input Mouse\n- Input Keyboard\n- 50（未知原因）\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_event_viewer.png)\n\n首先解决Input Mouse/Keyboard的问题。经过一番查询，网络提供的解决办法为：在设备管理器中展开`鼠标和其他指针设备`，右键点击设备打开`属性`，在`电源管理`一栏中取消勾选`允许此设备唤醒计算机`。由于我是用的是无线鼠标，因此还需要在`键盘`选项中对`HID Keyboard Device`执行相同的操作。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_mouse.png)\n\n设置完成以后按`WIN+L`锁屏进入闲置状态进行测试，电脑仍然出现了自动唤醒的问题。多次复现问题后查看系统日志，发现自动唤醒的原因仍然有Input Mouse/Keyboard。于是关闭鼠标电源，再次测试，问题依旧。怒，直接拔掉鼠标接收器，睡眠得以正常。但是如果要每次离开电脑的时候都拔掉鼠标接收器，不但很麻烦，而且容易把接收器弄丢。网友分析出现这种状况有可能是Win10离开模式的锅。\n\n右击电池图标进入`电源选项`，点击窗口右侧`更改计划设置`后再点击`更改高级电源设置`，在它的`睡眠`选项中竟然没有`允许离开模式策略`这个项设置。对比其他人的高级电源管理，我的电源管理中的可设置项只有寥寥几个。于是又是一番搜索，发现需要改注册表。于是按照方法修改注册表，解锁了大部分隐藏的设置（下一节会介绍）。关闭了离开模式以后再次进行测试，发现在锁屏状态下进入睡眠后仍然会有几率自动唤醒，无语。由电脑的电源指示灯我发现，锁定后电脑黑屏一段时间以后，指示灯才开始进行规律的闪烁，这标志着电脑真正进入睡眠状态了。而指示灯常亮且电脑黑屏时，电脑应该只是处于离开模式。于是我干脆把电脑在闲置状态下进入睡眠的时间缩短到5分钟，让鼠标在唤醒电脑之前直接让电脑从离开模式进入睡眠状态。至此，鼠标在无操作状态下唤醒电脑的问题得到了基本解决。\n\n为了解决鼠标自动唤醒电脑的这个问题，我还尝试过在终端中通过命令的形式来修改设置以解决问题，但是同样也没有效果，遂放弃。可以说这个问题没有得到根本的解决，只是通过缩短进入睡眠的时间将它掩盖了。\n\n本来以为问题已经解决了，但是！在晚上睡觉的时候，电脑屏幕又双叒亮了！暴起，合上屏幕继续睡觉、第二天起床查看系统日志，发现即使在合盖情况下，电脑仍会被唤醒，只是屏幕不会点亮而已。同时我还发现，电脑每隔一小时就会被唤醒一下，并且每次唤醒后系统日志的格式均如下所示：\n\n- 系统正在退出连接待机状态，原因: 50\n- 系统正在进入连接待机状态，原因: 50\n- 进程 C:\\Program Files\\ASUS\\ARMOURY CRATE Service\\ArmouryCrate.UserSessionHelper.exe (进程 ID: 9384)将策略方案从 {381b4222-f694-41f0-9685-ff5bb260df2e} 重置为 {381b4222-f694-41f0-9685-ff5bb260df2e}\n\n看样子这是奥创中心的服务，于是我去任务计划程序看看有什么程序是定时启动的。\n\n在任务计划程序中左侧一栏中展开`任务计划程序库`，选择`ASUS`一栏。比对我的电脑睡眠自动唤醒的时间，我发现了其中一个程序的触发时间匹配上了唤醒时间，而且被设定为每小时触发一次。我将触发条件更改为`当任何用户登录时`后再进行测试，结果发现问题依旧......\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_planned_mission.png)\n\n在走投无路的情况下，我直接把奥创中心卸载了，重启之后发现键盘背光没法亮了😑，只好又把奥创中心重新装了回去。突然我想到，如果不能删除奥创中心，我能不能只删除掉`ArmouryCrate.UserSessionHelper.exe `这个服务呢？\n\n打开任务管理器，找到`ArmouryCrate.UserSessionHelper.exe `，右键打开菜单并点击`打开文件所在位置`。尝试删除这个程序，提示程序正在运行中无法删除。尝试通过剪切将程序移出当前文件夹，成功！然后在任务管理器中结束`ARMOURY CRATE Service`，可以发现任务管理器中`ArmouryCrate.UserSessionHelper.exe `没有再自动启动。\n\n重启电脑后，经测试键盘背光灯可以正常工作。移除该服务后，奥创中心的功能会缺失不少，键盘上的奥创中心按键也无法再使用，但是核心功能——切换情景模式还是可以使用的。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_armoury_crate.png)\n\n再次进行睡眠测试，电脑终于不会再自动唤醒了！而且，电脑睡眠时不再烫手，风扇也不会再转了！\n\n**罪魁祸首就是奥创中心！**\n\n奥创中心将游戏本的性能和散热策略直接放在幻16上，只会让它又热又吵而且耗电还快。但其实把所有的锅都推给奥创中心是不太合理的，虽然这个软件确实垃圾。\n\n实际上**最坑最坑的还是Windows 10强行推出的现代睡眠模式（S0睡眠）。**这个睡眠模式不同于以往的S3睡眠，S0睡眠下电脑除屏幕外其他设备都是供电的，相当于手机的熄屏状态。此外，由于微软一意孤行推广S0睡眠，这种睡眠模式还无法更改，甚至bios里都没有更改睡眠模式的选项。像我之前的电脑能设置S3睡眠，就没这么多屁事。\n\n# 电源管理解锁\n\n在折腾幻16的睡眠问题的时候我发现，机器上Win10的高级电源管理与其他人相比少了很多设置项。经过一番搜索之后，发现要通过修改注册表的方式来解锁这些设置。下面讲讲具体方法。\n\n首先打开注册表编辑器，在左侧的资源管理器中找到这个文件夹：`计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power`。\n\n在这个文件夹下，`PowerSettings`文件夹中的项目为高级电源管理的所有设置项，`\\User\\PowerSchemes`文件夹中的项目为所有的电源计划。\n\n首先我们来解锁隐藏的电源计划。\n\n在`\\User\\PowerSchemes`的目录下随便点开一个文件夹，这里以`27fa6203-3987-4dcc-918d-748559d549ec`为例。选中该文件夹之后，在右侧的项目中有一项名称为`FriendlyName`，这个项目的数据（值）为`Performance`。因此，该文件夹中的内容为`性能`模式的设置项。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings1.png)\n\n展开该文件夹，选中`245d8541-3943-4422-b025-13a784f679b7`这个文件夹，可以看到如下图所示的设置项。其中，`ACSettingIndex`和`DCSettingIndex`分别为该电源计划在交流供电和电池供电的情况下的可用性。如果值为`0`，则在该情况下不可用。因此，为了解锁这个隐藏的电源计划，我们要将这个两个设置项的值都设为`1`。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings2.png)\n\n鼠标右键点击设置项，选择`修改`。在修改它的值之后点击确定，会出现错误提示：`无法编辑xxx。编辑该值时出错。`，这是因为你没有权限修改这个值。\n\n在左侧的资源管理器中右击当前文件夹，选择`权限`。\n\n1. 在弹出的窗口中点击`高级`按钮\n2. 在高级安全设置的窗口中，点击上方`所有者`右侧的蓝色`更改`选项\n3. 然后还是在弹出的窗口中点击`高级`按钮\n4. 在新的弹窗右侧点击`立即查找`\n5. 在窗口下方找到你的用户名后选中\n6. 点击`确定`\n7. 点击`确定`\n8. 你可以看到`所有者`变为自己的账户名\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings3.png)\n\n执行完上面的步骤，你现在只是有了修改**修改注册表的权限**的权限，你还要执行下面的步骤以获得**修改注册表**的权限。\n\n1. 在设置权限的窗口中点击`添加`\n2. 在弹出的窗口中点击`高级`\n3. 在新的弹窗右侧点击`立即查找`\n4. 在窗口下方找到你的用户名后选中\n5. 点击`确定`\n6. 点击`确定`\n7. 在`权限`一栏中的`完全控制`项中勾选`允许`\n8. 点击`应用`\n9. 你可以在`组或用户名`中看到自己的账户名\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings4.png)\n\n点击`确定`关闭窗口，现在你应该可以修改该文件夹下注册表的值以解锁隐藏的电源计划了。修改完成后，在`电源选项`窗口中你可以发现，原本隐藏的电源计划出现了。\n\n对于其他隐藏的电源计划，依照上面的方法举一反三同样可以解锁。区别仅仅在于需要选择不同电源计划的文件夹。而不同电源计划的设置项：`ACSettingIndex`和`DCSettingIndex`所在的文件夹都是电源计划的文件夹下名为`245d8541-3943-4422-b025-13a784f679b7`的文件夹。\n\n然后来讲一下如何解锁高级电源管理的隐藏设置项。\n\n解锁高级电源管理的隐藏设置项不需要更改权限，所以操作起来相对简单。在`计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power\\PowerSettings`的路径下随便选择一个文件夹，这里以`238C9FA8-0AAD-41ED-83F4-97BE242C8F20`文件夹为例。选中之后，右侧`FriendlyName`项的值有`Sleep transition settings`，这指明了该文件夹下的设置项均为睡眠相关设置。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings5.png)\n\n点击该文件夹下的第二个文件夹`25DFA149-5DD1-4736-B5AB-E8A37B5B8187`，其右侧`FriendlyName`项的值有`Allow Away Mode Policy`。因此我们可以知道该项是用来设置离开模式的。对于任何一个设置项，只有`Attributes`的值为`2`时它才会在高级电源管理中显示，我们只需要右键`Attributes`并点击`修改`，将它的值改为`2`即可。\n\n![](https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings6.png)\n\n对于其他隐藏的高级电源管理设置项，仿照上面的方法同样可以解锁。这里不再赘述。\n\n\n\n\n\n","slug":"解决幻16睡眠自动唤醒问题与电源管理配置","published":1,"updated":"2021-11-23T04:41:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0c001w1q391dpy0ggd","content":"<h1 id=\"简单聊聊幻16\"><a href=\"#简单聊聊幻16\" class=\"headerlink\" title=\"简单聊聊幻16\"></a>简单聊聊幻16</h1><p>最近换了一台ROG的幻16，我对这台电脑各方面都还比较满意。最开始我是想买xps17的，但是xps9710今年的更新只把显卡升级到了3060（60W丐中丐），然后可选配置砍了好多，同配置9710比9700还贵了1k+。可能戴尔这定价策略就是普确信吧😅。把xps17从选择中一脚踹走之后，我把幻16、灵越16plus、Thinkbook 16p、灵刃15纳入了考虑范围。但是灵越16plus散热拉胯，Thinkbook 16p实在太丑，于是也被排除。决赛圈是幻16和灵刃15。灵刃15的外观和性能都相当吸引人，但是对于我这种重度办公用户，它败就败在没有16:10的屏幕。最终我还是选择了幻16。</p>\n<p>幻16综合来说是一台素质非常不错的电脑（所谓“创意设计笔记本”）。相比于游戏本它的外观比较低调（虽然我觉得A面的彩虹亮片装饰还是有些张扬），然后键盘也没有花里胡哨的RGB灯。这种简洁的外观设计对办公人士是相当友好的。</p>\n<p>其次，幻16没有数字小键盘是另一个吸引我的设计。我个人还是比较喜欢Macbook上那种键盘布局的，数字小键盘对于我来说没多大用处而且占C面空间。取消小键盘带来的额外空间被用于布置扬声器。幻16上配置有6单元的扬声器，其音响效果非常不错，这是让我感到比较惊艳的一点。此外C面还安装有一块硕大的玻璃触控板，手感亦是上佳（虽然仍然比不上Macbook）。幻16的开机键集成了指纹解锁功能，免除了输入密码的烦恼，相当方便。</p>\n<p>这台电脑的屏幕素质亦是相当优秀：2K分辨率、16:10的比例、P3色域、165Hz刷新率、以及极高的屏占比。在日常使用中，我几乎不会感知到像素点。由于是IPS屏幕，因此其或多或少有点漏光。这块屏幕的素质足够胜任一般的图像处理与视频剪辑工作了。</p>\n<p>我入手的这台低配幻16的硬件属于标准的创意设计笔记本的配置：11代Intel酷睿i7，RTX3060（80W，6G显存），板载内存8G+一个最高可以扩展到32G的内存插槽（DDR4，3200MHz），标配三星512G的硬盘（PCIE-4）以及一个PCIE-3的M.2硬盘插槽。如果是高配版则有RTX3070（8G显存）以及16G板载内存。</p>\n<p>幻16的接口还是比较丰富的。它有一个雷电4口（USB Type-C）、三个USB3接口（1个USB Type-C，2个USB A）、RJ45网线接口、HDMI接口、3,5mm耳机/麦克风接口、DC电源接口。另外，幻16还配有一个读卡器，不过比较尴尬的是它是一个TF卡的读卡器……</p>\n<p>下面讲讲我觉得这台电脑存在的不足之处：</p>\n<ul>\n<li><p>品控不稳定：光这个点就可以说好多好多……</p>\n<p>根据网友反映，这台电脑存在品控问题有：</p>\n<ul>\n<li><p>屏幕弯曲（通病）</p>\n</li>\n<li><p>按压屏幕上缘摄像头周围会出现松动异响（通病）</p>\n</li>\n<li><p>屏幕漏光严重（部分出现）</p>\n</li>\n<li><p>电流声、电容高频啸叫（通病）</p>\n</li>\n<li><p>键盘按键喷漆不均匀，打开键盘背光漏光（本人独一家，目前网上还没有类似情况，已换）</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/rog_key_painting_issue.jpeg\" alt=\"奥创中心与禁用麦克风的按键上缘漏光\"></p>\n</li>\n<li><p>键盘按键（B、N键）不平（通病）</p>\n</li>\n</ul>\n</li>\n<li><p>C面上缘的指示灯太亮了，屏幕会反射灯光，有点影响体验，目前我把三个灯用黑胶布贴上了</p>\n</li>\n<li><p>在高负载时，风扇噪音实在太吵，在风扇转速最高时，我测得的人位噪声有50dB，另外即便如此C面还是很烫</p>\n</li>\n<li><p>C面的类肤质材料不易清洁</p>\n</li>\n</ul>\n<p>如果上面的几个问题可以解决，那么这台电脑就是我心目中的完美最强六边形战士笔记本了（可惜解决不了，解决了也不会是现在这个价格）。目前最接近我心目中的完美笔记本应该就是今年的Thinkpad X1 Extreme了，静待发售之后的测评吧！</p>\n<h1 id=\"解决幻16睡眠自动唤醒问题\"><a href=\"#解决幻16睡眠自动唤醒问题\" class=\"headerlink\" title=\"解决幻16睡眠自动唤醒问题\"></a>解决幻16睡眠自动唤醒问题</h1><p>之前说过，幻16是一台好机器，但也不完全是一台好机器。除了硬件上的一些瑕疵，软件上也有一些问题。这些软件上的问题，很多都是由Win10带来的😐。最大的一个问题就是它会在睡眠的时候自动唤醒。下面讲讲我解决这个问题的坑爹过程。</p>\n<p>某天在我睡觉时，原本在睡眠状态的电脑屏幕突然亮起，照亮了整个房间。过了一小会儿后屏幕又自动熄灭，电脑继续进入睡眠状态。见到如此情形，我顿时睡意全无，强迫症患者表示无法忍受。遂起身下床打开搜索引擎准备修bug。没想到这个bug一修就是将近3天。</p>\n<p>首先在事件查看器中看看引起睡眠唤醒的原因。检查我在睡觉的时间内记录的系统日志，这个时候电脑应该都在睡眠状态（包括开盖和合盖时睡眠的情况）。经过我的总结，导致电脑自动唤醒的原因有下面几个：</p>\n<ul>\n<li>Input Mouse</li>\n<li>Input Keyboard</li>\n<li>50（未知原因）</li>\n</ul>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_event_viewer.png\" alt=\"\"></p>\n<p>首先解决Input Mouse/Keyboard的问题。经过一番查询，网络提供的解决办法为：在设备管理器中展开<code>鼠标和其他指针设备</code>，右键点击设备打开<code>属性</code>，在<code>电源管理</code>一栏中取消勾选<code>允许此设备唤醒计算机</code>。由于我是用的是无线鼠标，因此还需要在<code>键盘</code>选项中对<code>HID Keyboard Device</code>执行相同的操作。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_mouse.png\" alt=\"\"></p>\n<p>设置完成以后按<code>WIN+L</code>锁屏进入闲置状态进行测试，电脑仍然出现了自动唤醒的问题。多次复现问题后查看系统日志，发现自动唤醒的原因仍然有Input Mouse/Keyboard。于是关闭鼠标电源，再次测试，问题依旧。怒，直接拔掉鼠标接收器，睡眠得以正常。但是如果要每次离开电脑的时候都拔掉鼠标接收器，不但很麻烦，而且容易把接收器弄丢。网友分析出现这种状况有可能是Win10离开模式的锅。</p>\n<p>右击电池图标进入<code>电源选项</code>，点击窗口右侧<code>更改计划设置</code>后再点击<code>更改高级电源设置</code>，在它的<code>睡眠</code>选项中竟然没有<code>允许离开模式策略</code>这个项设置。对比其他人的高级电源管理，我的电源管理中的可设置项只有寥寥几个。于是又是一番搜索，发现需要改注册表。于是按照方法修改注册表，解锁了大部分隐藏的设置（下一节会介绍）。关闭了离开模式以后再次进行测试，发现在锁屏状态下进入睡眠后仍然会有几率自动唤醒，无语。由电脑的电源指示灯我发现，锁定后电脑黑屏一段时间以后，指示灯才开始进行规律的闪烁，这标志着电脑真正进入睡眠状态了。而指示灯常亮且电脑黑屏时，电脑应该只是处于离开模式。于是我干脆把电脑在闲置状态下进入睡眠的时间缩短到5分钟，让鼠标在唤醒电脑之前直接让电脑从离开模式进入睡眠状态。至此，鼠标在无操作状态下唤醒电脑的问题得到了基本解决。</p>\n<p>为了解决鼠标自动唤醒电脑的这个问题，我还尝试过在终端中通过命令的形式来修改设置以解决问题，但是同样也没有效果，遂放弃。可以说这个问题没有得到根本的解决，只是通过缩短进入睡眠的时间将它掩盖了。</p>\n<p>本来以为问题已经解决了，但是！在晚上睡觉的时候，电脑屏幕又双叒亮了！暴起，合上屏幕继续睡觉、第二天起床查看系统日志，发现即使在合盖情况下，电脑仍会被唤醒，只是屏幕不会点亮而已。同时我还发现，电脑每隔一小时就会被唤醒一下，并且每次唤醒后系统日志的格式均如下所示：</p>\n<ul>\n<li>系统正在退出连接待机状态，原因: 50</li>\n<li>系统正在进入连接待机状态，原因: 50</li>\n<li>进程 C:\\Program Files\\ASUS\\ARMOURY CRATE Service\\ArmouryCrate.UserSessionHelper.exe (进程 ID: 9384)将策略方案从 {381b4222-f694-41f0-9685-ff5bb260df2e} 重置为 {381b4222-f694-41f0-9685-ff5bb260df2e}</li>\n</ul>\n<p>看样子这是奥创中心的服务，于是我去任务计划程序看看有什么程序是定时启动的。</p>\n<p>在任务计划程序中左侧一栏中展开<code>任务计划程序库</code>，选择<code>ASUS</code>一栏。比对我的电脑睡眠自动唤醒的时间，我发现了其中一个程序的触发时间匹配上了唤醒时间，而且被设定为每小时触发一次。我将触发条件更改为<code>当任何用户登录时</code>后再进行测试，结果发现问题依旧……</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_planned_mission.png\" alt=\"\"></p>\n<p>在走投无路的情况下，我直接把奥创中心卸载了，重启之后发现键盘背光没法亮了😑，只好又把奥创中心重新装了回去。突然我想到，如果不能删除奥创中心，我能不能只删除掉<code>ArmouryCrate.UserSessionHelper.exe</code>这个服务呢？</p>\n<p>打开任务管理器，找到<code>ArmouryCrate.UserSessionHelper.exe</code>，右键打开菜单并点击<code>打开文件所在位置</code>。尝试删除这个程序，提示程序正在运行中无法删除。尝试通过剪切将程序移出当前文件夹，成功！然后在任务管理器中结束<code>ARMOURY CRATE Service</code>，可以发现任务管理器中<code>ArmouryCrate.UserSessionHelper.exe</code>没有再自动启动。</p>\n<p>重启电脑后，经测试键盘背光灯可以正常工作。移除该服务后，奥创中心的功能会缺失不少，键盘上的奥创中心按键也无法再使用，但是核心功能——切换情景模式还是可以使用的。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_armoury_crate.png\" alt=\"\"></p>\n<p>再次进行睡眠测试，电脑终于不会再自动唤醒了！而且，电脑睡眠时不再烫手，风扇也不会再转了！</p>\n<p><strong>罪魁祸首就是奥创中心！</strong></p>\n<p>奥创中心将游戏本的性能和散热策略直接放在幻16上，只会让它又热又吵而且耗电还快。但其实把所有的锅都推给奥创中心是不太合理的，虽然这个软件确实垃圾。</p>\n<p>实际上<strong>最坑最坑的还是Windows 10强行推出的现代睡眠模式（S0睡眠）。</strong>这个睡眠模式不同于以往的S3睡眠，S0睡眠下电脑除屏幕外其他设备都是供电的，相当于手机的熄屏状态。此外，由于微软一意孤行推广S0睡眠，这种睡眠模式还无法更改，甚至bios里都没有更改睡眠模式的选项。像我之前的电脑能设置S3睡眠，就没这么多屁事。</p>\n<h1 id=\"电源管理解锁\"><a href=\"#电源管理解锁\" class=\"headerlink\" title=\"电源管理解锁\"></a>电源管理解锁</h1><p>在折腾幻16的睡眠问题的时候我发现，机器上Win10的高级电源管理与其他人相比少了很多设置项。经过一番搜索之后，发现要通过修改注册表的方式来解锁这些设置。下面讲讲具体方法。</p>\n<p>首先打开注册表编辑器，在左侧的资源管理器中找到这个文件夹：<code>计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power</code>。</p>\n<p>在这个文件夹下，<code>PowerSettings</code>文件夹中的项目为高级电源管理的所有设置项，<code>\\User\\PowerSchemes</code>文件夹中的项目为所有的电源计划。</p>\n<p>首先我们来解锁隐藏的电源计划。</p>\n<p>在<code>\\User\\PowerSchemes</code>的目录下随便点开一个文件夹，这里以<code>27fa6203-3987-4dcc-918d-748559d549ec</code>为例。选中该文件夹之后，在右侧的项目中有一项名称为<code>FriendlyName</code>，这个项目的数据（值）为<code>Performance</code>。因此，该文件夹中的内容为<code>性能</code>模式的设置项。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings1.png\" alt=\"\"></p>\n<p>展开该文件夹，选中<code>245d8541-3943-4422-b025-13a784f679b7</code>这个文件夹，可以看到如下图所示的设置项。其中，<code>ACSettingIndex</code>和<code>DCSettingIndex</code>分别为该电源计划在交流供电和电池供电的情况下的可用性。如果值为<code>0</code>，则在该情况下不可用。因此，为了解锁这个隐藏的电源计划，我们要将这个两个设置项的值都设为<code>1</code>。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings2.png\" alt=\"\"></p>\n<p>鼠标右键点击设置项，选择<code>修改</code>。在修改它的值之后点击确定，会出现错误提示：<code>无法编辑xxx。编辑该值时出错。</code>，这是因为你没有权限修改这个值。</p>\n<p>在左侧的资源管理器中右击当前文件夹，选择<code>权限</code>。</p>\n<ol>\n<li>在弹出的窗口中点击<code>高级</code>按钮</li>\n<li>在高级安全设置的窗口中，点击上方<code>所有者</code>右侧的蓝色<code>更改</code>选项</li>\n<li>然后还是在弹出的窗口中点击<code>高级</code>按钮</li>\n<li>在新的弹窗右侧点击<code>立即查找</code></li>\n<li>在窗口下方找到你的用户名后选中</li>\n<li>点击<code>确定</code></li>\n<li>点击<code>确定</code></li>\n<li>你可以看到<code>所有者</code>变为自己的账户名</li>\n</ol>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings3.png\" alt=\"\"></p>\n<p>执行完上面的步骤，你现在只是有了修改<strong>修改注册表的权限</strong>的权限，你还要执行下面的步骤以获得<strong>修改注册表</strong>的权限。</p>\n<ol>\n<li>在设置权限的窗口中点击<code>添加</code></li>\n<li>在弹出的窗口中点击<code>高级</code></li>\n<li>在新的弹窗右侧点击<code>立即查找</code></li>\n<li>在窗口下方找到你的用户名后选中</li>\n<li>点击<code>确定</code></li>\n<li>点击<code>确定</code></li>\n<li>在<code>权限</code>一栏中的<code>完全控制</code>项中勾选<code>允许</code></li>\n<li>点击<code>应用</code></li>\n<li>你可以在<code>组或用户名</code>中看到自己的账户名</li>\n</ol>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings4.png\" alt=\"\"></p>\n<p>点击<code>确定</code>关闭窗口，现在你应该可以修改该文件夹下注册表的值以解锁隐藏的电源计划了。修改完成后，在<code>电源选项</code>窗口中你可以发现，原本隐藏的电源计划出现了。</p>\n<p>对于其他隐藏的电源计划，依照上面的方法举一反三同样可以解锁。区别仅仅在于需要选择不同电源计划的文件夹。而不同电源计划的设置项：<code>ACSettingIndex</code>和<code>DCSettingIndex</code>所在的文件夹都是电源计划的文件夹下名为<code>245d8541-3943-4422-b025-13a784f679b7</code>的文件夹。</p>\n<p>然后来讲一下如何解锁高级电源管理的隐藏设置项。</p>\n<p>解锁高级电源管理的隐藏设置项不需要更改权限，所以操作起来相对简单。在<code>计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power\\PowerSettings</code>的路径下随便选择一个文件夹，这里以<code>238C9FA8-0AAD-41ED-83F4-97BE242C8F20</code>文件夹为例。选中之后，右侧<code>FriendlyName</code>项的值有<code>Sleep transition settings</code>，这指明了该文件夹下的设置项均为睡眠相关设置。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings5.png\" alt=\"\"></p>\n<p>点击该文件夹下的第二个文件夹<code>25DFA149-5DD1-4736-B5AB-E8A37B5B8187</code>，其右侧<code>FriendlyName</code>项的值有<code>Allow Away Mode Policy</code>。因此我们可以知道该项是用来设置离开模式的。对于任何一个设置项，只有<code>Attributes</code>的值为<code>2</code>时它才会在高级电源管理中显示，我们只需要右键<code>Attributes</code>并点击<code>修改</code>，将它的值改为<code>2</code>即可。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings6.png\" alt=\"\"></p>\n<p>对于其他隐藏的高级电源管理设置项，仿照上面的方法同样可以解锁。这里不再赘述。</p>\n","site":{"data":{}},"more":"<h1 id=\"简单聊聊幻16\"><a href=\"#简单聊聊幻16\" class=\"headerlink\" title=\"简单聊聊幻16\"></a>简单聊聊幻16</h1><p>最近换了一台ROG的幻16，我对这台电脑各方面都还比较满意。最开始我是想买xps17的，但是xps9710今年的更新只把显卡升级到了3060（60W丐中丐），然后可选配置砍了好多，同配置9710比9700还贵了1k+。可能戴尔这定价策略就是普确信吧😅。把xps17从选择中一脚踹走之后，我把幻16、灵越16plus、Thinkbook 16p、灵刃15纳入了考虑范围。但是灵越16plus散热拉胯，Thinkbook 16p实在太丑，于是也被排除。决赛圈是幻16和灵刃15。灵刃15的外观和性能都相当吸引人，但是对于我这种重度办公用户，它败就败在没有16:10的屏幕。最终我还是选择了幻16。</p>\n<p>幻16综合来说是一台素质非常不错的电脑（所谓“创意设计笔记本”）。相比于游戏本它的外观比较低调（虽然我觉得A面的彩虹亮片装饰还是有些张扬），然后键盘也没有花里胡哨的RGB灯。这种简洁的外观设计对办公人士是相当友好的。</p>\n<p>其次，幻16没有数字小键盘是另一个吸引我的设计。我个人还是比较喜欢Macbook上那种键盘布局的，数字小键盘对于我来说没多大用处而且占C面空间。取消小键盘带来的额外空间被用于布置扬声器。幻16上配置有6单元的扬声器，其音响效果非常不错，这是让我感到比较惊艳的一点。此外C面还安装有一块硕大的玻璃触控板，手感亦是上佳（虽然仍然比不上Macbook）。幻16的开机键集成了指纹解锁功能，免除了输入密码的烦恼，相当方便。</p>\n<p>这台电脑的屏幕素质亦是相当优秀：2K分辨率、16:10的比例、P3色域、165Hz刷新率、以及极高的屏占比。在日常使用中，我几乎不会感知到像素点。由于是IPS屏幕，因此其或多或少有点漏光。这块屏幕的素质足够胜任一般的图像处理与视频剪辑工作了。</p>\n<p>我入手的这台低配幻16的硬件属于标准的创意设计笔记本的配置：11代Intel酷睿i7，RTX3060（80W，6G显存），板载内存8G+一个最高可以扩展到32G的内存插槽（DDR4，3200MHz），标配三星512G的硬盘（PCIE-4）以及一个PCIE-3的M.2硬盘插槽。如果是高配版则有RTX3070（8G显存）以及16G板载内存。</p>\n<p>幻16的接口还是比较丰富的。它有一个雷电4口（USB Type-C）、三个USB3接口（1个USB Type-C，2个USB A）、RJ45网线接口、HDMI接口、3,5mm耳机/麦克风接口、DC电源接口。另外，幻16还配有一个读卡器，不过比较尴尬的是它是一个TF卡的读卡器……</p>\n<p>下面讲讲我觉得这台电脑存在的不足之处：</p>\n<ul>\n<li><p>品控不稳定：光这个点就可以说好多好多……</p>\n<p>根据网友反映，这台电脑存在品控问题有：</p>\n<ul>\n<li><p>屏幕弯曲（通病）</p>\n</li>\n<li><p>按压屏幕上缘摄像头周围会出现松动异响（通病）</p>\n</li>\n<li><p>屏幕漏光严重（部分出现）</p>\n</li>\n<li><p>电流声、电容高频啸叫（通病）</p>\n</li>\n<li><p>键盘按键喷漆不均匀，打开键盘背光漏光（本人独一家，目前网上还没有类似情况，已换）</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/rog_key_painting_issue.jpeg\" alt=\"奥创中心与禁用麦克风的按键上缘漏光\"></p>\n</li>\n<li><p>键盘按键（B、N键）不平（通病）</p>\n</li>\n</ul>\n</li>\n<li><p>C面上缘的指示灯太亮了，屏幕会反射灯光，有点影响体验，目前我把三个灯用黑胶布贴上了</p>\n</li>\n<li><p>在高负载时，风扇噪音实在太吵，在风扇转速最高时，我测得的人位噪声有50dB，另外即便如此C面还是很烫</p>\n</li>\n<li><p>C面的类肤质材料不易清洁</p>\n</li>\n</ul>\n<p>如果上面的几个问题可以解决，那么这台电脑就是我心目中的完美最强六边形战士笔记本了（可惜解决不了，解决了也不会是现在这个价格）。目前最接近我心目中的完美笔记本应该就是今年的Thinkpad X1 Extreme了，静待发售之后的测评吧！</p>\n<h1 id=\"解决幻16睡眠自动唤醒问题\"><a href=\"#解决幻16睡眠自动唤醒问题\" class=\"headerlink\" title=\"解决幻16睡眠自动唤醒问题\"></a>解决幻16睡眠自动唤醒问题</h1><p>之前说过，幻16是一台好机器，但也不完全是一台好机器。除了硬件上的一些瑕疵，软件上也有一些问题。这些软件上的问题，很多都是由Win10带来的😐。最大的一个问题就是它会在睡眠的时候自动唤醒。下面讲讲我解决这个问题的坑爹过程。</p>\n<p>某天在我睡觉时，原本在睡眠状态的电脑屏幕突然亮起，照亮了整个房间。过了一小会儿后屏幕又自动熄灭，电脑继续进入睡眠状态。见到如此情形，我顿时睡意全无，强迫症患者表示无法忍受。遂起身下床打开搜索引擎准备修bug。没想到这个bug一修就是将近3天。</p>\n<p>首先在事件查看器中看看引起睡眠唤醒的原因。检查我在睡觉的时间内记录的系统日志，这个时候电脑应该都在睡眠状态（包括开盖和合盖时睡眠的情况）。经过我的总结，导致电脑自动唤醒的原因有下面几个：</p>\n<ul>\n<li>Input Mouse</li>\n<li>Input Keyboard</li>\n<li>50（未知原因）</li>\n</ul>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_event_viewer.png\" alt=\"\"></p>\n<p>首先解决Input Mouse/Keyboard的问题。经过一番查询，网络提供的解决办法为：在设备管理器中展开<code>鼠标和其他指针设备</code>，右键点击设备打开<code>属性</code>，在<code>电源管理</code>一栏中取消勾选<code>允许此设备唤醒计算机</code>。由于我是用的是无线鼠标，因此还需要在<code>键盘</code>选项中对<code>HID Keyboard Device</code>执行相同的操作。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_mouse.png\" alt=\"\"></p>\n<p>设置完成以后按<code>WIN+L</code>锁屏进入闲置状态进行测试，电脑仍然出现了自动唤醒的问题。多次复现问题后查看系统日志，发现自动唤醒的原因仍然有Input Mouse/Keyboard。于是关闭鼠标电源，再次测试，问题依旧。怒，直接拔掉鼠标接收器，睡眠得以正常。但是如果要每次离开电脑的时候都拔掉鼠标接收器，不但很麻烦，而且容易把接收器弄丢。网友分析出现这种状况有可能是Win10离开模式的锅。</p>\n<p>右击电池图标进入<code>电源选项</code>，点击窗口右侧<code>更改计划设置</code>后再点击<code>更改高级电源设置</code>，在它的<code>睡眠</code>选项中竟然没有<code>允许离开模式策略</code>这个项设置。对比其他人的高级电源管理，我的电源管理中的可设置项只有寥寥几个。于是又是一番搜索，发现需要改注册表。于是按照方法修改注册表，解锁了大部分隐藏的设置（下一节会介绍）。关闭了离开模式以后再次进行测试，发现在锁屏状态下进入睡眠后仍然会有几率自动唤醒，无语。由电脑的电源指示灯我发现，锁定后电脑黑屏一段时间以后，指示灯才开始进行规律的闪烁，这标志着电脑真正进入睡眠状态了。而指示灯常亮且电脑黑屏时，电脑应该只是处于离开模式。于是我干脆把电脑在闲置状态下进入睡眠的时间缩短到5分钟，让鼠标在唤醒电脑之前直接让电脑从离开模式进入睡眠状态。至此，鼠标在无操作状态下唤醒电脑的问题得到了基本解决。</p>\n<p>为了解决鼠标自动唤醒电脑的这个问题，我还尝试过在终端中通过命令的形式来修改设置以解决问题，但是同样也没有效果，遂放弃。可以说这个问题没有得到根本的解决，只是通过缩短进入睡眠的时间将它掩盖了。</p>\n<p>本来以为问题已经解决了，但是！在晚上睡觉的时候，电脑屏幕又双叒亮了！暴起，合上屏幕继续睡觉、第二天起床查看系统日志，发现即使在合盖情况下，电脑仍会被唤醒，只是屏幕不会点亮而已。同时我还发现，电脑每隔一小时就会被唤醒一下，并且每次唤醒后系统日志的格式均如下所示：</p>\n<ul>\n<li>系统正在退出连接待机状态，原因: 50</li>\n<li>系统正在进入连接待机状态，原因: 50</li>\n<li>进程 C:\\Program Files\\ASUS\\ARMOURY CRATE Service\\ArmouryCrate.UserSessionHelper.exe (进程 ID: 9384)将策略方案从 {381b4222-f694-41f0-9685-ff5bb260df2e} 重置为 {381b4222-f694-41f0-9685-ff5bb260df2e}</li>\n</ul>\n<p>看样子这是奥创中心的服务，于是我去任务计划程序看看有什么程序是定时启动的。</p>\n<p>在任务计划程序中左侧一栏中展开<code>任务计划程序库</code>，选择<code>ASUS</code>一栏。比对我的电脑睡眠自动唤醒的时间，我发现了其中一个程序的触发时间匹配上了唤醒时间，而且被设定为每小时触发一次。我将触发条件更改为<code>当任何用户登录时</code>后再进行测试，结果发现问题依旧……</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_planned_mission.png\" alt=\"\"></p>\n<p>在走投无路的情况下，我直接把奥创中心卸载了，重启之后发现键盘背光没法亮了😑，只好又把奥创中心重新装了回去。突然我想到，如果不能删除奥创中心，我能不能只删除掉<code>ArmouryCrate.UserSessionHelper.exe</code>这个服务呢？</p>\n<p>打开任务管理器，找到<code>ArmouryCrate.UserSessionHelper.exe</code>，右键打开菜单并点击<code>打开文件所在位置</code>。尝试删除这个程序，提示程序正在运行中无法删除。尝试通过剪切将程序移出当前文件夹，成功！然后在任务管理器中结束<code>ARMOURY CRATE Service</code>，可以发现任务管理器中<code>ArmouryCrate.UserSessionHelper.exe</code>没有再自动启动。</p>\n<p>重启电脑后，经测试键盘背光灯可以正常工作。移除该服务后，奥创中心的功能会缺失不少，键盘上的奥创中心按键也无法再使用，但是核心功能——切换情景模式还是可以使用的。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_armoury_crate.png\" alt=\"\"></p>\n<p>再次进行睡眠测试，电脑终于不会再自动唤醒了！而且，电脑睡眠时不再烫手，风扇也不会再转了！</p>\n<p><strong>罪魁祸首就是奥创中心！</strong></p>\n<p>奥创中心将游戏本的性能和散热策略直接放在幻16上，只会让它又热又吵而且耗电还快。但其实把所有的锅都推给奥创中心是不太合理的，虽然这个软件确实垃圾。</p>\n<p>实际上<strong>最坑最坑的还是Windows 10强行推出的现代睡眠模式（S0睡眠）。</strong>这个睡眠模式不同于以往的S3睡眠，S0睡眠下电脑除屏幕外其他设备都是供电的，相当于手机的熄屏状态。此外，由于微软一意孤行推广S0睡眠，这种睡眠模式还无法更改，甚至bios里都没有更改睡眠模式的选项。像我之前的电脑能设置S3睡眠，就没这么多屁事。</p>\n<h1 id=\"电源管理解锁\"><a href=\"#电源管理解锁\" class=\"headerlink\" title=\"电源管理解锁\"></a>电源管理解锁</h1><p>在折腾幻16的睡眠问题的时候我发现，机器上Win10的高级电源管理与其他人相比少了很多设置项。经过一番搜索之后，发现要通过修改注册表的方式来解锁这些设置。下面讲讲具体方法。</p>\n<p>首先打开注册表编辑器，在左侧的资源管理器中找到这个文件夹：<code>计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power</code>。</p>\n<p>在这个文件夹下，<code>PowerSettings</code>文件夹中的项目为高级电源管理的所有设置项，<code>\\User\\PowerSchemes</code>文件夹中的项目为所有的电源计划。</p>\n<p>首先我们来解锁隐藏的电源计划。</p>\n<p>在<code>\\User\\PowerSchemes</code>的目录下随便点开一个文件夹，这里以<code>27fa6203-3987-4dcc-918d-748559d549ec</code>为例。选中该文件夹之后，在右侧的项目中有一项名称为<code>FriendlyName</code>，这个项目的数据（值）为<code>Performance</code>。因此，该文件夹中的内容为<code>性能</code>模式的设置项。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings1.png\" alt=\"\"></p>\n<p>展开该文件夹，选中<code>245d8541-3943-4422-b025-13a784f679b7</code>这个文件夹，可以看到如下图所示的设置项。其中，<code>ACSettingIndex</code>和<code>DCSettingIndex</code>分别为该电源计划在交流供电和电池供电的情况下的可用性。如果值为<code>0</code>，则在该情况下不可用。因此，为了解锁这个隐藏的电源计划，我们要将这个两个设置项的值都设为<code>1</code>。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings2.png\" alt=\"\"></p>\n<p>鼠标右键点击设置项，选择<code>修改</code>。在修改它的值之后点击确定，会出现错误提示：<code>无法编辑xxx。编辑该值时出错。</code>，这是因为你没有权限修改这个值。</p>\n<p>在左侧的资源管理器中右击当前文件夹，选择<code>权限</code>。</p>\n<ol>\n<li>在弹出的窗口中点击<code>高级</code>按钮</li>\n<li>在高级安全设置的窗口中，点击上方<code>所有者</code>右侧的蓝色<code>更改</code>选项</li>\n<li>然后还是在弹出的窗口中点击<code>高级</code>按钮</li>\n<li>在新的弹窗右侧点击<code>立即查找</code></li>\n<li>在窗口下方找到你的用户名后选中</li>\n<li>点击<code>确定</code></li>\n<li>点击<code>确定</code></li>\n<li>你可以看到<code>所有者</code>变为自己的账户名</li>\n</ol>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings3.png\" alt=\"\"></p>\n<p>执行完上面的步骤，你现在只是有了修改<strong>修改注册表的权限</strong>的权限，你还要执行下面的步骤以获得<strong>修改注册表</strong>的权限。</p>\n<ol>\n<li>在设置权限的窗口中点击<code>添加</code></li>\n<li>在弹出的窗口中点击<code>高级</code></li>\n<li>在新的弹窗右侧点击<code>立即查找</code></li>\n<li>在窗口下方找到你的用户名后选中</li>\n<li>点击<code>确定</code></li>\n<li>点击<code>确定</code></li>\n<li>在<code>权限</code>一栏中的<code>完全控制</code>项中勾选<code>允许</code></li>\n<li>点击<code>应用</code></li>\n<li>你可以在<code>组或用户名</code>中看到自己的账户名</li>\n</ol>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings4.png\" alt=\"\"></p>\n<p>点击<code>确定</code>关闭窗口，现在你应该可以修改该文件夹下注册表的值以解锁隐藏的电源计划了。修改完成后，在<code>电源选项</code>窗口中你可以发现，原本隐藏的电源计划出现了。</p>\n<p>对于其他隐藏的电源计划，依照上面的方法举一反三同样可以解锁。区别仅仅在于需要选择不同电源计划的文件夹。而不同电源计划的设置项：<code>ACSettingIndex</code>和<code>DCSettingIndex</code>所在的文件夹都是电源计划的文件夹下名为<code>245d8541-3943-4422-b025-13a784f679b7</code>的文件夹。</p>\n<p>然后来讲一下如何解锁高级电源管理的隐藏设置项。</p>\n<p>解锁高级电源管理的隐藏设置项不需要更改权限，所以操作起来相对简单。在<code>计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Power\\PowerSettings</code>的路径下随便选择一个文件夹，这里以<code>238C9FA8-0AAD-41ED-83F4-97BE242C8F20</code>文件夹为例。选中之后，右侧<code>FriendlyName</code>项的值有<code>Sleep transition settings</code>，这指明了该文件夹下的设置项均为睡眠相关设置。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings5.png\" alt=\"\"></p>\n<p>点击该文件夹下的第二个文件夹<code>25DFA149-5DD1-4736-B5AB-E8A37B5B8187</code>，其右侧<code>FriendlyName</code>项的值有<code>Allow Away Mode Policy</code>。因此我们可以知道该项是用来设置离开模式的。对于任何一个设置项，只有<code>Attributes</code>的值为<code>2</code>时它才会在高级电源管理中显示，我们只需要右键<code>Attributes</code>并点击<code>修改</code>，将它的值改为<code>2</code>即可。</p>\n<p><img src=\"https://astrobear.top/resource/astroblog/content/sleep_issue_power_settings6.png\" alt=\"\"></p>\n<p>对于其他隐藏的高级电源管理设置项，仿照上面的方法同样可以解锁。这里不再赘述。</p>\n"},{"title":"欢迎来到Astroblog！","date":"2020-01-03T12:47:00.000Z","cover":"https://astrobear.top/resource/astroblog/thumbnail/t2.jpg","thumbnail":"https://astrobear.top/resource/astroblog/thumbnail/t2.jpg","excerpt":"Astroblog是Astrobear的基地！这里有知识，方法，还有更多！","toc":false,"widgets":[{"position":"left","type":"profile","author":"Astrobear","author_title":"Building my fortress.","location":"PRC","avatar":"/img/avatar.jpeg","avatar_rounded":true,"gravatar":null,"follow_link":"https://github.com/Astrobr","social_links":{"Github":{"icon":"fab fa-github","url":"https://github.com/Astrobr"},"Facebook":{"icon":"fab fa-facebook","url":"https://www.facebook.com/astrobearforwork"},"Instagram":{"icon":"fab fa-instagram","url":"https://www.instagram.com/astrobarchen/"}}},{"position":"left","type":"toc","index":true,"collapsed":false,"depth":3},{"position":"left","type":"categories"},{"position":"right","type":"recent_posts"},{"position":"right","type":"archives"},{"position":"left","type":"tags"}],"_content":"\n## 渊源\n\n本人2019年4月在华为云购买了一台云服务器。本来打算是为了给自己“未来要做的“微信小程序提供后端服务的，但是后来没有再继续做小程序。为了将服务器继续利用起来，便有了这个博客。\n\n## 简介\n\nAstroblog是我个人的技术总结与备忘，其中可能包括以下内容：\n\n- 课程学习总结\n- 与计算机技术相关的总结，比如一些教程或方法等，用作备忘\n\n- 模拟飞行与民航知识，音乐知识，天文摄影后期技术总结\n- 个人摄影作品以及其他优秀摄影作品的展览\n- 其他内容\n\n## 关于Astrobear\n\n站长现在是一名大学生，专业方向是控制工程。自小喜欢航空、音乐、摄影、天文，对计算机技术也有一定兴趣。\n\n由于本人才疏学浅，博客中大部分文章的主题也并非我专业所学，所以有错漏之处在所难免，还请大家批评指正！\n\n","source":"_posts/About.md","raw":"---\ntitle: 欢迎来到Astroblog！\ndate: 2020-1-3 20:47\ncategories: \n\t- [Others]\n\t#- [cate2]\n\t#...\ntags: \n\t- Astrobear\n\t- Life\n\t- Others\n\t#...\n\n#If you need a thumbnail photo for your post, delete the well number below and finish the directory.\ncover: https://astrobear.top/resource/astroblog/thumbnail/t2.jpg\n\nthumbnail: https://astrobear.top/resource/astroblog/thumbnail/t2.jpg\n\n#If you need to customize your excerpt, delete the well number below and input something. You can also input <!-- more --> in your article to divide the excerpt and other contents.\nexcerpt: Astroblog是Astrobear的基地！这里有知识，方法，还有更多！\n\ntoc: false\n\nwidgets:\n    # Profile widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: profile\n        # Author name\n        author: Astrobear\n        # Author title\n        author_title: Building my fortress.\n        # Author's current location\n        location: PRC\n        # URL or path to the avatar image\n        avatar: /img/avatar.jpeg\n        # Whether show the rounded avatar image\n        avatar_rounded: true\n        # Email address for the Gravatar\n        gravatar: \n        # URL or path for the follow button\n        follow_link: 'https://github.com/Astrobr'\n        # Links to be shown on the bottom of the profile widget\n        social_links:\n            Github:\n                icon: fab fa-github\n                url: 'https://github.com/Astrobr'\n            Facebook:\n                icon: fab fa-facebook\n                url: 'https://www.facebook.com/astrobearforwork'\n            Instagram:\n                icon: fab fa-instagram\n                url: 'https://www.instagram.com/astrobarchen/'\n    # Table of contents widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: toc\n        # Whether to show the index of each heading\n        index: true\n        # Whether to collapse sub-headings when they are out-of-view\n        collapsed: false\n        # Maximum level of headings to show (1-6)\n        depth: 3\n    # Recommendation links widget configurations\n    #-\n        # Where should the widget be placed, left sidebar or right sidebar\n    #    position: left\n    #    type: links\n        # Names and URLs of the sites\n    #    links:\n    #        Hexo: 'https://hexo.io'\n    #        Bulma: 'https://bulma.io'\n    # Categories widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: categories\n    # Recent posts widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: right\n        type: recent_posts\n    # Archives widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: right\n        type: archives\n    # Tags widget configurations\n    -\n        # Where should the widget be placed, left sidebar or right sidebar\n        position: left\n        type: tags\n\n\n#You can begin to input your article below now.\n\n---\n\n## 渊源\n\n本人2019年4月在华为云购买了一台云服务器。本来打算是为了给自己“未来要做的“微信小程序提供后端服务的，但是后来没有再继续做小程序。为了将服务器继续利用起来，便有了这个博客。\n\n## 简介\n\nAstroblog是我个人的技术总结与备忘，其中可能包括以下内容：\n\n- 课程学习总结\n- 与计算机技术相关的总结，比如一些教程或方法等，用作备忘\n\n- 模拟飞行与民航知识，音乐知识，天文摄影后期技术总结\n- 个人摄影作品以及其他优秀摄影作品的展览\n- 其他内容\n\n## 关于Astrobear\n\n站长现在是一名大学生，专业方向是控制工程。自小喜欢航空、音乐、摄影、天文，对计算机技术也有一定兴趣。\n\n由于本人才疏学浅，博客中大部分文章的主题也并非我专业所学，所以有错漏之处在所难免，还请大家批评指正！\n\n","slug":"About","published":1,"updated":"2022-08-29T02:14:00.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl9tlzz0d001z1q3982gmcz7b","content":"<h2 id=\"渊源\"><a href=\"#渊源\" class=\"headerlink\" title=\"渊源\"></a>渊源</h2><p>本人2019年4月在华为云购买了一台云服务器。本来打算是为了给自己“未来要做的“微信小程序提供后端服务的，但是后来没有再继续做小程序。为了将服务器继续利用起来，便有了这个博客。</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>Astroblog是我个人的技术总结与备忘，其中可能包括以下内容：</p>\n<ul>\n<li><p>课程学习总结</p>\n</li>\n<li><p>与计算机技术相关的总结，比如一些教程或方法等，用作备忘</p>\n</li>\n<li><p>模拟飞行与民航知识，音乐知识，天文摄影后期技术总结</p>\n</li>\n<li><p>个人摄影作品以及其他优秀摄影作品的展览</p>\n</li>\n<li><p>其他内容</p>\n</li>\n</ul>\n<h2 id=\"关于Astrobear\"><a href=\"#关于Astrobear\" class=\"headerlink\" title=\"关于Astrobear\"></a>关于Astrobear</h2><p>站长现在是一名大学生，专业方向是控制工程。自小喜欢航空、音乐、摄影、天文，对计算机技术也有一定兴趣。</p>\n<p>由于本人才疏学浅，博客中大部分文章的主题也并非我专业所学，所以有错漏之处在所难免，还请大家批评指正！</p>\n","site":{"data":{}},"more":"<h2 id=\"渊源\"><a href=\"#渊源\" class=\"headerlink\" title=\"渊源\"></a>渊源</h2><p>本人2019年4月在华为云购买了一台云服务器。本来打算是为了给自己“未来要做的“微信小程序提供后端服务的，但是后来没有再继续做小程序。为了将服务器继续利用起来，便有了这个博客。</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>Astroblog是我个人的技术总结与备忘，其中可能包括以下内容：</p>\n<ul>\n<li><p>课程学习总结</p>\n</li>\n<li><p>与计算机技术相关的总结，比如一些教程或方法等，用作备忘</p>\n</li>\n<li><p>模拟飞行与民航知识，音乐知识，天文摄影后期技术总结</p>\n</li>\n<li><p>个人摄影作品以及其他优秀摄影作品的展览</p>\n</li>\n<li><p>其他内容</p>\n</li>\n</ul>\n<h2 id=\"关于Astrobear\"><a href=\"#关于Astrobear\" class=\"headerlink\" title=\"关于Astrobear\"></a>关于Astrobear</h2><p>站长现在是一名大学生，专业方向是控制工程。自小喜欢航空、音乐、摄影、天文，对计算机技术也有一定兴趣。</p>\n<p>由于本人才疏学浅，博客中大部分文章的主题也并非我专业所学，所以有错漏之处在所难免，还请大家批评指正！</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl9tlzyzq00051q39h1xcgn54","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzyzu000e1q394o9370ol"},{"post_id":"cl9tlzyzf00001q39cp3mcdm8","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzyzv000g1q39g7bxfxcr"},{"post_id":"cl9tlzyzr00061q3915czaqwm","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzyzx000k1q39elae13ms"},{"post_id":"cl9tlzyzs00091q390um1aueu","category_id":"cl9tlzyzs00081q39fe8oawdg","_id":"cl9tlzyzz000n1q39gmnd1c2g"},{"post_id":"cl9tlzyzk00011q39cmft76d3","category_id":"cl9tlzyzs00081q39fe8oawdg","_id":"cl9tlzz00000r1q394d8p5szg"},{"post_id":"cl9tlzyzu000d1q394rsx43zq","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz01000u1q39bw04hp2e"},{"post_id":"cl9tlzyzo00031q3941r63aj4","category_id":"cl9tlzyzu000c1q394c486gzi","_id":"cl9tlzz02000w1q393w0e7xq5"},{"post_id":"cl9tlzyzv000f1q39eqrrh1vb","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz03000z1q39habe24ie"},{"post_id":"cl9tlzyzw000j1q39hyq2hhzs","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0400111q39diic7jnd"},{"post_id":"cl9tlzyzt000a1q398xmvcq6p","category_id":"cl9tlzyzu000c1q394c486gzi","_id":"cl9tlzz0500141q39bg130t78"},{"post_id":"cl9tlzz00000q1q396ty244vj","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0600161q390yfdcjkf"},{"post_id":"cl9tlzz01000t1q394rv59ewq","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0600191q39gjnuactg"},{"post_id":"cl9tlzz02000v1q39e4fzc75g","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz07001b1q39eeff85pu"},{"post_id":"cl9tlzz02000y1q391o2j9t17","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz08001e1q3915lvc7d3"},{"post_id":"cl9tlzz0300101q39885vhvn6","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz09001h1q39bqzpamf6"},{"post_id":"cl9tlzz0400131q39awgs99c3","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz09001k1q399xef3ltv"},{"post_id":"cl9tlzz0500151q397ndt93dj","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0a001o1q39bjby2phm"},{"post_id":"cl9tlzz0600181q39gybv6j8h","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0b001r1q39ea666h7v"},{"post_id":"cl9tlzz07001a1q39627y9jcu","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0b001v1q399cqg9t02"},{"post_id":"cl9tlzz08001d1q397nos3ajy","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0c001x1q39ab5dbada"},{"post_id":"cl9tlzz09001j1q395i7n56zg","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0d00201q3942l81dcl"},{"post_id":"cl9tlzz0a001n1q3944n40isw","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0d00221q393grh5u7l"},{"post_id":"cl9tlzz0a001q1q397ocd9pax","category_id":"cl9tlzyzp00041q3966ug23zb","_id":"cl9tlzz0e00251q390tyw4id3"},{"post_id":"cl9tlzz0b001u1q394vbe1cjm","category_id":"cl9tlzyzs00081q39fe8oawdg","_id":"cl9tlzz0e00271q392scvh429"},{"post_id":"cl9tlzz0c001w1q391dpy0ggd","category_id":"cl9tlzyzs00081q39fe8oawdg","_id":"cl9tlzz0e00291q3900f3fakk"},{"post_id":"cl9tlzz0d001z1q3982gmcz7b","category_id":"cl9tlzyzs00081q39fe8oawdg","_id":"cl9tlzz0e002c1q3952tp8svm"}],"PostTag":[{"post_id":"cl9tlzyzf00001q39cp3mcdm8","tag_id":"cl9tlzyzn00021q398b2l6xr6","_id":"cl9tlzyzy000l1q39eu5v54hc"},{"post_id":"cl9tlzyzf00001q39cp3mcdm8","tag_id":"cl9tlzyzr00071q392fv5hzcv","_id":"cl9tlzyzz000o1q391bvbf0yf"},{"post_id":"cl9tlzyzf00001q39cp3mcdm8","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz00000s1q39ehyv2hiz"},{"post_id":"cl9tlzyzk00011q39cmft76d3","tag_id":"cl9tlzyzw000h1q392nyw8m0y","_id":"cl9tlzz08001f1q3950rl9wpr"},{"post_id":"cl9tlzyzk00011q39cmft76d3","tag_id":"cl9tlzyzz000p1q398ube8alu","_id":"cl9tlzz09001i1q39eyew88t7"},{"post_id":"cl9tlzyzk00011q39cmft76d3","tag_id":"cl9tlzz02000x1q39gqs3891c","_id":"cl9tlzz0a001m1q3903g44pyq"},{"post_id":"cl9tlzyzk00011q39cmft76d3","tag_id":"cl9tlzz0400121q3991rq5ju2","_id":"cl9tlzz0a001p1q3963iu14nm"},{"post_id":"cl9tlzyzk00011q39cmft76d3","tag_id":"cl9tlzz0600171q396erw7yyr","_id":"cl9tlzz0b001t1q393u3w62mh"},{"post_id":"cl9tlzyzo00031q3941r63aj4","tag_id":"cl9tlzz07001c1q39bf148vz0","_id":"cl9tlzz0d00211q39h6w2gla6"},{"post_id":"cl9tlzyzo00031q3941r63aj4","tag_id":"cl9tlzz09001l1q39800lb47c","_id":"cl9tlzz0d00231q39dd3w6ooz"},{"post_id":"cl9tlzyzo00031q3941r63aj4","tag_id":"cl9tlzz0b001s1q394ncghax3","_id":"cl9tlzz0e00261q395zcsaw6y"},{"post_id":"cl9tlzz0d001z1q3982gmcz7b","tag_id":"cl9tlzz0600171q396erw7yyr","_id":"cl9tlzz0e00281q39ahtzf5zj"},{"post_id":"cl9tlzz0d001z1q3982gmcz7b","tag_id":"cl9tlzz02000x1q39gqs3891c","_id":"cl9tlzz0e002b1q39949b7ci0"},{"post_id":"cl9tlzz0d001z1q3982gmcz7b","tag_id":"cl9tlzz0400121q3991rq5ju2","_id":"cl9tlzz0e002d1q39eeh8ccke"},{"post_id":"cl9tlzyzq00051q39h1xcgn54","tag_id":"cl9tlzz0c001y1q39h8233eo2","_id":"cl9tlzz0e002f1q3934iwhkgc"},{"post_id":"cl9tlzyzq00051q39h1xcgn54","tag_id":"cl9tlzz0d00241q395vhe78u4","_id":"cl9tlzz0f002g1q399ycacpiw"},{"post_id":"cl9tlzyzq00051q39h1xcgn54","tag_id":"cl9tlzz0e002a1q39b5704srg","_id":"cl9tlzz0f002i1q395093e9fx"},{"post_id":"cl9tlzyzr00061q3915czaqwm","tag_id":"cl9tlzz0c001y1q39h8233eo2","_id":"cl9tlzz0f002l1q39dpmtggtr"},{"post_id":"cl9tlzyzr00061q3915czaqwm","tag_id":"cl9tlzz0f002h1q394wke4tsl","_id":"cl9tlzz0f002m1q396kcy6em4"},{"post_id":"cl9tlzyzr00061q3915czaqwm","tag_id":"cl9tlzz0e002a1q39b5704srg","_id":"cl9tlzz0g002o1q3977ms8b3t"},{"post_id":"cl9tlzyzs00091q390um1aueu","tag_id":"cl9tlzz0c001y1q39h8233eo2","_id":"cl9tlzz0g002r1q391n4l9pr9"},{"post_id":"cl9tlzyzs00091q390um1aueu","tag_id":"cl9tlzz0f002h1q394wke4tsl","_id":"cl9tlzz0g002s1q39biid86y1"},{"post_id":"cl9tlzyzs00091q390um1aueu","tag_id":"cl9tlzz0g002p1q397jllet6j","_id":"cl9tlzz0g002u1q39d3xjel2p"},{"post_id":"cl9tlzyzt000a1q398xmvcq6p","tag_id":"cl9tlzz07001c1q39bf148vz0","_id":"cl9tlzz0h002w1q398q7546qp"},{"post_id":"cl9tlzyzt000a1q398xmvcq6p","tag_id":"cl9tlzz09001l1q39800lb47c","_id":"cl9tlzz0h002x1q3993q46h4c"},{"post_id":"cl9tlzyzu000d1q394rsx43zq","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz0h002z1q39dlbi9qcs"},{"post_id":"cl9tlzyzu000d1q394rsx43zq","tag_id":"cl9tlzz0h002v1q395of228g9","_id":"cl9tlzz0h00301q39gyj70j7a"},{"post_id":"cl9tlzyzv000f1q39eqrrh1vb","tag_id":"cl9tlzz0h002y1q398vz73f92","_id":"cl9tlzz0h00321q39758ed8gv"},{"post_id":"cl9tlzyzv000f1q39eqrrh1vb","tag_id":"cl9tlzyzr00071q392fv5hzcv","_id":"cl9tlzz0i00331q393k8k0upr"},{"post_id":"cl9tlzyzv000f1q39eqrrh1vb","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz0i00351q398gh4f5vw"},{"post_id":"cl9tlzyzw000j1q39hyq2hhzs","tag_id":"cl9tlzz0h002y1q398vz73f92","_id":"cl9tlzz0i00361q391tnt1dwq"},{"post_id":"cl9tlzyzw000j1q39hyq2hhzs","tag_id":"cl9tlzyzr00071q392fv5hzcv","_id":"cl9tlzz0i00381q39aghfcg1u"},{"post_id":"cl9tlzyzw000j1q39hyq2hhzs","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz0i00391q39emcp9r3u"},{"post_id":"cl9tlzz00000q1q396ty244vj","tag_id":"cl9tlzz0h002y1q398vz73f92","_id":"cl9tlzz0j003b1q394qav67bl"},{"post_id":"cl9tlzz00000q1q396ty244vj","tag_id":"cl9tlzyzr00071q392fv5hzcv","_id":"cl9tlzz0j003c1q39atydf2pg"},{"post_id":"cl9tlzz00000q1q396ty244vj","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz0j003e1q39cccjaxdu"},{"post_id":"cl9tlzz01000t1q394rv59ewq","tag_id":"cl9tlzz0h002y1q398vz73f92","_id":"cl9tlzz0j003f1q3922gj2j4t"},{"post_id":"cl9tlzz01000t1q394rv59ewq","tag_id":"cl9tlzyzr00071q392fv5hzcv","_id":"cl9tlzz0j003h1q3957xm4qrg"},{"post_id":"cl9tlzz01000t1q394rv59ewq","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz0j003i1q398rwwh4cc"},{"post_id":"cl9tlzz02000v1q39e4fzc75g","tag_id":"cl9tlzz0h002y1q398vz73f92","_id":"cl9tlzz0k003k1q39bghx6np6"},{"post_id":"cl9tlzz02000v1q39e4fzc75g","tag_id":"cl9tlzyzr00071q392fv5hzcv","_id":"cl9tlzz0k003l1q398sjl838i"},{"post_id":"cl9tlzz02000v1q39e4fzc75g","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz0k003n1q39746leyqk"},{"post_id":"cl9tlzz02000y1q391o2j9t17","tag_id":"cl9tlzz0h002y1q398vz73f92","_id":"cl9tlzz0k003o1q39ab8vbva1"},{"post_id":"cl9tlzz02000y1q391o2j9t17","tag_id":"cl9tlzyzr00071q392fv5hzcv","_id":"cl9tlzz0l003q1q397lpq9tfi"},{"post_id":"cl9tlzz02000y1q391o2j9t17","tag_id":"cl9tlzyzt000b1q393hyz82nc","_id":"cl9tlzz0l003r1q395z4hdqy3"},{"post_id":"cl9tlzz0300101q39885vhvn6","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0l003t1q39hana3pv9"},{"post_id":"cl9tlzz0300101q39885vhvn6","tag_id":"cl9tlzz0h002v1q395of228g9","_id":"cl9tlzz0l003u1q393fo11n2c"},{"post_id":"cl9tlzz0400131q39awgs99c3","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0m003w1q39dqjyexg1"},{"post_id":"cl9tlzz0400131q39awgs99c3","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0m003x1q39fbmi8fqa"},{"post_id":"cl9tlzz0400131q39awgs99c3","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0m003z1q39ci5g3pg1"},{"post_id":"cl9tlzz0500151q397ndt93dj","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0m00421q3915c72dt8"},{"post_id":"cl9tlzz0500151q397ndt93dj","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0m00431q3989fscrxu"},{"post_id":"cl9tlzz0500151q397ndt93dj","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0n00451q392ylg91ei"},{"post_id":"cl9tlzz0600181q39gybv6j8h","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0n00481q396zppa7ul"},{"post_id":"cl9tlzz0600181q39gybv6j8h","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0n00491q392oee91ap"},{"post_id":"cl9tlzz0600181q39gybv6j8h","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0n004b1q39gto12cc9"},{"post_id":"cl9tlzz07001a1q39627y9jcu","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0o004e1q3904j09zfb"},{"post_id":"cl9tlzz07001a1q39627y9jcu","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0o004f1q3961regm0z"},{"post_id":"cl9tlzz07001a1q39627y9jcu","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0o004h1q39c2fq202h"},{"post_id":"cl9tlzz08001d1q397nos3ajy","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0p004k1q39dzia6jrm"},{"post_id":"cl9tlzz08001d1q397nos3ajy","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0p004l1q39hkop0pt1"},{"post_id":"cl9tlzz08001d1q397nos3ajy","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0p004n1q39dh4s78dp"},{"post_id":"cl9tlzz08001g1q390ucv5bqb","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0p004q1q396mmx18n5"},{"post_id":"cl9tlzz08001g1q390ucv5bqb","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0q004r1q3933zu68xb"},{"post_id":"cl9tlzz08001g1q390ucv5bqb","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0q004t1q39bhyebfyi"},{"post_id":"cl9tlzz09001j1q395i7n56zg","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0q004w1q39g8awf020"},{"post_id":"cl9tlzz09001j1q395i7n56zg","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0q004x1q392pel5xu2"},{"post_id":"cl9tlzz09001j1q395i7n56zg","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0r004z1q39a5ne7m4c"},{"post_id":"cl9tlzz0a001n1q3944n40isw","tag_id":"cl9tlzz0k003m1q39gj1zaki9","_id":"cl9tlzz0r00521q3920wj5n28"},{"post_id":"cl9tlzz0a001n1q3944n40isw","tag_id":"cl9tlzz0l003p1q393upo6pe9","_id":"cl9tlzz0r00531q3901qph8lj"},{"post_id":"cl9tlzz0a001n1q3944n40isw","tag_id":"cl9tlzz0j003g1q392kvrc3a8","_id":"cl9tlzz0r00551q39ge46hfks"},{"post_id":"cl9tlzz0a001q1q397ocd9pax","tag_id":"cl9tlzz0r00511q39g58iguim","_id":"cl9tlzz0s00581q39875vb5yl"},{"post_id":"cl9tlzz0a001q1q397ocd9pax","tag_id":"cl9tlzz0r00541q39a2d4d0bb","_id":"cl9tlzz0s00591q39aikm1ar5"},{"post_id":"cl9tlzz0a001q1q397ocd9pax","tag_id":"cl9tlzz0e002a1q39b5704srg","_id":"cl9tlzz0s005b1q39e2p4akju"},{"post_id":"cl9tlzz0b001u1q394vbe1cjm","tag_id":"cl9tlzz02000x1q39gqs3891c","_id":"cl9tlzz0s005c1q3970wf06xw"},{"post_id":"cl9tlzz0b001u1q394vbe1cjm","tag_id":"cl9tlzz0s00571q396xp098ui","_id":"cl9tlzz0t005e1q390ci5buxd"},{"post_id":"cl9tlzz0c001w1q391dpy0ggd","tag_id":"cl9tlzz0s005a1q39emri573n","_id":"cl9tlzz0t005f1q39f8wg9124"},{"post_id":"cl9tlzz0c001w1q391dpy0ggd","tag_id":"cl9tlzz0t005d1q397is24yvp","_id":"cl9tlzz0t005g1q3913ab8rat"},{"post_id":"cl9tlzz0c001w1q391dpy0ggd","tag_id":"cl9tlzz0400121q3991rq5ju2","_id":"cl9tlzz0t005h1q398e9053fw"}],"Tag":[{"name":"AirSim","_id":"cl9tlzyzn00021q398b2l6xr6"},{"name":"Research","_id":"cl9tlzyzr00071q392fv5hzcv"},{"name":"Python","_id":"cl9tlzyzt000b1q393hyz82nc"},{"name":"Photos","_id":"cl9tlzyzw000h1q392nyw8m0y"},{"name":"Astrophotography","_id":"cl9tlzyzz000p1q398ube8alu"},{"name":"Life","_id":"cl9tlzz02000x1q39gqs3891c"},{"name":"Others","_id":"cl9tlzz0400121q3991rq5ju2"},{"name":"Astrobear","_id":"cl9tlzz0600171q396erw7yyr"},{"name":"macOS","_id":"cl9tlzz07001c1q39bf148vz0"},{"name":"Hackintosh","_id":"cl9tlzz09001l1q39800lb47c"},{"name":"HP","_id":"cl9tlzz0b001s1q394ncghax3"},{"name":"Hexo","_id":"cl9tlzz0c001y1q39h8233eo2"},{"name":"Travis CI","_id":"cl9tlzz0d00241q395vhe78u4"},{"name":"Blog","_id":"cl9tlzz0e002a1q39b5704srg"},{"name":"Icarus","_id":"cl9tlzz0f002h1q394wke4tsl"},{"name":"Template","_id":"cl9tlzz0g002p1q397jllet6j"},{"name":"Programming Language","_id":"cl9tlzz0h002v1q395of228g9"},{"name":"RL","_id":"cl9tlzz0h002y1q398vz73f92"},{"name":"C++","_id":"cl9tlzz0j003g1q392kvrc3a8"},{"name":"Data Structure","_id":"cl9tlzz0k003m1q39gj1zaki9"},{"name":"Algorithm","_id":"cl9tlzz0l003p1q393upo6pe9"},{"name":"Nginx","_id":"cl9tlzz0r00511q39g58iguim"},{"name":"Server","_id":"cl9tlzz0r00541q39a2d4d0bb"},{"name":"Exercise","_id":"cl9tlzz0s00571q396xp098ui"},{"name":"Windows 10","_id":"cl9tlzz0s005a1q39emri573n"},{"name":"ROG","_id":"cl9tlzz0t005d1q397is24yvp"}]}}